// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
define("require exports @dojo/framework/shim/Map ../../../core/has ../../../core/libs/rbush/rbush ../../../geometry/support/aaBoundingRect ../featureConversionUtils".split(" "),function(k,l,m,p,q,f,g){function n(b,a){d.minX=a[0];d.minY=a[1];d.maxX=a[2];d.maxY=a[3];return b.search(d)}Object.defineProperty(l,"__esModule",{value:!0});var d={minX:0,minY:0,maxX:0,maxY:0},h=[];k=function(){function b(a){this._boundsByFeature=new m.default;this._featuresByBounds=new m.default;this._index=q(9,p("csp-restrictions")?
function(a){return{minX:a[0],minY:a[1],maxX:a[2],maxY:a[3]}}:["[0]","[1]","[2]","[3]"]);this.featureInfo=a}Object.defineProperty(b.prototype,"bounds",{get:function(){if(!this.size)return null;var a=f.create(f.NEGATIVE_INFINITY);this._boundsByFeature.forEach(function(c){c&&(a[0]=Math.min(c[0],a[0]),a[1]=Math.min(c[1],a[1]),a[2]=Math.max(c[2],a[2]),a[3]=Math.max(c[3],a[3]))});return a},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"size",{get:function(){return this._boundsByFeature.size},
enumerable:!0,configurable:!0});b.prototype.add=function(a){if(a)if(a.geometry){var c=g.getBoundsOptimizedGeometry(f.create(),a.geometry,this.featureInfo.hasZ,this.featureInfo.hasM);this._boundsByFeature.set(a,c);this._featuresByBounds.set(c,a);this._index.insert(c)}else this._boundsByFeature.set(a,null)};b.prototype.addMany=function(a){for(var c=this.featureInfo,r=c.hasM,c=c.hasZ,b=0;b<a.length;b++){var e=a[b];if(e)if(e.geometry){var d=g.getBoundsOptimizedGeometry(f.create(),e.geometry,c,r);this._boundsByFeature.set(e,
d);this._featuresByBounds.set(d,e);h.push(d)}else this._boundsByFeature.set(e,null)}this._index.load(h);h.length=0};b.prototype.clear=function(){this._index.clear();this._boundsByFeature.clear();this._featuresByBounds.clear()};b.prototype.forEachBounds=function(a,c){for(var b=0;b<a.length;b++){var d=a[b],e=this.getBounds(d);e&&c(e,d)}};b.prototype.getBounds=function(a){return this._boundsByFeature.get(a)};b.prototype.has=function(a){return this._boundsByFeature.has(a)};b.prototype.remove=function(a){if(a){var c=
this._boundsByFeature.get(a);c&&(this._index.remove(c),this._featuresByBounds.delete(c));this._boundsByFeature.delete(a)}};b.prototype.removeMany=function(a){for(var c=0;c<a.length;c++)this.remove(a[c])};b.prototype.replace=function(a,c){if(this._boundsByFeature.has(a)){var b=this._boundsByFeature.get(a);b&&(this._index.remove(b),this._boundsByFeature.delete(a),this._featuresByBounds.delete(b));c&&(c.geometry?(g.getBoundsOptimizedGeometry(b,c.geometry,this.featureInfo.hasZ,this.featureInfo.hasM),
this._boundsByFeature.set(c,b),this._featuresByBounds.set(b,c),this._index.insert(b)):this._boundsByFeature.set(c,null))}};b.prototype.forEachFeatureInBounds=function(a,c){var b=0;for(a=n(this._index,a);b<a.length;b++)c(this._featuresByBounds.get(a[b]))};b.prototype.mapFeaturesInBounds=function(a,b){var c=[],d=0;for(a=n(this._index,a);d<a.length;d++)c.push(b(this._featuresByBounds.get(a[d])));return c};return b}();l.default=k});