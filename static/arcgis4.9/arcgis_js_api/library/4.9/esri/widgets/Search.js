// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Search/SearchResultRenderer":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/i18n!./nls/Search ../../core/accessorSupport/decorators ../Widget ./SearchViewModel ../support/widget".split(" "),function(A,u,y,a,n,q,e,v,m){return function(e){function l(a){a=e.call(this)||this;a.showMoreResultsOpen=!1;a.viewModel=null;return a}y(l,e);l.prototype.render=function(){var a=this,b,e=this.get("viewModel.selectedResult"),
g=this.get("viewModel.results"),e=e&&e.name||"",z=1<this._countResults(g),B=z&&g.map(function(b){return a._moreResultsList(b)}),g=z?m.tsx("div",{key:"esri-search-renderer__more-results-button",class:"esri-search-result-renderer__more-results-item"},m.tsx("a",{class:"esri-widget__anchor",href:"#",bind:this,onclick:this._showMoreResultsClick,onkeydown:this._showMoreResultsClick},this.showMoreResultsOpen?n.hideMoreResults:n.showMoreResults)):null,z=z?m.tsx("div",{key:"esri-search-renderer__more-results-container",
class:"esri-search-result-renderer__more-results-list"},B):null,B=(b={},b["esri-search-result-renderer__more-results--show-more-results"]=this.showMoreResultsOpen,b);return m.tsx("div",{class:"esri-search-result-renderer esri-widget"},m.tsx("div",{key:"esri-search-renderer__container",class:this.classes("esri-search-result-renderer__more-results",B)},m.tsx("div",{key:"esri-search-renderer__result-name",class:"esri-search-result-renderer__more-results-item"},e),m.tsx("div",{key:"esri-search-renderer__more-results"},
g,z)))};l.prototype._showMoreResultsClick=function(a){a.preventDefault();this.showMoreResultsOpen=!this.showMoreResultsOpen;(a=this.get("viewModel.view.popup"))&&a.reposition()};l.prototype._selectResultClick=function(a){a.preventDefault();a=a.currentTarget["data-result"];this.viewModel&&this.viewModel.select(a)};l.prototype._moreResultsList=function(a){var b=this,e=a.results,g=e.length,z=!!g,k=this.get("viewModel.selectedResult"),g=1===g&&e[0]===k,k=this._getSourceName(a.source,a.sourceIndex),k=
1<this.get("viewModel.results").length&&!g?m.tsx("div",{key:"esri-search-result-renderer__header-"+a.sourceIndex,class:"esri-search-result-renderer__more-results-list-header"},k):null,e=z&&e.map(function(a,e){return b._moreResultsListItem(a,e)}),e=z&&!g?m.tsx("ul",{key:"esri-search-result-renderer__list-"+a.sourceIndex},e):null;return z?m.tsx("div",{key:"esri-search-result-renderer__results-"+a.sourceIndex},k,e):null};l.prototype._moreResultsListItem=function(a,b){var e=this.get("viewModel.selectedResult");
return a!==e?m.tsx("li",{key:"esri-search-result-renderer__list-item-"+b},m.tsx("a",{class:"esri-widget__anchor",href:"#",tabindex:"0",bind:this,"data-result":a,onclick:this._selectResultClick,onkeydown:this._selectResultClick},a.name)):null};l.prototype._getSourceName=function(a,b){return b===v.ALL_INDEX?n.all:a.name};l.prototype._countResults=function(a){return a?a.reduce(function(a,e){return a+e.results.length},0):0};a([m.renderable(),q.property()],l.prototype,"showMoreResultsOpen",void 0);a([q.property(),
m.renderable(["viewModel.results","viewModel.selectedResult"])],l.prototype,"viewModel",void 0);a([m.accessibleHandler()],l.prototype,"_showMoreResultsClick",null);a([m.accessibleHandler()],l.prototype,"_selectResultClick",null);return l=a([q.subclass("esri.widgets.Search.SearchResultRenderer")],l)}(q.declared(e))})},"esri/widgets/Search/SearchViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/i18n!./nls/Search ../../Graphic ../../PopupTemplate ../../core/Accessor ../../core/Collection ../../core/Error ../../core/Evented ../../core/geolocationUtils ../../core/Handles ../../core/has ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/SpatialReference ../../portal/Portal ../../styles/basic ../../symbols/PictureMarkerSymbol ../../symbols/SimpleFillSymbol ../../symbols/SimpleLineSymbol ../../symbols/SimpleMarkerSymbol ../../symbols/TextSymbol ../../views/support/layerViewUtils ./FeatureLayerSearchSource ./LocatorSearchSource ./SearchSource ./support/geometryUtils ./support/locatorUtils ../support/GoTo".split(" "),
function(A,u,y,a,n,q,e,v,m,w,l,k,b,t,g,z,B,h,C,G,p,c,r,F,J,H,P,Q,K,M,R,N,S,O){function E(a,d){return a.hasOwnProperty(d)&&null!=a[d]&&""!==a[d]}var D=g.getLogger("esri.widgets.Search.SearchViewModel"),L=m.ofType({key:function(a){return a.featureLayer?"feature-layer":"locator"},base:R,typeMap:{"feature-layer":K,locator:M}}),I=G.WGS84,U=/<(?:.|\s)*?>/g;return function(g){function d(f){f=g.call(this)||this;f._handles=new b;f._gotoPromise=null;f._searching=null;f._loadingDefaultSources=null;f.activeSourceIndex=
0;f.allPlaceholder=n.allPlaceholder;f.autoNavigate=!0;f.autoSelect=!0;f.defaultSources=new L;f.defaultSymbol=new r({url:A.toUrl(t("trident")?"../../images/search/search-symbol-32.png":"../../images/search/search-symbol-32.svg"),size:24,width:24,height:24});f.includeDefaultSources=!0;f.locationToAddressDistance=1500;f.maxInputLength=128;f.maxResults=6;f.maxSuggestions=6;f.minSuggestCharacters=1;f.popupEnabled=!0;f.popupTemplate=new e({title:n.searchResult,content:"{Match_addr}"});f.portal=p.getDefault();
f.resultGraphicEnabled=!0;f.resultGraphic=null;f.results=null;f.selectedSuggestion=null;f.searchAllEnabled=!0;f.selectedResult=null;f.sources=new L;f.suggestionDelay=150;f.suggestions=null;f.suggestionsEnabled=!0;f.view=null;return f}y(d,g);d.prototype.initialize=function(){var f=this;this._handles.add([B.init(this,"searchAllEnabled",function(){return f._setDefaultActiveSourceIndex()}),B.init(this,"portal",function(f){f&&!f.loaded&&f.load()}),B.init(this,["view","portal","includeDefaultSources"],
function(){return f._loadDefaultSources()}),B.on(this,["defaultSources","sources"],"change",function(){return f.notifyChange("allSources")}),B.on(this,"allSources","change",function(d){return f._allSourcesChanged(d)})])};d.prototype.destroy=function(){this.clearGraphics();this._cancelLoadingDefaultSources();this._clearLoadingDefaultSources();this._handles.destroy();this._handles=null};Object.defineProperty(d.prototype,"activeSource",{get:function(){return this.allSources.getItemAt(this.activeSourceIndex)||
null},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"allSources",{get:function(){var f=this.sources,d=this.defaultSources,a=this.includeDefaultSources,f="function"===typeof a?a.call(null,{sources:f,defaultSources:d}):a?d.concat(f):f,c=this._get("allSources")||new L;c.removeAll();f.filter(Boolean).forEach(function(f){return c.add(f)});return c},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"locationEnabled",{get:function(){return this._get("locationEnabled")||
k.supported()},set:function(f){if(void 0===f)this._clearOverride("locationEnabled");else{var d=k.supported();if(f&&!d){var a=new w("locationEnabled:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});D.error(a)}this._override("locationEnabled",f&&d)}},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"placeholder",{get:function(){var f=this.activeSourceIndex,d=this.allPlaceholder,d=void 0===d?n.allPlaceholder:d;return-1===f?d:(f=this.allSources.getItemAt(f))?
f.placeholder:""},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"searchTerm",{get:function(){return this._get("searchTerm")||""},set:function(f){this._set("searchTerm",f||"");this.clearGraphics();this.selectedSuggestion&&this.selectedSuggestion.text!==f&&this._set("selectedSuggestion",null);""===f&&this._clear()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"state",{get:function(){return this._searching?"searching":this._loadingDefaultSources?"loading":0===
this.allSources.length?"disabled":"ready"},enumerable:!0,configurable:!0});d.prototype.clear=function(){this.searchTerm=""};d.prototype.clearGraphics=function(){this._removeHighlight();this._closePopup();this.view&&this.view.graphics.remove(this.resultGraphic);this._set("resultGraphic",null)};d.prototype.search=function(f){var d=this;this.emit("search-start");this.clearGraphics();var a=this._createSuggestionForSearch(f);this._searching=f=this._whenViewAndPortalLoaded().then(function(){return d._getResultsFromSources(a).then(function(f){var c=
{activeSourceIndex:d.activeSourceIndex,searchTerm:a.text,numResults:0,numErrors:0,errors:[],results:[]};d._formatResponse(c,f,a);f=d._getFirstResult(c.results);var b=(a.location&&f?f.name:a.text).replace(U,"");d._set("searchTerm",b);(a.key&&"number"===typeof a.sourceIndex||a.location)&&d._set("selectedSuggestion",a);d._set("results",c.results);d.emit("search-complete",c);return d._selectFirstResult(f).then(function(){return c})})});this.notifyChange("state");f.then(function(){return d._clearSearching()}).catch(function(){return d._clearSearching()});
return f};d.prototype.searchNearby=function(){var f=this;if(!this.locationEnabled){var d=new w("searchNearby:geolocation-unsupported","Geolocation API is unsupported.",{geolocation:navigator.geolocation});D.error(d);return z.reject(d)}this._searching=d=k.getCurrentPosition().then(function(d){return k.positionToPoint(d,f.view).then(function(d){return f.search(d)})});this.notifyChange("state");d.then(function(){return f._clearSearching()}).catch(function(){return f._clearSearching()});return d};d.prototype.select=
function(f){var d=this;this.clearGraphics();if(!f){var a=new w("select:missing-parameter","Cannot select without a searchResult.",{searchResult:f});D.error(a);return z.reject(a)}var c=this.view,b=E(f,"sourceIndex")?f.sourceIndex:this._getSourceIndexOfResult(f),r=this.allSources.getItemAt(b);if(!r)return a=new w("select:missing-source","Cannot select without a source.",{source:r}),D.error(a),z.reject(a);var a=r instanceof K?this._getSourcePopupTemplate(r):null,h=r.resultSymbol||this._getDefaultSymbol(f),
e=E(r,"resultGraphicEnabled")?r.resultGraphicEnabled:this.resultGraphicEnabled,g=E(r,"autoNavigate")?r.autoNavigate:this.autoNavigate,t=E(r,"popupEnabled")?r.popupEnabled:this.popupEnabled,k=t?a||this.popupTemplate:null,l=f.feature;if(!l)return a=new w("select:missing-feature","Cannot select without a feature.",{feature:l}),D.error(a),z.reject(a);var B=l.attributes,p=l.geometry,F=l.layer,m=l.sourceLayer,H=N.getPointFromGeometry(p),a={layerViewQuery:this._getHighlightLayerView(l),elevationQuery:c&&
H?N.getPointWithElevation(H,c).catch(function(){return H}):z.resolve(H)};return z.eachAlways(a).then(function(a){var T=a.layerViewQuery.value,V=a.elevationQuery.value;h instanceof P&&(h.text=f.name);a=c&&g?d._getGoToTarget(f,r):null;return(a?d._goToSearchResult(a):z.resolve()).then(function(){d._gotoPromise=null;var a=T?l:new q({geometry:p,symbol:h,attributes:B,layer:F,sourceLayer:m,popupTemplate:k});T?d._highlightFeature({graphic:a,layerView:T}):e&&c&&c.graphics.push(a);t&&d.get("view.popup")&&a.getEffectivePopupTemplate()&&
c.popup.open({features:[a],location:V});d._set("selectedResult",f);d._set("resultGraphic",a);d.emit("select-result",{result:f,source:r,sourceIndex:b});return f})})};d.prototype.suggest=function(f,d){var a=this,c=f||this.searchTerm;this.emit("suggest-start",{searchTerm:c});return this._suggestTimer(d).then(function(){return a._suggestImmediate(c).then(function(f){a._set("suggestions",f.results);a.emit("suggest-complete",f);return f})})};d.prototype._cancelLoadingDefaultSources=function(){var f=this._loadingDefaultSources;
f&&f.cancel()};d.prototype._clearLoadingDefaultSources=function(){this._loadingDefaultSources=null;this.notifyChange("state")};d.prototype._clearSearching=function(){this._searching=null;this.notifyChange("state")};d.prototype._convertHelperServices=function(){var f=this.get("portal.helperServices.geocode");return f?f.map(function(f){if(!1!==f.placefinding&&(f=M.fromJSON(f),S.isArcGISWorldGeocoder(f.get("locator.url"))&&f.set({singleLineFieldName:"SingleLine",outFields:["Addr_type","Match_addr","StAddr",
"City"],localSearchOptions:{minScale:3E5,distance:5E4},placeholder:n.placeholder}),f.singleLineFieldName))return f}).filter(Boolean):[]};d.prototype._convertApplicationProperties=function(){var f=this,d=this.get("view.map.applicationProperties.viewing.search"),a=this.get("view.map");if(!a||!d)return[];var c=d.hintText;return d.enabled?d.layers.map(function(d){var r=a.findLayerById(d.id);if(r){d=f._getLayerJSON(d);var b=K.fromJSON(d);b.placeholder=c;f._getFeatureLayer(r,d).then(function(f){b.featureLayer=
f});return b}}).filter(Boolean):[]};d.prototype._getSubFeatureLayer=function(f,d){return f&&f.allSublayers?(f=f.allSublayers.getItemAt(d.subLayer))?z.resolve(f.createFeatureLayer()):z.reject():z.reject()};d.prototype._getFeatureLayer=function(f,d){var a=this;if("feature"===f.type||"scene"===f.type)return z.resolve(f);if("map-image"===f.type)return f.load().then(function(){return a._getSubFeatureLayer(f,d).catch(function(){var d=new w("search:create-featurelayer","Could not create a FeatureLayer from the MapImageLayer",
{layer:f});D.error(d);return null})})};d.prototype._getLayerJSON=function(f){return"function"===typeof f.toJSON?f.toJSON():f};d.prototype._updateDefaultSources=function(){var f=this.defaultSources,d=this.includeDefaultSources;f.removeAll();d&&f.addMany(this._convertApplicationProperties().concat(this._convertHelperServices()));this.notifyChange("allSources")};d.prototype._clear=function(){this._gotoPromise&&(this._gotoPromise.cancel(),this._gotoPromise=null);this._set("results",null);this._set("suggestions",
null);this._set("selectedResult",null);this._set("selectedSuggestion",null);this.emit("search-clear")};d.prototype._closePopup=function(){var f=this.get("view.popup"),d=this.resultGraphic;if(f&&d){var a=f.selectedFeature;a&&a===d&&f.close()}};d.prototype._suggestTimer=function(f){return z.after(null!=f?f:this.suggestionDelay)};d.prototype._createLocationForSearch=function(f){if(f instanceof q)return N.getPointFromGeometry(f.geometry);if(f instanceof C)return f;if(Array.isArray(f)&&2===f.length)return new C({longitude:f[0],
latitude:f[1]})};d.prototype._createSuggestionForSearch=function(f){if(f&&E(f,"key")&&E(f,"text")&&E(f,"sourceIndex"))return f;var d=this._createLocationForSearch(f)||null,a="string"===typeof f?f:this.searchTerm,c=this.selectedSuggestion,r=this.selectedResult,b=(f=!f&&c&&r)&&c.location;return f&&c.key===r.key&&c.sourceIndex===r.sourceIndex||b?c:{location:d,text:d?"":a,sourceIndex:null,key:null}};d.prototype._getFirstResult=function(f){var d=null;f&&f.some(function(f){f=f.results[0];var a=!!f;a&&(d=
f);return a});return d};d.prototype._selectFirstResult=function(f){return this.autoSelect&&f?this.select(f):z.resolve()};d.prototype._suggestImmediate=function(f){var d=this;return this._whenViewAndPortalLoaded().then(function(){return d._getSuggestionsFromSources(f)}).then(function(a){var c={activeSourceIndex:d.activeSourceIndex,searchTerm:f,numResults:0,numErrors:0,errors:[],results:[]};d._formatResponse(c,a);return c})};d.prototype._formatSourceResponse=function(f,d,a){var c=d&&d.value||[];d=d&&
d.error;var r=this.allSources.getItemAt(a);d?(f.errors.push({sourceIndex:a,source:r,error:d}),f.numErrors++):(f.results.push({sourceIndex:a,source:r,results:c}),f.numResults+=c.length)};d.prototype._formatResponse=function(f,d,a){var c=this;if(d)if(-1===f.activeSourceIndex){var r=a&&E(a,"sourceIndex")&&-1!==a.sourceIndex?a.sourceIndex:void 0;d.forEach(function(d,a){c._formatSourceResponse(f,d,void 0!==r?r:a)})}else this._formatSourceResponse(f,d[0],f.activeSourceIndex)};d.prototype._getResultsFromSources=
function(f){var d=this,a=this.allSources,c=!f.location&&E(f,"sourceIndex")?f.sourceIndex:this.activeSourceIndex,r=[];if(!a.length)return a=new w("search:no-sources-defined","At least one source is required.",{allSources:a}),D.error(a),z.reject(a);-1===c?a.forEach(function(a,c){r.push(d._getResultsFromSource(f,c))}):r.push(this._getResultsFromSource(f,c));return z.eachAlways(r)};d.prototype._getSuggestionsFromSources=function(f){var d=this,a=this.allSources,c=this.activeSourceIndex,r=[];if(!a.length)return a=
new w("suggest:no-sources-defined","At least one source is required.",{allSources:a}),D.error(a),z.reject(a);-1===c?a.forEach(function(a,c){r.push(d._getSuggestionsFromSource(f,c))}):r.push(this._getSuggestionsFromSource(f,c));return z.eachAlways(r)};d.prototype._getResultsFromSource=function(f,d){var a=this.allSources.getItemAt(d),c=f.location,c=void 0===c?null:c,r=this.get("view.spatialReference")||I,b=E(a,"maxResults")?a.maxResults:this.maxResults,h=a instanceof K&&E(a,"exactMatch")?a.exactMatch:
!1,e=a instanceof M&&E(a,"locationToAddressDistance")?a.locationToAddressDistance:this.locationToAddressDistance;return a.getResults({view:this.view,sourceIndex:d,location:c,suggestResult:f,spatialReference:r,exactMatch:h,maxResults:b,distance:e})};d.prototype._getSuggestionsFromSource=function(f,d){var a=this.allSources.getItemAt(d),c=E(a,"suggestionsEnabled")?a.suggestionsEnabled:this.suggestionsEnabled,r=f.trim().length,b=E(a,"minSuggestCharacters")?a.minSuggestCharacters:this.minSuggestCharacters;
return c&&r>=b?(c=this.get("view.spatialReference")||I,r=E(a,"maxSuggestions")?a.maxSuggestions:this.maxSuggestions,a.getSuggestions({view:this.view,sourceIndex:d,suggestTerm:f,spatialReference:c,maxSuggestions:r})):z.resolve()};d.prototype.createDefaultSymbol=function(a,d){if("point"===d)return new H({color:a.color,size:a.size,outline:{color:a.outline.color,width:a.outline.width}});if("polyline"===d)return new J({color:a.color,width:a.width});if("polygon"===d)return new F({color:a.color,outline:{color:a.outline.color,
width:a.outline.width}})};d.prototype._setDefaultActiveSourceIndex=function(){this.activeSourceIndex=1!==this.allSources.length&&this.searchAllEnabled?-1:0;this.notifyChange("activeSource")};d.prototype._getSourcePopupTemplate=function(a){var d=a.featureLayer;if(d)return E(a,"popupTemplate")?a.popupTemplate:d.popupTemplate};d.prototype._getSourceIndexOfResult=function(a){var d=null;this.results.some(function(f){return f.results.some(function(c){if(c===a)return d=f.sourceIndex,!0})});return d};d.prototype._getGoToTarget=
function(a,d){var f=a.extent;a=a.feature;return d instanceof K?a||f:f||a};d.prototype._goToSearchResult=function(a){var d=!!a;a=this.callGoTo({target:{target:a},options:{animate:d}});d&&(this._gotoPromise=a);return a};d.prototype._whenViewAndPortalLoaded=function(){var a=this.portal,d=this.view,d=d?d.when():z.resolve(),a=a?a.when():z.resolve();return z.eachAlways([d,a]).then(function(){})};d.prototype._loadDefaultSources=function(){var a=this,d=this.includeDefaultSources;this._cancelLoadingDefaultSources();
this._clearLoadingDefaultSources();var d=d?this._whenViewAndPortalLoaded():z.resolve(),c=!1;d.catch(function(){}).then(function(){c=!0;a._clearLoadingDefaultSources();a._updateDefaultSources()});c||(this._loadingDefaultSources=d,this.notifyChange("state"));return d};d.prototype._getDefaultSymbol=function(a){var d=this.get("view.map.basemap.id");if(a=a&&a.feature&&a.feature.geometry&&a.feature.geometry.type)if(d=(d=c.getSchemes({theme:"default",basemap:d||"topo",geometryType:a}))&&d.primaryScheme)return d.color&&
E(d,"opacity")&&(d.color.a=d.opacity),this.createDefaultSymbol(d,a);return this.defaultSymbol};d.prototype._allSourcesChanged=function(a){var d=a.target.length;a=d-a.added.length+a.removed.length;a!==d&&(1>=a&&1<d||1>=d&&1<a||this._setDefaultActiveSourceIndex())};d.prototype._removeHighlight=function(){this._handles.remove("highlight")};d.prototype._getHighlightLayerView=function(a){var d=this.view;if(!a||!d)return z.resolve(null);var f=a.layer;return d.when(function(){return d.whenLayerView(f).then(function(a){return Q.hasHighlight(a)?
a:null})})};d.prototype._highlightFeature=function(a){var d=a.graphic,f=d.attributes,c=d.layer.objectIdField;a=a.layerView.highlight(f&&f[c]||d,{});this._handles.add(a,"highlight")};d.ALL_INDEX=-1;a([h.property({readOnly:!0,dependsOn:["activeSourceIndex","allSources.length"],value:null})],d.prototype,"activeSource",null);a([h.property()],d.prototype,"activeSourceIndex",void 0);a([h.property()],d.prototype,"allPlaceholder",void 0);a([h.property({dependsOn:["defaultSources.length","sources.length",
"includeDefaultSources"],readOnly:!0})],d.prototype,"allSources",null);a([h.property()],d.prototype,"autoNavigate",void 0);a([h.property()],d.prototype,"autoSelect",void 0);a([h.property({readOnly:!0})],d.prototype,"defaultSources",void 0);a([h.property()],d.prototype,"defaultSymbol",void 0);a([h.property()],d.prototype,"includeDefaultSources",void 0);a([h.property()],d.prototype,"locationEnabled",null);a([h.property()],d.prototype,"locationToAddressDistance",void 0);a([h.property()],d.prototype,
"maxInputLength",void 0);a([h.property()],d.prototype,"maxResults",void 0);a([h.property()],d.prototype,"maxSuggestions",void 0);a([h.property()],d.prototype,"minSuggestCharacters",void 0);a([h.property({readOnly:!0,dependsOn:["activeSourceIndex","activeSource.placeholder","allPlaceholder","allSources"]})],d.prototype,"placeholder",null);a([h.property()],d.prototype,"popupEnabled",void 0);a([h.property({type:e})],d.prototype,"popupTemplate",void 0);a([h.property({type:p})],d.prototype,"portal",void 0);
a([h.property()],d.prototype,"resultGraphicEnabled",void 0);a([h.property({readOnly:!0})],d.prototype,"resultGraphic",void 0);a([h.property({readOnly:!0})],d.prototype,"results",void 0);a([h.property({readOnly:!0})],d.prototype,"selectedSuggestion",void 0);a([h.property()],d.prototype,"searchAllEnabled",void 0);a([h.property({readOnly:!0})],d.prototype,"selectedResult",void 0);a([h.property()],d.prototype,"searchTerm",null);a([h.property({type:L})],d.prototype,"sources",void 0);a([h.property({readOnly:!0,
dependsOn:["allSources.length"]})],d.prototype,"state",null);a([h.property()],d.prototype,"suggestionDelay",void 0);a([h.property({readOnly:!0})],d.prototype,"suggestions",void 0);a([h.property()],d.prototype,"suggestionsEnabled",void 0);a([h.property()],d.prototype,"view",void 0);a([h.property()],d.prototype,"clear",null);return d=a([h.subclass("esri.widgets.Search.SearchViewModel")],d)}(h.declared(v,l,O))})},"esri/core/geolocationUtils":function(){define("require exports ./tsSupport/assignHelper ../config ./Error ./has ./Logger ./promiseUtils ../geometry/Point ../geometry/support/webMercatorUtils ../portal/Portal ../tasks/GeometryService ../tasks/support/ProjectParameters".split(" "),
function(A,u,y,a,n,q,e,v,m,w,l,k,b){function t(a,e){var h=e.spatialReference;return h.isWGS84?v.resolve(a):h.isWebMercator?v.resolve(w.geographicToWebMercator(a)):g().then(function(e){if(!e)return v.reject(new n("geometry-service:missing-url","Geometry service URL is missing"));e=new k({url:e});var c=new b({geometries:[a],outSR:h});return e.project(c).then(function(a){return a[0]})})}function g(){if(a.geometryServiceUrl)return v.resolve(a.geometryServiceUrl);var b=l.getDefault();return b.load().always(function(){return b.get("helperServices.geometry.url")})}
Object.defineProperty(u,"__esModule",{value:!0});var z=e.getLogger("esri.core.geolocationUtils"),B={maximumAge:0,timeout:15E3,enableHighAccuracy:!0};u.supported=function(){var a=q("esri-geolocation");a||z.warn("geolocation-unsupported","Geolocation unsupported.");a&&((a=q("esri-secure-context"))||z.warn("insecure-context","Geolocation requires a secure origin."));return a};u.getCurrentPosition=function(a){a||(a=B);var b=v.create(function(b,e){navigator.geolocation.getCurrentPosition(b,e,a)});return v.timeout(b,
15E3,void 0)};u.positionToPoint=function(a,b){var e=a&&a.coords||{},e={accuracy:e.accuracy,altitude:e.altitude,altitudeAccuracy:e.altitudeAccuracy,heading:e.heading,latitude:e.latitude,longitude:e.longitude,speed:e.speed};a=a?{coords:e,timestamp:a.timestamp}:a;a=(a=a&&a.coords)?new m({longitude:a.longitude,latitude:a.latitude,z:a.altitude||null,spatialReference:{wkid:4326}}):null;return t(a,b)}})},"esri/styles/basic":function(){define(["../core/lang","../Color"],function(A,u){function y(a,e){var q;
if(a)switch(q={},q.color=new u(a.color),e){case "point":q.outline={color:new u(a.outline.color),width:a.outline.width};q.size=a.size;break;case "polyline":q.width=a.width;break;case "polygon":q.outline={color:new u(a.outline.color),width:a.outline.width}}return q}var a={"default":{name:"default",label:"Default",description:"Default theme for basic visualization of features.",basemapGroups:{light:"streets gray topo terrain national-geographic oceans osm gray-vector streets-vector topo-vector streets-relief-vector streets-navigation-vector".split(" "),
dark:["satellite","hybrid","dark-gray","dark-gray-vector","streets-night-vector"]},pointSchemes:{light:{primary:{color:[77,77,77,1],outline:{color:[255,255,255,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[255,255,255,1],outline:{color:[51,51,51,1],width:1},size:8}]},dark:{primary:{color:[255,255,255,1],outline:{color:[26,26,26,1],width:1},size:8},secondary:[{color:[226,119,40,1],outline:{color:[255,255,255,1],width:1},size:8},{color:[26,
26,26,1],outline:{color:[178,178,178,1],width:1},size:8}]}},lineSchemes:{light:{primary:{color:[77,77,77,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[255,255,255,1],width:2}]},dark:{primary:{color:[255,255,255,1],width:2},secondary:[{color:[226,119,40,1],width:2},{color:[26,26,26,1],width:2}]}},polygonSchemes:{light:{primary:{color:[227,139,79,.8],outline:{color:[255,255,255,1],width:1}},secondary:[{color:[128,128,128,.8],outline:{color:[255,255,255,1],width:1}},{color:[255,255,255,
.8],outline:{color:[128,128,128,1],width:1}}]},dark:{primary:{color:[227,139,79,.8],outline:{color:[51,51,51,1],width:1}},secondary:[{color:[178,178,178,.8],outline:{color:[51,51,51,1],width:1}},{color:[26,26,26,.8],outline:{color:[128,128,128,1],width:1}}]}}}},n={};(function(){var q,e,v,m,w,l,k,b;for(q in a)for(m in e=a[q],v=e.basemapGroups,w=n[q]={basemaps:[].concat(v.light).concat(v.dark),point:{},polyline:{},polygon:{}},v)for(l=v[m],k=0;k<l.length;k++)b=l[k],e.pointSchemes&&(w.point[b]=e.pointSchemes[m]),
e.lineSchemes&&(w.polyline[b]=e.lineSchemes[m]),e.polygonSchemes&&(w.polygon[b]=e.polygonSchemes[m])})();return{getAvailableThemes:function(q){var e=[],v,m,w;for(v in a)m=a[v],w=n[v],q&&w.basemaps&&-1===w.basemaps.indexOf(q)||e.push({name:m.name,label:m.label,description:m.description,basemaps:w.basemaps.slice(0)});return e},getSchemes:function(a){var e=a.basemap,q=a.geometryType;a=n[a.theme];var m;(a=(a=a&&a[q])&&a[e])&&(m={primaryScheme:y(a.primary,q),secondarySchemes:a.secondary.map(function(a){return y(a,
q)})});return m},cloneScheme:function(a){var e;a&&(e=A.mixin({},a),e.color&&(e.color=new u(e.color)),e.outline&&(e.outline={color:e.outline.color&&new u(e.outline.color),width:e.outline.width}));return e}}})},"esri/widgets/Search/FeatureLayerSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ../../layers/CSVLayer ../../layers/FeatureLayer ../../layers/Layer ../../layers/SceneLayer ./SearchSource ./support/featureLayerUtils".split(" "),
function(A,u,y,a,n,q,e,v,m,w,l,k,b){return function(t){function g(){var a=null!==t&&t.apply(this,arguments)||this;a.displayField=null;a.exactMatch=null;a.searchFields=null;a.searchQueryParams=null;a.searchTemplate=null;a.suggestionTemplate=null;a.suggestQueryParams=null;return a}y(g,t);z=g;Object.defineProperty(g.prototype,"featureLayer",{set:function(a){this._set("featureLayer",a);a&&a.load()},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"name",{get:function(){return this._getFeatureLayerTitle()||
""},set:function(a){void 0===a?this._clearOverride("name"):this._override("name",a)},enumerable:!0,configurable:!0});g.prototype.clone=function(){return new z({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?q.clone(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?
this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,displayField:this.displayField,exactMatch:this.exactMatch,featureLayer:this.featureLayer,searchFields:this.searchFields?q.clone(this.searchFields):null,searchQueryParams:this.searchQueryParams?q.clone(this.searchQueryParams):null,suggestionTemplate:this.suggestionTemplate,suggestQueryParams:this.suggestQueryParams?
q.clone(this.suggestQueryParams):null,zoomScale:this.zoomScale})};g.prototype.getResults=function(a){return b.getResults(n({source:this},a))};g.prototype.getSuggestions=function(a){return b.getSuggestions(n({source:this},a))};g.prototype._getFirstStringField=function(){var a=this.featureLayer,b="";a&&a.fields&&a.fields.some(function(a){if("string"===a.type)return b=a.name,!0});return b};g.prototype._getDisplayField=function(){return this.displayField||this.featureLayer.displayField||this._getFirstStringField()};
g.prototype._getFeatureLayerTitle=function(){var a=this.featureLayer;if(a){var b=a.title;if(b){var e="";(this.searchFields||[this._getDisplayField()]).forEach(function(b,h){e+=0===h?": ":", ";h=a.getField(b);e+=h&&h.alias||b});return""+b+e}}};var z;a([e.property({json:{read:{source:"field.name"},write:{target:"field.name"}}})],g.prototype,"displayField",void 0);a([e.property({json:{read:{source:"field.exactMatch"},write:{target:"field.exactMatch"}}})],g.prototype,"exactMatch",void 0);a([e.property({types:{key:"type",
base:w,defaultKeyValue:"feature",typeMap:{feature:m,csv:v,scene:l}},value:null})],g.prototype,"featureLayer",null);a([e.property({dependsOn:["featureLayer.title"]})],g.prototype,"name",null);a([e.property()],g.prototype,"searchFields",void 0);a([e.property()],g.prototype,"searchQueryParams",void 0);a([e.property()],g.prototype,"searchTemplate",void 0);a([e.property()],g.prototype,"suggestionTemplate",void 0);a([e.property()],g.prototype,"suggestQueryParams",void 0);return g=z=a([e.subclass("esri.widgets.Search.FeatureLayerSearchSource")],
g)}(e.declared(k))})},"esri/layers/CSVLayer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../core/tsSupport/paramHelper ../geometry ../core/urlUtils ../core/accessorSupport/decorators ./FeatureLayer ./graphics/data/QueryEngineCapabilities ./graphics/sources/CSVSource ../tasks/support/Query".split(" "),function(A,u,y,a,n,q,e,v,m,w,l,k,b){return function(t){function g(a,b){a=t.call(this)||this;a.delimiter=null;
a.fields=null;a.latitudeField=null;a.locationType="coordinates";a.longitudeField=null;a.operationalLayerType="CSV";a.outFields=["*"];a.portalItem=null;a.spatialReference=e.SpatialReference.WGS84;a.source=null;a.type="csv";return a}y(g,t);g.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?n({url:a},b):a};Object.defineProperty(g.prototype,"capabilities",{get:function(){return{data:{supportsAttachment:!1,supportsM:!1,supportsZ:!1},operations:{supportsCalculate:!1,supportsTruncate:!1,
supportsValidateSql:!1,supportsAdd:!1,supportsDelete:!1,supportsEditing:!1,supportsQuery:!0,supportsResizeAttachments:!1,supportsUpdate:!1},query:l.queryCapabilities,queryRelated:{supportsCount:!1,supportsOrderBy:!1,supportsPagination:!1},editing:{supportsGeometryUpdate:!1,supportsGlobalId:!1,supportsRollbackOnFailure:!1,supportsUpdateWithoutM:!1,supportsUploadWithItemId:!1,supportsDeleteByAnonymous:!1,supportsDeleteByOthers:!1,supportsUpdateByAnonymous:!1,supportsUpdateByOthers:!1}}},enumerable:!0,
configurable:!0});Object.defineProperty(g.prototype,"hasService",{get:function(){return!1},enumerable:!0,configurable:!0});g.prototype.readWebMapLabelsVisible=function(a,b){return null!=b.showLabels?b.showLabels:!!(b.layerDefinition&&b.layerDefinition.drawingInfo&&b.layerDefinition.drawingInfo.labelingInfo)};Object.defineProperty(g.prototype,"url",{set:function(a){this._set("url",a)},enumerable:!0,configurable:!0});g.prototype.readUrl=function(a,b,e){return v.read(a,e)};g.prototype.writeUrl=function(a,
b,e,g){a=v.write(a,g);b.url=a?v.normalize(a):a};g.prototype.createGraphicsSource=function(){var a=this,b=new k.default({delimiter:this.delimiter,fields:this.fields,latitudeField:this.latitudeField,longitudeField:this.longitudeField,spatialReference:this.spatialReference,url:this.url});this._set("source",b);return b.load().then(function(){a.read({locationInfo:b.locationInfo,columnDelimiter:b.columnDelimiter},{origin:"service",url:a.parsedUrl});return b})};g.prototype.queryFeatures=function(a,b){var e=
this;return this.load().then(function(){return e.source.queryFeatures(a||e.createQuery())}).then(function(a){if(a&&a.features)for(var b=0,g=a.features;b<g.length;b++){var c=g[b];c.layer=c.sourceLayer=e}return a})};g.prototype.queryFeaturesJSON=function(a,b){var e=this;return this.load().then(function(){return e.source.queryFeaturesJSON(a||e.createQuery())})};g.prototype.queryObjectIds=function(a,b){var e=this;return this.load().then(function(){return e.source.queryObjectIds(a||e.createQuery())})};
g.prototype.queryFeatureCount=function(a,b){var e=this;return this.load().then(function(){return e.source.queryFeatureCount(a||e.createQuery())})};g.prototype.queryExtent=function(a,b){var e=this;return this.load().then(function(){return e.source.queryExtent(a||e.createQuery())})};g.prototype._verifyFields=function(){};g.prototype._verifySource=function(){};g.prototype._hasMemorySource=function(){return!0};a([m.property({readOnly:!0,dependsOn:["loaded"],json:{read:!1,write:!1}})],g.prototype,"capabilities",
null);a([m.property({type:String,json:{read:{source:"columnDelimiter"},write:{target:"columnDelimiter",ignoreOrigin:!0}}})],g.prototype,"delimiter",void 0);a([m.property({json:{read:{source:"layerDefinition.fields"}}})],g.prototype,"fields",void 0);a([m.property({readOnly:!0})],g.prototype,"hasService",null);a([m.reader("web-map","labelsVisible",["layerDefinition.drawingInfo.labelingInfo","showLabels"])],g.prototype,"readWebMapLabelsVisible",null);a([m.property({type:String,json:{read:{source:"locationInfo.latitudeFieldName"},
write:{target:"locationInfo.latitudeFieldName",ignoreOrigin:!0}}})],g.prototype,"latitudeField",void 0);a([m.property({type:String,json:{read:{source:"locationInfo.locationType"},write:{target:"locationInfo.locationType",ignoreOrigin:!0,isRequired:!0}}})],g.prototype,"locationType",void 0);a([m.property({type:String,json:{read:{source:"locationInfo.longitudeFieldName"},write:{target:"locationInfo.longitudeFieldName",ignoreOrigin:!0}}})],g.prototype,"longitudeField",void 0);a([m.property()],g.prototype,
"operationalLayerType",void 0);a([m.property()],g.prototype,"outFields",void 0);a([m.property({json:{read:!1,write:!1}})],g.prototype,"portalItem",void 0);a([m.property({json:{read:!1},cast:null,type:k.default,readOnly:!0})],g.prototype,"source",void 0);a([m.property({json:{read:!1},value:"csv",readOnly:!0})],g.prototype,"type",void 0);a([m.property({json:{write:!0}})],g.prototype,"url",null);a([m.reader("url")],g.prototype,"readUrl",null);a([m.writer("url")],g.prototype,"writeUrl",null);a([q(0,m.cast(b))],
g.prototype,"queryFeatures",null);a([q(0,m.cast(b))],g.prototype,"queryFeaturesJSON",null);a([q(0,m.cast(b))],g.prototype,"queryObjectIds",null);a([q(0,m.cast(b))],g.prototype,"queryFeatureCount",null);a([q(0,m.cast(b))],g.prototype,"queryExtent",null);return g=a([m.subclass("esri.layers.CSVLayer")],g)}(m.declared(w))})},"esri/layers/graphics/data/QueryEngineCapabilities":function(){define(["require","exports"],function(A,u){Object.defineProperty(u,"__esModule",{value:!0});u.queryCapabilities={supportsAttachments:!1,
supportsStatistics:!0,supportsCentroid:!0,supportsDistance:!0,supportsDistinct:!0,supportsExtent:!0,supportsGeometryProperties:!1,supportsHavingClause:!0,supportsOrderBy:!0,supportsPagination:!0,supportsQuantization:!0,supportsResultType:!1,supportsSqlExpression:!0,supportsStandardizedQueriesOnly:!0,supportsQueryByOthers:!0,supportsHistoricMoment:!1,supportsFormatPBF:!1}})},"esri/layers/graphics/sources/CSVSource":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../geometry ../../../core/Accessor ../../../core/has ../../../core/Loadable ../../../core/requireUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../tasks/support/FeatureSet module".split(" "),
function(A,u,y,a,n,q,e,v,m,w,l,k,b){Object.defineProperty(u,"__esModule",{value:!0});e.add("esri-workers-for-memory-layers",!1);q=function(t){function g(a){return t.call(this,a)||this}y(g,t);g.prototype.load=function(){var a=this;this.addResolvingPromise(w.open(m.getAbsMid("./support/CSVSourceWorker",A,b),{client:this,strategy:e("esri-workers-for-memory-layers")?"dedicated":"local"}).then(function(b){a._connection=b;return b.invoke("load",{url:a.url,parsing:{columnDelimiter:a.delimiter,fields:a.fields&&
a.fields.map(function(a){return a.toJSON()}),latitudeField:a.latitudeField,longitudeField:a.longitudeField,spatialReference:a.spatialReference&&a.spatialReference.toJSON()}})}).then(function(b){a.locationInfo=b.locationInfo;a.layerDefinition=b.layerDefinition;a.columnDelimiter=b.columnDelimiter}));return this.when()};g.prototype.destroy=function(){this._connection&&this._connection.close()};g.prototype.openPorts=function(){var a=this;return this.load().then(function(){return a._connection.openPorts()})};
g.prototype.queryFeatures=function(a){return this.queryFeaturesJSON(a).then(function(a){return k.fromJSON(a)})};g.prototype.queryFeaturesJSON=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryFeatures",a?a.toJSON():null)})};g.prototype.queryFeatureCount=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryFeatureCount",a?a.toJSON():null)})};g.prototype.queryObjectIds=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryObjectIds",
a?a.toJSON():null)})};g.prototype.queryExtent=function(a){var b=this;return this.load().then(function(){return b._connection.invoke("queryExtent",a?a.toJSON():null)}).then(function(a){return{count:a.count,extent:n.Extent.fromJSON(a.extent)}})};a([l.property()],g.prototype,"url",void 0);a([l.property()],g.prototype,"delimiter",void 0);a([l.property()],g.prototype,"fields",void 0);a([l.property()],g.prototype,"latitudeField",void 0);a([l.property()],g.prototype,"longitudeField",void 0);a([l.property()],
g.prototype,"spatialReference",void 0);a([l.property()],g.prototype,"locationInfo",void 0);a([l.property()],g.prototype,"layerDefinition",void 0);a([l.property()],g.prototype,"columnDelimiter",void 0);return g=a([l.subclass("esri.layers.graphics.sources.CSVSource")],g)}(l.declared(q,v));u.default=q})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/promise/all ../PopupTemplate ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../symbols/support/ElevationInfo ../tasks/support/Query".split(" "),
function(A,u,y,a,n,q,e,v,m,w,l,k,b,t,g,z,B,h,C,G,p,c,r,F,J,H,P,Q,K,M,R,N,S){function O(a,c,d){a&&((a=K.read(a,c,d)||void 0)||D.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:d}));return a}var E=["3DObject","Point"],D=w.getLogger("esri.layers.SceneLayer"),L={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
I={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(h){function x(a,f){a=h.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}a(x,h);x.prototype.normalizeCtorArgs=function(a,f){return"string"===typeof a?y({url:a},f):a};x.prototype.getField=function(a){return F.getField(a,this.fields)};Object.defineProperty(x.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(x.prototype,"geometryType",{get:function(){return I[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(x.prototype,
"renderer",{set:function(a){F.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});x.prototype.readCachedDrawingInfo=function(a,f){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};x.prototype.readObjectIdField=function(a,f){!a&&f.fields&&f.fields.some(function(d){"esriFieldTypeOID"===d.type&&(a=d.name);return!!a});return a||void 0};x.prototype.readProfile=function(a,f){a=f.store.profile;if(null!=a&&L[a])return L[a];D.error("Unknown or missing profile",
{profile:a,layer:this});return"mesh-pyramids"};x.prototype.readNormalReferenceFrame=function(a,f){return f.store.normalReferenceFrame};x.prototype.load=function(){var a=this,f=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return q([a._verifyRootNodeAndUpdateExtent(),a._setCompanionFeatureLayer()])}).then(function(){return a._validateElevationInfo()}).then(function(){return a._applyCompanionOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return M.loadStyleRenderer(a,
{origin:"service"})}).then(function(){return F.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(f);return this.when()};x.prototype.createLayerView=function(a){var d=this;return(null==this.profile||"mesh-pyramids"===this.profile?l.create(function(a){return A(["../views/3d/layers/SceneLayerView3D"],a)}):l.create(function(a){return A(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(f){return new f({view:a,layer:d})})};x.prototype.createQuery=function(){var a=new S;
"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};x.prototype.queryExtent=function(a){var d=this;return this._getAssociatedLayerForQuery().then(function(f){return f.queryExtent(a||d.createQuery())})};x.prototype.queryFeatureCount=function(a){var d=this;return this._getAssociatedLayerForQuery().then(function(f){return f.queryFeatureCount(a||d.createQuery())})};x.prototype.queryFeatures=function(a){var d=this;
return this._getAssociatedLayerForQuery().then(function(f){return f.queryFeatures(a||d.createQuery())}).then(function(a){if(a&&a.features)for(var f=0,c=a.features;f<c.length;f++){var b=c[f];b.layer=d;b.sourceLayer=d}return a})};x.prototype.queryFeaturesJSON=function(a){var d=this;return this._getAssociatedLayerForQuery().then(function(f){return f.queryFeaturesJSON(a||d.createQuery())})};x.prototype.queryObjectIds=function(a){var d=this;return this._getAssociatedLayerForQuery().then(function(f){return f.queryObjectIds(a||
d.createQuery())})};x.prototype.getFieldUsageInfo=function(a){var d={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||d:(D.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),d)};x.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var f=this.associatedLayer;return null!=f?l.resolve(f):l.reject(new m("scenelayer:query-not-available",
"SceneLayer queries are not available without associated feature layer"))};x.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(d){return d.name===a})};x.prototype.queryCachedStatistics=function(a){if(!this.hasCachedStatistics(a))return l.reject(new m("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var d=0,c=this.statisticsInfo;d<c.length;d++){var b=c[d];if(b.name===a)return a=k.join(this.parsedUrl.path,
b.href),v(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};x.prototype.graphicChanged=function(a){this.emit("graphic-update",a)};x.prototype._validateLayer=function(a){if(a.layerType&&-1===E.indexOf(a.layerType))throw new m("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new m("layer:service-version-not-supported","Service version is not supported.",
{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new m("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var d=this.spatialReference,c=!1,b=!1;if(null==a)b=c=!0;else switch(d=d&&d.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;b=d;break;case "vertex-reference-frame":c=!0;b=!d;break;default:c=!1}if(!c)throw new m("scenelayer:unsupported-normal-reference-frame",
"Normal reference frame is invalid.");if(!b)throw new m("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};x.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var d=!(!f.attributeStorageInfo||!f.attributeStorageInfo.some(function(d){return d.name===a.name})),c=!!(f.associatedLayer&&f.associatedLayer.fields&&f.associatedLayer.fields.some(function(d){return d&&a.name===d.name}));
f._fieldUsageInfo[a.name]={supportsLabelingInfo:d,supportsRenderer:d,supportsPopupTemplate:d||c,supportsLayerQuery:c}},f=this,c=0,b=this.fields;c<b.length;c++)a(b[c])};x.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=0,c=this.associatedLayer.fields;a<c.length;a++){var b=c[a];this.getField(b.name)||this.fields.push(b.clone())}a=["popupTemplate","popupEnabled"];c=g.getProperties(this);for(b=0;b<a.length;b++){var r=a[b];this._buddyIsMoreImportant(r)&&
(c.setDefaultOrigin(this.associatedLayer.originOf(r)),c.set(r,this.associatedLayer[r]),c.setDefaultOrigin("user"))}}};x.prototype._setCompanionFeatureLayer=function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(d){a.associatedLayer=d})};x.prototype._fetchCompanionFeatureLayer=function(){var a=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?l.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):
this._fetchCompanionFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(d){null==a.attributeStorageInfo?D.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+a.title):D.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+a.title);return null})};x.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var d=this;return a.fetchRelatedItems({relationshipType:"Service2Service",
direction:"reverse"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===a.type})[0])?d._fetchCompanionFeatureLayerFromPortalItem(new Q({id:a.id,portal:a.portal})):l.reject()}).catch(function(){return d._fetchCompanionFeatureLayerFromUrl()})};x.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var d=this;return a.load().then(function(a){return d._findMatchingCompanionSublayerUrl(a.url)}).then(function(d){return l.resolve(new z({url:d,portalItem:a}))})};x.prototype._fetchCompanionFeatureLayerFromUrl=
function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return l.resolve(new z({url:a}))})};x.prototype._findMatchingCompanionSublayerUrl=function(a){var d=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!d)return l.reject();null==a&&(a=d[1]+"/FeatureServer");var c=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var b=d[1]+"/SceneServer",r=parseInt(d[2],10),d=v(b,a).catch(function(a){return{layers:null}});a=
v(c,a);return q([a,d]).then(function(a){var d=a[0];a=a[1];a=a.data&&a.data.layers;d=d.data&&d.data.layers;if(!Array.isArray(d))throw Error("expected layers array");if(Array.isArray(a))for(var b=0;b<Math.min(a.length,d.length);b++){if(a[b].id===r)return c+"/"+d[b].id}else if(r<d.length)return c+"/"+d[r].id;throw Error("could not find matching associated sublayer");})};x.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var d=t.nameToId(this.originOf(a));a=t.nameToId(this.associatedLayer.originOf(a));
return null!=a&&a<=t.OriginId.SERVICE?null==d||d<t.OriginId.SERVICE:null!=a&&a<=t.OriginId.PORTAL_ITEM?null==d||d<t.OriginId.PORTAL_ITEM:!1};x.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&D.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&D.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};
n([b.shared("esri.layers.SceneLayer")],x.prototype,"declaredClass",void 0);n([b.property({types:{key:"type",base:p.default,typeMap:{selection:c.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],x.prototype,"featureReduction",void 0);n([b.property({type:[P.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],x.prototype,"rangeInfos",
void 0);n([b.property()],x.prototype,"associatedLayer",void 0);n([b.property()],x.prototype,"operationalLayerType",void 0);n([b.property({json:{read:!1},readOnly:!0})],x.prototype,"type",void 0);n([b.property({type:[r]})],x.prototype,"fields",void 0);n([b.property({readOnly:!0})],x.prototype,"attributeStorageInfo",void 0);n([b.property({readOnly:!0})],x.prototype,"statisticsInfo",void 0);n([b.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},
write:{target:"layerDefinition.definitionExpression"}}})],x.prototype,"definitionExpression",void 0);n([b.property({value:null,type:N,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],x.prototype,"elevationInfo",null);n([b.property({type:String,dependsOn:["profile"]})],x.prototype,"geometryType",null);n([b.property(C.labelsVisible)],x.prototype,"labelsVisible",void 0);n([b.property({type:[J],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",
reader:H.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:H.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],x.prototype,"labelingInfo",void 0);n([b.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],x.prototype,"legendEnabled",void 0);n([b.property({types:R.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:O}}},
read:{source:"layerDefinition.drawingInfo.renderer",reader:O},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],x.prototype,"renderer",null);n([b.property({json:{read:!1}})],x.prototype,"cachedDrawingInfo",void 0);n([b.reader("service","cachedDrawingInfo")],x.prototype,"readCachedDrawingInfo",null);n([b.property(C.popupEnabled)],x.prototype,"popupEnabled",void 0);n([b.property({type:e,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],x.prototype,"popupTemplate",void 0);
n([b.property({type:String,json:{read:!1}})],x.prototype,"objectIdField",void 0);n([b.reader("service","objectIdField",["objectIdField","fields"])],x.prototype,"readObjectIdField",null);n([b.property()],x.prototype,"objectIdFilter",void 0);n([b.property({type:String,json:{read:!1}})],x.prototype,"profile",void 0);n([b.reader("service","profile",["store.profile"])],x.prototype,"readProfile",null);n([b.property({readOnly:!0,type:String,json:{read:!1}})],x.prototype,"normalReferenceFrame",void 0);n([b.reader("service",
"normalReferenceFrame",["store.normalReferenceFrame"])],x.prototype,"readNormalReferenceFrame",null);n([b.property(G.screenSizePerspectiveEnabled)],x.prototype,"screenSizePerspectiveEnabled",void 0);return x=n([b.subclass()],x)}(b.declared(B,h))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl".split(" "),
function(A,u,y,a,n,q,e,v,m,w,l,k,b,t,g,z,B,h,C){var G=e.getLogger("esri.layers.mixins.SceneService");return function(e){function c(){var a=null!==e&&e.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}y(c,e);c.prototype.readSpatialReference=function(a,c){return this._readSpatialReference(c)};
c.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return t.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new t(a):null};c.prototype.readFullExtent=function(a,c){a=c.store;c=this._readSpatialReference(c);return null==c||null==a||null==a.extent?null:new k({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:c})};c.prototype.readVersion=function(a,
c){a=c.store;c=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:c};c=c.split(".");2<=c.length&&(a.major=parseInt(c[0],10),a.minor=parseInt(c[1],10));return a};c.prototype.readTitlePortalItem=function(a,c){return"item-title"!==this.sublayerTitleMode?void 0:a};c.prototype.readTitleService=function(a,c){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return C.titleFromUrlAndName(this.url,c.name);c=c.name||C.parse(this.url).title;
"item-title-and-service-name"===this.sublayerTitleMode&&a&&(c=a+" - "+c);return C.cleanTitle(c)};c.prototype.readLayerId=function(a,c){return c.id};Object.defineProperty(c.prototype,"url",{set:function(a){a=C.sanitizeUrlWithLayerId(this,a,G);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});c.prototype.writeUrl=function(a,c){C.writeUrlWithLayerId(this,a,"layers",c)};Object.defineProperty(c.prototype,"parsedUrl",{get:function(){var a=this._get("url");
if(!a)return null;a=w.urlToObject(a);null!=this.layerId&&C.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});c.prototype.readRootNode=function(a,c){return c.store.rootNode};c.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(c){return a._updateExtentFromRootNode(c)})};c.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&
4===a.mbs.length){var c=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=c-a;this.fullExtent.zmax=c+a}};c.prototype._fetchRootNode=function(){if(!this.rootNode)return m.resolve();var a=w.join(this.parsedUrl.path,this.rootNode);return n(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(c){throw new q("sceneservice:root-node-missing","Root node missing.",{error:c,url:a});})};c.prototype._fetchService=function(){var a=this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?
this._fetchFirstLayerId().then(function(c){null!=c&&(a.layerId=c)}):m.resolve()).then(function(){return a._fetchServiceLayer()})};c.prototype._fetchFirstLayerId=function(){return n(this.url,{query:{f:"json"},responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};c.prototype._fetchServiceLayer=function(){var a=this;return n(this.parsedUrl.path,{query:{f:"json"},responseType:"json"}).then(function(c){c.ssl&&(a.url=a.url.replace(/^http:/i,
"https:"));c=c.data;a.read(c,{origin:"service",url:a.parsedUrl});a._validateLayer(c)})};c.prototype._validateLayer=function(a){};a([l.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],c.prototype,"properties",void 0);a([l.property({type:t})],c.prototype,"spatialReference",void 0);a([l.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],c.prototype,"readSpatialReference",null);a([l.property({type:k})],c.prototype,"fullExtent",void 0);a([l.reader("fullExtent",
["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],c.prototype,"readFullExtent",null);a([l.property({readOnly:!0,type:b})],c.prototype,"heightModelInfo",void 0);a([l.property({readOnly:!0})],c.prototype,"version",void 0);a([l.reader("version",["store.version"])],c.prototype,"readVersion",null);a([l.property({type:String,json:{read:{source:"copyrightText"}}})],c.prototype,"copyright",void 0);a([l.property({type:String})],c.prototype,"sublayerTitleMode",void 0);a([l.property({type:String})],
c.prototype,"title",void 0);a([l.reader("portal-item","title")],c.prototype,"readTitlePortalItem",null);a([l.reader("service","title",["name"])],c.prototype,"readTitleService",null);a([l.property({type:Number})],c.prototype,"layerId",void 0);a([l.reader("service","layerId",["id"])],c.prototype,"readLayerId",null);a([l.property()],c.prototype,"url",null);a([l.writer("url")],c.prototype,"writeUrl",null);a([l.property({dependsOn:["layerId"]})],c.prototype,"parsedUrl",null);a([l.property()],c.prototype,
"store",void 0);a([l.property({type:String})],c.prototype,"rootNode",void 0);a([l.reader("rootNode",["store.rootNode"])],c.prototype,"readRootNode",null);return c=a([l.subclass("esri.layers.mixins.SceneService")],c)}(l.declared(g,z,v,B,h))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(A,u,y,a,n,q){Object.defineProperty(u,
"__esModule",{value:!0});A=function(e){function n(){var a=null!==e&&e.apply(this,arguments)||this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";return a}y(n,e);a([q.property({type:String,json:{read:!0,write:!0}})],n.prototype,"name",void 0);a([q.property({type:String,json:{read:!0,write:!0}})],n.prototype,"field",void 0);a([q.property({type:[Number],json:{read:!0,write:!0}})],n.prototype,"currentRangeExtent",void 0);a([q.property({type:[Number],json:{read:!0,
write:!0}})],n.prototype,"fullRangeExtent",void 0);a([q.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],n.prototype,"type",void 0);return n=a([q.subclass("esri.layers.support.RangeInfo")],n)}(q.declared(n));u.RangeInfo=A;u.default=A})},"esri/widgets/Search/SearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Identifiable ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(A,
u,y,a,n,q,e){return function(q){function m(a){a=q.call(this)||this;a.autoNavigate=null;a.filter=null;a.maxResults=null;a.maxSuggestions=null;a.minSuggestCharacters=null;a.outFields=null;a.placeholder="";a.popupEnabled=null;a.popupTemplate=null;a.prefix="";a.resultGraphicEnabled=null;a.resultSymbol=null;a.searchExtent=null;a.suggestionsEnabled=null;a.suffix="";a.withinViewEnabled=!1;a.zoomScale=null;return a}y(m,q);a([e.property()],m.prototype,"autoNavigate",void 0);a([e.property()],m.prototype,"filter",
void 0);a([e.property()],m.prototype,"maxResults",void 0);a([e.property()],m.prototype,"maxSuggestions",void 0);a([e.property()],m.prototype,"minSuggestCharacters",void 0);a([e.property()],m.prototype,"outFields",void 0);a([e.property()],m.prototype,"placeholder",void 0);a([e.property()],m.prototype,"popupEnabled",void 0);a([e.property()],m.prototype,"popupTemplate",void 0);a([e.property()],m.prototype,"prefix",void 0);a([e.property()],m.prototype,"resultGraphicEnabled",void 0);a([e.property()],m.prototype,
"resultSymbol",void 0);a([e.property()],m.prototype,"searchExtent",void 0);a([e.property()],m.prototype,"suggestionsEnabled",void 0);a([e.property()],m.prototype,"suffix",void 0);a([e.property()],m.prototype,"withinViewEnabled",void 0);a([e.property()],m.prototype,"zoomScale",void 0);return m=a([e.subclass("esri.widgets.Search.SearchSource")],m)}(e.declared(q,n))})},"esri/widgets/Search/support/featureLayerUtils":function(){define("require exports dojo/date/locale ../../../core/Error ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../geometry/support/scaleUtils ./geometryUtils".split(" "),
function(A,u,y,a,n,q,e,v,m){function w(a,c){var b=a.filter,e=a.searchExtent;c=c&&c.extent;a=a.withinViewEnabled&&c?c:void 0;return b&&b.geometry||e||a}function l(a){return a?a.load().then(e.resolve).catch(e.reject):e.resolve()}function k(a){return a&&!!a.get("capabilities.query.supportsPagination")}function b(a){var c="";a&&(a=a.fields)&&a.some(function(a){if("string"===a.type)return c=a.name,!0});return c}function t(a,c){return a&&c?c.every(function(c){return!!a.getField(c)}):!1}function g(a){for(var c=
0;c<a.length;c++)if(255<a.charCodeAt(c))return!0;return!1}function z(a,c,b){var e=null;(a=a.codedValues)&&a.some(function(a){var g=a.name,g=b?g:g.toLowerCase();if((b?c:c.toLowerCase())===g)return e=a.code.toString(),!0});return e}function B(a,c){return(c=c&&c.where)?"("+a+") AND ("+c+")":a}function h(a,c,b,e,t){var h=c.definitionExpression,k="";if(a){var l=r.test(c.url)&&g(a)?"N":"";b&&b.forEach(function(b){var g=c.getField(b);b=((b="function"===typeof c.getFieldDomain&&c.getFieldDomain(b))&&"coded-value"===
b.type?z(b,a,t):null)||a||null;if(null!==b){var r=g.type,g=g.name;"string"===r||"date"===r?t?g=B(g+" \x3d "+l+"'"+b+"'",e):(b=b.toUpperCase(),g=B("UPPER("+g+") LIKE "+l+"'%"+b+"%'",e)):"oid"===r||"small-integer"===r||"integer"===r||"single"===r||"double"===r?(b=parseFloat(b),g=isNaN(b)?null:B(g+" \x3d "+b,e)):g=B(g+" \x3d "+b,e);g&&(k+=k?" OR ("+g+")":"("+g+")")}})}return h?"("+h+") AND ("+k+")":k}function C(a,c){var b=null;(a=a.codedValues)&&a.length&&a.some(function(a){if(a.code===c)return b=a.name,
!0});return b}function G(a,c,b){var e=a.layer,g=a.attributes,r="function"===typeof e.getFieldDomain&&e.getFieldDomain(b);return c?n.substitute(g,c):b&&a.hasOwnProperty("attributes")&&g.hasOwnProperty(b)?(a=g[b],b=e.getField(b),r&&"coded-value"===r.type?C(r,a):b&&"date"===b.type?y.format(new Date(a)):b&&"integer"===b.type?a.toString():a):""}function p(a,c,b,e){return a.features.map(function(a){var g=a.attributes[a.layer.objectIdField];return{text:G(a,c.suggestionTemplate,e),key:g,sourceIndex:b}})}
function c(a,c,b,e,g,r,t){return a.features.map(function(a){var k=a.clone(),h=a.layer,h=(h=h&&h.objectIdField)&&a.attributes[h];a=G(a,b.searchTemplate,g);var l=m.createExtentFromGeometry(k.geometry,c,r);return{extent:t?m.scaleExtent(l.clone(),c,t):l,feature:k,key:h,name:a,sourceIndex:e}})}Object.defineProperty(u,"__esModule",{value:!0});var r=/https?:\/\/services.*\.arcgis\.com/i,F=/(?:\{([^}]+)\})/g,J=q.getLogger("esri.widgets.Search.support.featureLayerUtils");u.getResults=function(g){var r=g.exactMatch,
m=void 0===r?!1:r,p=g.location,q=g.maxResults,z=g.spatialReference,n=g.source,F=g.sourceIndex,B=g.suggestResult,u=g.view,y=n.featureLayer,G=n.filter,C=n.zoomScale,H=u&&u.scale,x=w(n,u);return l(y).then(function(){var d=y.objectIdField,f=y.returnZ,g=n.displayField||n.featureLayer.displayField||b(n.featureLayer);if(!y.getField(g))return J.error("invalid-field: displayField is invalid."),e.reject(new a("searchfeaturelayerutils:invalid-field","displayField is invalid."));var r=y.get("popupTemplate.requiredFields"),
r=r&&r.length?r:null,l=(r=n.outFields||r||[g],-1!==r.indexOf("*"));-1!==r.indexOf(d)||l||r.push(d);if(!l&&!t(y,r))return J.error("invalid-field: outField is invalid."),e.reject(new a("searchfeaturelayerutils:invalid-field","outField is invalid."));d=y.createQuery();(l=n.searchQueryParams)&&d.set(l);z&&(d.outSpatialReference=z,l=v.getMetersPerUnitForSR(z))&&(d.maxAllowableOffset=l);l=!!y.get("capabilities.data.supportsZ");d.returnZ=l&&!1!==f;d.returnGeometry=!0;r&&(d.outFields=r);if(p)d.geometry=p;
else if(B.key)d.objectIds=[parseInt(B.key,10)];else{f=n.searchFields||[g];if(!t(y,f))return J.error("invalid-field: search field is invalid."),e.reject(new a("searchfeaturelayerutils:invalid-field","search field is invalid."));k(y)&&(d.num=q);x&&(d.geometry=x);r=B.text.trim();if(!r)return e.resolve();var l=n.prefix,w=n.suffix,r=(""+(void 0===l?"":l)+r+(void 0===w?"":w)).replace(/\'/g,"''"),f=h(r,y,f,G,m);if(!f)return e.resolve();d.where=f}return y.queryFeatures(d).then(function(a){return c(a,u,n,
F,g,H,C)})})};u.getSuggestions=function(c){var g=c.source,r=c.spatialReference,m=c.suggestTerm,n=c.maxSuggestions,q=c.sourceIndex,z=g.featureLayer,B=g.filter,y=w(g,c.view);return l(z).then(function(){if(!k(z))return e.resolve();var c=g.displayField||g.featureLayer.displayField||b(g.featureLayer),l=g.searchFields||[c],u=[];g.suggestionTemplate?g.suggestionTemplate.replace(F,function(a,c){u.push(c);return a}):u.push(c);var w=u&&-1!==u.indexOf("*");-1!==u.indexOf(z.objectIdField)||w||u.push(z.objectIdField);
var v=!!z.getField(c),w=w||t(z,u),x=t(z,l);if(!v)return J.error("invalid-field: displayField is invalid."),e.reject(new a("searchfeaturelayerutils:invalid-field","displayField is invalid."));if(!w)return J.error("invalid-field: outField is invalid."),e.reject(new a("searchfeaturelayerutils:invalid-field","outField is invalid."));if(!x)return J.error("invalid-field: search field is invalid."),e.reject(new a("searchfeaturelayerutils:invalid-field","search field is invalid."));v=z.createQuery();(w=g.suggestQueryParams)&&
v.set(w);v.outSpatialReference=r;v.returnGeometry=!1;v.num=n;v.outFields=u;y&&(v.geometry=y);w=m.trim();if(!w)return e.resolve();var x=g.prefix,d=g.suffix,w=(""+(void 0===x?"":x)+w+(void 0===d?"":d)).replace(/\'/g,"''"),l=h(w,z,l,B,!1);if(!l)return e.resolve();v.where=l;return z.queryFeatures(v).then(function(a){return p(a,g,q,c)})})}})},"esri/widgets/Search/support/geometryUtils":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../views/MapView".split(" "),
function(A,u,y,a,n,q,e,v){function m(a,k,b){var t=a.hasZ?a.z:void 0;return k&&k.map?(b?e.getExtentForScale(k,b):k.extent).clone().centerAt(a).set({zmax:t,zmin:t}):new y.Extent({xmin:a.x-.25,ymin:a.y-.25,xmax:a.x+.25,ymax:a.y+.25,spatialReference:a.spatialReference,zmin:t,zmax:t})}Object.defineProperty(u,"__esModule",{value:!0});var w=n.getLogger("esri.widgets.Search.support.geometryUtils");u.getPointWithElevation=function(e,k){return k?e?e.hasZ||k instanceof v?q.resolve(e):(k=k.get("map.ground"))&&
k.layers.length?k.queryElevation(e).then(function(a){return a.geometry}):q.resolve(e):(w.error("missing-parameter: point is missing."),q.reject(new a("searchgeometryutils:missing-parameter","point is missing."))):(w.error("missing-parameter: view is missing."),q.reject(new a("searchgeometryutils:missing-parameter","view is missing.")))};u.getPointFromGeometry=function(a){if(a instanceof y.Point)return a;if(a instanceof y.Extent)return a.center;if(a instanceof y.Polygon)return a.centroid;if(a instanceof
y.Multipoint)return a.getPoint(0);if(a instanceof y.Polyline)return a.getPoint(0,0)};u.createExtentFromGeometry=function(a,e,b){if(a){if(a instanceof y.Extent)return a;if(a instanceof y.Multipoint||a instanceof y.Polygon||a instanceof y.Polyline)return a.extent;if(a instanceof y.Point)return m(a,e,b)}};u.scaleExtent=function(a,e,b){if(a&&e)return m(a.center,e,b)}})},"esri/widgets/Search/LocatorSearchSource":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/lang ../../core/accessorSupport/decorators ../../tasks/Locator ./SearchSource ./support/locatorUtils".split(" "),
function(A,u,y,a,n,q,e,v,m,w){return function(l){function k(){var a=null!==l&&l.apply(this,arguments)||this;a.categories=null;a.countryCode=null;a.localSearchOptions=null;a.locationToAddressDistance=1500;a.locator=null;a.name="";a.placeholder="";a.searchTemplate="";a.singleLineFieldName=null;a.suggestionsEnabled=null;a.zoomScale=null;return a}y(k,l);b=k;k.prototype.readLocator=function(a,b){return(a=b.url)?new v({url:a}):null};k.prototype.writeLocator=function(a,b){b.url=a?a.url:null};k.prototype.clone=
function(){return new b({autoNavigate:this.autoNavigate,filter:this.filter,maxResults:this.maxResults,maxSuggestions:this.maxSuggestions,minSuggestCharacters:this.minSuggestCharacters,outFields:this.outFields?q.clone(this.outFields):null,placeholder:this.placeholder,popupEnabled:this.popupEnabled,prefix:this.prefix,resultGraphicEnabled:this.resultGraphicEnabled,resultSymbol:this.resultSymbol?this.resultSymbol.clone():null,searchExtent:this.searchExtent?this.searchExtent.clone():null,suggestionsEnabled:this.suggestionsEnabled,
suffix:this.suffix,withinViewEnabled:this.withinViewEnabled,categories:this.categories?q.clone(this.categories):null,countryCode:this.countryCode,localSearchOptions:this.localSearchOptions?q.clone(this.localSearchOptions):null,locationToAddressDistance:this.locationToAddressDistance,locator:this.locator,searchTemplate:this.searchTemplate,singleLineFieldName:this.singleLineFieldName,zoomScale:this.zoomScale})};k.prototype.getResults=function(a){return w.getResults(n({source:this},a))};k.prototype.getSuggestions=
function(a){return w.getSuggestions(n({source:this},a))};var b;a([e.property()],k.prototype,"categories",void 0);a([e.property()],k.prototype,"countryCode",void 0);a([e.property()],k.prototype,"localSearchOptions",void 0);a([e.property()],k.prototype,"locationToAddressDistance",void 0);a([e.property({type:v})],k.prototype,"locator",void 0);a([e.reader("locator",["url"])],k.prototype,"readLocator",null);a([e.writer("locator")],k.prototype,"writeLocator",null);a([e.property({json:{write:!0}})],k.prototype,
"name",void 0);a([e.property({json:{write:!0}})],k.prototype,"placeholder",void 0);a([e.property()],k.prototype,"searchTemplate",void 0);a([e.property({json:{write:!0}})],k.prototype,"singleLineFieldName",void 0);a([e.property({json:{read:{source:"suggest"},write:{target:"suggest"}}})],k.prototype,"suggestionsEnabled",void 0);a([e.property({json:{write:!0}})],k.prototype,"zoomScale",void 0);return k=b=a([e.subclass("esri.widgets.Search.LocatorSearchSource")],k)}(e.declared(m))})},"esri/tasks/Locator":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper ../request ../core/accessorSupport/decorators ../geometry/SpatialReference ./Task ./support/AddressCandidate".split(" "),
function(A,u,y,a,n,q,e,v,m,w){return function(l){function k(a){a=l.call(this,a)||this;a.categories=null;a.countryCode=null;a.outSpatialReference=null;a.url=null;return a}y(k,l);k.prototype.addressToLocations=function(a,e){var b=a.address,k=a.categories,t=a.countryCode,h=a.distance,l=a.forStorage,m=a.location,p=a.magicKey,c=a.maxLocations,r=a.outFields;a=a.searchExtent;var F=m?m.clone().normalize():null,w=a?a.shiftCentralMeridian():null,v=this.outSpatialReference,m=this.parsedUrl;a=this.requestOptions;
k={f:"json",outSR:v?JSON.stringify(v.toJSON()):null,outFields:r?r.join(","):null,searchExtent:w?JSON.stringify(w.toJSON()):null,category:k?k.join(","):null,countryCode:t||null,magicKey:p||null,distance:h||null,location:F,maxLocations:c||null,forStorage:l||null};b={query:this._encode(n({},m.query,b,k))};e=n({},a,e,b);return q(m.path+"/findAddressCandidates",e).then(this._handleAddressToLocationsResponse)};k.prototype.suggestLocations=function(a,e){var b=this.parsedUrl,k=this.requestOptions,t=a.location,
h=a.searchExtent,t=t?t.clone().normalize():null,h=h?h.shiftCentralMeridian():null;a={f:"json",text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:h?JSON.stringify(h.toJSON()):null,category:a.categories?a.categories.join(","):null,countryCode:a.countryCode||null,location:t,distance:a.distance||null};a={query:this._encode(n({},b.query,a))};e=n({},k,e,a);return q(b.path+"/suggest",e).then(this._handleSuggestLocationsResponse)};k.prototype.addressesToLocations=function(a,e){var b=this.outSpatialReference,
k=this.parsedUrl,t=this.requestOptions,h=a.addresses,l=a.categories;a=a.countryCode;var m=[];Array.isArray(h)&&h.forEach(function(a){m.push({attributes:a})});b={category:l?l.join(","):null,sourceCountry:a||null,addresses:JSON.stringify({records:m}),f:"json",outSR:b?JSON.stringify(b):null};b={query:this._encode(n({},k.query,b))};e=n({},t,e,b);return q(k.path+"/geocodeAddresses",e).then(this._handleAddressesToLocationsResponse)};k.prototype.locationToAddress=function(a,e,g){var b=a?a.clone().normalize():
null,k="undefined"!==typeof b,h="undefined"!==typeof e&&k,t=this.outSpatialReference;a=this.parsedUrl;var l=this.requestOptions;e={outSR:t?JSON.stringify(t.toJSON()):null,location:k?JSON.stringify(b.toJSON()):null,distance:h?e:null,f:"json"};e={query:this._encode(n({},a.query,e))};g=n({},l,g,e);return q(a.path+"/reverseGeocode",g).then(this._handleLocationToAddressResponse)};k.prototype._handleAddressToLocationsResponse=function(a){a=a.data;if(!a)return[];var b=a.candidates,e=a.spatialReference;return b?
b.map(function(a){if(a){var b=a.extent,g=a.location,k=b?b&&"number"===typeof b.xmin&&"number"===typeof b.ymin&&"number"===typeof b.xmax&&"number"===typeof b.ymax:!0;if(g&&"number"===typeof g.x&&"number"===typeof g.x&&k)return b&&(b.spatialReference=e),g.spatialReference=e,w.fromJSON(a)}}):[]};k.prototype._handleSuggestLocationsResponse=function(a){return(a=a.data)?a.suggestions||[]:[]};k.prototype._handleAddressesToLocationsResponse=function(a){a=a.data;if(!a)return[];var b=a.locations,e=a.spatialReference;
return b?b.map(function(a){var b=a.location;b&&(b.spatialReference=e);return w.fromJSON(a)}):[]};k.prototype._handleLocationToAddressResponse=function(a){if(a=a.data){var b=a.address;return w.fromJSON({address:b&&b.Match_addr||"",attributes:b||{},location:a.location,score:100})}};a([e.property()],k.prototype,"categories",void 0);a([e.property()],k.prototype,"countryCode",void 0);a([e.property({type:v})],k.prototype,"outSpatialReference",void 0);a([e.property()],k.prototype,"url",void 0);return k=
a([e.subclass("esri.tasks.Locator")],k)}(e.declared(m))})},"esri/tasks/support/AddressCandidate":function(){define(["../../core/JSONSupport","../../geometry/Extent","../../geometry/Point"],function(A,u,y){return A.createSubclass({declaredClass:"esri.tasks.support.AddressCandidate",properties:{address:{value:null,json:{write:!0}},attributes:{value:null,json:{write:!0}},extent:{value:null,type:u,json:{write:!0}},location:{value:null,type:y,json:{write:!0}},score:{value:null,json:{write:!0}}}})})},"esri/widgets/Search/support/locatorUtils":function(){define(["require",
"exports","../../../Graphic","../../../core/promiseUtils","./geometryUtils"],function(A,u,y,a,n){function q(a){var b=a.source,e=a.spatialReference,g=a.location,k=a.distance,l=a.sourceIndex,h=a.view;a=b.locator;var m=b.zoomScale,n=h&&h.scale;e&&(a.outSpatialReference=e);return a.locationToAddress(g,k).then(function(a){return w([a],{sourceIndex:l,scale:n,view:h,zoomScale:m})})}function e(a,b){var e=a.filter,g=a.searchExtent;a=a.withinViewEnabled;var k=b&&b.extent;return(b=n.createExtentFromGeometry(e&&
e.geometry,b,b&&b.scale))||g||(a&&k?k:void 0)}function v(k){var b=k.source,m=k.suggestResult,g=k.spatialReference,n=k.view,q=k.maxResults,h=k.sourceIndex,v=b&&b.zoomScale;k=m.text.trim();if(!k)return a.resolve();k=""+(!m.key&&b.prefix?b.prefix:"")+k+(!m.key&&b.suffix?b.suffix:"");var u={},p=b.locator,c=n&&n.scale,r=e(b,n);if(!p)return a.resolve();b.categories&&(u.categories=b.categories);g&&(p.outSpatialReference=g);if(g=l(n,b,c))u.location=g.location,u.distance=g.distance;u.maxLocations=q;r&&(u.searchExtent=
r);b.countryCode&&(u.countryCode=b.countryCode);var F=m.key;F&&(u.magicKey=F);u.address={};u.address[b.singleLineFieldName||"Single Line Input"]=k;b.outFields&&(u.outFields=b.outFields);return p.addressToLocations(u).then(function(a){return w(a,{key:F,scale:c,sourceIndex:h,view:n,zoomScale:v})})}function m(a,b){return a.map(function(a){return{text:a.text,key:a.magicKey,sourceIndex:b}})}function w(a,b){return a.map(function(a){var e=b.key,k=b.scale,m=b.sourceIndex,h=b.view,l=b.zoomScale,q=a.extent,
p=a.location,c=a.address;a=new y({geometry:p,attributes:a.attributes});k=n.createExtentFromGeometry(q||p,h,k);h=l?n.scaleExtent(k,h,l):k;p=p?p.x+","+p.y:"";return{extent:h,feature:a,key:e,name:c||p,sourceIndex:m}})}function l(a,b,e){var g=b.localSearchOptions;if(a&&g&&g.hasOwnProperty("distance")&&g.hasOwnProperty("minScale")&&(b=g.minScale,g=g.distance,!b||e&&e<=b))return{location:a.get("extent.center"),distance:g}}Object.defineProperty(u,"__esModule",{value:!0});u.getResults=function(a){return a.location?
q(a):v(a)};u.getSuggestions=function(k){var b=k.source,n=k.spatialReference,g=k.view,q=k.suggestTerm,u=k.maxSuggestions,h=k.sourceIndex;k={};var v=b.locator,w=g&&g.scale,p=e(b,g);if(!v)return a.resolve();b.categories&&(k.categories=b.categories);v.outSpatialReference=n;if(n=l(g,b,w))k.location=n.location,k.distance=n.distance;q=q.trim();if(!q)return a.resolve();n=b.prefix;g=b.suffix;k.text=""+(void 0===n?"":n)+q+(void 0===g?"":g);p&&(k.searchExtent=p);k.maxSuggestions=u;b.countryCode&&(k.countryCode=
b.countryCode);return v.suggestLocations(k).then(function(a){return m(a,h)})};u.isArcGISWorldGeocoder=function(a){return a?/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(a)||/(?:\/servers\/[\da-z\.-]+\/rest\/services\/world\/geocodeserver).*/gi.test(a):!1}})},"*now":function(A){A(['dojo/i18n!*preload*esri/widgets/nls/Search*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},
"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!../nls/common dojo/i18n!./Search/nls/Search dojo/keys dojo/query dojo/regexp ../PopupTemplate ../core/Handles ../core/lang ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Search/SearchResultRenderer ./Search/SearchViewModel ./support/widget".split(" "),function(A,u,y,a,n,q,e,v,m,w,l,k,b,t,g,z,B,h){var C=/<[a-z/][\s\S]*>/i;return function(g){function p(a){a=g.call(this)||this;
a._handles=new l;a._inputNode=null;a._sourceMenuButtonNode=null;a._sourceListNode=null;a._suggestionListNode=null;a._searchResultRenderer=new z({container:document.createElement("div")});a._suggestPromise=null;a._popupTemplate=new w({title:q.searchResult,content:a._renderSearchResultsContent.bind(a)});a._relatedTarget=null;a.activeMenu="none";a.activeSource=null;a.activeSourceIndex=null;a.allPlaceholder=null;a.autoNavigate=null;a.autoSelect=null;a.goToOverride=null;a.iconClass="esri-icon-search";
a.includeDefaultSources=null;a.label=q.widgetLabel;a.locationEnabled=null;a.locationToAddressDistance=null;a.maxResults=null;a.maxSuggestions=null;a.minSuggestCharacters=null;a.popupEnabled=null;a.popupTemplate=null;a.portal=null;a.resultGraphic=null;a.resultGraphicEnabled=null;a.results=null;a.searchAllEnabled=null;a.searchTerm=null;a.selectedResult=null;a.sources=null;a.suggestions=null;a.suggestionsEnabled=null;a.view=null;a.viewModel=new B;return a}y(p,g);p.prototype.postInitialize=function(){var a=
this;this.viewModel.popupTemplate=this._popupTemplate;this.own(b.watch(this,"searchTerm",function(c){if(c&&"warning"===a.activeMenu||!c&&!a.get("viewModel.selectedSuggestion.location"))a.activeMenu="none"}),b.on(this,"viewModel.allSources","change",function(){return a._watchSourceChanges()}))};p.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._cancelSuggest();this._searchResultRenderer&&(this._searchResultRenderer.viewModel=null,this._searchResultRenderer.destroy(),this._searchResultRenderer=
null)};p.prototype.clear=function(){};p.prototype.focus=function(){this._inputNode&&(this.activeMenu="suggestion",this._inputNode.focus(),this.emit("search-focus"))};p.prototype.blur=function(a){this._inputNode&&(this._inputNode.blur(),this._inputBlur(a),this.emit("search-blur"))};p.prototype.search=function(a){var c=this;this.activeMenu="none";this._cancelSuggest();return this.viewModel.search(a).catch(function(a){c.activeMenu="none";return a}).then(function(a){c.activeMenu=a.numResults?"none":"warning";
return a})};p.prototype.suggest=function(a){var c=this;this._cancelSuggest();return this._suggestPromise=a=this.viewModel.suggest(a).then(function(a){a.numResults&&(c.activeMenu="suggestion");c._scrollToTopSuggestion();return a}).catch(function(){return null})};p.prototype.render=function(){var a=this,b,e,g=this.viewModel,l=g.activeSourceIndex,m=g.suggestions,p=g.maxInputLength,t=g.placeholder,u=g.searchTerm,v=g.searchAllEnabled,w=g.allSources,z=this._getSourceName(l),y=(""+u).trim(),A=this.activeMenu,
D=this.id,C=this.viewModel.state,I=this.id+"-suggest-menu",p=h.tsx("input",{bind:this,placeholder:t,"aria-label":q.searchButtonTitle,maxlength:p,autocomplete:"off",type:"text",tabindex:"0",class:this.classes("esri-input","esri-search__input"),"aria-autocomplete":"list",value:u,"aria-haspopup":"true","aria-owns":I,role:"textbox",onkeydown:this._handleInputKeydown,onkeyup:this._handleInputKeyup,onclick:this._handleInputClick,oninput:this._handleInputPaste,onpaste:this._handleInputPaste,afterCreate:h.storeNode,
"data-node-ref":"_inputNode",onfocusout:this._storeRelatedTarget,onfocus:this.focus,onblur:this.blur,title:u?"":t}),p=h.tsx("form",{key:"esri-search__form",bind:this,class:"esri-search__form",onsubmit:this._formSubmit,role:"search"},p),t=u?h.tsx("div",{key:"esri-search__clear-button",bind:this,role:"button",class:this.classes("esri-search__clear-button","esri-widget--button"),tabindex:"0",title:q.clearButtonTitle,onfocus:this._clearButtonFocus,onclick:this._handleClearButtonClick,onkeydown:this._handleClearButtonClick},
h.tsx("span",{"aria-hidden":"true",class:"esri-icon-close"})):null,G=this.locationEnabled&&!y?h.tsx("ul",{key:"esri-search__suggestion-list-current-location",class:this.classes("esri-search__suggestions-list","esri-search__suggestions-list--current-location")},h.tsx("li",{bind:this,onclick:this._handleUseCurrentLocationClick,onkeydown:this._handleUseCurrentLocationClick,onkeyup:this._handleSuggestionKeyup,role:"menuitem",tabindex:"-1"},h.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-locate-circled"}),
" ",q.useCurrentLocation)):null,x=1<w.length&&l===B.ALL_INDEX,l=m?m.map(function(c,b){var d=c.sourceIndex,e=c.results.length;b=e&&x?a._getSuggestionHeaderNode(d):null;c=c.results.map(function(c,b){return a._getSuggestionNode(c,b,d)});c=e?h.tsx("ul",{key:"esri-search__suggestion-list-"+d,class:"esri-search__suggestions-list"},c):null;return[b,c]}):null,I=h.tsx("div",{id:I,"aria-expanded":"suggestion"===A,key:"esri-search__suggestions-menu",class:this.classes("esri-menu","esri-search__suggestions-menu"),
role:"menu",bind:this,afterCreate:h.storeNode,"data-node-ref":"_suggestionListNode"},G,l),I=h.tsx("div",{key:"esri-search__input-container",class:"esri-search__input-container"},p,I,t),l=h.tsx("div",{key:"esri-search__submit-button",bind:this,role:"button",title:q.searchButtonTitle,class:this.classes("esri-search__submit-button","esri-widget--button"),tabindex:"0",onclick:this._handleSearchButtonClick,onkeydown:this._handleSearchButtonClick},h.tsx("span",{"aria-hidden":"true",role:"presentation",
class:"esri-icon-search"}),h.tsx("span",{class:"esri-icon-font-fallback-text"},q.searchButtonTitle)),u=y?k.substitute({value:'"'+u+'"'},q.noResultsFoundForValue):q.noResultsFound,u=g.get("selectedSuggestion.location")||y?h.tsx("div",{key:"esri-search__no_results"},h.tsx("div",{class:"esri-search__warning-header"},q.noResults),h.tsx("div",{class:"esri-search__warning-text"},u)):null,g=g.get("selectedSuggestion.location")||y?null:h.tsx("div",{key:"esri-search__empty-search"},h.tsx("span",{"aria-hidden":"true",
class:"esri-icon-notice-triangle"}),h.tsx("span",{class:"esri-search__no-value-text"},q.emptyValue)),g=h.tsx("div",{key:"esri-search__error-menu",class:this.classes("esri-menu","esri-search__warning-menu")},h.tsx("div",{class:"esri-search__warning-body"},u,g)),y=1<w.length,w=w&&w.toArray(),v=v?this._getSourceNode(B.ALL_INDEX):null,D=D+"-source-menu",z=y?h.tsx("div",{key:"esri-search__source-menu-button",bind:this,role:"button",title:q.searchIn,"aria-haspopup":"true","aria-expanded":"source"===A,"aria-controls":D,
class:this.classes("esri-search__sources-button","esri-widget--button"),tabindex:"0",onkeydown:this._handleSourceMenuButtonKeydown,onclick:this._handleSourcesMenuToggleClick,onkeyup:this._handleSourceMenuButtonKeyup,onblur:this._sourcesButtonBlur,afterCreate:h.storeNode,"data-node-ref":"_sourceMenuButtonNode"},h.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-down-arrow esri-search__sources-button--down"}),h.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-icon-up-arrow esri-search__sources-button--up"}),
h.tsx("span",{class:"esri-search__source-name"},z)):null,v=y?h.tsx("ul",{bind:this,afterCreate:h.storeNode,"data-node-ref":"_sourceListNode"},v,w.map(function(c,b){return a._getSourceNode(b)})):null,D=h.tsx("div",{id:D,key:"esri-search__source-menu",class:this.classes("esri-menu","esri-search__sources-menu"),role:"menu"},v),A=(b={},b["esri-search--multiple-sources"]=y,b["esri-search--loading"]="loading"===C,b["esri-search--searching"]="searching"===C,b["esri-search--warning"]="warning"===A,b["esri-search--sources"]=
"source"===A,b["esri-search--show-suggestions"]="suggestion"===A,b);b=(e={},e["esri-disabled"]="disabled"===C,e);e="loading"===C?h.tsx("div",{role:"presentation",class:"esri-widget__loader",key:"base-loader"},h.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-widget__loader-animation"}),h.tsx("span",{class:"esri-icon-font-fallback-text"},q.searchButtonTitle),h.tsx("span",{class:"esri-widget__loader-text"},n.loading)):h.tsx("div",{role:"presentation",class:this.classes(A,"esri-search__container"),
key:"base-container"},z,D,I,l,g);return h.tsx("div",{class:this.classes("esri-search esri-widget",b)},e)};p.prototype._watchSourceChanges=function(){var a=this,e=this._handles,g=this.viewModel.allSources;e.remove("sources");g.forEach(function(c){return e.add(b.watch(c,"name",function(){return a.scheduleRender()}),"sources")})};p.prototype._handleSourceMenuButtonKeydown=function(a){var c=a.keyCode;c===e.UP_ARROW||c===e.DOWN_ARROW||c===e.END||c===e.HOME?(a.preventDefault(),a.stopPropagation(),this.activeMenu=
"source"):this._handleSourcesMenuToggleClick(a)};p.prototype._handleSourcesMenuToggleClick=function(a){var c="source"===this.activeMenu;this.activeMenu=c?"none":"source";this.renderNow();c?this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus():(c=this._sourceListNode?v("li",this._sourceListNode):null)&&(a=a.keyCode===e.END?c[c.length-1]:c[0])&&a.focus()};p.prototype._handleClearButtonClick=function(){this.viewModel.clear();this._focus()};p.prototype._handleSearchButtonClick=function(){this.search()};
p.prototype._handleSuggestionClick=function(a){if(a=a.currentTarget["data-suggestion"])this._focus(),this.search(a)};p.prototype._handleUseCurrentLocationClick=function(){this._focus("none");this.viewModel.searchNearby()};p.prototype._handleSourceClick=function(a){this.viewModel.activeSourceIndex=a.currentTarget["data-source-index"];this._focus("none")};p.prototype._sourcesButtonBlur=function(a){this._removeActiveMenu(a&&a.relatedTarget,this._sourceListNode)};p.prototype._inputBlur=function(a){a=
a&&a.relatedTarget;this._removeActiveMenu(a?a:this._relatedTarget,this._suggestionListNode)};p.prototype._storeRelatedTarget=function(a){this._relatedTarget=a.relatedTarget};p.prototype._clearButtonFocus=function(){this.activeMenu="none"};p.prototype._removeActiveMenu=function(a,b){a&&b&&b.contains(a)||(this.activeMenu="none")};p.prototype._cancelSuggest=function(){var a=this._suggestPromise;a&&a.cancel();this._suggestPromise=null};p.prototype._handleInputKeydown=function(a){var c=a.keyCode;(c===
e.TAB||c===e.ESCAPE||a.shiftKey&&c===e.TAB)&&this._cancelSuggest()};p.prototype._handleInputKeyup=function(a){var c=a.keyCode,b=a.ctrlKey||a.metaKey||c===e.copyKey||c===e.LEFT_ARROW||c===e.RIGHT_ARROW||c===e.ENTER||c===e.SHIFT,g=this._suggestionListNode?v("li",this._suggestionListNode):null;b||(c===e.TAB||c===e.ESCAPE||a.shiftKey&&c===e.TAB?(this._cancelSuggest(),c===e.ESCAPE&&(this.activeMenu="none")):c!==e.UP_ARROW&&c!==e.DOWN_ARROW||!g?this.viewModel.searchTerm&&this.suggest():(this.activeMenu=
"suggestion",a.stopPropagation(),a.preventDefault(),this._cancelSuggest(),(a=g[c===e.UP_ARROW?g.length-1:0])&&a.focus()))};p.prototype._scrollToTopSuggestion=function(){this._suggestionListNode&&(this._suggestionListNode.scrollTop=0)};p.prototype._handleInputClick=function(a){this.activeMenu="suggestion"};p.prototype._handleInputPaste=function(a){var c=this.get("viewModel.searchTerm");a=a.target;c!==a.value&&(this.viewModel.searchTerm=a.value);c&&this.suggest()};p.prototype._handleSourceMenuButtonKeyup=
function(a){var c=a.keyCode;if(c===e.UP_ARROW||c===e.DOWN_ARROW||c===e.HOME||c===e.END)a.stopPropagation(),a.preventDefault(),(a=this._sourceListNode?v("li",this._sourceListNode):null)&&(c=a[c===e.UP_ARROW||c===e.END?a.length-1:0])&&c.focus()};p.prototype._handleSourceKeyup=function(a){var c=a.target,b=this._sourceListNode?v("li",this._sourceListNode):null,g=a.keyCode;if(g===e.ESCAPE)this._focus("none"),this._sourceMenuButtonNode&&this._sourceMenuButtonNode.focus();else if(b){c=b.indexOf(c);if(g===
e.HOME||g===e.END||g===e.UP_ARROW||g===e.DOWN_ARROW)a.stopPropagation(),a.preventDefault();g===e.HOME?(b=b[0])&&b.focus():g===e.END?(b=b[b.length-1])&&b.focus():g===e.UP_ARROW?(a=c-1,(b=0>a?this._sourceMenuButtonNode:b[a])&&b.focus()):g===e.DOWN_ARROW&&(a=c+1,(b=a>=b.length?this._sourceMenuButtonNode:b[a])&&b.focus())}};p.prototype._handleSuggestionKeyup=function(a){var b=a.target,c=this._suggestionListNode?v("li",this._suggestionListNode):null,b=c.indexOf(b),g=a.keyCode;this._cancelSuggest();if(g===
e.BACKSPACE||g===e.DELETE)this._focus();else if(g===e.ESCAPE)this._focus("none");else if(c){if(g===e.HOME||g===e.END||g===e.UP_ARROW||g===e.DOWN_ARROW)a.stopPropagation(),a.preventDefault();g===e.HOME&&(a=c[0])&&a.focus();g===e.END&&(a=c[c.length-1])&&a.focus();g===e.UP_ARROW?(--b,(c=0>b?c[c.length-1]:c[b])&&c.focus()):g===e.DOWN_ARROW&&(b+=1,(c=b>=c.length?c[0]:c[b])&&c.focus())}};p.prototype._focus=function(a){this.focus();a&&(this.activeMenu=a)};p.prototype._formSubmit=function(a){a.preventDefault();
this.search()};p.prototype._getSourceName=function(a){var b=this.viewModel.allSources.getItemAt(a);return a===B.ALL_INDEX?q.all:b?b.name||q.untitledSource:q.untitledSource};p.prototype._getSuggestionHeaderNode=function(a){var b=this._getSourceName(a);return h.tsx("div",{key:"esri-search__suggestion-header-"+a,class:"esri-header"},b)};p.prototype._splitResult=function(a,b){b=m.escapeString(b);return a.replace(new RegExp("(^|)("+b+")(|$)","ig"),"$1|$2|$3").split("|")};p.prototype._getSuggestionNode=
function(a,b,e){if(e=this.viewModel.searchTerm){var c=a.text||q.untitledResult,g=[];if(C.test(c))g.push(h.tsx("div",{innerHTML:c}));else{var c=this._splitResult(c,e),k=e.toLowerCase();c.forEach(function(a,b){a&&a.length&&(a.toLowerCase()===k?g.push(h.tsx("strong",{key:b},a)):g.push(a))})}return h.tsx("li",{bind:this,onclick:this._handleSuggestionClick,onkeydown:this._handleSuggestionClick,onkeyup:this._handleSuggestionKeyup,key:"esri-search__suggestion$-{sourceIndex}_"+b,"data-suggestion":a,role:"menuitem",
tabindex:"-1"},g)}};p.prototype._getSourceNode=function(a){var b,c=(b={},b["esri-search__source--active"]=a===this.viewModel.activeSourceIndex,b);return h.tsx("li",{bind:this,key:"esri-search__source-"+a,onclick:this._handleSourceClick,onkeydown:this._handleSourceClick,onkeyup:this._handleSourceKeyup,"data-source-index":a,role:"menuitem",class:this.classes("esri-search__source",c),tabindex:"-1"},this._getSourceName(a))};p.prototype._renderSearchResultsContent=function(){this._searchResultRenderer.showMoreResultsOpen=
!1;this._searchResultRenderer.viewModel=this.viewModel;return this._searchResultRenderer};a([t.property(),h.renderable()],p.prototype,"activeMenu",void 0);a([t.aliasOf("viewModel.activeSource"),h.renderable()],p.prototype,"activeSource",void 0);a([t.aliasOf("viewModel.activeSourceIndex"),h.renderable()],p.prototype,"activeSourceIndex",void 0);a([t.aliasOf("viewModel.allPlaceholder"),h.renderable()],p.prototype,"allPlaceholder",void 0);a([t.aliasOf("viewModel.autoNavigate")],p.prototype,"autoNavigate",
void 0);a([t.aliasOf("viewModel.autoSelect")],p.prototype,"autoSelect",void 0);a([t.aliasOf("viewModel.goToOverride")],p.prototype,"goToOverride",void 0);a([t.property()],p.prototype,"iconClass",void 0);a([t.aliasOf("viewModel.includeDefaultSources")],p.prototype,"includeDefaultSources",void 0);a([t.property()],p.prototype,"label",void 0);a([h.renderable(),t.aliasOf("viewModel.locationEnabled")],p.prototype,"locationEnabled",void 0);a([t.aliasOf("viewModel.locationToAddressDistance")],p.prototype,
"locationToAddressDistance",void 0);a([t.aliasOf("viewModel.maxResults")],p.prototype,"maxResults",void 0);a([t.aliasOf("viewModel.maxSuggestions")],p.prototype,"maxSuggestions",void 0);a([t.aliasOf("viewModel.minSuggestCharacters")],p.prototype,"minSuggestCharacters",void 0);a([t.aliasOf("viewModel.popupEnabled")],p.prototype,"popupEnabled",void 0);a([t.aliasOf("viewModel.popupTemplate")],p.prototype,"popupTemplate",void 0);a([t.aliasOf("viewModel.portal")],p.prototype,"portal",void 0);a([t.aliasOf("viewModel.resultGraphic")],
p.prototype,"resultGraphic",void 0);a([t.aliasOf("viewModel.resultGraphicEnabled")],p.prototype,"resultGraphicEnabled",void 0);a([t.aliasOf("viewModel.results"),h.renderable()],p.prototype,"results",void 0);a([t.aliasOf("viewModel.searchAllEnabled"),h.renderable()],p.prototype,"searchAllEnabled",void 0);a([t.aliasOf("viewModel.searchTerm"),h.renderable()],p.prototype,"searchTerm",void 0);a([t.aliasOf("viewModel.selectedResult")],p.prototype,"selectedResult",void 0);a([t.aliasOf("viewModel.sources")],
p.prototype,"sources",void 0);a([t.aliasOf("viewModel.suggestions"),h.renderable()],p.prototype,"suggestions",void 0);a([t.aliasOf("viewModel.suggestionsEnabled")],p.prototype,"suggestionsEnabled",void 0);a([t.aliasOf("viewModel.view"),h.renderable()],p.prototype,"view",void 0);a([h.vmEvent("search-complete search-clear search-start select-result suggest-start suggest-complete".split(" ")),t.property({type:B}),h.renderable(["viewModel.allSources","viewModel.activeSource.placeholder","viewModel.activeSource.name",
"viewModel.state"])],p.prototype,"viewModel",void 0);a([t.aliasOf("viewModel.clear")],p.prototype,"clear",null);a([h.accessibleHandler()],p.prototype,"_handleSourcesMenuToggleClick",null);a([h.accessibleHandler()],p.prototype,"_handleClearButtonClick",null);a([h.accessibleHandler()],p.prototype,"_handleSearchButtonClick",null);a([h.accessibleHandler()],p.prototype,"_handleSuggestionClick",null);a([h.accessibleHandler()],p.prototype,"_handleUseCurrentLocationClick",null);a([h.accessibleHandler()],
p.prototype,"_handleSourceClick",null);return p=a([t.subclass("esri.widgets.Search")],p)}(t.declared(g))});