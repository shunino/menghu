// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/Legend/LegendViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./support/ActiveLayerInfo".split(" "),function(A,c,a,h,d,l,m,q,y,x){var p=l.ofType(x),C="esri.layers.CSVLayer esri.layers.FeatureLayer esri.layers.HeatmapLayer esri.layers.MapImageLayer esri.layers.MapNotesLayer esri.layers.PointCloudLayer esri.layers.TileLayer esri.layers.StreamLayer esri.layers.SceneLayer esri.layers.GeoRSSLayer esri.layers.GroupLayer esri.layers.ImageryLayer esri.layers.WMSLayer esri.layers.WMTSLayer".split(" "),
z=["view.basemapView.baseLayerViews","view.groundView.layerViews","view.layerViews","view.basemapView.referenceLayerViews"];return function(d){function b(e){e=d.call(this,e)||this;e._handles=new m;e._layerViewByLayerId={};e._layerInfosByLayerViewId={};e._activeLayerInfosByLayerViewId={};e.activeLayerInfos=new p;e.basemapLegendVisible=!1;e.groundLegendVisible=!1;e.layerInfos=[];e.view=null;return e}a(b,d);b.prototype.initialize=function(){this._handles.add(q.init(this,"view",this._viewHandles),"view")};
b.prototype.destroy=function(){this._destroyViewActiveLayerInfos();this._handles.destroy();this.view=this._handles=null};Object.defineProperty(b.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});b.prototype._viewHandles=function(){this._handles.remove("state");this.view&&this._handles.add(q.init(this,"state",this._stateHandles),"state")};b.prototype._stateHandles=function(){this._resetAll();"ready"===this.state&&this._watchPropertiesAndAllLayerViews()};
b.prototype._resetAll=function(){this._handles.remove(["all-layer-views","legend-properties"]);this._destroyViewActiveLayerInfos();this.activeLayerInfos.removeAll()};b.prototype._destroyViewActiveLayerInfos=function(){Object.keys(this._activeLayerInfosByLayerViewId).forEach(this._destroyViewActiveLayerInfo,this)};b.prototype._destroyViewActiveLayerInfo=function(e){this._handles.remove(e);delete this._activeLayerInfosByLayerViewId[e]};b.prototype._watchPropertiesAndAllLayerViews=function(){var e=this.view.allLayerViews;
e.length&&this._refresh();this._handles.add(e.on("change",this._allLayerViewsChangeHandle.bind(this)),"all-layer-views");this._handles.add(q.watch(this,"layerInfos, basemapLegendVisible, groundLegendVisible",this._propertiesChangeHandle.bind(this)),"legend-properties")};b.prototype._allLayerViewsChangeHandle=function(e){var b=this;e.removed.forEach(function(e){return b._destroyViewActiveLayerInfo(e.uid)});this._refresh()};b.prototype._propertiesChangeHandle=function(){this._destroyViewActiveLayerInfos();
this._refresh()};b.prototype._refresh=function(){this._layerInfosByLayerViewId={};this.activeLayerInfos.removeAll();this._generateLayerViews().filter(this._filterLayerViewsByLayerInfos,this).filter(this._isLayerViewSupported,this).forEach(this._generateActiveLayerInfo,this);this._sortActiveLayerInfos(this.activeLayerInfos)};b.prototype._sortActiveLayerInfos=function(e){var b={};this.view.allLayerViews.forEach(function(e,a){return b[e.layer.uid]=a});e.sort(function(e,a){return(b[a.layer.uid]||0)-(b[e.layer.uid]||
0)})};b.prototype._generateLayerViews=function(){var e=[];z.filter(this._filterLayerViews,this).map(this.get,this).filter(function(e){return null!=e}).forEach(this._collectLayerViews("layerViews",e));return e};b.prototype._filterLayerViews=function(e){var b=!this.groundLegendVisible&&"view.groundView.layerViews"===e;return!(!this.basemapLegendVisible&&("view.basemapView.baseLayerViews"===e||"view.basemapView.referenceLayerViews"===e))&&!b};b.prototype._collectLayerViews=function(e,b){var a=function(g){g&&
g.forEach(function(f){b.push(f);a(f[e])});return b};return a};b.prototype._filterLayerViewsByLayerInfos=function(e){var b=this,a=this.layerInfos;return a&&a.length?a.some(function(a){return b._hasLayerInfo(a,e)}):!0};b.prototype._hasLayerInfo=function(e,b){var a=this._isLayerUIDMatching(e.layer,b.layer.uid);a&&(this._layerInfosByLayerViewId[b.uid]=e);return a};b.prototype._isLayerUIDMatching=function(e,b){return e&&(e.uid===b||this._hasLayerUID(e.layers,b))};b.prototype._hasLayerUID=function(e,b){var a=
this;return e&&e.some(function(e){return a._isLayerUIDMatching(e,b)})};b.prototype._isLayerViewSupported=function(e){return-1<C.indexOf(e.layer.declaredClass)?(this._layerViewByLayerId[e.layer.uid]=e,!0):!1};b.prototype._generateActiveLayerInfo=function(e){var b=this;this._isLayerActive(e)?this._buildActiveLayerInfo(e):(this._handles.remove(e.uid),this._handles.add(q.watch(e,"suspended, layer.legendEnabled",function(){return b._layerActiveHandle(e)}),e.uid))};b.prototype._layerActiveHandle=function(b){this._isLayerActive(b)&&
(this._handles.remove(b.uid),this._buildActiveLayerInfo(b))};b.prototype._isLayerActive=function(b){return!b.suspended&&b.get("layer.legendEnabled")};b.prototype._buildActiveLayerInfo=function(b){var e=this,a=b.layer,g=b.uid,f=this._layerInfosByLayerViewId[g],d=this._activeLayerInfosByLayerViewId[g];d||(d=new x({layer:a,title:f&&void 0!==f.title?f.title:a.title}),this._activeLayerInfosByLayerViewId[g]=d);d.parent||(f=(f=a.parent)&&this._layerViewByLayerId[f.uid],d.parent=f&&this._activeLayerInfosByLayerViewId[f.uid]);
if(!this._handles.has(g)){var f=q.watch(a,"title",function(a){return e._titleHandle(a,d,b)}),k=q.watch(a,"legendEnabled",function(a){return e._legendEnabledHandle(a,d,b)}),a=q.watch(a,"renderer, opacity",function(){return e._constructLegendElements(d,b)}),h=q.watch(b,"suspended",function(a){return e._suspendedHandle(a,d,b)}),r=q.whenTrue(this.view,"stationary",function(){return e._scaleHandle(d,b)});this._handles.add([f,k,a,h,r],g);this._constructLegendElements(d,b)}this._addActiveLayerInfo(d,b)};
b.prototype._titleHandle=function(b,a,d){a.title=b;this._constructLegendElements(a,d)};b.prototype._legendEnabledHandle=function(b,a,d){b?this._addActiveLayerInfo(a,d):this._removeActiveLayerInfo(a)};b.prototype._suspendedHandle=function(b,a,d){b?this._removeActiveLayerInfo(a):this._addActiveLayerInfo(a,d)};b.prototype._scaleHandle=function(b,a){b.scale!==this.view.scale&&b.isScaleDriven&&this._constructLegendElements(b,a)};b.prototype._addActiveLayerInfo=function(b,a){this._isLayerActive(a)&&-1===
this.activeLayerInfos.indexOf(b)&&((a=b.parent,a)?-1===a.children.indexOf(b)&&(a.children.push(b),this._sortActiveLayerInfos(a.children)):(this.activeLayerInfos.add(b),this._sortActiveLayerInfos(this.activeLayerInfos)))};b.prototype._removeActiveLayerInfo=function(b){var a=b.parent;a?(b=a.children.indexOf(b),-1!==b&&a.children.splice(b,1)):this.activeLayerInfos.remove(b)};b.prototype._constructLegendElements=function(b,a){a=a.layer;b.scale=this.view.scale;a.featureCollections?b.buildLegendElementsForFeatureCollections(a.featureCollections):
a.renderer?b.buildLegendElementsForRenderer():a.url&&b.buildLegendElementsForTools()};h([y.property({type:p})],b.prototype,"activeLayerInfos",void 0);h([y.property()],b.prototype,"basemapLegendVisible",void 0);h([y.property()],b.prototype,"groundLegendVisible",void 0);h([y.property()],b.prototype,"layerInfos",void 0);h([y.property({dependsOn:["view.ready"],readOnly:!0})],b.prototype,"state",null);h([y.property()],b.prototype,"view",void 0);return b=h([y.subclass("esri.widgets.Legend.LegendViewModel")],
b)}(y.declared(d))})},"esri/widgets/Legend/support/ActiveLayerInfo":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/io-query ../../../Color ../../../request ../../../symbols ../../../core/Accessor ../../../core/arrayUtils ../../../core/Collection ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/support/ExportImageParameters ../../../renderers/support/jsonUtils ../../../symbols/support/gfxUtils ../../../symbols/support/symbolPreview ../../../symbols/support/symbolUtils ./colorRampUtils ./heatmapRampUtils ./relationshipRampUtils ./sizeRampUtils".split(" "),
function(A,c,a,h,d,l,m,q,y,x,p,C,z,k,b,e,n,t,g,f,B,u,D,r,H,w){function J(b){return"esri.renderers.SimpleRenderer"===b.declaredClass}function L(b){return"esri.renderers.ClassBreaksRenderer"===b.declaredClass}function R(b){return"esri.renderers.UniqueValueRenderer"===b.declaredClass}function K(b){return"esri.renderers.HeatmapRenderer"===b.declaredClass}function S(b){return"esri.renderers.PointCloudClassBreaksRenderer"===b.declaredClass}function T(b){return"esri.renderers.PointCloudStretchRenderer"===
b.declaredClass}function U(b){return"esri.renderers.PointCloudUniqueValueRenderer"===b.declaredClass}var M=k.getLogger("esri.widgets.Legend.support.ActiveLayerInfo"),N=/^\s*(return\s+)?\$view\.scale\s*(;)?\s*$/i,I=new y.SimpleMarkerSymbol({size:6,outline:{color:[128,128,128,.5],width:.5}}),O=new y.SimpleMarkerSymbol({style:"path",path:"M10,5 L5,0 0,5 M5,0 L5,15",outline:{width:1,color:[85,85,85,1]}});return function(k){function c(b){b=k.call(this,b)||this;b._handles=new z;b._hasColorRamp=!1;b._hasOpacityRamp=
!1;b._hasSizeRamp=!1;b._legendResponse={};b._webStyleSymbolCache=new Map;b.children=new C;b.layer=null;b.legendElements=[];b.parent=null;b.scale=null;b.title=null;return b}h(c,k);c.prototype.initialize=function(){var b=this,a=function(){return b.notifyChange("ready")};this._handles.add([e.on(this,"children","change",function(v){var f=v.removed,d=b._handles;v.added.map(function(b){var v="activeLayerInfo-ready-watcher-"+b.layer.uid;d.add(e.init(b,"ready",a),v)});f.forEach(function(b){return d.remove(b.layer.uid)});
a()})])};c.prototype.destroy=function(){this._handles.destroy();this._webStyleSymbolCache=this._legendResponse=this._handles=null};Object.defineProperty(c.prototype,"ready",{get:function(){return null===this.layer?!0:0<this.children.length?this._isGroupActive():0<this.legendElements.length},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isScaleDriven",{get:function(){var b=this,a=this.layer;if(null===a)return!1;if(a.renderer){var f=a.get("renderer.valueExpression");return N.test(f)?
!0:(a=a.get("renderer.visualVariables"))&&a.some(function(a){return b._isScaleDrivenSizeVariable(a)})}return!0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"version",{get:function(){return this._get("version")+1},enumerable:!0,configurable:!0});c.prototype.buildLegendElementsForFeatureCollections=function(b){var a=this;this.legendElements=[];b.forEach(function(b){if("esri.layers.FeatureLayer"===b.declaredClass)a._buildRendererLegendElements(b.renderer,b.title,"append");else if(b.featureSet&&
b.featureSet.features.length){var v=b.layerDefinition;(v=(v=v&&v.drawingInfo)&&g.fromJSON(v.renderer))?a._buildRendererLegendElements(v,b.name,"append"):M.warn("drawingInfo not available!")}})};c.prototype.buildLegendElementsForRenderer=function(){this._buildRendererLegendElements(this.layer.renderer,null,"replace")};c.prototype.buildLegendElementsForTools=function(){var b=this,a=this.layer;"esri.layers.WMTSLayer"===a.declaredClass?this._constructLegendElementsForWMTSlayer():"esri.layers.WMSLayer"===
a.declaredClass?this._constructLegendElementsForWMSSublayers():"esri.layers.MapImageLayer"===a.declaredClass?this._constructLegendElementsForSublayers():(this._handles.remove("imageryLayers-watcher"),this._getLegendLayers().then(function(v){b.legendElements=[];v.forEach(function(v){if("esri.layers.ImageryLayer"===b.layer.declaredClass){var f=a.watch("renderingRule, bandIds",function(){b._legendResponse["default"]=null;b.buildLegendElementsForTools()});b._handles.add(f,"imageryLayers-watcher")}(v=
b._generateSymbolTableElementForLegendLayer(v))&&v.infos.length&&b.legendElements.push(v);b.notifyChange("ready")});b.notifyChange("ready")}).catch(function(b){M.warn("Request to server for legend has failed!",b)}))};c.prototype._isGroupActive=function(){var b=this.children;return b.length?b.some(function(b){return b.ready}):!1};c.prototype._isScaleDrivenSizeVariable=function(b){if(b&&"size"!==b.type)return!1;var a=b.minSize,v=b.maxSize;return"object"===typeof a&&a?this._isScaleDrivenSizeVariable(a):
"object"===typeof v&&v?this._isScaleDrivenSizeVariable(v):!!b.expression||N.test(b.valueExpression)};c.prototype._buildRendererLegendElements=function(b,a,f){var v=this;this._getRendererLegendElements(b,a).then(function(b){"append"===f?Array.prototype.push.apply(v.legendElements,b):v.legendElements=b;v.notifyChange("ready")}).catch(function(b){M.warn("error while building legend for layer!",b)})};c.prototype._constructLegendElementsForWMTSlayer=function(){this.legendElements=[];this._handles.remove("wmts-activeLayer-watcher");
var b=this.layer,a=b.activeLayer;this._handles.add(e.watch(this.layer,"activeLayer",this._constructLegendElementsForWMTSlayer.bind(this)),"wmts-activeLayer-watcher");if(a.styleId&&a.styles){var f=null;a.styles.some(function(b){if(a.styleId===b.id)return f=b.legendUrl,!0});f&&(this.legendElements=[{type:"symbol-table",title:a.title,infos:[{src:f,opacity:b.opacity}]}])}this.notifyChange("ready")};c.prototype._constructLegendElementsForWMSSublayers=function(){this.legendElements=[];this._handles.remove("wms-sublayers-watcher");
var b=this.layer,f=null;if(b.customParameters||b.customLayerParameters)f=a({},b.customParameters,b.customLayerParameters);this._handles.add(e.watch(this.layer,"sublayers",this._constructLegendElementsForWMSSublayers.bind(this)),"wms-sublayers-watcher");this.legendElements=this._generateLegendElementsForWMSSublayers(b.sublayers,f);this.notifyChange("ready")};c.prototype._generateLegendElementsForWMSSublayers=function(b,a){var f=this,v=[];this._handles.add(b.on("change",this._constructLegendElementsForWMSSublayers.bind(this)),
"wms-sublayers-watcher");b.forEach(function(b){var e=b.watch("title, visible, legendEnabled",function(){return f._constructLegendElementsForWMSSublayers()});f._handles.add(e,"wms-sublayers-watcher");b.visible&&b.legendEnabled&&(b=f._generateSymbolTableElementForWMSSublayer(b,a))&&b.infos.length&&v.unshift(b)});return v};c.prototype._generateSymbolTableElementForWMSSublayer=function(b,a){return!b.legendUrl&&b.sublayers?(a=this._generateLegendElementsForWMSSublayers(b.sublayers,a).filter(function(b){return b}),
{type:"symbol-table",title:b.title,infos:a}):this._generateSymbolTableElementForLegendUrl(b,a)};c.prototype._generateSymbolTableElementForLegendUrl=function(b,a){var f=b.legendUrl;if(f){var v={type:"symbol-table",title:b.title||b.name||b.id&&b.id+"",infos:[]};a&&(f+="?"+l.objectToQuery(a));v.infos.push({src:f,opacity:b.layer&&b.layer.opacity});return v}};c.prototype._getLegendLayers=function(a){var f=this,v=(a=a&&a.hasDynamicLayers?a.dynamicLayers:null)||"default",e=this._legendResponse&&this._legendResponse[v];
return e?b.resolve(e):this._legendRequest(a).then(function(b){b=b.layers;return f._legendResponse[v]=b})};c.prototype._legendRequest=function(b){var a=this.layer;b={f:"json",dynamicLayers:b};"esri.layers.ImageryLayer"===a.declaredClass&&(a.renderingRule&&(b.renderingRule=JSON.stringify(a.renderingRule.toJSON())),a.bandIds&&(b.bandIds=a.bandIds.join()));var f=a.url.replace(/(\/)+$/,"");if(10.01<=a.version){var v=f.indexOf("?"),f=-1<v?f.substring(0,v)+"/legend"+f.substring(v):f+"/legend";a.token&&(f+=
"?token\x3d"+a.token)}else a=f.toLowerCase().indexOf("/rest/"),a=f.substring(0,a)+f.substring(a+5,f.length),f="https://utility.arcgis.com/sharing/tools/legend?soapUrl\x3d"+encodeURI(a)+"\x26returnbytes\x3dtrue";return q(f,{query:b}).then(function(b){return b.data})};c.prototype._constructLegendElementsForSublayers=function(){var b=this;this.legendElements=[];this._handles.remove("sublayers-watcher");var a=this.layer,f=new t({layer:a});this._getLegendLayers(f).then(function(f){var v={};f.forEach(function(b){v[b.layerId]=
b});b._handles.add(e.watch(a,"sublayers",b._constructLegendElementsForSublayers.bind(b)),"sublayers-watcher");b.legendElements=b._generateLegendElementsForSublayers(a.sublayers,v,a.opacity);b.notifyChange("ready")}).catch(function(b){M.warn("Request to server for legend has failed!",b)}).then(function(){return f.destroy()});this.notifyChange("ready")};c.prototype._generateLegendElementsForSublayers=function(b,a,f){var e=this,v=[];this._handles.add(b.on("change",this._constructLegendElementsForSublayers.bind(this)),
"sublayers-watcher");b.forEach(function(b){var d=b.watch("renderer, opacity, title, visible",function(){return e._constructLegendElementsForSublayers()});e._handles.add(d,"sublayers-watcher");b.visible&&b.legendEnabled&&(d=b&&null!=b.opacity?b.opacity:null,(b=e._generateSymbolTableElementForSublayer(b,a,null!=d?d*f:f))&&b.infos.length&&v.unshift(b))});return v};c.prototype._generateSymbolTableElementForSublayer=function(b,a,f){var e=a[b.id];return!e&&b.sublayers?(a=this._generateLegendElementsForSublayers(b.sublayers,
a,f).filter(function(b){return b}),{type:"symbol-table",title:b.title,infos:a}):this._generateSymbolTableElementForLegendLayer(e,b,f)};c.prototype._generateSymbolTableElementForLegendLayer=function(b,a,f){var e=this;if(b){var d=a&&a.renderer,v=a&&a.title||b.layerName;d&&(d=a&&a.title||this._getRendererTitle(d,a))&&(v&&(d.title=v),v=d);v={type:"symbol-table",title:v,infos:[]};b.legendType&&(v.legendType=b.legendType);b.legend&&this._isLegendLayerInScale(b,a)&&(a=a?this._sanitizeLegendForSublayer(b.legend.slice(),
a):b.legend,v.infos=a.map(function(a){var d=a.url;if(a.imageData&&0<a.imageData.length)d="data:image/png;base64,"+a.imageData;else if(0!==d.indexOf("http")){var d=e.layer.url+"/"+b.layerId+"/images/"+d,v=e.layer.token;v&&(d+="?token\x3d"+v)}else return null;return{label:a.label,src:d,opacity:f,width:a.width,height:a.height}}).filter(function(b){return!!b}));return v.infos.length?v:null}};c.prototype._isLegendLayerInScale=function(b,a){a=a||this.layer;var f=null,e=null,d=!0;!a.minScale&&0!==a.minScale||
!a.maxScale&&0!==a.maxScale?(0===b.minScale&&a.tileInfo&&(f=a.tileInfo.lods[0].scale),0===b.maxScale&&a.tileInfo&&(e=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(f=Math.min(a.minScale,b.minScale)||a.minScale||b.minScale,e=Math.max(a.maxScale,b.maxScale));if(0<f&&f<this.scale||e>this.scale)d=!1;return d};c.prototype._sanitizeLegendForSublayer=function(b,a){if(10.1>this.layer.version||0===b.length)return b;a=a.renderer;var f=null,e=null;b.some(function(b){return b.values})&&b.some(function(b,
a){b.values||(f=a,e=b,e.label||(e.label="others"));return null!=e});a?"unique-value"===a.type?e&&(b.splice(f,1),b.push(e)):"class-breaks"===a.type&&(e&&b.splice(f,1),b.reverse(),e&&b.push(e)):e&&(b.splice(f,1),b.push(e));return b};c.prototype._getRendererLegendElements=function(a,f){return J(a)||L(a)||R(a)||K(a)||S(a)||T(a)||U(a)?S(a)||T(a)||U(a)||"esri.renderers.PointCloudRGBRenderer"===a.declaredClass?this._constructPointCloudRendererLegendElements(a,f):this._constructRendererLegendElements(a,f):
(M.warn("Renderer not supported!"),b.resolve([]))};c.prototype._getPointCloudRendererTitle=function(b){return b.legendOptions&&b.legendOptions.title||b.field};c.prototype._constructPointCloudRendererLegendElements=function(a,e){var d=this,g=this.layer.opacity,r=[],k=null,w=null;if(S(a))k={type:"symbol-table",title:e||this._getPointCloudRendererTitle(a),infos:[]},a.colorClassBreakInfos.forEach(function(b){k.infos.unshift({label:b.label||b.minValue+" - "+b.maxValue,value:[b.minValue,b.maxValue],symbol:d._getAppliedCloneSymbol(I,
b.color,g)})});else if(T(a)){var w=a.stops,v=null;if(w.length&&(1===w.length&&(v=w[0].color),!v)){var h=w[0].value,t=w[w.length-1].value;null!=h&&null!=t&&(v=D.getColorFromPointCloudStops(h+(t-h)/2,w))}k={type:"symbol-table",title:null,infos:[{label:null,value:null,symbol:this._getAppliedCloneSymbol(I,v||I.color,g)}]};w={type:"color-ramp",title:e||this._getPointCloudRendererTitle(a),borderColor:f.getStroke(I).color,overlayColor:D.getRampOverlayColor(g),infos:D.getRampStopsForPointCloud(a.stops)}}else U(a)&&
(k={type:"symbol-table",title:e||this._getPointCloudRendererTitle(a),infos:[]},a.colorUniqueValueInfos.forEach(function(b){k.infos.push({label:b.label||b.values.join(", "),value:b.values.join(", "),symbol:d._getAppliedCloneSymbol(I,b.color,g)})}));k&&k.infos.length&&r.push(k);w&&w.infos.length&&r.push(w);a=r.reduce(function(b,a){return b.concat(a.infos)},[]).filter(function(b){return!!b.symbol}).map(function(b){return d._getSymbolPreview(b)});return b.eachAlways(a).then(function(){return r})};c.prototype._constructRendererLegendElements=
function(a,f){var e=this;return this._loadRenderer(a).then(function(a){e._hasColorRamp=!1;e._hasOpacityRamp=!1;e._hasSizeRamp=!1;var d=e._getVisualVariableLegendElements(a)||[],g={type:"symbol-table",title:f||e._getRendererTitle(a),infos:[]},k=null,w=!1;if(K(a))d.push({type:"heatmap-ramp",title:f,infos:r.getHeatmapRampStops(a)});else if(R(a)){var v=a&&a.authoringInfo;if(v&&"relationship"===v.type){var h=v.focus,t=v.numClasses,n=v.field1,u=v.field2;if(t&&n&&u){for(var v=e.layer,n=[n,u],u=H.getRotationAngleForFocus(h)||
0,c=0;c<n.length;c++){var z=n[c],B=z.normalizationField,z={field:e._getFieldAlias(z.field,v),normField:B&&e._getFieldAlias(B,v)},B=O.clone();B.angle=u;g.infos.push({label:z,symbol:B});u+=90}h=H.getRelationshipRampElement({focus:h,numClasses:t,infos:a.uniqueValueInfos});d.unshift(h)}}else{var D=a.field;a.uniqueValueInfos.forEach(function(b){b.symbol&&g.infos.push({label:b.label||e._getDomainName(D,b.value)||b.value,value:b.value,symbol:b.symbol})})}a.defaultSymbol&&(g.infos.push({label:a.defaultLabel||
"others",symbol:a.defaultSymbol}),w=!0)}else L(a)?(k=e._isUnclassedRenderer(a),k&&e._hasSizeRamp||(a.classBreakInfos.forEach(function(b){b.symbol&&g.infos.unshift({label:b.label||(k?null:b.minValue+" - "+b.maxValue),value:[b.minValue,b.maxValue],symbol:b.symbol})}),k&&(g.title=null),e._updateInfosforClassedSizeRenderer(a,g.infos)),a.defaultSymbol&&!k&&(g.infos.push({label:a.defaultLabel||"others",symbol:a.defaultSymbol}),w=!0)):J(a)&&a.symbol&&!e._hasSizeRamp&&g.infos.push({label:a.label,symbol:a.symbol});
h=a.defaultSymbol;!h||w||J(a)||k&&!e._hasColorRamp&&!e._hasSizeRamp&&!e._hasOpacityRamp||d.push({type:"symbol-table",infos:[{label:a.defaultLabel||"others",symbol:h}]});g.infos.length&&d.unshift(g);var l=e._getSymbolConfig(a.visualVariables),w=d.reduce(function(b,a){return b.concat(a.infos)},[]).filter(function(b){return!(!b||!b.symbol)}).map(function(b){return e._getSymbolPreview(b,l)});a=null;return b.eachAlways(w).then(function(){return d})})};c.prototype._updateInfosforClassedSizeRenderer=function(b,
a){var f=b.authoringInfo&&"class-breaks-size"===b.authoringInfo.type,e=b.classBreakInfos.some(function(b){return u.isVolumetricSymbol(b.symbol)});if(f&&e){var d=w.REAL_WORLD_MAX_SIZE;b=b.classBreakInfos.length;var g=(d-w.REAL_WORLD_MIN_SIZE)/(1<b?b-1:b);a.forEach(function(b,a){b.size=d-g*a})}};c.prototype._getSymbolConfig=function(b){var a=!1,f=!1;if(b)for(var e=0;e<b.length&&(!a||!f);e++){var d=b[e];"size"===d.type&&("height"===d.axis&&(a=!0),"width-and-depth"===d.axis&&(f=!0))}return a&&f?"tall":
null};c.prototype._getSymbolPreview=function(b,a){return B.renderPreviewHTML(b.symbol,{size:b.size,opacity:this.layer.opacity,symbolConfig:a,rotation:b.symbol.angle}).then(function(a){b.preview=a;return b}).catch(function(){b.preview=null;return b})};c.prototype._loadRenderer=function(a){var f=this,e=[];a=a.clone();var d=this._getMedianColor(a),g=this.layer.opacity;if(L(a)||R(a)){var k=(a.classBreakInfos||a.uniqueValueInfos).map(function(b){return f._fetchSymbol(b.symbol,d,g).then(function(a){b.symbol=
a}).catch(function(){b.symbol=null})});Array.prototype.push.apply(e,k)}e.push(this._fetchSymbol(a.symbol||a.defaultSymbol,a.defaultSymbol?null:d,g).then(function(b){f._applySymbolToRenderer(a,b,J(a))}).catch(function(){f._applySymbolToRenderer(a,null,J(a))}));return b.eachAlways(e).then(function(){return a})};c.prototype._applySymbolToRenderer=function(b,a,f){f?b.symbol=a:b.defaultSymbol=a};c.prototype._getMedianColor=function(b){if(!b.visualVariables)return null;var a=p.find(b.visualVariables,function(b){return"color"===
b.type});if(!a)return null;var f=null,e=null;if(a.colors)f=a.minDataValue,e=a.maxDataValue;else if(a.stops){if(1===a.stops.length)return a.stops[0].color;f=a.stops[0].value;e=a.stops[a.stops.length-1].value}if(null!=f&&null!=e)return b.getColor(f+(e-f)/2,{colorInfo:a})};c.prototype._fetchSymbol=function(a,f,e){var d=this;if(!a)return b.reject();if("web-style"===a.type){var g=a.portal,g=a.name+"-"+a.styleName+"-"+a.styleUrl+"-"+(g&&g.url)+"-"+(g&&g.user&&g.user.username),k=this._webStyleSymbolCache;
k.has(g)||k.set(g,a.fetchSymbol());return k.get(g).then(function(b){return d._getAppliedCloneSymbol(b,f,e)}).catch(function(){M.warn("Fetching web-style failed!");return b.reject()})}return b.resolve(this._getAppliedCloneSymbol(a,f,e))};c.prototype._getAppliedCloneSymbol=function(b,a,f){if(!b)return b;b=b.clone();var e=-1<b.type.indexOf("3d");a=a&&a.toRgba();e?this._applyColorTo3dSymbol(b,a,f):(b.color&&(b.color=this._getOpacityAppliedColor(a||b.color.toRgba(),f)),(a=b.outline)&&a.color&&(a.color=
this._getOpacityAppliedColor(a.color.toRgba(),f)));return b};c.prototype._applyColorTo3dSymbol=function(b,a,f){var e=this;b.symbolLayers.forEach(function(b){b&&(a&&(b.material||(b.material={}),b.material.color=new m(a)),null!=f&&(b.material&&b.material.color&&(b.material.color=e._getOpacityAppliedColor(b.material.color.toRgba(),f)),b.outline&&b.outline.color&&(b.outline.color=e._getOpacityAppliedColor(b.outline.color.toRgba(),f))))})};c.prototype._getOpacityAppliedColor=function(b,a){b[3]*=a;return b};
c.prototype._getVisualVariableLegendElements=function(b){var a=this,f=b.visualVariables,e=[],d=[],g=[],k=this.layer.opacity;if(!f)return null;f.forEach(function(b){"color"===b.type?e.push(b):"size"===b.type?d.push(b):"opacity"===b.type&&g.push(b)});var f=e.concat(d,g),r,h;0===e.length&&L(b)&&b.classBreakInfos&&1===b.classBreakInfos.length&&(r=(r=b.classBreakInfos[0])&&r.symbol);0===e.length&&J(b)&&(r=b.symbol);r&&(-1<r.type.indexOf("3d")?(r=r.symbolLayers.getItemAt(0),r.get("material.color")&&(h=
r.material.color)):r.url||(h=r.color),h&&(h=h.toRgba()));return f.map(function(f){if(!f.legendOptions||!1!==f.legendOptions.showLegend){var e=a._getRampTitle(f,a.layer),d=D.getRampBorderColor(b),g=D.getRampOverlayColor(k),r=null;"color"===f.type?(r={type:"color-ramp",title:e,borderColor:d,overlayColor:g,infos:D.getRampStops(b,f)},a._hasColorRamp||(a._hasColorRamp=!(null==r.infos||!r.infos.length))):"size"===f.type?(r={type:"size-ramp",title:e,infos:w.getRampStops(b,f,a._getMedianColor(b),a.scale)},
a._hasSizeRamp||(a._hasSizeRamp=!(null==r.infos||!r.infos.length))):"opacity"===f.type&&(r={type:"opacity-ramp",title:e,borderColor:d,overlayColor:g,infos:D.getRampStops(b,f,h)},a._hasOpacityRamp||(a._hasOpacityRamp=!(null==r.infos||!r.infos.length)));return r.infos&&r}}).filter(function(b){return!!b})};c.prototype._getDomainName=function(b,a){if(b&&"function"!==typeof b){var f=this.layer;return(f=(b=f.getField&&f.getField(b))&&f.getFieldDomain?f.getFieldDomain(b.name):null)&&f.codedValues?f.getName(a):
null}return null};c.prototype._getRampTitle=function(b,a){var f=b.field,e=b.normalizationField,d=!1,g=!1,r=!1,k=null,f="function"===typeof f?null:f,e="function"===typeof e?null:e;if(void 0!==(b.legendOptions&&b.legendOptions.title))k=b.legendOptions.title;else if(b.valueExpressionTitle)k=b.valueExpressionTitle;else{if(a.renderer.authoringInfo&&a.renderer.authoringInfo.visualVariables)for(b=a.renderer.authoringInfo.visualVariables,k=0;k<b.length;k++){var w=b[k];if("color"===w.type)if("ratio"===w.style){d=
!0;break}else if("percent"===w.style){g=!0;break}else if("percentTotal"===w.style){r=!0;break}}k={field:f&&this._getFieldAlias(f,a),normField:e&&this._getFieldAlias(e,a),ratio:d,ratioPercent:g,ratioPercentTotal:r}}return k};c.prototype._getRendererTitle=function(b,a){if(b.legendOptions&&b.legendOptions.title)return b.legendOptions.title;if(b.valueExpressionTitle)return b.valueExpressionTitle;var f=this.layer,e=b.field,d=null,g=null;L(b)&&(d=b.normalizationField,g="percent-of-total"===b.normalizationType);
e="function"===typeof e?null:e;d="function"===typeof d?null:d;b=null;if(e||d)b={field:a?e:e&&this._getFieldAlias(e,f),normField:a?d:d&&this._getFieldAlias(d,f),normByPct:g};return b};c.prototype._getFieldAlias=function(b,a){var f=a.popupTemplate,f=f&&f.fieldInfos;a="function"===typeof b?null:a.getField&&a.getField(b);var e=null;f&&f.some(function(a){if(b===a.fieldName)return e=a,!0});var f=e||a,d=null;f&&(d=e&&e.label||a&&a.alias||f.name||f.fieldName);return d};c.prototype._isUnclassedRenderer=function(b){var a=
b.visualVariables,f=!1;L(b)&&b.classBreakInfos&&1===b.classBreakInfos.length&&a&&(f=b.field?a.some(function(a){return!(!a||b.field!==a.field||(b.normalizationField||a.normalizationField)&&b.normalizationField!==a.normalizationField)}):!!a.length);return f};d([n.property()],c.prototype,"children",void 0);d([n.property()],c.prototype,"layer",void 0);d([n.property()],c.prototype,"legendElements",void 0);d([n.property()],c.prototype,"parent",void 0);d([n.property({readOnly:!0})],c.prototype,"ready",null);
d([n.property()],c.prototype,"scale",void 0);d([n.property({dependsOn:["layer.renderer.valueExpression","layer.renderer.visualVariables"],readOnly:!0})],c.prototype,"isScaleDriven",null);d([n.property()],c.prototype,"title",void 0);d([n.property({dependsOn:["ready"],readOnly:!0,value:0})],c.prototype,"version",null);return c=d([n.subclass("esri.widgets.Legend.support.ActiveLayerInfo")],c)}(n.declared(x))})},"esri/layers/support/ExportImageParameters":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./sublayerUtils".split(" "),
function(A,c,a,h,d,l,m,q){var y={visible:"visibleSublayers",definitionExpression:"layerDefs",labelingInfo:"hasDynamicLayers",labelsVisible:"hasDynamicLayers",opacity:"hasDynamicLayers",minScale:"visibleSublayers",maxScale:"visibleSublayers",renderer:"hasDynamicLayers",source:"hasDynamicLayers"};return function(c){function l(){var a=null!==c&&c.apply(this,arguments)||this;a.scale=0;return a}h(l,c);Object.defineProperty(l.prototype,"dynamicLayers",{get:function(){if(!this.hasDynamicLayers)return null;
var a=this.visibleSublayers.map(function(a){return a.toExportImageJSON()});return a.length?JSON.stringify(a):null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"hasDynamicLayers",{get:function(){return q.isExportDynamic(this.visibleSublayers,this.layer.serviceSublayers,this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"layer",{set:function(a){var d=this;this._get("layer")!==a&&(this._set("layer",a),this._layerHandles&&(this._layerHandles.forEach(function(a){return a.remove()}),
this._layerHandles.length=0),a&&(this._layerHandles=[a.allSublayers.on("change",function(){return d.notifyChange("visibleSublayers")}),a.on("sublayer-update",function(a){return d.notifyChange(y[a.propertyName])})]))},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"layers",{get:function(){var a=this.visibleSublayers;return a?a.length?"show:"+a.map(function(a){return a.id}).join(","):"show:-1":null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"layerDefs",{get:function(){var a=
this.visibleSublayers.filter(function(a){return null!=a.definitionExpression});return a.length?JSON.stringify(a.reduce(function(a,d){a[d.id]=d.definitionExpression;return a},{})):null},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"version",{get:function(){return(this._get("version")||0)+1},set:function(a){this._set("version",a)},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"visibleSublayers",{get:function(){var a=this,d=this.layer.sublayers,k=[],b=function(e){var d=
a.scale,h=0===e.minScale||d<=e.minScale,g=0===e.maxScale||d>=e.maxScale;e.visible&&(0===d||h&&g)&&(e.sublayers?e.sublayers.forEach(b):k.unshift(e))};d&&d.forEach(b);return k},enumerable:!0,configurable:!0});l.prototype.toJSON=function(){var d=this.layer,d={dpi:d.dpi,format:d.imageFormat,transparent:d.imageTransparency,gdbVersion:d.gdbVersion||null};this.hasDynamicLayers&&this.dynamicLayers?d.dynamicLayers=this.dynamicLayers:d=a({},d,{layers:this.layers,layerDefs:this.layerDefs});return d};d([m.property({readOnly:!0,
dependsOn:["hasDynamicLayers","visibleSublayers"]})],l.prototype,"dynamicLayers",null);d([m.property({readOnly:!0,dependsOn:["visibleSublayers","layer.serviceSublayers","layer.capabilities"]})],l.prototype,"hasDynamicLayers",null);d([m.property()],l.prototype,"layer",null);d([m.property({readOnly:!0,dependsOn:["visibleSublayers"]})],l.prototype,"layers",null);d([m.property({readOnly:!0,dependsOn:["visibleSublayers"]})],l.prototype,"layerDefs",null);d([m.property({type:Number})],l.prototype,"scale",
void 0);d([m.property({dependsOn:"layers layerDefs dynamicLayers layer.dpi layer.imageFormat layer.imageTransparency layer.gdbVersion".split(" ")})],l.prototype,"version",null);d([m.property({readOnly:!0,dependsOn:["layer.sublayers","scale"]})],l.prototype,"visibleSublayers",null);return l=d([m.subclass("esri.layers.mixins.ExportImageParameters")],l)}(m.declared(l))})},"esri/symbols/support/symbolPreview":function(){define(["require","exports","./previewSymbol2D","./previewSymbol3D","./previewWebStyleSymbol"],
function(A,c,a,h,d){function l(c,q){switch(c.type){case "web-style":return d.previewWebStyleSymbol(c,l,q);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return h.previewSymbol3D(c,q);default:return a.previewSymbol2D(c,q)}}Object.defineProperty(c,"__esModule",{value:!0});c.renderPreviewHTML=l})},"esri/symbols/support/previewSymbol2D":function(){define("require exports dojox/gfx/_base ../../core/Error ../../core/promiseUtils ../../core/screenUtils ../SimpleMarkerSymbol ./gfxUtils ./previewUtils ./renderUtils".split(" "),
function(A,c,a,h,d,l,m,q,y,x){function p(a,d){var b=C.getContext("2d"),e=[];d&&(d.weight&&e.push(d.weight),d.size&&e.push(d.size+"px"),d.family&&e.push(d.family));b.font=e.join(" ");return b.measureText(a).width}Object.defineProperty(c,"__esModule",{value:!0});var C=document.createElement("canvas");c.previewSymbol2D=function(c,k){var b=k&&k.size?l.pt2px(k.size):null,e=k&&k.maxSize?l.pt2px(k.maxSize):null,n=k&&null!=k.opacity?k.opacity:null,t=k&&null!=k.rotation?k.rotation:null,g=q.getStroke(c),f=
{shape:null,fill:null,stroke:g};g&&g.width&&(g.width=Math.min(g.width,80));var B=0,u=0,D=g&&g.width||0,r=!1,H=null;switch(c.type){case "simple-marker":g=m.defaultProps;n=c.style;u=B=b=Math.min(b||l.pt2px(c.size||g.size),e||120);switch(n){case m.STYLE_CIRCLE:f.shape={type:"circle",cx:0,cy:0,r:.5*b};break;case m.STYLE_CROSS:f.shape={type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[B,.5*u]},{command:"M",values:[.5*B,0]},{command:"L",values:[.5*B,u]},{command:"E",values:[]}]};break;
case m.STYLE_DIAMOND:f.shape={type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[.5*B,0]},{command:"L",values:[B,.5*u]},{command:"L",values:[.5*B,u]},{command:"Z",values:[]}]};break;case m.STYLE_SQUARE:f.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[B,0]},{command:"L",values:[B,u]},{command:"L",values:[0,u]},{command:"Z",values:[]}]};break;case m.STYLE_X:f.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[B,u]},{command:"M",values:[B,
0]},{command:"L",values:[0,u]},{command:"E",values:[]}]};break;case m.STYLE_PATH:r=!0,f.shape={type:"path",path:c.path||""}}break;case "simple-line":D=Math.min(b||D,e||80);B=22<D?2*D:40;u=D;g.width=D;D=0;f.shape={type:"path",path:[{command:"M",values:[0,.5*u]},{command:"L",values:[B,.5*u]},{command:"E",values:[]}]};break;case "picture-fill":case "simple-fill":u=B=b=Math.min(b,e||120);r=!0;f.shape=y.shapes.fill[0];break;case "picture-marker":var w=e||120,e=l.pt2px(c.width),g=l.pt2px(c.height),b=Math.min(b||
Math.max(e,g),w),g=e/g,e=1>=g?Math.ceil(b*g):b,g=1>=g?b:Math.ceil(b/g),B=e,u=g,H=n;f.shape={type:"image",x:-Math.round(e/2),y:-Math.round(g/2),width:e,height:g,src:c.url||""};break;case "text":n=c.text||"Aa",g=c.font,b=Math.min(b||l.pt2px(g.size),e||120),w=p(n,{weight:g.weight,size:b,family:g.family}),B=(e=/[\uE600-\uE6FF]/.test(n))?b:w,u=b,w=.25*a.normalizedLength((g?b:0).toString()),e&&(w+=5),f.shape={type:"text",text:n,x:0,y:w,align:"middle",decoration:c.decoration||g&&g.decoration,rotated:c.rotated,
kerning:c.kerning},f.font=g&&{size:b,style:g.style,decoration:g.decoration,weight:g.weight,family:g.family}}if(!f.shape)return d.reject(new h("symbolPreview: renderPreviewHTML2D","symbol not supported."));var B=(B||22)+2*D,u=(u||22)+2*D,J=q.getFill(c),D=c.color,b=null;J&&"pattern"===J.type&&D&&"picture-fill"!==c.type?b=q.getPatternUrlWithColor(J.src,D.toCss(!0)).then(function(b){J.src=b;f.fill=J;return f}):(f.fill=J,b=d.resolve(f));return b.then(function(b){return x.renderSymbol([[b]],[B,u],{node:k&&
k.node,scale:r,opacity:H,rotation:t})})}})},"esri/symbols/support/previewUtils":function(){define(["require","exports"],function(A,c){Object.defineProperty(c,"__esModule",{value:!0});c.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},
{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},
{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},
{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};c.getExtrudeSymbolShapes=function(a){a*=.5;return[{type:"path",path:[{command:"M",
values:[0,.7*11]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+a]},{command:"L",values:[0,22*.7+a-.7*11]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,22*.7]},{command:"L",values:[6.6,22*.7+a]},{command:"L",values:[22,a]},{command:"L",values:[22,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[6.6,0]},{command:"L",values:[22,0]},{command:"L",values:[6.6,22*.7]},{command:"L",values:[0,.7*11]},{command:"Z",values:[]}]}]};c.getCubeShapes=
function(a,h){var d=h?20:a,c=h?4:6,c=d=22>=d?d-.5*c:d-c;h=h?.35*d:.5*d;return[{type:"path",path:[{command:"M",values:[.5*c,0]},{command:"L",values:[c,.5*h]},{command:"L",values:[.5*c,h]},{command:"L",values:[0,.5*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*h]},{command:"L",values:[.5*c,h]},{command:"L",values:[.5*c,a]},{command:"L",values:[0,a-.5*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*c,h]},{command:"L",values:[.5*c,a]},{command:"L",
values:[c,a-.5*h]},{command:"L",values:[c,.5*h]},{command:"Z",values:[]}]}]};c.getCylinderShapes=function(a,h){var d=h?20:a;h=h?4:6;d=22>=d?d-.5*h:d-h;h=.5*d;var c=.15*d;a-=c;return[{type:"ellipse",cx:.5*d,cy:a,rx:h,ry:c},{type:"path",path:[{command:"M",values:[0,c]},{command:"L",values:[0,a]},{command:"L",values:[d,a]},{command:"L",values:[d,c]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*d,cy:c,rx:h,ry:c}]};c.getConeShapes=function(a,h){var d=h?20:a;h=h?4:6;d=22>=d?d-.5*h:d-h;h=.15*d;var c=
d;a-=h;return[{type:"ellipse",cx:.5*d,cy:a,rx:.5*d,ry:h},{type:"path",path:[{command:"M",values:[.5*c,0]},{command:"L",values:[c,a]},{command:"L",values:[0,a]},{command:"Z",values:[]}]}]};c.getInvertedConeShapes=function(a){var h=a,h=22>h?h-3:h-6,d=.15*h,c=h;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[c,0]},{command:"L",values:[.5*c,a-d]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*h,cy:0,rx:.5*h,ry:d}]};c.getDiamondShapes=function(a){var h=a,h=22>h?h-2:h-4,d=Math.floor(a/
10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*h,0]},{command:"L",values:[h,.5*a-d]},{command:"L",values:[.45*h-d,.5*a+d]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*h,0]},{command:"L",values:[.45*h-d,.5*a+d]},{command:"L",values:[0,.5*a-d]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*a-d]},{command:"L",values:[.45*h-d,.5*a+d]},{command:"L",values:[.45*h,a]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*h,a]},
{command:"L",values:[h,.5*a-d]},{command:"L",values:[.45*h-d,.5*a+d]},{command:"Z",values:[]}]}]};c.getTetrahedronShapes=function(a){var h=a,h=22>h?h-1:h-2;return[{type:"path",path:[{command:"M",values:[.45*a,0]},{command:"L",values:[a,h]},{command:"L",values:[.45*a,.6*h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*a,0]},{command:"L",values:[.45*a,.6*h]},{command:"L",values:[0,h]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,h]},{command:"L",values:[.45*
a,.6*h]},{command:"L",values:[a,h]},{command:"Z",values:[]}]}]}})},"esri/symbols/support/renderUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../core/promiseUtils".split(" "),function(A,c,a,h,d,l,m,q,y,x){function p(a){return a.map(function(b){return b.command+" "+b.values.join(",")}).join(" ").trim()}function C(d,b,e,c){var k=c&&c.node||document.createElement("div"),g=a.createSurface(k,b,e);
null!=c.opacity&&(k.style.opacity=c.opacity.toString());try{d.forEach(function(a){var f=g.createGroup(),d=0;a.forEach(function(b){var a=b.shape,e=b.fill,g=b.stroke;d+=g&&g.width||0;var r=null;a&&("path"===a.type&&"string"!==typeof a.path&&(a.path=p(a.path)),r=f.createShape(a).setFill(e).setStroke(g?g:{width:0}),"text"===a.type&&r.setFont(b.font))});a=b/2;var k=e/2,r=f.getBoundingBox(),t=r.width,w=r.height,n=!1;if(c.scale&&0!==r.width&&0!==r.height){var l=r.width/r.height,n=(b>e?b:e)-2*d,z=1,m=1;isNaN(n)||
(1<l?(z=n/r.width,m=n/l/r.height):(m=n/r.height,z=n*l/r.width));f.applyTransform(h.scaleAt(z,m,a,k));n=!0}l=r.x+t/2;r=r.y+w/2;f.applyTransform(h.translate(a-l,k-r));!n&&(t>b||w>e)&&(n=t/b>w/e,t=((n?b:e)-5)/(n?t:w),f.applyTransform(h.scaleAt(t,t,a,k)));c.rotation&&f.applyTransform(h.rotategAt(c.rotation,l,r))})}catch(f){return g.clear(),g.destroy(),null}return k}function z(a,b,e){return a?l(a,{responseType:"image"}).then(function(a){a=a.data;var d=a.width,g=a.height,f=d/g,k=b;e&&(k=Math.min(k,Math.max(d,
g)));return{image:a,width:1>=f?Math.ceil(k*f):k,height:1>=f?k:Math.ceil(k/f)}}):x.reject(new q("renderUtils: imageDataSize","href not provided."))}Object.defineProperty(c,"__esModule",{value:!0});c.renderSymbol=function(a,b,e){var d=Math.ceil(b[0]);b=Math.ceil(b[1]);return a.some(function(b){return!!b.length})?C(a,d,b,e):null};c.tintImageWithColor=function(a,b,e,h,c){return z(a,b,c).then(function(g){var f=g.width?g.width:b,k=g.height?g.height:b,c;if(c=g.image)c=e&&"ignore"!==h?"multiply"===h&&255===
e.r&&255===e.g&&255===e.b&&1===e.a?!1:!0:!1;if(c){var t=g.image.width,r=g.image.height;(y("edge")||y("ie"))&&/\.svg$/i.test(a)&&(--t,--r);var n,w;n=Math.ceil(f);w=Math.ceil(k);c=document.createElement("canvas");c.width=n;c.height=w;c.style.width=n+"px";c.style.height=w+"px";c=c.getContext("2d");c.clearRect(0,0,n,w);c.drawImage(g.image,0,0,t,r,0,0,f,k);g=c.getImageData(0,0,f,k);t=[e.r/255,e.g/255,e.b/255,e.a];r=m.toHSV(e);for(n=0;n<g.data.length;n+=4){w=g.data;var l=n,z=t,q=r;switch(h){case "multiply":w[l+
0]*=z[0];w[l+1]*=z[1];w[l+2]*=z[2];w[l+3]*=z[3];break;default:var K=m.toHSV({r:w[l+0],g:w[l+1],b:w[l+2]});K.h=q.h;K.s=q.s;K.v=K.v/100*q.v;q=m.toRGB(K);w[l+0]=q.r;w[l+1]=q.g;w[l+2]=q.b;w[l+3]*=z[3]}}c.putImageData(g,0,0);a=c.canvas.toDataURL("image/png")}else(c=d.id&&d.id.findCredential(a))&&c.token&&(g=-1===a.indexOf("?")?"?":"\x26",a=""+a+g+"token\x3d"+c.token);return{url:a,width:f,height:k}}).catch(function(){return{url:a,width:b,height:b}})}})},"dojox/gfx":function(){define(["dojo/_base/lang",
"./gfx/_base","./gfx/renderer!"],function(A,c,a){c.switchTo(a);return c})},"dojox/gfx/renderer":function(){define(["./_base","dojo/_base/lang","dojo/_base/sniff","dojo/_base/window","dojo/_base/config"],function(A,c,a,h,d){var l=null;a.add("vml",function(a,d,c){c.innerHTML='\x3cv:shape adj\x3d"1"/\x3e';a="adj"in c.firstChild;c.innerHTML="";return a});return{load:function(m,q,y){function x(){q(["dojox/gfx/"+p],function(a){A.renderer=p;l=a;y(a)})}if(l&&"force"!=m)y(l);else{var p=d.forceGfxRenderer;
m=!p&&(c.isString(d.gfxRenderer)?d.gfxRenderer:"svg,vml,canvas,silverlight").split(",");for(var C,z;!p&&m.length;)switch(m.shift()){case "svg":"SVGAngle"in h.global&&(p="svg");break;case "vml":a("vml")&&(p="vml");break;case "silverlight":try{a("ie")?(C=new ActiveXObject("AgControl.AgControl"),C.IsVersionSupported("1.0"))&&(z=!0):navigator.plugins["Silverlight Plug-In"]&&(z=!0)}catch(k){z=!1}finally{C=null}z&&(p="silverlight");break;case "canvas":h.global.CanvasRenderingContext2D&&(p="canvas")}"canvas"===
p&&!1!==d.canvasEvents&&(p="canvasWithEvents");d.isDebug&&console.log("gfx renderer \x3d "+p);"svg"==p&&"undefined"!=typeof window.svgweb?window.svgweb.addOnLoad(x):x()}}}})},"esri/core/colorUtils":function(){define([],function(){var A={COEF_RGB2XYZ:[[.4124,.3576,.1805],[.2126,.7152,.0722],[.0193,.1192,.9505]],COEF_XYZ2RGB:[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]],matrixProduct:function(a,c){var d=[],h,m;if(a[0].length!==c.length)throw"dimensions do not match";var q=a.length,
y=a[0].length,x=0;for(h=0;h<q;h++){for(m=x=0;m<y;m++)x+=a[h][m]*c[m];d.push(x)}return d},rgb2xyz:function(a){a=[a.r/255,a.g/255,a.b/255].map(function(a){return.04045>=a?a/12.92:Math.pow((a+.055)/1.055,2.4)});a=this.matrixProduct(this.COEF_RGB2XYZ,a);return{x:100*a[0],y:100*a[1],z:100*a[2]}},xyz2rgb:function(a){a=this.matrixProduct(this.COEF_XYZ2RGB,[a.x/100,a.y/100,a.z/100]).map(function(a){return Math.min(1,Math.max(.0031308>=a?12.92*a:1.055*Math.pow(a,1/2.4)-.055,0))});return{r:Math.round(255*a[0]),
g:Math.round(255*a[1]),b:Math.round(255*a[2])}},xyz2lab:function(a){a=[a.x/95.047,a.y/100,a.z/108.883].map(function(a){return a>Math.pow(6/29,3)?Math.pow(a,1/3):1/3*Math.pow(29/6,2)*a+4/29});return{l:116*a[1]-16,a:500*(a[0]-a[1]),b:200*(a[1]-a[2])}},lab2xyz:function(a){var c=a.l;a=[(c+16)/116+a.a/500,(c+16)/116,(c+16)/116-a.b/200].map(function(a){return a>6/29?Math.pow(a,3):3*Math.pow(6/29,2)*(a-4/29)});return{x:95.047*a[0],y:100*a[1],z:108.883*a[2]}},lab2lch:function(a){var c=a.l,d=a.a,l=a.b;a=Math.sqrt(d*
d+l*l);d=Math.atan2(l,d);d=0<d?d:d+2*Math.PI;return{l:c,c:a,h:d}},lch2lab:function(a){var c=a.c,d=a.h;return{l:a.l,a:c*Math.cos(d),b:c*Math.sin(d)}},rgb2lab:function(a){return this.xyz2lab(this.rgb2xyz(a))},lab2rgb:function(a){return this.xyz2rgb(this.lab2xyz(a))},rgb2lch:function(a){return this.lab2lch(this.xyz2lab(this.rgb2xyz(a)))},lch2rgb:function(a){return this.xyz2rgb(this.lab2xyz(this.lch2lab(a)))}},c={rgb2hsv:function(a){var c=a.r,d=a.g;a=a.b;var l=Math.max(c,d,a),m=l-Math.min(c,d,a),q;0===
m?q=0:l===c?q=(d-a)/m%6:l===d?q=(a-c)/m+2:l===a&&(q=(c-d)/m+4);0>q&&(q+=6);return{h:60*q,s:100*(0===m?0:m/l),v:100/255*l}},hsv2rgb:function(a){var c=a.h/60,d=a.v/100*255;a=a.s/100*d;var l=a*(1-Math.abs(c%2-1)),m;switch(Math.floor(c)){case 0:m={r:a,g:l,b:0};break;case 1:m={r:l,g:a,b:0};break;case 2:m={r:0,g:a,b:l};break;case 3:m={r:0,g:l,b:a};break;case 4:m={r:l,g:0,b:a};break;case 5:case 6:m={r:a,g:0,b:l}}m.r=Math.round(m.r+d-a);m.g=Math.round(m.g+d-a);m.b=Math.round(m.b+d-a);return m}};return{toRGB:function(a){var h;
void 0!==a.r&&void 0!==a.g&&void 0!==a.b?h=a:void 0!==a.l&&void 0!==a.c&&void 0!==a.h?h=A.lch2rgb(a):void 0!==a.l&&void 0!==a.a&&void 0!==a.b?h=A.lab2rgb(a):void 0!==a.x&&void 0!==a.y&&void 0!==a.z?h=A.xyz2rgb(a):void 0!==a.h&&void 0!==a.s&&void 0!==a.v&&(h=c.hsv2rgb(a));return h},toHSV:function(a){if(void 0!==a.h&&void 0!==a.s&&void 0!==a.v)return a;a=this.toRGB(a);return c.rgb2hsv(a)},toLAB:function(a){return void 0!==a.l&&void 0!==a.a&&void 0!==a.b?a:A.rgb2lab(this.toRGB(a))},toLCH:function(a){return void 0!==
a.l&&void 0!==a.c&&void 0!==a.h?a:A.rgb2lch(this.toRGB(a))},toXYZ:function(a){return void 0!==a.x&&void 0!==a.y&&void 0!==a.z?a:A.rgb2xyz(this.toRGB(a))}}})},"esri/symbols/support/previewSymbol3D":function(){define("require exports ../../core/Error ../../core/Logger ../../core/promiseUtils ../../core/screenUtils ./gfxUtils ./previewUtils ./renderUtils ./styleUtils ./symbolUtils".split(" "),function(A,c,a,h,d,l,m,q,y,x,p){function C(b){var a=b.outline,f=b.get("material.color"),f=f&&f.toRgba().toString();
if(!a)return"fill"===b.type&&"255,255,255,1"===f?{color:"#bdc3c7",width:.75}:null;b=l.pt2px(a.size)||0;return{color:"rgba("+(null!=a.color?a.color.toRgba():"255,255,255,1")+")",width:Math.min(b,80)}}function z(b,a){var f=a&&a.resource,f=f&&f.href;return b.thumbnail&&b.thumbnail.url?d.resolve(b.thumbnail.url):f&&"object"!==a.type?d.resolve(p.getIconHref(b,a)):b.styleOrigin&&(b.styleOrigin.styleName||b.styleOrigin.styleUrl)?x.resolveWebStyleSymbol(b.styleOrigin,{portal:b.styleOrigin.portal}).always(function(b){return b&&
b.thumbnail&&b.thumbnail.url||u}):d.resolve(u)}function k(b,a){void 0===a&&(a=0);if(!b.material||!b.material.color)return b=Math.min(Math.max(m.defaultThematicColor.r+191.25*a,0),255),[b,b,b,100];for(var f=b.material.color.toRgb(),e=0;3>e;e++)f[e]=Math.min(Math.max(f[e]+191.25*a,0),255);f.push(b.material.color.a);return f}function b(b){return b.outline?C(b):{color:"rgba(0, 0, 0, 1)",width:1.5}}function e(b,a){if(!b.material)return{};for(var f=b.material.color.toRgb(),e="rgba(",d=0;3>d;d++)e+=Math.min(Math.max(f[d]+
191.25*a,0),255)+",";e+=b.material.color.a+");";b=b.size?l.pt2px(b.size):.75;return{color:e,width:Math.min(b,80)}}function n(b,a,f){f*=.75;return{type:"linear",x1:f?.25*f:0,y1:f?.5*f:0,x2:f||4,y2:f?.5*f:4,colors:[{color:b,offset:0},{color:a,offset:1}]}}function t(b){var a=b.depth,f=b.height;return(b=b.width)&&a&&f&&b===a&&b<f}function g(a,f,e,d){var g=a&&a.type,c="object"===g,t=[];if("icon"===g)switch(f){case "circle":t.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:k(a,0),stroke:C(a)});break;
case "square":t.push({shape:{type:"path",path:[{command:"M",values:[0,e]},{command:"L",values:[0,0]},{command:"L",values:[e,0]},{command:"L",values:[e,e]},{command:"Z",values:[]}]},fill:k(a,0),stroke:C(a)});break;case "cross":t.push({shape:{type:"path",path:[{command:"M",values:[.5*e,0]},{command:"L",values:[.5*e,e]},{command:"M",values:[0,.5*e]},{command:"L",values:[e,.5*e]},{command:"E",values:[]}]},stroke:b(a)});break;case "x":t.push({shape:{type:"path",path:[{command:"M",values:[0,0]},{command:"L",
values:[e,e]},{command:"M",values:[e,0]},{command:"L",values:[0,e]},{command:"E",values:[]}]},stroke:b(a)});break;case "kite":t.push({shape:{type:"path",path:[{command:"M",values:[0,.5*e]},{command:"L",values:[.5*e,0]},{command:"L",values:[e,.5*e]},{command:"L",values:[.5*e,e]},{command:"Z",values:[]}]},fill:k(a,0),stroke:C(a)})}else if(c)switch(f){case "cone":f=k(a,0);a=k(a,-.6);a=n(f,a,d?20:e);e=q.getConeShapes(e,d);t.push({shape:e[0],fill:a});t.push({shape:e[1],fill:a});break;case "inverted-cone":d=
k(a,0);a=k(a,-.6);a=n(d,a,e);e=q.getInvertedConeShapes(e);t.push({shape:e[0],fill:a});t.push({shape:e[1],fill:d});break;case "cube":e=q.getCubeShapes(e,d);t.push({shape:e[0],fill:k(a,0)});t.push({shape:e[1],fill:k(a,-.3)});t.push({shape:e[2],fill:k(a,-.5)});break;case "cylinder":f=k(a,0);g=k(a,-.6);f=n(f,g,d?20:e);e=q.getCylinderShapes(e,d);t.push({shape:e[0],fill:f});t.push({shape:e[1],fill:f});t.push({shape:e[2],fill:k(a,0)});break;case "diamond":e=q.getDiamondShapes(e);t.push({shape:e[0],fill:k(a,
-.3)});t.push({shape:e[1],fill:k(a,0)});t.push({shape:e[2],fill:k(a,-.3)});t.push({shape:e[3],fill:k(a,-.7)});break;case "sphere":d=k(a,0);a=k(a,-.6);a=n(d,a);a.x1=0;a.y1=0;a.x2=.25*e;a.y2=.25*e;t.push({shape:{type:"circle",cx:0,cy:0,r:.5*e},fill:a});break;case "tetrahedron":e=q.getTetrahedronShapes(e),t.push({shape:e[0],fill:k(a,-.3)}),t.push({shape:e[1],fill:k(a,0)}),t.push({shape:e[2],fill:k(a,-.6)})}return t}function f(b,a){var f=a&&a.size?l.pt2px(a.size):null,e=a&&a.maxSize?l.pt2px(a.maxSize):
null,c=a&&a.disableUpsampling,k=b.symbolLayers,h=[],n=0,r=0,u=k.getItemAt(k.length-1),B;u&&"icon"===u.type&&(B=u.size&&l.pt2px(u.size));k.forEach(function(k,u){if("icon"===k.type||"object"===k.type){u="icon"===k.type?k.size&&l.pt2px(k.size):0;var w=f||u?Math.ceil(Math.min(f||u,e||120)):22,D=C(k),m=D?D.width:0;if(k&&k.resource&&k.resource.href)u=z(b,k).then(function(b){var a=k.get("material.color"),f;f="icon"===k.type?"multiply":"tint";return y.tintImageWithColor(b,w,a,f,c)}).then(function(b){var a=
b.width,f=b.height;n=Math.max(n,a+2*m);r=Math.max(r,f+2*m);return[{shape:{type:"image",width:a,height:f,src:b.url},fill:null,stroke:null}]}),h.unshift(u);else{(D=k.get("resource.primitive"))||(D="icon"===k.type?"circle":"sphere");var H=w;"icon"===k.type&&B&&f&&(H=u/B*w);u=a&&"tall"===a.symbolConfig||("object"===k.type?t(k):!1);n=Math.max(n,u?20:H+2*m);r=Math.max(r,H+2*m);h.unshift(d.resolve(g(k,D,H,u)))}}});return d.eachAlways(h).then(function(b){var f=[];b.forEach(function(b){b.value?f.push(b.value):
b.error&&D.warn("error while building swatchInfo!",b.error)});return y.renderSymbol(f,[n,r],{node:a&&a.node,scale:!1})})}function B(b,a){var f=b.symbolLayers,g=[];b=p.isVolumetricSymbol(b);var c=a&&a.size?l.pt2px(a.size):null,t=(a&&a.maxSize?l.pt2px(a.maxSize):null)||80,h=0,n=0,u;f.forEach(function(b,a){var f=b&&b.type,d="line"===f;if(d||"path"===f){var r=e(b,0),l=r&&r.width||0,f=[];d?(0===a&&(u=l),b=Math.min(c||l,t),b=0===a?b:c?l/u*b:b,n=Math.max(n,b),h=Math.max(h,22<b?2*b:40),r.width=b,f.push({shape:{type:"path",
path:[{command:"M",values:[0,.5*n]},{command:"L",values:[h,.5*n]},{command:"E",values:[]}]},stroke:r})):(a=Math.min(c||22,t),r=k(b,0),d=k(b,-.2),b=e(b,-.4),b.width=1,f.push({shape:q.shapes.pathSymbol3DLayer[0],fill:d,stroke:b}),f.push({shape:q.shapes.pathSymbol3DLayer[1],fill:r,stroke:b}),h=n=Math.max(n,a+2));g.push(f)}});return d.resolve(y.renderSymbol(g,[h,n],{node:a&&a.node,scale:b}))}Object.defineProperty(c,"__esModule",{value:!0});var u=A.toUrl("../../images/Legend/legend3dsymboldefault.png"),
D=h.getLogger("esri.symbols.support.previewSymbol3D");c.getSymbolLayerFill=k;c.previewSymbol3D=function(b,g){if(0===b.symbolLayers.length)return d.reject(new a("symbolPreview: renderPreviewHTML3D","No symbolLayers in the symbol."));var c=null;switch(b.type){case "point-3d":c=f(b,g);break;case "line-3d":c=B(b,g);break;case "polygon-3d":case "mesh-3d":a:{c="mesh-3d"===b.type;b=b.symbolLayers;for(var t=g&&g.size?l.pt2px(g.size):null,h=g&&g.maxSize?l.pt2px(g.maxSize):null,t=t||22,n=[],u=0,r=0,D=!1,z=
0;z<b.length;z++){var m=b.getItemAt(z),H=m.type,p="fill"===H,x="line"===H,A="extrude"===m.type,H=[];if(c&&!p){c=void 0;break a}var F=q.shapes.fill[0];p?(D=(p=C(m))&&p.width||0,u=Math.max(u,t+D),r=Math.max(r,t+D),D=!0,H.push({shape:F,fill:k(m,0),stroke:p})):x?(m=(p=e(m,0))&&p.width||0,F={stroke:p,shape:F},u=Math.max(u,22+m),r=Math.max(r,22+m),H.push(F)):A&&(F=e(m,-.4),p=k(m,0),m=k(m,-.2),x=Math.min(t,h||120),A=q.getExtrudeSymbolShapes(x),F.width=1,H.push({shape:A[0],fill:m,stroke:F}),H.push({shape:A[1],
fill:m,stroke:F}),H.push({shape:A[2],fill:p,stroke:F}),m=22*.7+.5*x,u=Math.max(u,22+2*F.width),r=Math.max(r,m+2*F.width));n.push(H)}c=d.resolve(y.renderSymbol(n,[u,r],{node:g&&g.node,scale:D}))}}return c?c:d.reject(new a("symbolPreview: swatchInfo3D","symbol not supported."))}})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/has"],function(A,c,a){Object.defineProperty(c,"__esModule",{value:!0});c.isVolumetricSymbol=function(a){return(a=a&&a.symbolLayers)?a.some(function(a){a=
a.type;return"object"===a||"path"===a||"extrude"===a}):!1};c.getIconHref=function(d,c){c=c.resource.href;return!a("esri-canvas-svg-support")&&d.styleOrigin&&h.test(c)?c.replace(h,"/resource/png/$1.png"):c};var h=/\/resource\/(.*?)\.svg$/})},"esri/symbols/support/previewWebStyleSymbol":function(){define(["require","exports","../../request","../../core/screenUtils"],function(A,c,a,h){Object.defineProperty(c,"__esModule",{value:!0});c.previewWebStyleSymbol=function(d,c,m){var l=d.thumbnail&&d.thumbnail.url;
return l?a(l,{responseType:"image"}).then(function(a){a=a.data;var d=!/\\.svg$/i.test(a.src)&&m&&m.disableUpsampling,c=Math.max(a.width,a.height),l=m&&null!=m.maxSize?h.pt2px(m.maxSize):120;d&&(l=Math.min(c,l));d=Math.min(l,m&&null!=m.size?h.pt2px(m.size):c);d!==c&&(c=0!==a.width&&0!==a.height?a.width/a.height:1,1<=c?(a.width=d,a.height=d/c):(a.width=d*c,a.height=d));return m&&m.node?(m.node.appendChild(a),m.node):a}):d.fetchSymbol().then(function(a){return c(a,m)})}})},"esri/widgets/Legend/support/colorRampUtils":function(){define("require exports ../../../Color ../../../core/numberUtils ../../../symbols/support/gfxUtils ./utils".split(" "),
function(A,c,a,h,d,l){function m(a,d){var b=d-a;d=[0,.25,.5,.75,1].map(function(e){return Number((a+e*b).toFixed(6))});q(0,4,d);return d}function q(a,d,b){var e=a+(d-a)/2,c=b[0],k=b[1],g=b[2],f=Math.floor(c),h=Math.floor(k),u=Math.floor(g);f===c&&u===g&&h!==k&&f!==h&&u!==h&&(b[e]=h);a+1!==e&&q(a,e,b);e+1!==d&&q(e,d,b)}function y(d,c){d=x(d,c);var b=d.startIndex,e=d.endIndex;if(b===e)return c[b].color;c=a.blendColors(c[b].color,c[e].color,d.weight);return new a(c)}function x(a,d){var b=0,e=d.length-
1;d.some(function(d,c){if(a<d.value)return e=c,!0;b=c;return!1});return{startIndex:b,endIndex:e,weight:(a-d[b].value)/(d[e].value-d[b].value)}}Object.defineProperty(c,"__esModule",{value:!0});var p=[64,64,64],C=[255,255,255];c.getRampBorderColor=function(a){var c=null;if("simple"===a.type)c=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)c=(a=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&a.symbol;return(a=(a=c&&-1===c.type.indexOf("line-symbol")?d.getStroke(c):null)&&a.color)&&
0<a.a&&!(240<=a.r&&240<=a.g&&240<=a.b)?a:null};c.getRampOverlayColor=function(d){var c=new a(C);c.a=1-d;return c};c.getRampStops=function(d,c,b){var e=!1,k=[],t=[];if(c.colors||c.opacityValues)k=m(c.minDataValue,c.maxDataValue);else if(c.stops){var g=c.stops,k=g.map(function(a){return a.value});(e=g.some(function(a){return!!a.label}))&&(t=g.map(function(a){return a.label}))}var f=k[0],g=k[k.length-1];if(null==f&&null==g)return null;var B=g-f;return k.map(function(g,n){var r;if("opacity"===c.type){r=
b;void 0===r&&(r=p);r=new a(r);var u=d.getOpacity(g,{opacityInfo:c});null!=u&&(r.a=u)}else r=d.getColor(g,{colorInfo:c});n=e?t[n]:l.getLabelPrefix(n,k.length-1)+h.format(g);return{value:g,color:r,label:n,offset:B?1-(g-f)/B:1}}).reverse()};c.getRampStopsForPointCloud=function(a){var d=!1,b=[],e=[],b=a.map(function(a){return a.value});(d=a.some(function(a){return!!a.label}))&&(e=a.map(function(a){return a.label}));var c=b[0],t=b[b.length-1];if(null==c&&null==t)return null;var g=t-c;return b.map(function(f,
t){var k=y(f,a);t=d?e[t]:l.getLabelPrefix(t,b.length-1)+h.format(f);return{value:f,color:k,label:t,offset:g?1-(f-c)/g:1}}).reverse()};c.getColorFromPointCloudStops=y})},"esri/widgets/Legend/support/utils":function(){define(["require","exports"],function(A,c){Object.defineProperty(c,"__esModule",{value:!0});c.getLabelPrefix=function(a,c){return 0===a?"\x3c ":a===c?"\x3e ":""}})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["require","exports","../../../renderers/support/HeatmapColorStop"],
function(A,c,a){Object.defineProperty(c,"__esModule",{value:!0});c.getHeatmapRampStops=function(c){c=c.colorStops;var d=c.length-1;if(c&&c[0]){var h=c[d];h&&1!==h.ratio&&(c=c.slice(0),c.push(new a.HeatmapColorStop({ratio:1,color:h.color})),d++)}return c.map(function(a,c){var h="";0===c?h="low":c===d&&(h="high");return{color:a.color,label:h,ratio:a.ratio,offset:1-a.ratio}}).reverse()}})},"esri/widgets/Legend/support/relationshipRampUtils":function(){define("require exports dojox/gfx dojox/gfx/matrix ../../../symbols ../../../symbols/support/gfxUtils ../../../symbols/support/previewSymbol3D".split(" "),
function(A,c,a,h,d,l,m){function q(a){if(a){var b=a.type;return-1<b.indexOf("3d")?m.getSymbolLayerFill(a.symbolLayers.getItemAt(0)):"simple-line"===b||"simple-marker"===a.type&&(a.style===d.SimpleMarkerSymbol.STYLE_X||a.style===d.SimpleMarkerSymbol.STYLE_CROSS)?(a=l.getStroke(a))&&a.color:l.getFill(a)}}function y(a,e){var b=e.HH.label,d=e.LL.label,c=e.HL.label;e=e.LH.label;switch(a){case "HH":return{top:b,bottom:d,left:c,right:e};case "HL":return{top:c,bottom:e,left:d,right:b};case "LL":return{top:d,
bottom:b,left:e,right:c};case "LH":return{top:e,bottom:c,left:b,right:d};default:return{top:b,bottom:d,left:c,right:e}}}function x(a){var b=z[a];a&&null==b&&(b=z.HH);return b||0}function p(a,e,d,c){var b=c+"_arrowStart";c+="_arrowEnd";e="left"===e;switch(d){case "HL":a.setAttribute(e?"marker-start":"marker-end","url(#"+(e?c:b)+")");break;case "LL":a.setAttribute("marker-start","url(#"+c+")");break;case "LH":a.setAttribute(e?"marker-end":"marker-start","url(#"+(e?b:c)+")");break;default:a.setAttribute("marker-end",
"url(#"+b+")")}}function C(a,e,d){var b="start"===e;e=b?d+"_arrowStart":d+"_arrowEnd";d=b?"0,0 5,5 0,10":"5,0 0,5 5,10";var c=b?"5":"0",b=document.createElementNS("http://www.w3.org/2000/svg","marker");b.setAttribute("id",e);b.setAttribute("markerWidth","10");b.setAttribute("markerHeight","10");b.setAttribute("refX",c);b.setAttribute("refY","5");b.setAttribute("markerUnits","strokeWidth");b.setAttribute("orient","auto");e=document.createElementNS("http://www.w3.org/2000/svg","polyline");e.setAttribute("points",
d);e.setAttribute("fill","none");e.setAttribute("stroke","#555555");e.setAttribute("stroke-width","1");b.appendChild(e);a.appendChild(b)}Object.defineProperty(c,"__esModule",{value:!0});var z={HH:315,HL:45,LL:135,LH:225},k={2:[["HL","HH"],["LL","LH"]],3:[["HL","HM","HH"],["ML","MM","MH"],["LL","LM","LH"]],4:[["HL","HM1","HM2","HH"],["M2L","M2M1","M2M2","M2H"],["M1L","M1M1","M1M2","M1H"],["LL","LM1","LM2","LH"]]};c.getRelationshipRampElement=function(a){var b=a.focus,d=a.numClasses,c=k[d],g={};a.infos.forEach(function(a){g[a.value]=
{label:a.label,fill:q(a.symbol)}});a=[];for(var f=0;f<d;f++){for(var h=[],u=0;u<d;u++)h.push(g[c[f][u]].fill);a.push(h)}c=y(b,g);return{type:"relationship-ramp",numClasses:d,focus:b,colors:a,labels:c,rotation:x(b)}};c.getRotationAngleForFocus=x;c.renderRamp=function(b,d,c){void 0===c&&(c=60);var e=b.focus,g=b.numClasses,f=b.colors,k=b.rotation;b=!!e;var u=Math.sqrt(Math.pow(c,2)+Math.pow(c,2))+(b?0:5),n=document.createElement("div"),r=a.createSurface(n,u,u),m=l.create2DColorRamp({surface:r,colors:f,
numClasses:g,size:c}),g=(u-c)/2,u=(u-c)/2;m.applyTransform(h.translate(g,u));var f=c/2,w=c/2;m.applyTransform(h.rotategAt(k,f,w));var k=r.createGroup(),m={width:1,color:"#555555"},z=r.defNode;C(z,"start",d);C(z,"end",d);z=k.createLine({x1:-10,y1:c-15,x2:-10,y2:15}).setStroke(m);c=k.createLine({x1:15,y1:c+10,x2:c-15,y2:c+10}).setStroke(m);p(z.rawNode,"left",e,d);p(c.rawNode,"right",e,d);k.applyTransform(h.translate(g,u));b?k.applyTransform(h.rotategAt(-45,f,w)):r.rawNode.style.margin="-15px -15px -18px -15px";
return n}})},"esri/widgets/Legend/support/sizeRampUtils":function(){define("require exports ../../../symbols ../../../core/numberUtils ../../../symbols/support/symbolUtils ./utils".split(" "),function(A,c,a,h,d,l){function m(a,d){var f=null,e=null;if("simple"===a.type)f=a.symbol;else if("unique-value"===a.type||"class-breaks"===a.type)f=(f=(a=a.classBreakInfos||a.uniqueValueInfos)&&a[0])&&f.symbol,e=1<a.length;if(!f||q(f))return null;f=f.clone();if(d||e)-1<f.type.indexOf("3d")?y(f):(d=f,-1!==d.type.indexOf("line")?
d.color=n:(d.color=b,"simple-marker"===d.type&&(d.outline={color:n,width:1.5})));return f}function q(b){if(b)return a.isSymbol3D(b)?b.symbolLayers?b.symbolLayers.some(function(a){return a&&"fill"===a.type}):!1:-1!==b.type.indexOf("fill")}function y(a){d.isVolumetricSymbol(a)||("line-3d"===a.type?a.symbolLayers.forEach(function(a){a.material={color:n}}):a.symbolLayers.forEach(function(a){"icon"!==a.type||a.resource&&a.resource.href?a.material={color:e}:(a.material={color:b},a.outline={color:n,size:1.5})}))}
function x(a,b,f,d){var e=a.getSizeRangeAtScale(b,d),c=e&&p(e);if(e||c){for(var g=c.map(function(a){var f=e.minSize,d=e.maxSize,c=b.minDataValue,g=b.maxDataValue;return a<=f?c:a>=d?g:(a-f)/(d-f)*(g-c)+c}),g=h.round(g),k=1;k<g.length-1;k++){var t=C(a,b,f,g[k],g[k-1],d);t&&(g[k]=t[0],c[k]=t[1])}return g}}function p(a){var b=a.minSize;a=(a.maxSize-b)/4;for(var f=[],d=0;5>d;d++)f.push(b+a*d);return f}function C(a,b,f,d,e,c){var g,k=z(a,b,f,d,c);e=z(a,b,f,e,c);var t=h.numDigits(d),u=t.fractional,l=t.integer,
n=t=null;0<d&&1>d&&(t=Math.pow(10,u),d*=t,l=h.numDigits(d).integer);for(u=l-1;0<=u;u--){var m=Math.pow(10,u),l=Math.floor(d/m)*m,m=Math.ceil(d/m)*m;null!=t&&(l/=t,m/=t);g=(l+m)/2;g=h.round([l,g,m],{indexes:[1]});g=g[1];var D=z(a,b,f,l,c),B=z(a,b,f,m,c),q=z(a,b,f,g,c),C=h.percentChange(k,D,e,null),p=h.percentChange(k,B,e,null),y=h.percentChange(k,q,e,null),x=20>=C.previous,A=20>=p.previous;x&&A&&(C.previous<=p.previous?(x=!0,A=!1):(A=!0,x=!1));x?n=[l,D]:A?n=[m,B]:20>=y.previous&&(n=[g,q]);if(n)break}return n}
function z(a,b,f,d,e){return a.getSize(d,{sizeInfo:b,scale:e,shape:-1!==f.type.indexOf("marker-symbol")?f.style:null})}function k(b,e){b=b.clone();if(a.isSymbol3D(b))d.isVolumetricSymbol(b)||b.symbolLayers.forEach(function(a){"fill"!==a.type&&(a.size=e)});else if("esri.symbols.SimpleMarkerSymbol"===b.declaredClass)b.size=e;else if("esri.symbols.PictureMarkerSymbol"===b.declaredClass){var f=b.width,c=b.height;b.height=e;b.width=f/c*e}else"esri.symbols.SimpleLineSymbol"===b.declaredClass?b.width=e:
"esri.symbols.TextSymbol"===b.declaredClass&&b.font&&(b.font.size=e);return b}Object.defineProperty(c,"__esModule",{value:!0});c.REAL_WORLD_MAX_SIZE=30;c.REAL_WORLD_MIN_SIZE=12;var b=[255,255,255],e=[200,200,200],n=[128,128,128];c.getRampStops=function(a,b,f,e){var g=b.legendOptions,g=g&&g.customValues,n=m(a,f);f=null!=b.minSize&&null!=b.maxSize;var r=b.stops&&1<b.stops.length,t=!!b.target;if(n&&(g||f||r&&!t)){var w=d.isVolumetricSymbol(n),B=null,q=null,C=null,q=w&&!r?h.round([b.minDataValue,b.maxDataValue]):
g||x(a,b,n,e);!q&&r&&(q=b.stops.map(function(a){return a.value}),(B=b.stops.some(function(a){return!!a.label}))&&(C=b.stops.map(function(a){return a.label})));g=!w||q&&2===q.length;if(!q||!g)return null;var p=[c.REAL_WORLD_MIN_SIZE,c.REAL_WORLD_MAX_SIZE];return q.map(function(f,d){var c=w?p[d]:z(a,b,n,f,e),g=k(n,c);d=B?C[d]:l.getLabelPrefix(d,q.length-1)+h.format(f);return{value:f,symbol:g,label:d,size:c}}).reverse()}}})},"esri/widgets/Legend/styles/Card":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../../nls/common dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/lang ../../../core/screenUtils ../../../core/accessorSupport/decorators ../../Widget ./common ../support/styleUtils ../../support/colorUtils ../../support/widget".split(" "),
function(A,c,a,h,d,l,m,q,y,x,p,C,z,k,b){var e;(function(a){a.Auto="auto";a.Stack="stack";a.SideBySide="side-by-side"})(e||(e={}));var n=function(a){return{width:y.pt2px(a.width),height:y.pt2px(a.height)}};return function(c){function g(a){a=c.call(this)||this;a._hasIndicators=!1;a._selectedSectionName=null;a._sectionNames=[];a._sectionMap=new Map;a.activeLayerInfos=null;a.layout=e.Stack;a.type="card";a.view=null;return a}a(g,c);g.prototype.render=function(){var a=this,c;this._sectionNames.length=0;
this._hasIndicators=this.layout===e.Auto&&768>=this.view.container.clientWidth||this.layout===e.Stack;var g=this.activeLayerInfos,k=g&&g.toArray().map(function(b){return a._renderLegendForLayer(b)}).filter(function(a){return!!a});this._hasIndicators?this._selectedSectionName&&-1!==this._sectionNames.indexOf(this._selectedSectionName)||(this._selectedSectionName=this._sectionNames&&this._sectionNames[0]):this._selectedSectionName=null;var h=this._sectionNames.length,g=this._sectionNames.map(function(f,
e){var c;e=q.substitute({index:e+1,total:h},d.pagination.pageText);return b.tsx("div",{key:f,"aria-label":e,title:e,tabIndex:0,onclick:a._selectSection,onkeydown:a._selectSection,bind:a,class:a.classes("esri-legend--card__carousel-indicator",(c={},c["esri-legend--card__carousel-indicator--activated"]=a._selectedSectionName===f,c)),"data-section-name":f})}),g=this._hasIndicators?b.tsx("div",{class:"esri-legend--card__carousel-indicator-container",key:"carousel-navigation"},g):null,k=this._hasIndicators?
this._sectionMap.get(this._selectedSectionName):k&&k.length?k:null,n=(c={},c["esri-legend--stacked"]=this._hasIndicators,c);return b.tsx("div",{class:this.classes("esri-legend--card esri-widget",n)},g,k?k:b.tsx("div",{class:"esri-legend--card__message"},l.noLegend))};g.prototype._selectSection=function(a){if(a=a.target.getAttribute("data-section-name"))this._selectedSectionName=a};g.prototype._renderLegendForLayer=function(a){var d=this,e;if(!a.ready)return null;var f="esri-legend--card__"+a.layer.uid+
"-version-"+a.version;if(a.children.length)return e=a.children.map(function(a){return d._renderLegendForLayer(a)}).toArray(),this._sectionNames.push(f),b.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service","esri-legend--card__group-layer")},b.tsx("div",{class:"esri-legend--card__service-caption-container"},a.title),e);if((f=a.legendElements)&&!f.length)return null;var c=f.some(function(a){return"relationship-ramp"===a.type}),f=f.map(function(b){return d._renderLegendForElement(b,
a.layer,c)}).filter(function(a){return!!a});if(!f.length)return null;var g=(e={},e["esri-legend--card__group-layer-child"]=!!a.parent,e);return b.tsx("div",{key:a.layer.uid,class:this.classes("esri-legend--card__service",g)},b.tsx("div",{class:"esri-legend--card__service-caption-container"},b.tsx("div",{class:"esri-legend--card__service-caption-text"},a.title)),b.tsx("div",{class:"esri-legend--card__service-content"},f))};g.prototype._renderLegendForElement=function(a,d,e){var f=this;void 0===e&&
(e=!1);var c,g="color-ramp"===a.type,k="opacity-ramp"===a.type,h="size-ramp"===a.type,l=a.title,n=null;"string"===typeof l?n=l:l&&(n=z.getTitle(l,g||k),n=l.title?l.title+" ("+n+")":n);l="esri-legend--card__"+d.uid+"-type-"+a.type;n=this._hasIndicators?b.tsx("div",null,b.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend--card__carousel-title")},d.title),b.tsx("h4",{class:this.classes("esri-widget__heading","esri-legend--card__layer-caption")},n)):n?b.tsx("h4",{class:this.classes("esri-widget__heading",
"esri-legend--card__layer-caption")},n):null;g=null;"symbol-table"===a.type?(h=a.infos.map(function(b){return f._renderLegendForElementInfo(b,d,a.legendType)}).filter(function(a){return!!a}),h.length&&(g=h[0].properties.classes&&h[0].properties.classes["esri-legend--card__symbol-row"],e=(c={},c["esri-legend--card__label-container"]=!g&&!e,c["esri-legend--card__relationship-label-container"]=e,c),g=b.tsx("div",{key:l,class:"esri-legend--card__section"},n,b.tsx("div",{class:this.classes(e)},h)))):"color-ramp"===
a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?g=b.tsx("div",{key:l,class:"esri-legend--card__section"},n,this._renderLegendForRamp(a)):h?g=b.tsx("div",{key:l,class:"esri-legend--card__section"},n,this._renderSizeRamps(a.infos)):"relationship-ramp"===a.type&&(g=b.tsx("div",{key:l,class:this.classes("esri-legend--card__section","esri-legend--card__relationship-section")},n,C.renderRelationshipRamp(a,this.id)));if(!g)return null;this._sectionNames.push(l);this._sectionMap.set(l,g);return g};
g.prototype._renderLegendForElementInfo=function(a,d,e){var c,f,g;if(a.type)return this._renderLegendForElement(a,d);e=z.isImageryStretchedLegend(d,e);if(a.symbol&&a.preview){if(-1===a.symbol.type.indexOf("simple-fill")){if(!a.label)return b.tsx("div",{bind:a.preview,afterCreate:z.attachToNode});d=(c={},c["esri-legend--card__symbol-cell"]=this._hasIndicators,c);return b.tsx("div",{class:this.classes("esri-legend--card__layer-row",(f={},f["esri-legend--card__symbol-row"]=this._hasIndicators,f))},b.tsx("div",
{class:this.classes(d),bind:a.preview,afterCreate:z.attachToNode}),b.tsx("div",{class:this.classes("esri-legend--card__image-label",(g={},g["esri-legend--card__label-cell"]=this._hasIndicators,g))},z.getTitle(a.label,!1)||""))}g=f=c=255;d=0;var h=e=255,l=255,n=0,m=a.symbol.color&&a.symbol.color.a,t=a.symbol.outline&&a.symbol.outline.color.a;m&&(c=a.symbol.color.r,f=a.symbol.color.g,g=a.symbol.color.b,d=a.symbol.color.a);t&&(e=a.symbol.outline.color.r,h=a.symbol.outline.color.g,l=a.symbol.outline.color.b,
n=a.symbol.outline.color.a);var u=k.isBright(a.symbol.color),q=u?"rgba(255, 255, 255, .6)":"rgba(0, 0, 0, .6)";return b.tsx("div",{class:"esri-legend--card__layer-row"},b.tsx("div",{key:a.label,class:"esri-legend--card__label-element",styles:{background:m?"rgba("+c+", "+f+", "+g+", "+d+")":"none",color:u?"black":"white",textShadow:"-1px -1px 0 "+q+",\n                                              1px -1px 0 "+q+",\n                                              -1px 1px 0 "+q+",\n                                              1px 1px 0 "+
q,border:t?"1px solid rgba("+e+", "+h+", "+l+", "+n+")":"none"}}," ",a.label," "))}if(a.src)return c=this._renderImage(a,d,e),b.tsx("div",{class:"esri-legend--card__layer-row"},c,b.tsx("div",{class:"esri-legend--card__image-label"},a.label||""))};g.prototype._renderImage=function(a,d,e){var c,f=a.label,g=a.src,k=a.opacity;e=(c={},c["esri-legend--card__imagery-layer-image--stretched"]=e,c["esri-legend--card__symbol"]=!e,c);d={opacity:""+(null!=k?k:d.opacity)};return b.tsx("img",{alt:f,src:g,border:0,
width:a.width,height:a.height,class:this.classes(e),styles:d})};g.prototype._renderSizeRamps=function(a){var d,e=document.createElement("div"),c,f=a[a.length-1].symbol.color,g,k,h=a[0].label,l=a[a.length-1].label,t=a[0].symbol.style&&"circle"===a[0].symbol.style;try{if(this._hasIndicators)if(k=100,t){var q=y.pt2px(a[0].symbol.size),C=y.pt2px(a[a.length-1].symbol.size),p=q/2,x=C/2;g=2*p+2;var A=k-p-x,N=Math.sqrt(Math.pow(A,2)-Math.pow(p-x,2)),I=p*N/A,O=p+I,P=p+Math.sqrt(Math.pow(p,2)-Math.pow(I,2)),
F=x*I/p,v=p+F,Q=k-(x-Math.sqrt(Math.pow(x,2)-Math.pow(F,2))),I=p-I,F=p-F;c=m.createSurface(e,g,k);c.createCircle({cx:p,cy:p,r:p}).setFill(f).setStroke({color:"#ddd",width:1});c.createCircle({cx:p,cy:k-x,r:x}).setFill(f).setStroke({color:"#ddd",width:1});c.createLine({x1:O,y1:P,x2:v,y2:Q}).setStroke({color:"#ddd",width:1});c.createLine({x1:I,y1:P,x2:F,y2:Q}).setStroke({color:"#ddd",width:1})}else{var Z=n(a[0].symbol),V=Z.width,W=Z.height,aa=n(a[a.length-1].symbol),X=aa.width,Y=aa.height,E=Math.max(V,
W),G=Math.max(X,Y);g=E;c=m.createSurface(e,g,k);c.createRect({x:0,y:0,height:E,width:E}).setStroke({color:"#ddd",width:1});c.createRect({x:E/2-G/2,y:k-G,height:G,width:G}).setStroke({color:"#ddd",width:1});c.createImage({src:a[0].symbol.url,height:E,width:E});c.createImage({src:a[a.length-1].symbol.url,height:G,width:G,y:k-G,x:E/2-G/2});c.createLine({x1:0,y1:E,x2:E/2-G/2,y2:k-G}).setStroke({color:"#ddd",width:1});c.createLine({x1:g,y1:E,x2:E/2+G/2,y2:k-G}).setStroke({color:"#ddd",width:1})}else{g=
180;if(t)q=y.pt2px(a[0].symbol.size),C=y.pt2px(a[a.length-1].symbol.size),p=q/2,x=C/2,k=2*p,A=g-p-x,N=Math.sqrt(Math.pow(A,2)-Math.pow(p-x,2)),I=p*N/A,P=p-I,O=g-(p+Math.sqrt(Math.pow(p,2)-Math.pow(I,2))),F=x*I/p,Q=p-F,v=x-Math.sqrt(Math.pow(x,2)-Math.pow(F,2)),I=p+I,F=p+F,c=m.createSurface(e,g,k),c.createCircle({cx:g-p,cy:p,r:p}).setFill(f).setStroke({color:"#ddd",width:1}),c.createCircle({cx:x,cy:p,r:x}).setFill(f).setStroke({color:"#ddd",width:1}),c.createLine({x1:O,y1:P,x2:v,y2:Q}).setStroke({color:"#ddd",
width:1}),c.createLine({x1:O,y1:I,x2:v,y2:F}).setStroke({color:"#ddd",width:1});else{var ba=n(a[0].symbol),V=ba.width,W=ba.height,ca=n(a[a.length-1].symbol),X=ca.width,Y=ca.height,E=Math.max(V,W),G=Math.max(X,Y);c=m.createSurface(e,g,E);c.createRect({x:0,y:E/2-G/2,height:G,width:G}).setStroke({color:"#ddd",width:1});c.createRect({x:g-E,y:0,height:E,width:E}).setStroke({color:"#ddd",width:1});c.createImage({src:a[a.length-1].symbol.url,height:G,width:G,y:E/2-G/2});c.createImage({src:a[0].symbol.url,
height:E,width:E,x:g-E});c.createLine({x1:G,y1:E/2-G/2,x2:g-E,y2:0}).setStroke({color:"#ddd",width:1});c.createLine({x1:G,y1:E/2+G/2,x2:g-E,y2:E}).setStroke({color:"#ddd",width:1})}f=h;h=l;l=f}}catch(da){c.clear(),c.destroy()}return c?b.tsx("div",{class:this.classes("esri-legend--card__layer-row",(d={},d["esri-legend--card__size-ramp-row"]=this._hasIndicators,d))},b.tsx("div",{class:"esri-legend--card__ramp-label"},h),b.tsx("div",{class:"esri-legend--card__size-ramp-container"},b.tsx("div",{bind:e,
afterCreate:z.attachToNode})),b.tsx("div",{class:"esri-legend--card__ramp-label"},l)):null};g.prototype._renderLegendForRamp=function(a){var d=a.infos,e="heatmap-ramp"===a.type,c=d.length-1,f=2<c&&!e?25*c:100,g=f+20;a=document.createElement("div");a.style.width=g+"px";var k=m.createSurface(a,g,25),h=d.slice(0).reverse();try{h.forEach(function(a,b){a.offset=e?a.ratio:b/c}),e||k.createPath("M0 12.5 L10 0 L10 25 Z").setFill(h[0].color).setStroke(null),k.createRect({x:10,y:0,width:f,height:25}).setFill({type:"linear",
x1:10,y1:0,x2:f+10,y2:0,colors:h}).setStroke(null),e||k.createPath("M"+(f+10)+" 0 L"+g+" 12.5 L"+(f+10)+" 25 Z").setFill(h[h.length-1].color).setStroke(null)}catch(L){k.clear(),k.destroy()}if(!k)return null;f=h.filter(function(a,b){return!!a.label&&0!==b&&b!==h.length-1}).map(function(a){return b.tsx("div",{class:"esri-legend--card__interval-separators-container"},b.tsx("div",{class:"esri-legend--card__interval-separator"},"|"),b.tsx("div",{class:"esri-legend--card__ramp-label"},a.label))});g=d[d.length-
1].label;d=d[0].label;return b.tsx("div",{class:"esri-legend--card__layer-row"},b.tsx("div",{class:"esri-legend--card__ramp-label"},e?l[g]:g),b.tsx("div",{class:"esri-legend--card__symbol-container"},b.tsx("div",{bind:a,afterCreate:z.attachToNode}),f),b.tsx("div",{class:"esri-legend--card__ramp-label"},e?l[d]:d))};h([b.renderable(),x.property()],g.prototype,"activeLayerInfos",void 0);h([x.property()],g.prototype,"layout",void 0);h([x.property({readOnly:!0})],g.prototype,"type",void 0);h([x.property()],
g.prototype,"view",void 0);h([b.accessibleHandler()],g.prototype,"_selectSection",null);return g=h([x.subclass("esri.widgets.Legend.styles.Card")],g)}(x.declared(p))})},"esri/widgets/Legend/styles/common":function(){define(["require","exports","../support/relationshipRampUtils","../support/styleUtils","../../support/widget"],function(A,c,a,h,d){Object.defineProperty(c,"__esModule",{value:!0});c.renderRelationshipRamp=function(c,m){var l=c.labels,y=!!c.focus;c=a.renderRamp(c,m);return y?d.tsx("div",
{class:"esri-relationship-ramp--diamond__container"},d.tsx("div",{class:"esri-relationship-ramp--diamond__left-column"},l.left),d.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column"},d.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},l.top),d.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--ramp",bind:c,afterCreate:h.attachToNode}),d.tsx("div",{class:"esri-relationship-ramp--diamond__middle-column--label"},l.bottom)),d.tsx("div",{class:"esri-relationship-ramp--diamond__right-column"},
l.right)):d.tsx("div",{class:"esri-relationship-ramp--square__table"},d.tsx("div",{class:"esri-relationship-ramp--square__table-row"},d.tsx("div",{class:d.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-bottom")},l.left),d.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),d.tsx("div",{class:d.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label",
"esri-relationship-ramp--square__table-label--left-bottom")},l.top)),d.tsx("div",{class:"esri-relationship-ramp--square__table-row"},d.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),d.tsx("div",{class:"esri-relationship-ramp--square__table-cell",bind:c,afterCreate:h.attachToNode}),d.tsx("div",{class:"esri-relationship-ramp--square__table-cell"})),d.tsx("div",{class:"esri-relationship-ramp--square__table-row"},d.tsx("div",{class:d.classes("esri-relationship-ramp--square__table-cell",
"esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--right-top")},l.bottom),d.tsx("div",{class:"esri-relationship-ramp--square__table-cell"}),d.tsx("div",{class:d.classes("esri-relationship-ramp--square__table-cell","esri-relationship-ramp--square__table-label","esri-relationship-ramp--square__table-label--left-top")},l.right)))}})},"esri/widgets/Legend/support/styleUtils":function(){define(["require","exports","dojo/i18n!../../Legend/nls/Legend","../../../core/lang"],
function(A,c,a,h){Object.defineProperty(c,"__esModule",{value:!0});c.attachToNode=function(a){a.appendChild(this)};c.getTitle=function(d,c){if(d){if("string"===typeof d)return d;var l=null;c?l=d.ratioPercentTotal?"showRatioPercentTotal":d.ratioPercent?"showRatioPercent":d.ratio?"showRatio":d.normField?"showNormField":d.field?"showField":null:c||(l=d.normField?"showNormField":d.normByPct?"showNormPct":d.field?"showField":null);return l?h.substitute({field:d.field,normField:d.normField},"showField"===
l?"{field}":a[l]):null}};c.isRendererTitle=function(a,c){return!c};c.isImageryStretchedLegend=function(a,c){return!!(c&&"Stretched"===c&&10.3<=a.version&&"esri.layers.ImageryLayer"===a.declaredClass)}})},"esri/widgets/support/colorUtils":function(){define(["require","exports","../../Color"],function(A,c,a){function h(d){return new a(d)}function d(a){return!!a&&4===a.length&&x.test(a)}function l(a){return!!a&&7===a.length&&p.test(a)}function m(a){return 127<=.299*a.r+.587*a.g+.114*a.b}function q(d,
c){void 0===c&&(c=1);c=Math.pow(.7,c);return new a([Math.round(d.r*c),Math.round(d.g*c),Math.round(d.b*c),d.a])}function y(c,d){void 0===d&&(d=1);d=Math.pow(.7,d);var k=c.r,b=c.g,e=c.b;30>k&&(k=30);30>b&&(b=30);30>e&&(e=30);return new a([Math.min(255,Math.round(k/d)),Math.min(255,Math.round(b/d)),Math.min(255,Math.round(e/d)),c.a])}Object.defineProperty(c,"__esModule",{value:!0});var x=/^#[0-9A-F]{3}$/i,p=/^#[0-9A-F]{6}$/i;c.equal=function(a,d){return a&&d&&a.r===d.r&&a.g===d.g&&a.b===d.b&&a.a===
d.a};c.normalizeHex=function(a){return a?"#"+a.trim().replace(/#/g,"").substr(0,6):""};c.normalizeColor=h;c.isValidHex=function(a){return d(a)||l(a)};c.isShorthandHex=d;c.isLonghandHex=l;c.toHex=function(a){return h(a).toHex()};c.getContrastingColor=function(a){return m(a)?q(a):y(a,3)};c.isBright=m;c.darker=q;c.brighter=y})},"esri/widgets/Legend/styles/Classic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/i18n!../../Legend/nls/Legend dojox/gfx ../../../core/accessorSupport/decorators ../../Widget ./common ../support/styleUtils ../../support/widget".split(" "),
function(A,c,a,h,d,l,m,q,y,x,p){return function(c){function q(a){a=c.call(this)||this;a.activeLayerInfos=null;a.type="classic";return a}a(q,c);q.prototype.render=function(){var a=this,b=this.activeLayerInfos,c=this.classes("esri-legend esri-widget--panel","esri-widget"),b=b&&b.toArray().map(function(b){return a._renderLegendForLayer(b)}).filter(function(a){return!!a});return p.tsx("div",{class:c},b&&b.length?b:p.tsx("div",{class:"esri-legend__message"},d.noLegend))};q.prototype._renderLegendForLayer=
function(a){var b=this,d;if(!a.ready)return null;var c=!!a.children.length,k="esri-legend__"+a.layer.uid+"-version-"+a.version,g=a.title?p.tsx("h3",{class:this.classes("esri-widget__heading","esri-legend__service-label")},a.title):null;if(c)return d=a.children.map(function(a){return b._renderLegendForLayer(a)}).toArray(),p.tsx("div",{key:k,class:this.classes("esri-legend__service","esri-legend__group-layer")},g,d);if((c=a.legendElements)&&!c.length)return null;c=c.map(function(d){return b._renderLegendForElement(d,
a.layer)}).filter(function(a){return!!a});if(!c.length)return null;var f=(d={},d["esri-legend__group-layer-child"]=!!a.parent,d);return p.tsx("div",{key:k,class:this.classes("esri-legend__service",f)},g,p.tsx("div",{class:"esri-legend__layer"},c))};q.prototype._renderLegendForElement=function(a,b,d){var c=this,e,g="color-ramp"===a.type,f="opacity-ramp"===a.type,k="size-ramp"===a.type,h=null;if("symbol-table"===a.type||k){var l=a.infos.map(function(d){return c._renderLegendForElementInfo(d,b,k,a.legendType)}).filter(function(a){return!!a});
l.length&&(h=p.tsx("div",{class:"esri-legend__layer-body"},l))}else"color-ramp"===a.type||"opacity-ramp"===a.type||"heatmap-ramp"===a.type?h=this._renderLegendForRamp(a):"relationship-ramp"===a.type&&(h=y.renderRelationshipRamp(a,this.id));if(!h)return null;var l=a.title,m=null;"string"===typeof l?m=l:l&&(m=x.getTitle(l,g||f),m=x.isRendererTitle(l,g||f)&&l.title?l.title+" ("+m+")":m);g=d?"esri-legend__layer-child-table":"esri-legend__layer-table";f=m?p.tsx("div",{class:"esri-legend__layer-caption"},
m):null;d=(e={},e["esri-legend__layer-table--size-ramp"]=k||!d,e);return p.tsx("div",{class:this.classes(g,d)},f,h)};q.prototype._renderLegendForRamp=function(a){var b=a.infos,c="opacity-ramp"===a.type,h="heatmap-ramp"===a.type,k=b.length-1,g=null;2<k&&!h?g=25*k:g=h?75:50;var f=document.createElement("div");f.className="esri-legend__color-ramp "+(c?"esri-legend__opacity-ramp":"");f.style.height=g+"px";c=l.createSurface(f,"100%",g);try{if(h||b.forEach(function(a,b){a.offset=b/k}),c.createRect({x:0,
y:0,width:"100%",height:g}).setFill({type:"linear",x1:0,y1:0,x2:0,y2:g,colors:b}).setStroke(null),"color-ramp"===a.type||"opacity-ramp"===a.type){var m=a.overlayColor;m&&0<m.a&&c.createRect({x:0,y:0,width:"100%",height:g}).setFill(m).setStroke(null)}}catch(u){c.clear(),c.destroy()}if(!c)return null;a=b.filter(function(a){return!!a.label}).map(function(a){return p.tsx("div",{class:"esri-legend__ramp-label"},h?d[a.label]:a.label)});g={height:g+"px"};return p.tsx("div",{class:"esri-legend__layer-row"},
p.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--symbols",styles:{width:"24px"}},p.tsx("div",{class:"esri-legend__ramps",bind:f,afterCreate:x.attachToNode})),p.tsx("div",{class:"esri-legend__layer-cell esri-legend__layer-cell--info"},p.tsx("div",{class:"esri-legend__ramp-labels",styles:g},a)))};q.prototype._renderLegendForElementInfo=function(a,b,d,c){var e,g;if(a.type)return this._renderLegendForElement(a,b,!0);var f=null;c=x.isImageryStretchedLegend(b,c);a.symbol&&a.preview?
f=p.tsx("div",{class:"esri-legend__symbol",bind:a.preview,afterCreate:x.attachToNode}):a.src&&(f=this._renderImage(a,b,c));if(!f)return null;b=(e={},e["esri-legend__imagery-layer-info--stretched"]=c,e);d=(g={},g["esri-legend__imagery-layer-info--stretched"]=c,g["esri-legend__size-ramp"]=!c&&d,g);return p.tsx("div",{class:"esri-legend__layer-row"},p.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--symbols",d)},f),p.tsx("div",{class:this.classes("esri-legend__layer-cell esri-legend__layer-cell--info",
b)},x.getTitle(a.label,!1)||""))};q.prototype._renderImage=function(a,b,c){var d,e=a.label,g=a.src,f=a.opacity;c=(d={},d["esri-legend__imagery-layer-image--stretched"]=c,d["esri-legend__symbol"]=!c,d);b={opacity:""+(null!=f?f:b.opacity)};return p.tsx("img",{alt:e,src:g,border:0,width:a.width,height:a.height,class:this.classes(c),styles:b})};h([p.renderable(),m.property()],q.prototype,"activeLayerInfos",void 0);h([m.property({readOnly:!0})],q.prototype,"type",void 0);return q=h([m.subclass("esri.widgets.Legend.styles.Classic")],
q)}(m.declared(q))})},"*now":function(A){A(['dojo/i18n!*preload*esri/widgets/nls/Legend*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Legend/nls/Legend ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/decorators/cast ./Widget ./Legend/LegendViewModel ./Legend/styles/Card ./Legend/styles/Classic ./support/widget".split(" "),function(A,c,a,h,d,l,m,q,y,x,p,C,z,k,b){return function(c){function e(a){a=c.call(this)||this;a._handles=new m;a.activeLayerInfos=
null;a.basemapLegendVisible=!1;a.groundLegendVisible=!1;a.iconClass="esri-icon-layer-list";a.label=l.widgetLabel;a.layerInfos=null;a.style=new k;a.view=null;a.viewModel=new C;return a}h(e,c);e.prototype.postInitialize=function(){var a=this;this.own(q.on(this,"activeLayerInfos","change",function(){return a._refreshActiveLayerInfos(a.activeLayerInfos)}),q.init(this,"style",function(b,c){c&&c.destroy();b&&(b.activeLayerInfos=a.activeLayerInfos,"card"===b.type&&(b.view=a.view))}))};e.prototype.destroy=
function(){this._handles.destroy();this._handles=null};e.prototype.castStyle=function(b){if(b instanceof z||b instanceof k)return b;if("string"===typeof b)return"card"===b?new z:new k;if(b&&"string"===typeof b.type){var c=a({},b);delete c.type;return new ("card"===b.type?z:k)(c)}return new k};e.prototype.render=function(){return this.style.render()};e.prototype._refreshActiveLayerInfos=function(a){var b=this;this._handles.removeAll();a.forEach(function(a){return b._renderOnActiveLayerInfoChange(a)});
this.scheduleRender()};e.prototype._renderOnActiveLayerInfoChange=function(a){var b=this,c=q.init(a,"version",function(){return b.scheduleRender()});this._handles.add(c,"version_"+a.layer.uid);a.children.forEach(function(a){return b._renderOnActiveLayerInfoChange(a)})};d([y.aliasOf("viewModel.activeLayerInfos"),b.renderable()],e.prototype,"activeLayerInfos",void 0);d([y.aliasOf("viewModel.basemapLegendVisible"),b.renderable()],e.prototype,"basemapLegendVisible",void 0);d([y.aliasOf("viewModel.groundLegendVisible"),
b.renderable()],e.prototype,"groundLegendVisible",void 0);d([y.property()],e.prototype,"iconClass",void 0);d([y.property()],e.prototype,"label",void 0);d([y.aliasOf("viewModel.layerInfos"),b.renderable()],e.prototype,"layerInfos",void 0);d([y.property(),b.renderable()],e.prototype,"style",void 0);d([x.cast("style")],e.prototype,"castStyle",null);d([y.aliasOf("viewModel.view"),b.renderable()],e.prototype,"view",void 0);d([y.property(),b.renderable(["view.size"])],e.prototype,"viewModel",void 0);return e=
d([y.subclass("esri.widgets.Legend")],e)}(y.declared(p))});