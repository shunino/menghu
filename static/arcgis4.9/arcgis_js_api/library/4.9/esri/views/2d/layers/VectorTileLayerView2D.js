// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/2d/engine/StageGL":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/has ../../../core/promiseUtils ./Container ./webgl/BitBlitRenderer ./webgl/enums ./webgl/Fader ./webgl/WGLPainter ./webgl/shaders/StencilPrograms ../libs/gl-matrix/common ../libs/gl-matrix/mat2d ../libs/gl-matrix/vec2 ../../support/screenshotUtils ../../webgl/BufferObject ../../webgl/context-util ../../webgl/FramebufferObject ../../webgl/programUtils ../../webgl/RenderingContext ../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f,h,g,l,m,k,v,q,p,r,t,u,x,z,w){function y(a){return{state:a.state,pixelRatio:a.pixelRatio,stationary:a.stationary}}return function(d){function e(){var a=null!==d&&d.apply(this,arguments)||this;a._clipData=new Float32Array(8);a._upperLeft=q.create();a._upperRight=q.create();a._lowerLeft=q.create();a._lowerRight=q.create();a._mat2=v.create();a._clipRendererInitialized=!1;a._contextVersion=null;a._labelFader=new g.default(a);return a}a(e,d);Object.defineProperty(e.prototype,"glPainter",
{get:function(){return this._painter},enumerable:!0,configurable:!0});e.prototype.fadeInLabels=function(){this._labelFader.reset();this.requestRender()};e.prototype.createElement=function(){var a=document.createElement("canvas");a.setAttribute("class","esri-display-object");return a};e.prototype.setElement=function(a){this.element=a};e.prototype.useContextVersion=function(a){this._renderingContext||(this._contextVersion=a)};e.prototype.attach=function(a){if(this.attached)return!0;this._resizeCanvas(a);
var b=t.createContextOrErrorHTML(this.element,{alpha:!0,antialias:!1,depth:!0,stencil:!0},this._contextVersion);this._renderingContext=new z(b);this._contextVersion=this._renderingContext.contextVersion;this.attached=!0;this._cachedRenderParams=y(a);this._painter||(this._painter=new l.default,this._painter.initialize(this._renderingContext));return d.prototype.attach.call(this,a)};e.prototype.detach=function(a){d.prototype.detach.call(this,a);this._boundFBO=null;this._clipFBO&&(this._clipFBO.dispose(),
this._clipFBO=null);this._labelsFBO1&&(this._labelsFBO1.dispose(),this._labelsFBO1=null);this._labelsFBO2&&(this._labelsFBO2.dispose(),this._labelsFBO2=null);this._blitRenderer&&(this._blitRenderer.dispose(),this._blitRenderer=null);this._clipVAO&&(this._clipVAO.dispose(),this._clipVBO=this._clipVAO=null);this._painter&&(this._painter.dispose(),this._painter=null);this._clipStencilProgram&&(this._clipStencilProgram.dispose(),this._clipStencilProgram=null);this._renderingContext&&(this._renderingContext.dispose(),
this._renderingContext=null);this._cachedRenderParams=null};e.prototype.renderChildren=function(a){var c=this.children;a.drawPhase=h.WGLDrawPhase.FILL|h.WGLDrawPhase.LINE|h.WGLDrawPhase.MARKER|h.WGLDrawPhase.TEXT;for(var f=c.length,d=0;d<f;d++){var g=c[d];g.attached&&this.renderChild(g,a)}if(b("esri-featurelayer-webgl-labeling")){var l=a.context,k=l.getBoundFramebufferObject();l.bindFramebuffer(this._labelsFBO2);d=a.stationary;l.setClearColor(0,0,0,d?0:1);l.clear(l.gl.COLOR_BUFFER_BIT);if(d)for(a.drawPhase=
h.WGLDrawPhase.LABEL_ALPHA,a.labelFBO=this._labelsFBO1,a.labelStep=this._labelFader.step(),d=0;d<f;d++)g=c[d],g.attached&&this.renderChild(g,a);else this._labelFader.reset();l.bindFramebuffer(k);a.labelFBO=this._labelsFBO2;a.drawPhase=h.WGLDrawPhase.LABEL;for(d=0;d<f;d++)g=c[d],g.attached&&this.renderChild(g,a);a=this._labelsFBO2;this._labelsFBO2=this._labelsFBO1;this._labelsFBO1=a}};e.prototype.beforeRenderChildren=function(a,c){a=c.context;var f=c.state,d=c.pixelRatio;if(c=this._painter){a.enforceState();
c.update(f,d);var g=f.width;c=f.height;var h=f.rotation,g=Math.round(g*d);c=Math.round(c*d);this._boundFBO=a.getBoundFramebufferObject();!b("esri-featurelayer-webgl-labeling")||this._labelsFBO1&&this._labelsFBO1.width===g&&this._labelsFBO1.height===c||(this._labelsFBO1&&(this._labelsFBO1.dispose(),this._labelsFBO2.dispose()),this._labelsFBO1=u.createWithAttachments(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:g,height:c},{colorTarget:0,depthStencilTarget:0}),
a.bindFramebuffer(this._labelsFBO1),a.setDepthWriteEnabled(!0),a.setStencilWriteMask(255),a.setClearColor(0,0,0,0),a.setClearDepth(1),a.setClearStencil(0),a.clear(a.gl.COLOR_BUFFER_BIT|a.gl.DEPTH_BUFFER_BIT|a.gl.STENCIL_BUFFER_BIT),a.setDepthWriteEnabled(!1),a.bindFramebuffer(this._boundFBO),this._labelsFBO2=u.createWithAttachments(a,{target:3553,pixelFormat:6408,internalFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:g,height:c},{colorTarget:0,depthStencilTarget:0}));if(f.spatialReference&&
(f.spatialReference._isWrappable?f.spatialReference._isWrappable():f.spatialReference.isWrappable)){var l=k.toRadian(h),m=Math.abs(Math.cos(l)),p=Math.abs(Math.sin(l)),e=Math.round(f.worldScreenWidth);if(Math.round(g*m+c*p)<=e)this._clipFrame=!1;else{this._clipFBO&&this._clipFBO.width===g&&this._clipFBO.height===c||(this._clipFBO=new u(a,{colorTarget:0,depthStencilTarget:3,width:g,height:c}));var r=.5*g,t=.5*c,f=1/g,y=1/c,d=.5*e*d,w=.5*(g*p+c*m),g=this._upperLeft,m=this._upperRight,p=this._lowerLeft,
e=this._lowerRight;q.set(g,-d,-w);q.set(m,d,-w);q.set(p,-d,w);q.set(e,d,w);v.identity(this._mat2);v.translate(this._mat2,this._mat2,[r,t]);0!==h&&v.rotate(this._mat2,this._mat2,l);q.transformMat2d(g,g,this._mat2);q.transformMat2d(m,m,this._mat2);q.transformMat2d(p,p,this._mat2);q.transformMat2d(e,e,this._mat2);h=this._clipData;h.set([2*p[0]*f-1,2*(c-p[1])*y-1,2*e[0]*f-1,2*(c-e[1])*y-1,2*g[0]*f-1,2*(c-g[1])*y-1,2*m[0]*f-1,2*(c-m[1])*y-1]);this._clipRendererInitialized||this._initializeClipRenderer(a);
this._clipVBO.setData(h);this._boundFBO=a.getBoundFramebufferObject();a.bindFramebuffer(this._clipFBO);a.setDepthWriteEnabled(!0);a.setStencilWriteMask(255);a.setClearColor(0,0,0,0);a.setClearDepth(1);a.setClearStencil(0);a.clear(a.gl.COLOR_BUFFER_BIT|a.gl.DEPTH_BUFFER_BIT|a.gl.STENCIL_BUFFER_BIT);a.setDepthWriteEnabled(!1);this._clipFrame=!0}}else this._clipFrame=!1}};e.prototype.afterRenderChildren=function(a,b){a=this._renderingContext;a.logIno();this._clipFrame&&this._clipRendererInitialized&&
(a.bindFramebuffer(this._boundFBO),this._boundFBO=null,a.bindVAO(this._clipVAO),a.bindProgram(this._clipStencilProgram),a.setDepthWriteEnabled(!1),a.setDepthTestEnabled(!1),a.setStencilTestEnabled(!0),a.setBlendingEnabled(!1),a.setColorMask(!1,!1,!1,!1),a.setStencilOp(7680,7680,7681),a.setStencilWriteMask(255),a.setStencilFunction(519,1,255),a.drawElements(4,6,5123,0),a.bindVAO(),a.setColorMask(!0,!0,!0,!0),a.setBlendingEnabled(!0),a.setStencilFunction(514,1,255),this._blitRenderer.render(a,this._clipFBO.colorTexture,
9728,1),a.setStencilTestEnabled(!1))};e.prototype.doRender=function(a){var b=this.element.style;this.visible?(b.display="block",b.opacity=""+this.opacity,this._resizeCanvas(a),d.prototype.doRender.call(this,a),this._cachedRenderParams=y(a)):b.display="none"};e.prototype.takeScreenshot=function(a){if(!this._cachedRenderParams)return c.reject();this._cachedRenderParams.pixelRatio=a.pixelRatio;var b=a.framebufferWidth,f=a.framebufferHeight,d=a.region,g=document.createElement("canvas");g.width=b;g.height=
f;var h=p.createEmptyImageData(d.width,d.height,g),l=this._renderingContext,k=u.create(l,{colorTarget:0,depthStencilTarget:3,width:b,height:f});l.bindFramebuffer(k);l.setViewport(0,0,b,f);var b=this._cachedRenderParams,m=this._renderingContext.gl;this._renderingContext.setClearColor(0,0,0,0);this._renderingContext.setClearDepth(1);this._renderingContext.setClearStencil(0);this._renderingContext.clear(m.COLOR_BUFFER_BIT|m.DEPTH_BUFFER_BIT|m.STENCIL_BUFFER_BIT);b.context=this._renderingContext;b.painter=
this._painter;this.beforeRenderChildren(b,b);if(null!=a.rotation){var m=b.state,e=m.clone();e.viewpoint.rotation=a.rotation;b.state=e;this.renderChildren(b);b.state=m}else this.renderChildren(b);this.afterRenderChildren(b,b);k.readPixels(d.x,f-(d.y+d.height),d.width,d.height,6408,5121,new Uint8Array(h.data.buffer));l.bindFramebuffer();a=p.encodeResult(h,a,g,{flipY:!0,premultipliedAlpha:!0});return c.resolve(a)};e.prototype.prepareChildrenRenderParameters=function(a){if(!this.attached||!this._renderingContext)return null;
a=y(a);var b=this._renderingContext,c=b.gl;b.setDepthWriteEnabled(!0);b.setStencilWriteMask(255);b.setClearColor(0,0,0,0);b.setClearDepth(1);b.setClearStencil(0);b.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT|c.STENCIL_BUFFER_BIT);b.setViewport(0,0,this.element.width,this.element.height);b.setDepthWriteEnabled(!1);a.context=b;a.painter=this._painter;return a};e.prototype.attachChild=function(a,b){return a.attach(b)};e.prototype.detachChild=function(a,b){return a.detach(b)};e.prototype.renderChild=
function(a,b){return a.processRender(b)};e.prototype._resizeCanvas=function(a){var b=this.element,c=b.style,f=a.state,d=a.pixelRatio;a=Math.round(f.width*d);d=Math.round(f.height*d);if(b.width!==a||b.height!==d)b.width=a,b.height=d;c.width=f.width+"px";c.height=f.height+"px"};e.prototype._initializeClipRenderer=function(a){if(this._clipRendererInitialized)return!0;this._blitRenderer=new f;var b=m.stencil.attributes,c=x.createProgram(a,m.stencil);if(!c)return!1;var d=r.createVertex(a,35040,32),g=new Uint16Array([0,
1,2,2,1,3]),g=r.createIndex(a,35044,g);a=new w(a,b,{geometry:[{name:"a_pos",count:2,type:5126,offset:0,stride:8,normalized:!1,divisor:0}]},{geometry:d},g);this._clipStencilProgram=c;this._clipVBO=d;this._clipVAO=a;return this._clipRendererInitialized=!0};return e}(d)})},"esri/views/2d/engine/webgl/BitBlitRenderer":function(){define("require exports ./shaders/BitBlitPrograms ../../../webgl/BufferObject ../../../webgl/programUtils ../../../webgl/VertexArrayObject".split(" "),function(n,e,a,b,c,d){return function(){function f(){this._initialized=
!1}f.prototype.dispose=function(){this._program&&(this._program.dispose(),this._program=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};f.prototype.render=function(a,b,c,f){a&&(this._initialized||this._initialize(a),a.setBlendFunctionSeparate(1,771,1,771),a.bindVAO(this._vertexArrayObject),a.bindProgram(this._program),b.setSamplingMode(c),a.bindTexture(b,0),this._program.setUniform1i("u_tex",0),this._program.setUniform1f("u_opacity",f),a.drawArrays(5,
0,4),a.bindVAO())};f.prototype._initialize=function(f){if(this._initialized)return!0;var g=a.bitBlit.attributes,h=c.createProgram(f,a.bitBlit);if(!h)return!1;var m=new Int8Array(16);m[0]=-1;m[1]=-1;m[2]=0;m[3]=0;m[4]=1;m[5]=-1;m[6]=1;m[7]=0;m[8]=-1;m[9]=1;m[10]=0;m[11]=1;m[12]=1;m[13]=1;m[14]=1;m[15]=1;f=new d(f,g,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:4,normalized:!1,divisor:0},{name:"a_tex",count:2,type:5120,offset:2,stride:4,normalized:!1,divisor:0}]},{geometry:b.createVertex(f,
35044,m)});this._program=h;this._vertexArrayObject=f;return this._initialized=!0};return f}()})},"esri/views/2d/engine/webgl/shaders/BitBlitPrograms":function(){define(["require","exports","./sources/resolver"],function(n,e,a){Object.defineProperty(e,"__esModule",{value:!0});e.bitBlit={name:"bitBlit",shaders:{vertexShader:a.resolveIncludes("bitBlit/bitBlit.vert"),fragmentShader:a.resolveIncludes("bitBlit/bitBlit.frag")},attributes:{a_pos:0,a_tex:1}}})},"esri/views/2d/engine/webgl/shaders/sources/resolver":function(){define(["require",
"exports","./shaderRepository","../../../../../webgl/ShaderCompiler"],function(n,e,a,b){Object.defineProperty(e,"__esModule",{value:!0});var c=new b(function(b){var c=a;b.split("/").forEach(function(a){c&&(c=c[a])});return c});e.resolveIncludes=function(a){return c.resolveIncludes(a)}})},"esri/views/2d/engine/webgl/shaders/sources/shaderRepository":function(){define(["require","exports"],function(n,e){return{background:{"background.frag":"uniform lowp vec4 u_color;\r\nvoid main() {\r\n  gl_FragColor \x3d u_color;\r\n}\r\n",
"background.vert":"attribute vec2 a_pos;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform mediump vec2 u_normalized_origin;\r\nuniform mediump float u_coord_range;\r\nuniform mediump float u_depth;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(u_coord_range * a_pos, 0.0, 1.0);\r\n}\r\n"},bitBlit:{"bitBlit.frag":"uniform lowp sampler2D u_tex;\r\nuniform lowp float u_opacity;\r\n\r\nvarying mediump vec2 v_uv;\r\n\r\nvoid main() {\r\n  lowp vec4 color \x3d texture2D(u_tex, v_uv);\r\n\r\n  // Note: output in pre-multiplied alpha for correct alpha compositing\r\n  gl_FragColor \x3d color *  u_opacity;\r\n}\r\n",
"bitBlit.vert":"attribute vec2 a_pos;\r\nattribute vec2 a_tex;\r\n\r\nvarying mediump vec2 v_uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\r\n  v_uv \x3d a_tex;\r\n}\r\n"},heatmap:{"heatmap.frag":"precision mediump float;\r\n\r\nuniform lowp sampler2D u_texture;\r\nuniform lowp float u_opacity;\r\nuniform mediump vec2 u_minmax;\r\nuniform lowp sampler2D u_gradient;\r\n\r\nvarying mediump vec2 v_uv;\r\nvarying mediump float v_slope;\r\n\r\nvec4 getColor(float intensity) {\r\n  float normalizedIntensity \x3d clamp((intensity - u_minmax.x) * v_slope, 0.0, 1.0);\r\n\r\n  return texture2D(u_gradient, vec2(0.5, normalizedIntensity));\r\n}\r\n\r\nvoid main() {\r\n  // sample the intensity value\r\n  lowp vec4 color \x3d texture2D(u_texture, v_uv);\r\n\r\n  // interpolate the color from the ramp using the intensity value\r\n  gl_FragColor \x3d getColor(color.r) *  u_opacity;\r\n}\r\n",
"heatmap.vert":"attribute vec2 a_pos;\r\nattribute vec2 a_tex;\r\n\r\nuniform mediump vec2 u_minmax;\r\n\r\nvarying mediump vec2 v_uv;\r\nvarying mediump float v_slope;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\r\n  v_uv \x3d a_tex;\r\n  v_slope \x3d 1.0 / (u_minmax.y - u_minmax.x);\r\n}\r\n"},highlight:{"blur.frag":"// A gaussian blur shader. It blurs the alpha channel of its input\r\n// according to 4 different sigma and stores the results into the\r\n// four channel of the target framebuffer.\r\n\r\n// It is intended to be called twice; the first time to perform an\r\n// horizontal blur, and a second time to perform a vertical blur.\r\n\r\n// This shader is used to turn the highlight mask into a highlight\r\n// map. The highlight map is an approximation of the signed distance\r\n// field of the mask.\r\n\r\n\r\n// Interpolated texture coordinates.\r\nvarying mediump vec2 v_texcoord;\r\n\r\n// Blur direction information. There are two possible\r\n// configurations that the host code can use.\r\n//  - [1, 0, 1/WIDTH, 0] Used when blurring horizontally. In this\r\n//    case u_direction[0] \x3d 1 is expressed in pixel and is fed to\r\n//    the gauss function to produce the value of the gaussian weight\r\n//    for that pixel, while u_direction[2] \x3d 1/WIDTH is in texel units\r\n//    and is used to sample the right texel from the texture map.\r\n//  - [0, 1, 0, 1/HEIGHT] Used when blurring vertically. In this\r\n//    case u_direction[1] \x3d 1 is expressed in pixel and is fed to\r\n//    the gauss function to produce the value of the gaussian weight\r\n//    for that pixel, while u_direction[3] \x3d 1/HEIGHT is in texel units\r\n//    and is used to sample the right texel from the texture map.\r\nuniform mediump vec4 u_direction;\r\n\r\n// Source to destination channel selection matrix.\r\nuniform mediump mat4 u_channelSelector;\r\n\r\n// The highlight map is obtained by blurring the alpha channel of the highlight\r\n// mask accroding to these 4 values of the gaussian's sigma parameter.\r\nuniform mediump vec4 u_sigmas;\r\n\r\n// This is the highlight mask if we have not blurred horizontally yet, otherwise\r\n// it is the horizontally blurred highlight map and blurring it one more time\r\n// vertically will complete the process.\r\nuniform sampler2D u_texture;\r\n\r\n// The gaussian kernel. Note that it lacks the normalization constant, because\r\n// we want to store it unnormalized in the highlight map (i.e. having a peak\r\n// value of 1). Note also that we are using the SIMD (single instruction, multiple\r\n// data) capabilities of the GPU to compute four different gaussian kernels, one\r\n// for each sigma.\r\nmediump vec4 gauss(mediump vec2 dir) {\r\n  return exp(-dot(dir, dir) / (2.0 * u_sigmas * u_sigmas));\r\n}\r\n\r\nmediump vec4 selectChannel(mediump vec4 sample) {\r\n  return u_channelSelector * sample;\r\n}\r\n\r\n// Sample the input texture and accumulated its gaussian weighted value and the\r\n// total weight.\r\nvoid accumGauss(mediump float i, inout mediump vec4 tot, inout mediump vec4 weight) {\r\n  // Computes the gaussian weights, one for each sigma.\r\n  // Note that u_direction.xy is [1, 0] when blurring horizontally and [0, 1] when blurring vertically.\r\n  mediump vec4 w \x3d gauss(i * u_direction.xy);\r\n\r\n  // Accumumates the values.\r\n  // Note that u_direction.xy is [1/WIDTH, 0] when blurring horizontally and [0, 1/HEIGHT] when blurring vertically.\r\n  tot +\x3d selectChannel(texture2D(u_texture, v_texcoord + i * u_direction.zw)) * w;\r\n\r\n  // Accumulates the weights.\r\n  weight +\x3d w;\r\n}\r\n\r\nvoid main(void) {\r\n  // Initialize accumulated values and weights to zero.\r\n  mediump vec4 tot \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n  mediump vec4 weight \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n  // Accumulates enough samples. These will be taken\r\n  // horizontally or vertically depending on the value\r\n  // of u_direction.\r\n  accumGauss(-5.0, tot, weight);\r\n  accumGauss(-4.0, tot, weight);\r\n  accumGauss(-3.0, tot, weight);\r\n  accumGauss(-2.0, tot, weight);\r\n  accumGauss(-1.0, tot, weight);\r\n  accumGauss(0.0, tot, weight);\r\n  accumGauss(1.0, tot, weight);\r\n  accumGauss(2.0, tot, weight);\r\n  accumGauss(3.0, tot, weight);\r\n  accumGauss(4.0, tot, weight);\r\n  accumGauss(5.0, tot, weight);\r\n\r\n  // Compute blurred values.\r\n  mediump vec4 rgba \x3d tot / weight;\r\n\r\n  // Return the values. Note that each channel will contain\r\n  // the result of a different blur operation, one for each\r\n  // of the four chosen sigma.\r\n  gl_FragColor \x3d vec4(rgba);\r\n}\r\n",
"highlight.frag":"// Takes as input the highlight map, estimated the signed distance field,\r\n// and shades the fragments according to their estimated distance from the\r\n// edge of the highlighted feature.\r\n\r\n// A shade texture is used to turn distance values into colors; the shade\r\n// texture is basically a color gradient and is recomputed on the host\r\n// every time that the user alters the highlight options.\r\n\r\n// Interpolated texture coordinates.\r\nvarying mediump vec2 v_texcoord;\r\n\r\n// The highlight map. Each channel is a blurred\r\n// version of the alpha channel of the highlight mask.\r\n//  - Channel 0 (red) corresponds to a gaussian blur with sigma \x3d u_sigmas[0];\r\n//  - Channel 1 (green) corresponds to a gaussian blur with sigma \x3d u_sigmas[1];\r\n//  - Channel 2 (blue) corresponds to a gaussian blur with sigma \x3d u_sigmas[2];\r\n//  - Channel 3 (alpha) corresponds to a gaussian blur with sigma \x3d u_sigmas[3];\r\n// As of today, only channel 3 is used for distance estimation.\r\n// But the availability of different amounts of blur leaves the\r\n// door open to multi-scale approaches.\r\nuniform sampler2D u_texture;\r\n\r\n// The highlight map was obtained by blurring the alpha channel of the highlight\r\n// mask accroding to these 4 values of the gaussian's sigma parameter.\r\nuniform mediump vec4 u_sigmas;\r\n\r\n// A 1-D texture used to shade the highlight.\r\nuniform sampler2D u_shade;\r\n\r\n// The 1-D shade texture is spreaded between u_minMaxDistance[0] and u_minMaxDistance[1].\r\nuniform mediump vec2 u_minMaxDistance;\r\n\r\n// Signed distance estimation.\r\nmediump float estimateDistance() {\r\n  // Use the largest sigma and the corresponding distance value stored in the\r\n  // last channel of the highlight map.\r\n  mediump float sigma \x3d u_sigmas[3];\r\n  mediump float y \x3d texture2D(u_texture, v_texcoord)[3];\r\n\r\n  // Estimates the distance by linearization and local inversion around\r\n  // the inflection point. The inflection point is in x \x3d 0.\r\n  const mediump float y0 \x3d 0.5;                           // Value of the convolution at the inflection point.\r\n  mediump float m0 \x3d 1.0 / (sqrt(2.0 * 3.1415) * sigma);  // Slope of the convolution at the inflection point.\r\n  mediump float d \x3d (y - y0) / m0;                        // Inversion of a local linearization.\r\n\r\n  // Return the estimated distance.\r\n  return d;\r\n}\r\n\r\n// Shading based on estimated distance.\r\nmediump vec4 shade(mediump float d) {\r\n  // Maps the sampled distance from the [A, D] range (see HighlightRenderer::setHighlightOptions) to [0, 1].\r\n  mediump float mappedDistance \x3d (d - u_minMaxDistance.x) / (u_minMaxDistance.y - u_minMaxDistance.x);\r\n\r\n  // Force to [0, 1]; it should not be necessary because the shade texture uses the CLAMP address mode, so\r\n  // this should happen anyway internally to the sampler, but in practice it is needed to avoid weird\r\n  // banding artifacts.\r\n  // We don't really know if we need this or not.\r\n  mappedDistance \x3d clamp(mappedDistance, 0.0, 1.0);\r\n\r\n  // Sample the 1-D shade texture on its center line (i.e. on t\x3d0.5).\r\n  return texture2D(u_shade, vec2(mappedDistance, 0.5));\r\n}\r\n\r\nvoid main(void) {\r\n  // Estimate the distance.\r\n  mediump float d \x3d estimateDistance();\r\n\r\n  // Shade the distance.\r\n  gl_FragColor \x3d shade(d);\r\n}\r\n",
"textured.vert":"// Identity vertex shader that outputs an untransformed 2-D vertex\r\n// and passes its texture coordinates unchanged to the interpolator.\r\n\r\n// Vertex position.\r\nattribute mediump vec2 a_position;\r\n\r\n// Texture coordinates.\r\nattribute mediump vec2 a_texcoord;\r\n\r\n// Texture coordinates to be interpolated.\r\nvarying mediump vec2 v_texcoord;\r\n\r\nvoid main(void) {\r\n  // Pass the position unchanged.\r\n  gl_Position \x3d vec4(a_position, 0.0, 1.0);\r\n\r\n  // Pass the texture coordinates unchanged.\r\n  v_texcoord \x3d a_texcoord;\r\n}\r\n"},
materials:{fill:{"fill.frag":"precision lowp float;\r\nuniform lowp float u_opacity;\r\n\r\n#ifdef PATTERN\r\nuniform lowp sampler2D u_texture;\r\n\r\nvarying mediump vec4 v_tlbr;\r\nvarying mediump vec2 v_tileTextureCoord;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_opacity;\r\n\r\nvoid main()\r\n{\r\n#ifdef PATTERN\r\n  // normalize the calculated texture coordinate such that it fits in the range of 0 to 1.\r\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\r\n  // interpolate the image coordinate between the top-left and the bottom right to get the actual position to sample.\r\n  // after normalizing the position, we get a value ranging between 0 and 1 which refers to the entire texture, however\r\n  // we need to only sample from area that has our sprite in the mosaic.\r\n  mediump vec2 samplePos \x3d mix(v_tlbr.xy, v_tlbr.zw, normalizedTextureCoord);\r\n  // sample the sprite mosaic\r\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\r\n  gl_FragColor \x3d u_opacity * v_opacity * v_color * color;\r\n#else\r\n  gl_FragColor \x3d u_opacity * v_opacity * v_color;\r\n#endif // PATTERN\r\n\r\n#ifdef HIGHLIGHT\r\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\n  //if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n  //  discard;\r\n  //}\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"fill.vert":"precision mediump float;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_id; // since we need to render the Id as a color we need to break it into RGBA components. so just like a color, the Id is normalized.\r\nattribute vec4 a_color;\r\nattribute vec4 a_tlbr;\r\nattribute vec4 a_aux;\r\n\r\nattribute float  a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform highp vec2 u_normalized_origin;\r\n\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_opacity;\r\n\r\n// import the VV inputs and functions (they are #ifdefed, so if the proper #define is not set it will end-up being a no-op)\r\n#include \x3cmaterials/fill/vvUniforms.glsl\x3e\r\n#include \x3cmaterials/fill/vvFunctions.glsl\x3e\r\n\r\n#ifdef PATTERN\r\nuniform mediump float u_zoomFactor;\r\nuniform mediump vec2 u_mosaicSize;\r\n\r\nvarying mediump vec4 v_tlbr;\r\nvarying mediump vec2 v_tileTextureCoord;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main()\r\n{\r\n#ifdef VV_OPACITY\r\n  v_opacity \x3d getVVOpacity(a_vv.y);\r\n#else\r\n  v_opacity \x3d 1.0;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  v_color \x3d getVVColor(a_vv.x, a_color);\r\n#else\r\n  v_color \x3d a_color;\r\n#endif // VV_COLOR\r\n\r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif // ID\r\n\r\n#ifdef PATTERN\r\n  // calculate the pattern matrix\r\n  mat3 patternMatrix \x3d mat3(1.0, 0.0, 0.0,\r\n                            0.0, 1.0, 0.0,\r\n                            0.0, 0.0, 1.0);\r\n  patternMatrix[0][0] \x3d 1.0 / (u_zoomFactor * a_aux.x);\r\n  patternMatrix[1][1] \x3d 1.0 / (u_zoomFactor * a_aux.y);\r\n\r\n  // calculate the texture coordinates of the current vertex. It will of course get interpolated.\r\n  // The pattern matrix is a 3x3 scale matrix which 'tiles' the texture inside the tile, translating from\r\n  // tile coordinates to texture coordinates.\r\n  v_tileTextureCoord \x3d (patternMatrix * vec3(a_pos, 1.0)).xy;\r\n  v_tlbr \x3d vec4(a_tlbr.x / u_mosaicSize.x, a_tlbr.y / u_mosaicSize.y, a_tlbr.z / u_mosaicSize.x, a_tlbr.w / u_mosaicSize.y);\r\n#endif // PATTERN\r\n\r\n  float z \x3d 2.0 * (1.0 - a_visible); // clip the vertex if the geometry isn't visible\r\n  gl_Position \x3d vec4(u_normalized_origin, 0.0, 0.0) + u_transformMatrix * vec4(a_pos, z, 1.0);\r\n}\r\n",
"vvFunctions.glsl":"bool isNan(float val) {\r\n  return !( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 );\r\n}\r\n\r\n#ifdef VV_OPACITY\r\nconst int VV_OPACITY_N \x3d 8;\r\n\r\nfloat getVVOpacity(float opacityValue) {\r\n  if (isNan(opacityValue)) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\r\n    return u_vvOpacities[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\r\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\r\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvOpacities[VV_OPACITY_N - 1];\r\n}\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nconst int VV_COLOR_N \x3d 8;\r\n\r\nvec4 getVVColor(float colorValue, vec4 fallback) {\r\n  if (isNan(colorValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\r\n    return u_vvColors[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\r\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\r\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvColors[VV_COLOR_N - 1];\r\n}\r\n#endif // VV_COLOR\r\n",
"vvUniforms.glsl":"#if defined(VV_COLOR)|| defined(VV_OPACITY)\r\nattribute vec4 a_vv;\r\n#endif // VV_COLOR || VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nuniform float u_vvColorValues[8];\r\nuniform vec4 u_vvColors[8];\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_OPACITY\r\nuniform float u_vvOpacityValues[8];\r\nuniform float u_vvOpacities[8];\r\n#endif // VV_OPACITY\r\n"},icon:{"icon.frag":"precision mediump float;\r\n\r\nuniform lowp sampler2D u_texture;\r\n\r\nvarying lowp vec2 v_tex;\r\nvarying lowp float v_transparency;\r\nvarying mediump vec2 v_size;\r\nvarying lowp vec4 v_color;\r\n\r\n#ifdef SDF\r\nvarying lowp vec4 v_outlineColor;\r\nvarying mediump float v_outlineWidth;\r\n\r\n// we need the conversion function from RGBA to float\r\n#include \x3cutil/encoding.glsl\x3e\r\n#endif // SDF\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n#ifdef HEATMAP\r\nvarying mediump float v_heatmapWeight;\r\n#endif // HEATMAP\r\n\r\nconst float softEdgeRatio \x3d 1.0; // use blur here if needed\r\n\r\nvoid main()\r\n{\r\n#ifdef SDF\r\n  lowp vec4 fillPixelColor \x3d v_color;\r\n\r\n  // calculate the distance from the edge [-0.5, 0.5]\r\n  float d \x3d 0.5 - rgba2float(texture2D(u_texture, v_tex));\r\n\r\n  // the soft edge ratio is about 1.5 pixels allocated for the soft edge.\r\n  float size \x3d max(v_size.x, v_size.y);\r\n  float dist \x3d d * size * softEdgeRatio;\r\n\r\n  // set the fragment's transparency according to the distance from the edge\r\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n  // count for the outline\r\n  // therefore tint the entire icon area.\r\n  if (v_outlineWidth \x3e 0.25) {\r\n    lowp vec4 outlinePixelColor \x3d v_outlineColor;\r\n\r\n    // outlines can't be larger than the size of the symbol\r\n    float clampedOutlineSize \x3d min(v_outlineWidth, size);\r\n\r\n    outlinePixelColor *\x3d clamp(0.5 - abs(dist) + clampedOutlineSize * 0.5, 0.0, 1.0);\r\n\r\n    // finally combine the outline and the fill colors (outline draws on top of fill)\r\n    gl_FragColor \x3d v_transparency * ((1.0 - outlinePixelColor.a) * fillPixelColor + outlinePixelColor);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d v_transparency * fillPixelColor;\r\n  }\r\n#else // not an SDF\r\n  lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\r\n\r\n#ifdef HEATMAP\r\n  texColor.r *\x3d v_heatmapWeight;\r\n#endif // HEATMAP\r\n\r\n  gl_FragColor \x3d v_transparency * texColor;\r\n#endif // SDF\r\n\r\n#ifdef HIGHLIGHT\r\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"icon.vert":"precision mediump float;\r\n\r\n//const float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\r\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\r\nconst vec2 SIGNED_BYTE_TO_UNSIGNED \x3d vec2(128.0);\r\n\r\n// per quad (instance) attributes (20 bytes \x3d\x3d\x3e equivalent of 5 bytes per vertex)\r\nattribute vec2 a_pos;\r\nattribute vec4 a_vertexOffsetAndTex;\r\nattribute vec4 a_id; // since we need to render the Id as a color we need to break it into RGBA components. so just like a color, the Id is normalized.\r\nattribute vec4 a_color;\r\nattribute vec4 a_outlineColor;\r\nattribute vec4 a_sizeAndOutlineWidth;\r\n\r\nattribute float a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n\r\n// the size of the mosaic given in pixels\r\nuniform vec2 u_mosaicSize;\r\n\r\n// the opacity of the layer given by the painter\r\nuniform mediump float u_opacity;\r\n\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying mediump vec2 v_tex;\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n// the of the icon given in pixels\r\nvarying mediump vec2 v_size;\r\n\r\n// icon color. If is a picture-marker it is used to tint the texture color\r\nvarying lowp vec4 v_color;\r\n\r\n#ifdef SDF\r\nvarying lowp vec4 v_outlineColor;\r\nvarying mediump float v_outlineWidth;\r\n#endif // SDF\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n#ifdef HEATMAP\r\nattribute float a_heatmapWeight;\r\nvarying mediump float v_heatmapWeight;\r\n#endif // HEATMAP\r\n\r\n// import the VV inputs and functions (they are #ifdefed, so if the proper #define is not set it will end-up being a no-op)\r\n#include \x3cmaterials/icon/vvUniforms.glsl\x3e\r\n#include \x3cmaterials/icon/vvFunctions.glsl\x3e\r\n\r\nvoid main()\r\n{\r\n  vec2 a_offset \x3d a_vertexOffsetAndTex.xy;\r\n  vec2 a_tex \x3d a_vertexOffsetAndTex.zw + SIGNED_BYTE_TO_UNSIGNED; // offset to change from signed to unsigned byte\r\n  vec2 a_size \x3d a_sizeAndOutlineWidth.xy;\r\n\r\n  // default values (we need them for the variations to come)\r\n  float a_angle \x3d 0.0;\r\n  float delta_z \x3d 2.0 * (1.0 - a_visible);\r\n  float depth \x3d 0.0;\r\n  v_transparency \x3d 1.0;\r\n\r\n#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\n  // vv size override the original symbol's size\r\n  float h \x3d getVVMinMaxSize(a_vv.x, a_size.y);\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\n  float h \x3d u_vvSizeScaleStopsValue;\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\n  float h \x3d getVVStopsSize(a_vv.x, a_size.y);\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\n  float h \x3d getVVUnitValue(a_vv.x, a_size.y);\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n  // make sure to preserve the aspect ratio of the symbol\r\n  vec2 size \x3d vec2(h * a_size.x / a_size.y, h);\r\n  vec2 offset \x3d a_offset * size / a_size;\r\n  v_size \x3d size;\r\n#else\r\n#ifdef HEATMAP\r\n  // reconstruct the kernel size\r\n  a_size \x3d 9.0 * a_size + 1.0;\r\n#endif // HEATMAP\r\n\r\n  vec2 offset \x3d a_offset;\r\n  v_size \x3d a_size;\r\n#endif // defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n#ifdef SDF\r\n  offset *\x3d 2.0;\r\n#endif // SDF\r\n\r\n#ifdef VV_ROTATION\r\n  gl_Position \x3d vec4(u_normalized_origin, depth, 0.0) + u_transformMatrix * vec4(a_pos, delta_z, 1.0) + u_extrudeMatrix * getVVRotation(a_vv.w) * vec4(offset, 0.0, 0.0);\r\n#else\r\n  gl_Position \x3d vec4(u_normalized_origin, depth, 0.0) + u_transformMatrix * vec4(a_pos, delta_z, 1.0) + u_extrudeMatrix * vec4(offset, 0.0, 0.0);\r\n#endif // VV_ROTATION\r\n\r\n#ifdef VV_OPACITY\r\n  v_transparency \x3d getVVOpacity(a_vv.z);\r\n#else\r\n  v_transparency \x3d u_opacity;\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\n  v_color \x3d getVVColor(a_vv.y, a_color);\r\n#else\r\n  v_color \x3d a_color;\r\n#endif // VV_COLOR\r\n\r\n  // output the texture coordinates and the transparency\r\n  v_tex \x3d a_tex / u_mosaicSize;\r\n\r\n#ifdef SDF\r\n  v_outlineColor \x3d a_outlineColor;\r\n  v_outlineWidth \x3d a_sizeAndOutlineWidth.z;\r\n#endif // SDF\r\n\r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif // ID\r\n\r\n#ifdef HEATMAP\r\n  v_heatmapWeight \x3d a_heatmapWeight;\r\n#endif // HEATMAP\r\n}\r\n",
"vvFunctions.glsl":"bool isNan(float val) {\r\n  return !( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 );\r\n}\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  // we need to multiply by 8 in order to translate to tile coordinates\r\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\r\n  interpolationRatio \x3d clamp(interpolationRatio, 0.0, 1.0);\r\n  return u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z);\r\n}\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nconst int VV_SIZE_N \x3d 6;\r\nfloat getVVStopsSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\r\n    return u_vvSizeFieldStopsSizes[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\r\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\r\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\r\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\r\n}\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nfloat getVVUnitValue(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\r\n}\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nconst int VV_OPACITY_N \x3d 8;\r\nfloat getVVOpacity(float opacityValue) {\r\n  if (isNan(opacityValue)) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\r\n    return u_vvOpacities[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\r\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\r\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvOpacities[VV_OPACITY_N - 1];\r\n}\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nmat4 getVVRotation(float rotationValue) {\r\n  // YF TODO: if the symbol has rotation we need to combine the symbo's rotation with the VV one\r\n  if (isNan(rotationValue)) {\r\n    return mat4(1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1);\r\n  }\r\n\r\n  float rotation \x3d rotationValue;\r\n  if (u_vvRotationType \x3d\x3d 1.0) {\r\n    rotation \x3d 90.0 - rotation;\r\n  }\r\n\r\n  float angle \x3d C_DEG_TO_RAD * rotation;\r\n\r\n  float sinA \x3d sin(angle);\r\n  float cosA \x3d cos(angle);\r\n\r\n  return mat4(cosA, sinA, 0, 0,\r\n              -sinA,  cosA, 0, 0,\r\n              0,     0, 1, 0,\r\n              0,     0, 0, 1);\r\n}\r\n#endif // VV_ROTATION\r\n\r\n#ifdef VV_COLOR\r\nconst int VV_COLOR_N \x3d 8;\r\n\r\nvec4 getVVColor(float colorValue, vec4 fallback) {\r\n  if (isNan(colorValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\r\n    return u_vvColors[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\r\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\r\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvColors[VV_COLOR_N - 1];\r\n}\r\n#endif // VV_COLOR\r\n",
"vvUniforms.glsl":"#if defined(VV_COLOR) || defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE) || defined(VV_OPACITY) || defined(VV_ROTATION)\r\nattribute vec4 a_vv;\r\n#endif // VV_COLOR || VV_SIZE_MIN_MAX_VALUE || VV_SIZE_SCALE_STOPS || VV_SIZE_FIELD_STOPS || VV_SIZE_UNIT_VALUE || VV_OPACITY || VV_ROTATION\r\n\r\n#ifdef VV_COLOR\r\nuniform float u_vvColorValues[8];\r\nuniform vec4 u_vvColors[8];\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nuniform vec4 u_vvSizeMinMaxValue;\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\nuniform float u_vvSizeScaleStopsValue;\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nuniform float u_vvSizeFieldStopsValues[6];\r\nuniform float u_vvSizeFieldStopsSizes[6];\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nuniform float u_vvSizeUnitValueWorldToPixelsRatio;\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nuniform float u_vvOpacityValues[8];\r\nuniform float u_vvOpacities[8];\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nuniform lowp float u_vvRotationType;\r\n#endif // VV_ROTATION\r\n"},
label:{"label.frag":"precision lowp float;\r\n\r\nuniform mediump sampler2D u_referenceTex;\r\nuniform mediump vec2 u_screenSize;\r\nuniform mediump float u_pixelRatio;\r\n\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\nvarying mediump vec2 v_tex;\r\nvarying lowp float v_transparency;\r\n\r\n#ifdef ID\r\nvarying mediump float v_fadeStep;\r\n#else\r\nuniform lowp sampler2D u_texture;\r\nvarying mediump vec4 v_color;\r\n#endif // ID\r\n\r\nconst vec3 epsilon \x3d vec3(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0);\r\n\r\nvoid main()\r\n{\r\n  mediump vec2 refTextPos \x3d gl_FragCoord.xy / (u_pixelRatio * u_screenSize.xy);\r\n  mediump vec4 referenceFragment \x3d texture2D(u_referenceTex, refTextPos);\r\n#ifdef ID\r\n  mediump float alpha \x3d clamp(referenceFragment.a + v_fadeStep, 0.0, 1.0);\r\n  // fill the whole quad\r\n  gl_FragColor \x3d vec4(alpha);\r\n#else\r\n  // read the fade alpha\r\n  lowp float fadeAlpha \x3d referenceFragment.a;\r\n\r\n  // read the distance from the SDF texture\r\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\r\n\r\n  // the edge distance if a factor of the outline width\r\n  float glyphEdgeDistance \x3d 0.75 - v_edgeDistanceOffset;\r\n\r\n  // use a smooth-step in order to calculate the geometry of the shape given by the distance field\r\n  lowp float sdfAlpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist) * v_transparency;\r\n\r\n  gl_FragColor \x3d fadeAlpha * sdfAlpha * v_transparency * v_color;\r\n#endif\r\n}\r\n",
"label.vert":"precision mediump float;\r\n\r\nattribute vec2 a_pos;                  // 2 * 2 (2 x signed 16)\r\nattribute vec4 a_color;                // 4 (4 x unsigned byte)\r\nattribute vec2 a_vertexOffset;         // 2 * 2 // (2 x signed 16) offset from the anchor point of the string\r\nattribute vec4 a_texAndSize;          // 4 (4 x unsigned byte) texture coordinatesm and font size. w is for the halo size\r\nattribute vec4 a_refSymbolAndPlacementOffset; // 4 (4 x unsigned byte) the offset of the reference symbol of the feature (x,y) and the placement offset (z, w) all given in pixels\r\n\r\nattribute lowp float  a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\nattribute mediump vec2 a_visibilityRange; // 2 x unsigned byte;\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n// the size of the mosaic given in pixels\r\nuniform vec2 u_mosaicSize;\r\nuniform float u_pixelRatio;\r\n\r\n// the opacity of the layer\r\nuniform mediump float u_opacity;\r\n\r\n// the curent zoom\r\nuniform mediump float u_zoomLevel; // the current zoom level X 10\r\nuniform lowp float u_mapRotation;\r\nuniform lowp float u_mapAligned;\r\n\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\n\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying mediump vec2 v_tex;\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n\r\n#ifdef ID\r\nuniform mediump float u_fadeStep;\r\nvarying mediump float v_fadeStep;\r\n#else\r\nvarying mediump vec4 v_color;\r\n#endif // ID\r\n\r\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precission we multiply the values\r\n// by 16 and then at the shader devide by the same number\r\nconst float offsetPrecision \x3d 1.0 / 8.0;\r\nconst float outlineScale \x3d 1.0 / 10.0;\r\nconst float sdfFontSize \x3d 24.0;\r\n\r\n// maximum SDF distance of 8 pixels represent the distance values that range from -2 inside the geometry to 6 on the outside.\r\n// 6 is actually the maximum distance outside the glyph, therefore it is the limitation of the halo which is 1/4 of the geometry size.\r\nconst float maxSdfDistance \x3d 8.0;\r\n\r\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\r\n\r\nvoid main()\r\n{\r\n  // make sure to clip the vertices in case that given record is marked as invisible\r\n  float z \x3d 2.0 * (1.0 - a_visible);\r\n\r\n  // clip the vertex if we are beyond the visibility range of the vertex\r\n  // please note: min value of 0 is regarded infinity. max value of 255 is regarded infinity\r\n  z +\x3d 1.0 + sign(a_visibilityRange.x - u_zoomLevel);\r\n  z +\x3d 1.0 + sign(u_zoomLevel - a_visibilityRange.y);\r\n\r\n  // we use the list significant bit of the position in order to store the indication whethe the vertex is of a halow of a glyph\r\n  mediump float halo \x3d mod(a_pos, 2.0).x;\r\n\r\n  float fontSize \x3d a_texAndSize.z;\r\n\r\n  float fontScale \x3d fontSize / sdfFontSize;\r\n  // we need to scale the extrude matrix by the font-scale in order to get the right text size\r\n  mat4 extrudeMatrix \x3d fontScale * u_extrudeMatrix;\r\n\r\n  float mapRotation \x3d u_mapAligned * C_DEG_TO_RAD * -u_mapRotation;\r\n  float sinA \x3d sin(mapRotation);\r\n  float cosA \x3d cos(mapRotation);\r\n\r\n  mat4 mapRotationMat \x3d mat4(cosA, sinA, 0.0, 0.0,\r\n                            -sinA, cosA, 0.0, 0.0,\r\n                              0.0,  0.0, 1.0, 0.0,\r\n                              0.0,  0.0, 0.0, 1.0);\r\n\r\n  vec4 refSymbolOffset \x3d mapRotationMat *  vec4(a_refSymbolAndPlacementOffset.xy, 0.0, 0.0);\r\n\r\n  gl_Position \x3d vec4(u_normalized_origin, 0.0, 0.0) +\r\n                u_transformMatrix * vec4(floor(a_pos * 0.5), z, 1.0) +\r\n                u_extrudeMatrix * vec4(refSymbolOffset.xy + a_refSymbolAndPlacementOffset.zw, 0.0, 0.0) +\r\n                extrudeMatrix * vec4(offsetPrecision * a_vertexOffset, 0.0, 0.0);\r\n\r\n  v_tex \x3d a_texAndSize.xy / u_mosaicSize;\r\n  v_antialiasingWidth \x3d 0.106 * sdfFontSize / fontSize / u_pixelRatio;\r\n  // if halo.x is zero (not a halo) v_edgeDistanceOffset will end up being zero as well.\r\n  v_edgeDistanceOffset \x3d halo * outlineScale * a_texAndSize.w / fontScale / maxSdfDistance;\r\n\r\n  v_transparency \x3d u_opacity;\r\n\r\n#ifdef ID\r\n  v_fadeStep \x3d u_fadeStep;\r\n#else\r\n  v_color \x3d a_color;\r\n#endif // ID\r\n}\r\n"},
line:{"constants.glsl":"const float thinLineHalfWidth \x3d 1.0; // meaning that a 2 pixels line width is considered a thin line\r\nconst float thinLineWidthFactor \x3d 1.1;\r\n","line.frag":"precision lowp float;\r\n\r\nuniform lowp float u_blur;\r\nuniform mediump float u_antialiasing;\r\n\r\nvarying mediump vec2 v_normal;\r\nvarying mediump float v_lineHalfWidth;\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_transparency;\r\n\r\n#if defined(PATTERN) || defined(SDF)\r\nuniform sampler2D u_texture;\r\nuniform mediump float u_zoomFactor;\r\n\r\nvarying mediump vec4 v_tlbr; // normalized pattern coordinates [0, 1]\r\nvarying mediump vec2 v_patternSize;\r\nvarying highp float v_accumulatedDistance;\r\n#endif // PATTERN SDF\r\n\r\n#ifdef SDF\r\nconst float sdfPatternHalfWidth \x3d 15.5; // YF: assumed that the width will be set to 31\r\nconst float widthFactor \x3d 2.0;\r\n\r\n// we need the conversion function from RGBA to float\r\n#include \x3cutil/encoding.glsl\x3e\r\n#endif // SDF\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n// include the thin line parameters (thinLineHalfWidth and thinLineWidthFactor)\r\n#include \x3cmaterials/line/constants.glsl\x3e\r\n\r\nvoid main()\r\n{\r\n  // for now assume that a thin line is a line which is under 2 pixels (1 pixels on either sides of the centerline)\r\n  mediump float thinLineFactor \x3d max(thinLineWidthFactor * step(v_lineHalfWidth, thinLineHalfWidth), 1.0);\r\n\r\n  // dist represent the distance of the fragment from the line. 1.0 or -1.0 will be the values on the edge of the line,\r\n  // and any value in between will be inside the line (the sign represent the direction - right or left).\r\n  // since u_linewidth.s (half line width) is represented in pixels, dist is also given in pixels\r\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\r\n\r\n  // calculate the alpha given the difference between the line-width and the distance of the fragment from the center-line.\r\n  // when it is a thin line then use a slightly shallower slope in order to add more feathering\r\n  lowp float alpha \x3d clamp(thinLineFactor * (v_lineHalfWidth - fragDist) / (u_blur + thinLineFactor - 1.0), 0.0, 1.0);\r\n\r\n#if defined(SDF)\r\n  mediump float lineHalfWidth \x3d widthFactor * v_lineHalfWidth;\r\n  mediump float lineWidthRatio \x3d lineHalfWidth / sdfPatternHalfWidth;\r\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * lineHalfWidth) / (lineWidthRatio * v_patternSize.x), 1.0);\r\n  mediump float relativeTexY \x3d 0.5 + 0.5 * v_normal.y;\r\n\r\n  // claculate the actual texture coordinates by interpolating between the TL/BR pattern coordinates\r\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\r\n\r\n  // calculate the distance from the edge [-0.5, 0.5]\r\n  mediump float d \x3d rgba2float(texture2D(u_texture, texCoord)) - 0.5;\r\n\r\n  // the distance is a proportional to the line width\r\n  float dist \x3d d * lineHalfWidth;\r\n\r\n  lowp vec4 fillPixelColor \x3d v_transparency * alpha * clamp(0.5 - dist, 0.0, 1.0) * v_color;\r\n  gl_FragColor \x3d fillPixelColor;\r\n#elif defined(PATTERN)\r\n  // we need to calculate the relative portion of the line texture along the line given the accumulated distance along the line\r\n  // The computed value should is anumber btween 0 and 1 which will later be used to interpolate btween the BR and TL values\r\n  mediump float relativeTexX \x3d mod((u_zoomFactor * v_accumulatedDistance + v_normal.x * v_lineHalfWidth) / v_patternSize.x, 1.0);\r\n\r\n  // in order to calculate the texture coordinates prependicular to the line (Y axis), we use the interpolated normal values\r\n  // which range from -1.0 to 1.0. On the line's centerline, the value of the interpolated normal is 0.0, however the relative\r\n  // texture value shpould be 0.5 (given that at the bottom of the line, the texture coordinate must be equal to 0.0)\r\n  // (TL) ---------------------------      --\x3e left edge of line. Interpolatedf normal is 1.0\r\n  //              | -\x3e line-width / 2\r\n  //      - - - - - - - - - - - - - -\r\n  //              | -\x3e line-width / 2\r\n  //      ---------------------------- (BR)--\x3e right edge of line. Interpolatedf normal is -1.0\r\n\r\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / v_patternSize.y);\r\n\r\n  // claculate the actual texture coordinates by interpolating between the TL/BR pattern coordinates\r\n  mediump vec2 texCoord \x3d mix(v_tlbr.xy, v_tlbr.zw, vec2(relativeTexX, relativeTexY));\r\n\r\n  // get the color from the texture\r\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\r\n\r\n  gl_FragColor \x3d v_transparency * alpha * v_color * color;\r\n#else // solid line (no texture, no pattern)\r\n  // output the fragment color\r\n  gl_FragColor \x3d v_transparency * alpha * v_color;\r\n#endif // SDF\r\n\r\n#ifdef HIGHLIGHT\r\n  gl_FragColor.a \x3d step(1.0 / 255.0, gl_FragColor.a);\r\n#endif // HIGHLIGHT\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"line.vert":"precision mediump float;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_id;\r\nattribute vec4 a_color;\r\nattribute vec4 a_offsetAndNormal;\r\nattribute vec2 a_accumulatedDistanceAndHalfWidth;\r\nattribute vec4 a_tlbr;\r\nattribute vec4 a_segmentDirection;\r\n\r\nattribute float  a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\nuniform lowp float u_opacity; // the layer's opacity\r\nuniform mediump float u_zoomFactor;\r\nuniform mediump float u_antialiasing;\r\n\r\n// the interpolated normal to the line. the information is packed into the two LSBs of the vertex coordinate\r\nvarying mediump vec2 v_normal;\r\nvarying mediump float v_lineHalfWidth;\r\nvarying lowp vec4 v_color;\r\nvarying lowp float v_transparency;\r\n\r\nconst float scale \x3d 1.0 / 31.0;\r\n#ifdef SDF\r\nconst float widthFactor \x3d 2.0;\r\n#else\r\nconst float widthFactor \x3d 1.0;\r\n#endif\r\n\r\n\r\n#ifdef PATTERN\r\nuniform mediump vec2 u_mosaicSize;\r\n\r\nvarying mediump vec4 v_tlbr; // normalized pattern coordinates [0, 1]\r\nvarying mediump vec2 v_patternSize;\r\n#endif // PATTERN\r\n\r\n// we need to accumulated distance only if it is a pattern or an SDF line\r\n#if defined(PATTERN) || defined(SDF)\r\nvarying highp float v_accumulatedDistance;\r\n#endif // PATTERN SDF\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n// import the VV inputs and functions (they are #ifdefed, so if the proper #define is not set it will end-up being a no-op)\r\n#include \x3cmaterials/line/vvUniforms.glsl\x3e\r\n#include \x3cmaterials/line/vvFunctions.glsl\x3e\r\n\r\n// include the thin line parameters (thinLineHalfWidth and thinLineWidthFactor)\r\n#include \x3cmaterials/line/constants.glsl\x3e\r\n\r\nvoid main()\r\n{\r\n// size VV block\r\n#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\n  mediump float lineHalfWidth \x3d 0.5 * getVVMinMaxSize(a_vv.x, 2.0 * a_accumulatedDistanceAndHalfWidth.y * scale);\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\n  mediump float lineHalfWidth \x3d 0.5 * u_vvSizeScaleStopsValue;\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\n  mediump float lineHalfWidth \x3d 0.5 * getVVStopsSize(a_vv.x, 2.0 * a_accumulatedDistanceAndHalfWidth.y * scale);\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\n  mediump float lineHalfWidth \x3d 0.5 * getVVUnitValue(a_vv.x, 2.0 * a_accumulatedDistanceAndHalfWidth.y * scale);\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#else // no VV\r\n  mediump float lineHalfWidth \x3d a_accumulatedDistanceAndHalfWidth.y * scale;\r\n#endif // defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n#ifdef VV_OPACITY\r\nv_transparency \x3d u_opacity * getVVOpacity(a_vv.z);\r\n#else\r\nv_transparency \x3d u_opacity;\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nv_color \x3d getVVColor(a_vv.y, a_color);\r\n#else\r\nv_color \x3d a_color;\r\n#endif // VV_COLOR\r\n\r\n  // make sure to clip the vertices in case that the width of the line is 0 (or negative), or in case that the line is not visible\r\n  float z \x3d 2.0 * (step(lineHalfWidth, 0.0) + (1.0 - a_visible));\r\n\r\n  // add an antialiasing distance. We use 0.2 rather than 0.5 in order to match the SVG renderer\r\n  // also limit the total line width to 1.3 pixels. Below this value lines don't look good compared to the SVG renderer\r\n  lineHalfWidth \x3d max(lineHalfWidth, 0.45) + 0.2 * u_antialiasing;\r\n\r\n  // for now assume that a thin line is a line which is under 2 pixels (1 pixels on either sides of the centerline)\r\n  // in practice, a thin line is a line who's half width vary from 0.45px to the value of thinLineHalfWidth, as the value\r\n  // is claped in line 221 above\r\n  mediump float thinLineFactor \x3d max(thinLineWidthFactor * step(lineHalfWidth, thinLineHalfWidth), 1.0);\r\n\r\n  v_lineHalfWidth \x3d lineHalfWidth;\r\n\r\n  // calculate the relative distance from the centerline to the edge of the line. Since offset is given in integers (for the\r\n  // sake of using less attribute memory, we need to scale it back to the original range of ~ [0, 1])\r\n  // in a case of a thin line we move each vertex twice as far\r\n  mediump vec2 dist \x3d thinLineFactor * widthFactor * lineHalfWidth * a_offsetAndNormal.xy * scale;\r\n\r\n  // transform the vertex\r\n  gl_Position \x3d vec4(u_normalized_origin, 0.0, 0.0) + u_transformMatrix * vec4(a_pos, z, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\r\n  v_normal \x3d a_offsetAndNormal.zw * scale;\r\n\r\n#if defined(PATTERN) || defined(SDF)\r\n  v_accumulatedDistance \x3d a_accumulatedDistanceAndHalfWidth.x + dot(scale * a_segmentDirection.xy, dist / u_zoomFactor);\r\n#endif // PATTERN || SDF\r\n\r\n#ifdef PATTERN\r\nv_tlbr \x3d vec4(a_tlbr.x / u_mosaicSize.x, a_tlbr.y / u_mosaicSize.y, a_tlbr.z / u_mosaicSize.x, a_tlbr.w / u_mosaicSize.y);\r\nv_patternSize \x3d vec2(a_tlbr.z - a_tlbr.x, a_tlbr.w - a_tlbr.y);\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\nv_id \x3d a_id;\r\n#endif // ID\r\n}\r\n",
"vvFunctions.glsl":"bool isNan(float val) {\r\n  return !( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 );\r\n}\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  float f \x3d (sizeValue - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\r\n  return clamp(mix(u_vvSizeMinMaxValue.z, u_vvSizeMinMaxValue.w, f), u_vvSizeMinMaxValue.z, u_vvSizeMinMaxValue.w);\r\n}\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nconst int VV_SIZE_N \x3d 6;\r\nfloat getVVStopsSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\r\n    return u_vvSizeFieldStopsSizes[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\r\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\r\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\r\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\r\n}\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nfloat getVVUnitValue(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\r\n}\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nconst int VV_OPACITY_N \x3d 8;\r\nfloat getVVOpacity(float opacityValue) {\r\n  if (isNan(opacityValue)) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\r\n    return u_vvOpacities[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\r\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\r\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvOpacities[VV_OPACITY_N - 1];\r\n}\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nconst int VV_COLOR_N \x3d 8;\r\n\r\nvec4 getVVColor(float colorValue, vec4 fallback) {\r\n  if (isNan(colorValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\r\n    return u_vvColors[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\r\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\r\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvColors[VV_COLOR_N - 1];\r\n}\r\n#endif // VV_COLOR\r\n",
"vvUniforms.glsl":"#if defined(VV_COLOR) || defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE) || defined(VV_OPACITY)\r\nattribute vec3 a_vv;\r\n#endif // VV_COLOR || VV_SIZE_MIN_MAX_VALUE || VV_SIZE_SCALE_STOPS || VV_SIZE_FIELD_STOPS || VV_SIZE_UNIT_VALUE || VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\nuniform float u_vvColorValues[8];\r\nuniform vec4 u_vvColors[8];\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nuniform vec4 u_vvSizeMinMaxValue;\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\nuniform float u_vvSizeScaleStopsValue;\r\n#endif\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nuniform float u_vvSizeFieldStopsValues[6];\r\nuniform float u_vvSizeFieldStopsSizes[6];\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nuniform float u_vvSizeUnitValueWorldToPixelsRatio;\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nuniform float u_vvOpacityValues[8];\r\nuniform float u_vvOpacities[8];\r\n#endif // VV_OPACITY\r\n"},
text:{"text.frag":"precision lowp float;\r\n\r\nuniform lowp sampler2D u_texture;\r\n\r\nvarying mediump vec4 v_color;\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\nvarying mediump vec2 v_tex;\r\nvarying lowp float v_transparency;\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main()\r\n{\r\n  // read the distance from the SDF texture\r\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\r\n\r\n  // the edge distance if a factor of the outline width\r\n  float glyphEdgeDistance \x3d 0.75 - v_edgeDistanceOffset;\r\n\r\n  // use a smooth-step in order to calculate the geometry of the shape given by the distance field\r\n  lowp float alpha \x3d smoothstep(glyphEdgeDistance - v_antialiasingWidth, glyphEdgeDistance + v_antialiasingWidth, dist) * v_transparency;\r\n\r\n  gl_FragColor \x3d alpha * v_color;\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"text.vert":"precision mediump float;\r\n\r\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\r\n\r\nattribute vec2 a_pos;           // 2 * 2 (2 x signed 16)\r\nattribute vec4 a_id;            // 4 (4 x unsigned byte)\r\nattribute vec4 a_color;         // 4 (4 x unsigned byte)\r\nattribute vec2 a_vertexOffset; // 2 * 2 // (2 x signed 16) offset from the anchor point of the string\r\nattribute vec4 a_texFontSize; // 4 (4 x unsigned byte) texture coordinatesm and font size\r\n\r\nattribute lowp float  a_visible; // a one byte controlling the visibility of the vertex (a separate visibility buffer), values are 0 or 1 (visible)\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n// the size of the mosaic given in pixels\r\nuniform vec2 u_mosaicSize;\r\nuniform float u_pixelRatio;\r\n\r\n// the opacity of the layer\r\nuniform mediump float u_opacity;\r\n\r\nvarying mediump vec4 v_color;\r\nvarying mediump float v_antialiasingWidth;\r\nvarying mediump float v_edgeDistanceOffset;\r\n\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying mediump vec2 v_tex;\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n\r\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precission we multiply the values\r\n// by 16 and then at the shader devide by the same number\r\nconst float offsetPrecision \x3d 1.0 / 8.0;\r\nconst float outlineScale \x3d 1.0 / 10.0;\r\nconst float sdfFontSize \x3d 24.0;\r\n\r\n// maximum SDF distance of 8 pixels represent the distance values that range from -2 inside the geometry to 6 on the outside.\r\n// 6 is actually the maximum distance outside the glyph, therefore it is the limitation of the halo which is 1/4 of the geometry size.\r\nconst float maxSdfDistance \x3d 8.0;\r\n\r\n#ifdef ID\r\nvarying highp vec4 v_id;\r\n#endif // ID\r\n\r\n// import the VV inputs and functions (they are #ifdefed, so if the proper #define is not set it will end-up being a no-op)\r\n#include \x3cmaterials/text/vvUniforms.glsl\x3e\r\n#include \x3cmaterials/text/vvFunctions.glsl\x3e\r\n\r\nvoid main()\r\n{\r\n  // make sure to clip the vertices in case that given record is marked as invisible\r\n  float z \x3d 2.0 * (1.0 - a_visible);\r\n\r\n  // we use the list significant bit of the position in order to store the indication whethe the vertex is of a halow of a glyph\r\n  mediump float halo \x3d mod(a_pos, 2.0).x;\r\n\r\n#if defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\n  // vv size override the original symbol's size\r\n  vec2 size \x3d vec2(getVVMinMaxSize(a_vv.x, a_texFontSize.z));\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\n  vec2 size \x3d vec2(u_vvSizeScaleStopsValue);\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\n  vec2 size \x3d vec2(getVVStopsSize(a_vv.x, a_texFontSize.z));\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\n  vec2 size \x3d vec2(getVVUnitValue(a_vv.x, a_texFontSize.z));\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n  float fontSize \x3d size.x;\r\n#else // this generic case, no VV\r\n  float fontSize \x3d a_texFontSize.z;\r\n#endif // defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE)\r\n\r\n  float fontScale \x3d fontSize / sdfFontSize;\r\n  // we need to scale the extrude matrix by the font-scale in order to get the right text size\r\n  mat4 extrudeMatrix \x3d fontScale * u_extrudeMatrix;\r\n\r\n  // If the label rotates with the map, and if the rotated label is upside down, hide it\r\n  //gl_Position \x3d vec4(u_normalized_origin, 0.0, 0.0) + u_transformMatrix * vec4(floor(a_pos * 0.5), z, 1.0) + extrudeMatrix * vec4(offsetPrecision * a_vertexOffset, 0.0, 0.0);\r\n\r\n#ifdef VV_ROTATION\r\n  gl_Position \x3d vec4(u_normalized_origin, 0.0, 0.0) + u_transformMatrix * vec4(floor(a_pos * 0.5), z, 1.0) + extrudeMatrix * getVVRotation(a_vv.w) * vec4(offsetPrecision * a_vertexOffset, 0.0, 0.0);\r\n#else\r\n  gl_Position \x3d vec4(u_normalized_origin, 0.0, 0.0) + u_transformMatrix * vec4(floor(a_pos * 0.5), z, 1.0) + extrudeMatrix * vec4(offsetPrecision * a_vertexOffset, 0.0, 0.0);\r\n#endif // VV_ROTATION\r\n\r\n  v_tex \x3d a_texFontSize.xy / u_mosaicSize;\r\n  v_antialiasingWidth \x3d 0.105 * sdfFontSize / fontSize / u_pixelRatio;\r\n  // if halo.x is zero (not a halo) v_edgeDistanceOffset will end up being zero as well.\r\n  v_edgeDistanceOffset \x3d halo * outlineScale * a_texFontSize.w / fontScale / maxSdfDistance;\r\n\r\n#ifdef VV_OPACITY\r\n  v_transparency \x3d getVVOpacity(a_vv.z);\r\n#else\r\n  v_transparency \x3d u_opacity;\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_COLOR\r\n  // we don't want to override the halo color\r\n  v_color \x3d halo * a_color + (1.0 - halo) * getVVColor(a_vv.y, a_color);\r\n#else\r\n  v_color \x3d a_color;\r\n#endif // VV_COLOR\r\n\r\n#ifdef ID\r\n  v_id \x3d a_id;\r\n#endif // ID\r\n}\r\n",
"vvFunctions.glsl":"bool isNan(float val) {\r\n  return !( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 );\r\n}\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nfloat getVVMinMaxSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  // we need to multiply by 8 in order to translate to tile coordinates\r\n  float interpolationRatio \x3d (sizeValue  - u_vvSizeMinMaxValue.x) / (u_vvSizeMinMaxValue.y - u_vvSizeMinMaxValue.x);\r\n  return clamp(u_vvSizeMinMaxValue.z + interpolationRatio * (u_vvSizeMinMaxValue.w - u_vvSizeMinMaxValue.z), u_vvSizeMinMaxValue.z, u_vvSizeMinMaxValue.w);\r\n}\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nconst int VV_SIZE_N \x3d 6;\r\nfloat getVVStopsSize(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (sizeValue \x3c\x3d u_vvSizeFieldStopsValues[0]) {\r\n    return u_vvSizeFieldStopsSizes[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_SIZE_N; ++i) {\r\n    if (u_vvSizeFieldStopsValues[i] \x3e\x3d sizeValue) {\r\n      float f \x3d (sizeValue - u_vvSizeFieldStopsValues[i-1]) / (u_vvSizeFieldStopsValues[i] - u_vvSizeFieldStopsValues[i-1]);\r\n      return mix(u_vvSizeFieldStopsSizes[i-1], u_vvSizeFieldStopsSizes[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvSizeFieldStopsSizes[VV_SIZE_N - 1];\r\n}\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nfloat getVVUnitValue(float sizeValue, float fallback) {\r\n  if (isNan(sizeValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  return u_vvSizeUnitValueWorldToPixelsRatio * sizeValue;\r\n}\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nconst int VV_OPACITY_N \x3d 8;\r\nfloat getVVOpacity(float opacityValue) {\r\n  if (isNan(opacityValue)) {\r\n    return 1.0;\r\n  }\r\n\r\n  if (opacityValue \x3c\x3d u_vvOpacityValues[0]) {\r\n    return u_vvOpacities[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_OPACITY_N; ++i) {\r\n    if (u_vvOpacityValues[i] \x3e\x3d opacityValue) {\r\n      float f \x3d (opacityValue - u_vvOpacityValues[i-1]) / (u_vvOpacityValues[i] - u_vvOpacityValues[i-1]);\r\n      return mix(u_vvOpacities[i-1], u_vvOpacities[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvOpacities[VV_OPACITY_N - 1];\r\n}\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nmat4 getVVRotation(float rotationValue) {\r\n  // YF TODO: if the symbol has rotation we need to combine the symbo's rotation with the VV one\r\n  if (isNan(rotationValue)) {\r\n    return mat4(1, 0, 0, 0,\r\n                0, 1, 0, 0,\r\n                0, 0, 1, 0,\r\n                0, 0, 0, 1);\r\n  }\r\n\r\n  float rotation \x3d rotationValue;\r\n  if (u_vvRotationType \x3d\x3d 1.0) {\r\n    rotation \x3d 90.0 - rotation;\r\n  }\r\n\r\n  float angle \x3d C_DEG_TO_RAD * rotation;\r\n\r\n  float sinA \x3d sin(angle);\r\n  float cosA \x3d cos(angle);\r\n\r\n  return mat4(cosA, sinA, 0, 0,\r\n              -sinA,  cosA, 0, 0,\r\n              0,     0, 1, 0,\r\n              0,     0, 0, 1);\r\n}\r\n#endif // VV_ROTATION\r\n\r\n#ifdef VV_COLOR\r\nconst int VV_COLOR_N \x3d 8;\r\n\r\nvec4 getVVColor(float colorValue, vec4 fallback) {\r\n  if (isNan(colorValue)) {\r\n    return fallback;\r\n  }\r\n\r\n  if (colorValue \x3c\x3d u_vvColorValues[0]) {\r\n    return u_vvColors[0];\r\n  }\r\n\r\n  for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n    if (u_vvColorValues[i] \x3e\x3d colorValue) {\r\n      float f \x3d (colorValue - u_vvColorValues[i-1]) / (u_vvColorValues[i] - u_vvColorValues[i-1]);\r\n      return mix(u_vvColors[i-1], u_vvColors[i], f);\r\n    }\r\n  }\r\n\r\n  return u_vvColors[VV_COLOR_N - 1];\r\n}\r\n#endif // VV_COLOR\r\n",
"vvUniforms.glsl":"#if defined(VV_COLOR) || defined(VV_SIZE_MIN_MAX_VALUE) || defined(VV_SIZE_SCALE_STOPS) || defined(VV_SIZE_FIELD_STOPS) || defined(VV_SIZE_UNIT_VALUE) || defined(VV_OPACITY) || defined(VV_ROTATION)\r\nattribute vec4 a_vv;\r\n#endif // VV_COLOR || VV_SIZE_MIN_MAX_VALUE || VV_SIZE_SCALE_STOPS || VV_SIZE_FIELD_STOPS || VV_SIZE_UNIT_VALUE || VV_OPACITY || VV_ROTATION\r\n\r\n#ifdef VV_COLOR\r\nuniform float u_vvColorValues[8];\r\nuniform vec4 u_vvColors[8];\r\n#endif // VV_COLOR\r\n\r\n#ifdef VV_SIZE_MIN_MAX_VALUE\r\nuniform vec4 u_vvSizeMinMaxValue;\r\n#endif // VV_SIZE_MIN_MAX_VALUE\r\n\r\n#ifdef VV_SIZE_SCALE_STOPS\r\nuniform float u_vvSizeScaleStopsValue;\r\n#endif // VV_SIZE_SCALE_STOPS\r\n\r\n#ifdef VV_SIZE_FIELD_STOPS\r\nuniform float u_vvSizeFieldStopsValues[6];\r\nuniform float u_vvSizeFieldStopsSizes[6];\r\n#endif // VV_SIZE_FIELD_STOPS\r\n\r\n#ifdef VV_SIZE_UNIT_VALUE\r\nuniform float u_vvSizeUnitValueWorldToPixelsRatio;\r\n#endif // VV_SIZE_UNIT_VALUE\r\n\r\n#ifdef VV_OPACITY\r\nuniform float u_vvOpacityValues[8];\r\nuniform float u_vvOpacities[8];\r\n#endif // VV_OPACITY\r\n\r\n#ifdef VV_ROTATION\r\nuniform lowp float u_vvRotationType;\r\n#endif // VV_ROTATION\r\n"}},
stencil:{"stencil.frag":"void main() {\r\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n}\r\n","stencil.vert":"attribute vec2 a_pos;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(a_pos, 0.0, 1.0);\r\n}\r\n"},tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main(void) {\r\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\r\n  gl_FragColor \x3d 0.75 * color;\r\n}\r\n","tileInfo.vert":"attribute vec2 a_pos;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform mediump vec2 u_normalized_origin;\r\nuniform mediump float u_depth;\r\nuniform mediump float u_coord_ratio;\r\nuniform mediump vec2 u_delta; // in tile coordinates\r\nuniform mediump vec2 u_dimensions; // in tile coordinates\r\n\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main() {\r\n  mediump vec2 offests \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(offests, 0.0, 1.0);\r\n\r\n  v_tex \x3d a_pos;\r\n}\r\n"},
util:{"encoding.glsl":"// Factors to convert rgba back to float\r\nconst vec4 rgba2float_factors \x3d vec4(\r\n    255.0 / (256.0),\r\n    255.0 / (256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n  );\r\n\r\nfloat rgba2float(vec4 rgba) {\r\n  // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n  // add the components together with their corresponding\r\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n  return dot(rgba, rgba2float_factors);\r\n}\r\n"}}})},
"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(n,e){return function(){function a(a){this.readFile=a}a.prototype.resolveIncludes=function(a){return this.resolve(a)};a.prototype.resolve=function(a,c){var b=this;void 0===c&&(c=new Map);if(c.has(a))return c.get(a);var f=this.read(a);if(!f)throw Error("cannot find shader file "+a);for(var h=/^\h?#include\s+<(\S+)>\h?/gm,g=h.exec(f),l=[];null!=g;)l.push({path:g[1],start:g.index,length:g[0].length}),g=h.exec(f);var m=
0,k="";l.forEach(function(a){k+=f.slice(m,a.start);k+=c.has(a.path)?"":b.resolve(a.path,c);m=a.start+a.length});k+=f.slice(m);c.set(a,k);return k};a.prototype.read=function(a){return this.readFile(a)};return a}()})},"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../3d/support/buffer/typedArrayUtil"],function(n,e,a,b){return function(){function a(b,c,h,g,l){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=
void 0;this._context=b;this._bufferType=c;this._usage=h;this._id=a._nextId++;this._glName=this._context.gl.createBuffer();g&&this.setData(g,l)}a.createIndex=function(b,c,h,g){return new a(b,34963,c,h,g)};a.createVertex=function(b,c,h){return new a(b,34962,c,h)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"byteSize",{get:function(){return 34962===this._bufferType?
this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context=null)};a.prototype.setData=function(a,c){if(a){if("number"===typeof a){if(0>a&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&c)switch(this._indexType=c,this._size=a,c){case 5123:a*=2;break;case 5125:a*=4}}else c=a.byteLength,b.isUint16Array(a)&&
(c/=2,this._indexType=5123),b.isUint32Array(a)&&(c/=4,this._indexType=5125),this._size=c;c=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,a,this._usage);this._context.bindVAO(c)}};a.prototype.setSubData=function(a,c,h,g){void 0===c&&(c=0);void 0===h&&(h=0);if(a){(0>c||c>=this._size)&&console.error("offset is out of range!");var f=c,d=h,k=g,e=a.byteLength;b.isUint16Array(a)&&(e/=2,f*=2,d*=2,k*=2);b.isUint32Array(a)&&
(e/=4,f*=4,d*=4,k*=4);void 0===g&&(g=e-1);h>=g&&console.error("end must be bigger than start!");c+h-g>this._size&&console.error("An attempt to write beyond the end of the buffer!");c=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);h=this._context.gl;a=ArrayBuffer.isView(a)?a.buffer:a;h.bufferSubData(this._bufferType,f,a.slice(d,k));this._context.bindVAO(c)}};a._nextId=0;return a}()})},"esri/views/3d/support/buffer/typedArrayUtil":function(){define(["require",
"exports"],function(n,e){Object.defineProperty(e,"__esModule",{value:!0});e.forEach=function(a,b){if(a.forEach)a.forEach(b);else for(var c=0;c<a.length;c++)b(a[c],c,a)};e.slice=function(a,b,c){if(a.slice)return a.slice(b,c);void 0===b?b=0:(0>b&&(b+=a.length),b=Math.min(a.length,Math.max(0,b)));void 0===c?c=a.length:(0>c&&(c+=a.length),c=Math.min(a.length,Math.max(0,c)));c=Math.max(0,c-b);for(var d=new a.constructor(c),f=0;f<c;f++)d[f]=a[b+f];return d};e.isArrayBuffer=function(a){return a instanceof
ArrayBuffer||a&&a.constructor&&"ArrayBuffer"===a.constructor.name};e.isInt8Array=function(a){return a instanceof Int8Array||a&&a.constructor&&"Int8Array"===a.constructor.name};e.isUint8Array=function(a){return a instanceof Uint8Array||a&&a.constructor&&"Uint8Array"===a.constructor.name};e.isInt16Array=function(a){return a instanceof Int16Array||a&&a.constructor&&"Int16Array"===a.constructor.name};e.isUint16Array=function(a){return a instanceof Uint16Array||a&&a.constructor&&"Uint16Array"===a.constructor.name};
e.isInt32Array=function(a){return a instanceof Int32Array||a&&a.constructor&&"Int32Array"===a.constructor.name};e.isUint32Array=function(a){return a instanceof Uint32Array||a&&a.constructor&&"Uint32Array"===a.constructor.name};e.isFloat32Array=function(a){return a instanceof Float32Array||a&&a.constructor&&"Float32Array"===a.constructor.name};e.isFloat64Array=function(a){return a instanceof Float64Array||a&&a.constructor&&"Float64Array"===a.constructor.name}})},"esri/views/webgl/programUtils":function(){define(["require",
"exports","./Program"],function(n,e,a){function b(b,d,f){f=f||{};f="function"===typeof d.shaders?d.shaders(f):d.shaders;return new a(b,f.vertexShader,f.fragmentShader,d.attributes)}Object.defineProperty(e,"__esModule",{value:!0});e.glslifyDefineMap=function(a){var b="",c;for(c in a){var h=a[c];if("boolean"===typeof h)h&&(b+="#define "+c+"\n");else if("number"===typeof h)b+="#define "+c+" "+h.toFixed()+"\n";else if("object"===typeof h){var g=h.options,l=0,m;for(m in g)b+="#define "+g[m]+" "+(l++).toFixed()+
"\n";b+="#define "+c+" "+g[h.value]+"\n"}}return b};n=function(){function a(a){this._programCacheByTemplate=new Map;this._rctx=a}a.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._programCacheByTemplate=null};a.prototype.getProgram=function(a,c){var f=this;this._programCacheByTemplate.has(a)||this.addProgramTemplate(a,function(c){return b(f._rctx,a,c)});return this.getProgramTemplateInstance(a,c)};a.prototype.addProgramTemplate=
function(a,b){this._programCacheByTemplate.set(a,{constructor:b,programs:new Map})};a.prototype.getProgramTemplateInstance=function(a,b){if(a=this._programCacheByTemplate.get(a)){var c=b?JSON.stringify(b):"default";a.programs.has(c)||(b=a.constructor(b),a.programs.set(c,b));return a.programs.get(c)}return null};return a}();e.ProgramCache=n;e.createProgram=b})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","./ShaderTranspiler"],function(n,e,a,b){return function(){function a(b,
c,h,g,l){void 0===l&&(l={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};b||console.error("RenderingContext isn't initialized!");0===c.length&&console.error("Shaders source should not be empty!");
this._context=b;this._vertexShaderSource=c;this._fragmentShaderSource=h;if(Array.isArray(l))for(b=0;b<l.length;b++)this._defines[l[b]]="1";else this._defines=l;this._id=a._nextId++;this._locations=g}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},
enumerable:!0,configurable:!0});a.prototype.getDefine=function(a){return this._defines[a]};a.prototype.dispose=function(){if(this._context){var a=this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};a.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);
this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,b=a.createProgram();a.attachShader(b,this._vShader);a.attachShader(b,this._fShader);for(var c in this._locations)a.bindAttribLocation(b,this._locations[c],c);a.linkProgram(b);a.getProgramParameter(b,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(b,a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(b));this._glName=b;this._initialized=
!0}};a.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};a.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};a.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};
a.prototype.setUniform1i=function(a,b){var c=this._nameToUniform1[a];if(void 0===c||b!==c)this._context.bindProgram(this),this._context.gl.uniform1i(this.getUniformLocation(a),b),this._nameToUniform1[a]=b};a.prototype.setUniform1f=function(a,b){var c=this._nameToUniform1[a];if(void 0===c||b!==c)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),b),this._nameToUniform1[a]=b};a.prototype.setUniform1fv=function(a,b){var c=this._nameToUniform1[a];if(void 0===c||b[0]!==
c)this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(a),b),this._nameToUniform1[a]=b[0]};a.prototype.setUniform2f=function(a,b,c){var f=this._nameToUniform2[a];if(void 0===f||b!==f[0]||c!==f[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),b,c),void 0===f?this._nameToUniform2[a]=[b,c]:(f[0]=b,f[1]=c)};a.prototype.setUniform2fv=function(b,c){var f=this._nameToUniform2[b];void 0!==f&&a._arraysEqual(c,f)||(this._context.bindProgram(this),
this._context.gl.uniform2fv(this.getUniformLocation(b),c),void 0===f?this._nameToUniform2[b]=a._arrayCopy(c):a._arrayAssign(c,f))};a.prototype.setUniform3f=function(a,b,c,g){var f=this._nameToUniform3[a];if(void 0===f||b!==f[0]||c!==f[1]||g!==f[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),b,c,g),void 0===f?this._nameToUniform3[a]=[b,c,g]:(f[0]=b,f[1]=c,f[2]=g)};a.prototype.setUniform3fv=function(b,c){var f=this._nameToUniform3[b];void 0!==f&&a._arraysEqual(c,
f)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(b),c),void 0===f?this._nameToUniform3[b]=a._arrayCopy(c):a._arrayAssign(c,f))};a.prototype.setUniform4f=function(a,b,c,g,l){var f=this._nameToUniform4[a];if(void 0===f||b!==f[0]||c!==f[1]||g!==f[2]||l!==f[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),b,c,g,l),void 0===f?this._nameToUniform4[a]=[b,c,g,l]:(f[0]=b,f[1]=c,f[2]=g,f[3]=l)};a.prototype.setUniform4fv=function(b,
c){var f=this._nameToUniform4[b];void 0!==f&&a._arraysEqual(c,f)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(b),c),void 0===f?this._nameToUniform4[b]=a._arrayCopy(c):a._arrayAssign(c,f))};a.prototype.setUniformMatrix3fv=function(b,c,h){void 0===h&&(h=!1);var f=this._nameToUniformMatrix3[b];void 0!==f&&(9===f.length?a._matrix3Equal(f,c):a._arraysEqual(c,f))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(b),h,c),
void 0===f?this._nameToUniformMatrix3[b]=a._arrayCopy(c):a._arrayAssign(c,f))};a.prototype.setUniformMatrix4fv=function(b,c,h){void 0===h&&(h=!1);var f=this._nameToUniformMatrix4[b];void 0!==f&&(16===f.length?a._matrix4Equal(f,c):a._arraysEqual(c,f))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(b),h,c),void 0===f?this._nameToUniformMatrix4[b]=a._arrayCopy(c):a._arrayAssign(c,f))};a._padToThree=function(a){var b=a.toString();1E3>a&&(b=("  "+a).slice(-3));
return b};a.prototype._addLineNumbers=function(b){var c=2;return b.replace(/\n/g,function(){return"\n"+a._padToThree(c++)+":"})};a.prototype._loadShader=function(a){var c=35633===a,d=c?this._vertexShaderSource:this._fragmentShaderSource,g;g="";for(var l in this._defines)g+="#define "+l+" "+this._defines[l]+"\n";g+=d;"webgl2"===this._context.contextVersion&&(g=b.transpileShader(g,c?"vertex":"fragment"));c=this._context.gl;a=c.createShader(a);c.shaderSource(a,g);c.compileShader(a);c.getShaderParameter(a,
c.COMPILE_STATUS)||(console.error(c.getShaderInfoLog(a)),console.error(this._addLineNumbers(g)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),console.log(d)));return a};a._matrix4Equal=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};a._matrix3Equal=function(a,b){return a[0]===
b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};a._arraysEqual=function(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0};a._arrayCopy=function(a){for(var b=[],c=0;c<a.length;++c)b.push(a[c]);return b};a._arrayAssign=function(a,b){for(var c=0;c<a.length;++c)b[c]=a[c]};a._nextId=0;return a}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3",
"./lib/glsl-tokenizer/string"],function(n,e,a,b){function c(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function d(a,b,c,f){f=f||c;for(var g=0;g<a.length;g++){var h=a[g];if("ident"===h.type&&h.data===c)return f in b?b[f]++:b[f]=0,d(a,b,f+"_"+b[f],f)}return c}function f(a,b,c){void 0===c&&(c="afterVersion");var f={data:"\n",type:"whitespace"},g=function(b){return b<a.length?/[^\r\n]$/.test(a[b].data):!1},d=function(a){for(var b=-1,f=0,g=-1,d=0;d<a.length;d++){var h=a[d];"preprocessor"===
h.type&&(h.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++f:h.data.match(/\#endif\s*.*/)&&--f);("afterVersion"===c||"afterPrecision"===c)&&"preprocessor"===h.type&&/^#version/.test(h.data)&&(g=Math.max(g,d));if("afterPrecision"===c&&"keyword"===h.type&&"precision"===h.data){a:{for(h=d;h<a.length;h++){var l=a[h];if("operator"===l.type&&";"===l.data)break a}h=null}if(null===h)throw Error("precision statement not followed by any semicolons!");g=Math.max(g,h)}b<g&&0===f&&(b=d)}return b+1}(a);g(d-1)&&a.splice(d++,
0,f);for(var h=0;h<b.length;h++){var l=b[h];a.splice(d++,0,l)}g(d-1)&&g(d)&&a.splice(d,0,f)}Object.defineProperty(e,"__esModule",{value:!0});var h=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];e.transpileShader=function(g,l){g=b(g);var m;a:{m="100";var k="300 es";void 0===m&&(m="100");void 0===k&&(k="300 es");for(var e=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,q=0;q<g.length;q++){var p=g[q];if("preprocessor"===p.type){var r=e.exec(p.data);
if(r)if(e=r[1].replace(/\s\s+/g," "),e===k){m=e;break a}else if(e===m){p.data="#version "+k;break a}else throw Error("unknown glsl version: "+e);}}g.splice(0,0,{type:"preprocessor",data:"#version "+k},{type:"whitespace",data:"\n"});m=null}if("300 es"===m)throw Error("shader is already glsl 300 es");e=p=null;q={};r={};for(m=0;m<g.length;++m)switch(k=g[m],k.type){case "keyword":"vertex"===l&&"attribute"===k.data?k.data="in":"varying"===k.data&&(k.data="vertex"===l?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(k.data.trim())&&
(k.data=k.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===l&&"gl_FragColor"===k.data){if(!p){var p=d(g,q,"fragColor"),t=void 0;void 0===t&&(t="lowp");f(g,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:p},{type:"operator",data:";"}],"afterPrecision")}k.data=p}else"fragment"===l&&"gl_FragDepthEXT"===k.data&&(e||(e=d(g,q,"gl_FragDepth")),k.data=e);break;case "ident":if(0<=
a.indexOf(k.data)){if(t="vertex"===l)a:{for(t=m-1;0<=t;t--){var u=g[t];if("whitespace"!==u.type&&"block-comment"!==u.type)if("keyword"===u.type){if("attribute"===u.data||"in"===u.data){t=!0;break a}}else break}t=!1}if(t)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");k.data in r||(r[k.data]=d(g,q,k.data));k.data=r[k.data]}}for(m=g.length-1;0<=m;--m)k=g[m],"preprocessor"===k.type&&((l=k.data.match(/\#extension\s+(.*)\:/))&&l[1]&&0<=h.indexOf(l[1].trim())&&
(l=g[m+1],g.splice(m,l&&"whitespace"===l.type?2:1)),(l=k.data.match(/\#ifdef\s+(.*)/))&&l[1]&&0<=h.indexOf(l[1].trim())&&(k.data="#if 1"),(l=k.data.match(/\#ifndef\s+(.*)/))&&l[1]&&0<=h.indexOf(l[1].trim())&&(k.data="#if 0"));return c(g)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(n,e){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(n){"use strict;";return function(e){var a=n(),b=[],b=b.concat(a(e));return b=b.concat(a(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(n,e,a){"use strict;";var b="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function c(a){a.length&&u.push({type:b[q],
data:a,position:w,line:x,column:z})}function d(){t=t.length?[]:t;if("/"===r&&"*"===p)return w=v+k-1,q=0,r=p,k+1;if("/"===r&&"/"===p)return w=v+k-1,q=1,r=p,k+1;if("#"===p)return q=2,w=v+k,k;if(/\s/.test(p))return q=9,w=v+k,k;y=/\d/.test(p);A=/[^\w_]/.test(p);w=v+k;q=y?4:A?3:9999;return k}function f(){if(("\r"===p||"\n"===p)&&"\\"!==r)return c(t.join("")),q=999,k;t.push(p);r=p;return k+1}function h(){if("."===r&&/\d/.test(p))return q=5,k;if("/"===r&&"*"===p)return q=0,k;if("/"===r&&"/"===p)return q=
1,k;if("."===p&&t.length){for(;g(t););q=5;return k}if(";"===p||")"===p||"("===p){if(t.length)for(;g(t););c(p);q=999;return k+1}var a=2===t.length&&"\x3d"!==p;if(/[\w_\d\s]/.test(p)||a){for(;g(t););q=999;return k}t.push(p);r=p;return k+1}function g(a){var b=0,f,g;do{f=e.indexOf(a.slice(0,a.length+b).join(""));g=e[f];if(-1===f){if(0<b--+a.length)continue;g=a.slice(0,1).join("")}c(g);w+=g.length;t=t.slice(g.length);return t.length}while(1)}function l(){if("."===p||/[eE]/.test(p))return t.push(p),q=5,
r=p,k+1;if("x"===p&&1===t.length&&"0"===t[0])return q=11,t.push(p),r=p,k+1;if(/[^\d]/.test(p))return c(t.join("")),q=999,k;t.push(p);r=p;return k+1}function m(){"f"===p&&(t.push(p),r=p,k+=1);if(/[eE]/.test(p)||"-"===p&&/[eE]/.test(r))return t.push(p),r=p,k+1;if(/[^\d]/.test(p))return c(t.join("")),q=999,k;t.push(p);r=p;return k+1}var k=0,v=0,q=999,p,r,t=[],u=[],x=1,z=0,w=0,y=!1,A=!1,H="",D;return function(b){u=[];if(null!==b){b=b.replace?b.replace(/\r\n/g,"\n"):b;k=0;H+=b;for(D=H.length;p=H[k],k<
D;){b=k;switch(q){case 0:"/"===p&&"*"===r?(t.push(p),c(t.join("")),q=999):(t.push(p),r=p);k+=1;break;case 1:k=f();break;case 2:k=f();break;case 3:k=h();break;case 4:k=l();break;case 11:/[^a-fA-F0-9]/.test(p)?(c(t.join("")),q=999):(t.push(p),r=p,k+=1);break;case 5:k=m();break;case 9999:if(/[^\d\w_]/.test(p)){var g=t.join("");q=-1<n.indexOf(g)?8:-1<a.indexOf(g)?7:6;c(t.join(""));q=999}else t.push(p),r=p,k+=1;break;case 9:/[^\s]/g.test(p)?(c(t.join("")),q=999):(t.push(p),r=p,k+=1);break;case 999:k=d()}if(b!==
k)switch(H[b]){case "\n":z=0;++x;break;default:++z}}v+=k;H=H.slice(k);return u}t.length&&c(t.join(""));q=10;c("(eof)");return u}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(n,e,a,b){return function(){function a(b,c,h,g,l){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=b;this._layout=h;this._buffers=g;this._locations=c;l&&(this._indexBuffer=l);this._id=a._nextId++}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(b,c){return b+a._buffers[c].size},this._indexBuffer?this._indexBuffer.size:
0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});a.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);
if(a){for(var c in this._buffers)this._buffers[c].dispose(),delete this._buffers[c];this._indexBuffer&&(this._indexBuffer.dispose(),this._indexBuffer=null)}this._context=null}};a.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var b=a.createVertexArray();a.bindVertexArray(b);this._bindLayout();a.bindVertexArray(null);this._glName=b}this._initialized=!0}};a.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):
(this._context.bindVAO(null),this._bindLayout())};a.prototype._bindLayout=function(){var a=this._buffers,c=!!this._context.capabilities.vao,h=this._layout,g=this._indexBuffer;a||console.error("Vertex buffer dictionary is empty!");var l=this._context.gl,m;for(m in a){var k=a[m];k||console.error("Vertex buffer is uninitialized!");var e=h[m];e||console.error("Vertex element descriptor is empty!");b.bindVertexBufferLayout(this._context,this._locations,k,e)}g&&(c?l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,g.glName):
this._context.bindBuffer(g))};a.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):this._unbindLayout()};a.prototype._unbindLayout=function(){var a=this._buffers,c=this._layout;a||console.error("Vertex buffer dictionary is empty!");for(var h in a){var g=a[h];g||console.error("Vertex buffer is uninitialized!");b.unbindVertexBufferLayout(this._context,this._locations,g,c[h])}(a=this._indexBuffer)&&this._context.unbindBuffer(a.bufferType)};a._nextId=
0;return a}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error"],function(n,e,a,b){function c(a){return a[0].stride}function d(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}Object.defineProperty(e,"__esModule",{value:!0});e.vertexCount=function(a,b){return a.vertexBuffers[b].size/c(a.layout[b])};
e.getStride=c;e.getBytesPerElement=d;e.addDescriptor=function(a,b,c,l,m,k){var f=d(l);if(0<a.length){var g=a[0].stride,h=g+f*c;a.forEach(function(a){return a.stride=h});a.push({name:b,count:c,type:l,offset:g,stride:h,normalized:m,divisor:k})}else a.push({name:b,count:c,type:l,offset:0,stride:f*c,normalized:m,divisor:k})};e.assertCompatibleVertexAttributeLocations=function(a,b){(a=a.locations===b.locations)||console.error("VertexAttributeLocations are incompatible");return a};e.hasAttribute=function(a,
b){for(var c=0;c<a.length;c++)if(a[c].name===b)return!0;return!1};e.findAttribute=function(a,b){for(var c=0;c<a.length;c++)if(a[c].name===b)return a[c];return null};e.copyFramebufferToTexture=function(a,b,c,d,m){void 0===m&&(m=0);var f=a.getBoundFramebufferObject(),g=a.getBoundTexture(0);a.bindFramebuffer(b);a.bindTexture(c,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,m,c.descriptor.pixelFormat,d[0],d[1],d[2],d[3],0);a.gl.flush();a.bindFramebuffer(f);a.bindTexture(g,0)};e.assert=function(a,c){if(!a)throw new b(c);
};e.setBaseInstanceOffset=function(b,c){var f={},d;for(d in b)f[d]=b[d].map(function(b){return b.divisor?a({},b,{baseInstance:c}):b});return f};e.bindVertexBufferLayout=function(a,b,c,d,m){var f=a.gl,g=a.capabilities.instancing;a.bindBuffer(c);d.forEach(function(a){var c=b[a.name],d=(m?m:0+a.baseInstance?a.baseInstance:0)*a.stride;void 0===c&&console.error("There is no location for vertex attribute '"+a.name+"' defined.");a.baseInstance&&!a.divisor&&console.error("Vertex attribute '"+a.name+"' uses baseInstanceOffset without divisor.");
if(4>=a.count)f.vertexAttribPointer(c,a.count,a.type,a.normalized,a.stride,a.offset+d),f.enableVertexAttribArray(c),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c,a.divisor);else if(9===a.count)for(var h=0;3>h;h++)f.vertexAttribPointer(c+h,3,a.type,a.normalized,a.stride,a.offset+12*h+d),f.enableVertexAttribArray(c+h),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+h,a.divisor);else if(16===a.count)for(h=0;4>h;h++)f.vertexAttribPointer(c+h,4,a.type,a.normalized,a.stride,a.offset+16*h+d),f.enableVertexAttribArray(c+
h),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+h,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)})};e.unbindVertexBufferLayout=function(a,b,c,d){var f=a.gl,g=a.capabilities.instancing;a.bindBuffer(c);d.forEach(function(a){var c=b[a.name];if(4>=a.count)f.disableVertexAttribArray(c),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c,0);else if(9===a.count)for(var d=0;3>d;d++)f.disableVertexAttribArray(c+d),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+
d,0);else if(16===a.count)for(d=0;4>d;d++)f.disableVertexAttribArray(c+d),a.divisor&&0<a.divisor&&g&&g.vertexAttribDivisor(c+d,0);else console.error("Unsupported vertex attribute element count: "+a.count)});a.unbindBuffer(34962)}})},"esri/views/2d/engine/webgl/enums":function(){define(["require","exports"],function(n,e){Object.defineProperty(e,"__esModule",{value:!0});(function(a){a[a.FILL=0]="FILL";a[a.LINE=1]="LINE";a[a.MARKER=2]="MARKER";a[a.TEXT=3]="TEXT";a[a.LABEL=4]="LABEL";a[a.NONE=5]="NONE";
a[a.UNKNOWN=6]="UNKNOWN";a[a.COUNT=7]="COUNT"})(e.WGLGeometryType||(e.WGLGeometryType={}));(function(a){a[a.SUCCEEDED=0]="SUCCEEDED";a[a.FAILED_OUT_OF_MEMORY=1]="FAILED_OUT_OF_MEMORY"})(e.WGLGeometryTransactionStatus||(e.WGLGeometryTransactionStatus={}));(function(a){a[a.NONE=0]="NONE";a[a.FILL=1]="FILL";a[a.LINE=2]="LINE";a[a.MARKER=4]="MARKER";a[a.TEXT=8]="TEXT";a[a.LABEL=16]="LABEL";a[a.LABEL_ALPHA=32]="LABEL_ALPHA";a[a.HITTEST=64]="HITTEST";a[a.HIGHLIGHT=128]="HIGHLIGHT";a[a.CLIP=256]="CLIP";
a[a.DEBUG=512]="DEBUG";a[a.NUM_DRAW_PHASES=12]="NUM_DRAW_PHASES"})(e.WGLDrawPhase||(e.WGLDrawPhase={}));(function(a){a[a.SIZE=0]="SIZE";a[a.COLOR=1]="COLOR";a[a.OPACITY=2]="OPACITY";a[a.ROTATION=3]="ROTATION"})(e.VVType||(e.VVType={}));(function(a){a[a.NONE=0]="NONE";a[a.OPACITY=1]="OPACITY";a[a.COLOR=2]="COLOR";a[a.ROTATION=4]="ROTATION";a[a.SIZE_MINMAX_VALUE=8]="SIZE_MINMAX_VALUE";a[a.SIZE_SCALE_STOPS=16]="SIZE_SCALE_STOPS";a[a.SIZE_FIELD_STOPS=32]="SIZE_FIELD_STOPS";a[a.SIZE_UNIT_VALUE=64]="SIZE_UNIT_VALUE"})(e.WGLVVFlag||
(e.WGLVVFlag={}));(function(a){a[a.MINMAX_TARGETS_OUTLINE=128]="MINMAX_TARGETS_OUTLINE";a[a.SCALE_TARGETS_OUTLINE=256]="SCALE_TARGETS_OUTLINE";a[a.FIELD_TARGETS_OUTLINE=512]="FIELD_TARGETS_OUTLINE";a[a.UNIT_TARGETS_OUTLINE=1024]="UNIT_TARGETS_OUTLINE"})(e.WGLVVTarget||(e.WGLVVTarget={}));(function(a){a[a.UNKNOWN=0]="UNKNOWN";a[a.BUTT=1]="BUTT";a[a.ROUND=2]="ROUND";a[a.SQUARE=3]="SQUARE"})(e.CapType||(e.CapType={}));(function(a){a[a.UNKNOWN=0]="UNKNOWN";a[a.MITER=1]="MITER";a[a.BEVEL=2]="BEVEL";a[a.ROUND=
3]="ROUND"})(e.JoinType||(e.JoinType={}));(function(a){a.SIMPLE_MARKER="esriSMS";a.SIMPLE_LINE="esriSLS";a.SIMPLE_FILL="esriSFS";a.PICTURE_MARKER="esriPMS";a.PICTURE_FILL="esriPFS";a.TEXT="esriTS"})(e.EsriSymbolType||(e.EsriSymbolType={}));(function(a){a.SIMPLE_MARKER="simple-marker";a.SIMPLE_LINE="simple-line";a.SIMPLE_FILL="simple-fill";a.PICTURE_MARKER="picture-marker";a.PICTURE_FILL="picture-fill";a.TEXT="text"})(e.EsriSymbolTypeKebab||(e.EsriSymbolTypeKebab={}))})},"esri/views/2d/engine/webgl/Fader":function(){define(["require",
"exports"],function(n,e){Object.defineProperty(e,"__esModule",{value:!0});n=function(){function a(a,c){void 0===c&&(c=250);this.duration=c;this._startTime=this._lastTime=0;this._parent=a}a.prototype.reset=function(){0===this._lastTime;this._startTime=performance.now()};a.prototype.step=function(){var a=performance.now();if(0===this._lastTime)return this._lastTime=a,this._parent.requestRender(),0;var c=a-this._lastTime;this._lastTime=a;a-this._startTime<2*this.duration&&this._parent.requestRender();
return c/this.duration};return a}();e.default=n})},"esri/views/2d/engine/webgl/WGLPainter":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/libs/gl-matrix/mat4 ./enums ./GeometryUtils ./MaterialManager ./Utils ./brushes/WGLBrushInfo ./brushes/WGLBrushStencil ./brushes/WGLGeometryBrushFill ./brushes/WGLGeometryBrushLabel ./brushes/WGLGeometryBrushLine ./brushes/WGLGeometryBrushMarker ./brushes/WGLGeometryBrushText ./painter/WGLHighlightPainter ../../../webgl/FramebufferObject".split(" "),
function(n,e,a,b,c,d,f,h,g,l,m,k,v,q,p,r,t,u){Object.defineProperty(e,"__esModule",{value:!0});n=function(){function a(){this._initialized=!1}a.prototype.registerPass=function(a,b){this._initialize();for(var c=0;c<b.length;c++)this._passMap.set(b[c],a);return this};a.prototype.getPaintPassTs=function(a){this._initialize();return this._passMap.has(a)?[this._passMap.get(a)]:[]};a.prototype._initialize=function(){this._initialized||(this._passMap=new Map,this._initialized=!0)};return a}();e.WGLPainterOptions=
n;var x=new Uint8Array(4*g.C_HITTEST_SEARCH_SIZE*g.C_HITTEST_SEARCH_SIZE),z=new Uint32Array(x.buffer);n=function(){function e(){this._hlPainter=new t;this._extrudeMatrix=new Float32Array(16);this._extrudeNoRotationMatrix=new Float32Array(16);this._extrudeRotateVector=new Float32Array([0,0,1]);this._extrudeScaleVector=new Float32Array([1,1,1]);this._state={rotation:0,width:0,height:0};this._cachedRotation=this._cachedHeight=this._cachedWidth=0;this.materialManager=new h}e.allGeometryPhases=function(){return[d.WGLDrawPhase.FILL,
d.WGLDrawPhase.LINE,d.WGLDrawPhase.MARKER,d.WGLDrawPhase.TEXT]};e.toWGLDrawPhases=function(a){for(var b=[],c,f=0;f<d.WGLDrawPhase.NUM_DRAW_PHASES;f++)c=1<<f,c&a&&b.push(c);return b};Object.defineProperty(e.prototype,"extrudeMatrix",{get:function(){return this._extrudeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"extrudeNoRotationMatrix",{get:function(){return this._extrudeNoRotationMatrix},enumerable:!0,configurable:!0});e.prototype.dispose=function(){this.materialManager.dispose();
this.textureManager=null;this._hlPainter&&(this._hlPainter.dispose(),this._hlPainter=null);this._hittestFBO&&(this._hittestFBO.dispose(),this._hittestFBO=null);this._passes&&(this._passes.forEach(function(a){return a.dispose()}),this._passes.clear());this._brushes&&(this._brushes.forEach(function(a){return a.forEach(function(a){return a.dispose()})}),this._brushes.clear())};e.prototype.initialize=function(a){this.materialManager.initialize(a)};e.prototype.update=function(a,b){this._state=a;if(this._state.width!==
this._cachedWidth||this._state.height!==this._cachedHeight||this._state.rotation!==this._cachedRotation)this._extrudeScaleVector[0]=2/a.width,this._extrudeScaleVector[1]=-2/a.height,c.identity(this._extrudeMatrix),c.rotate(this._extrudeMatrix,this._extrudeMatrix,-a.rotation*f.C_DEG_TO_RAD,this._extrudeRotateVector),c.scale(this._extrudeMatrix,this._extrudeMatrix,this._extrudeScaleVector),c.transpose(this._extrudeMatrix,this._extrudeMatrix),c.identity(this._extrudeNoRotationMatrix),c.scale(this._extrudeNoRotationMatrix,
this._extrudeNoRotationMatrix,this._extrudeScaleVector),c.transpose(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix),this._cachedWidth=this._state.width,this._cachedHeight=this._state.height,this._cachedRotation=this._state.rotation};e.prototype.getBrushes=function(a){if(!this._brushes){var b=new k.default,c=new p.default,f=new q.default,g=new r.default,h=new v.default,e=new l.default,t=new m.default;this._brushes=new Map;this._brushes.set(d.WGLDrawPhase.FILL,[b]);this._brushes.set(d.WGLDrawPhase.MARKER,
[c]);this._brushes.set(d.WGLDrawPhase.LINE,[f]);this._brushes.set(d.WGLDrawPhase.TEXT,[g]);this._brushes.set(d.WGLDrawPhase.LABEL,[h]);this._brushes.set(d.WGLDrawPhase.LABEL_ALPHA,[h]);this._brushes.set(d.WGLDrawPhase.HITTEST,[b,c,f,g]);this._brushes.set(d.WGLDrawPhase.HIGHLIGHT,[b,c,f,g]);this._brushes.set(d.WGLDrawPhase.CLIP,[t]);this._brushes.set(d.WGLDrawPhase.DEBUG,[e])}if(!this._brushes.has(a))throw Error("WGLPainter: Tried to get brush for unknown phase: "+a);return this._brushes.get(a)};e.prototype.bindTextureManager=
function(a){this.textureManager=a};e.prototype.draw=function(a,b,c,f){c[0]===d.WGLDrawPhase.LABEL_ALPHA&&c[0]===d.WGLDrawPhase.LABEL||this._drawClippingRects(a,b);var g=a.context;g.setBlendingEnabled(!0);g.setStencilWriteMask(0);g.setBlendFunctionSeparate(1,771,1,771);this._drawPhases(a,b,c,f);this._debugTiles(a,b)};e.prototype.setHighlightOptions=function(a){this._hlPainter.setHighlightOptions(a)};e.prototype.highlight=function(a,b){var c=a.context,f=c.getViewport();this._hlPainter.setup(c,f.width,
f.height);this._hlPainter.startMaskDraw(c);this._drawClippingRects(a,b);c.setBlendingEnabled(!0);c.setStencilWriteMask(0);c.setBlendFunctionSeparate(1,771,1,771);this._drawPhases(a,b,[d.WGLDrawPhase.HIGHLIGHT]);this._hlPainter.draw(c)};e.prototype.hitTest=function(a,b){var c=g.C_HITTEST_SEARCH_SIZE,f=[0,0],h=[0,0],l=a.state;l.toMap(f,[0,0]);l.toMap(h,[c,c]);if(0===b.filter(function(a){return!(f[0]>a.bounds[2]||h[0]<a.bounds[0]||f[1]<a.bounds[1]||h[1]>a.bounds[3])}).length)return[];l=a.context;this._hittestFBO||
(this._hittestFBO=u.create(l,{colorTarget:0,depthStencilTarget:3,width:c,height:c}));var k=l.getViewport(),m=l.getBoundFramebufferObject();l.bindFramebuffer(this._hittestFBO);l.setViewport(0,0,c,c);this._drawClippingRects(a,b);var e=l.gl;l.setClearColor(1,1,1,1);l.clear(e.COLOR_BUFFER_BIT);l.setBlendingEnabled(!1);l.setStencilWriteMask(0);this._drawPhases(a,b,[d.WGLDrawPhase.HITTEST]);l.setBlendingEnabled(!0);this._hittestFBO.readPixels(0,0,c,c,6408,5121,x);a=c*c;b=new Set;for(c=0;c<a;c++)e=z[c],
4294967295!==e&&b.add(e);l.bindFramebuffer(m);l.setViewport(k.x,k.y,k.width,k.height);var p=[];b.forEach(function(a){p.push(a)});return p};e.prototype._getPaintPass=function(a){this._passes||(this._passes=new Map);if(!this._passes.has(a))try{this._passes.set(a,new a)}catch(A){throw Error("Tried to instantiate WGLPaintPass with unknown constructor: "+a+",\n"+A);}return this._passes.get(a)};e.prototype._getPaintPasses=function(a,b){var c=this;return b.getPaintPassTs(a).map(function(a){return c._getPaintPass(a)})};
e.prototype._drawPhases=function(b,c,f,g){b.context.setStencilTestEnabled(!0);for(var d=0;d<f.length;d++){var h=f[d],l=g?this._getPaintPasses(h,g):[],h=a({},b,{drawPhase:h});l.forEach(function(a){return a.preRender(b,b.rendererInfo)});for(var k=0,m=c;k<m.length;k++)m[k].doRender(h);l.reverse().forEach(function(a){return a.postRender(b,b.rendererInfo)})}b.context.setStencilTestEnabled(!1)};e.prototype._debugTiles=function(a,c){b("esri-feature-tiles-debug")&&this._drawPhases(a,c,[d.WGLDrawPhase.DEBUG])};
e.prototype._drawClippingRects=function(a,b){if(0!==b.length){var c=a.context;c.setDepthWriteEnabled(!1);c.setDepthTestEnabled(!1);c.setStencilTestEnabled(!0);c.setBlendingEnabled(!1);c.setColorMask(!1,!1,!1,!1);c.setStencilOp(7680,7680,7681);c.setClearStencil(0);c.clear(c.gl.STENCIL_BUFFER_BIT);c.setStencilWriteMask(255);for(var c=0,f=b.length;c<b.length;c++,f--){var g=b[c];g.attached&&(g.stencilRef=f)}this._drawPhases(a,b,[d.WGLDrawPhase.CLIP]);a.context.setColorMask(!0,!0,!0,!0)}};return e}();
e.default=n})},"esri/core/libs/gl-matrix/mat4":function(){define(["./common"],function(n){var e={scalar:{},SIMD:{},create:function(){var a=new n.ARRAY_TYPE(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a},clone:function(a){var b=new n.ARRAY_TYPE(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];
return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a},fromValues:function(a,b,c,d,f,h,g,l,m,k,e,q,p,r,t,u){var v=new n.ARRAY_TYPE(16);v[0]=a;v[1]=b;v[2]=c;v[3]=d;v[4]=f;v[5]=h;v[6]=g;v[7]=l;v[8]=m;v[9]=k;v[10]=e;v[11]=q;v[12]=p;v[13]=r;v[14]=t;v[15]=u;return v},set:function(a,b,c,d,f,h,g,l,m,k,e,q,p,r,t,u,x){a[0]=b;a[1]=c;a[2]=d;a[3]=f;a[4]=h;
a[5]=g;a[6]=l;a[7]=m;a[8]=k;a[9]=e;a[10]=q;a[11]=p;a[12]=r;a[13]=t;a[14]=u;a[15]=x;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}};e.scalar.transpose=function(a,b){if(a===b){var c=b[1],d=b[2],f=b[3],h=b[6],g=b[7],l=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=d;a[9]=h;a[11]=b[14];a[12]=f;a[13]=g;a[14]=l}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=
b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};e.SIMD.transpose=function(a,b){var c,d,f,h,g,l;c=SIMD.Float32x4.load(b,0);d=SIMD.Float32x4.load(b,4);f=SIMD.Float32x4.load(b,8);b=SIMD.Float32x4.load(b,12);h=SIMD.Float32x4.shuffle(c,d,0,1,4,5);g=SIMD.Float32x4.shuffle(f,b,0,1,4,5);l=SIMD.Float32x4.shuffle(h,g,0,2,4,6);h=SIMD.Float32x4.shuffle(h,g,1,3,5,7);SIMD.Float32x4.store(a,0,l);SIMD.Float32x4.store(a,4,h);h=SIMD.Float32x4.shuffle(c,
d,2,3,6,7);g=SIMD.Float32x4.shuffle(f,b,2,3,6,7);c=SIMD.Float32x4.shuffle(h,g,0,2,4,6);d=SIMD.Float32x4.shuffle(h,g,1,3,5,7);SIMD.Float32x4.store(a,8,c);SIMD.Float32x4.store(a,12,d);return a};e.transpose=n.USE_SIMD?e.SIMD.transpose:e.scalar.transpose;e.scalar.invert=function(a,b){var c=b[0],d=b[1],f=b[2],h=b[3],g=b[4],l=b[5],m=b[6],k=b[7],e=b[8],q=b[9],p=b[10],r=b[11],t=b[12],u=b[13],x=b[14];b=b[15];var z=c*l-d*g,w=c*m-f*g,y=c*k-h*g,A=d*m-f*l,n=d*k-h*l,D=f*k-h*m,E=e*u-q*t,J=e*x-p*t,F=e*b-r*t,C=q*
x-p*u,G=q*b-r*u,I=p*b-r*x,B=z*I-w*G+y*C+A*F-n*J+D*E;if(!B)return null;B=1/B;a[0]=(l*I-m*G+k*C)*B;a[1]=(f*G-d*I-h*C)*B;a[2]=(u*D-x*n+b*A)*B;a[3]=(p*n-q*D-r*A)*B;a[4]=(m*F-g*I-k*J)*B;a[5]=(c*I-f*F+h*J)*B;a[6]=(x*y-t*D-b*w)*B;a[7]=(e*D-p*y+r*w)*B;a[8]=(g*G-l*F+k*E)*B;a[9]=(d*F-c*G-h*E)*B;a[10]=(t*n-u*y+b*z)*B;a[11]=(q*y-e*n-r*z)*B;a[12]=(l*J-g*C-m*E)*B;a[13]=(c*C-d*J+f*E)*B;a[14]=(u*w-t*A-x*z)*B;a[15]=(e*A-q*w+p*z)*B;return a};e.SIMD.invert=function(a,b){var c,d,f,h,g,l,m,k;g=SIMD.Float32x4.load(b,0);
l=SIMD.Float32x4.load(b,4);m=SIMD.Float32x4.load(b,8);k=SIMD.Float32x4.load(b,12);b=SIMD.Float32x4.shuffle(g,l,0,1,4,5);d=SIMD.Float32x4.shuffle(m,k,0,1,4,5);c=SIMD.Float32x4.shuffle(b,d,0,2,4,6);d=SIMD.Float32x4.shuffle(d,b,1,3,5,7);b=SIMD.Float32x4.shuffle(g,l,2,3,6,7);h=SIMD.Float32x4.shuffle(m,k,2,3,6,7);f=SIMD.Float32x4.shuffle(b,h,0,2,4,6);h=SIMD.Float32x4.shuffle(h,b,1,3,5,7);b=SIMD.Float32x4.mul(f,h);b=SIMD.Float32x4.swizzle(b,1,0,3,2);g=SIMD.Float32x4.mul(d,b);l=SIMD.Float32x4.mul(c,b);b=
SIMD.Float32x4.swizzle(b,2,3,0,1);g=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,b),g);l=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,b),l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);b=SIMD.Float32x4.mul(d,f);b=SIMD.Float32x4.swizzle(b,1,0,3,2);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,b),g);k=SIMD.Float32x4.mul(c,b);b=SIMD.Float32x4.swizzle(b,2,3,0,1);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(h,b));k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,b),k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);b=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(d,
2,3,0,1),h);b=SIMD.Float32x4.swizzle(b,1,0,3,2);f=SIMD.Float32x4.swizzle(f,2,3,0,1);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,b),g);m=SIMD.Float32x4.mul(c,b);b=SIMD.Float32x4.swizzle(b,2,3,0,1);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(f,b));m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,b),m);m=SIMD.Float32x4.swizzle(m,2,3,0,1);b=SIMD.Float32x4.mul(c,d);b=SIMD.Float32x4.swizzle(b,1,0,3,2);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,b),m);k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,b),k);b=SIMD.Float32x4.swizzle(b,
2,3,0,1);m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,b),m);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(f,b));b=SIMD.Float32x4.mul(c,h);b=SIMD.Float32x4.swizzle(b,1,0,3,2);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(f,b));m=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,b),m);b=SIMD.Float32x4.swizzle(b,2,3,0,1);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,b),l);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(d,b));b=SIMD.Float32x4.mul(c,f);b=SIMD.Float32x4.swizzle(b,1,0,3,2);l=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,b),
l);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(d,b));b=SIMD.Float32x4.swizzle(b,2,3,0,1);l=SIMD.Float32x4.sub(l,SIMD.Float32x4.mul(h,b));k=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,b),k);c=SIMD.Float32x4.mul(c,g);c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,2,3,0,1),c);c=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(c,1,0,3,2),c);b=SIMD.Float32x4.reciprocalApproximation(c);c=SIMD.Float32x4.sub(SIMD.Float32x4.add(b,b),SIMD.Float32x4.mul(c,SIMD.Float32x4.mul(b,b)));c=SIMD.Float32x4.swizzle(c,0,0,0,0);if(!c)return null;
SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(c,g));SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(c,l));SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(c,m));SIMD.Float32x4.store(a,12,SIMD.Float32x4.mul(c,k));return a};e.invert=n.USE_SIMD?e.SIMD.invert:e.scalar.invert;e.scalar.adjoint=function(a,b){var c=b[0],d=b[1],f=b[2],h=b[3],g=b[4],l=b[5],m=b[6],k=b[7],e=b[8],q=b[9],p=b[10],r=b[11],t=b[12],u=b[13],x=b[14];b=b[15];a[0]=l*(p*b-r*x)-q*(m*b-k*x)+u*(m*r-k*p);a[1]=-(d*(p*b-r*x)-q*(f*b-h*x)+u*(f*r-h*p));a[2]=
d*(m*b-k*x)-l*(f*b-h*x)+u*(f*k-h*m);a[3]=-(d*(m*r-k*p)-l*(f*r-h*p)+q*(f*k-h*m));a[4]=-(g*(p*b-r*x)-e*(m*b-k*x)+t*(m*r-k*p));a[5]=c*(p*b-r*x)-e*(f*b-h*x)+t*(f*r-h*p);a[6]=-(c*(m*b-k*x)-g*(f*b-h*x)+t*(f*k-h*m));a[7]=c*(m*r-k*p)-g*(f*r-h*p)+e*(f*k-h*m);a[8]=g*(q*b-r*u)-e*(l*b-k*u)+t*(l*r-k*q);a[9]=-(c*(q*b-r*u)-e*(d*b-h*u)+t*(d*r-h*q));a[10]=c*(l*b-k*u)-g*(d*b-h*u)+t*(d*k-h*l);a[11]=-(c*(l*r-k*q)-g*(d*r-h*q)+e*(d*k-h*l));a[12]=-(g*(q*x-p*u)-e*(l*x-m*u)+t*(l*p-m*q));a[13]=c*(q*x-p*u)-e*(d*x-f*u)+t*(d*
p-f*q);a[14]=-(c*(l*x-m*u)-g*(d*x-f*u)+t*(d*m-f*l));a[15]=c*(l*p-m*q)-g*(d*p-f*q)+e*(d*m-f*l);return a};e.SIMD.adjoint=function(a,b){var c,d,f,h,g,l,m,k;c=SIMD.Float32x4.load(b,0);d=SIMD.Float32x4.load(b,4);f=SIMD.Float32x4.load(b,8);h=SIMD.Float32x4.load(b,12);l=SIMD.Float32x4.shuffle(c,d,0,1,4,5);g=SIMD.Float32x4.shuffle(f,h,0,1,4,5);b=SIMD.Float32x4.shuffle(l,g,0,2,4,6);g=SIMD.Float32x4.shuffle(g,l,1,3,5,7);l=SIMD.Float32x4.shuffle(c,d,2,3,6,7);d=SIMD.Float32x4.shuffle(f,h,2,3,6,7);c=SIMD.Float32x4.shuffle(l,
d,0,2,4,6);d=SIMD.Float32x4.shuffle(d,l,1,3,5,7);l=SIMD.Float32x4.mul(c,d);l=SIMD.Float32x4.swizzle(l,1,0,3,2);f=SIMD.Float32x4.mul(g,l);h=SIMD.Float32x4.mul(b,l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);f=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,l),f);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,l),h);h=SIMD.Float32x4.swizzle(h,2,3,0,1);l=SIMD.Float32x4.mul(g,c);l=SIMD.Float32x4.swizzle(l,1,0,3,2);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,l),f);k=SIMD.Float32x4.mul(b,l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);
f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(d,l));k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,l),k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);l=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,2,3,0,1),d);l=SIMD.Float32x4.swizzle(l,1,0,3,2);c=SIMD.Float32x4.swizzle(c,2,3,0,1);f=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,l),f);m=SIMD.Float32x4.mul(b,l);l=SIMD.Float32x4.swizzle(l,2,3,0,1);f=SIMD.Float32x4.sub(f,SIMD.Float32x4.mul(c,l));m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,l),m);m=SIMD.Float32x4.swizzle(m,2,3,0,
1);l=SIMD.Float32x4.mul(b,g);l=SIMD.Float32x4.swizzle(l,1,0,3,2);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,l),m);k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(c,l),k);l=SIMD.Float32x4.swizzle(l,2,3,0,1);m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(d,l),m);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(c,l));l=SIMD.Float32x4.mul(b,d);l=SIMD.Float32x4.swizzle(l,1,0,3,2);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(c,l));m=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,l),m);l=SIMD.Float32x4.swizzle(l,2,3,0,1);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(c,
l),h);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(g,l));l=SIMD.Float32x4.mul(b,c);l=SIMD.Float32x4.swizzle(l,1,0,3,2);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(d,l),h);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(g,l));l=SIMD.Float32x4.swizzle(l,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(d,l));k=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,l),k);SIMD.Float32x4.store(a,0,f);SIMD.Float32x4.store(a,4,h);SIMD.Float32x4.store(a,8,m);SIMD.Float32x4.store(a,12,k);return a};e.adjoint=n.USE_SIMD?e.SIMD.adjoint:
e.scalar.adjoint;e.determinant=function(a){var b=a[0],c=a[1],d=a[2],f=a[3],h=a[4],g=a[5],l=a[6],m=a[7],k=a[8],e=a[9],q=a[10],p=a[11],r=a[12],t=a[13],u=a[14];a=a[15];return(b*g-c*h)*(q*a-p*u)-(b*l-d*h)*(e*a-p*t)+(b*m-f*h)*(e*u-q*t)+(c*l-d*g)*(k*a-p*r)-(c*m-f*g)*(k*u-q*r)+(d*m-f*l)*(k*t-e*r)};e.SIMD.multiply=function(a,b,c){var d=SIMD.Float32x4.load(b,0),f=SIMD.Float32x4.load(b,4),h=SIMD.Float32x4.load(b,8);b=SIMD.Float32x4.load(b,12);var g=SIMD.Float32x4.load(c,0),g=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,
0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,1,1,1,1),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,2,2,2,2),h),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,3,3,3,3),b))));SIMD.Float32x4.store(a,0,g);g=SIMD.Float32x4.load(c,4);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,1,1,1,1),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,2,2,2,2),h),
SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,3,3,3,3),b))));SIMD.Float32x4.store(a,4,g);g=SIMD.Float32x4.load(c,8);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,1,1,1,1),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,2,2,2,2),h),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(g,3,3,3,3),b))));SIMD.Float32x4.store(a,8,g);c=SIMD.Float32x4.load(c,12);d=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,
0,0,0,0),d),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,1,1,1,1),f),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,2,2,2,2),h),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(c,3,3,3,3),b))));SIMD.Float32x4.store(a,12,d);return a};e.scalar.multiply=function(a,b,c){var d=b[0],f=b[1],h=b[2],g=b[3],l=b[4],m=b[5],k=b[6],e=b[7],q=b[8],p=b[9],r=b[10],t=b[11],u=b[12],x=b[13],z=b[14];b=b[15];var w=c[0],y=c[1],A=c[2],n=c[3];a[0]=w*d+y*l+A*q+n*u;a[1]=w*f+y*m+A*p+n*x;a[2]=w*h+y*
k+A*r+n*z;a[3]=w*g+y*e+A*t+n*b;w=c[4];y=c[5];A=c[6];n=c[7];a[4]=w*d+y*l+A*q+n*u;a[5]=w*f+y*m+A*p+n*x;a[6]=w*h+y*k+A*r+n*z;a[7]=w*g+y*e+A*t+n*b;w=c[8];y=c[9];A=c[10];n=c[11];a[8]=w*d+y*l+A*q+n*u;a[9]=w*f+y*m+A*p+n*x;a[10]=w*h+y*k+A*r+n*z;a[11]=w*g+y*e+A*t+n*b;w=c[12];y=c[13];A=c[14];n=c[15];a[12]=w*d+y*l+A*q+n*u;a[13]=w*f+y*m+A*p+n*x;a[14]=w*h+y*k+A*r+n*z;a[15]=w*g+y*e+A*t+n*b;return a};e.multiply=n.USE_SIMD?e.SIMD.multiply:e.scalar.multiply;e.mul=e.multiply;e.scalar.translate=function(a,b,c){var d=
c[0],f=c[1];c=c[2];var h,g,l,m,k,e,q,p,r,t,u,x;b===a?(a[12]=b[0]*d+b[4]*f+b[8]*c+b[12],a[13]=b[1]*d+b[5]*f+b[9]*c+b[13],a[14]=b[2]*d+b[6]*f+b[10]*c+b[14],a[15]=b[3]*d+b[7]*f+b[11]*c+b[15]):(h=b[0],g=b[1],l=b[2],m=b[3],k=b[4],e=b[5],q=b[6],p=b[7],r=b[8],t=b[9],u=b[10],x=b[11],a[0]=h,a[1]=g,a[2]=l,a[3]=m,a[4]=k,a[5]=e,a[6]=q,a[7]=p,a[8]=r,a[9]=t,a[10]=u,a[11]=x,a[12]=h*d+k*f+r*c+b[12],a[13]=g*d+e*f+t*c+b[13],a[14]=l*d+q*f+u*c+b[14],a[15]=m*d+p*f+x*c+b[15]);return a};e.SIMD.translate=function(a,b,c){var d=
SIMD.Float32x4.load(b,0),f=SIMD.Float32x4.load(b,4),h=SIMD.Float32x4.load(b,8),g=SIMD.Float32x4.load(b,12);c=SIMD.Float32x4(c[0],c[1],c[2],0);b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11]);d=SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(c,0,0,0,0));f=SIMD.Float32x4.mul(f,SIMD.Float32x4.swizzle(c,1,1,1,1));h=SIMD.Float32x4.mul(h,SIMD.Float32x4.swizzle(c,2,2,2,2));b=SIMD.Float32x4.add(d,SIMD.Float32x4.add(f,SIMD.Float32x4.add(h,
g)));SIMD.Float32x4.store(a,12,b);return a};e.translate=n.USE_SIMD?e.SIMD.translate:e.scalar.translate;e.scalar.scale=function(a,b,c){var d=c[0],f=c[1];c=c[2];a[0]=b[0]*d;a[1]=b[1]*d;a[2]=b[2]*d;a[3]=b[3]*d;a[4]=b[4]*f;a[5]=b[5]*f;a[6]=b[6]*f;a[7]=b[7]*f;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};e.SIMD.scale=function(a,b,c){var d;c=SIMD.Float32x4(c[0],c[1],c[2],0);d=SIMD.Float32x4.load(b,0);SIMD.Float32x4.store(a,0,SIMD.Float32x4.mul(d,
SIMD.Float32x4.swizzle(c,0,0,0,0)));d=SIMD.Float32x4.load(b,4);SIMD.Float32x4.store(a,4,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(c,1,1,1,1)));d=SIMD.Float32x4.load(b,8);SIMD.Float32x4.store(a,8,SIMD.Float32x4.mul(d,SIMD.Float32x4.swizzle(c,2,2,2,2)));a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};e.scale=n.USE_SIMD?e.SIMD.scale:e.scalar.scale;e.rotate=function(a,b,c,d){var f=d[0],h=d[1];d=d[2];var g=Math.sqrt(f*f+h*h+d*d),l,m,k,e,q,p,r,t,u,x,z,w,y,A,H,D,E,J,F,C;if(Math.abs(g)<n.EPSILON)return null;
g=1/g;f*=g;h*=g;d*=g;l=Math.sin(c);m=Math.cos(c);k=1-m;c=b[0];g=b[1];e=b[2];q=b[3];p=b[4];r=b[5];t=b[6];u=b[7];x=b[8];z=b[9];w=b[10];y=b[11];A=f*f*k+m;H=h*f*k+d*l;D=d*f*k-h*l;E=f*h*k-d*l;J=h*h*k+m;F=d*h*k+f*l;C=f*d*k+h*l;f=h*d*k-f*l;h=d*d*k+m;a[0]=c*A+p*H+x*D;a[1]=g*A+r*H+z*D;a[2]=e*A+t*H+w*D;a[3]=q*A+u*H+y*D;a[4]=c*E+p*J+x*F;a[5]=g*E+r*J+z*F;a[6]=e*E+t*J+w*F;a[7]=q*E+u*J+y*F;a[8]=c*C+p*f+x*h;a[9]=g*C+r*f+z*h;a[10]=e*C+t*f+w*h;a[11]=q*C+u*f+y*h;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);
return a};e.scalar.rotateX=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var f=b[4],h=b[5],g=b[6],l=b[7],m=b[8],k=b[9],e=b[10],q=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=f*c+m*d;a[5]=h*c+k*d;a[6]=g*c+e*d;a[7]=l*c+q*d;a[8]=m*c-f*d;a[9]=k*c-h*d;a[10]=e*c-g*d;a[11]=q*c-l*d;return a};e.SIMD.rotateX=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],
a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,4);b=SIMD.Float32x4.load(b,8);SIMD.Float32x4.store(a,4,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,c),SIMD.Float32x4.mul(b,d)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,c),SIMD.Float32x4.mul(f,d)));return a};e.rotateX=n.USE_SIMD?e.SIMD.rotateX:e.scalar.rotateX;e.scalar.rotateY=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var f=b[0],h=b[1],g=b[2],l=b[3],m=b[8],k=b[9],e=b[10],q=b[11];b!==a&&(a[4]=b[4],
a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=f*c-m*d;a[1]=h*c-k*d;a[2]=g*c-e*d;a[3]=l*c-q*d;a[8]=f*d+m*c;a[9]=h*d+k*c;a[10]=g*d+e*c;a[11]=l*d+q*c;return a};e.SIMD.rotateY=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0);b=SIMD.Float32x4.load(b,8);SIMD.Float32x4.store(a,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,
c),SIMD.Float32x4.mul(b,d)));SIMD.Float32x4.store(a,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,d),SIMD.Float32x4.mul(b,c)));return a};e.rotateY=n.USE_SIMD?e.SIMD.rotateY:e.scalar.rotateY;e.scalar.rotateZ=function(a,b,c){var d=Math.sin(c);c=Math.cos(c);var f=b[0],h=b[1],g=b[2],l=b[3],m=b[4],k=b[5],e=b[6],q=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=f*c+m*d;a[1]=h*c+k*d;a[2]=g*c+e*d;a[3]=l*c+q*d;a[4]=m*c-f*d;a[5]=k*c-h*d;a[6]=e*c-g*
d;a[7]=q*c-l*d;return a};e.SIMD.rotateZ=function(a,b,c){var d=SIMD.Float32x4.splat(Math.sin(c));c=SIMD.Float32x4.splat(Math.cos(c));b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);var f=SIMD.Float32x4.load(b,0);b=SIMD.Float32x4.load(b,4);SIMD.Float32x4.store(a,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(f,c),SIMD.Float32x4.mul(b,d)));SIMD.Float32x4.store(a,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,c),SIMD.Float32x4.mul(f,d)));return a};e.rotateZ=n.USE_SIMD?
e.SIMD.rotateZ:e.scalar.rotateZ;e.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};e.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromRotation=function(a,b,c){var d=c[0],f=c[1];c=c[2];var h=Math.sqrt(d*d+f*f+c*c),g;if(Math.abs(h)<n.EPSILON)return null;h=1/h;d*=h;
f*=h;c*=h;h=Math.sin(b);b=Math.cos(b);g=1-b;a[0]=d*d*g+b;a[1]=f*d*g+c*h;a[2]=c*d*g-f*h;a[3]=0;a[4]=d*f*g-c*h;a[5]=f*f*g+b;a[6]=c*f*g+d*h;a[7]=0;a[8]=d*c*g+f*h;a[9]=f*c*g-d*h;a[10]=c*c*g+b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromXRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=
0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.fromRotationTranslation=function(a,b,c){var d=b[0],f=b[1],h=b[2],g=b[3],l=d+d,m=f+f,k=h+h;b=d*l;var e=d*m,d=d*k,q=f*m,f=f*k,h=h*k,l=g*l,m=g*m,g=g*k;a[0]=1-(q+h);a[1]=e+g;a[2]=d-m;a[3]=0;a[4]=
e-g;a[5]=1-(b+h);a[6]=f+l;a[7]=0;a[8]=d+m;a[9]=f-l;a[10]=1-(b+q);a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};e.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};e.getRotation=function(a,b){var c=b[0]+b[5]+b[10],d=0;0<c?(d=2*Math.sqrt(c+1),a[3]=.25*d,a[0]=(b[6]-b[9])/d,a[1]=(b[8]-b[2])/d,a[2]=(b[1]-b[4])/d):b[0]>b[5]&b[0]>b[10]?(d=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-b[9])/d,a[0]=.25*d,a[1]=(b[1]+b[4])/d,a[2]=(b[8]+b[2])/d):b[5]>b[10]?(d=2*Math.sqrt(1+b[5]-
b[0]-b[10]),a[3]=(b[8]-b[2])/d,a[0]=(b[1]+b[4])/d,a[1]=.25*d,a[2]=(b[6]+b[9])/d):(d=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/d,a[0]=(b[8]+b[2])/d,a[1]=(b[6]+b[9])/d,a[2]=.25*d);return a};e.fromRotationTranslationScale=function(a,b,c,d){var f=b[0],h=b[1],g=b[2],l=b[3],m=f+f,k=h+h,e=g+g;b=f*m;var q=f*k,f=f*e,p=h*k,h=h*e,g=g*e,m=l*m,k=l*k,l=l*e,e=d[0],r=d[1];d=d[2];a[0]=(1-(p+g))*e;a[1]=(q+l)*e;a[2]=(f-k)*e;a[3]=0;a[4]=(q-l)*r;a[5]=(1-(b+g))*r;a[6]=(h+m)*r;a[7]=0;a[8]=(f+k)*d;a[9]=(h-m)*d;a[10]=
(1-(b+p))*d;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};e.fromRotationTranslationScaleOrigin=function(a,b,c,d,f){var h=b[0],g=b[1],l=b[2],m=b[3],k=h+h,e=g+g,q=l+l;b=h*k;var p=h*e,h=h*q,r=g*e,g=g*q,l=l*q,k=m*k,e=m*e,m=m*q,q=d[0],t=d[1];d=d[2];var u=f[0],x=f[1];f=f[2];a[0]=(1-(r+l))*q;a[1]=(p+m)*q;a[2]=(h-e)*q;a[3]=0;a[4]=(p-m)*t;a[5]=(1-(b+l))*t;a[6]=(g+k)*t;a[7]=0;a[8]=(h+e)*d;a[9]=(g-k)*d;a[10]=(1-(b+r))*d;a[11]=0;a[12]=c[0]+u-(a[0]*u+a[4]*x+a[8]*f);a[13]=c[1]+x-(a[1]*u+a[5]*x+a[9]*
f);a[14]=c[2]+f-(a[2]*u+a[6]*x+a[10]*f);a[15]=1;return a};e.fromQuat=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var h=c+c,g=d+d,l=f+f,c=c*h,m=d*h,d=d*g,k=f*h,e=f*g,f=f*l,h=b*h,g=b*g;b*=l;a[0]=1-d-f;a[1]=m+b;a[2]=k-g;a[3]=0;a[4]=m-b;a[5]=1-c-f;a[6]=e+h;a[7]=0;a[8]=k+g;a[9]=e-h;a[10]=1-c-d;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};e.frustum=function(a,b,c,d,f,h,g){var l=1/(c-b),m=1/(f-d),k=1/(h-g);a[0]=2*h*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*h*m;a[6]=0;a[7]=0;a[8]=(c+b)*l;a[9]=(f+d)*m;a[10]=
(g+h)*k;a[11]=-1;a[12]=0;a[13]=0;a[14]=g*h*2*k;a[15]=0;return a};e.perspective=function(a,b,c,d,f){b=1/Math.tan(b/2);var h=1/(d-f);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(f+d)*h;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*f*d*h;a[15]=0;return a};e.perspectiveFromFieldOfView=function(a,b,c,d){var f=Math.tan(b.upDegrees*Math.PI/180),h=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var l=2/(g+b),m=2/(f+h);a[0]=
l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=m;a[6]=0;a[7]=0;a[8]=-((g-b)*l*.5);a[9]=(f-h)*m*.5;a[10]=d/(c-d);a[11]=-1;a[12]=0;a[13]=0;a[14]=d*c/(c-d);a[15]=0;return a};e.ortho=function(a,b,c,d,f,h,g){var l=1/(b-c),m=1/(d-f),k=1/(h-g);a[0]=-2*l;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*m;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*k;a[11]=0;a[12]=(b+c)*l;a[13]=(f+d)*m;a[14]=(g+h)*k;a[15]=1;return a};e.lookAt=function(a,b,c,d){var f,h,g,l,m,k,v,q,p=b[0],r=b[1];b=b[2];g=d[0];l=d[1];h=d[2];v=c[0];d=c[1];f=c[2];if(Math.abs(p-
v)<n.EPSILON&&Math.abs(r-d)<n.EPSILON&&Math.abs(b-f)<n.EPSILON)return e.identity(a);c=p-v;d=r-d;v=b-f;q=1/Math.sqrt(c*c+d*d+v*v);c*=q;d*=q;v*=q;f=l*v-h*d;h=h*c-g*v;g=g*d-l*c;(q=Math.sqrt(f*f+h*h+g*g))?(q=1/q,f*=q,h*=q,g*=q):g=h=f=0;l=d*g-v*h;m=v*f-c*g;k=c*h-d*f;(q=Math.sqrt(l*l+m*m+k*k))?(q=1/q,l*=q,m*=q,k*=q):k=m=l=0;a[0]=f;a[1]=l;a[2]=c;a[3]=0;a[4]=h;a[5]=m;a[6]=d;a[7]=0;a[8]=g;a[9]=k;a[10]=v;a[11]=0;a[12]=-(f*p+h*r+g*b);a[13]=-(l*p+m*r+k*b);a[14]=-(c*p+d*r+v*b);a[15]=1;return a};e.str=function(a){return"mat4("+
a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};e.add=function(a,b,
c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};e.subtract=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];
a[13]=b[13]-c[13];a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a};e.sub=e.subtract;e.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*c;a[15]=b[15]*c;return a};e.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=b[4]+c[4]*d;a[5]=b[5]+c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*
d;a[8]=b[8]+c[8]*d;a[9]=b[9]+c[9]*d;a[10]=b[10]+c[10]*d;a[11]=b[11]+c[11]*d;a[12]=b[12]+c[12]*d;a[13]=b[13]+c[13]*d;a[14]=b[14]+c[14]*d;a[15]=b[15]+c[15]*d;return a};e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};e.equals=function(a,b){var c=a[0],d=a[1],f=a[2],h=a[3],g=a[4],l=a[5],m=a[6],k=a[7],
e=a[8],q=a[9],p=a[10],r=a[11],t=a[12],u=a[13],x=a[14];a=a[15];var z=b[0],w=b[1],y=b[2],A=b[3],H=b[4],D=b[5],E=b[6],J=b[7],F=b[8],C=b[9],G=b[10],I=b[11],B=b[12],M=b[13],L=b[14];b=b[15];return Math.abs(c-z)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(z))&&Math.abs(d-w)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(w))&&Math.abs(f-y)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(y))&&Math.abs(h-A)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(A))&&Math.abs(g-H)<=n.EPSILON*Math.max(1,Math.abs(g),Math.abs(H))&&
Math.abs(l-D)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(m-E)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(E))&&Math.abs(k-J)<=n.EPSILON*Math.max(1,Math.abs(k),Math.abs(J))&&Math.abs(e-F)<=n.EPSILON*Math.max(1,Math.abs(e),Math.abs(F))&&Math.abs(q-C)<=n.EPSILON*Math.max(1,Math.abs(q),Math.abs(C))&&Math.abs(p-G)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(G))&&Math.abs(r-I)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(I))&&Math.abs(t-B)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(B))&&Math.abs(u-
M)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(x-L)<=n.EPSILON*Math.max(1,Math.abs(x),Math.abs(L))&&Math.abs(a-b)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};return e})},"esri/views/2d/engine/webgl/GeometryUtils":function(){define(["require","exports"],function(n,e){function a(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(e,"__esModule",{value:!0});e.C_INFINITY=Number.POSITIVE_INFINITY;e.C_PI=Math.PI;e.C_2PI=2*e.C_PI;e.C_PI_BY_2=e.C_PI/2;e.C_RAD_TO_256=128/e.C_PI;e.C_256_TO_RAD=
e.C_PI/128;e.C_DEG_TO_256=256/360;e.C_DEG_TO_RAD=e.C_PI/180;e.C_SQRT2=1.414213562;e.C_SQRT2_INV=1/e.C_SQRT2;var b=1/Math.LN2;e.positiveMod=a;e.radToByte=function(b){return a(b*e.C_RAD_TO_256,256)};e.degToByte=function(b){return a(b*e.C_DEG_TO_256,256)};e.log2=function(a){return Math.log(a)*b};e.sqr=function(a){return a*a};e.clamp=function(a,b,f){return Math.min(Math.max(a,b),f)};e.interpolate=function(a,b,f){return a*(1-f)+b*f};e.between=function(a,b,f){return a>=b&&a<=f||a>=f&&a<=b}})},"esri/views/2d/engine/webgl/MaterialManager":function(){define("require exports ./enums ./MaterialInfoUtils ./shaders/MaterialPrograms ../../../webgl/programUtils".split(" "),
function(n,e,a,b,c,d){return function(){function f(){this._programByKey=new Map;this.isInitialize=!1}f.prototype.dispose=function(){this._programCache&&this._programCache.dispose()};f.prototype.initialize=function(a){this.isInitialize||(this._programCache=new d.ProgramCache(a),this.isInitialize=!0)};f.prototype.getProgram=function(f,g){f|=g===a.WGLDrawPhase.HITTEST?8:0;f|=g===a.WGLDrawPhase.HIGHLIGHT?16:0;if(this._programByKey[f])return this._programByKey[f];g=b.getMaterialVariations(f);var d=null;
switch(g.geometryType){case a.WGLGeometryType.MARKER:d=this._programCache.getProgram(c.icon,g.programOptions);break;case a.WGLGeometryType.TEXT:d=this._programCache.getProgram(c.text,g.programOptions);break;case a.WGLGeometryType.LABEL:d=this._programCache.getProgram(c.label,g.programOptions);break;case a.WGLGeometryType.FILL:d=this._programCache.getProgram(c.fill,g.programOptions);break;case a.WGLGeometryType.LINE:d=this._programCache.getProgram(c.line,g.programOptions)}d&&(this._programByKey[f]=
d);return d};return f}()})},"esri/views/2d/engine/webgl/MaterialInfoUtils":function(){define(["require","exports","./enums","./MaterialInfo","./MaterialKeyInfo"],function(n,e,a,b,c){function d(a){var b=[];b[0]=a.sdf?!0:!1;b[1]=a.vvSizeMinMaxValue?!0:!1;b[2]=a.vvSizeScaleStops?!0:!1;b[3]=a.vvSizeFieldStops?!0:!1;b[4]=a.vvSizeUnitValue?!0:!1;b[5]=a.vvColor?!0:!1;b[6]=a.vvRotation?!0:!1;b[7]=a.vvOpacity?!0:!1;b[8]=a.visibility?!0:!1;b[9]=a.pattern?!0:!1;b[10]=a.heatmap?!0:!1;return b.reduce(function(a,
b,c){b&&(a|=1<<c+2);return a},0)}function f(b){if(b.geometryType===a.WGLGeometryType.UNKNOWN)return-1;var c=d(b)<<3;return b.geometryType+c}Object.defineProperty(e,"__esModule",{value:!0});e.createTextMaterialInfo=function(d,g,l){var h=new b.default,k=new c;k.geometryType=l;k.sdf=!0;k.pattern=!1;k.visibility=!1;k.heatmap=!1;h.texBindingInfo.push(new b.TexBindingInfo(2,d.page,"u_texture"));0===g?k.vvOpacity=k.vvSizeMinMaxValue=k.vvSizeScaleStops=k.vvSizeFieldStops=k.vvSizeUnitValue=k.vvColor=k.vvRotation=
!1:(k.vvOpacity=0!==(g&a.WGLVVFlag.OPACITY),k.vvSizeMinMaxValue=0!==(g&a.WGLVVFlag.SIZE_MINMAX_VALUE),k.vvSizeScaleStops=0!==(g&a.WGLVVFlag.SIZE_SCALE_STOPS),k.vvSizeFieldStops=0!==(g&a.WGLVVFlag.SIZE_FIELD_STOPS),k.vvSizeUnitValue=0!==(g&a.WGLVVFlag.SIZE_UNIT_VALUE),k.vvColor=0!==(g&a.WGLVVFlag.COLOR),k.vvRotation=0!==(g&a.WGLVVFlag.ROTATION));h.materialKey=f(k);h.materialKeyInfo=k;return h};e.createMaterialInfo=function(d,g,l){var h=new b.default,k=new c;k.geometryType=g;d?(d=d.spriteMosaicItem,
k.sdf=d.sdf,k.pattern=!0,h.texBindingInfo.push(new b.TexBindingInfo(1,d.page,"u_texture"))):(k.sdf=!1,k.pattern=!1);0===l?k.vvOpacity=k.vvSizeMinMaxValue=k.vvSizeScaleStops=k.vvSizeFieldStops=k.vvSizeUnitValue=k.vvColor=k.vvRotation=!1:(k.vvOpacity=0!==(l&a.WGLVVFlag.OPACITY),k.vvSizeMinMaxValue=0!==(l&a.WGLVVFlag.SIZE_MINMAX_VALUE),k.vvSizeScaleStops=0!==(l&a.WGLVVFlag.SIZE_SCALE_STOPS),k.vvSizeFieldStops=0!==(l&a.WGLVVFlag.SIZE_FIELD_STOPS),k.vvSizeUnitValue=0!==(l&a.WGLVVFlag.SIZE_UNIT_VALUE),
k.vvColor=0!==(l&a.WGLVVFlag.COLOR),k.vvRotation=0!==(l&a.WGLVVFlag.ROTATION));k.visibility=!1;h.materialKey=f(k);h.materialKeyInfo=k;return h};e.getMaterialKey=f;e.getMaterialVariations=function(a){var b=a&7;a>>=3;return{geometryType:b,programOptions:{id:0!==(a&1),highlight:0!==(a&2),isSDF:0!==(a&4),vvSizeMinMaxValue:0!==(a&8),vvSizeScaleStops:0!==(a&16),vvSizeFieldStops:0!==(a&32),vvSizeUnitValue:0!==(a&64),vvColor:0!==(a&128),vvRotation:0!==(a&256),vvOpacity:0!==(a&512),visibility:0!==(a&1024),
pattern:0!==(a&2048),heatmap:0!==(a&4096)}}}})},"esri/views/2d/engine/webgl/MaterialInfo":function(){define("require exports ./enums ./MaterialInfoUtils ./MaterialInfoUtils_updateMaterialVariations ./MaterialKeyInfo ./util/serializationUtils".split(" "),function(n,e,a,b,c,d,f){Object.defineProperty(e,"__esModule",{value:!0});var h=function(){function a(a,b,c){this.unit=a;this.pageId=b;this.semantic=c}a.prototype.clone=function(){return new a(this.unit,this.pageId,this.semantic)};a.prototype.serialize=
function(a){a.push(this.unit);a.push(this.pageId);return a};a.deserialize=function(b){var c=b.readInt32();b=b.readInt32();return new a(c,b,"u_texture")};return a}();e.TexBindingInfo=h;var g=function(){function a(a,b){this.name=a;this.value=b}a.prototype.clone=function(){return new a(this.name,this.value)};a.prototype.serialize=function(a){a.push(this.value);return a};a.deserialize=function(b){b=b.readInt32();return new a("u_my_param",b)};return a}();e.MaterialParam=g;n=function(){function l(){this.texBindingInfo=
[];this.materialParams=[]}l.fromSprite=function(c,f,g){var k=new l,m=new d;m.geometryType=f;c?(m.sdf=c.sdf,m.pattern=!0,k.texBindingInfo.push(new h(1,c.page,"u_texture"))):(m.sdf=!1,m.pattern=!1);0===g?m.vvOpacity=m.vvSizeMinMaxValue=m.vvSizeScaleStops=m.vvSizeFieldStops=m.vvSizeUnitValue=m.vvColor=m.vvRotation=!1:(m.vvOpacity=0!==(g&a.WGLVVFlag.OPACITY),m.vvSizeMinMaxValue=0!==(g&a.WGLVVFlag.SIZE_MINMAX_VALUE),m.vvSizeScaleStops=0!==(g&a.WGLVVFlag.SIZE_SCALE_STOPS),m.vvSizeFieldStops=0!==(g&a.WGLVVFlag.SIZE_FIELD_STOPS),
m.vvSizeUnitValue=0!==(g&a.WGLVVFlag.SIZE_UNIT_VALUE),m.vvColor=0!==(g&a.WGLVVFlag.COLOR),m.vvRotation=0!==(g&a.WGLVVFlag.ROTATION));m.visibility=!1;k.materialKey=b.getMaterialKey(m);k.materialKeyInfo=m;return k};l.fromGlyph=function(c,f,g){var k=new l,m=new d;m.geometryType=f;m.sdf=!0;m.pattern=!1;m.visibility=!1;m.heatmap=!1;k.texBindingInfo.push(new h(2,c.page,"u_texture"));0===g?m.vvOpacity=m.vvSizeMinMaxValue=m.vvSizeScaleStops=m.vvSizeFieldStops=m.vvSizeUnitValue=m.vvColor=m.vvRotation=!1:(m.vvOpacity=
0!==(g&a.WGLVVFlag.OPACITY),m.vvSizeMinMaxValue=0!==(g&a.WGLVVFlag.SIZE_MINMAX_VALUE),m.vvSizeScaleStops=0!==(g&a.WGLVVFlag.SIZE_SCALE_STOPS),m.vvSizeFieldStops=0!==(g&a.WGLVVFlag.SIZE_FIELD_STOPS),m.vvSizeUnitValue=0!==(g&a.WGLVVFlag.SIZE_UNIT_VALUE),m.vvColor=0!==(g&a.WGLVVFlag.COLOR),m.vvRotation=0!==(g&a.WGLVVFlag.ROTATION));k.materialKey=b.getMaterialKey(m);k.materialKeyInfo=m;return k};l.prototype.copy=function(a){this.materialParams=a.materialParams.map(function(a){return a.clone()});this.texBindingInfo=
a.texBindingInfo.map(function(a){return a.clone()});a.materialKeyInfo&&(this.materialKeyInfo=new d,this.materialKeyInfo.copy(a.materialKeyInfo));this.materialKey=a.materialKey};l.prototype.serialize=function(a){a.push(this.materialKey);f.serializeList(a,this.texBindingInfo);f.serializeList(a,this.materialParams);return a};l.deserialize=function(a){var b=new l;b.materialKey=a.readInt32();b.texBindingInfo=f.deserializeList(a,h);b.materialParams=f.deserializeList(a,g);b.materialKeyInfo=new d;c(b.materialKeyInfo,
b.materialKey);return b};return l}();e.default=n})},"esri/views/2d/engine/webgl/MaterialInfoUtils_updateMaterialVariations":function(){define(["require","exports"],function(n,e){return function(a,b){a.geometryType=b&7;b>>=3;a.sdf=0!==(b&4);a.vvSizeMinMaxValue=0!==(b&8);a.vvSizeScaleStops=0!==(b&16);a.vvSizeFieldStops=0!==(b&32);a.vvSizeUnitValue=0!==(b&64);a.vvColor=0!==(b&128);a.vvRotation=0!==(b&256);a.vvOpacity=0!==(b&512);a.visibility=0!==(b&1024);a.pattern=0!==(b&2048);a.heatmap=0!==(b&4096);
return a}})},"esri/views/2d/engine/webgl/MaterialKeyInfo":function(){define(["require","exports"],function(n,e){return function(){function a(){this.heatmap=this.pattern=this.visibility=this.vvOpacity=this.vvRotation=this.vvColor=this.vvSizeUnitValue=this.vvSizeFieldStops=this.vvSizeScaleStops=this.vvSizeMinMaxValue=this.sdf=!1}a.prototype.copy=function(a){this.geometryType=a.geometryType;this.sdf=a.sdf;this.vvSizeMinMaxValue=a.vvSizeMinMaxValue;this.vvSizeScaleStops=a.vvSizeScaleStops;this.vvSizeFieldStops=
a.vvSizeFieldStops;this.vvSizeUnitValue=a.vvSizeUnitValue;this.vvColor=a.vvColor;this.vvRotation=a.vvRotation;this.vvOpacity=a.vvOpacity;this.visibility=a.visibility;this.pattern=a.pattern;this.heatmap=a.heatmap};a.prototype.hasVV=function(){void 0===this._hasVV&&(this._hasVV=this.vvColor||this.vvOpacity||this.vvRotation||this.vvSizeMinMaxValue||this.vvSizeScaleStops||this.vvSizeFieldStops||this.vvSizeUnitValue);return this._hasVV};a.prototype.hasVVSize=function(){return this.vvSizeMinMaxValue||this.vvSizeFieldStops||
this.vvSizeScaleStops||this.vvSizeUnitValue};a.prototype.hasVVColor=function(){return this.vvColor};a.prototype.hasVVRotation=function(){return this.vvRotation};a.prototype.hasVVOpacity=function(){return this.vvOpacity};return a}()})},"esri/views/2d/engine/webgl/util/serializationUtils":function(){define(["require","exports"],function(n,e){Object.defineProperty(e,"__esModule",{value:!0});e.serializeList=function(a,b){if(null===b)a.push(0);else{a.push(b.length);for(var c=0;c<b.length;c++)b[c].serialize(a);
return a}};e.deserializeList=function(a,b,c){for(var d=a.readInt32(),d=Array(d),f=0;f<d.length;f++)d[f]=b.deserialize(a,c);return d}})},"esri/views/2d/engine/webgl/shaders/MaterialPrograms":function(){define(["require","exports","./sources/resolver","../../../../webgl/programUtils"],function(n,e,a,b){Object.defineProperty(e,"__esModule",{value:!0});var c=function(a){return b.glslifyDefineMap({ID:a.id,HIGHLIGHT:a.highlight,SDF:a.isSDF,VV_SIZE_MIN_MAX_VALUE:a.vvSizeMinMaxValue,VV_SIZE_SCALE_STOPS:a.vvSizeScaleStops,
VV_SIZE_FIELD_STOPS:a.vvSizeFieldStops,VV_SIZE_UNIT_VALUE:a.vvSizeUnitValue,VV_COLOR:a.vvColor,VV_ROTATION:a.vvRotation,VV_OPACITY:a.vvOpacity,VERTEX_VISIBILITY:a.visibility,PATTERN:a.pattern,HEATMAP:a.heatmap})};c;e.fill={name:"fill",shaders:function(b){return{vertexShader:c(b)+a.resolveIncludes("materials/fill/fill.vert"),fragmentShader:c(b)+a.resolveIncludes("materials/fill/fill.frag")}},attributes:{a_pos:0,a_id:1,a_color:2,a_tlbr:3,a_aux:4,a_vv:5,a_visible:6}};e.icon={name:"icon",shaders:function(b){return{vertexShader:c(b)+
a.resolveIncludes("materials/icon/icon.vert"),fragmentShader:c(b)+a.resolveIncludes("materials/icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffsetAndTex:1,a_id:2,a_color:3,a_outlineColor:4,a_sizeAndOutlineWidth:5,a_vv:6,a_weight:7,a_visible:8}};e.label={name:"label",shaders:function(b){return{vertexShader:c(b)+a.resolveIncludes("materials/label/label.vert"),fragmentShader:c(b)+a.resolveIncludes("materials/label/label.frag")}},attributes:{a_pos:0,a_color:1,a_vertexOffset:2,a_texAndSize:3,a_refSymbolAndPlacementOffset:4,
a_visible:5,a_visibilityRange:6}};e.line={name:"line",shaders:function(b){return{vertexShader:c(b)+a.resolveIncludes("materials/line/line.vert"),fragmentShader:c(b)+a.resolveIncludes("materials/line/line.frag")}},attributes:{a_pos:0,a_id:1,a_color:2,a_offsetAndNormal:3,a_accumulatedDistanceAndHalfWidth:4,a_tlbr:5,a_segmentDirection:6,a_vv:7,a_visible:8}};e.text={name:"text",shaders:function(b){return{vertexShader:c(b)+a.resolveIncludes("materials/text/text.vert"),fragmentShader:c(b)+a.resolveIncludes("materials/text/text.frag")}},
attributes:{a_pos:0,a_id:1,a_color:2,a_vertexOffset:3,a_texFontSize:4,a_visible:5,a_vv:6}}})},"esri/views/2d/engine/webgl/Utils":function(){define("require exports ../../../../arcade/Dictionary ../../../../arcade/Feature ../../../../core/Error ../../../../core/Logger ../../../../core/screenUtils ../../../../support/arcadeUtils ./color ./enums ./SymbolProperties".split(" "),function(n,e,a,b,c,d,f,h,g,l,m){function k(a){for(var b={},c=0;c<a.length;c++){var f=a[c];b[f.name]=f.strideInBytes}return b}
function v(a){switch(a){case l.WGLGeometryType.MARKER:return H;case l.WGLGeometryType.FILL:return D;case l.WGLGeometryType.LINE:return E;case l.WGLGeometryType.TEXT:return J;case l.WGLGeometryType.LABEL:return F}return null}function q(a){switch(a%4){case 0:case 2:return 4;case 1:case 3:return 1}}function p(a){switch(a){case "esriSMS":return"simple-marker";case "esriPMS":return"picture-marker";case "esriSLS":return"simple-line";case "esriPLS":return"picture-line";case "esriSFS":return"simple-fill";
case "esriPFS":return"picture-fill";case "esriTS":return"text"}return a}function r(a){if(a=p(a.type)){switch(a){case "simple-marker":case "picture-marker":return!0;case "CIMPointSymbol":return!0}return!1}}function t(a){if(a=p(a.type)){switch(a){case "simple-fill":case "picture-fill":return!0;case "CIMPolygonSymbol":return!0}return!1}}function u(a){if(a=p(a.type)){switch(a){case "simple-line":case "picture-line":return!0;case "CIMLineSymbol":return!0}return!1}}function x(a){if(a=p(a.type)){switch(a){case "text":return!0;
case "CIMTextSymbol":return!0}return!1}}function z(a){return a&&a.length||0}function w(a){return"string"===typeof a}Object.defineProperty(e,"__esModule",{value:!0});var y,A=d.getLogger("esri.views.2d.engine.webgl.Utils");e.C_HITTEST_SEARCH_SIZE=4;e.C_VBO_GEOMETRY="geometry";e.C_VBO_PERINSTANCE="per_instance";e.C_VBO_PERINSTANCE_VV="per_instance_vv";e.C_VBO_VISIBILITY="visibility";e.C_VBO_VISIBILITY_RANGE="visibilityRange";e.C_ICON_VERTEX_DEF=[{name:e.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:e.C_VBO_VISIBILITY,
strideInBytes:1,divisor:0}];e.C_ICON_VERTEX_DEF_VV=[{name:e.C_VBO_GEOMETRY,strideInBytes:40,divisor:0},{name:e.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];e.C_ICON_HEATMAP=[{name:e.C_VBO_GEOMETRY,strideInBytes:28,divisor:0},{name:e.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];e.C_FILL_VERTEX_DEF=[{name:e.C_VBO_GEOMETRY,strideInBytes:24,divisor:0},{name:e.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];e.C_FILL_VERTEX_DEF_VV=[{name:e.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:e.C_VBO_VISIBILITY,
strideInBytes:1,divisor:0}];e.C_LINE_VERTEX_DEF=[{name:e.C_VBO_GEOMETRY,strideInBytes:32,divisor:0},{name:e.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];e.C_LINE_VERTEX_DEF_VV=[{name:e.C_VBO_GEOMETRY,strideInBytes:44,divisor:0},{name:e.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];e.C_TEXT_VERTEX_DEF=[{name:e.C_VBO_GEOMETRY,strideInBytes:20,divisor:0},{name:e.C_VBO_VISIBILITY,strideInBytes:1,divisor:0}];e.C_TEXT_VERTEX_DEF_VV=[{name:e.C_VBO_GEOMETRY,strideInBytes:36,divisor:0},{name:e.C_VBO_VISIBILITY,
strideInBytes:1,divisor:0}];e.C_LABEL_VERTEX_DEF=[{name:e.C_VBO_GEOMETRY,strideInBytes:20,divisor:0},{name:e.C_VBO_VISIBILITY,strideInBytes:1,divisor:0},{name:e.C_VBO_VISIBILITY_RANGE,strideInBytes:2,divisor:0}];e.C_ICON_STRIDE_SPEC=k(e.C_ICON_VERTEX_DEF);e.C_ICON_STRIDE_SPEC_VV=k(e.C_ICON_VERTEX_DEF_VV);e.C_ICON_STRIDE_SPEC_HEATMAP=k(e.C_ICON_HEATMAP);e.C_FILL_STRIDE_SPEC=k(e.C_FILL_VERTEX_DEF);e.C_FILL_STRIDE_SPEC_VV=k(e.C_FILL_VERTEX_DEF_VV);e.C_LINE_STRIDE_SPEC=k(e.C_LINE_VERTEX_DEF);e.C_LINE_STRIDE_SPEC_VV=
k(e.C_LINE_VERTEX_DEF_VV);e.C_TEXT_STRIDE_SPEC=k(e.C_TEXT_VERTEX_DEF);e.C_TEXT_STRIDE_SPEC_VV=k(e.C_TEXT_VERTEX_DEF_VV);e.C_LABEL_STRIDE_SPEC=k(e.C_LABEL_VERTEX_DEF);e.getStrides=function(a,b,c){void 0===c&&(c=!1);switch(a){case l.WGLGeometryType.MARKER:return b?e.C_ICON_STRIDE_SPEC_VV:c?e.C_ICON_STRIDE_SPEC_HEATMAP:e.C_ICON_STRIDE_SPEC;case l.WGLGeometryType.FILL:return b?e.C_FILL_STRIDE_SPEC_VV:e.C_FILL_STRIDE_SPEC;case l.WGLGeometryType.LINE:return b?e.C_LINE_STRIDE_SPEC_VV:e.C_LINE_STRIDE_SPEC;
case l.WGLGeometryType.TEXT:return b?e.C_TEXT_STRIDE_SPEC_VV:e.C_TEXT_STRIDE_SPEC;case l.WGLGeometryType.LABEL:return e.C_LABEL_STRIDE_SPEC}return null};var H=[e.C_VBO_GEOMETRY,e.C_VBO_VISIBILITY],D=[e.C_VBO_GEOMETRY,e.C_VBO_VISIBILITY],E=[e.C_VBO_GEOMETRY,e.C_VBO_VISIBILITY],J=[e.C_VBO_GEOMETRY,e.C_VBO_VISIBILITY],F=[e.C_VBO_GEOMETRY,e.C_VBO_VISIBILITY,e.C_VBO_VISIBILITY_RANGE];e.getNamedBuffers=v;e.strideToPackingFactor=q;e.allocateTypedArrayBuffer=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(Math.floor(a*
b/4));case 1:case 3:return new Uint8Array(a*b)}};e.allocateTypedArrayBufferwithData=function(a,b){switch(b%4){case 0:case 2:return new Uint32Array(a);case 1:case 3:return new Uint8Array(a)}};e.getSymbolGeometryType=function(a){return r(a)?l.WGLGeometryType.MARKER:u(a)?l.WGLGeometryType.LINE:t(a)?l.WGLGeometryType.FILL:x(a)?l.WGLGeometryType.TEXT:l.WGLGeometryType.UNKNOWN};e.normalizeSymbolType=p;e.isMarkerSymbol=r;e.isFillSymbol=t;e.isLineSymbol=u;e.isPictureSymbol=function(a){if(a=p(a.type))switch(a){case "picture-marker":case "picture-line":case "picture-fill":return!0}return!1};
e.isTextSymbol=x;e.getTextProperties=function(a){return m.TextProperties.pool.acquire(a.color?g.copyAndPremultiply(a.color):[255,255,255,255],a.haloColor?g.copyAndPremultiply(a.haloColor):[255,255,255,255],f.pt2px(a.haloSize),f.pt2px(a.font.size),a.angle*Math.PI/180,a.xoffset/a.font.size,a.yoffset/a.font.size,"left"===a.horizontalAlignment?0:"right"===a.horizontalAlignment?1:.5,"top"===a.verticalAlignment?0:"bottom"===a.verticalAlignment?1:.5)};e.isSameUniformValue=function(a,b){return!1};e.isSameMaterialInfo=
function(a,b){if(a.materialKey!==b.materialKey||z(a.texBindingInfo)!==z(b.texBindingInfo)||z(a.materialParams)!==z(b.materialParams))return!1;for(var c=a.texBindingInfo.length,f=0;f<c;++f){var g=a.texBindingInfo[f],d=b.texBindingInfo[f];if(g.unit!==d.unit||g.pageId!==d.pageId||g.semantic!==d.semantic)return!1}a=a.materialParams.length;for(f=0;f<a;)return!1;return!0};e.serializeString=function(a,b,c){for(var f=0,g=a.length,d=0;d<g;++d)b&&(b[c+f]=a.charCodeAt(d)),++f;b&&(b[c+f]=0);++f;return f};e.deserializeString=
function(a,b,c){var f=0;a.s="";for(var g=!0;g;){var d=b[c+f];++f;0!==d?a.s+=String.fromCharCode(d):g=!1}return f};e.isDefined=function(a){return null!==a&&void 0!==a};e.isNumber=function(a){return"number"===typeof a};e.isString=w;e.isStringOrNull=function(a){return null==a||w(a)};e.lerp=function(a,b,c){return a+(b-a)*c};n=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(b)};a.prototype.getKeys=function(a){this._arr.length=0;a&&a.forEach(this._push);
return this._arr};return a}();e.KeysGetter=n;n=function(){function a(){this._arr=[];this._push=this._push.bind(this)}a.prototype._push=function(a,b){this._arr.push(a)};a.prototype.getValues=function(a){this._arr.length=0;a&&a.forEach(this._push);return this._arr};return a}();e.ValuesGetter=n;e.getCapType=function(a){switch(a){case "butt":return l.CapType.BUTT;case "round":return l.CapType.ROUND;case "square":return l.CapType.SQUARE;default:return A.error(new c("mapview-invalid-type","Cap type "+a+
" is not a valid option. Defaulting to round")),l.CapType.ROUND}};e.getJoinType=function(a){switch(a){case "miter":return l.JoinType.MITER;case "bevel":return l.JoinType.BEVEL;case "round":return l.JoinType.ROUND;default:return A.error(new c("mapview-invalid-type","Join type "+a+" is not a valid option. Defaulting to round")),l.JoinType.ROUND}};e.getVVType=function(a){switch(a){case "opacity":return l.VVType.OPACITY;case "color":return l.VVType.COLOR;case "rotation":return l.VVType.ROTATION;case "size":return l.VVType.SIZE;
default:return A.error("Cannot interpret unknown vv: "+a),null}};e.createArcadeFunction=function(c,f){var g=c.spatialReference,d=c.layer,l=h.createFunction(c.valueExpression),k=new b,m=new a({viewingMode:null,scale:null}),e={},p={vars:{$feature:k,$view:null},spatialReference:g};return function(a,b){k.repurposeFromGraphicLikeObject(a.geometry,a.attributes,d);b?(p.vars.$view=m,m.attributes.viewingMode=b.viewingMode,m.attributes.scale=b.scale):p.vars.$view=e;a=h.executeFunction(l,p);return f?f(a):a}};
e.copyMeshData=function(a,b,c,f,g,d,h){for(var l in d)for(var k=d[l].stride,m=q(k),e=d[l].data,p=c[l].data,r=k*g.vertexCount/m,v=k*a/m,m=k*g.vertexFrom/m,k=0;k<r;++k)p[k+v]=e[k+m];c=g.indexCount;for(k=0;k<c;++k)f[k+b]=h[k+g.indexFrom]-g.vertexFrom+a};e.C_VBO_INFO=(y={},y[e.C_VBO_GEOMETRY]=35044,y[e.C_VBO_VISIBILITY]=35044,y[e.C_VBO_VISIBILITY_RANGE]=35048,y);e.createGeometryData=function(a,b){for(var c=[],f=0;5>f;++f){for(var g={},d=0,h=v(f);d<h.length;d++){var l=h[d];g[l]={data:b(f,l)}}c.push({data:a(f),
buffers:g})}return c};e.resampleHermite=function(a,b,c,f,g,d,h){void 0===h&&(h=!0);var l=b/g;c/=d;for(var k=Math.ceil(l/2),m=Math.ceil(c/2),e=0;e<d;e++)for(var p=0;p<g;p++){for(var r=4*(p+(h?d-e-1:e)*g),q=0,v=0,t=0,u=0,w=0,x=0,y=0,z=(e+.5)*c,A=Math.floor(e*c);A<(e+1)*c;A++)for(var n=Math.abs(z-(A+.5))/m,H=(p+.5)*l,n=n*n,D=Math.floor(p*l);D<(p+1)*l;D++){var E=Math.abs(H-(D+.5))/k,q=Math.sqrt(n+E*E);-1<=q&&1>=q&&(q=2*q*q*q-3*q*q+1,0<q&&(E=4*(D+A*b),y+=q*a[E+3],t+=q,255>a[E+3]&&(q=q*a[E+3]/250),u+=q*
a[E],w+=q*a[E+1],x+=q*a[E+2],v+=q))}f[r]=u/v;f[r+1]=w/v;f[r+2]=x/v;f[r+3]=y/t}}})},"esri/views/2d/engine/webgl/color":function(){define(["require","exports","./number"],function(n,e,a){function b(a,b){Array.isArray(b)?(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]):(a[0]=b.r,a[1]=b.g,a[2]=b.b,a[3]=b.a);return a}function c(a,b,c){void 0===b&&(b=0);void 0===c&&(c=!1);var f=a[b+3];a[b+0]*=f;a[b+1]*=f;a[b+2]*=f;c||(a[b+3]*=255);return a}Object.defineProperty(e,"__esModule",{value:!0});e.white=[255,255,255,
1];var d=[0,0,0,0];e.premultiplyAlpha=c;e.copyAndPremultiply=function(a){return c(b([],a))};e.premultiplyAlphaUint32=function(f){c(b(d,f));return a.i8888to32(d[0],d[1],d[2],d[3])};e.premultiplyAlphaRGBA=function(b){var c=b.a;return a.i8888to32(b.r*c,b.g*c,b.b*c,255*c)}})},"esri/views/2d/engine/webgl/number":function(){define(["require","exports"],function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var a=new Float32Array(1),b=new Uint32Array(a.buffer);e.nextHighestPowerOfTwo=function(a){a--;
a|=a>>1;a|=a>>2;a|=a>>4;a|=a>>8;a|=a>>16;a++;return a};e.toUint32=function(c){a[0]=c;return b[0]};e.i1616to32=function(a,b){return 65535&a|b<<16};e.i8888to32=function(a,b,f,h){return a&255|(b&255)<<8|(f&255)<<16|h<<24};e.i8816to32=function(a,b,f){return a&255|(b&255)<<8|f<<16};e.numTo32=function(a){return a|0}})},"esri/views/2d/engine/webgl/SymbolProperties":function(){define(["require","exports","../../../../core/ObjectPool"],function(n,e,a){Object.defineProperty(e,"__esModule",{value:!0});n=function(){function b(){this.color=
[0,0,0,0];this.haloColor=[0,0,0,0];this.haloSize=0;this.size=12;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=0}b.prototype.acquire=function(a,b,f,h,g,l,m,k,e){this.color=a;this.haloColor=b;this.haloSize=f;this.size=h;this.angle=g;this.offsetX=l;this.offsetY=m;this.hAnchor=k;this.vAnchor=e};b.prototype.release=function(){this.color[0]=this.color[1]=this.color[2]=this.color[3]=0;this.vAnchor=this.hAnchor=this.offsetY=this.offsetX=this.angle=this.size=this.haloSize=this.haloColor[0]=
this.haloColor[1]=this.haloColor[2]=this.haloColor[3]=0};b.pool=new a(b);return b}();e.TextProperties=n})},"esri/views/2d/engine/webgl/brushes/WGLBrushInfo":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../definitions ../GeometryUtils ./WGLBrush ../shaders/BackgroundPrograms ../shaders/TileInfoPrograms ../../../tiling/enums ../../../../webgl/BufferObject ../../../../webgl/programUtils ../../../../webgl/Texture ../../../../webgl/VertexArrayObject".split(" "),function(n,
e,a,b,c,d,f,h,g,l,m,k,v){Object.defineProperty(e,"__esModule",{value:!0});n=function(d){function e(){var a=d.call(this)||this;a._initialized=!1;a._maxWidth=0;a._color=new Float32Array([1,0,0,1]);return a}a(e,d);e.prototype.dispose=function(){this._outlineProgram&&(this._outlineProgram.dispose(),this._outlineProgram=null);this._tileInfoProgram&&(this._tileInfoProgram.dispose(),this._tileInfoProgram=null);this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=
null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null);this._canvas=null};e.prototype.draw=function(a,c){a=a.context;if(c.status!==g.TileStatus.INITIALIZED){this._initialized||this._initialize(a);a.bindVAO(this._outlineVertexArrayObject);a.bindProgram(this._outlineProgram);this._outlineProgram.setUniformMatrix4fv("u_transformMatrix",c.tileTransform.transform);this._outlineProgram.setUniform2fv("u_normalized_origin",c.tileTransform.displayCoord);
this._outlineProgram.setUniform1f("u_coord_range",b.TILE_SIZE);this._outlineProgram.setUniform1f("u_depth",0);this._outlineProgram.setUniform4fv("u_color",this._color);a.setLineWidth(2);a.drawArrays(3,0,4);a.bindVAO();var f=this._getTexture(a,c);f&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(this._tileInfoProgram),a.bindTexture(f,0),this._tileInfoProgram.setUniformMatrix4fv("u_transformMatrix",c.tileTransform.transform),this._tileInfoProgram.setUniform2fv("u_normalized_origin",c.tileTransform.displayCoord),
this._tileInfoProgram.setUniform1f("u_depth",0),this._tileInfoProgram.setUniform1f("u_coord_ratio",1),this._tileInfoProgram.setUniform2f("u_delta",8,8),this._tileInfoProgram.setUniform2f("u_dimensions",f.descriptor.width,f.descriptor.height),a.drawArrays(5,0,4),a.bindVAO())}};e.prototype._initialize=function(a){if(this._initialized)return!0;var b=m.createProgram(a,f.background),c=m.createProgram(a,h.tileInfo),g={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},
d=new Int8Array([0,0,1,0,1,1,0,1]),d=l.createVertex(a,35044,d),d=new v(a,f.background.attributes,g,{geometry:d}),k=new Int8Array([0,0,1,0,0,1,1,1]),k=l.createVertex(a,35044,k);a=new v(a,h.tileInfo.attributes,g,{geometry:k});this._outlineProgram=b;this._tileInfoProgram=c;this._outlineVertexArrayObject=d;this._tileInfoVertexArrayObject=a;return this._initialized=!0};e.prototype._getTexture=function(a,b){if(b.texture)return b.texture;this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id",
"canvas2d"),this._canvas.setAttribute("width","256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var f=b.key.id,g=this._canvas.getContext("2d");g.font="24px sans-serif";g.textAlign="left";g.textBaseline="middle";var d=g.measureText(f),d=Math.pow(2,Math.ceil(c.log2(d.width+2)));d>this._maxWidth&&(this._maxWidth=d);g.clearRect(0,0,this._maxWidth,32);g.fillStyle="blue";g.fillText(f,0,16);b.texture=new k(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},
this._canvas);return b.texture};return e}(d.default);e.default=n})},"esri/views/2d/engine/webgl/brushes/WGLBrush":function(){define(["require","exports"],function(n,e){Object.defineProperty(e,"__esModule",{value:!0});n=function(){return function(){}}();e.default=n})},"esri/views/2d/engine/webgl/shaders/BackgroundPrograms":function(){define(["require","exports","./sources/resolver"],function(n,e,a){Object.defineProperty(e,"__esModule",{value:!0});e.background={name:"background",shaders:{vertexShader:a.resolveIncludes("background/background.vert"),
fragmentShader:a.resolveIncludes("background/background.frag")},attributes:{a_pos:0}}})},"esri/views/2d/engine/webgl/shaders/TileInfoPrograms":function(){define(["require","exports","./sources/resolver"],function(n,e,a){Object.defineProperty(e,"__esModule",{value:!0});e.tileInfo={name:"tileInfo",shaders:{vertexShader:a.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:a.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/webgl/Texture":function(){define(["require",
"exports","../../core/has"],function(n,e,a){return function(){function a(b,d,f){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=new Set;this._context=b;this._desc={pixelFormat:d.pixelFormat,internalFormat:d.internalFormat,dataType:d.dataType,target:d.target?d.target:3553,samplingMode:d.samplingMode?d.samplingMode:9729,wrapMode:d.wrapMode?d.wrapMode:10497,maxAnisotropy:d.maxAnisotropy,flipped:void 0!==d.flipped?d.flipped:
!1,hasMipmap:void 0!==d.hasMipmap?d.hasMipmap:!1,unpackAlignment:d.unpackAlignment?d.unpackAlignment:4,width:d.width,height:d.height,preMultiplyAlpha:void 0!==d.preMultiplyAlpha?d.preMultiplyAlpha:!1};this._id=++a._nextId;this.setData(f)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",
{get:function(){return this._desc},enumerable:!0,configurable:!0});a.prototype.dispose=function(){var a=this;if(this._context){if(this._glName){var b=this._context.gl;this._boundToUnits.forEach(function(b){a._context.bindTexture(null,b)});b.deleteTexture(this._glName);this._glName=null}this._context=null}};a.prototype.resize=function(a,b){var c=this._desc;if(c.width!==a||c.height!==b)c.width=a,c.height=b,this.setData(null)};a.prototype.setData=function(b){var c=this._context.gl;this._glName||(this._glName=
c.createTexture());void 0===b&&(b=null);null===b&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var f=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var h=this._desc;a._validateTexture(h);c.pixelStorei(c.UNPACK_ALIGNMENT,h.unpackAlignment);c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,h.flipped?1:0);c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,h.preMultiplyAlpha);var g=h.pixelFormat,l=h.internalFormat?h.internalFormat:g;if(b instanceof ImageData||b instanceof
HTMLImageElement||b instanceof HTMLCanvasElement||b instanceof HTMLVideoElement)h.width&&h.height&&console.assert(b.width===h.width&&b.height===h.height),c.texImage2D(c.TEXTURE_2D,0,l,g,h.dataType,b),h.hasMipmap&&this.generateMipmap(),void 0===this._desc.width&&(this._desc.width=b.width),void 0===this._desc.height&&(this._desc.height=b.height);else{null!=h.width&&null!=h.height||console.error("Width and height must be specified!");c.DEPTH24_STENCIL8&&l===c.DEPTH_STENCIL&&(l=c.DEPTH24_STENCIL8);var m=
h.width,k=h.height;if(null!=b&&"type"in b&&"compressed"===b.type)for(var e=0;;++e){c.compressedTexImage2D(c.TEXTURE_2D,e,l,m,k,0,b.levels[Math.min(e,b.levels.length-1)]);if(1===m&&1===k||!h.hasMipmap)break;m=Math.max(1,m>>1);k=Math.max(1,k>>1)}else if(b)c.texImage2D(c.TEXTURE_2D,0,l,m,k,0,g,h.dataType,b),h.hasMipmap&&this.generateMipmap();else for(e=0;;++e){c.texImage2D(c.TEXTURE_2D,e,l,m,k,0,g,h.dataType,null);if(1===m&&1===k||!h.hasMipmap)break;m=Math.max(1,m>>1);k=Math.max(1,k>>1)}}a._applySamplingMode(c,
this._desc);a._applyWrapMode(c,this._desc);a._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(f,0)};a.prototype.updateData=function(a,b,f,h,g,l){l||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");var c=this._context.gl,d=this._desc,e=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>b||0>f||h>d.width||g>d.height||b+h>d.width||f+g>d.height)&&console.error("An attempt to update out of bounds of the texture!");
l instanceof ImageData||l instanceof HTMLImageElement||l instanceof HTMLCanvasElement||l instanceof HTMLVideoElement?(console.assert(l.width===h&&l.height===g),c.texSubImage2D(c.TEXTURE_2D,a,b,f,d.pixelFormat,d.dataType,l)):c.texSubImage2D(c.TEXTURE_2D,a,b,f,h,g,d.pixelFormat,d.dataType,l);this._context.bindTexture(e,0)};a.prototype.generateMipmap=function(){var b=this._desc;b.hasMipmap||(b.hasMipmap=!0,a._validateTexture(b));9729===b.samplingMode?(this._samplingModeDirty=!0,b.samplingMode=9985):
9728===b.samplingMode&&(this._samplingModeDirty=!0,b.samplingMode=9984);b=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var d=this._context.gl;d.generateMipmap(d.TEXTURE_2D);this._context.bindTexture(b,0)};a.prototype.setSamplingMode=function(b){b!==this._desc.samplingMode&&(this._desc.samplingMode=b,a._validateTexture(this._desc),this._samplingModeDirty=!0)};a.prototype.setWrapMode=function(b){b!==this._desc.wrapMode&&(this._desc.wrapMode=b,a._validateTexture(this._desc),this._wrapModeDirty=
!0)};a.prototype.applyChanges=function(){var b=this._context.gl,d=this._desc;this._samplingModeDirty&&(a._applySamplingMode(b,d),this._samplingModeDirty=!1);this._wrapModeDirty&&(a._applyWrapMode(b,d),this._wrapModeDirty=!1)};a.prototype.setBoundToUnit=function(a,b){b?this._boundToUnits.add(a):this._boundToUnits.delete(a)};a._isPowerOfTwo=function(a){return 0===(a&a-1)};a._validateTexture=function(b){(0>b.width||0>b.height)&&console.error("Negative dimension parameters are not allowed!");a._isPowerOfTwo(b.width)&&
a._isPowerOfTwo(b.height)||(33071!==b.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),b.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};a._applySamplingMode=function(a,b){var c=b.samplingMode;if(9985===c||9987===c)c=9729;else if(9984===c||9986===c)c=9728;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b.samplingMode)};a._applyWrapMode=function(a,b){a.texParameteri(a.TEXTURE_2D,
a.TEXTURE_WRAP_S,b.wrapMode);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode)};a._applyAnisotropicFilteringParameters=function(a,b){if(null!=b.maxAnisotropy){var c=a.capabilities.textureFilterAnisotropic;c&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY,b.maxAnisotropy))}};a._nextId=0;return a}()})},"esri/views/2d/engine/webgl/brushes/WGLBrushStencil":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../core/libs/gl-matrix/vec4 ../definitions ./WGLBrush ../shaders/BackgroundPrograms ../../../../webgl/BufferObject ../../../../webgl/programUtils ../../../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f,h,g,l){Object.defineProperty(e,"__esModule",{value:!0});n=function(d){function k(){var a=d.call(this)||this;a._color=b.create();a._initialized=!1;a._color.set([1,0,0,1]);return a}a(k,d);k.prototype.dispose=function(){this._solidProgram&&(this._solidProgram.dispose(),this._solidProgram=null);this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null)};k.prototype.draw=function(a,b){a=a.context;this._initialized||this._initialize(a);
a.setStencilFunctionSeparate(1032,519,b.stencilRef,255);a.bindVAO(this._solidVertexArrayObject);a.bindProgram(this._solidProgram);this._solidProgram.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform);this._solidProgram.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord);this._solidProgram.setUniform1f("u_coord_range",c.TILE_SIZE);this._solidProgram.setUniform1f("u_depth",0);this._solidProgram.setUniform4fv("u_color",this._color);a.drawArrays(5,0,4);a.bindVAO()};k.prototype._initialize=
function(a){if(this._initialized)return!0;var b=g.createProgram(a,f.background);if(!b)return!1;var c=new Int8Array([0,0,1,0,0,1,1,1]),c=h.createVertex(a,35044,c);a=new l(a,f.background.attributes,{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:c});this._solidProgram=b;this._solidVertexArrayObject=a;return this._initialized=!0};return k}(d.default);e.default=n})},"esri/core/libs/gl-matrix/vec4":function(){define(["./common"],function(n){var e={create:function(){var a=
new n.ARRAY_TYPE(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a},clone:function(a){var b=new n.ARRAY_TYPE(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b},fromValues:function(a,b,c,d){var f=new n.ARRAY_TYPE(4);f[0]=a;f[1]=b;f[2]=c;f[3]=d;return f},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a},set:function(a,b,c,d,f){a[0]=b;a[1]=c;a[2]=d;a[3]=f;return a},add:function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a},subtract:function(a,b,c){a[0]=b[0]-
c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}};e.sub=e.subtract;e.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a};e.mul=e.multiply;e.divide=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a};e.div=e.divide;e.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);a[3]=Math.ceil(b[3]);return a};e.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);
a[3]=Math.floor(b[3]);return a};e.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);a[3]=Math.min(b[3],c[3]);return a};e.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};e.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);a[3]=Math.round(b[3]);return a};e.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a};e.scaleAndAdd=
function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;return a};e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return Math.sqrt(c*c+d*d+f*f+a*a)};e.dist=e.distance;e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1],f=b[2]-a[2];a=b[3]-a[3];return c*c+d*d+f*f+a*a};e.sqrDist=e.squaredDistance;e.length=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];return Math.sqrt(b*b+c*c+d*d+a*a)};e.len=e.length;e.squaredLength=function(a){var b=a[0],
c=a[1],d=a[2];a=a[3];return b*b+c*c+d*d+a*a};e.sqrLen=e.squaredLength;e.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};e.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];a[3]=1/b[3];return a};e.normalize=function(a,b){var c=b[0],d=b[1],f=b[2];b=b[3];var h=c*c+d*d+f*f+b*b;0<h&&(h=1/Math.sqrt(h),a[0]=c*h,a[1]=d*h,a[2]=f*h,a[3]=b*h);return a};e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};e.lerp=function(a,b,c,d){var f=b[0],h=b[1],g=b[2];b=b[3];
a[0]=f+d*(c[0]-f);a[1]=h+d*(c[1]-h);a[2]=g+d*(c[2]-g);a[3]=b+d*(c[3]-b);return a};e.random=function(a,b){b=b||1;a[0]=n.RANDOM();a[1]=n.RANDOM();a[2]=n.RANDOM();a[3]=n.RANDOM();e.normalize(a,a);e.scale(a,a,b);return a};e.transformMat4=function(a,b,c){var d=b[0],f=b[1],h=b[2];b=b[3];a[0]=c[0]*d+c[4]*f+c[8]*h+c[12]*b;a[1]=c[1]*d+c[5]*f+c[9]*h+c[13]*b;a[2]=c[2]*d+c[6]*f+c[10]*h+c[14]*b;a[3]=c[3]*d+c[7]*f+c[11]*h+c[15]*b;return a};e.transformQuat=function(a,b,c){var d=b[0],f=b[1],h=b[2],g=c[0],l=c[1],
m=c[2];c=c[3];var k=c*d+l*h-m*f,e=c*f+m*d-g*h,q=c*h+g*f-l*d,d=-g*d-l*f-m*h;a[0]=k*c+d*-g+e*-m-q*-l;a[1]=e*c+d*-l+q*-g-k*-m;a[2]=q*c+d*-m+k*-l-e*-g;a[3]=b[3];return a};e.forEach=function(){var a=e.create();return function(b,c,d,f,h,g){c||(c=4);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],a[3]=b[d+3],h(a,a,g),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2],b[d+3]=a[3];return b}}();e.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};e.exactEquals=
function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};e.equals=function(a,b){var c=a[0],d=a[1],f=a[2];a=a[3];var h=b[0],g=b[1],l=b[2];b=b[3];return Math.abs(c-h)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(h))&&Math.abs(d-g)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(f-l)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(l))&&Math.abs(a-b)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};return e})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushFill":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f,h){Object.defineProperty(e,"__esModule",{value:!0});n=function(g){function d(){var a=null!==g&&g.apply(this,arguments)||this;a._isInitialized=!1;a._spritesTextureSize=new Float32Array(2);return a}a(d,g);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return b.WGLGeometryType.FILL};d.prototype.drawGeometry=function(a,b,c,f){f=a.context;var g=a.painter,d=a.rendererInfo,h=a.requiredLevel,l=a.stationary,k=c.indexCount,e=c.indexFrom;this._initialize();var m=
c.materialInfo.materialKeyInfo,q=a.painter.materialManager.getProgram(c.materialInfo.materialKey,a.drawPhase);if(q){f.bindProgram(q);var v=this._getVAO(f,b,m.hasVV());f.bindVAO(v);if(0<c.materialInfo.texBindingInfo.length){c=c.materialInfo.texBindingInfo[0];var v=c.pageId,n=a.painter.textureManager.sprites;this._spritesTextureSize[0]=n.getWidth(v);this._spritesTextureSize[1]=n.getHeight(v);q.setUniform1f("u_zoomFactor",1/Math.pow(2,h-b.key.level)/a.pixelRatio);g.textureManager.bindSpritePage(f,v,
c.unit,l?9728:9729);q.setUniform1i(c.semantic,c.unit);q.setUniform2fv("u_mosaicSize",this._spritesTextureSize)}q.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform);q.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord);q.setUniform1f("u_opacity",1);m.vvColor&&(q.setUniform1fv("u_vvColorValues",d.vvColorValues),q.setUniform4fv("u_vvColors",d.vvColors));m.vvOpacity&&(q.setUniform1fv("u_vvOpacityValues",d.vvOpacityValues),q.setUniform1fv("u_vvOpacities",d.vvOpacities));f.drawElements(4,
k,5125,4*e);f.bindVAO(null)}};d.prototype._initialize=function(){if(this._isInitialized)return!0;this._fillVertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:24,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:24,normalized:!0,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_aux",count:4,type:5121,offset:20,stride:24,normalized:!1,
divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};this._fillVertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:32,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:32,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:32,normalized:!0,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:12,stride:32,normalized:!1,divisor:0},{name:"a_aux",count:4,type:5121,offset:20,stride:32,
normalized:!1,divisor:0},{name:"a_vv",count:2,type:5126,offset:24,stride:32,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};this._isInitialized=!0};d.prototype._getVAO=function(a,b,g){if(b.fillGeometry.vao)return b.fillGeometry.vao;var d=b.fillGeometry.vertexBufferMap[c.C_VBO_GEOMETRY],l=b.fillGeometry.vertexBufferMap[c.C_VBO_VISIBILITY],k=b.fillGeometry.indexBuffer;if(!d||!k)return null;b.fillGeometry.vao=g?new h(a,f.fill.attributes,
this._fillVertexAttributeLayoutVV,{geometry:d,visibility:l},k):new h(a,f.fill.attributes,this._fillVertexAttributeLayout,{geometry:d,visibility:l},k);return b.fillGeometry.vao};return d}(d.default);e.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrush":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","./WGLBrush","../util/iterator"],function(n,e,a,b,c){Object.defineProperty(e,"__esModule",{value:!0});n=function(b){function f(){return null!==b&&b.apply(this,
arguments)||this}a(f,b);f.prototype.draw=function(a,b){var f=this;if(b.canDisplay){var g=this.getGeometryType(),d=b.getDisplayList(a.drawPhase),h=b.getGeometry(g);h&&c.forEachIter(d.ofType(g),function(c){return f.drawGeometry(a,b,c,h)})}};return f}(b.default);e.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLabel":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f,h){Object.defineProperty(e,"__esModule",{value:!0});n=function(g){function d(){var a=null!==g&&g.apply(this,arguments)||this;a._vertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:20,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:8,stride:20,normalized:!1,divisor:0},{name:"a_texAndSize",count:4,type:5121,offset:12,stride:20,normalized:!1,divisor:0},
{name:"a_refSymbolAndPlacementOffset",count:4,type:5120,offset:16,stride:20,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}],visibilityRange:[{name:"a_visibilityRange",count:2,type:5121,offset:0,stride:2,normalized:!1,divisor:0}]};a._glyphsTextureSize=new Float32Array(2);return a}a(d,g);d.prototype.dispose=function(){};d.prototype.drawGeometry=function(a,c,f,g){if(a.requiredLevel===c.key.level){g=a.context;var d=a.painter,h=a.drawPhase,
l=f.materialInfo,k=f.indexCount;f=f.indexFrom;var e=a.drawPhase===b.WGLDrawPhase.LABEL_ALPHA,m=l.materialKey;e&&(m|=8);if(h=d.materialManager.getProgram(m,h))g.setStencilTestEnabled(!1),g.bindProgram(h),m=this._getVAO(g,c),g.bindVAO(m),e?(g.setBlendingEnabled(!1),h.setUniform1f("u_fadeStep",a.labelStep)):(l=l.texBindingInfo[0],d.textureManager.bindGlyphsPage(g,l.pageId,l.unit),h.setUniform1i(l.semantic,l.unit)),l=d.textureManager.glyphs,this._glyphsTextureSize[0]=l.width/4,this._glyphsTextureSize[1]=
l.height/4,d=d.extrudeNoRotationMatrix,g.bindTexture(a.labelFBO.colorTexture,3),h.setUniform1i("u_referenceTex",3),h.setUniformMatrix4fv("u_transformMatrix",c.tileTransform.transform),h.setUniformMatrix4fv("u_extrudeMatrix",d),h.setUniform2fv("u_normalized_origin",c.tileTransform.displayCoord),h.setUniform2fv("u_mosaicSize",this._glyphsTextureSize),h.setUniform1f("u_pixelRatio",a.pixelRatio),h.setUniform1f("u_opacity",1),h.setUniform1f("u_zoomLevel",10*a.displayLevel),h.setUniform1f("u_mapRotation",
a.state.rotation),h.setUniform1f("u_mapAligned",0),h.setUniform2fv("u_screenSize",a.state.size),g.drawElements(4,k,5125,4*f),g.bindVAO(null),g.setStencilTestEnabled(!0),g.setBlendingEnabled(!0)}};d.prototype.getGeometryType=function(){return b.WGLGeometryType.LABEL};d.prototype._getVAO=function(a,b){if((b=b.labelGeometry)&&b.vao)return b.vao;var g=b.vertexBufferMap[c.C_VBO_GEOMETRY],d=b.vertexBufferMap[c.C_VBO_VISIBILITY_RANGE],l=b.indexBuffer;if(!g||!l||!d)return null;b.vao=new h(a,f.label.attributes,
this._vertexAttributeLayout,{geometry:g,visibility:b.vertexBufferMap[c.C_VBO_VISIBILITY],visibilityRange:d},l);return b.vao};return d}(d.default);e.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushLine":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),function(n,e,a,b,c,d,f,h){Object.defineProperty(e,"__esModule",{value:!0});n=function(g){function d(){var a=
null!==g&&g.apply(this,arguments)||this;a._lineVertexAttributeLayout={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:32,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:32,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:32,normalized:!0,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:12,stride:32,normalized:!1,divisor:0},{name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123,offset:16,stride:32,normalized:!1,divisor:0},
{name:"a_tlbr",count:4,type:5123,offset:20,stride:32,normalized:!1,divisor:0},{name:"a_segmentDirection",count:4,type:5120,offset:28,stride:32,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._lineVertexAttributeLayoutVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:44,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:44,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:44,
normalized:!0,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:12,stride:44,normalized:!1,divisor:0},{name:"a_accumulatedDistanceAndHalfWidth",count:2,type:5123,offset:16,stride:44,normalized:!1,divisor:0},{name:"a_tlbr",count:4,type:5123,offset:20,stride:44,normalized:!1,divisor:0},{name:"a_segmentDirection",count:4,type:5120,offset:28,stride:44,normalized:!1,divisor:0},{name:"a_vv",count:3,type:5126,offset:32,stride:44,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,
type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._spritesTextureSize=new Float32Array(2);return a}a(d,g);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return b.WGLGeometryType.LINE};d.prototype.drawGeometry=function(a,b,c,f){f=a.context;var g=a.painter,d=a.rendererInfo,h=a.requiredLevel,l=c.indexFrom,k=c.indexCount,e=c.materialInfo;c=e.materialKeyInfo;var m=g.materialManager.getProgram(e.materialKey,a.drawPhase);if(m){f.bindProgram(m);var q=this._getVAO(f,b,c.hasVV());
f.bindVAO(q);q=1/a.pixelRatio;if(0<e.texBindingInfo.length){var e=e.texBindingInfo[0],v=e.pageId,n=g.textureManager.sprites;this._spritesTextureSize[0]=n.getWidth(v);this._spritesTextureSize[1]=n.getHeight(v);g.textureManager.bindSpritePage(f,v,e.unit);m.setUniform1i(e.semantic,e.unit);m.setUniform2fv("u_mosaicSize",this._spritesTextureSize)}a=Math.pow(2,h-b.key.level)/a.pixelRatio;m.setUniform1f("u_zoomFactor",a);m.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform);m.setUniformMatrix4fv("u_extrudeMatrix",
g.extrudeMatrix);m.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord);m.setUniform1f("u_opacity",1);m.setUniform1f("u_blur",0+q);m.setUniform1f("u_antialiasing",q);m.setUniform1f("u_zoomFactor",a);c.vvSizeMinMaxValue&&m.setUniform4fv("u_vvSizeMinMaxValue",d.vvSizeMinMaxValue);c.vvSizeScaleStops&&m.setUniform1f("u_vvSizeScaleStopsValue",d.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(m.setUniform1fv("u_vvSizeFieldStopsValues",d.vvSizeFieldStopsValues),m.setUniform1fv("u_vvSizeFieldStopsSizes",
d.vvSizeFieldStopsSizes));c.vvSizeUnitValue&&m.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",d.vvSizeUnitValueToPixelsRatio);c.vvColor&&(m.setUniform1fv("u_vvColorValues",d.vvColorValues),m.setUniform4fv("u_vvColors",d.vvColors));c.vvOpacity&&(m.setUniform1fv("u_vvOpacityValues",d.vvOpacityValues),m.setUniform1fv("u_vvOpacities",d.vvOpacities));f.setFaceCullingEnabled(!0);f.setFrontFace(2305);f.setCullFace(1029);f.drawElements(4,k,5125,4*l);f.setFaceCullingEnabled(!1);f.bindVAO(null)}};d.prototype._getVAO=
function(a,b,g){if(b.lineGeometry.vao)return b.lineGeometry.vao;var d=b.lineGeometry.vertexBufferMap[c.C_VBO_GEOMETRY],l=b.lineGeometry.vertexBufferMap[c.C_VBO_VISIBILITY],k=b.lineGeometry.indexBuffer;if(!d||!k)return null;b.lineGeometry.vao=g?new h(a,f.line.attributes,this._lineVertexAttributeLayoutVV,{geometry:d,visibility:l},k):new h(a,f.line.attributes,this._lineVertexAttributeLayout,{geometry:d,visibility:l},k);return b.lineGeometry.vao};return d}(d.default);e.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushMarker":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/Texture ../../../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f,h,g){Object.defineProperty(e,"__esModule",{value:!0});n=function(d){function l(){var a=null!==d&&d.apply(this,arguments)||this;a._iconVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffsetAndTex",count:4,type:5120,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:8,stride:24,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:24,normalized:!0,divisor:0},
{name:"a_outlineColor",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_sizeAndOutlineWidth",count:4,type:5121,offset:20,stride:24,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._iconVertexAttributesWithVV={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:40,normalized:!1,divisor:0},{name:"a_vertexOffsetAndTex",count:4,type:5120,offset:4,stride:40,normalized:!1,divisor:0},{name:"a_id",count:4,
type:5121,offset:8,stride:40,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:40,normalized:!0,divisor:0},{name:"a_outlineColor",count:4,type:5121,offset:16,stride:40,normalized:!0,divisor:0},{name:"a_sizeAndOutlineWidth",count:4,type:5121,offset:20,stride:40,normalized:!1,divisor:0},{name:"a_vv",count:4,type:5126,offset:24,stride:40,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._iconVertexAttributesWithHeatmap=
{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:28,normalized:!1,divisor:0},{name:"a_vertexOffsetAndTex",count:4,type:5120,offset:4,stride:28,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:8,stride:28,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:28,normalized:!0,divisor:0},{name:"a_outlineColor",count:4,type:5121,offset:16,stride:28,normalized:!0,divisor:0},{name:"a_sizeAndOutlineWidth",count:4,type:5121,offset:20,stride:28,normalized:!1,divisor:0},
{name:"a_weight",count:1,type:5126,offset:24,stride:28,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._spritesTextureSize=new Float32Array(2);return a}a(l,d);l.prototype.dispose=function(){};l.prototype.getGeometryType=function(){return b.WGLGeometryType.MARKER};l.prototype.drawGeometry=function(a,b,c,f){f=a.context;var g=a.painter,d=a.rendererInfo,h=c.indexCount,l=c.indexFrom,k=c.materialInfo;c=k.materialKeyInfo;var e=c.heatmap;
if(a=g.materialManager.getProgram(k.materialKey,a.drawPhase)){f.bindProgram(a);var m=this._getVAO(f,b,c.hasVV(),e);f.bindVAO(m);e?(k=this._getIntensityTexture(f,d.heatmapParameters),f.bindTexture(k,1),a.setUniform1i("u_texture",1),this._spritesTextureSize[0]=Math.round(d.heatmapParameters.radius),this._spritesTextureSize[1]=Math.round(d.heatmapParameters.radius)):(e=k.texBindingInfo[0],k=e.pageId,g.textureManager.bindSpritePage(f,k,e.unit),a.setUniform1i(e.semantic,e.unit),e=g.textureManager.sprites,
this._spritesTextureSize[0]=e.getWidth(k)/4,this._spritesTextureSize[1]=e.getHeight(k)/4);g=d.vvMaterialParameters.vvRotationEnabled&&"geographic"===d.vvMaterialParameters.vvRotationType?g.extrudeMatrix:g.extrudeNoRotationMatrix;a.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform);a.setUniformMatrix4fv("u_extrudeMatrix",g);a.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord);a.setUniform2fv("u_mosaicSize",this._spritesTextureSize);a.setUniform1f("u_opacity",1);c.vvSizeMinMaxValue&&
a.setUniform4fv("u_vvSizeMinMaxValue",d.vvSizeMinMaxValue);c.vvSizeScaleStops&&a.setUniform1f("u_vvSizeScaleStopsValue",d.vvSizeScaleStopsValue);c.vvSizeFieldStops&&(a.setUniform1fv("u_vvSizeFieldStopsValues",d.vvSizeFieldStopsValues),a.setUniform1fv("u_vvSizeFieldStopsSizes",d.vvSizeFieldStopsSizes));c.vvSizeUnitValue&&a.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",d.vvSizeUnitValueToPixelsRatio);c.vvColor&&(a.setUniform1fv("u_vvColorValues",d.vvColorValues),a.setUniform4fv("u_vvColors",d.vvColors));
c.vvOpacity&&(a.setUniform1fv("u_vvOpacityValues",d.vvOpacityValues),a.setUniform1fv("u_vvOpacities",d.vvOpacities));c.vvRotation&&a.setUniform1f("u_vvRotationType","geographic"===d.vvMaterialParameters.vvRotationType?0:1);f.drawElements(4,h,5125,4*l);f.bindVAO(null)}};l.prototype._getVAO=function(a,b,d,h){if(b.iconGeometry.vao)return b.iconGeometry.vao;var l=b.iconGeometry.vertexBufferMap[c.C_VBO_GEOMETRY],k=b.iconGeometry.vertexBufferMap[c.C_VBO_VISIBILITY],e=b.iconGeometry.indexBuffer;if(!l||!e)return null;
b.iconGeometry.vao=d?new g(a,f.icon.attributes,this._iconVertexAttributesWithVV,{geometry:l,visibility:k},e):h?new g(a,f.icon.attributes,this._iconVertexAttributesWithHeatmap,{geometry:l,visibility:k},e):new g(a,f.icon.attributes,this._iconVertexAttributes,{geometry:l,visibility:k},e);return b.iconGeometry.vao};l.prototype._getIntensityTexture=function(a,b){if(b.intensityKernel&&!b.refreshIntensityKernel)return b.intensityKernel;b.intensityKernel&&(b.intensityKernel.dispose(),b.intensityKernel=null);
for(var c=b.radius,f=b.kernelSize,g=b.blurRadius,d=c*c,l=[],k=-1;++k<f;)l[k]=Math.exp(-Math.pow(k-g,2)/(2*d))/(c/2*Math.sqrt(2*Math.PI));for(var c=[],e,m=0;m<f;m++)for(d=l[m],k=0;k<f;k++)e=m*f+k,g=l[k],c[4*e+0]=d*g,c[4*e+1]=0,c[4*e+2]=0,c[4*e+3]=1;a=new h(a,{target:3553,pixelFormat:6408,internalFormat:a.capabilities.colorBufferFloat.RGBA32F,dataType:5126,samplingMode:a.capabilities.textureFloatLinear?9729:9728,wrapMode:33071,width:f,height:f},new Float32Array(c));b.intensityKernel=a;b.refreshIntensityKernel=
!1;return a};return l}(d.default);e.default=n})},"esri/views/2d/engine/webgl/brushes/WGLGeometryBrushText":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../enums ../Utils ./WGLGeometryBrush ../shaders/MaterialPrograms ../../../../webgl/VertexArrayObject".split(" "),function(n,e,a,b,c,d,f,h){Object.defineProperty(e,"__esModule",{value:!0});n=function(g){function d(){var a=null!==g&&g.apply(this,arguments)||this;a._vertexAttributeLayout={geometry:[{name:"a_pos",count:2,
type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:20,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:20,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:12,stride:20,normalized:!1,divisor:0},{name:"a_texFontSize",count:4,type:5120,offset:16,stride:20,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._vertexAttributeLayoutVV={geometry:[{name:"a_pos",
count:2,type:5122,offset:0,stride:36,normalized:!1,divisor:0},{name:"a_id",count:4,type:5121,offset:4,stride:36,normalized:!0,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:36,normalized:!0,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:12,stride:36,normalized:!1,divisor:0},{name:"a_texFontSize",count:4,type:5120,offset:16,stride:36,normalized:!1,divisor:0},{name:"a_vv",count:4,type:5126,offset:20,stride:36,normalized:!1,divisor:0}],visibility:[{name:"a_visible",count:1,
type:5121,offset:0,stride:1,normalized:!0,divisor:0}]};a._glyphsTextureSize=new Float32Array(2);return a}a(d,g);d.prototype.dispose=function(){};d.prototype.getGeometryType=function(){return b.WGLGeometryType.TEXT};d.prototype.drawGeometry=function(a,b,c,f){f=a.context;var g=a.painter,d=a.rendererInfo,h=c.materialInfo,l=c.indexCount;c=c.indexFrom;var k=h.materialKeyInfo,e=k.vvSizeMinMaxValue||k.vvSizeScaleStops||k.vvSizeFieldStops||k.vvSizeUnitValue||k.vvColor||k.vvRotation||k.vvOpacity;if(a=g.materialManager.getProgram(h.materialKey,
a.drawPhase))f.bindProgram(a),e=this._getVAO(f,b,e,this.getGeometryType()),f.bindVAO(e),h=h.texBindingInfo[0],g.textureManager.bindGlyphsPage(f,h.pageId,h.unit),a.setUniform1i(h.semantic,h.unit),h=g.textureManager.glyphs,this._glyphsTextureSize[0]=h.width/4,this._glyphsTextureSize[1]=h.height/4,g=d.vvMaterialParameters.vvRotationEnabled&&"geographic"===d.vvMaterialParameters.vvRotationType?g.extrudeMatrix:g.extrudeNoRotationMatrix,a.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform),
a.setUniformMatrix4fv("u_extrudeMatrix",g),a.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord),a.setUniform2fv("u_mosaicSize",this._glyphsTextureSize),a.setUniform1f("u_pixelRatio",1),a.setUniform1f("u_opacity",1),k.vvSizeMinMaxValue&&a.setUniform4fv("u_vvSizeMinMaxValue",d.vvSizeMinMaxValue),k.vvSizeScaleStops&&a.setUniform1f("u_vvSizeScaleStopsValue",d.vvSizeScaleStopsValue),k.vvSizeFieldStops&&(a.setUniform1fv("u_vvSizeFieldStopsValues",d.vvSizeFieldStopsValues),a.setUniform1fv("u_vvSizeFieldStopsSizes",
d.vvSizeFieldStopsSizes)),k.vvSizeUnitValue&&a.setUniform1f("u_vvSizeUnitValueWorldToPixelsRatio",d.vvSizeUnitValueToPixelsRatio),k.vvColor&&(a.setUniform1fv("u_vvColorValues",d.vvColorValues),a.setUniform4fv("u_vvColors",d.vvColors)),k.vvOpacity&&(a.setUniform1fv("u_vvOpacityValues",d.vvOpacityValues),a.setUniform1fv("u_vvOpacities",d.vvOpacities)),k.vvRotation&&a.setUniform1f("u_vvRotationType","geographic"===d.vvMaterialParameters.vvRotationType?0:1),f.drawElements(4,l,5125,4*c),f.bindVAO(null)};
d.prototype._getVAO=function(a,b,g,d){if((b=b.getGeometry(d))&&b.vao)return b.vao;d=b.vertexBufferMap[c.C_VBO_GEOMETRY];var l=b.vertexBufferMap[c.C_VBO_VISIBILITY],k=b.indexBuffer;if(!d||!k)return null;b.vao=g?new h(a,f.text.attributes,this._vertexAttributeLayoutVV,{geometry:d,visibility:l},k):new h(a,f.text.attributes,this._vertexAttributeLayout,{geometry:d,visibility:l},k);return b.vao};return d}(d.default);e.default=n})},"esri/views/2d/engine/webgl/painter/WGLHighlightPainter":function(){define(["require",
"exports","../../../../../core/has","./highlight/HighlightRenderer","./highlight/HighlightSurfaces"],function(n,e,a,b,c){return function(){function d(){this._hlRenderer=new b;this._hlSurfaces=new c;this._adjustedHeight=this._adjustedWidth=this._height=this._width=void 0}d.prototype.dispose=function(){this._hlSurfaces&&this._hlSurfaces.dispose();this._hlRenderer&&this._hlRenderer.dispose();this._boundFBO=null};d.prototype.setup=function(a,b,c){this._width=b;this._height=c;var f=b%4,g=c%4;b+=2>f?-f:
4-f;c+=2>g?-g:4-g;this._adjustedWidth=b;this._adjustedHeight=c;this._boundFBO=a.getBoundFramebufferObject();b=Math.round(.75*b);c=Math.round(.75*c);this._hlRenderer.setup(a,b,c);this._hlSurfaces.setup(a,b,c)};d.prototype.setHighlightOptions=function(a){this._hlRenderer.setHighlightOptions({fillColor:a.fillColor,outlineColor:a.outlineColor,outlineWidth:.75*a.outlineWidth,outerHaloWidth:.75*a.outerHaloWidth,innerHaloWidth:.75*a.innerHaloWidth,outlinePosition:.75*a.outlinePosition})};d.prototype.startMaskDraw=
function(a){a.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo);a.setClearColor(0,0,0,0);a.setClearStencil(0);a.clear(a.gl.COLOR_BUFFER_BIT|a.gl.STENCIL_BUFFER_BIT);a.setViewport(0,0,.75*this._adjustedWidth,.75*this._adjustedHeight)};d.prototype.draw=function(b){b.setStencilTestEnabled(!1);b.setBlendingEnabled(!1);b.bindFramebuffer(this._hlSurfaces.sharedBlur2Fbo);b.setClearColor(0,0,0,0);b.clear(b.gl.COLOR_BUFFER_BIT);this._hlRenderer.preBlur(b,this._hlSurfaces.sharedBlur1Tex);a("esri-feature-highlight-debug")?
(b.bindFramebuffer(null),b.clear(b.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(b,this._hlSurfaces.sharedBlur2Tex)):(b.bindFramebuffer(this._hlSurfaces.sharedBlur1Fbo),b.setClearColor(0,0,0,0),b.clear(b.gl.COLOR_BUFFER_BIT),this._hlRenderer.finalBlur(b,this._hlSurfaces.sharedBlur2Tex),b.bindFramebuffer(this._boundFBO),b.setBlendingEnabled(!0),b.setViewport(0,0,this._width,this._height),this._hlRenderer.renderHighlight(b,this._hlSurfaces.sharedBlur1Tex),this._boundFBO=null)};return d}()})},"esri/views/2d/engine/webgl/painter/highlight/HighlightRenderer":function(){define("require exports ../../shaders/HighlightPrograms ../../../../../webgl/BufferObject ../../../../../webgl/programUtils ../../../../../webgl/Texture ../../../../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f){var h=[void 0,void 0,void 0,1],g=[3,4],l=[0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1],m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return function(){function k(){this._height=this._width=void 0;this._highlightOptions={fillColor:[.2,.6,.9,.75],outlineColor:[.2,.6,.9,.9],outlinePosition:0,outlineWidth:3.4,innerHaloWidth:2,outerHaloWidth:3.3};this._resources=null}k.prototype.dispose=function(){this._resources&&(this._resources.quadGeometry.dispose(),this._resources.quadVAO.dispose(),this._resources.highlightProgram.dispose(),
this._resources.blurProgram.dispose(),this._resources.shadeTex.dispose(),this._resources=null)};k.prototype.preBlur=function(a,b){a.bindTexture(b,g[0]);a.bindProgram(this._resources.blurProgram);this._resources.blurProgram.setUniform4fv("u_direction",[1,0,1/this._width,0]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",l);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};k.prototype.finalBlur=function(a,b){a.bindTexture(b,g[0]);a.bindProgram(this._resources.blurProgram);
this._resources.blurProgram.setUniform4fv("u_direction",[0,1,0,1/this._height]);this._resources.blurProgram.setUniformMatrix4fv("u_channelSelector",m);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};k.prototype.renderHighlight=function(a,b){a.bindTexture(b,g[0]);a.bindTexture(this._resources.shadeTex,g[1]);a.bindProgram(this._resources.highlightProgram);a.bindVAO(this._resources.quadVAO);a.drawArrays(5,0,4);a.bindVAO()};k.prototype._initialize=function(l,k,e){this._width=k;this._height=
e;k=new b(l,34962,35044,(new Int8Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1])).buffer);e=new f(l,{a_position:0,a_texcoord:1},{geometry:[{name:"a_position",count:2,type:5120,offset:0,stride:4,normalized:!1},{name:"a_texcoord",count:2,type:5121,offset:2,stride:4,normalized:!1}]},{geometry:k});var m=c.createProgram(l,a.highlight),p=c.createProgram(l,a.blur);m.setUniform1i("u_texture",g[0]);m.setUniform1i("u_shade",g[1]);m.setUniform4fv("u_sigmas",h);p.setUniform1i("u_texture",g[0]);p.setUniform4fv("u_sigmas",
h);l=new d(l,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:256,height:1,samplingMode:9728});this._resources={quadGeometry:k,quadVAO:e,highlightProgram:m,blurProgram:p,shadeTex:l}};k.prototype.setHighlightOptions=function(a){function b(a,b,c){e[0]=(1-c)*a[0]+c*b[0];e[1]=(1-c)*a[1]+c*b[1];e[2]=(1-c)*a[2]+c*b[2];e[3]=(1-c)*a[3]+c*b[3]}this._highlightOptions=a;if(this._resources){var c=a.outlinePosition-a.outlineWidth/2-a.outerHaloWidth,g=a.outlinePosition-a.outlineWidth/2,f=a.outlinePosition+
a.outlineWidth/2,d=a.outlinePosition+a.outlineWidth/2+a.innerHaloWidth,l=Math.sqrt(Math.PI/2)*h[3],k=Math.abs(c)>l?Math.round(10*(Math.abs(c)-l))/10:0,l=Math.abs(d)>l?Math.round(10*(Math.abs(d)-l))/10:0;k&&!l?console.warn("The outer rim of the highlight is "+k+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards positive values (inwards)."):!k&&l?console.warn("The inner rim of the highlight is "+l+"px away from the edge of the feature; consider reducing some width values or shifting the outline position towards negative values (outwards)."):
k&&l&&console.warn("The highlight is "+Math.max(k,l)+"px away from the edge of the feature; consider reducing some width values.");for(var k=new Uint8Array(1024),e=[void 0,void 0,void 0,void 0],m=0;256>m;++m)l=c+m/255*(d-c),l<c?(k[4*m+0]=0,k[4*m+1]=0,k[4*m+2]=0,k[4*m+3]=0):l<g?b([0,0,0,0],a.outlineColor,(l-c)/(g-c)):l<f?(e[0]=a.outlineColor[0],e[1]=a.outlineColor[1],e[2]=a.outlineColor[2],e[3]=a.outlineColor[3]):l<d?b(a.outlineColor,a.fillColor,(l-f)/(d-f)):(k[4*m+0]=a.fillColor[0],k[4*m+1]=a.fillColor[1],
k[4*m+2]=a.fillColor[2],k[4*m+3]=a.fillColor[3]),k[4*m+0]=255*e[0]*e[3],k[4*m+1]=255*e[1]*e[3],k[4*m+2]=255*e[2]*e[3],k[4*m+3]=255*e[3];this._resources.highlightProgram.setUniform2fv("u_minMaxDistance",[c,d]);this._resources.shadeTex.updateData(0,0,0,256,1,k)}};k.prototype.setup=function(a,b,c){this._resources?(this._width=b,this._height=c):(this._initialize(a,b,c),this.setHighlightOptions(this._highlightOptions))};return k}()})},"esri/views/2d/engine/webgl/shaders/HighlightPrograms":function(){define(["require",
"exports","./sources/resolver"],function(n,e,a){Object.defineProperty(e,"__esModule",{value:!0});e.highlight={name:"highlight",shaders:{vertexShader:a.resolveIncludes("highlight/textured.vert"),fragmentShader:a.resolveIncludes("highlight/highlight.frag")},attributes:{a_position:0,a_texcoord:1}};e.blur={name:"blur",shaders:{vertexShader:a.resolveIncludes("highlight/textured.vert"),fragmentShader:a.resolveIncludes("highlight/blur.frag")},attributes:{a_position:0,a_texcoord:1}}})},"esri/views/2d/engine/webgl/painter/highlight/HighlightSurfaces":function(){define(["require",
"exports","../../../../../webgl/FramebufferObject","../../../../../webgl/Texture"],function(n,e,a,b){function c(c,f,h){f=new b(c,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,width:f,height:h,samplingMode:9729});c=a.createWithAttachments(c,f,{colorTarget:0,depthStencilTarget:2});return[f,c]}return function(){function a(){this._height=this._width=void 0;this._resources=null}a.prototype.dispose=function(){this._resources&&(this._resources.sharedBlur1Tex.dispose(),this._resources.sharedBlur1Fbo.dispose(),
this._resources.sharedBlur2Tex.dispose(),this._resources.sharedBlur2Fbo.dispose(),this._resources=null)};a.prototype._initialize=function(a,b,g){this._width=b;this._height=g;var f=c(a,b,g),d=f[0],f=f[1];a=c(a,b,g);this._resources={sharedBlur1Tex:d,sharedBlur1Fbo:f,sharedBlur2Tex:a[0],sharedBlur2Fbo:a[1]}};a.prototype.setup=function(a,b,c){!this._resources||this._width===b&&this._height===c||this.dispose();this._resources||this._initialize(a,b,c)};Object.defineProperty(a.prototype,"sharedBlur1Tex",
{get:function(){return this._resources.sharedBlur1Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur1Fbo",{get:function(){return this._resources.sharedBlur1Fbo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Tex",{get:function(){return this._resources.sharedBlur2Tex},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"sharedBlur2Fbo",{get:function(){return this._resources.sharedBlur2Fbo},enumerable:!0,configurable:!0});
return a}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],function(n,e,a,b,c){return function(){function a(f,d,g,l){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=f;this._desc={colorTarget:d.colorTarget,depthStencilTarget:d.depthStencilTarget,width:d.width,height:d.height,multisampled:d.multisampled};this._id=a._nextId++;g&&(f=void 0,
g instanceof c?(this._colorAttachment=g,f=g.descriptor):(f=g,this._colorAttachment=new c(this._context,f)),0!==this._desc.colorTarget&&console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),a._validateTextureDimensions(f,this._desc));l instanceof b?(2===d.depthStencilTarget?this._stencilAttachment=l:1===d.depthStencilTarget||3===d.depthStencilTarget?this._depthAttachment=l:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),
a._validateBufferDimensions(l.descriptor,this._desc)):l&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),d=void 0,l instanceof c?(this._depthStencilTexture=l,d=this._depthStencilTexture.descriptor):(d=l,this._depthStencilTexture=new c(this._context,d)),a._validateTextureDimensions(d,this._desc))}a.create=function(b,c){return new a(b,c)};a.createWithAttachments=function(b,
c,g,d){return new a(b,g,c,d)};Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof c?this._colorAttachment:null},enumerable:!0,
configurable:!0});Object.defineProperty(a.prototype,"depthStencilTexture",{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});a.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),
this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=null),this._context=null)};a.prototype.attachColorTexture=function(b){if(b){a._validateTextureDimensions(b.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,b.glName,0)}this._colorAttachment=b}};a.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof
c){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};a.prototype.attachDepthStencilTexture=function(b){if(b){var c=b.descriptor;34041!==c.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==c.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");
this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");a._validateTextureDimensions(c,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,b.glName,0));this._depthStencilTexture=
b}};a.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};a.prototype.attachDepthStencilBuffer=function(b){if(b){var c=b.descriptor;34041!==c.internalFormat&&33189!==c.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");
a._validateBufferDimensions(c,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===c.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,b.glName));this._depthAttachment=b}};a.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,b=this._depthAttachment;b&&this._initialized&&
(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=null;return b};a.prototype.copyToTexture=function(a,b,c,d,e,k,v){(0>a||0>b||0>e||0>k)&&console.error("Offsets cannot be negative!");(0>=c||0>=d)&&console.error("Copy width and height must be greater than zero!");var g=this._desc,f=v.descriptor;3553!==v.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");
(a+c>g.width||b+d>g.height||e+c>f.width||k+d>f.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");g=this._context;g.bindTexture(v);g.bindFramebuffer(this);g.gl.copyTexSubImage2D(3553,0,e,k,a,b,c,d)};a.prototype.readPixels=function(a,b,c,d,e,k,v){(0>=c||0>=d)&&console.error("Copy width and height must be greater than zero!");v||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,
b,c,d,e,k,v)};a.prototype.resize=function(b,d){var g=this._desc;if(g.width!==b||g.height!==d)if(this._initialized)g.width=b,g.height=d,this._colorAttachment instanceof c?(f=this._colorAttachment,g=f.descriptor,g.width=b,g.height=d,this._colorAttachment.dispose(),this._colorAttachment=new c(this._context,g),a._validateTextureDimensions(f.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(g=this._depthStencilTexture.descriptor,g.width=b,g.height=
d,this._depthStencilTexture.dispose(),this._depthStencilTexture=new c(this._context,g)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null),this._initialized=!1;else{g.width=b;g.height=d;if(this._colorAttachment instanceof c){var f=this._colorAttachment;f.resize(b,d)}this._depthStencilTexture&&this._depthStencilTexture.resize(b,d)}};a.prototype.initialize=function(){if(this._initialized)return!1;
var a=this._context.gl;this._glName&&a.deleteFramebuffer(this._glName);var d=a.createFramebuffer(),g=this._desc;a.bindFramebuffer(a.FRAMEBUFFER,d);if(!this._colorAttachment)if(0===g.colorTarget)this._colorAttachment=new c(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:g.width,height:g.height});else{var l=new b(this._context,{internalFormat:32854,width:g.width,height:g.height});a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,
l.glName);this._colorAttachment=l}this._colorAttachment instanceof c&&a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,this._colorAttachment.glName,0);switch(g.depthStencilTarget){case 1:case 3:this._depthAttachment||(this._depthAttachment=new b(this._context,{internalFormat:1===g.depthStencilTarget?33189:34041,width:g.width,height:g.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,1===g.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthAttachment.glName);
break;case 2:this._stencilAttachment||(this._stencilAttachment=new b(this._context,{internalFormat:36168,width:g.width,height:g.height}));a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._stencilAttachment.glName);break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new c(this._context,
{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:g.width,height:g.height})),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,this._depthStencilTexture.glName,0)}a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=d;return this._initialized=!0};a.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof c){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);
var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,b=this._context.gl,this._initialized&&(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};a.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&
(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&
(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};a._validateBufferDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};
a._validateTextureDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Color attachment texture must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};a._nextId=0;return a}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(n,e,a){return function(){function a(b,
d){this._context=b;this._desc=d;this._glName=null;this._id=-1;b=this._context.gl;this._id=++a._nextId;this._glName=b.createRenderbuffer();this._context.bindRenderbuffer(this);b.renderbufferStorage(b.RENDERBUFFER,d.internalFormat,d.width,d.height)}Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",
{get:function(){return this._glName},enumerable:!0,configurable:!0});a.prototype.resize=function(a,b){var c=this._context.gl,d=this._desc;if(d.width!==a||d.height!==b)d.width=a,d.height=b,this._context.bindRenderbuffer(this),c.renderbufferStorage(c.RENDERBUFFER,d.internalFormat,d.width,d.height)};a.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=null};a._nextId=0;return a}()})},"esri/views/2d/engine/webgl/shaders/StencilPrograms":function(){define(["require",
"exports","./sources/resolver"],function(n,e,a){Object.defineProperty(e,"__esModule",{value:!0});e.stencil={name:"stencil",shaders:{vertexShader:a.resolveIncludes("stencil/stencil.vert"),fragmentShader:a.resolveIncludes("stencil/stencil.frag")},attributes:{a_pos:0}}})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(n,e,a,b,c,d,f){return function(){function a(a,b){this.gl=
null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};
this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap=
{};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=d.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=f.loadCapabilities(a,b);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};this.enforceState()}Object.defineProperty(a.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});
a.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};a.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._blendEnabled=a)};a.prototype.setBlendColor=function(a,b,c,d){if(a!==this._blendColorState.r||b!==this._blendColorState.g||c!==this._blendColorState.b||d!==this._blendColorState.a)this.gl.blendColor(a,b,c,d),this._blendColorState.r=
a,this._blendColorState.g=b,this._blendColorState.b=c,this._blendColorState.a=d};a.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b};a.prototype.setBlendFunctionSeparate=function(a,b,c,d){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==c||this._blendFunctionState.dstRGB!==
b||this._blendFunctionState.dstAlpha!==d)this.gl.blendFuncSeparate(a,b,c,d),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=c,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=d};a.prototype.setBlendEquation=function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a)};a.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==
b)this.gl.blendEquationSeparate(a,b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b};a.prototype.setColorMask=function(a,b,c,d){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==c||this._colorMaskState.a!==d)this.gl.colorMask(a,b,c,d),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=c,this._colorMaskState.a=d};a.prototype.setClearColor=function(a,b,c,d){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==
c||this._clearColor.a!==d)this.gl.clearColor(a,b,c,d),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=c,this._clearColor.a=d};a.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a)};a.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),
this._polygonOffsetFillEnabled=a)};a.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b)};a.prototype.setCullFace=function(a){this._cullFace!==a&&(this.gl.cullFace(a),this._cullFace=a)};a.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a)};a.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):
this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};a.prototype.setScissorRect=function(a,b,c,d){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==c||this._scissorRect.height!==d)this.gl.scissor(a,b,c,d),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=c,this._scissorRect.height=d};a.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=
a)};a.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};a.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a)};a.prototype.setDepthWriteEnabled=function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a)};a.prototype.setDepthRange=function(a,b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=
b};a.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a)};a.prototype.setClearStencil=function(a){a!==this._clearStencil&&(this.gl.clearStencil(a),this._clearStencil=a)};a.prototype.setStencilFunction=function(a,b,c){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==c)this.gl.stencilFunc(a,b,c),this._stencilFunction.face=
1032,this._stencilFunction.func=a,this._stencilFunction.ref=b,this._stencilFunction.mask=c};a.prototype.setStencilFunctionSeparate=function(a,b,c,d){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==c||this._stencilFunction.mask!==d)this.gl.stencilFuncSeparate(a,b,c,d),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=c,this._stencilFunction.mask=d};a.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&
(this.gl.stencilMask(a),this._stencilWriteMask=a)};a.prototype.setStencilOp=function(a,b,c){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==c)this.gl.stencilOp(a,b,c),this._stencilOperation.face=1032,this._stencilOperation.fail=a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=c};a.prototype.setStencilOpSeparate=function(a,b,c,d){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==c||this._stencilOperation.zPass!==
d)this.gl.stencilOpSeparate(a,b,c,d),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=b,this._stencilOperation.zFail=c,this._stencilOperation.zPass=d};a.prototype.setLineWidth=function(a){var b=this._lineWidth;this._lineWidth!==a&&(this.gl.lineWidth(a),this._lineWidth=a);return b};a.prototype.setActiveTexture=function(a){var c=this._activeTextureUnit;0<=a&&a!==this._activeTextureUnit&&(this.gl.activeTexture(b.BASE_TEXTURE_UNIT+a),this._activeTextureUnit=a);return c};
a.prototype.clear=function(a){a&&this.gl.clear(a)};a.prototype.drawArrays=function(a,b,c){this.gl.drawArrays(a,b,c)};a.prototype.drawElements=function(a,b,c,d){5123===c?this.gl.drawElements(a,b,c,d):5125===c&&this.gl.drawElements(a,b,c,d)};a.prototype.logIno=function(){};Object.defineProperty(a.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});a.prototype.setViewport=function(a,b,c,d){var f=this._viewport;if(f.x!==a||f.y!==b||f.width!==c||f.height!==
d)f.x=a,f.y=b,f.width=c,f.height=d,this.gl.viewport(a,b,c,d)};a.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};a.prototype.bindProgram=function(a){a?this._activeShaderProgram!==a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};a.prototype.bindTexture=function(b,c){void 0===c&&(c=0);-1===a._MAX_TEXTURE_IMAGE_UNITS&&(a._MAX_TEXTURE_IMAGE_UNITS=
this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(c>=a._MAX_TEXTURE_IMAGE_UNITS||0>c)&&console.error("Input texture unit is out of range of available units!");var d=this._textureUnitMap[c];this.setActiveTexture(c);null==b||null==b.glName?(null!=d&&(this.gl.bindTexture(d.descriptor.target,null),d.setBoundToUnit(c,!1)),this._textureUnitMap[c]=null):d&&d.id===b.id?b.applyChanges():(this.gl.bindTexture(b.descriptor.target,b.glName),b.setBoundToUnit(c,!0),b.applyChanges(),this._textureUnitMap[c]=
b)};a.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};a.prototype.bindBuffer=function(b){b&&(34962===b.bufferType?this._activeVertexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,b,b.bufferType,this._activeIndexBuffer))};a.prototype.bindRenderbuffer=
function(a){var b=this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};a.prototype.unbindBuffer=function(b){34962===b?this._activeVertexBuffer=a._bindBuffer(this.gl,null,b,this._activeVertexBuffer):this._activeIndexBuffer=a._bindBuffer(this.gl,null,b,this._activeIndexBuffer)};a.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===
a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};a.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};a.prototype.getBoundFramebufferObject=function(){return this._activeFramebuffer};a.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};a.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);
this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);
this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};a.prototype.enforceState=function(){var a=this.gl,c=this._capabilities.vao;c&&c.bindVertexArray(null);for(var d=0;d<this.parameters.maxVertexAttributes;d++)a.disableVertexAttribArray(d);
this._activeVertexBuffer?a.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):a.bindBuffer(34962,null);this._activeIndexBuffer?a.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):a.bindBuffer(34963,null);if(c&&this._activeVertexArrayObject){if(c=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(c)}a.bindFramebuffer(a.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:
null);a.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);a.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);a.bindRenderbuffer(a.RENDERBUFFER,this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?a.enable(this.gl.BLEND):a.disable(this.gl.BLEND);a.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);a.blendFuncSeparate(this._blendFunctionState.srcRGB,
this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);a.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);a.clearDepth(this._clearDepth);a.clearStencil(this._clearStencil);a.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);a.cullFace(this._cullFace);a.depthFunc(this._depthFunction);a.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?
a.enable(a.DEPTH_TEST):a.disable(a.DEPTH_TEST);a.depthMask(this._depthWriteEnabled);a.frontFace(this._frontFace);a.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?a.enable(a.CULL_FACE):a.disable(a.CULL_FACE);a.polygonOffset(this._polygonOffset[0],this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?a.enable(a.POLYGON_OFFSET_FILL):a.disable(a.POLYGON_OFFSET_FILL);a.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?
a.enable(a.SCISSOR_TEST):a.disable(a.SCISSOR_TEST);a.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);a.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,this._stencilOperation.zPass);!0===this._stencilTestEnabled?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST);a.stencilMask(this._stencilWriteMask);for(c=0;c<this.parameters.maxTextureImageUnits;c++)a.activeTexture(b.BASE_TEXTURE_UNIT+c),a.bindTexture(3553,
null),(d=this._textureUnitMap[c])&&a.bindTexture(d.descriptor.target,d.glName);a.activeTexture(b.BASE_TEXTURE_UNIT+this._activeTextureUnit);a.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};a._bindBuffer=function(a,b,c,d){if(!b)return a.bindBuffer(c,null),null;if(d===b)return d;a.bindBuffer(c,b.glName);return b};a._MAX_TEXTURE_IMAGE_UNITS=-1;return a}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(n,e){Object.defineProperty(e,
"__esModule",{value:!0});e.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(n,e){return function(){function a(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,framebufferCount:0,renderBufferCount:0}}a.prototype.incrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;
break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}};a.prototype.decrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};a.prototype.printResourceCount=function(){console.log("Live objects:");
console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return a}()})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(n,e){Object.defineProperty(e,
"__esModule",{value:!0});e.default=function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(n,e,a,b,c,d){function f(a,b,d,f,e){if(f&&c.default(a))return!0;if(b[d])return!1;for(b=0;b<e.length;b++)if(a.getExtension(e[b]))return!0;return!1}Object.defineProperty(e,"__esModule",{value:!0});e.loadCapabilities=
function(e,g){g=g&&g.disabledExtensions||{};f(e,g,"standardDerivatives",!0,["OES_standard_derivatives"]);var l=b.load(e),h=d.load(e,g),k;k=g.compressedTextureS3TC?null:(k=e.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:k.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:k.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:k.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:k.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var v;v=g.textureFilterAnisotropic?null:(v=e.getExtension("EXT_texture_filter_anisotropic")||
e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:v.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:v.TEXTURE_MAX_ANISOTROPY_EXT}:null;var q=a.load(e,g),p;if(c.default(e))p=g.colorBufferFloat||!e.getExtension("EXT_color_buffer_float")?null:{R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F};else if(e instanceof WebGLRenderingContext){p=
!g.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float");var r=!g.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float");p=p||r?{RGBA16F:p?p.RGBA16F_EXT:void 0,RGBA32F:r?r.RGBA32F_EXT:void 0}:null}else p=void 0;r=c.default(e)?{MIN:e.MIN,MAX:e.MAX}:g.blendMinMax?null:(r=e.getExtension("EXT_blend_minmax"))?{MIN:r.MIN_EXT,MAX:r.MAX_EXT}:null;return{instancing:l,vao:h,compressedTextureS3TC:k,textureFilterAnisotropic:v,disjointTimerQuery:q,colorBufferFloat:p,blendMinMax:r,depthTexture:f(e,
g,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:f(e,g,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:f(e,g,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:f(e,g,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(n,e,a){Object.defineProperty(e,"__esModule",{value:!0});
e.load=function(b,c){if(c.disjointTimerQuery)return null;var d=b.getExtension("EXT_disjoint_timer_query")||b.getExtension("EXT_disjoint_timer_query_webgl2");return d?a.default(b)?{createQuery:function(){return b.createQuery()},resultAvailable:function(a){return b.getQueryParameter(a,b.QUERY_RESULT_AVAILABLE)},getResult:function(a){return b.getQueryParameter(a,b.QUERY_RESULT)},disjoint:function(){return b.getParameter(d.GPU_DISJOINT_EXT)},beginTimeElapsed:function(a){return b.beginQuery(d.TIME_ELAPSED_EXT,
a)},endTimeElapsed:function(){return b.endQuery(d.TIME_ELAPSED_EXT)},createTimestamp:function(a){return d.queryCounterEXT(a,d.TIMESTAMP_EXT)},timestampBits:function(){return b.getQuery(d.TIMESTAMP_EXT,d.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return d.createQueryEXT()},resultAvailable:function(a){return d.getQueryObjectEXT(a,d.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return d.getQueryObjectEXT(a,d.QUERY_RESULT_EXT)},disjoint:function(){return b.getParameter(d.GPU_DISJOINT_EXT)},
beginTimeElapsed:function(a){return d.beginQueryEXT(d.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return d.endQueryEXT(d.TIME_ELAPSED_EXT)},createTimestamp:function(a){return d.queryCounterEXT(a,d.TIMESTAMP_EXT)},timestampBits:function(){return d.getQueryEXT(d.TIMESTAMP_EXT,d.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(n,e,a){Object.defineProperty(e,"__esModule",{value:!0});e.load=function(b){return a.default(b)?
{drawArraysInstanced:b.drawArraysInstanced.bind(b),drawElementsInstanced:b.drawElementsInstanced.bind(b),vertexAttribDivisor:b.vertexAttribDivisor.bind(b)}:(b=b.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:b.drawArraysInstancedANGLE.bind(b),drawElementsInstanced:b.drawElementsInstancedANGLE.bind(b),vertexAttribDivisor:b.vertexAttribDivisorANGLE.bind(b)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(n,
e,a){Object.defineProperty(e,"__esModule",{value:!0});e.load=function(b,c){return a.default(b)?{createVertexArray:b.createVertexArray.bind(b),deleteVertexArray:b.deleteVertexArray.bind(b),bindVertexArray:b.bindVertexArray.bind(b)}:c.vao?null:(b=b.getExtension("OES_vertex_array_object")||b.getExtension("MOZ_OES_vertex_array_object")||b.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:b.createVertexArrayOES.bind(b),deleteVertexArray:b.deleteVertexArrayOES.bind(b),bindVertexArray:b.bindVertexArrayOES.bind(b)}:
null}})},"esri/views/2d/tiling/TileInfoViewPOT":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../layers/support/TileInfo ./TileInfoView ./TileKey".split(" "),function(n,e,a,b,c,d,f){return function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._fullCacheLodInfos=null;a._levelByScale={};return a}a(d,b);d.prototype.getTileParentId=function(a){a=f.pool.acquire(a);var b=0===a.level?null:f.getId(a.level-1,a.row>>
1,a.col>>1,a.world);f.pool.release(a);return b};d.prototype.getTileIdAtParent=function(a,b){b=f.pool.acquire(b);var c=this._infoByLevel[b.level];if(a.resolution<c.resolution)throw f.pool.release(b),Error("Cannot calculate parent tile. destination LOD's resolution "+a.resolution+" is not a parent resolution of "+c.resolution);if(a.resolution===c.resolution)return a=b.id,f.pool.release(b),a;c=b.level-a.level;if(0>c)throw f.pool.release(b),Error("Wrong way...!");a=f.getId(a.level,b.row>>c,b.col>>c,b.world);
f.pool.release(b);return a};d.prototype.getTileCoverage=function(a){a=b.prototype.getTileCoverage.call(this,a);if(!a)return a;var c=1<<a.lodInfo.level;a.spans=a.spans.filter(function(a){return 0<=a.row&&a.row<c});return a};d.prototype.scaleToLevel=function(a){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[a])return this._levelByScale[a];var b=this._fullCacheLodInfos;if(a>b[0].scale)return b[0].level;for(var c=void 0,d=void 0,c=0;c<b.length-1;c++)if(d=
b[c+1],a>d.scale)return c=b[c],c.level+(c.scale-a)/(c.scale-d.scale);return b[b.length-1].level};d.prototype._initializeFullCacheLODs=function(a){a=0===a[0].level?a.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}}):c.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}});for(var b=0;b<a.length;b++)this._levelByScale[a[b].scale]=a[b].level;this._fullCacheLodInfos=
a};return d}(d)})},"esri/views/vectorTiles/TileHandler":function(){define("require exports dojo/Deferred dojo/promise/all ../../request ../../core/has ../../core/LRUCache ../../core/promiseUtils ../../core/requireUtils ../../core/workers ../2d/tiling/TileKey ./GeometryUtils ./GlyphMosaic ./GlyphSource ./SpriteMosaic ./SpriteSource ./TileIndex ./VectorTileDisplayObject module".split(" "),function(n,e,a,b,c,d,f,h,g,l,m,k,v,q,p,r,t,u,x){var z=new f(10),w=new Map;return function(){function d(a,b,c,d,
f){void 0===d&&(d=!1);this.devicePixelRatio=c;this.allowUpdates=d;this._tileIndex=this._connection=this._glyphMosaic=this._spriteMosaic=null;this._updateQueue=new Map;this._ongoingRequests=new Map;this._vectorTileLayer=a;this._styleRepository=a.styleRepository;this._requestUpdate=b}d.prototype.destroy=function(){this.stop();this._vectorTileLayer=this._requestUpdate=this._styleRepository=null;this._spriteMosaic&&(this._spriteMosaic.dispose(),this._spriteMosaic=null);this._glyphMosaic&&(this._glyphMosaic.dispose(),
this._glyphMosaic=null)};Object.defineProperty(d.prototype,"initialized",{get:function(){return this._broadcastPromise&&this._broadcastPromise.isFulfilled()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"spriteMosaic",{get:function(){return this._spriteMosaic},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"glyphMosaic",{get:function(){return this._glyphMosaic},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"ongoingRequestCount",{get:function(){return this._ongoingRequests.size},
enumerable:!0,configurable:!0});d.prototype.start=function(){var c=this;this.stop();var d=this._styleRepository,f=new r(d.sprite,this.devicePixelRatio);f.devicePixelRatio=this.devicePixelRatio;var e=f.load().then(function(){c._spriteMosaic=new p(1024,1024,250);c._spriteMosaic.setSpriteSource(f)}),k=new q(d.glyphs);this._glyphMosaic=new v(1024,1024,k);var h=this._fetchTileMap(this._vectorTileLayer.tileIndexUrl),m=l.open(g.getAbsMid("./WorkerTileHandler",n,x),{client:this}).then(function(a){c._connection=
a}),t=new a(function(a){e.isFulfilled()||e.cancel();h.isFulfilled()||h.cancel();m.isFulfilled()||m.cancel()});b([e,h,m]).then(function(a){b(c._connection.broadcast("setLayers",d.styleJSON)).then(function(){t.resolve()})});return this._broadcastPromise=t.promise};d.prototype.stop=function(){this._broadcastPromise&&!this._broadcastPromise.isFulfilled()&&this._broadcastPromise.cancel();this._updateQueue.forEach(function(a){return a.cancel()});this._ongoingRequests.forEach(function(a){return a.cancel()});
this._connection&&(this._connection.close(),this._connection=null)};d.prototype.updateTile=function(a,b){var c=this;if(!this.allowUpdates)return h.resolve(null);if(!this._broadcastPromise.isFulfilled()||!this._connection)return h.reject(Error("no connection"));b=Math.round(k.degToByte(b.state.rotation));if(a.rotation===b)return h.resolve(null);var d,f=a.key;this._updateQueue.has(f.id)&&(d=this._updateQueue.get(f.id),d.cancel());a.rotation=b;d=this._connection.invoke("update",{key:a.id,rotation:b},
null,{client:a.client}).then(function(b){a.updateSymbolData(b);return b}).always(function(){c._updateQueue["delete"](f.id)});this._updateQueue.set(a.id,d);return d};d.prototype.getVectorTile=function(a,b,c,d){var f=this;void 0===d&&(d=0);var g=new m(a,b,c,0);return this.getRefKey(g).then(function(a){var b=new u(g,a,f._vectorTileLayer.tileInfo,f._styleRepository,0);if(a)return f.getTileData(b.key,0).then(function(a){b.setData(a.tileData,a.client);return b});b.setData(null,null);return b})};d.prototype.getTileData=
function(a,b){var c=this;return this._broadcastPromise.isFulfilled()&&this._connection?this.getRefKey(a).then(function(d){if(!d)return h.resolve(null);var f=Math.round(k.degToByte(b));return c._getTileData(c._connection,a,d,f).then(function(a){return a&&a.tileData?a:h.reject("No data")})}):h.reject(Error("no connection"))};d.prototype.getRefKey=function(a){return this._tileIndex?this._tileIndex.dataKey(a):h.resolve(a)};d.prototype.getSprites=function(a){return this._spriteMosaic.getSpriteItems(a)};
d.prototype.getGlyphs=function(a){return this._glyphMosaic.getGlyphItems(a.tileID,a.font,a.codePoints)};d.prototype.getStyleRepository=function(){return this._styleRepository};d.prototype.getTileIndex=function(){return this._tileIndex};d.prototype._getTileData=function(a,b,c,d){var f=this,g={client:null};if(a=this._ongoingRequests.get(b.id))return a;a=this._vectorTileLayer.getTileUrl(c.level,c.row,c.col);a=this._connection.invoke("getTile",{key:b.id,refKey:c.id,url:a,rotation:d,cacheTile:this.allowUpdates},
null,g).then(function(a){f._ongoingRequests.delete(b.id);return{tileData:a,client:g.client}}).catch(function(a){f._ongoingRequests.delete(b.id);f._connection.invoke("destructTileData",b.id,null,g);return h.reject(a)});this._ongoingRequests.set(b.id,a);return a};d.prototype._fetchTileMap=function(a){var b=this;if(this._vectorTileLayer.capabilities.operations.supportsTileMap&&this._vectorTileLayer.tilemapCache)return this._tileIndex=new t(this._vectorTileLayer.tilemapCache),h.resolve();if(!a)return h.resolve();
if(z.has(a))return this._tileIndex=z.use(a),h.resolve();if(w.has(a))return w.get(a).then(function(a){b._tileIndex=new t(a.data)});var d=c(a,{responseType:"json"});d.then(function(c){b._tileIndex=new t(c.data);w["delete"](a);z.insert(a,b._tileIndex)});w.set(a,d);return d};return d}()})},"esri/core/LRUCache":function(){define(["require","exports"],function(n,e){return function(){function a(a){this._cache={};this._lruQueue=[];if(0>=a)throw Error("LRU cache size must be bigger than zero!");this._maxSize=
a}a.prototype.has=function(a){return void 0!==this._cache[a]};a.prototype.insert=function(a,c){null!==this.use(a)?this._cache[a]=c:(this._collect(),this._cache[a]=c,this._lruQueue.unshift(a))};a.prototype.use=function(a){var b=this._cache[a];if(!b)return null;this._lruQueue.splice(this._lruQueue.indexOf(a),1);this._lruQueue.unshift(a);return b};a.prototype.print=function(){for(var a=0,c=this._lruQueue;a<c.length;a++){var d=c[a];console.log("key: "+d+", value: "+this._cache[d])}};a.prototype._collect=
function(){if(!(this._lruQueue.length<this._maxSize)){var a=this._lruQueue.pop(),c=this._cache[a];c&&c.release&&c.release();delete this._cache[a]}};return a}()})},"esri/views/vectorTiles/GlyphMosaic":function(){define("require exports ../../core/has ../../core/promiseUtils ./Rect ./RectangleBinPack ../webgl/Texture".split(" "),function(n,e,a,b,c,d,f){return function(){function a(a,b,c){this.height=this.width=0;this._dirties=[];this._glyphData=[];this._currentPage=0;this._glyphIndex={};this._textures=
[];this._rangePromises=new Map;(0>=a||0>=b)&&console.error("Glyph mosaic width and height must be greater than zero!");this.width=a;this.height=b;this._glyphSource=c;this._binPack=new d(a-4,b-4);this._glyphData.push(new Uint8Array(a*b));this._dirties.push(!0);this._textures.push(void 0)}a.prototype.getGlyphItems=function(a,f,e){var g=this,h=[],l=this._glyphSource;a=new Set;for(var m=1/256,r=0;r<e.length;r++)a.add(Math.floor(e[r]*m));var t=[];a.forEach(function(a){if(256>=a){var b=f+a;g._rangePromises.has(b)?
t.push(g._rangePromises.get(b)):(a=l.getRange(f,a).always(function(){g._rangePromises["delete"](b)}),g._rangePromises.set(b,a),t.push(a))}});return b.all(t).then(function(a){var b=g._glyphIndex[f];b||(b={},g._glyphIndex[f]=b);for(var k=0;k<e.length;k++){a=e[k];var m=b[a];if(m)h[a]={rect:m.rect,metrics:m.metrics,page:m.page};else{var p=l.getGlyph(f,a);if(p&&p.metrics){var m=p.metrics,r=void 0;if(0===m.width)r=new c(0,0,0,0);else{var q=m.width+6,t=m.height+6,u=q%4?4-q%4:4,v=t%4?4-t%4:4;1===u&&(u=5);
1===v&&(v=5);r=g._binPack.allocate(q+u,t+v);r.isEmpty&&(g._dirties[g._currentPage]||(g._glyphData[g._currentPage]=null),g._currentPage=g._glyphData.length,g._glyphData.push(new Uint8Array(g.width*g.height)),g._dirties.push(!0),g._textures.push(void 0),g._binPack=new d(g.width-4,g.height-4),r=g._binPack.allocate(q+u,t+v));var u=g._glyphData[g._currentPage],p=p.bitmap,n=v=void 0;if(p)for(var C=0;C<t;C++)for(var v=q*C,n=g.width*(r.y+C+1)+r.x,G=0;G<q;G++)u[n+G+1]=p[v+G]}b[a]={rect:r,metrics:m,tileIDs:null,
page:g._currentPage};h[a]={rect:r,metrics:m,page:g._currentPage};g._dirties[g._currentPage]=!0}}}return h})};a.prototype.removeGlyphs=function(a){for(var b in this._glyphIndex){var c=this._glyphIndex[b];if(c){var d=void 0,f;for(f in c)if(d=c[f],d.tileIDs["delete"](a),0===d.tileIDs.size){for(var g=this._glyphData[d.page],e=d.rect,h=void 0,t=void 0,u=0;u<e.height;u++)for(h=this.width*(e.y+u)+e.x,t=0;t<e.width;t++)g[h+t]=0;delete c[f];this._dirties[d.page]=!0}}}};a.prototype.bind=function(a,b,c,d){void 0===
d&&(d=0);this._textures[c]||(this._textures[c]=new f(a,{pixelFormat:6406,dataType:5121,width:this.width,height:this.height},new Uint8Array(this.width*this.height)));var g=this._textures[c];g.setSamplingMode(b);this._dirties[c]&&g.setData(this._glyphData[c]);a.bindTexture(g,d);this._dirties[c]=!1};a.prototype.dispose=function(){this._binPack=null;for(var a=0,b=this._textures;a<b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0};return a}()})},"esri/views/vectorTiles/Rect":function(){define(["require",
"exports"],function(n,e){return function(){function a(a,c,d,f){void 0===a&&(a=0);void 0===c&&(c=0);void 0===d&&(d=0);void 0===f&&(f=0);this.x=a;this.y=c;this.width=d;this.height=f}Object.defineProperty(a.prototype,"isEmpty",{get:function(){return 0>=this.width||0>=this.height},enumerable:!0,configurable:!0});return a}()})},"esri/views/vectorTiles/RectangleBinPack":function(){define(["require","exports","./Rect"],function(n,e,a){return function(){function b(b,d){this._height=this._width=0;this._free=
[];this._width=b;this._height=d;this._free.push(new a(0,0,b,d))}Object.defineProperty(b.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0});b.prototype.allocate=function(b,d){if(b>this._width||d>this._height)return new a;for(var c=null,e=-1,g=0;g<this._free.length;++g){var l=this._free[g];b<=l.width&&d<=l.height&&(null===c||l.y<=c.y&&l.x<=c.x)&&(c=l,e=g)}if(null===
c)return new a;this._free.splice(e,1);c.width<c.height?(c.width>b&&this._free.push(new a(c.x+b,c.y,c.width-b,d)),c.height>d&&this._free.push(new a(c.x,c.y+d,c.width,c.height-d))):(c.width>b&&this._free.push(new a(c.x+b,c.y,c.width-b,c.height)),c.height>d&&this._free.push(new a(c.x,c.y+d,b,c.height-d)));return new a(c.x,c.y,b,d)};b.prototype.release=function(a){for(var b=0;b<this._free.length;++b){var c=this._free[b];if(c.y===a.y&&c.height===a.height&&c.x+c.width===a.x)c.width+=a.width;else if(c.x===
a.x&&c.width===a.width&&c.y+c.height===a.y)c.height+=a.height;else if(a.y===c.y&&a.height===c.height&&a.x+a.width===c.x)c.x=a.x,c.width+=a.width;else if(a.x===c.x&&a.width===c.width&&a.y+a.height===c.y)c.y=a.y,c.height+=a.height;else continue;this._free.splice(b,1);this.release(a)}this._free.push(a)};return b}()})},"esri/views/vectorTiles/GlyphSource":function(){define(["require","exports","../../request","../../core/pbf","../../core/promiseUtils"],function(n,e,a,b,c){var d=function(){function a(a){this._metrics=
[];this._bitmaps=[];if(a)for(;a.next();)switch(a.tag()){case 1:for(var b=a.getMessage();b.next();)switch(b.tag()){case 3:for(var c=b.getMessage(),d=void 0,f=void 0,g=void 0,e=void 0,h=void 0,t=void 0,u=void 0;c.next();)switch(c.tag()){case 1:d=c.getUInt32();break;case 2:f=c.getBytes();break;case 3:g=c.getUInt32();break;case 4:e=c.getUInt32();break;case 5:h=c.getSInt32();break;case 6:t=c.getSInt32();break;case 7:u=c.getUInt32();break;default:c.skip()}d&&(this._metrics[d]={width:g,height:e,left:h,top:t,
advance:u},this._bitmaps[d]=f);break;default:b.skip()}break;default:a.skip()}}a.prototype.getMetrics=function(a){return this._metrics[a]};a.prototype.getBitmap=function(a){return this._bitmaps[a]};return a}(),f=function(){function a(){this._ranges=[]}a.prototype.getRange=function(a){return this._ranges[a]};a.prototype.addRange=function(a,b){this._ranges[a]=b};return a}();return function(){function e(a){this._glyphInfo={};this._baseURL=a}e.prototype.getRange=function(f,e){var g=this._getFontStack(f);
if(g.getRange(e))return c.resolve();var h=256*e,l=h+255;f=this._baseURL.replace("{fontstack}",f).replace("{range}",h+"-"+l);return a(f,{responseType:"array-buffer"}).then(function(a){g.addRange(e,new d(new b(new Uint8Array(a.data),new DataView(a.data))))}).catch(function(){g.addRange(e,new d)})};e.prototype.getGlyph=function(a,b){if(a=this._getFontStack(a)){var c=Math.floor(b/256);if(!(256<c)&&(a=a.getRange(c)))return{metrics:a.getMetrics(b),bitmap:a.getBitmap(b)}}};e.prototype._getFontStack=function(a){var b=
this._glyphInfo[a];b||(b=this._glyphInfo[a]=new f);return b};return e}()})},"esri/views/vectorTiles/SpriteMosaic":function(){define("require exports ./GeometryUtils ./Rect ./RectangleBinPack ../webgl/Texture".split(" "),function(n,e,a,b,c,d){return function(){function f(a,b,d){void 0===d&&(d=0);this._size=[];this._mosaicsData=[];this._textures=[];this._dirties=[];this._pageHeight=this._pageWidth=this._currentPage=this._maxItemSize=0;this._mosaicRects={};this.pixelRatio=1;(0>=a||0>=b)&&console.error("Sprites mosaic defaultWidth and defaultHeight must be greater than zero!");
this._pageWidth=a;this._pageHeight=b;0<d&&(this._maxItemSize=d);this._binPack=new c(a-4,b-4)}f.prototype.getWidth=function(a){return a>=this._size.length?-1:this._size[a][0]};f.prototype.getHeight=function(a){return a>=this._size.length?-1:this._size[a][1]};f.prototype.setSpriteSource=function(a){this.dispose();this.pixelRatio=a.devicePixelRatio;if(0===this._mosaicsData.length){this._binPack=new c(this._pageWidth-4,this._pageHeight-4);var b=new Uint32Array(Math.floor(this._pageWidth)*Math.floor(this._pageHeight));
this._mosaicsData[0]=b;this._dirties.push(!0);this._size.push([this._pageWidth,this._pageHeight]);this._textures.push(void 0)}this._sprites=a};f.prototype.getSpriteItem=function(a,b){void 0===b&&(b=!1);var c=this._mosaicRects[a];if(c)return c;if(!this._sprites||"loaded"!==this._sprites.loadStatus)return null;c=this._sprites.getSpriteInfo(a);if(!c||!c.width||!c.height||0>c.width||0>c.height)return null;var d=c.width,f=c.height,e=this._allocateImage(d,f),g=e[0],h=e[1];if(0>=g.width)return null;this._copy(g,
c,h,e[2],b);c={rect:g,width:d,height:f,anchorX:0,anchorY:0,sdf:c.sdf,pixelRatio:c.pixelRatio,page:h};return this._mosaicRects[a]=c};f.prototype.preloadSpriteItems=function(){for(var a=0,b=this._sprites.spriteNames;a<b.length;a++)this.getSpriteItem(b[a],!0)};f.prototype.getSpriteItems=function(a){for(var b={},c=0;c<a.length;c++){var d=a[c];b[d]=this.getSpriteItem(d)}return b};f.prototype.getMosaicItemPosition=function(a,b){b=(a=this.getSpriteItem(a,b))&&a.rect;if(!b)return null;b.width=a.width;b.height=
a.height;return{size:[a.width,a.height],tl:[(b.x+2)/this._size[a.page][0],(b.y+2)/this._size[a.page][1]],br:[(b.x+2+a.width)/this._size[a.page][0],(b.y+2+a.height)/this._size[a.page][1]],page:a.page}};f.prototype.bind=function(a,b,c,f){void 0===c&&(c=0);void 0===f&&(f=0);this._textures[c]||(this._textures[c]=new d(a,{pixelFormat:6408,dataType:5121,width:this._size[c][0],height:this._size[c][1]},new Uint8Array(this._mosaicsData[c].buffer)));var e=this._textures[c];e.setSamplingMode(b);this._dirties[c]&&
e.setData(new Uint8Array(this._mosaicsData[c].buffer));a.bindTexture(e,f);this._dirties[c]=!1};f._copyBits=function(a,b,c,d,f,e,q,p,r,t,u){var g=d*b+c;q=p*e+q;if(u)for(q-=e,u=-1;u<=t;u++,g=((u+t)%t+d)*b+c,q+=e)for(p=-1;p<=r;p++)f[q+p]=a[g+(p+r)%r];else for(u=0;u<t;u++){for(p=0;p<r;p++)f[q+p]=a[g+p];g+=b;q+=e}};f.prototype._copy=function(a,b,c,d,e,v){if(this._sprites&&"loaded"===this._sprites.loadStatus&&!(c>=this._mosaicsData.length)){var g=new Uint32Array(v?v.buffer:this._sprites.image.buffer),k=
this._mosaicsData[c];k&&g||console.error("Source or target images are uninitialized!");f._copyBits(g,v?b.width:this._sprites.width,b.x,b.y,k,d[0],a.x+2,a.y+2,b.width,b.height,e);this._dirties[c]=!0}};f.prototype._allocateImage=function(d,f){d+=2;f+=2;var e=Math.max(d,f);if(this._maxItemSize&&this._maxItemSize<e){var e=Math.pow(2,Math.ceil(a.log2(d))),g=Math.pow(2,Math.ceil(a.log2(f)));d=new b(0,0,d,f);this._mosaicsData.push(new Uint32Array(e*g));this._dirties.push(!0);this._size.push([e,g]);this._textures.push(void 0);
return[d,this._mosaicsData.length-1,[e,g]]}e=d%4?4-d%4:4;g=f%4?4-f%4:4;1===e&&(e=5);1===g&&(g=5);e=this._binPack.allocate(d+e,f+g);return 0>=e.width?(this._dirties[this._currentPage]||(this._mosaicsData[this._currentPage]=null),this._currentPage=this._mosaicsData.length,this._mosaicsData.push(new Uint32Array(this._pageWidth*this._pageHeight)),this._dirties.push(!0),this._size.push([this._pageWidth,this._pageHeight]),this._textures.push(void 0),this._binPack=new c(this._pageWidth-4,this._pageHeight-
4),this._allocateImage(d,f)):[e,this._currentPage,[this._pageWidth,this._pageHeight]]};f.prototype.dispose=function(){this._binPack=null;this._mosaicRects={};for(var a=0,b=this._textures;a<b.length;a++){var c=b[a];c&&c.dispose()}this._textures.length=0};return f}()})},"esri/views/vectorTiles/SpriteSource":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper dojo/Deferred ../../kernel ../../request ../../core/promiseUtils ../../core/urlUtils".split(" "),
function(n,e,a,b,c,d,f,h,g){return function(){function a(a,b){this.baseURL=a;this.devicePixelRatio=b;this._isRetina=!1;this._spritesData={};this.height=this.width=this.image=null;this.loadStatus="not-loaded"}Object.defineProperty(a.prototype,"spriteNames",{get:function(){var a=[],b;for(b in this._spritesData)a.push(b);a.sort();return a},enumerable:!0,configurable:!0});a.prototype.getSpriteInfo=function(a){return this._spritesData[a]};a.prototype.load=function(){var a=this;this.loadStatus="loading";
return this.baseURL?this._loadSprites().then(function(){a.loadStatus="loaded";return a}).catch(function(b){a.loadStatus="failed";return a}):h.resolve(this)};a.prototype._loadSprites=function(){var a=this;this._isRetina=1.15<this.devicePixelRatio?!0:!1;var b=this.baseURL,e=this._isRetina?"@2x":"";return f(b+e+".json",{responseType:"json"}).then(function(f){var k=Object.keys(f.data);if(!k||0===k.length||1===k.length&&"_ssl"===k[0])return h.resolve(null);a._spritesData=f.data;var l=new c,m=new Image;
m.crossOrigin="anonymous";m.onload=function(){m.onload=null;a.width=m.width;a.height=m.height;var b=document.createElement("canvas");b.width=m.width;b.height=m.height;b=b.getContext("2d");b.drawImage(m,0,0,m.width,m.height);for(var b=b.getImageData(0,0,m.width,m.height),b=new Uint8Array(b.data),c,d=0;d<b.length;d+=4)c=b[d+3]/255,b[d]*=c,b[d+1]*=c,b[d+2]*=c;a.image=b;l.resolve()};f=""+b+e+".png";d.id&&(k=d.id.findCredential(f))&&k.token&&(f+="?token\x3d"+k.token);m.src=g.addProxy(f);return l})};return a}()})},
"esri/views/vectorTiles/TileIndex":function(){define(["require","exports","../../core/promiseUtils","../../layers/support/TilemapCache","../2d/tiling/TileKey"],function(n,e,a,b,c){return function(){function d(a){if(a instanceof b)this._tilemapCache=a;else if(a&&"index"in a)this._tilemap=a.index;else throw Error("Invalid tilemap!");}d.prototype.dataKey=function(a){if(this._tilemapCache){var b=a.level,d=a.row,f=a.col,e=new c(a);return this._tilemapCache.fetchAvailabilityUpsample(b,d,f,e).then(function(){return e}).catch(function(a){if(a&&
"cancel"===a.dojoType)throw a;e.level=b;e.row=d;e.col=f;return e})}return this._getIndexedDataKey(a)};d.prototype.forEach=function(a,b,c,d,e){this._callback=e;this._maxLevel=b+a;this._forEach(this._tilemap,b,c,d)};d.prototype._forEach=function(a,b,c,d){0!==a&&(this._callback(b,c,d),b!==this._maxLevel&&"object"===typeof a&&(this._forEach(a[0],b+1,2*c,2*d),this._forEach(a[1],b+1,2*c,2*d+1),this._forEach(a[2],b+1,2*c+1,2*d),this._forEach(a[3],b+1,2*c+1,2*d+1)))};d.prototype._getIndexedDataKey=function(b){var d=
[b];if(0>b.level||0>b.row||0>b.col||0<b.row>>b.level||0<b.col>>b.level)return a.resolve(null);for(;0!==b.level;)b=new c(b.level-1,b.row>>1,b.col>>1,b.world),d.push(b);b=this._tilemap;var f=d.pop(),e,m;if(1===b)return a.resolve(f);for(;d.length;)if(e=d.pop(),m=(e.col&1)+((e.row&1)<<1),b)if(0===b[m]){f=null;break}else if(1===b[m]){f=e;break}else f=e,b=b[m];return a.resolve(f)};return d}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/ObjectPool ../../core/libs/gl-matrix/mat4 ../../core/libs/gl-matrix/vec2 ../../geometry/support/spatialReferenceUtils ../2d/engine/DisplayObject ../2d/tiling/enums ../2d/tiling/TileKey ./RenderBucket ../webgl/BufferObject".split(" "),
function(n,e,a,b,c,d,f,h,g,l,m,k){var v="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");return function(e){function h(){for(var a,b=[],f=0;f<arguments.length;f++)b[f]=arguments[f];f=e.call(this)||this;f._renderBuckets=[];f._vectorTileData=
null;f._symbolUpdateData=null;f.status=g.TileStatus.INITIALIZED;f.coords=[0,0];f.bounds=[0,0,0,0];f.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};f.stencilData={mask:0,reference:0};f.status=g.TileStatus.INITIALIZED;f.tileTransform.transform=c.create();f.tileTransform.displayCoord=d.create();0<b.length&&(a=f.acquire).call.apply(a,[f].concat(b));return f}a(h,e);h.prototype.reset=function(){l.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.coords[1]=0;
this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=this.client=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=null;this.status=g.TileStatus.INITIALIZED};h.prototype.acquire=function(a,b,c,d,e){this.key=a;this.refKey=b;b=c.lodAt(a.level);b=
null!==b?b.resolution:0;var g=c.size[0]*b,k=c.origin,h=a.col*g,l=a.row*g,m=c.spatialReference,p=0;m&&(m._isWrappable?m._isWrappable():m.isWrappable)&&(m=f.getInfo(m),p=m.valid[1]-m.valid[0]);h=k.x+h+a.world*p;k=k.y-l;this.coords[0]=h;this.coords[1]=k;this.bounds[0]=h;this.bounds[1]=k;this.bounds[2]=h+g;this.bounds[3]=k-g;this.widthInPixels=c.size[1];this.coordRange=4096;this.resolution=b;this.rotation=e;this.styleLayers=d;this.id=a.id};h.prototype.setData=function(a,b){this._vectorTileData=a;this.client=
b;a&&a.bufferDataInfo||(this.status=g.TileStatus.NO_DATA)};h.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};h.prototype.dispose=function(){for(var a="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" "),
b=0;b<a.length;++b){var c=a[b];this[c]&&(this[c].dispose(),this[c]=null)}this._renderBuckets.length=0;this.status=g.TileStatus.INITIALIZED};h.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};h.prototype.getGpuMemoryUsage=function(){var a=this,b=v.reduce(function(b,c){return a[c]?
b+a[c].size:b},0);this.texture&&(b+=this.texture.descriptor.width*this.texture.descriptor.height*4);return b};h.prototype.attach=function(a){if(this.status!==g.TileStatus.INITIALIZED)return!0;this._createRenderBuckets();this._createBufferObjects(a);this._vectorTileData=null;this.status=g.TileStatus.READY;return!0};h.prototype._createRenderBuckets=function(){if(0===this._renderBuckets.length)for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,c=0;c<b;){var d=a[c];switch(a[c+1]){case 0:var f=
new m.BackgroundRenderBucket;f.layerID=d;this._renderBuckets.push(f);c+=2;break;case 1:f=new m.FillRenderBucket;f.layerID=d;f.triangleElementStart=a[c+2];f.triangleElementCount=a[c+3];f.outlineElementStart=a[c+4];f.outlineElementCount=a[c+5];this._renderBuckets.push(f);c+=6;break;case 2:f=new m.LineRenderBucket;f.layerID=d;f.triangleElementStart=a[c+2];f.triangleElementCount=a[c+3];this._renderBuckets.push(f);c+=4;break;case 3:f=new m.SymbolRenderBucket;f.layerID=d;f.isSDF=0!==a[c+2];var e=c+3,d=
a[e];e++;if(0<d)for(var g=void 0,k=void 0,h=void 0,l=0;l<d;l++)g=a[e],k=a[e+1],h=a[e+2],f.markerPerPageElementsMap.set(g,[k,h]),e+=3;var p=a[e];e++;if(0<p)for(h=k=g=void 0,l=0;l<p;l++)g=a[e],k=a[e+1],h=a[e+2],f.glyphPerPageElementsMap.set(g,[k,h]),e+=3;this._renderBuckets.push(f);c+=5+3*d+3*p;break;case 4:f=new m.CircleRenderBucket;f.layerID=d;f.triangleElementStart=a[c+2];f.triangleElementCount=a[c+3];this._renderBuckets.push(f);c+=4;break;default:console.error("Bad bucket type!"),c+=2}}};h._createBufferToObject=
function(){var a=[];a[1]={create:k.createVertex,var:"fillVertexBuffer"};a[2]={create:k.createVertex,var:"fillDDVertexBuffer"};a[3]={create:k.createIndex,var:"fillIndexBuffer"};a[4]={create:k.createVertex,var:"outlineVertexBuffer"};a[5]={create:k.createVertex,var:"outlineDDVertexBuffer"};a[6]={create:k.createIndex,var:"outlineIndexBuffer"};a[7]={create:k.createVertex,var:"lineVertexBuffer"};a[9]={create:k.createIndex,var:"lineIndexBuffer"};a[10]={create:k.createVertex,var:"iconVertexBuffer"};a[11]=
{create:k.createVertex,var:"iconDDVertexBuffer"};a[12]={create:k.createIndex,var:"iconIndexBuffer"};a[13]={create:k.createVertex,var:"textVertexBuffer"};a[14]={create:k.createVertex,var:"textDDVertexBuffer"};a[15]={create:k.createIndex,var:"textIndexBuffer"};a[16]={create:k.createVertex,var:"circleVertexBuffer"};a[17]={create:k.createIndex,var:"circleIndexBuffer"};return a};h.prototype._createBufferObjects=function(a){a=a.context;for(var b=new Uint32Array(this._vectorTileData.bufferDataInfo),c=b.length,
d=0,f=0;f<c;f+=2,d++){var e=b[f];if(!(0>=b[f+1]||0===this._vectorTileData.bufferData[d].byteLength)){var g=h.bufferToObject[e];g?this[g.var]?this[g.var].setData(this._vectorTileData.bufferData[d]):this[g.var]=g.create(a,35044,this._vectorTileData.bufferData[d]):console.error("Bad buffer type "+e)}}};h.prototype.detach=function(a){this.client&&this.status!==g.TileStatus.INVALID&&this.status!==g.TileStatus.INITIALIZED&&this.client.invoke("destructTileData",this.id);this.dispose();e.prototype.detach.call(this,
a)};h.prototype.doRender=function(a){if(this.visible&&this.status===g.TileStatus.READY){var b=a.context,c=a.renderer;if(b&&c){var d=a.drawphase;this._symbolUpdateData&&this._updateSymbolData(a);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var f=this.styleLayers,e=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==e){var k=this._renderBuckets.length;if(0===d)for(var h=k-1;0<=h;h--){var l=this._renderBuckets[h];1!==l.type&&0!==l.type||!l.hasData()||c.renderBucket(b,l,a.displayLevel,
a.requiredLevel,d,this,f.layers[l.layerID],e)}else for(h=0;h<k;h++)l=this._renderBuckets[h],l.hasData()&&c.renderBucket(b,l,a.displayLevel,a.requiredLevel,d,this,f.layers[l.layerID],e)}}}};h.prototype._updateSymbolData=function(a){if(!this._symbolUpdateData.bucketDataInfo)return!0;var b=new Uint32Array(this._symbolUpdateData.bucketDataInfo),c=b.length;if(0===c)return this._symbolUpdateData=null,!0;if(this.status!==g.TileStatus.READY)return this.requestRender(),!1;a=a.context;for(var d=new Uint32Array(this._symbolUpdateData.bufferDataInfo),
f=d.length,e=0,h=0;h<f;h+=2,e++)switch(d[h]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=k.createVertex(a,35044,this._symbolUpdateData.bufferData[e]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=k.createVertex(a,35044,this._symbolUpdateData.bufferData[e]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);
this.iconIndexBuffer=k.createIndex(a,35044,this._symbolUpdateData.bufferData[e]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=k.createVertex(a,35044,this._symbolUpdateData.bufferData[e]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=k.createVertex(a,35044,this._symbolUpdateData.bufferData[e]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),
this.textIndexBuffer=null),this.textIndexBuffer=k.createIndex(a,35044,this._symbolUpdateData.bufferData[e])}a=this._renderBuckets.length;for(d=0;d<a;d++)this._renderBuckets[d]instanceof m.SymbolRenderBucket&&(f=this._renderBuckets[d],f.markerPerPageElementsMap.clear(),f.glyphPerPageElementsMap.clear());for(a=0;a<c;){f=b[a];e=-1;h=this._renderBuckets.length;for(d=0;d<h;d++)if(this._renderBuckets[d].layerID===f){e=d;break}d=this._renderBuckets[e];d||(d=new m.SymbolRenderBucket,d.layerID=f,d.isSDF=0!==
b[a+2],this._renderBuckets.push(d));var l=a+3,f=b[l];l++;if(0<f)for(var p=h=e=void 0,q=0;q<f;q++)e=b[l],h=b[l+1],p=b[l+2],d.markerPerPageElementsMap.set(e,[h,p]),l+=3;var r=b[l];l++;if(0<r)for(p=h=e=void 0,q=0;q<r;q++)e=b[l],h=b[l+1],p=b[l+2],d.glyphPerPageElementsMap.set(e,[h,p]),l+=3;a+=5+3*f+3*r}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);
this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);this._symbolUpdateData=null;return!0};h.pool=new b(h);h.bufferToObject=h._createBufferToObject();return h}(h)})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(n,e,a,b){Object.defineProperty(e,
"__esModule",{value:!0});n=function(){return function(a){this.type=a}}();e.RenderBucket=n;b=function(b){function c(){var a=b.call(this,2)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}a(c,b);c.prototype.hasData=function(){return 0<this.triangleElementCount};return c}(n);e.LineRenderBucket=b;b=function(b){function c(){var a=b.call(this,1)||this;a.triangleElementStart=0;a.triangleElementCount=0;a.outlineElementStart=0;a.outlineElementCount=0;return a}a(c,b);c.prototype.hasData=function(){return 0<
this.triangleElementCount||0<this.outlineElementCount};return c}(n);e.FillRenderBucket=b;b=function(b){function c(){var a=b.call(this,3)||this;a.markerPerPageElementsMap=new Map;a.glyphPerPageElementsMap=new Map;a.isSDF=!1;return a}a(c,b);c.prototype.hasData=function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return c}(n);e.SymbolRenderBucket=b;b=function(b){function c(){var a=b.call(this,4)||this;a.triangleElementStart=0;a.triangleElementCount=0;return a}
a(c,b);c.prototype.hasData=function(){return 0<this.triangleElementCount};return c}(n);e.CircleRenderBucket=b;n=function(b){function c(){return b.call(this,0)||this}a(c,b);c.prototype.hasData=function(){return!0};return c}(n);e.BackgroundRenderBucket=n})},"esri/views/vectorTiles/VectorTileContainer":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/has ../../core/promiseUtils ../../core/libs/gl-matrix/mat4 ../../core/libs/gl-matrix/vec3 ../2d/engine/Container ../2d/engine/webgl/enums ../2d/engine/webgl/WGLPainter ./GeometryUtils ./renderers/Renderer".split(" "),
function(n,e,a,b,c,d,f,h,g,l,m,k){return function(e){function h(){var a=e.call(this)||this;a.isInitialized=!1;a._renderer=new k;a._displayWidth=0;a._displayHeight=0;a._pointToCallbacks=new Map;a._tileCoordinateScale=f.create();a._orientationVec=f.create();a._displayScale=f.create();a._orientationVec.set([0,0,1]);a._defaultTransform=d.create();return a}a(h,e);h.prototype.initialize=function(a,b,c,d){this._renderer.initialize(a,b);this._tileInfoView=d;this._tileInfo=c;this.isInitialized=!0};h.prototype.destroy=
function(){this._renderer&&(this._renderer.dispose(),this._renderer=null)};h.prototype.hittest=function(a,b){var d=this,f=[a,b];return c.create(function(a,b){d._pointToCallbacks.set(f,{resolve:a,reject:b});d.requestRender()},function(){d._pointToCallbacks.has(f)&&d._pointToCallbacks.delete(f)})};h.prototype.prepareChildrenRenderParameters=function(a){var b=a.state;if(!b||!this._tileInfo||!this.isInitialized)return a;a.displayLevel=this._tileInfoView.scaleToLevel(b.scale);a.requiredLevel=this._tileInfoView.getClosestInfoForScale(b.scale).level;
a.renderer=this._renderer;return a};h.prototype.beforeRenderChildren=function(a,b){this._renderer.initializeProgramCache(a.context)};h.prototype.renderChildren=function(a){var c=this;if(0!==this.children.length&&this.isInitialized&&a&&a.state){var d=l.default.toWGLDrawPhases(a.drawPhase);if(!(0<d.length)||d[0]!==g.WGLDrawPhase.LABEL&&d[0]!==g.WGLDrawPhase.LABEL_ALPHA){this.sortChildren(function(a,b){return a.key.level-b.key.level});for(var d=this.children.length,f=1;f<=d;f++){var h=this.children[f-
1];h.attached&&(h.stencilData.reference=f,h.stencilData.mask=255)}this._updateTilesTransform(a.state,a.requiredLevel,this.children);d=a.context;d.setDepthWriteEnabled(!0);this._renderer.setStateParams(a.state,a.pixelRatio,a.displayLevel);this._renderer.drawClippingMasks(d,this.children);d.setStencilWriteMask(0);d.setBlendFunctionSeparate(1,771,1,771);d.setStencilOp(7680,7680,7681);d.setDepthFunction(515);d.setBlendingEnabled(!1);d.setStencilTestEnabled(!0);d.setDepthTestEnabled(!0);d.setDepthWriteEnabled(!0);
a.drawphase=0;e.prototype.renderChildren.call(this,a);d.setDepthWriteEnabled(!1);d.setBlendingEnabled(!0);a.drawphase=1;e.prototype.renderChildren.call(this,a);a.drawphase=2;e.prototype.renderChildren.call(this,a);d.setStencilTestEnabled(!1);d.setDepthTestEnabled(!1);if(b("esri-vector-tiles-debug"))for(f=0,h=this.children;f<h.length;f++){var k=h[f];k.attached&&k.visible&&this._renderer.renderTileInfo(d,k)}0<this._pointToCallbacks.size&&(this._pointToCallbacks.forEach(function(b,d){b.resolve(c._hitTest(a,
d[0],d[1]))}),this._pointToCallbacks.clear());this._renderer.needsRedraw()&&this.requestRender()}}};h.prototype.removeAllChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].dispose();e.prototype.removeAllChildren.call(this)};h.prototype._hitTest=function(a,b,c){var d=this._tileInfoView.getClosestInfoForScale(a.state.scale).level,f=[0,0];a.state.toMap(f,[b,c]);var e=a.state.clone(),g=e.viewpoint.clone(),h=g.targetGeometry;h.x=f[0];h.y=f[1];g.targetGeometry=h;e.viewpoint=g;e.size=
[3,3];this._renderer.setStateParams(e,a.pixelRatio,a.displayLevel);return(a=this._renderer.hitTest({drawPhase:0,pixelRatio:a.pixelRatio,stationary:a.stationary,opacity:a.opacity,context:a.context,displayLevel:a.displayLevel,requiredLevel:a.requiredLevel,renderer:a.renderer,layerOpacity:a.layerOpacity,state:e,drawphase:3,painter:null},b,c,this.children,d,3,this._updateTilesTransform.bind(this)))&&0!==a.length?a[0]:null};h.prototype._updateTilesTransform=function(a,b,c){var d=1/a.width,f=1/a.height,
e=[0,0];this._calculateRelativeViewProjMat(this._tileInfo.lodAt(b).resolution,a.resolution,a.rotation,this._tileInfo.size[1],4096,a.width,a.height,this._defaultTransform);for(var g=0;g<c.length;g++){var h=c[g];a.toScreen(e,h.coords);e[1]=a.height-e[1];h.tileTransform.displayCoord[0]=2*e[0]*d-1;h.tileTransform.displayCoord[1]=2*e[1]*f-1;h.key.level===b&&4096===h.coordRange?h.tileTransform.transform.set(this._defaultTransform):this._calculateRelativeViewProjMat(this._tileInfo.lodAt(h.key.level).resolution,
a.resolution,a.rotation,this._tileInfo.size[1],h.coordRange,a.width,a.height,h.tileTransform.transform)}};h.prototype._calculateRelativeViewProjMat=function(a,b,c,f,e,g,h,k){var l=.125;512!==f&&4096!==e&&(l=f/e);a=a/b*l;this._tileCoordinateScale.set([a,a,1]);if(g!==this._displayWidth||h!==this._displayHeight)this._displayScale.set([2/g,-2/h,1]),this._displayWidth=g,this._displayHeight=h;d.identity(k);d.scale(k,k,this._tileCoordinateScale);d.rotate(k,k,-c*m.C_DEG_TO_RAD,this._orientationVec);d.scale(k,
k,this._displayScale);d.transpose(k,k)};return h}(h)})},"esri/core/libs/gl-matrix/vec3":function(){define(["./common"],function(n){var e={create:function(){var a=new n.ARRAY_TYPE(3);a[0]=0;a[1]=0;a[2]=0;return a},clone:function(a){var b=new n.ARRAY_TYPE(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b},fromValues:function(a,b,c){var d=new n.ARRAY_TYPE(3);d[0]=a;d[1]=b;d[2]=c;return d},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a},set:function(a,b,c,d){a[0]=b;a[1]=c;a[2]=d;return a},add:function(a,
b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a},subtract:function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}};e.sub=e.subtract;e.multiply=function(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a};e.mul=e.multiply;e.divide=function(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a};e.div=e.divide;e.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);return a};e.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);
a[2]=Math.floor(b[2]);return a};e.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};e.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};e.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);return a};e.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};e.scaleAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;return a};
e.distance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(c*c+d*d+a*a)};e.dist=e.distance;e.squaredDistance=function(a,b){var c=b[0]-a[0],d=b[1]-a[1];a=b[2]-a[2];return c*c+d*d+a*a};e.sqrDist=e.squaredDistance;e.length=function(a){var b=a[0],c=a[1];a=a[2];return Math.sqrt(b*b+c*c+a*a)};e.len=e.length;e.squaredLength=function(a){var b=a[0],c=a[1];a=a[2];return b*b+c*c+a*a};e.sqrLen=e.squaredLength;e.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};e.inverse=function(a,
b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};e.normalize=function(a,b){var c=b[0],d=b[1],f=b[2],c=c*c+d*d+f*f;0<c&&(c=1/Math.sqrt(c),a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c);return a};e.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]};e.cross=function(a,b,c){var d=b[0],f=b[1];b=b[2];var e=c[0],g=c[1];c=c[2];a[0]=f*c-b*g;a[1]=b*e-d*c;a[2]=d*g-f*e;return a};e.lerp=function(a,b,c,d){var f=b[0],e=b[1];b=b[2];a[0]=f+d*(c[0]-f);a[1]=e+d*(c[1]-e);a[2]=b+d*(c[2]-b);return a};e.hermite=function(a,b,
c,d,f,e){var g=e*e,h=g*(2*e-3)+1,m=g*(e-2)+e,k=g*(e-1);e=g*(3-2*e);a[0]=b[0]*h+c[0]*m+d[0]*k+f[0]*e;a[1]=b[1]*h+c[1]*m+d[1]*k+f[1]*e;a[2]=b[2]*h+c[2]*m+d[2]*k+f[2]*e;return a};e.bezier=function(a,b,c,d,f,e){var g=1-e,h=g*g,m=e*e,k=h*g,h=3*e*h,g=3*m*g;e*=m;a[0]=b[0]*k+c[0]*h+d[0]*g+f[0]*e;a[1]=b[1]*k+c[1]*h+d[1]*g+f[1]*e;a[2]=b[2]*k+c[2]*h+d[2]*g+f[2]*e;return a};e.random=function(a,b){b=b||1;var c=2*n.RANDOM()*Math.PI,d=2*n.RANDOM()-1,f=Math.sqrt(1-d*d)*b;a[0]=Math.cos(c)*f;a[1]=Math.sin(c)*f;a[2]=
d*b;return a};e.transformMat4=function(a,b,c){var d=b[0],f=b[1];b=b[2];var e=c[3]*d+c[7]*f+c[11]*b+c[15],e=e||1;a[0]=(c[0]*d+c[4]*f+c[8]*b+c[12])/e;a[1]=(c[1]*d+c[5]*f+c[9]*b+c[13])/e;a[2]=(c[2]*d+c[6]*f+c[10]*b+c[14])/e;return a};e.transformMat3=function(a,b,c){var d=b[0],f=b[1];b=b[2];a[0]=d*c[0]+f*c[3]+b*c[6];a[1]=d*c[1]+f*c[4]+b*c[7];a[2]=d*c[2]+f*c[5]+b*c[8];return a};e.transformQuat=function(a,b,c){var d=b[0],f=b[1],e=b[2];b=c[0];var g=c[1],l=c[2];c=c[3];var m=c*d+g*e-l*f,k=c*f+l*d-b*e,v=c*
e+b*f-g*d,d=-b*d-g*f-l*e;a[0]=m*c+d*-b+k*-l-v*-g;a[1]=k*c+d*-g+v*-b-m*-l;a[2]=v*c+d*-l+m*-g-k*-b;return a};e.rotateX=function(a,b,c,d){var f=[],e=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];e[0]=f[0];e[1]=f[1]*Math.cos(d)-f[2]*Math.sin(d);e[2]=f[1]*Math.sin(d)+f[2]*Math.cos(d);a[0]=e[0]+c[0];a[1]=e[1]+c[1];a[2]=e[2]+c[2];return a};e.rotateY=function(a,b,c,d){var f=[],e=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];e[0]=f[2]*Math.sin(d)+f[0]*Math.cos(d);e[1]=f[1];e[2]=f[2]*Math.cos(d)-f[0]*Math.sin(d);
a[0]=e[0]+c[0];a[1]=e[1]+c[1];a[2]=e[2]+c[2];return a};e.rotateZ=function(a,b,c,d){var f=[],e=[];f[0]=b[0]-c[0];f[1]=b[1]-c[1];f[2]=b[2]-c[2];e[0]=f[0]*Math.cos(d)-f[1]*Math.sin(d);e[1]=f[0]*Math.sin(d)+f[1]*Math.cos(d);e[2]=f[2];a[0]=e[0]+c[0];a[1]=e[1]+c[1];a[2]=e[2]+c[2];return a};e.forEach=function(){var a=e.create();return function(b,c,d,f,e,g){c||(c=3);d||(d=0);for(f=f?Math.min(f*c+d,b.length):b.length;d<f;d+=c)a[0]=b[d],a[1]=b[d+1],a[2]=b[d+2],e(a,a,g),b[d]=a[0],b[d+1]=a[1],b[d+2]=a[2];return b}}();
e.angle=function(a,b){a=e.fromValues(a[0],a[1],a[2]);b=e.fromValues(b[0],b[1],b[2]);e.normalize(a,a);e.normalize(b,b);b=e.dot(a,b);return 1<b?0:Math.acos(b)};e.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};e.equals=function(a,b){var c=a[0],d=a[1];a=a[2];var f=b[0],e=b[1];b=b[2];return Math.abs(c-f)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(d-e)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(e))&&Math.abs(a-
b)<=n.EPSILON*Math.max(1,Math.abs(a),Math.abs(b))};return e})},"esri/views/vectorTiles/renderers/Renderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../GeometryUtils ./BackgroundRenderer ./CircleRenderer ./FadeRecorder ./FillRenderer ./LineRenderer ./SymbolRenderer ./TileInfoRenderer ./shaders/ProgramCache ../../webgl/FramebufferObject".split(" "),function(n,e,a,b,c,d,f,h,g,l,m,k,v){return function(){function e(){this._extrudeRotateVector=new Float32Array([0,0,1]);this._extrudeScaleVector=
new Float32Array([1,1,1]);this._state={rotation:0,width:0,height:0};this._cachedRotation=this._cachedHeight=this._cachedWidth=0;this._programCache=null}e.prototype.initialize=function(a,b,c){void 0===c&&(c=!0);this._SpriteMosaic=a;this._glyphMosaic=b;this._ignoreSpeed=!c;this._fadeRecorder=new f.FadeRecorder(300);this._extrudeMatrix=new Float32Array(16);this._extrudeNoRotationMatrix=new Float32Array(16);this._backgroundColor=new Float32Array([1,0,0,1])};e.prototype.dispose=function(){this._backgroundRenderer&&
(this._backgroundRenderer.dispose(),this._backgroundRenderer=null);this._lineRenderer&&(this._lineRenderer.dispose(),this._lineRenderer=null);this._fillRenderer&&(this._fillRenderer.dispose(),this._fillRenderer=null);this._symbolRenderer&&(this._symbolRenderer.dispose(),this._symbolRenderer=null);this._circleRenderer&&(this._circleRenderer.dispose(),this._circleRenderer=null);this._tileInfoRenderer&&(this._tileInfoRenderer.dispose(),this._tileInfoRenderer=null);this._hittestFBO&&(this._hittestFBO.dispose(),
this._hittestFBO=null);this._programCache&&this._programCache.dispose()};e.prototype.initializeProgramCache=function(a){if(null===this._programCache){var b=new k.default;b.initialize(a);this._backgroundRenderer=new c(b);this._lineRenderer=new g(b);this._fillRenderer=new h(b);this._symbolRenderer=new l(b);this._circleRenderer=new d(b);this._tileInfoRenderer=new m(b);this._programCache=b}};e.prototype.setStateParams=function(c,d,e){this._fadeRecorder.recordLevel(e);this._state=c;if(this._state.width!==
this._cachedWidth||this._state.height!==this._cachedHeight||this._state.rotation!==this._cachedRotation)this._extrudeScaleVector[0]=2/c.width,this._extrudeScaleVector[1]=-2/c.height,a.identity(this._extrudeMatrix),a.rotate(this._extrudeMatrix,this._extrudeMatrix,-c.rotation*b.C_DEG_TO_RAD,this._extrudeRotateVector),a.scale(this._extrudeMatrix,this._extrudeMatrix,this._extrudeScaleVector),a.transpose(this._extrudeMatrix,this._extrudeMatrix),a.identity(this._extrudeNoRotationMatrix),a.scale(this._extrudeNoRotationMatrix,
this._extrudeNoRotationMatrix,this._extrudeScaleVector),a.transpose(this._extrudeNoRotationMatrix,this._extrudeNoRotationMatrix),this._cachedWidth=this._state.width,this._cachedHeight=this._state.height,this._cachedRotation=this._state.rotation};e.prototype.drawClippingMasks=function(a,b){if(0!==b.length){a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setStencilTestEnabled(!0);a.setBlendingEnabled(!1);a.setColorMask(!1,!1,!1,!1);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255);a.setClearStencil(0);
a.clear(a.gl.STENCIL_BUFFER_BIT);for(var c=0;c<b.length;c++){var d=b[c];d.attached&&d.visible&&(a.setStencilFunctionSeparate(1032,519,d.stencilData.reference,d.stencilData.mask),this._backgroundRenderer.renderSolidColor(a,{u_matrix:d.tileTransform.transform,u_normalized_origin:d.tileTransform.displayCoord,u_coord_range:d.coordRange,u_depth:0,u_color:this._backgroundColor}))}a.setColorMask(!0,!0,!0,!0);a.setBlendingEnabled(!0)}};e.prototype.renderDebug=function(a,b){var c=b.key;this._backgroundColor.set([c.col%
2,c.row%2,0===c.col%2&&0===c.row%2?1:0,.5]);this._backgroundRenderer.renderSolidColor(a,{u_matrix:b.tileTransform.transform,u_normalized_origin:b.tileTransform.displayCoord,u_coord_range:b.coordRange,u_depth:0,u_color:this._backgroundColor})};e.prototype.renderBucket=function(a,b,c,d,e,f,g,k){if(!(void 0!==g.minzoom&&g.minzoom>c+1E-6||void 0!==g.maxzoom&&g.maxzoom<=c-1E-6))switch(b.type){case 0:2!==e&&this._renderBackground(a,b,c,e,f,g,k);break;case 1:2!==e&&this._renderFill(a,b,c,e,f,g,k);break;
case 2:1!==e&&3!==e||this._renderLine(a,b,c,e,f,g,k);break;case 3:2!==e&&3!==e||this._renderSymbol(a,b,c,e,d,f,g,k);break;case 4:2!==e&&3!==e||this._renderCircle(a,b,c,e,d,f,g,k)}};e.prototype.renderTileInfo=function(a,b){this._tileInfoRenderer.render(a,b)};e.prototype.needsRedraw=function(){return this._fadeRecorder.needsRedraw()};e.prototype.hitTest=function(a,b,c,d,e,f,g){var k=[0,0],h=[0,0],l=a.state;l.toMap(k,[0,0]);l.toMap(h,[f,f]);b=d.filter(function(a){return!(k[0]>a.bounds[2]||h[0]<a.bounds[0]||
k[1]<a.bounds[3]||h[1]>a.bounds[1])});if(0===b.length)return[];b.sort(function(a,b){return a.key.level-b.key.level});c=b.length;for(d=1;d<=c;d++){var m=b[d-1];m.attached&&(m.stencilData.reference=d,m.stencilData.mask=255)}g(l,e,b);e=a.context;this._hittestFBO||(this._hittestFBO=v.create(e,{colorTarget:0,depthStencilTarget:3,width:f,height:f}));g=e.getViewport();l=e.getBoundFramebufferObject();e.bindFramebuffer(this._hittestFBO);e.setViewport(0,0,f,f);d=e.gl;e.setDepthWriteEnabled(!0);e.setStencilWriteMask(255);
e.setClearColor(1,1,1,1);e.setClearDepth(1);e.setClearStencil(0);e.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT);e.setDepthWriteEnabled(!1);this.drawClippingMasks(e,b);e.setBlendingEnabled(!1);e.setStencilWriteMask(0);e.setStencilOp(7680,7680,7681);e.setDepthFunction(515);e.setDepthTestEnabled(!0);e.setDepthWriteEnabled(!0);e.setStencilTestEnabled(!0);for(d=0;d<c;d++)m=b[d],m.attached&&m.doRender(a);e.setStencilTestEnabled(!1);e.setDepthTestEnabled(!1);this._readbackBuffer||(this._readbackBuffer=
new Uint8Array(4*f*f),this._readbackBuffer32=new Uint32Array(this._readbackBuffer.buffer));this._hittestFBO.readPixels(0,0,f,f,6408,5121,this._readbackBuffer);a=new Set;f*=f;b=this._readbackBuffer32[Math.round(f/2)];4294967295!==b&&a.add(b);for(d=0;d<f;d++)b=this._readbackBuffer32[d],4294967295!==b&&a.add(b);e.bindFramebuffer(l);e.setViewport(g.x,g.y,g.width,g.height);var p=[];a.forEach(function(a){p.push(a)});return p};e.prototype._renderBackground=function(a,b,c,d,e,f,g){this._backgroundRenderer.render(a,
b,c,d,e,f,this._SpriteMosaic,this._SpriteMosaic.pixelRatio,g)};e.prototype._renderLine=function(a,b,c,d,e,f,g){this._lineRenderer.render(a,b,c,d,this._state,e,f,this._SpriteMosaic,this._extrudeMatrix,this._SpriteMosaic.pixelRatio,g)};e.prototype._renderFill=function(a,b,c,d,e,f,g){this._fillRenderer.render(a,b,c,this._state.rotation,d,e,f,this._SpriteMosaic,this._extrudeMatrix,this._SpriteMosaic.pixelRatio,g)};e.prototype._renderCircle=function(a,b,c,d,e,f,g,k){var h=!0;e===f.key.level&&(h=!1);a.setStencilTestEnabled(h);
this._circleRenderer.render(a,b,c,d,this._state.rotation,f,g,this._extrudeMatrix,k)};e.prototype._renderSymbol=function(a,b,c,d,e,f,g,k){var h=!0;e===f.key.level&&(h=!1);a.setStencilTestEnabled(h);this._symbolRenderer.render(a,b,c,d,this._state.rotation,this._fadeRecorder.getFadeValues(this._ignoreSpeed),f,g,this._SpriteMosaic,this._glyphMosaic,this._extrudeMatrix,this._extrudeNoRotationMatrix,this._SpriteMosaic.pixelRatio,k)};return e}()})},"esri/views/vectorTiles/renderers/BackgroundRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat3 ../../../core/libs/gl-matrix/vec4 ../MemoryBuffer ./rendererUtils ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f,h){return function(){function e(c){this._patternMatrix=a.create();this._color=b.create();this._rendererInitialized=this._solidrendererInitialized=!1;this._programOptions={id:!1,pattern:!1};this._programCache=c;this._color.set([1,0,0,1])}e.prototype.dispose=function(){this._solidVertexArrayObject&&(this._solidVertexArrayObject.dispose(),this._solidVertexArrayObject=null);this._vertexArrayObject&&(this._vertexArrayObject.dispose(),this._vertexArrayObject=null)};e.prototype.renderSolidColor=
function(a,b){this._solidrendererInitialized||this._initializeSolidRenderer(a);a.bindVAO(this._solidVertexArrayObject);var c=this._programOptions;c.id=!1;c.pattern=!1;c=this._programCache.getProgram(0,0,c);a.bindProgram(c);c.setUniformMatrix4fv("u_transformMatrix",b.u_matrix);c.setUniform2fv("u_normalized_origin",b.u_normalized_origin);c.setUniform1f("u_coord_range",b.u_coord_range||4096);c.setUniform1f("u_depth",b.u_depth||0);c.setUniform4fv("u_color",b.u_color||this._color);a.drawArrays(5,0,4);
a.bindVAO()};e.prototype.render=function(b,c,e,f,g,h,r,n,u){this._rendererInitialized||this._initialize(b);var k=h.getPaintValue("background-color",e);u*=h.getPaintValue("background-opacity",e);var l=h.getPaintValue("background-pattern",e),m=void 0!==l,q=k[3]*u,p=m||1>q;if(!p||0!==f)if(p||1!==f){f=3===f;p=this._programOptions;p.id=f;p.pattern=m;p=this._programCache.getProgram(0,(f?1:0)<<1|(m?1:0),p);b.bindVAO(this._vertexArrayObject);b.bindProgram(p);p.setUniform1f("u_coord_range",g.coordRange);p.setUniform1f("u_depth",
h.z||0);p.setUniformMatrix4fv("u_transformMatrix",g.tileTransform.transform);p.setUniform2fv("u_normalized_origin",g.tileTransform.displayCoord);if(m){h=r.getMosaicItemPosition(l,!0);if(!h)return;e=512*Math.pow(2,Math.floor(e)-g.key.level)*n;a.identity(this._patternMatrix);g=e/h.size[1];this._patternMatrix[0]=e/h.size[0];this._patternMatrix[4]=g;r.bind(b,9729,0);p.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix);p.setUniform1f("u_opacity",u);p.setUniform2f("u_pattern_tl",h.tl[0],h.tl[1]);
p.setUniform2f("u_pattern_br",h.br[0],h.br[1]);p.setUniform1i("u_texture",0)}else this._color[0]=q*k[0],this._color[1]=q*k[1],this._color[2]=q*k[2],this._color[3]=q,p.setUniform4fv("u_color",this._color);f&&(c=d.int32To4Bytes(c.layerID),p.setUniform4f("u_id",c[0],c[1],c[2],c[3]));b.drawArrays(5,0,4);b.bindVAO()}};e.prototype._initializeSolidRenderer=function(a){if(this._solidrendererInitialized)return!0;var b=new Int8Array([0,0,1,0,0,1,1,1]),b=f.createVertex(a,35044,b);this._solidVertexArrayObject=
new h(a,this._programCache.getProgramAttributes(0),{geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},{geometry:b});return this._solidrendererInitialized=!0};e.prototype._initialize=function(a){if(this._rendererInitialized)return!0;var b=[];b.push(c.i1616to32(0,0));b.push(c.i1616to32(1,0));b.push(c.i1616to32(0,1));b.push(c.i1616to32(1,1));b=new Uint32Array(b);b=f.createVertex(a,35044,b);this._vertexArrayObject=new h(a,{a_pos:0},{geometry:[{name:"a_pos",count:2,
type:5122,offset:0,stride:4,normalized:!1,divisor:0}]},{geometry:b});return this._rendererInitialized=!0};return e}()})},"esri/core/libs/gl-matrix/mat3":function(){define(["./common"],function(n){var e={create:function(){var a=new n.ARRAY_TYPE(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},fromMat4:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a},clone:function(a){var b=new n.ARRAY_TYPE(9);b[0]=a[0];b[1]=
a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b},copy:function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a},fromValues:function(a,b,c,d,e,h,g,l,m){var f=new n.ARRAY_TYPE(9);f[0]=a;f[1]=b;f[2]=c;f[3]=d;f[4]=e;f[5]=h;f[6]=g;f[7]=l;f[8]=m;return f},set:function(a,b,c,d,e,h,g,l,m,k){a[0]=b;a[1]=c;a[2]=d;a[3]=e;a[4]=h;a[5]=g;a[6]=l;a[7]=m;a[8]=k;return a},identity:function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=
1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a},transpose:function(a,b){if(a===b){var c=b[1],d=b[2],e=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=d;a[7]=e}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a},invert:function(a,b){var c=b[0],d=b[1],e=b[2],h=b[3],g=b[4],l=b[5],m=b[6],k=b[7];b=b[8];var n=b*g-l*k,q=-b*h+l*m,p=k*h-g*m,r=c*n+d*q+e*p;if(!r)return null;r=1/r;a[0]=n*r;a[1]=(-b*d+e*k)*r;a[2]=(l*d-e*g)*r;a[3]=q*r;a[4]=(b*c-e*m)*r;a[5]=(-l*c+e*h)*
r;a[6]=p*r;a[7]=(-k*c+d*m)*r;a[8]=(g*c-d*h)*r;return a},adjoint:function(a,b){var c=b[0],d=b[1],e=b[2],h=b[3],g=b[4],l=b[5],m=b[6],k=b[7];b=b[8];a[0]=g*b-l*k;a[1]=e*k-d*b;a[2]=d*l-e*g;a[3]=l*m-h*b;a[4]=c*b-e*m;a[5]=e*h-c*l;a[6]=h*k-g*m;a[7]=d*m-c*k;a[8]=c*g-d*h;return a},determinant:function(a){var b=a[3],c=a[4],d=a[5],e=a[6],h=a[7],g=a[8];return a[0]*(g*c-d*h)+a[1]*(-g*b+d*e)+a[2]*(h*b-c*e)},multiply:function(a,b,c){var d=b[0],e=b[1],h=b[2],g=b[3],l=b[4],m=b[5],k=b[6],n=b[7];b=b[8];var q=c[0],p=
c[1],r=c[2],t=c[3],u=c[4],x=c[5],z=c[6],w=c[7];c=c[8];a[0]=q*d+p*g+r*k;a[1]=q*e+p*l+r*n;a[2]=q*h+p*m+r*b;a[3]=t*d+u*g+x*k;a[4]=t*e+u*l+x*n;a[5]=t*h+u*m+x*b;a[6]=z*d+w*g+c*k;a[7]=z*e+w*l+c*n;a[8]=z*h+w*m+c*b;return a}};e.mul=e.multiply;e.translate=function(a,b,c){var d=b[0],e=b[1],h=b[2],g=b[3],l=b[4],m=b[5],k=b[6],n=b[7];b=b[8];var q=c[0];c=c[1];a[0]=d;a[1]=e;a[2]=h;a[3]=g;a[4]=l;a[5]=m;a[6]=q*d+c*g+k;a[7]=q*e+c*l+n;a[8]=q*h+c*m+b;return a};e.rotate=function(a,b,c){var d=b[0],e=b[1],h=b[2],g=b[3],
l=b[4],m=b[5],k=b[6],n=b[7];b=b[8];var q=Math.sin(c);c=Math.cos(c);a[0]=c*d+q*g;a[1]=c*e+q*l;a[2]=c*h+q*m;a[3]=c*g-q*d;a[4]=c*l-q*e;a[5]=c*m-q*h;a[6]=k;a[7]=n;a[8]=b;return a};e.scale=function(a,b,c){var d=c[0];c=c[1];a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};e.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];a[7]=b[1];a[8]=1;return a};e.fromRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);
a[0]=b;a[1]=c;a[2]=0;a[3]=-c;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};e.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};e.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};e.fromQuat=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var h=c+c,g=d+d,l=e+e,c=c*h,m=d*h,d=d*g,k=e*h,n=e*g,e=e*l,h=b*h,g=b*g;b*=l;a[0]=1-d-e;a[3]=m-b;a[6]=k+g;a[1]=m+b;a[4]=1-c-e;a[7]=n-h;a[2]=k-g;a[5]=
n+h;a[8]=1-c-d;return a};e.normalFromMat4=function(a,b){var c=b[0],d=b[1],e=b[2],h=b[3],g=b[4],l=b[5],m=b[6],k=b[7],n=b[8],q=b[9],p=b[10],r=b[11],t=b[12],u=b[13],x=b[14];b=b[15];var z=c*l-d*g,w=c*m-e*g,y=c*k-h*g,A=d*m-e*l,H=d*k-h*l,D=e*k-h*m,E=n*u-q*t,J=n*x-p*t,n=n*b-r*t,F=q*x-p*u,q=q*b-r*u,p=p*b-r*x,r=z*p-w*q+y*F+A*n-H*J+D*E;if(!r)return null;r=1/r;a[0]=(l*p-m*q+k*F)*r;a[1]=(m*n-g*p-k*J)*r;a[2]=(g*q-l*n+k*E)*r;a[3]=(e*q-d*p-h*F)*r;a[4]=(c*p-e*n+h*J)*r;a[5]=(d*n-c*q-h*E)*r;a[6]=(u*D-x*H+b*A)*r;a[7]=
(x*y-t*D-b*w)*r;a[8]=(t*H-u*y+b*z)*r;return a};e.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};e.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))};e.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];
a[8]=b[8]+c[8];return a};e.subtract=function(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];a[8]=b[8]-c[8];return a};e.sub=e.subtract;e.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;return a};e.multiplyScalarAndAdd=function(a,b,c,d){a[0]=b[0]+c[0]*d;a[1]=b[1]+c[1]*d;a[2]=b[2]+c[2]*d;a[3]=b[3]+c[3]*d;a[4]=b[4]+c[4]*d;a[5]=b[5]+
c[5]*d;a[6]=b[6]+c[6]*d;a[7]=b[7]+c[7]*d;a[8]=b[8]+c[8]*d;return a};e.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};e.equals=function(a,b){var c=a[0],d=a[1],e=a[2],h=a[3],g=a[4],l=a[5],m=a[6],k=a[7],v=a[8],q=b[0],p=b[1],r=b[2],t=b[3],u=b[4],x=b[5];a=a[6];var z=b[7];b=b[8];return Math.abs(c-q)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(q))&&Math.abs(d-p)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(p))&&
Math.abs(e-r)<=n.EPSILON*Math.max(1,Math.abs(e),Math.abs(r))&&Math.abs(h-t)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(t))&&Math.abs(g-u)<=n.EPSILON*Math.max(1,Math.abs(g),Math.abs(u))&&Math.abs(l-x)<=n.EPSILON*Math.max(1,Math.abs(l),Math.abs(x))&&Math.abs(m-a)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(a))&&Math.abs(k-z)<=n.EPSILON*Math.max(1,Math.abs(k),Math.abs(z))&&Math.abs(v-b)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(b))};return e})},"esri/views/vectorTiles/MemoryBuffer":function(){define(["require",
"exports"],function(n,e){return function(){function a(a){this._array=[];0>=a&&console.error("strideInBytes must be positive!");this._stride=a}Object.defineProperty(a.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"index",{get:function(){return 4*this._array.length/this._stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"itemSize",{get:function(){return this._stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"sizeInBytes",{get:function(){return 4*this._array.length},enumerable:!0,configurable:!0});a.prototype.reset=function(){this.array.length=0};a.prototype.toBuffer=function(){return(new Uint32Array(this._array)).buffer};a.i1616to32=function(a,c){return 65535&a|c<<16};a.i8888to32=function(a,c,d,e){return a&255|(c&255)<<8|(d&255)<<16|e<<24};a.i8816to32=function(a,c,d){return a&255|(c&255)<<8|d<<16};return a}()})},"esri/views/vectorTiles/renderers/rendererUtils":function(){define(["require","exports"],
function(n,e){Object.defineProperty(e,"__esModule",{value:!0});var a=new Uint32Array(1),b=new Uint8Array(a.buffer);e.int32To4Bytes=function(c){a[0]=c|0;return[b[0],b[1],b[2],b[3]]}})},"esri/views/vectorTiles/renderers/CircleRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec3 ../../../core/libs/gl-matrix/vec4 ../GeometryUtils ./rendererUtils ../../webgl/VertexArrayObject".split(" "),function(n,e,a,b,c,d,f,h){return function(){function e(d){this._initialized=
!1;this._programOptions={id:!1};this._programCache=d;this._viewProjMat=a.create();this._offsetVector=b.create();this._color=c.create();this._strokeColor=c.create()}e.prototype.dispose=function(){};e.prototype.render=function(b,c,e,g,h,p,n,t,u){if(0!==c.triangleElementCount){this._initialized||this._initialize(b);var k=n.hasDataDrivenRadius?1:n.getPaintValue("circle-radius",e),l=n.hasDataDrivenColor?[1,1,1,1]:n.getPaintValue("circle-color",e),m=n.hasDataDrivenOpacity?1:n.getPaintValue("circle-opacity",
e),q=n.hasDataDrivenStrokeWidth?1:n.getPaintValue("circle-stroke-width",e),r=n.hasDataDrivenStrokeColor?[1,1,1,1]:n.getPaintValue("circle-stroke-color",e),v=n.hasDataDrivenStrokeOpacity?1:n.getPaintValue("circle-stroke-opacity",e),D=n.hasDataDrivenBlur?0:n.getPaintValue("circle-blur",e),m=m*l[3]*u;this._color[0]=m*l[0];this._color[1]=m*l[1];this._color[2]=m*l[2];this._color[3]=m;m=v*r[3]*u;this._strokeColor[0]=m*r[0];this._strokeColor[1]=m*r[1];this._strokeColor[2]=m*r[2];this._strokeColor[3]=m;u=
p.tileTransform.transform;l=n.getPaintValue("circle-translate",e);if(0!==l[0]||0!==l[1])a.copy(this._viewProjMat,p.tileTransform.transform),u=l[0],l=l[1],v=r=0,v=(1<<p.key.level)/Math.pow(2,e)*(p.coordRange/512),1===n.getPaintValue("circle-translate-anchor",e)?(h*=-d.C_DEG_TO_RAD,e=Math.sin(h),h=Math.cos(h),r=v*(u*h-l*e),v*=u*e+l*h):(r=v*u,v*=l),this._offsetVector[0]=r,this._offsetVector[1]=v,this._offsetVector[2]=0,a.translate(this._viewProjMat,this._viewProjMat,this._offsetVector),u=this._viewProjMat;
if(e=this._getCircleVAO(b,p))b.bindVAO(e),g=3===g,e=this._programOptions,e.id=g,e=this._programCache.getProgram(5,g?1:0,e),b.bindProgram(e),e.setUniformMatrix4fv("u_transformMatrix",u),e.setUniformMatrix4fv("u_extrudeMatrix",t),e.setUniform2fv("u_normalized_origin",p.tileTransform.displayCoord),e.setUniform1f("u_depth",n.z),e.setUniform1f("u_radius",k),e.setUniform4fv("u_color",this._color),e.setUniform1f("u_blur",D),e.setUniform1f("u_stroke_width",q),e.setUniform4fv("u_stroke_color",this._strokeColor),
e.setUniform1f("u_antialiasingWidth",1.2),g&&(p=f.int32To4Bytes(c.layerID),e.setUniform4f("u_id",p[0],p[1],p[2],p[3])),b.drawElements(4,c.triangleElementCount,5125,12*c.triangleElementStart),b.bindVAO()}};e.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:16,normalized:!0,divisor:0},{name:"a_stroke_color",count:4,type:5121,offset:8,
stride:16,normalized:!0,divisor:0},{name:"a_data",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};return this._initialized=!0};e.prototype._getCircleVAO=function(a,b){if(b.circleVertexArrayObject)return b.circleVertexArrayObject;var c=b.circleVertexBuffer,d=b.circleIndexBuffer;if(!c||!d)return null;b.circleVertexArrayObject=new h(a,this._programCache.getProgramAttributes(5),this._vertexAttributes,{geometry:c},d);return b.circleVertexArrayObject};return e}()})},"esri/views/vectorTiles/renderers/FadeRecorder":function(){define(["require",
"exports","../../../core/now"],function(n,e,a){Object.defineProperty(e,"__esModule",{value:!0});(function(){return function(a,c){this.level=a;this.now=c}})();n=function(){return function(a,c,d,e){this.fadeSpeed=a;this.minfadeLevel=c;this.maxfadeLevel=d;this.fadeChange=e}}();e.FadeProperties=n;n=function(){function b(a){void 0===a&&(a=300);this._levelSnapshots=[];this._duration=a}b.prototype.recordLevel=function(b){var c=a(),e=this._levelSnapshots;0===e.length&&(e.push({level:b,now:0}),e.push({level:b,
now:0}));2!==e.length&&e[0].level===b||e.push({level:b,now:c})};b.prototype.needsRedraw=function(){if(0===this._levelSnapshots.length)return!1;for(var a=this._duration,b=this._levelSnapshots,e=b.length,h=b[e-1],g=-1;e>g+1&&b[g+1].now+a<h.now;)g++;for(0>g&&(g=0);g<e;g++)if(b[g].level!==h.level)return!0;return!1};b.prototype.getFadeValues=function(b){void 0===b&&(b=!1);for(var c=this._duration,e=a(),h=this._levelSnapshots;3<h.length&&h[1].now+c<e;)h.shift();h[1].now+c<e&&(h[0].level=h[1].level);var g=
h[0].level,l=h[h.length-1],m=l.level,k=Math.min(g,m),g=Math.max(g,m),h=(l.level-h[1].level)/((l.now-h[1].now)/c);return b?{fadeSpeed:0,minfadeLevel:k,maxfadeLevel:g,fadeChange:0}:{fadeSpeed:h,minfadeLevel:k,maxfadeLevel:g,fadeChange:(e-l.now)/c*h}};return b}();e.FadeRecorder=n})},"esri/views/vectorTiles/renderers/FillRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat3 ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec3 ../../../core/libs/gl-matrix/vec4 ../GeometryUtils ./rendererUtils ../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f,h,g){var l=1/65536;return function(){function e(e){this._initialized=!1;this._fillProgramOptions={id:!1,dd:!1,pattern:!1};this._outlineProgramOptions={id:!1,dd:!1};this._programCache=e;this._viewProjMat=b.create();this._offsetVector=c.create();this._patternMatrix=a.create();this._color=d.create();this._outlineColor=d.create()}e.prototype.dispose=function(){};e.prototype.render=function(a,c,d,e,g,m,n,x,z,w,y){if(0!==c.triangleElementCount){this._initialized||this._initialize(a);
var k=void 0!==n.getPaintValue("fill-pattern",d),p=n.hasDataDrivenColor?[1,1,1,1]:n.getPaintValue("fill-color",d),q=n.hasDataDrivenOpacity?1:n.getPaintValue("fill-opacity",d),r=q*p[3]*y;this._color[0]=r*p[0];this._color[1]=r*p[1];this._color[2]=r*p[2];this._color[3]=r;var p=3===g,t;p&&(t=h.int32To4Bytes(c.layerID));var r=m.tileTransform.transform,v=m.coordRange/512,u=n.getPaintValue("fill-translate",d);if(0!==u[0]||0!==u[1]){b.copy(this._viewProjMat,m.tileTransform.transform);var r=u[0],u=u[1],G=
0,I=0,v=(1<<m.key.level)/Math.pow(2,d)*v;1===n.getPaintValue("fill-translate-anchor",d)?(G=-f.C_DEG_TO_RAD*e,e=Math.sin(G),I=Math.cos(G),G=v*(r*I-u*e),I=v*(r*e+u*I)):(G=v*r,I=v*u);this._offsetVector[0]=G;this._offsetVector[1]=I;this._offsetVector[2]=0;b.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);r=this._viewProjMat}this._drawFill(a,c,d,g,m,n,x,r,w,y,p,t);if(n.getPaintValue("fill-antialias",d)&&!k&&0<c.outlineElementCount&&(1===g||3===g)){g=n.hasDataDrivenOutline;if(n.outlineUsesFillColor){if(1!==
this._color[3])return;this._outlineColor[0]=this._color[0];this._outlineColor[1]=this._color[1];this._outlineColor[2]=this._color[2];this._outlineColor[3]=this._color[3]}else d=n.hasDataDrivenOutlineColor?[1,1,1,1]:n.getPaintValue("fill-outline-color",d),y*=q*d[3],this._outlineColor[0]=y*d[0],this._outlineColor[1]=y*d[1],this._outlineColor[2]=y*d[2],this._outlineColor[3]=y;w=.75/w;if(y=this._getOutlineVAO(a,m,g))a.bindVAO(y),y=this._outlineProgramOptions,y.id=p,y.dd=g,y=this._programCache.getProgram(2,
(p?1:0)<<1|(g?1:0),y),a.bindProgram(y),y.setUniformMatrix4fv("u_transformMatrix",r),y.setUniformMatrix4fv("u_extrudeMatrix",z),y.setUniform2fv("u_normalized_origin",m.tileTransform.displayCoord),y.setUniform1f("u_depth",n.z+l),y.setUniform1f("u_outline_width",w),y.setUniform4fv("u_color",this._outlineColor),p&&y.setUniform4f("u_id",t[0],t[1],t[2],t[3]),a.drawElements(4,c.outlineElementCount,5125,12*c.outlineElementStart),a.bindVAO()}}};e.prototype._initialize=function(a){if(this._initialized)return!0;
this._fillVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:4,normalized:!1,divisor:0}]};this._fillVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:4,stride:8,normalized:!0,divisor:0}]};this._outlineVertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:8,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:8,normalized:!1,divisor:0},
{name:"a_xnormal",count:2,type:5120,offset:6,stride:8,normalized:!1,divisor:0}]};this._outlineVertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offset",count:2,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_xnormal",count:2,type:5120,offset:6,stride:12,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:8,stride:12,normalized:!0,divisor:0}]};return this._initialized=!0};e.prototype._drawFill=function(b,
c,d,e,f,g,h,m,n,w,y,A){var k=g.getPaintValue("fill-pattern",d),p=void 0!==k,q=g.hasDataDrivenOpacity?1:w*g.getPaintValue("fill-opacity",d),r=g.hasDataDrivenColor?[1,1,1,1]:g.getPaintValue("fill-color",d);w*=q*r[3];this._color[0]=w*r[0];this._color[1]=w*r[1];this._color[2]=w*r[2];this._color[3]=w;r=g.hasDataDrivenFill;w=p||1>w||r;if(!w||0!==e)if(w||1!==e)if(e=this._getFillVAO(b,f,r))b.bindVAO(e),e=this._fillProgramOptions,e.id=y,e.dd=r,e.pattern=p,e=this._programCache.getProgram(1,(y?1:0)<<2|(r?1:
0)<<1|(p?1:0),e),b.bindProgram(e),p&&(k=h.getMosaicItemPosition(k,!0))&&(d=f.coordRange/512/Math.pow(2,Math.round(d)-f.key.level)/n,a.identity(this._patternMatrix),n=1/(k.size[1]*d),this._patternMatrix[0]=1/(k.size[0]*d),this._patternMatrix[4]=n,h.bind(b,9729,k.page,1),e.setUniformMatrix3fv("u_pattern_matrix",this._patternMatrix),e.setUniform2f("u_pattern_tl",k.tl[0],k.tl[1]),e.setUniform2f("u_pattern_br",k.br[0],k.br[1]),e.setUniform1i("u_texture",1)),e.setUniformMatrix4fv("u_transformMatrix",m),
e.setUniform2fv("u_normalized_origin",f.tileTransform.displayCoord),e.setUniform1f("u_depth",g.z+l),e.setUniform4fv("u_color",this._color),y&&e.setUniform4f("u_id",A[0],A[1],A[2],A[3]),b.drawElements(4,c.triangleElementCount,5125,12*c.triangleElementStart),b.bindVAO()};e.prototype._getFillVAO=function(a,b,c){if(c){if(b.fillDDVertexArrayObject)return b.fillDDVertexArrayObject;c=b.fillDDVertexBuffer;var d=b.fillIndexBuffer;if(!c||!d)return null;b.fillDDVertexArrayObject=new g(a,this._programCache.getProgramAttributes(1),
this._fillVertexAttributesDD,{geometry:c},d);return b.fillDDVertexArrayObject}if(b.fillVertexArrayObject)return b.fillVertexArrayObject;c=b.fillVertexBuffer;d=b.fillIndexBuffer;if(!c||!d)return null;b.fillVertexArrayObject=new g(a,this._programCache.getProgramAttributes(1),this._fillVertexAttributes,{geometry:c},d);return b.fillVertexArrayObject};e.prototype._getOutlineVAO=function(a,b,c){if(c){if(b.outlineDDVertexArrayObject)return b.outlineDDVertexArrayObject;c=b.outlineDDVertexBuffer;var d=b.outlineIndexBuffer;
if(!c||!d)return null;b.outlineDDVertexArrayObject=new g(a,this._programCache.getProgramAttributes(2),this._outlineVertexAttributesDD,{geometry:c},d);return b.outlineDDVertexArrayObject}if(b.outlineVertexArrayObject)return b.outlineVertexArrayObject;c=b.outlineVertexBuffer;d=b.outlineIndexBuffer;if(!c||!d)return null;b.outlineVertexArrayObject=new g(a,this._programCache.getProgramAttributes(2),this._outlineVertexAttributes,{geometry:c},d);return b.outlineVertexArrayObject};return e}()})},"esri/views/vectorTiles/renderers/LineRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec2 ../../../core/libs/gl-matrix/vec3 ../../../core/libs/gl-matrix/vec4 ../GeometryUtils ./rendererUtils ../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f,h,g){return function(){function e(e){this._initialized=!1;this._programOptions={id:!1,dd:!1,pattern:!1};this._programCache=e;this._viewProjMat=a.create();this._offsetVector=c.create();this._color=d.create();this._dashArray=b.create()}e.prototype.dispose=function(){};e.prototype.render=function(b,c,d,e,g,l,n,u,x,z,w){if(0!==c.triangleElementCount){this._initialized||this._initialize(b);var k=l.tileTransform.transform,m=l.coordRange/512,p=n.getPaintValue("line-translate",d);if(0!==
p[0]||0!==p[1]){a.copy(this._viewProjMat,l.tileTransform.transform);var k=p[0],p=p[1],q=0,r=0,r=(1<<l.key.level)/Math.pow(2,d)*m;g=g.rotation;if(1===n.getPaintValue("line-translate-anchor",d)){q=-f.C_DEG_TO_RAD*g;g=Math.sin(q);var t=Math.cos(q),q=r*(k*t-p*g),r=r*(k*g+p*t)}else q=r*k,r*=p;this._offsetVector[0]=q;this._offsetVector[1]=r;this._offsetVector[2]=0;a.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);k=this._viewProjMat}p=n.getPaintValue("line-pattern",d);r=void 0!==p;z=1/
z;g=n.getPaintValue("line-blur",d);var t=n.hasDataDrivenColor?[1,1,1,1]:n.getPaintValue("line-color",d),v=n.hasDataDrivenOpacity?1:n.getPaintValue("line-opacity",d),q=n.hasDataDrivenWidth?1:n.getPaintValue("line-width",d);w*=v*t[3];this._color[0]=w*t[0];this._color[1]=w*t[1];this._color[2]=w*t[2];this._color[3]=w;w=n.hasDataDrivenLine;e=3===e;var C;e&&(C=h.int32To4Bytes(c.layerID));if(t=this._getLineVAO(b,l,w)){b.bindVAO(t);t=this._programOptions;t.id=e;t.dd=w;t.pattern=r;w=this._programCache.getProgram(3,
(e?1:0)<<2|(w?1:0)<<1|(r?1:0),t);b.bindProgram(w);w.setUniformMatrix4fv("u_transformMatrix",k);w.setUniformMatrix4fv("u_extrudeMatrix",x);w.setUniform2fv("u_normalized_origin",l.tileTransform.displayCoord);w.setUniform1f("u_depth",n.z);w.setUniform1f("u_blur",g);w.setUniform1f("u_antialiasing",z);w.setUniform4fv("u_color",this._color);w.setUniform1f("u_width",q);e&&w.setUniform4f("u_id",C[0],C[1],C[2],C[3]);if(r){if(d=u.getMosaicItemPosition(p,!0))u.bind(b,9729,d.page,1),w.setUniform2f("u_pattern_tl",
d.tl[0],d.br[1]),w.setUniform2f("u_pattern_br",d.br[0],d.tl[1]),w.setUniform2f("u_spriteSize",m*d.size[0],d.size[1]),w.setUniform1i("u_texture",1)}else u=n.getPaintValue("line-dasharray",d),2>u.length&&(u=[1,-1]),this._dashArray[0]=m*u[0],this._dashArray[1]=m*u[1],w.setUniform2fv("u_dasharray",this._dashArray);b.drawElements(4,c.triangleElementCount,5125,12*c.triangleElementStart);b.bindVAO()}}};e.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",
count:2,type:5122,offset:0,stride:12,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:12,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5123,offset:8,stride:12,normalized:!1,divisor:0}]};this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:20,normalized:!1,divisor:0},{name:"a_offsetAndNormal",count:4,type:5120,offset:4,stride:20,normalized:!1,divisor:0},{name:"a_accumulatedDistance",count:2,type:5122,offset:8,
stride:20,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:12,stride:20,normalized:!0,divisor:0},{name:"a_width",count:1,type:5126,offset:16,stride:20,normalized:!1,divisor:0}]};return this._initialized=!0};e.prototype._getLineVAO=function(a,b,c){if(c){if(b.lineDDVertexArrayObject)return b.lineDDVertexArrayObject;c=b.lineDDVertexBuffer;var d=b.lineIndexBuffer;if(!c||!d)return null;b.lineDDVertexArrayObject=new g(a,this._programCache.getProgramAttributes(3),this._vertexAttributesDD,
{geometry:c},d);return b.lineDDVertexArrayObject}if(b.lineVertexArrayObject)return b.lineVertexArrayObject;c=b.lineVertexBuffer;d=b.lineIndexBuffer;if(!c||!d)return null;b.lineVertexArrayObject=new g(a,this._programCache.getProgramAttributes(3),this._vertexAttributes,{geometry:c},d);return b.lineVertexArrayObject};return e}()})},"esri/views/vectorTiles/renderers/SymbolRenderer":function(){define(["require","exports","./IconRenderer","./SDFRenderer"],function(n,e,a,b){return function(){function c(c){this._iconRenderer=
new a(c);this._sdfRenderer=new b(c)}c.prototype.dispose=function(){this._iconRenderer&&(this._iconRenderer.dispose(),this._iconRenderer=null);this._sdfRenderer&&(this._sdfRenderer.dispose(),this._sdfRenderer=null)};c.prototype.render=function(a,b,c,e,l,m,k,n,q,p,r,t,u,x){b.hasData()&&(0<b.markerPerPageElementsMap.size&&this._iconRenderer.render(a,b,c,e,l,m,k,n,q,r,t,x),0<b.glyphPerPageElementsMap.size&&this._sdfRenderer.render(a,b,c,e,l,m,k,n,p,r,t,u,x))};return c}()})},"esri/views/vectorTiles/renderers/IconRenderer":function(){define("require exports ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec3 ../../../core/libs/gl-matrix/vec4 ../GeometryUtils ./rendererUtils ../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d,f,h){return function(){function e(d){this._spritesTextureSize=new Float32Array(2);this._initialized=!1;this._programOptions={id:!1,dd:!1,sdf:!1};this._programCache=d;this._viewProjMat=a.create();this._offsetVector=b.create();this._color=c.create()}e.prototype.dispose=function(){};e.prototype.render=function(b,c,e,g,h,p,n,t,u,x,z,w){var k=this;this._initialized||this._initialize(b);var l=t.hasDataDrivenIconSize?1:t.getLayoutValue("icon-size",e),m=t.hasDataDrivenIconColor?[1,1,
1,1]:t.getPaintValue("icon-color",e),q=t.hasDataDrivenIconOpacity?1:t.getPaintValue("icon-opacity",e);w*=m[3]*q;this._color[0]=w*m[0];this._color[1]=w*m[1];this._color[2]=w*m[2];this._color[3]=w;m=t.getLayoutValue("icon-rotation-alignment",e);2===m&&(m=1===t.getLayoutValue("symbol-placement",e)?0:1);var r=0===m;w=c.isSDF;q=t.hasDataDrivenIcon;g=3===g;var m=d.degToByte(h),v=n.tileTransform.transform,F=t.getPaintValue("icon-translate",e);if(0!==F[0]||0!==F[1]){a.copy(this._viewProjMat,n.tileTransform.transform);
var v=F[0],F=F[1],C=0,G=0,G=(1<<n.key.level)/Math.pow(2,e)*(n.coordRange/512);if(1===t.getPaintValue("icon-translate-anchor",e)){C=-d.C_DEG_TO_RAD*h;h=Math.sin(C);var I=Math.cos(C),C=G*(v*I-F*h),G=G*(v*h+F*I)}else C=G*v,G*=F;this._offsetVector[0]=C;this._offsetVector[1]=G;this._offsetVector[2]=0;a.translate(this._viewProjMat,this._viewProjMat,this._offsetVector);v=this._viewProjMat}x=r?x:z;if(z=this._getIconVAO(b,n,q)){b.bindVAO(z);z=this._programOptions;z.id=g;z.dd=q;z.sdf=w;var B=this._programCache.getProgram(4,
(g?1:0)<<2|(q?1:0)<<1|(w?1:0),z);b.bindProgram(B);w&&(z=t.getPaintValue("icon-halo-color",e),w=t.getPaintValue("icon-halo-width",e),B.setUniform4f("u_outlineColor",z[0],z[1],z[2],z[3]),B.setUniform1f("u_outlineSize",w));B.setUniformMatrix4fv("u_transformMatrix",v);B.setUniformMatrix4fv("u_extrudeMatrix",x);B.setUniform2fv("u_normalized_origin",n.tileTransform.displayCoord);B.setUniform1f("u_depth",t.z);B.setUniform1f("u_mapRotation",m);B.setUniform1f("u_keepUpright",0);B.setUniform1f("u_level",10*
e);B.setUniform1f("u_fadeSpeed",10*p.fadeSpeed);B.setUniform1f("u_minfadeLevel",10*p.minfadeLevel);B.setUniform1f("u_maxfadeLevel",10*p.maxfadeLevel);B.setUniform1f("u_fadeChange",10*(e+p.fadeChange));B.setUniform1i("u_texture",1);B.setUniform1f("u_size",l);B.setUniform4fv("u_color",this._color);g&&(e=f.int32To4Bytes(c.layerID),B.setUniform4f("u_id",e[0],e[1],e[2],e[3]));c.markerPerPageElementsMap.forEach(function(a,c){k._spritesTextureSize[0]=u.getWidth(c)/4;k._spritesTextureSize[1]=u.getHeight(c)/
4;B.setUniform2fv("u_mosaicSize",k._spritesTextureSize);u.bind(b,9729,c,1);b.drawElements(4,a[1],5125,12*a[0])});b.bindVAO()}};e.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,
offset:12,stride:16,normalized:!1,divisor:0}]};this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,
type:5126,offset:20,stride:24,normalized:!1,divisor:0}]};return this._initialized=!0};e.prototype._getIconVAO=function(a,b,c){if(c){if(b.iconDDVertexArrayObject)return b.iconDDVertexArrayObject;c=b.iconDDVertexBuffer;var d=b.iconIndexBuffer;if(!c||!d)return null;b.iconDDVertexArrayObject=new h(a,this._programCache.getProgramAttributes(4),this._vertexAttributesDD,{geometry:c},d);return b.iconDDVertexArrayObject}if(b.iconVertexArrayObject)return b.iconVertexArrayObject;c=b.iconVertexBuffer;d=b.iconIndexBuffer;
if(!c||!d)return null;b.iconVertexArrayObject=new h(a,this._programCache.getProgramAttributes(4),this._vertexAttributes,{geometry:c},d);return b.iconVertexArrayObject};return e}()})},"esri/views/vectorTiles/renderers/SDFRenderer":function(){define("require exports ../../../core/has ../../../core/libs/gl-matrix/mat4 ../../../core/libs/gl-matrix/vec3 ../../../core/libs/gl-matrix/vec4 ../GeometryUtils ./rendererUtils ../../webgl/VertexArrayObject".split(" "),function(n,e,a,b,c,d,f,h,g){var l=1/65536;
return function(){function e(a){this._initialized=!1;this._programOptions={id:!1,dd:!1};this._programCache=a;this._viewProjMat=b.create();this._offsetVector=c.create();this._extrudeMat=b.create();this._haloColor=d.create();this._sdfColor=d.create();this._scaleVec=c.create()}e.prototype.dispose=function(){};e.prototype.render=function(c,d,e,g,m,n,u,x,z,w,y,A,H){var k=this;if(!a("esri-vector-tiles-avoid-text")){this._initialized||this._initialize(c);var p=f.degToByte(m),q=x.getLayoutValue("text-rotation-alignment",
e);2===q&&(q=1===x.getLayoutValue("symbol-placement",e)?0:1);var r=0===q,q=x.getLayoutValue("text-keep-upright",e)&&r;g=3===g;A=.8*3/A;var t=x.hasDataDrivenTextSize?1:x.getLayoutValue("text-size",e),v=x.hasDataDrivenTextColor?[1,1,1,1]:x.getPaintValue("text-color",e),I=x.hasDataDrivenTextOpacity?1:x.getPaintValue("text-opacity",e),B=v[3]*I*H;this._sdfColor[0]=B*v[0];this._sdfColor[1]=B*v[1];this._sdfColor[2]=B*v[2];this._sdfColor[3]=B;this._glyphTextureSize||(this._glyphTextureSize=new Float32Array([z.width/
4,z.height/4]));v=u.tileTransform.transform;B=x.getPaintValue("text-translate",e);if(0!==B[0]||0!==B[1]){b.copy(this._viewProjMat,u.tileTransform.transform);var v=B[0],B=B[1],M=0,L=0,L=(1<<u.key.level)/Math.pow(2,e)*(u.coordRange/512);if(1===x.getPaintValue("text-translate-anchor",e)){M=-f.C_DEG_TO_RAD*m;m=Math.sin(M);var N=Math.cos(M),M=L*(v*N-B*m),L=L*(v*m+B*N)}else M=L*v,L*=B;this._offsetVector[0]=M;this._offsetVector[1]=L;this._offsetVector[2]=0;b.translate(this._viewProjMat,this._viewProjMat,
this._offsetVector);v=this._viewProjMat}r?b.copy(this._extrudeMat,w):b.copy(this._extrudeMat,y);this._scaleVec[0]=1/24;this._scaleVec[1]=1/24;this._scaleVec[2]=1;b.scale(this._extrudeMat,this._extrudeMat,this._scaleVec);w=x.hasDataDrivenText;if(y=this._getSDFVAO(c,u,w)){c.bindVAO(y);y=this._programOptions;y.id=g;y.dd=w;var K=this._programCache.getProgram(6,(g?1:0)<<1|(w?1:0),y);c.bindProgram(K);K.setUniformMatrix4fv("u_transformMatrix",v);K.setUniformMatrix4fv("u_extrudeMatrix",this._extrudeMat);
K.setUniform2fv("u_normalized_origin",u.tileTransform.displayCoord);K.setUniform1f("u_depth",x.z+l);K.setUniform2fv("u_mosaicSize",this._glyphTextureSize);K.setUniform1f("u_mapRotation",p);K.setUniform1f("u_keepUpright",q?1:0);K.setUniform1f("u_level",10*e);K.setUniform1f("u_fadeSpeed",10*n.fadeSpeed);K.setUniform1f("u_minfadeLevel",10*n.minfadeLevel);K.setUniform1f("u_maxfadeLevel",10*n.maxfadeLevel);K.setUniform1f("u_fadeChange",10*(e+n.fadeChange));K.setUniform1i("u_texture",0);K.setUniform1f("u_size",
t);K.setUniform1f("u_antialiasingWidth",A);g&&(n=h.int32To4Bytes(d.layerID),K.setUniform4f("u_id",n[0],n[1],n[2],n[3]));d.glyphPerPageElementsMap.forEach(function(a,b){k._renderGlyphRange(c,a,b,x,z,K,e,I*H,3)});c.bindVAO()}}};e.prototype._renderGlyphRange=function(a,b,c,d,e,f,g,h,l){e.bind(a,9729,c,0);e=d.getPaintValue("text-halo-color",g);c=d.getPaintValue("text-halo-width",g);0<e[3]&&0<c&&(h*=e[3],this._haloColor[0]=h*e[0],this._haloColor[1]=h*e[1],this._haloColor[2]=h*e[2],this._haloColor[3]=h,
d=d.getPaintValue("text-halo-blur",g)*l,l*=c,f.setUniform4fv("u_color",this._haloColor),f.setUniform1f("u_halo",1),f.setUniform1f("u_edgeDistance",l),f.setUniform1f("u_edgeBlur",d),a.drawElements(4,b[1],5125,12*b[0]));0<this._sdfColor[3]&&(f.setUniform4fv("u_color",this._sdfColor),f.setUniform1f("u_halo",0),f.setUniform1f("u_edgeDistance",0),f.setUniform1f("u_edgeBlur",0),a.drawElements(4,b[1],5125,12*b[0]))};e.prototype._initialize=function(a){if(this._initialized)return!0;this._vertexAttributes=
{geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:16,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:16,normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:16,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:16,normalized:!1,divisor:0}]};this._vertexAttributesDD={geometry:[{name:"a_pos",count:2,type:5122,offset:0,stride:24,normalized:!1,divisor:0},{name:"a_vertexOffset",count:2,type:5122,offset:4,stride:24,
normalized:!1,divisor:0},{name:"a_tex",count:4,type:5121,offset:8,stride:24,normalized:!1,divisor:0},{name:"a_levelInfo",count:4,type:5121,offset:12,stride:24,normalized:!1,divisor:0},{name:"a_color",count:4,type:5121,offset:16,stride:24,normalized:!0,divisor:0},{name:"a_size",count:1,type:5126,offset:20,stride:24,normalized:!1,divisor:0}]};return this._initialized=!0};e.prototype._getSDFVAO=function(a,b,c){if(c){if(b.textDDVertexArrayObject)return b.textDDVertexArrayObject;c=b.textDDVertexBuffer;
var d=b.textIndexBuffer;if(!c||!d)return null;b.textDDVertexArrayObject=new g(a,this._programCache.getProgramAttributes(6),this._vertexAttributesDD,{geometry:c},d);return b.textDDVertexArrayObject}if(b.textVertexArrayObject)return b.textVertexArrayObject;c=b.textVertexBuffer;d=b.textIndexBuffer;if(!c||!d)return null;b.textVertexArrayObject=new g(a,this._programCache.getProgramAttributes(6),this._vertexAttributes,{geometry:c},d);return b.textVertexArrayObject};return e}()})},"esri/views/vectorTiles/renderers/TileInfoRenderer":function(){define("require exports ../GeometryUtils ../../webgl/BufferObject ../../webgl/Texture ../../webgl/VertexArrayObject".split(" "),
function(n,e,a,b,c,d){return function(){function e(a){this._initialized=!1;this._maxWidth=0;this._programOptions={id:!1,pattern:!1};this._programCache=a;this._color=new Float32Array([1,0,0,1])}e.prototype.dispose=function(){this._outlineVertexArrayObject&&(this._outlineVertexArrayObject.dispose(),this._outlineVertexArrayObject=null);this._tileInfoVertexArrayObject&&(this._tileInfoVertexArrayObject.dispose(),this._tileInfoVertexArrayObject=null)};e.prototype.render=function(a,b){this._initialized||
this._initialize(a);var c=this._programCache.getProgram(0,0,this._programOptions);if(c&&(a.bindVAO(this._outlineVertexArrayObject),a.bindProgram(c),c.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform),c.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord),c.setUniform1f("u_coord_range",b.coordRange),c.setUniform1f("u_depth",0),c.setUniform4fv("u_color",this._color),a.setLineWidth(2),a.drawArrays(3,0,4),a.bindVAO(),c=this._getTexture(a,b))){var d=this._programCache.getProgram(7,
0,null);d&&(a.bindVAO(this._tileInfoVertexArrayObject),a.bindProgram(d),a.bindTexture(c,0),d.setUniformMatrix4fv("u_transformMatrix",b.tileTransform.transform),d.setUniform2fv("u_normalized_origin",b.tileTransform.displayCoord),d.setUniform1f("u_depth",0),d.setUniform1f("u_coord_ratio",b.coordRange/512),d.setUniform2f("u_delta",8,8),d.setUniform2f("u_dimensions",c.descriptor.width,c.descriptor.height),a.drawArrays(5,0,4),a.bindVAO())}};e.prototype._initialize=function(a){if(this._initialized)return!0;
var c={geometry:[{name:"a_pos",count:2,type:5120,offset:0,stride:2,normalized:!1,divisor:0}]},e=new Int8Array([0,0,1,0,1,1,0,1]),e=b.createVertex(a,35044,e),e=new d(a,this._programCache.getProgramAttributes(0),c,{geometry:e}),f=new Int8Array([0,0,1,0,0,1,1,1]),f=b.createVertex(a,35044,f);a=new d(a,this._programCache.getProgramAttributes(7),c,{geometry:f});this._outlineVertexArrayObject=e;this._tileInfoVertexArrayObject=a;return this._initialized=!0};e.prototype._getTexture=function(b,d){if(d.texture)return d.texture;
this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.setAttribute("id","canvas2d"),this._canvas.setAttribute("width","256"),this._canvas.setAttribute("height","32"),this._canvas.setAttribute("style","display:none"));var e=d.key.id,f=this._canvas.getContext("2d");f.font="24px sans-serif";f.textAlign="left";f.textBaseline="middle";var g=f.measureText(e),g=Math.pow(2,Math.ceil(a.log2(g.width+2)));g>this._maxWidth&&(this._maxWidth=g);f.clearRect(0,0,this._maxWidth,32);f.fillStyle=
d.key.level>d.refKey.level?"red":"blue";f.fillText(e,0,16);d.texture=new c(b,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728},this._canvas);return d.texture};return e}()})},"esri/views/vectorTiles/renderers/shaders/ProgramCache":function(){define(["require","exports","./Programs","../../../webgl/programUtils"],function(n,e,a,b){Object.defineProperty(e,"__esModule",{value:!0});n=function(){function c(){this._cache=Array(8);for(var a=0;8>a;a++)this._cache[a]={}}c.prototype.dispose=function(){this._programRepo&&
(this._programRepo.dispose(),this._programRepo=null)};c.prototype.getProgram=function(a,b,c){var d=this._cache[a];d[b]||(a=this._programRepo.getProgram(this._getProgramTemplate(a),c),d[b]=a);return d[b]};c.prototype.getProgramAttributes=function(b){switch(b){case 0:return a.background.attributes;case 5:return a.circle.attributes;case 1:return a.fill.attributes;case 4:return a.icon.attributes;case 3:return a.line.attributes;case 2:return a.outline.attributes;case 6:return a.text.attributes;case 7:return a.tileInfo.attributes}};
c.prototype.initialize=function(a){this._programRepo||(this._programRepo=new b.ProgramCache(a))};c.prototype._getProgramTemplate=function(b){switch(b){case 0:return a.background;case 5:return a.circle;case 1:return a.fill;case 4:return a.icon;case 3:return a.line;case 2:return a.outline;case 6:return a.text;case 7:return a.tileInfo}};return c}();e.default=n})},"esri/views/vectorTiles/renderers/shaders/Programs":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],
function(n,e,a,b){Object.defineProperty(e,"__esModule",{value:!0});e.background={name:"background",shaders:function(c){return{vertexShader:b.glslifyDefineMap({ID:c.id,PATTERN:c.pattern})+a.resolveIncludes("background/background.vert"),fragmentShader:b.glslifyDefineMap({ID:c.id,PATTERN:c.pattern})+a.resolveIncludes("background/background.frag")}},attributes:{a_pos:0}};e.circle={name:"circle",shaders:function(c){return{vertexShader:b.glslifyDefineMap({ID:c.id})+a.resolveIncludes("circle/circle.vert"),
fragmentShader:b.glslifyDefineMap({ID:c.id})+a.resolveIncludes("circle/circle.frag")}},attributes:{a_pos:0,a_color:1,a_stroke_color:2,a_data:3}};var c=function(a){return b.glslifyDefineMap({ID:a.id,DD:a.dd,PATTERN:a.pattern})};e.fill={name:"fill",shaders:function(b){return{vertexShader:c(b)+a.resolveIncludes("fill/fill.vert"),fragmentShader:c(b)+a.resolveIncludes("fill/fill.frag")}},attributes:{a_pos:0,a_color:1}};e.outline={name:"outline",shaders:function(c){return{vertexShader:b.glslifyDefineMap({ID:c.id,
DD:c.dd})+a.resolveIncludes("outline/outline.vert"),fragmentShader:b.glslifyDefineMap({ID:c.id,DD:c.dd})+a.resolveIncludes("outline/outline.frag")}},attributes:{a_pos:0,a_offset:1,a_xnormal:2,a_color:3}};e.icon={name:"icon",shaders:function(c){return{vertexShader:b.glslifyDefineMap({ID:c.id,DD:c.dd,SDF:c.sdf})+a.resolveIncludes("icon/icon.vert"),fragmentShader:b.glslifyDefineMap({ID:c.id,DD:c.dd,SDF:c.sdf})+a.resolveIncludes("icon/icon.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,
a_color:4,a_size:5}};var d=function(a){return b.glslifyDefineMap({ID:a.id,DD:a.dd,PATTERN:a.pattern})};e.line={name:"line",shaders:function(b){return{vertexShader:d(b)+a.resolveIncludes("line/line.vert"),fragmentShader:d(b)+a.resolveIncludes("line/line.frag")}},attributes:{a_pos:0,a_offsetAndNormal:1,a_accumulatedDistance:2,a_color:3,a_width:4}};e.text={name:"text",shaders:function(c){return{vertexShader:b.glslifyDefineMap({ID:c.id,DD:c.dd})+a.resolveIncludes("text/text.vert"),fragmentShader:b.glslifyDefineMap({ID:c.id,
DD:c.dd})+a.resolveIncludes("text/text.frag")}},attributes:{a_pos:0,a_vertexOffset:1,a_tex:2,a_levelInfo:3,a_color:4,a_size:5}};e.tileInfo={name:"tileInfo",shaders:{vertexShader:a.resolveIncludes("tileInfo/tileInfo.vert"),fragmentShader:a.resolveIncludes("tileInfo/tileInfo.frag")},attributes:{a_pos:0}}})},"esri/views/vectorTiles/renderers/shaders/sources/resolver":function(){define(["require","exports","./shaderRepository","../../../../webgl/ShaderCompiler"],function(n,e,a,b){Object.defineProperty(e,
"__esModule",{value:!0});var c=new b(function(b){var c=a;b.split("/").forEach(function(a){c&&(c=c[a])});return c});e.resolveIncludes=function(a){return c.resolveIncludes(a)}})},"esri/views/vectorTiles/renderers/shaders/sources/shaderRepository":function(){define(["require","exports"],function(n,e){return{background:{"background.frag":"#ifdef PATTERN\r\nuniform lowp float u_opacity;\r\nuniform mediump vec2 u_pattern_tl;\r\nuniform mediump vec2 u_pattern_br;\r\nuniform sampler2D u_texture;\r\n\r\nvarying mediump vec2 v_tileTextureCoord;\r\n#else\r\nuniform lowp vec4 u_color;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main() {\r\n#ifdef PATTERN\r\n  // normalize the calculated texture coordinate such that it fits in the range of 0 to 1.\r\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\r\n\r\n  // interpolate the image coordinate between the top-left and the bottom right to get the actual position to sample.\r\n  // after normalizing the position, we get a value ranging between 0 and 1 which refers to the entire texture, however\r\n  // we need to only sample from area that has our sprite in the mosaic.\r\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\r\n\r\n  // sample the sprite mosaic\r\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\r\n  gl_FragColor \x3d u_opacity * color;\r\n#else\r\n  gl_FragColor \x3d u_color;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"background.vert":"precision mediump float;\r\n\r\nattribute vec2 a_pos;\r\n\r\n#ifdef ID\r\nuniform mediump vec4 u_id;\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform mediump vec2 u_normalized_origin;\r\nuniform mediump float u_coord_range;\r\nuniform mediump float u_depth;\r\n\r\n#ifdef PATTERN\r\nuniform mediump mat3 u_pattern_matrix; // can we use medium precision?\r\nvarying mediump vec2 v_tileTextureCoord;\r\n#endif // PATTERN\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(u_coord_range * a_pos, 0.0, 1.0);\r\n\r\n#ifdef PATTERN\r\n  // calculate the texture coordinates of the current vertex. It will of course get interpolated.\r\n  // The pattern matrix is a 3x3 scale matrix which 'tiles' the texture inside the tile, translating from tile coordinates\r\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\n  v_id \x3d u_id / 255.0;\r\n#endif // ID\r\n}\r\n"},
circle:{"circle.frag":"precision lowp float;\r\n\r\nvarying lowp vec4 v_color;\r\nvarying lowp vec4 v_stroke_color;\r\nvarying mediump float v_blur;\r\nvarying mediump float v_stroke_width;\r\nvarying mediump float v_radius;\r\nvarying mediump vec2 v_offset;\r\n\r\n#ifdef ID\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main()\r\n{\r\n  mediump float dist \x3d length(v_offset);\r\n\r\n  mediump float alpha \x3d smoothstep(0.0, -v_blur, dist - 1.0);\r\n\r\n  lowp float color_mix_ratio \x3d v_stroke_width \x3c 0.01 ? 0.0 : smoothstep(-v_blur, 0.0, dist - v_radius / (v_radius + v_stroke_width));\r\n\r\n  gl_FragColor \x3d alpha * mix(v_color, v_stroke_color, color_mix_ratio);\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"circle.vert":"precision mediump float;\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_color;\r\nattribute vec4 a_stroke_color;\r\nattribute vec4 a_data;\r\n\r\nconst float sizePrecision \x3d 0.25; // 1/4\r\nconst float blurPrecision \x3d 0.03125; // 1/32\r\n\r\nvarying lowp vec4 v_color;\r\nvarying lowp vec4 v_stroke_color;\r\nvarying mediump float v_blur;\r\nvarying mediump float v_stroke_width;\r\nvarying mediump float v_radius;\r\nvarying mediump vec2 v_offset;\r\n\r\n#ifdef ID\r\nuniform mediump vec4 u_id;\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n\r\n// the z of the layer. Given by the order of the layers in the style\r\nuniform mediump float u_depth;\r\n\r\n// the opacity of the layer given by the painter\r\nuniform mediump float u_radius;\r\nuniform lowp vec4 u_color;\r\nuniform mediump float u_blur;\r\nuniform mediump float u_stroke_width;\r\nuniform lowp vec4 u_stroke_color;\r\n\r\nuniform mediump float u_antialiasingWidth; // antialiasing (factors in the pixel_ratio for high res devices)\r\n\r\nvoid main()\r\n{\r\n  v_color \x3d a_color * u_color;\r\n  v_stroke_color \x3d a_stroke_color * u_stroke_color;\r\n  v_stroke_width \x3d a_data[1] * sizePrecision * u_stroke_width;\r\n  v_radius \x3d a_data[2] * u_radius;\r\n  v_blur \x3d max(a_data[0] * blurPrecision + u_blur, u_antialiasingWidth / (v_radius + v_stroke_width));\r\n\r\n  mediump vec2 offset \x3d vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\r\n  v_offset \x3d offset;\r\n\r\n#ifdef ID\r\n  v_id \x3d u_id / 255.0;\r\n#endif // ID\r\n\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos * 0.5, 0.0, 1.0) + u_extrudeMatrix * (v_radius + v_stroke_width) * vec4(offset, 0.0, 0.0);\r\n}\r\n"},
fill:{"fill.frag":"precision lowp float;\r\n\r\n#ifdef PATTERN\r\nuniform mediump vec2 u_pattern_tl;\r\nuniform mediump vec2 u_pattern_br;\r\nuniform lowp sampler2D u_texture;\r\nvarying mediump vec2 v_tileTextureCoord;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\nvarying lowp vec4 v_color;\r\n\r\nvec4 mixColors(vec4 color1, vec4 color2) {\r\n  // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Alpha_blending)\r\n  // we use pre-multiplied colors hence the need for this kind of mixing. At lease we save ourselves an extra division...\r\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\r\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\r\n\r\n  return vec4(compositeColor, compositeAlpha);\r\n}\r\n\r\nvoid main()\r\n{\r\n#ifdef PATTERN\r\n  // normalize the calculated texture coordinate such that it fits in the range of 0 to 1.\r\n  mediump vec2 normalizedTextureCoord \x3d mod(v_tileTextureCoord, 1.0);\r\n\r\n  // interpolate the image coordinate between the top-left and the bottom right to get the actual position to sample.\r\n  // after normalizing the position, we get a value ranging between 0 and 1 which refers to the entire texture, however\r\n  // we need to only sample from area that has our sprite in the mosaic.\r\n  mediump vec2 samplePos \x3d mix(u_pattern_tl, u_pattern_br, normalizedTextureCoord);\r\n\r\n  // sample the sprite mosaic\r\n  lowp vec4 color \x3d texture2D(u_texture, samplePos);\r\n  gl_FragColor \x3d v_color[3] * color;\r\n#else\r\n  gl_FragColor \x3d v_color;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"fill.vert":"precision mediump float;\r\n\r\nattribute vec2 a_pos;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform highp vec2 u_normalized_origin;\r\nuniform mediump float u_depth;\r\n\r\n#ifdef PATTERN\r\nuniform mediump mat3 u_pattern_matrix;\r\nvarying mediump vec2 v_tileTextureCoord;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\nuniform mediump vec4 u_id;\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\n#ifdef DD\r\nattribute vec4 a_color;\r\n#endif // DD\r\nuniform lowp vec4 u_color;\r\nvarying lowp vec4 v_color;\r\n\r\nvoid main()\r\n{\r\n#ifdef DD\r\n  v_color \x3d a_color * u_color;\r\n#else\r\n  v_color \x3d u_color;\r\n#endif // DD\r\n\r\n#ifdef ID\r\n  v_id \x3d u_id / 255.0;\r\n#endif // ID\r\n\r\n#ifdef PATTERN\r\n  // calculate the texture coordinates of the current vertex. It will of course get interpolated.\r\n  // The pattern matrix is a 3x3 scale matrix which 'tiles' the texture inside the tile, translating from tile coordinates\r\n  // (-4k to 8k -1) to texture coordinates.\r\n  v_tileTextureCoord \x3d (u_pattern_matrix * vec3(a_pos, 1.0)).xy;\r\n#endif // PATTERN\r\n\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0, 1.0);\r\n}\r\n"},
icon:{"icon.frag":"precision mediump float;\r\n\r\nuniform lowp sampler2D u_texture; // SDF texture\r\n#ifdef SDF\r\nuniform lowp vec4 u_color; // a color to override the one of the vertex\r\nuniform lowp vec4 u_outlineColor;\r\nuniform mediump float u_outlineSize;\r\n#endif // SDF\r\n\r\nvarying mediump vec2 v_tex;\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n\r\nvarying mediump vec2 v_size;\r\n\r\nvarying lowp vec4 v_color;\r\n\r\n#ifdef ID\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\n// we need the conversion function from RGBA to float\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\nvec4 mixColors(vec4 color1, vec4 color2) {\r\n  // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Alpha_blending)\r\n  // we use pre-multiplied colors hence the need for this kind of mixing. At lease we save ourselves an extra division...\r\n  float compositeAlpha \x3d color2.a + color1.a * (1.0 - color2.a);\r\n  vec3 compositeColor \x3d color2.rgb + color1.rgb * (1.0 - color2.a);\r\n\r\n  return vec4(compositeColor, compositeAlpha);\r\n}\r\n\r\nvoid main()\r\n{\r\n#ifdef SDF\r\n  lowp vec4 fillPixelColor \x3d v_color;\r\n\r\n  // calculate the distance from the edge [-0.5, 0.5]\r\n  float d \x3d rgba2float(texture2D(u_texture, v_tex)) - 0.5;\r\n\r\n  // the soft edge ratio is about 1.5 pixels allocated for the soft edge.\r\n  // 1 / 86 represents a single pixel given the size of the SDF is 128 and we add 4 pixels margins to deal with\r\n  // other non SDF types.\r\n  // The rasterized geometry takes only 86 pixels because of the extra 16 pixels margin for the outline.\r\n  const float sofetEdgeRatio \x3d 0.248062016; // \x3d\x3d\x3e (32.0 / 86.0) / 1.5;\r\n  float size \x3d max(v_size.x, v_size.y);\r\n  float dist \x3d d * sofetEdgeRatio * size;\r\n\r\n  // set the fragment's transparency according to the distance from the edge\r\n  fillPixelColor *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n  // count for the outline\r\n  // therefore tint the entire icon area.\r\n  if (u_outlineSize \x3e 0.25) {\r\n    lowp vec4 outlinePixelColor \x3d u_outlineColor;\r\n    // the outline limit ratio is derived from the 16 pixels allocated for the outline and the fact that 1/86 represents\r\n    // a single pixel.\r\n    const float outlineLimitRatio \x3d (16.0 / 86.0);\r\n    float clampedOutlineSize \x3d sofetEdgeRatio * min(u_outlineSize, outlineLimitRatio * max(v_size.x, v_size.y));\r\n\r\n    outlinePixelColor *\x3d clamp(0.5 - (abs(dist) - clampedOutlineSize), 0.0, 1.0);\r\n\r\n    // finally combine the outline and the fill colors\r\n    gl_FragColor \x3d v_transparency * mixColors(fillPixelColor, outlinePixelColor);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d v_transparency * fillPixelColor;\r\n  }\r\n#else // not an SDF\r\n  lowp vec4 texColor \x3d texture2D(u_texture, v_tex);\r\n  gl_FragColor \x3d v_transparency * texColor;\r\n#endif // SDF\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"icon.vert":"attribute vec2 a_pos;\r\nattribute vec2 a_vertexOffset;\r\nattribute vec4 a_tex;\r\nattribute vec4 a_levelInfo;\r\n\r\n#ifdef DD\r\nattribute vec4 a_color;\r\nattribute mediump float a_size;\r\n#endif // DD\r\nuniform lowp vec4 u_color;\r\nuniform mediump float u_size;\r\n\r\n#ifdef ID\r\nuniform mediump vec4 u_id;\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\nvarying lowp vec4 v_color;\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n\r\n// the size of the mosaic given in pixels\r\nuniform vec2 u_mosaicSize;\r\n\r\n// the z of the layer. Given by the order of the layers in the style\r\nuniform mediump float u_depth;\r\n\r\n// the map's rotation from the north\r\nuniform mediump float u_mapRotation;\r\nuniform mediump float u_level;\r\n\r\n// indicate whether the current set of iconst should be kept upright when the map is rotated\r\nuniform lowp float u_keepUpright;\r\n\r\n// the rate of the change in the opacity (fade) of the icons\r\nuniform mediump float u_fadeSpeed;\r\n\r\n// the low level we transition (to/from)\r\nuniform mediump float u_minfadeLevel;\r\n\r\n// the high level we transition (to/from)\r\nuniform mediump float u_maxfadeLevel;\r\n\r\n// the amount of fade given teh current time past the last recorded level\r\nuniform mediump float u_fadeChange;\r\n\r\n// the opacity of the layer given by the painter\r\nuniform mediump float u_opacity;\r\n\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying mediump vec2 v_tex;\r\n\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n\r\nvarying mediump vec2 v_size;\r\n\r\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precision we multiply the values\r\n// by 8 and then at the shader devide by the same number\r\nconst float C_OFFSET_PRECISION \x3d 1.0 / 8.0;\r\n\r\nconst float C_256_TO_RAD \x3d 3.14159265359 / 128.0;\r\nconst float C_DEG_TO_RAD \x3d 3.14159265359 / 180.0;\r\nconst float tileCoordRatio \x3d 1.0 / 8.0;\r\n\r\nvoid main()\r\n{\r\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\r\n  mediump float a_angle         \x3d a_levelInfo[1];\r\n  mediump float a_minLevel      \x3d a_levelInfo[2];\r\n  mediump float a_maxLevel      \x3d a_levelInfo[3];\r\n\r\n  // if the given vertex should not be visible simply clip it by adding it a value that will push it outside the clipping plane\r\n  mediump float delta_z \x3d 0.0;\r\n\r\n  // If the label rotates with the map, and if the rotated label is upside down, hide it\r\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\r\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated)); //ie. z +\x3d (flip \x3e 0) \x26\x26 (64 \x3c\x3d rotated) \x26\x26 (rotated \x3c 192)\r\n\r\n  // u_level is the current service level adjusted for the change in font size\r\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level); // Test if (level \x3c minLevel)\r\n  delta_z +\x3d step(a_maxLevel, u_level); // Test if (maxLevel \x3c\x3d level)\r\n\r\n  // calculate the alpha given the change in the fade and the fade-speed\r\n  lowp float alpha \x3d clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\r\n\r\n  // if the speed is positive we are zooming in and therefore we need to 'fade-in'. Else we need to 'fade-out'\r\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\r\n\r\n  // now deal with the min/max fade-levels. If we exceeded the level we simply snap to 0 or 1\r\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\r\n  {\r\n    v_transparency \x3d 0.0;\r\n  }\r\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\r\n  {\r\n    v_transparency \x3d 1.0;\r\n  }\r\n\r\n  // if label had been faded out, clip it\r\n  delta_z +\x3d step(v_transparency, 0.0);\r\n\r\n  vec2 offset \x3d C_OFFSET_PRECISION * a_vertexOffset;\r\n\r\n  v_size \x3d abs(offset);\r\n\r\n#ifdef SDF\r\n  offset \x3d (120.0 / 86.0) * offset;\r\n#endif // SDF\r\n\r\n#ifdef DD\r\n  mediump float icon_size \x3d a_size * u_size;\r\n#else\r\n  mediump float icon_size \x3d u_size;\r\n#endif // DD\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * icon_size * vec4(offset, delta_z, 0.0);\r\n\r\n#ifdef DD\r\n  v_color \x3d a_color * u_color;\r\n#else\r\n  v_color \x3d u_color;\r\n#endif // DD\r\n\r\n#ifdef ID\r\n  v_id \x3d u_id / 255.0;\r\n#endif // ID\r\n\r\n  v_tex \x3d a_tex.xy / u_mosaicSize;\r\n  v_transparency *\x3d v_color.w;\r\n}\r\n"},
line:{"line.frag":"varying mediump vec2 v_normal;\r\nvarying highp float v_accumulatedDistance;\r\n\r\nvarying mediump float v_lineHalfWidth;\r\nvarying lowp vec4 v_color;\r\n\r\nvarying mediump float v_blur;\r\n\r\n#ifdef PATTERN\r\nuniform mediump vec2 u_pattern_tl;\r\nuniform mediump vec2 u_pattern_br;\r\nuniform mediump vec2 u_spriteSize;\r\nuniform sampler2D u_texture;\r\n\r\n// Horizontal scale is used to scale the horizontal texture coordinate v_normal.x before adding it as an offset to the\r\n// accumulated distance. Most vertices will have v_normal.x \x3d\x3d 0, because the pattern must be sampled only depending on\r\n// the v_accumulatedDistance value. But tessellation at caps can have vertices with v_normal.x !\x3d 0, thus allowing to\r\n// \"keep moving\" for a few more pixel even when the line has ended or has not started yet.\r\nconst mediump float tileCoordRatio \x3d 8.0;\r\n#else\r\nvarying mediump vec2 v_dasharray;\r\n#endif\r\n\r\n#ifdef ID\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main()\r\n{\r\n  // dist represent the distance of the fragment from the line. 1.0 or -1.0 will be the values on the edge of the line,\r\n  // and any value in between will be inside the line (the sign represent the direction - right or left).\r\n  // since u_linewidth.s (half line width) is represented in pixels, dist is also given in pixels\r\n  mediump float fragDist \x3d length(v_normal) * v_lineHalfWidth;\r\n\r\n  // calculate the alpha given the difference between the line-width and the distance of the fragment from the center-line.\r\n  // We need to count for both sides of the line.\r\n  lowp float alpha \x3d clamp((v_lineHalfWidth - fragDist) / v_blur, 0.0, 1.0);\r\n\r\n#ifdef PATTERN\r\n  // we need to calculate the relative portion of the line texture along the line given the accumulated distance aliong the line\r\n  // The computed value should is anumber btween 0 and 1 which will later be used to interpolate btween the BR and TL values\r\n  mediump float relativeTexX \x3d mod((v_accumulatedDistance + v_normal.x * v_lineHalfWidth * tileCoordRatio) / u_spriteSize.x, 1.0);\r\n\r\n  // in order to calculate the texture coordinates perpendicular to the line (Y axis), we use the interpolated normal values\r\n  // which range from -1.0 to 1.0. On the line's centerline, the value of the interpolated normal is 0.0, however the relative\r\n  // texture value should be 0.5 (given that at the bottom of the line, the texture coordinate must be equal to 0.0)\r\n  // (TL) ---------------------------      --\x3e left edge of line. Interpolated normal is 1.0\r\n  //              | -\x3e line-width / 2\r\n  //      - - - - - - - - - - - - - -\r\n  //              | -\x3e line-width / 2\r\n  //      ---------------------------- (BR)--\x3e right edge of line. Interpolated normal is -1.0\r\n\r\n  mediump float relativeTexY \x3d 0.5 + (v_normal.y * v_lineHalfWidth / u_spriteSize.y);\r\n\r\n  // claculate the actual texture coordinates by interpolating between the TL/BR pattern coordinates\r\n  mediump vec2 texCoord \x3d mix(u_pattern_tl, u_pattern_br, vec2(relativeTexX, relativeTexY));\r\n\r\n  // get the color from the texture\r\n  lowp vec4 color \x3d texture2D(u_texture, texCoord);\r\n\r\n  // finally write the fragment value\r\n  gl_FragColor \x3d alpha * v_color[3] * color;\r\n#else\r\n  // now calculate the dashes given the accumulated distance of the line:\r\n  // start with calculating a normalized position along the line\r\n  lowp float dashPos \x3d  mod(v_accumulatedDistance, v_dasharray.x + v_dasharray.y);\r\n\r\n  // calculate the contribution to the alpha of the dash part. It is provided by the shortest portion of the position along the dash.\r\n  // we must clamp since the value might be bigger than 1 or smaller than zero (when over a dash).\r\n  //   | \x3c--- pos along the dash part\r\n  // -------_______-------_______\r\n  // when the dashPos is over the 'gap' part of the dash dasharray.x - dashPos is negative and therefore the alpha will\r\n  // get clamped to zero.\r\n  // when dasharray.x - dashPos is positive, or when dashPos is smaller than 1.0, it gives us a soft edge to each dash part.\r\n  // along the direction of the line.\r\n  lowp float dashAlpha \x3d clamp(min(dashPos, v_dasharray.x - dashPos) + 0.5, 0.0, 1.0);\r\n\r\n  // if we don't have a no-data part to the dash then it is a solid line\r\n  dashAlpha \x3d max(sign(-v_dasharray.y), dashAlpha);\r\n  // finally multiply the fragment's alpha by the calculated dash-alpha\r\n  alpha *\x3d dashAlpha;\r\n\r\n  // output the fragment color\r\n  gl_FragColor \x3d alpha * v_color;\r\n#endif // PATTERN\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"line.vert":"/* The implementation of the renderer is based on the article and implementation of MB described here:\r\n* https://www.mapbox.com/blog/drawing-antialiased-lines/\r\n*/\r\n\r\nattribute vec2 a_pos;\r\nattribute vec4 a_offsetAndNormal;\r\nattribute vec2 a_accumulatedDistance;\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n\r\nuniform mediump float u_blur;\r\nuniform mediump float u_antialiasing; // the feather distance at which the line edge fades out\r\n\r\n// the z of the layer. Given by the order of the layers in the style\r\nuniform mediump float u_depth;\r\n\r\n// the interpolated normal to the line. the information is packed into the two LSBs of the vertex coordinate\r\nvarying mediump vec2 v_normal;\r\n\r\n// the accumulated distance along the line. We need this information in order to render the dashes.\r\nvarying highp float v_accumulatedDistance;\r\n\r\nconst float scale \x3d 1.0 / 31.0;\r\n\r\n#ifdef DD\r\nattribute vec4 a_color;\r\nattribute mediump float a_width;\r\n#endif // DD\r\nuniform lowp vec4 u_color;\r\nuniform mediump float u_width;\r\n\r\n#ifdef ID\r\nuniform mediump vec4 u_id;\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\nvarying lowp vec4 v_color;\r\nvarying mediump float v_lineHalfWidth; // the inset and outset of the line\r\nvarying mediump float v_blur;\r\n\r\n#ifndef PATTERN\r\nuniform mediump vec2 u_dasharray;\r\nvarying mediump vec2 v_dasharray;\r\n#endif\r\n\r\nvoid main()\r\n{\r\n  v_normal \x3d a_offsetAndNormal.zw * scale;\r\n\r\n#ifdef DD\r\n  v_lineHalfWidth \x3d a_width * u_width;\r\n#else\r\n  v_lineHalfWidth \x3d u_width;\r\n#endif // DD\r\n\r\n  v_lineHalfWidth +\x3d u_antialiasing;\r\n  v_lineHalfWidth *\x3d 0.5;\r\n\r\n#ifndef PATTERN\r\n#ifdef DD\r\n  v_dasharray \x3d u_dasharray * a_width;\r\n#else\r\n  v_dasharray \x3d u_dasharray * u_width;\r\n#endif // DD\r\n#endif\r\n\r\n  // calculate the relative distance from the centerline to the edge of the line. Since offset is given in integers (for the\r\n  // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\r\n  mediump vec2 dist \x3d v_lineHalfWidth * a_offsetAndNormal.xy * scale;\r\n\r\n  // transform the vertex\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * vec4(dist, 0.0, 0.0);\r\n\r\n  // the accumulated distance will be used to calculate the dashes (or the no-data...)\r\n  v_accumulatedDistance \x3d a_accumulatedDistance.x;\r\n\r\n  v_blur \x3d u_blur + u_antialiasing;\r\n\r\n  #ifdef DD\r\n    v_color \x3d a_color * u_color;\r\n  #else\r\n    v_color \x3d u_color;\r\n  #endif // DD\r\n\r\n  #ifdef ID\r\n    v_id \x3d u_id / 255.0;\r\n  #endif // ID\r\n}\r\n"},
outline:{"outline.frag":"varying lowp vec4 v_color;\r\nvarying mediump vec2 v_normal;\r\n\r\n#ifdef ID\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\nvoid main()\r\n{\r\n  // Calculate the distance of the pixel from the line in pixels.\r\n  lowp float dist \x3d abs(v_normal.y);\r\n\r\n  lowp float alpha \x3d smoothstep(1.0, 0.0, dist);\r\n  gl_FragColor \x3d alpha * v_color;\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"outline.vert":"attribute vec2 a_pos;\r\nattribute vec2 a_offset;\r\nattribute vec2 a_xnormal;\r\n\r\n#ifdef DD\r\nattribute vec4 a_color;\r\n#endif // DD\r\nuniform lowp vec4 u_color;\r\nvarying lowp vec4 v_color;\r\n\r\n#ifdef ID\r\nuniform mediump vec4 u_id;\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform highp mat4 u_extrudeMatrix;\r\nuniform highp vec2 u_normalized_origin;\r\nuniform mediump float u_depth;\r\nuniform mediump float u_outline_width;\r\n\r\nvarying lowp vec2 v_normal;\r\n\r\nconst float scale \x3d 1.0 / 15.0;\r\n\r\nvoid main()\r\n{\r\n#ifdef DD\r\n  v_color \x3d a_color * u_color;\r\n#else\r\n  v_color \x3d u_color;\r\n#endif // DD\r\n\r\n#ifdef ID\r\n  v_id \x3d u_id / 255.0;\r\n#endif // ID\r\n\r\n  v_normal \x3d a_xnormal;\r\n\r\n  // calculate the relative distance from the centerline to the edge of the line. Since offset is given in integers (for the\r\n  // sake of using less attribute memory, we need to scale it back to the original range of ~ 0: 1)\r\n  mediump vec4 dist \x3d vec4(u_outline_width * a_offset * scale, 0.0, 0.0);\r\n\r\n  // Remove the texture normal bit of the position before scaling it with the\r\n  // model/view matrix. Add the extrusion vector *after* the model/view matrix\r\n  // because we're extruding the line in pixel space, regardless of the current\r\n  // tile's zoom level.\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * dist;\r\n}\r\n"},
text:{"text.frag":"uniform lowp sampler2D u_texture;\r\nuniform mediump float u_edgeDistance;\r\n\r\nvarying lowp vec2 v_tex;\r\nvarying lowp float v_transparency;\r\nvarying lowp vec4 v_color;\r\nvarying mediump float v_edgeWidth;\r\nvarying mediump float v_edgeDistance;\r\n\r\n#ifdef ID\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\n// this is taken from http://www.valvesoftware.com/publications/2007/SIGGRAPH2007_AlphaTestedMagnification.pdf\r\n// and https://www.mapbox.com/blog/text-signed-distance-fields/\r\n// http://metalbyexample.com/rendering-text-in-metal-with-signed-distance-fields/\r\n\r\nvoid main()\r\n{\r\n  // read the distance from the SDF texture\r\n  lowp float dist \x3d texture2D(u_texture, v_tex).a;\r\n\r\n  // use a smooth-step in order to calculate the geometry of the shape given by the distance field\r\n  mediump float alpha \x3d smoothstep(v_edgeDistance - v_edgeWidth, v_edgeDistance + v_edgeWidth, dist) * v_transparency;\r\n\r\n  gl_FragColor \x3d alpha * v_color;\r\n\r\n#ifdef ID\r\n  if (gl_FragColor.a \x3c 1.0 / 255.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d v_id;\r\n#endif // ID\r\n}\r\n",
"text.vert":"attribute vec2 a_pos;\r\nattribute vec2 a_vertexOffset;\r\nattribute vec4 a_tex;\r\nattribute vec4 a_levelInfo;\r\n\r\nuniform lowp vec4 u_color; // always defined as halo does not support data driven but text does\r\n#ifdef DD\r\nattribute vec4 a_color;\r\n#endif // DD\r\nvarying lowp vec4 v_color;\r\n\r\nuniform mediump float u_size;\r\n#ifdef DD\r\nattribute mediump float a_size;\r\n#endif // DD\r\nvarying mediump float v_size;\r\n\r\n#ifdef ID\r\nuniform mediump vec4 u_id;\r\nvarying mediump vec4 v_id;\r\n#endif // ID\r\n\r\n\r\n// attribute bool a_visible; // --\x3e a one bit controlling the visibility of the vertex\r\n\r\n// the relative transformation of a vertex given in tile coordinates to a relative normalized coordinate\r\n// relative to the tile's upper left corner\r\n// the extrusion vector.\r\nuniform highp mat4 u_transformMatrix;\r\n\r\n// the extrude matrix which is responsible for the 'anti-zoom' as well as the rotation\r\nuniform highp mat4 u_extrudeMatrix;\r\n\r\n// u_normalized_origin is the tile's upper left corner given in normalized coordinates\r\nuniform highp vec2 u_normalized_origin;\r\n\r\n// the size of the mosaic given in pixels\r\nuniform vec2 u_mosaicSize;\r\n\r\n// the z of the layer. Given by the order of the layers in the style\r\nuniform mediump float u_depth;\r\n\r\n// the map's rotation from the north\r\nuniform mediump float u_mapRotation;\r\nuniform mediump float u_level;\r\n\r\n// indicate whether the current set of iconst should be kept upright when the map is rotated\r\nuniform lowp float u_keepUpright;\r\n\r\n// the rate of the change in the opacity (fade) of the icons\r\nuniform mediump float u_fadeSpeed;\r\n\r\n// the low level we transition (to/from)\r\nuniform mediump float u_minfadeLevel;\r\n\r\n// the high level we transition (to/from)\r\nuniform mediump float u_maxfadeLevel;\r\n\r\n// the amount of fade given teh current time past the last recorded level\r\nuniform mediump float u_fadeChange;\r\n\r\n// the opacity of the layer given by the painter\r\nuniform mediump float u_opacity;\r\n\r\n// the interpolated texture coordinate value to be used by the fragment shader in order to sample the sprite texture\r\nvarying lowp vec2 v_tex;\r\n\r\n// the calculated transparency to be applied by the fragment shader. It is incorporating both the fade as well as the\r\n// opacity of the layer given by the painter\r\nvarying lowp float v_transparency;\r\n\r\n// the vertex offsets are given in integers, therefore in order to maintain a reasonable precision we multiply the values\r\n// by 8 and then at the shader divide by the same number\r\nconst float offsetPrecision \x3d 1.0 / 8.0;\r\n\r\n// outline position and appearance\r\nconst mediump float edgePos \x3d 0.75; // defined by the SDF encoding\r\nuniform mediump float u_edgeDistance;\r\nuniform mediump float u_edgeBlur;\r\nuniform mediump float u_antialiasingWidth; // antialiasing (factors in the pixel_ratio for high res devices)\r\n\r\nvarying mediump float v_edgeDistance; // will factor in the size\r\nvarying mediump float v_edgeWidth; // will factor in the size\r\n\r\nuniform lowp float u_halo; // needed to avoid using the color attribute for halo\r\n\r\nvoid main()\r\n{\r\n  mediump float a_labelMinLevel \x3d a_levelInfo[0];\r\n  mediump float a_angle        \x3d a_levelInfo[1];\r\n  mediump float a_minLevel    \x3d a_levelInfo[2];\r\n  mediump float a_maxLevel    \x3d a_levelInfo[3];\r\n\r\n  // if the given vertex should not be visible simply clip it by adding it a value that will push it outside the clipping plane\r\n  mediump float delta_z \x3d 0.0;\r\n\r\n  // TODO: force clipping the vertex in case that the vertex isn't visible\r\n  //delta_z +\x3d a_visible ? 0.0 : 1.0;\r\n\r\n  // If the label rotates with the map, and if the rotated label is upside down, hide it\r\n  mediump float rotated \x3d mod(a_angle + u_mapRotation, 256.0);\r\n  delta_z +\x3d (1.0 - step(u_keepUpright, 0.0)) * step(64.0, rotated) * (1.0 - step(192.0, rotated)); //ie. z +\x3d (flip \x3e 0) \x26\x26 (64 \x3c\x3d rotated) \x26\x26 (rotated \x3c 192)\r\n\r\n  // u_level is the current service level adjusted for the change in font size\r\n  delta_z +\x3d 1.0 - step(a_minLevel, u_level); // Test if (level \x3c minLevel)\r\n  delta_z +\x3d step(a_maxLevel, u_level); // Test if (maxLevel \x3c\x3d level)\r\n\r\n  // calculate the alpha given the change in the fade and the fade-speed\r\n  lowp float alpha \x3d clamp((u_fadeChange - a_labelMinLevel) / u_fadeSpeed, 0.0, 1.0);\r\n\r\n  // if the speed is positive we are zooming in and therefore we need to 'fade-in'. Else we need to 'fade-out'\r\n  v_transparency \x3d (u_fadeSpeed \x3e\x3d 0.0 ? alpha : 1.0 - alpha);\r\n\r\n  // now deal with the min/max fade-levels. If we exceeded the level we simply snap to 0 or 1\r\n  if (u_maxfadeLevel \x3c a_labelMinLevel)\r\n  {\r\n    v_transparency \x3d 0.0;\r\n  }\r\n  if (u_minfadeLevel \x3e\x3d a_labelMinLevel)\r\n  {\r\n    v_transparency \x3d 1.0;\r\n  }\r\n\r\n  // if label has been faded out, clip it\r\n  delta_z +\x3d step(v_transparency, 0.0);\r\n\r\n  v_tex \x3d a_tex.xy / u_mosaicSize;\r\n\r\n#ifdef DD\r\n  if (u_halo \x3e 0.5)\r\n  {\r\n    v_color \x3d u_color;\r\n  }\r\n  else\r\n  {\r\n    v_color \x3d a_color * u_color;\r\n    // opacity already factored in a_color\r\n  }\r\n#else\r\n  v_color \x3d u_color;\r\n#endif // DD\r\n\r\n#ifdef DD\r\n  v_size \x3d a_size * u_size;\r\n#else\r\n  v_size \x3d u_size;\r\n#endif // DD\r\n\r\n#ifdef ID\r\n  v_id \x3d u_id / 255.0;\r\n#endif // ID\r\n\r\n  v_edgeDistance \x3d edgePos - u_edgeDistance / v_size;\r\n  v_edgeWidth \x3d (u_antialiasingWidth + u_edgeBlur) / v_size;\r\n\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(a_pos, 0.0, 1.0) + u_extrudeMatrix * v_size * vec4(offsetPrecision * a_vertexOffset, delta_z, 0.0);\r\n}\r\n"},
tileInfo:{"tileInfo.frag":"uniform mediump sampler2D u_texture;\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main(void) {\r\n  lowp vec4 color \x3d texture2D(u_texture, v_tex);\r\n  gl_FragColor \x3d 0.75 * color;\r\n}\r\n","tileInfo.vert":"attribute vec2 a_pos;\r\n\r\nuniform highp mat4 u_transformMatrix;\r\nuniform mediump vec2 u_normalized_origin;\r\nuniform mediump float u_depth;\r\nuniform mediump float u_coord_ratio;\r\nuniform mediump vec2 u_delta; // in tile coordinates\r\nuniform mediump vec2 u_dimensions; // in tile coordinates\r\n\r\nvarying mediump vec2 v_tex;\r\n\r\nvoid main() {\r\n  mediump vec2 offests \x3d u_coord_ratio * vec2(u_delta + a_pos * u_dimensions);\r\n  gl_Position \x3d vec4(u_normalized_origin, u_depth, 0.0) + u_transformMatrix * vec4(offests, 0.0, 1.0);\r\n\r\n  v_tex \x3d a_pos;\r\n}\r\n"},
util:{"encoding.glsl":"// Factors to convert rgba back to float\r\nconst vec4 rgba2float_factors \x3d vec4(\r\n    255.0 / (256.0),\r\n    255.0 / (256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0),\r\n    255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n  );\r\n\r\nfloat rgba2float(vec4 rgba) {\r\n  // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n  // add the components together with their corresponding\r\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n  return dot(rgba, rgba2float_factors);\r\n}\r\n"}}})},
"*noref":1}});
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Handles ../../../core/has ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../engine/StageGL ./LayerView2D ../tiling/TileInfoViewPOT ../tiling/TileKey ../tiling/TileQueue ../tiling/TileStrategy ../../support/screenshotUtils ../../vectorTiles/TileHandler ../../vectorTiles/VectorTileContainer ../../vectorTiles/VectorTileDisplayObject".split(" "),function(n,
e,a,b,c,d,f,h,g,l,m,k,v,q,p,r,t,u,x){return function(e){function m(){var a=null!==e&&e.apply(this,arguments)||this;a._handles=new d;a._fetchQueue=null;a._tileRequests=new Map;a.container=new l;return a}a(m,e);m.prototype.initialize=function(){this.container.useContextVersion(this.view?this.view.renderContext:null)};m.prototype.hitTest=function(a,b){var d=this;return this.visible&&this._vectorTileContainer?this._vectorTileContainer.hittest(a,b).then(function(a){var b=d._tileHandler.getStyleRepository().layers;
if(null===a||0>a||a>=b.length)return null;a=new c({attributes:{layerId:a,layerName:b[a].id}});a.layer=d.layer;a.sourceLayer=d.layer;return a}):h.resolve(null)};m.prototype.update=function(a){if(this._tileHandlerPromise&&this._tileHandlerPromise.isFulfilled())if(a.pixelRatio!==this._tileHandler.devicePixelRatio)this._start();else{this._fetchQueue.pause();this._fetchQueue.state=a.state;this._tileStrategy.update(a);this._fetchQueue.resume();for(var b=0,c=this._vectorTileContainer.children;b<c.length;b++)this._tileHandler.updateTile(c[b],
a);this.notifyChange("updating")}};m.prototype.attach=function(){this._tileHandlerPromise=this._start()};m.prototype.detach=function(){this._stop()};m.prototype.moveStart=function(){this.requestUpdate()};m.prototype.viewChange=function(){this.requestUpdate()};m.prototype.moveEnd=function(){this.requestUpdate()};m.prototype.destroy=function(){this.container.dispose();this._vectorTileContainer.destroy();this._tileHandler.destroy()};m.prototype.takeScreenshot=function(a){if(!this.container)return h.reject("Could not find an object capable of capturing screenshot!");
a=r.toRenderSettings(a,this.view);return this.container.takeScreenshot(a)};m.prototype.canResume=function(){var a=this.inherited(arguments),b=this.layer;if(a&&b.currentStyleInfo){var c=this.view.scale;(b=b.currentStyleInfo)&&b.layerDefinition&&(b=b.layerDefinition,b.minScale&&b.minScale<c&&(a=!1),b.maxScale&&b.maxScale>c&&(a=!1))}return a};m.prototype.isUpdating=function(){var a=!0;this._tileRequests.forEach(function(b){a=a&&b.isFulfilled()});return!a};m.prototype.acquireTile=function(a){var b=this,
c=v.pool.acquire();c.set(a.level,a.row,a.col,a.world);a=this.updateParameters.state.rotation;var d=this._tileHandler.getStyleRepository(),e=x.pool.acquire(c,c,this.layer.tileInfo,d,a);this._tileHandlerPromise.then(function(){var a=b._tileHandler.getRefKey(c).then(function(a){if(a)return e.refKey=a,b._fetchQueue.push(e.key).then(function(a){e.setData(a.tileData,a.client);e.once("attach",function(){return b.requestUpdate()});b._vectorTileContainer.addChild(e);b.notifyChange("updating")});e.setData(null,
null);e.once("attach",function(){return b.requestUpdate()});b._vectorTileContainer.addChild(e)});b._tileRequests.set(c.id,a);b.notifyChange("updating")});return e};m.prototype.releaseTile=function(a){var b=a.key.id,c=this._tileRequests.get(b);c.isFulfilled()||c.cancel();this._tileRequests.delete(b);this._vectorTileContainer.removeChild(a);this.requestUpdate();a.once("detach",function(){return x.pool.release(a)});this.notifyChange("updating")};m.prototype._stop=function(){this._tileHandlerPromise&&
!this._tileHandlerPromise.isFulfilled()&&this._tileHandlerPromise.cancel();this._handles.removeAll();this._tileStrategy&&this._tileStrategy.destroy();this._vectorTileContainer&&(this._vectorTileContainer.removeAllChildren(),this.container.removeChild(this._vectorTileContainer));this._tileHandler&&this._tileHandler.stop();x.pool.prune();this._vectorTileContainer=this._tileHandler=this._tileStrategy=this._tileInfoView=null};m.prototype._start=function(){var a=this;if(!f("esri-webgl"))return h.reject("WebGL is required but not supported!");
this._stop();this._handles.add(this.watch("layer.currentStyleInfo",function(){return a.attach()}));this._vectorTileContainer=new u;this.container.addChild(this._vectorTileContainer);this._tileInfoView=new k(this.layer.tileInfo,this.layer.fullExtent);this._tileHandler=new t(this.layer,function(){return a.requestUpdate()},window.devicePixelRatio||1,!0,this._tileInfoView);return this._tileHandler.start().then(function(){a._tileStrategy=new p({cachePolicy:"keep",acquireTile:function(b){return a.acquireTile(b)},
releaseTile:function(b){return a.releaseTile(b)},tileInfoView:a._tileInfoView});a._fetchQueue=new q({tileInfoView:a._tileInfoView,process:function(b){return a._getTileData(b)}});a._vectorTileContainer.initialize(a._tileHandler.spriteMosaic,a._tileHandler.glyphMosaic,a.layer.tileInfo,a._tileInfoView);a.requestUpdate()})};m.prototype._getTileData=function(a){return this._tileHandler.getTileData(a,this.updateParameters.state.rotation)};b([g.property({dependsOn:["view.scale","layer.currentStyleInfo"]})],
m.prototype,"suspended",void 0);return m=b([g.subclass("esri.views.2d.layers.VectorTileLayerView2D")],m)}(g.declared(m))});