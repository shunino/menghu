// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/promiseUtils ../ViewState ./Container ../../support/screenshotUtils".split(" "),function(r,t,m,k,l,n,p){return function(g){function d(){var a=null!==g&&g.apply(this,arguments)||this;a._childrenRenderParameters={context:null,pixelRatio:1,state:new l,stationary:!0};a.hidpi=!1;return a}m(d,g);d.prototype.createElement=function(){var a=document.createElement("canvas");a.setAttribute("class","esri-display-object");return a};d.prototype.setElement=
function(a){this.element=a};d.prototype.takeScreenshot=function(a){var b=this._childrenRenderParameters.state,c={context:null,pixelRatio:a.pixelRatio,state:new l,stationary:!0};c.opacity=this._childrenRenderParameters.opacity;c.state.copy(b);var e=a.framebufferWidth,h=a.framebufferHeight,b=a.region,f=document.createElement("canvas");f.width=e;f.height=h;c.context=f.getContext("2d");this.beforeRenderChildren(c,c);void 0!==a.rotation&&null!==a.rotation?(e=c.state,h=e.clone(),h.viewpoint.rotation=a.rotation,
c.state=h,this.renderChildren(c),c.state=e):this.renderChildren(c);this.afterRenderChildren(c,c);var d;try{d=c.context.getImageData(b.x,b.y,b.width,b.height)}catch(q){return k.reject(q)}return k.resolve(p.encodeResult(d,a,f,{flipY:!1,premultipliedAlpha:!1}))};d.prototype.doRender=function(a){var b=this.element,c=b.style;if(this.visible){var e=a.state,h=a.pixelRatio,d=e.width,e=e.height;b.width=d*(this.hidpi?h:1);b.height=e*(this.hidpi?h:1);c.display="block";c.opacity=""+Math.min(this.opacity,this.parent.opacity);
c.width=d+"px";c.height=e+"px";g.prototype.doRender.call(this,a)}else c.display="none"};d.prototype.prepareChildrenRenderParameters=function(a){var b=this._childrenRenderParameters;b.context=this.element.getContext("2d");b.pixelRatio=a.pixelRatio;b.state.copy(a.state);b.state.pixelRatio=this.hidpi?a.pixelRatio:1;b.stationary=a.stationary;return b};d.prototype.beforeRenderChildren=function(a,b){a=b.context;var c=b.state;a.save();if(c.spatialReference.isWrappable){var e=c.width;b=c.height;var d=c.pixelRatio,
f=this.hidpi?d:1,d=c.rotation*Math.PI/180,g=Math.round(e*f*Math.abs(Math.cos(d))+b*f*Math.abs(Math.sin(d))),c=c.worldScreenWidth*f;c<g&&(e=e*f*.5,b=b*f*.5,d&&(a.translate(e,b),a.rotate(d),a.translate(-e,-b)),a.beginPath(),a.rect(e-.5*c,b-.5*g,c,g),a.closePath(),d&&(a.translate(e,b),a.rotate(-d),a.translate(-e,-b)),a.clip("evenodd"))}};d.prototype.afterRenderChildren=function(a,b){b.context.restore()};d.prototype.renderChild=function(a,b){b.context.save();a.processRender(b);b.context.restore()};return d}(n)});