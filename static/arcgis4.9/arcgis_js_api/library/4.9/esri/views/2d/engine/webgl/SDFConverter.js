// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../core/promiseUtils","./SDFHelper"],function(m,n,p,q){Object.defineProperty(n,"__esModule",{value:!0});m=function(){function l(b){this.size=b;this.canvas=document.createElement("canvas");this.canvas.width=this.canvas.height=b;this.context=this.canvas.getContext("2d");this._gridOuter=new Float64Array(b*b);this._gridInner=new Float64Array(b*b);this._f=new Float64Array(b);this._d=new Float64Array(b);this._z=new Float64Array(b+1);this._v=new Int16Array(b);b=document.createElementNS("http://www.w3.org/2000/svg",
"svg");b.setAttribute("style","position: absolute;");b.setAttribute("width","0");b.setAttribute("height","0");document.body.appendChild(b);this._svg=b}l.prototype.draw=function(b,h){var a=this;void 0===h&&(h=31);var f=this._createSVGString(b);return p.create(function(b){var c=new Image;c.src="data:image/svg+xml; charset\x3dutf8, "+encodeURIComponent(f);c.onload=function(){a.context.clearRect(0,0,a.size,a.size);a.context.drawImage(c,0,0,a.size,a.size);for(var d=a.context.getImageData(0,0,a.size,a.size),
g=new Uint8Array(a.size*a.size*4),e=0;e<a.size*a.size;e++){var f=d.data[4*e+3]/255;a._gridOuter[e]=1===f?0:0===f?1E20:Math.pow(Math.max(0,.5-f),2);a._gridInner[e]=1===f?1E20:0===f?0:Math.pow(Math.max(0,f-.5),2)}a._edt(a._gridOuter,a.size,a.size);a._edt(a._gridInner,a.size,a.size);for(e=0;e<a.size*a.size;e++)q.packFloat(.5-(a._gridOuter[e]-a._gridInner[e])/(2*h),g,4*e);b(g)}})};l.prototype._createSVGString=function(b){var h=document.createElementNS("http://www.w3.org/2000/svg","path");h.setAttribute("d",
b);this._svg.appendChild(h);b=h.getBBox();var a=b.width/b.height,f=this.size/2,k,c,d;1<a?(k=f/=b.width,c=this.size/4,d=c*a):(f=k=f/b.height,d=this.size/4,c=d/a);h.setAttribute("style","transform: matrix("+f+", 0, 0, "+k+", "+(-b.x+c)+", "+(-b.y+d)+")");b='\x3csvg style\x3d"fill:red;" height\x3d"'+this.size+'" width\x3d"'+this.size+'" xmlns\x3d"http://www.w3.org/2000/svg"\x3e'+this._svg.innerHTML+"\x3c/svg\x3e";this._svg.removeChild(h);return b};l.prototype._edt=function(b,h,a){for(var f=this._f,k=
this._d,c=this._v,d=this._z,g=0;g<h;g++){for(var e=0;e<a;e++)f[e]=b[e*h+g];this._edt1d(f,k,c,d,a);for(e=0;e<a;e++)b[e*h+g]=k[e]}for(e=0;e<a;e++){for(g=0;g<h;g++)f[g]=b[e*h+g];this._edt1d(f,k,c,d,h);for(g=0;g<h;g++)b[e*h+g]=Math.sqrt(k[g])}};l.prototype._edt1d=function(b,h,a,f,k){a[0]=0;f[0]=-1E20;f[1]=1E20;for(var c=1,d=0;c<k;c++){for(var g=(b[c]+c*c-(b[a[d]]+a[d]*a[d]))/(2*c-2*a[d]);g<=f[d];)d--,g=(b[c]+c*c-(b[a[d]]+a[d]*a[d]))/(2*c-2*a[d]);d++;a[d]=c;f[d]=g;f[d+1]=1E20}for(d=c=0;c<k;c++){for(;f[d+
1]<c;)d++;h[c]=(c-a[d])*(c-a[d])+b[a[d]]}};return l}();n.default=m});