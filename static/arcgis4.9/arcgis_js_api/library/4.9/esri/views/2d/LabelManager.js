// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/HandleOwner ../../core/throttle ../../core/accessorSupport/decorators ../../layers/support/TileInfo ./engine/webgl/definitions ./engine/webgl/collisions/CollisionEngine ./engine/webgl/collisions/LayerViewSorter ./tiling/TileInfoView".split(" "),function(e,g,h,f,k,l,m,c,n,p,q,r,t){Object.defineProperty(g,"__esModule",{value:!0});e=function(e){function a(b){b=e.call(this)||
this;b._applyVisivilityPassThrottled=m.throttle(b._applyVisivilityPass,64,b);b._previousResolution=Number.POSITIVE_INFINITY;b.lastUpdateId=-1;b.updateRequested=!1;b.view=null;return b}h(a,e);a.prototype.initialize=function(){var b=this,a=n.create({spatialReference:this.view.spatialReference,size:p.TILE_SIZE});this._tileInfoView=new t(a);this._collisionEngine=new q.default(a);this._layerViewSorter=new r.default(function(a,d){b._collisionEngine.registerLayer(a.layer,d);(d=a.tileRenderer)&&d.forEachTile(function(d){d.isDirty=
!0;b.addTile(a.layer.uid,d)});b.requestUpdate()},function(a){b._collisionEngine.unregisterLayer(a.layer);b.requestUpdate()},function(b){(b=b.get("tileRenderer.featuresView"))&&b.fadeInLabels()});this.handles.add(this.view.allLayerViews.on("change",function(a){b._layerViewSorter.update(a)}))};a.prototype.destroy=function(){this._layerViewSorter.destroy();this._collisionEngine=this._layerViewSorter=null;this._applyVisivilityPassThrottled.remove()};Object.defineProperty(a.prototype,"updating",{get:function(){return this.updateRequested},
enumerable:!0,configurable:!0});a.prototype.update=function(b){var a=this._previousResolution,c=b.state.resolution;this._previousResolution=c;c===a&&this._applyVisivilityPassThrottled(b)};a.prototype.viewChange=function(){this.requestUpdate()};a.prototype.requestUpdate=function(){this.updateRequested||(this.updateRequested=!0,this.view.requestUpdate(this))};a.prototype.processUpdate=function(b){this._set("updateParameters",b);this.updateRequested&&(this.update(b),this.updateRequested=!1)};a.prototype.addTile=
function(b,a){this._collisionEngine.addTile(b,a)};a.prototype.removeTile=function(b,a){this._collisionEngine.removeTile(b,a)};a.prototype._applyVisivilityPass=function(a){var b=this._tileInfoView.getClosestInfoForScale(a.state.scale).level;this._collisionEngine.run(a,b)};f([c.property()],a.prototype,"updateRequested",void 0);f([c.property({readOnly:!0})],a.prototype,"updateParameters",void 0);f([c.property({dependsOn:["updateRequested"]})],a.prototype,"updating",null);f([c.property()],a.prototype,
"view",void 0);return a=f([c.subclass("esri.views.2d.layers.labels.LabelManager")],a)}(c.declared(k,l));g.default=e});