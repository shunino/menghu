// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../layers/support/TileInfo ./TileInfoView ./TileKey".split(" "),function(l,m,g,n,h,k,d){return function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a._fullCacheLodInfos=null;a._levelByScale={};return a}g(e,f);e.prototype.getTileParentId=function(a){a=d.pool.acquire(a);var b=0===a.level?null:d.getId(a.level-1,a.row>>1,a.col>>1,a.world);d.pool.release(a);return b};e.prototype.getTileIdAtParent=
function(a,b){b=d.pool.acquire(b);var c=this._infoByLevel[b.level];if(a.resolution<c.resolution)throw d.pool.release(b),Error("Cannot calculate parent tile. destination LOD's resolution "+a.resolution+" is not a parent resolution of "+c.resolution);if(a.resolution===c.resolution)return a=b.id,d.pool.release(b),a;c=b.level-a.level;if(0>c)throw d.pool.release(b),Error("Wrong way...!");a=d.getId(a.level,b.row>>c,b.col>>c,b.world);d.pool.release(b);return a};e.prototype.getTileCoverage=function(a){a=
f.prototype.getTileCoverage.call(this,a);if(!a)return a;var b=1<<a.lodInfo.level;a.spans=a.spans.filter(function(a){return 0<=a.row&&a.row<b});return a};e.prototype.scaleToLevel=function(a){this._fullCacheLodInfos||this._initializeFullCacheLODs(this._lodInfos);if(this._levelByScale[a])return this._levelByScale[a];var b=this._fullCacheLodInfos;if(a>b[0].scale)return b[0].level;for(var c=void 0,d=void 0,c=0;c<b.length-1;c++)if(d=b[c+1],a>d.scale)return c=b[c],c.level+(c.scale-a)/(c.scale-d.scale);return b[b.length-
1].level};e.prototype._initializeFullCacheLODs=function(a){a=0===a[0].level?a.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}}):h.create({size:this.tileInfo.size[0],spatialReference:this.tileInfo.spatialReference}).lods.map(function(a){return{level:a.level,resolution:a.resolution,scale:a.scale}});for(var b=0;b<a.length;b++)this._levelByScale[a[b].scale]=a[b].level;this._fullCacheLodInfos=a};return e}(k)});