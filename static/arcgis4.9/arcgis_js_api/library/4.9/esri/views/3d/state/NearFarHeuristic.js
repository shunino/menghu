// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
define("require exports ../../../geometry/support/scaleUtils ../lib/gl-matrix ../support/earthUtils ../support/mathUtils".split(" "),function(B,q,u,f,r,m){function t(c,b,d,a){d=v/d;c/b>d?(a.far=c,a.near=a.far/b):(a.near=d,a.far=a.near*b);return a}Object.defineProperty(q,"__esModule",{value:!0});q.createNearFarHeuristic=function(c,b,d){return"global"===c?new w:new x(b,d)};var x=function(){function c(b,d){this.elevationProvider=b;this.unitInMeters=u.getMetersPerUnitForSR(d)}c.prototype.compute=function(b,
d,a,c,g){g||(g={near:0,far:0});var n=r.earthRadius,e=b[2]*this.unitInMeters,h=e;c=e-c;var p=this.elevationProvider?this.elevationProvider.getElevationBounds():null;p&&(e=0<=c?h-this.unitInMeters*p[0]:this.unitInMeters*p[1]-h);h=Math.max(a.xmax-a.xmin,a.ymax-a.ymin,4*Math.max(a.xmax-a.xmin,a.ymax-a.ymin));f.vec3d.subtract(d,b,k);l[0]=0<k[0]?a.xmax:a.xmin;l[1]=0<k[1]?a.ymax:a.ymin;l[2]=0<k[2]?h/2:-h/2;f.vec3d.subtract(l,b);f.vec3d.normalize(k);b=1.1*f.vec3d.dot(l,k)*this.unitInMeters;n=Math.sqrt(e*
(e+2*n));a=Math.max(a.xmax-a.xmin,a.ymax-a.ymin);d=a*y*this.unitInMeters;e=m.clamp((e-d)/(a*z*this.unitInMeters-d),0,1);e=m.lerp(n,b,e*e*e);e*=Math.max(Math.log(Math.abs(c)),1);e=Math.min(e,Math.max(34064E4,h));e/=this.unitInMeters;return t(e,A,this.unitInMeters,g)};return c}(),w=function(){function c(){}c.prototype.compute=function(b,d,a,c,g){g||(g={near:0,far:0});d=r.earthRadius;b=f.vec3d.length(b)-d;b=Math.max(Math.abs(b-c),Math.abs(b));c=Math.sqrt(b*(b+2*(d+Math.min(0,c))));b=m.clamp(2E4-(Math.log(b)-
7.983)/9.011*19E3,1E3,2E4);return t(1.2*c,b,1,g)};return c}(),A=2E4,v=2,z=.001,y=1E-4,l=f.vec3d.create(),k=f.vec3d.create()});