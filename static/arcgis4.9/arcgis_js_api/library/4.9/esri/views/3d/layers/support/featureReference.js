// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
define(["require","exports","../../../../layers/graphics/dehydratedFeatures"],function(f,g,k){Object.defineProperty(g,"__esModule",{value:!0});f=function(){function b(d,a){this.highestResolutionVersion=null;this.versions=[];this.markedTile=null;this.ref(d,a)}Object.defineProperty(b.prototype,"isReferenced",{get:function(){return 0!==this.versions.length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isSingle",{get:function(){return 1===this.versions.length&&1===this.versions[0].refCount},
enumerable:!0,configurable:!0});b.prototype.ref=function(d,a,c){void 0===c&&(c=h);var b=this.feature;c.oldVersion=b;for(var f=0,g=this.versions;f<g.length;f++){var e=g[f];if(e.resolution===d){e.refCount++;if((d=this.highestResolutionVersion===e&&!k.equals(a,e.feature))||this.highestResolutionVersion!==e)e.feature=a;c.newVersion=d?a:b;return c}}e={feature:a,resolution:d,refCount:1};this.versions.push(e);!this.highestResolutionVersion||d<this.highestResolutionVersion.resolution?(c.newVersion=a,this.highestResolutionVersion=
e):c.newVersion=b;return c};b.prototype.unref=function(d,a){void 0===a&&(a=h);for(var c=0;c<this.versions.length;c++){var b=this.versions[c];if(b.resolution===d&&(b.refCount--,0===b.refCount)){this.versions[c]=this.versions[this.versions.length-1];this.versions.length--;if(this.highestResolutionVersion===b)return this.recalculateHighestResolutionVersion(),a.oldVersion=b.feature,a.newVersion=this.feature,a;break}}d=this.feature;a.oldVersion=d;a.newVersion=d;return a};Object.defineProperty(b.prototype,
"feature",{get:function(){return this.highestResolutionVersion?this.highestResolutionVersion.feature:null},enumerable:!0,configurable:!0});b.prototype.recalculateHighestResolutionVersion=function(){if(0===this.versions.length)this.highestResolutionVersion=null;else{for(var b=this.versions[0],a=1;a<this.versions.length;a++){var c=this.versions[a];c.resolution<b.resolution&&(b=c)}this.highestResolutionVersion=b}};return b}();g.MultiFeatureReference=f;f=function(){function b(b,a){this._feature=a;this.refCount=
1;this.markedTile=null}Object.defineProperty(b.prototype,"isReferenced",{get:function(){return 0!==this.refCount},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"isSingle",{get:function(){return 1===this.refCount},enumerable:!0,configurable:!0});b.prototype.ref=function(b,a,c){void 0===c&&(c=h);this.refCount+=1;c.oldVersion=this._feature;k.equals(this._feature,a)||(this._feature=a);c.newVersion=this._feature;return c};b.prototype.unref=function(b,a){void 0===a&&(a=h);a.oldVersion=
this._feature;if(0<this.refCount&&(this.refCount--,!this.isReferenced))return a.newVersion=null,a;a.newVersion=this._feature;return a};Object.defineProperty(b.prototype,"feature",{get:function(){return this._feature},enumerable:!0,configurable:!0});return b}();g.SingleFeatureReference=f;var h={oldVersion:null,newVersion:null}});