// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../CameraController ../../../support/earthUtils ../../../support/mathUtils".split(" "),function(h,b,l,m,c,n,f,k){Object.defineProperty(b,"__esModule",{value:!0});b.Direction={LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32};h=function(g){function e(a){var d=g.call(this)||this;d.view=a;d.directionStatus=0;d.direction=c.vec3d.create();d.tmpAxis=c.vec3d.create();d.radiusChange=
0;d.velocity=0;d.tmpP1=c.vec3d.create();d.tmpTransf=c.mat4d.create();return d}l(e,g);Object.defineProperty(e.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});e.prototype.addDirection=function(a){0===this.directionStatus&&c.vec3d.set3(0,0,0,this.direction);this.directionStatus&a||(this.directionStatus|=a,a&(b.Direction.LEFT|b.Direction.RIGHT|b.Direction.FORWARD|b.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),c.vec3d.add(this.direction,this.tmpAxis)):(a=
this.directionStatus&(b.Direction.UP|b.Direction.DOWN),this.radiusChange=a===b.Direction.UP?1:a===b.Direction.DOWN?-1:0),this.velocity=this.computePanVelocity())};e.prototype.removeDirection=function(a){this.directionStatus&=~a;0===this.directionStatus&&this.active?this.finishController():a&(b.Direction.LEFT|b.Direction.RIGHT|b.Direction.FORWARD|b.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),c.vec3d.subtract(this.direction,this.tmpAxis),.01>c.vec3d.length(this.direction)&&c.vec3d.set3(0,
0,0,this.direction)):(a=this.directionStatus&(b.Direction.UP|b.Direction.DOWN),this.radiusChange=a===b.Direction.UP?1:a===b.Direction.DOWN?-1:0)};e.prototype.stepController=function(a,d){g.prototype.stepController.call(this,a,d);a*=this.velocity;var b=!1;if(0<Math.abs(this.radiusChange)){var b=1+a*this.radiusChange,e=d.viewForward,f=c.vec3d.normalize(d.center,this.tmpP1);(-.999<c.vec3d.dot(e,f)||0>this.radiusChange)&&c.vec3d.scale(d.center,b);c.vec3d.scale(d.eye,b);this.velocity=this.computePanVelocity();
b=!0}.01<c.vec3d.length2(this.direction)&&(c.mat4d.identity(this.tmpTransf),c.mat4d.rotate(this.tmpTransf,a,this.direction),c.mat4d.multiplyVec3(this.tmpTransf,d.eye),c.mat4d.multiplyVec3(this.tmpTransf,d.center),c.mat4d.multiplyVec3(this.tmpTransf,d.up),b=!0);b&&m.applyAll(this.view,d,{selection:14,interactionType:4,interactionStartCamera:this.view.state.camera,interactionFactor:null,interactionDirection:null,tiltMode:0})};e.prototype.computePanAxis=function(a,d){var e=this.view.state.camera;c.vec3d.subtract(e.center,
e.eye,d);c.vec3d.cross(d,e.up);if(a===b.Direction.LEFT||a===b.Direction.RIGHT)c.vec3d.normalize(d),c.vec3d.cross(d,e.center);a!==b.Direction.RIGHT&&a!==b.Direction.FORWARD||c.vec3d.negate(d);c.vec3d.normalize(d)};e.prototype.computePanVelocity=function(){var a=.5*Math.abs(c.vec3d.length(this.view.state.camera.eye)-f.earthRadius),a=k.clamp(a,1,2*f.earthRadius);return k.acos(1-a*a/(2*f.earthRadius*f.earthRadius))};return e}(n.CameraController);b.PanContinuousController=h});