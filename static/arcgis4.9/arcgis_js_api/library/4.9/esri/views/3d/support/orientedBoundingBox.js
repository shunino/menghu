// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
define("require exports ../../../geometry/support/aaBoundingBox ../lib/gl-matrix ./dito ./geometryUtils".split(" "),function(p,d,q,e,r,h){function l(a,b,c){return{center:e.vec3d.createFrom(a[0],a[1],a[2]),halfSize:e.vec3.createFrom(b[0],b[1],b[2]),quaternion:e.quat4.createFrom(c[0],c[1],c[2],c[3])}}function f(a,b){var c=h.plane.distance(b,a.center);a=m(a,b);return c>a?1:c<-a?-1:0}function m(a,b){e.quat4.conjugate(a.quaternion,n);e.quat4d.multiplyVec3(n,b,k);a=a.halfSize;return Math.abs(k[0]*a[0])+
Math.abs(k[1]*a[1])+Math.abs(k[2]*a[2])}Object.defineProperty(d,"__esModule",{value:!0});var n=e.quat4.create(),k=e.vec3.create(),t=e.vec3.create(),u=e.mat3.create();p=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=Array(a);for(var b=0;b<a;b++)this.obbs[b]={center:new Float64Array(this.buffer,56*b+0,3),halfSize:new Float32Array(this.buffer,56*b+24,3),quaternion:new Float32Array(this.buffer,56*b+36,4)}}}();d.ObbArray=p;d.create=l;d.clone=function(a){return l(a.center,a.halfSize,
a.quaternion)};d.set=function(a,b){e.vec3d.set(a.center,b.center);e.vec3.set(a.halfSize,b.halfSize);e.quat4.set(a.quaternion,b.quaternion)};d.compute=function(a,b){b||(b=l([0,0,0],[-1,-1,-1],[0,0,0,1]));r.computeOBB(a,b);return b};d.intersectPlane=f;d.toAaBoundingBox=function(a,b){b||(b=q.create());var c=e.quat4.toMat3(a.quaternion,u),d=a.halfSize[0]*Math.abs(c[0])+a.halfSize[1]*Math.abs(c[3])+a.halfSize[2]*Math.abs(c[6]),f=a.halfSize[0]*Math.abs(c[1])+a.halfSize[1]*Math.abs(c[4])+a.halfSize[2]*Math.abs(c[7]),
c=a.halfSize[0]*Math.abs(c[2])+a.halfSize[1]*Math.abs(c[5])+a.halfSize[2]*Math.abs(c[8]);b[0]=a.center[0]-d;b[1]=a.center[1]-f;b[2]=a.center[2]-c;b[3]=a.center[0]+d;b[4]=a.center[1]+f;b[5]=a.center[2]+c;return b};d.minimumDistancePlane=function(a,b){var c=h.plane.distance(b,a.center);a=m(a,b);return c-a};d.maximumDistancePlane=function(a,b){var c=h.plane.distance(b,a.center);a=m(a,b);return c+a};d.isVisible=function(a,b){return 0>=f(a,b[0])&&0>=f(a,b[1])&&0>=f(a,b[2])&&0>=f(a,b[3])&&0>=f(a,b[4])&&
0>=f(a,b[5])};d.intersectLine=function(a,b,c,d){void 0===d&&(d=0);e.quat4.conjugate(a.quaternion,n);e.vec3d.subtract(b,a.center,k);b=e.quat4d.multiplyVec3(n,k,k);c=e.quat4d.multiplyVec3(n,c,t);for(var f=-Infinity,h=Infinity,g=0;3>g;g++)if(1E-6<Math.abs(c[g]))var l=(d+a.halfSize[g]-b[g])/c[g],m=(-d-a.halfSize[g]-b[g])/c[g],f=Math.max(f,Math.min(l,m)),h=Math.min(h,Math.max(l,m));else if(b[g]>a.halfSize[g]+d||b[g]<-a.halfSize[g]-d)return!1;return f<=h}});