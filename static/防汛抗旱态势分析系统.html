<!DOCTYPE html>
<!-- saved from url=(0022)http://127.0.0.1:9527/ -->
<html class="dj_webkit dj_chrome dj_contentbox"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>
    防汛抗旱态势分析系统
  </title>
  <link rel="shortcut icon" href="http://127.0.0.1:9527/images/favicon.ico" type="image/x-icon">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    html,
    body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
      font-family: 微软雅黑;
      /* background-image: url(images/Default_background.png);
            background-color: #000;
            background-repeat: no-repeat;
            background-size: 100% 100%; */
    }
  </style>
  <link href="./防汛抗旱态势分析系统_files/font-awesome.css" rel="stylesheet">
  <link href="./防汛抗旱态势分析系统_files/bootstrap.min.css" rel="stylesheet">
  <link href="./防汛抗旱态势分析系统_files/layui.css" rel="stylesheet">
  <link href="./防汛抗旱态势分析系统_files/index.css" rel="stylesheet">
  <!--<link href="/dist/css/main.css" rel="stylesheet" />-->
  <link href="./防汛抗旱态势分析系统_files/main.css" rel="stylesheet">
  <link href="./防汛抗旱态势分析系统_files/tabStyle.css" rel="stylesheet">
  <link href="./防汛抗旱态势分析系统_files/zTreeStyle.css" rel="stylesheet">
  <link href="./防汛抗旱态势分析系统_files/bootstrap-table.min.css" rel="stylesheet">
  <script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/dojo_zh-cn.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/MapView.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/SceneView.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/GoogleAnnoLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/BaseTileLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Zoom.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/WMSLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/GraphicsLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/GoogleImageLayerBaseMap.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Home.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/MapToolBar.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/vue.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/MapView_zh-cn.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/zh-cn.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/ExportWMSImageParameters.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/WMSSublayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/wmsUtils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/MemoryController.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/WebTileLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/HomeViewModel.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/SketchViewModel.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/SceneView_zh-cn.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/FloodLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Draw.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Box.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/GraphicMover.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Reshape.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/sketchUtils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Home.js(1).下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/MultipointDrawAction.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/PointDrawAction.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/PolygonDrawAction.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/PolylineDrawAction.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/SegmentDrawAction.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/geometryEngine.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/boundsUtils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/drawUtils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/GraphicMoverEvents.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Circle.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Home.js(2).下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/DrawAction.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/DrawEvents.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Keys.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/geodesicUtils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/IdentityManager.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/ElevationQuery.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/TileLayerView3D.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/GraphicsLayerView3D.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/SmaaRenderPassData.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/ImageryLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/MapImageLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/KMLLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/WMTSLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/IdentityManager_zh-cn.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/ElevationTile.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Graphics3DGraphicLikeLayerView.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/PointLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/ArcGISImageService.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/KMLSublayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/kmlUtils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/WMTSSublayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/wmtsUtils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Raster.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/PixelBlock.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/MosaicRule.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/RasterFunction.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/DimensionalDefinition.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/ImageServiceIdentifyTask.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/ImageServiceIdentifyParameters.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/TileMatrixSet.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/WMTSStyle.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/JpgPlus.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Png.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Raw.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/ImageServiceIdentifyResult.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Zlib.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/Jpg.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/EmptyPointLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/MemorySourceWorker.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/WMSLayerView3D.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/featureConversionUtils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/DefaultSpatialIndex.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/projectionSupport.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/QueryEngine.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/DynamicLayerView3D.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/FeatureStore.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/projection.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/attributeSupport.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/QueryEngineCapabilities.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/QueryEngineResult.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/SpatialQueryCache.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/spatialQuerySupport.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/utils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/overlayImageUtils.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/rbush.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/pe.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/GeographicTransformation.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/LRUCache.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/AttributesBuilder.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/GeographicTransformationStep.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/ForestPointLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/EarlyWarningPointLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/HpzhyhdPointLayer.js.下载"></script><script type="text/javascript" charset="utf-8" src="./防汛抗旱态势分析系统_files/TwoDTestPoint.js.下载"></script><script>
    var isLan = parseInt('0');
    var pwdSafe = ('');
    var pwdSafeTxt = ('&nbsp;&nbsp;&nbsp;&nbsp;根据中央网信办、公安部关于网络安全保卫工作的有关要求,对系统密码要求必须为强密码,要求如下：密码长度8位以上，同时含有数字、字母、特殊字符，不能含有自然顺序的数字或字母，不能与用户名重复等。<br>&nbsp;&nbsp;&nbsp;&nbsp;检测到您的');
    // var pwdSafe = '低';
    // var pwdSafeTxt = "密码为数字或者字符,密码为全数字,安全级别<span>《低》</span>,密码长度小于8位,建议修改密码!";
  </script>
  <!--添加three.js，渲染，three必须放于arcgis之前-->
  <script src="./防汛抗旱态势分析系统_files/three.min.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/vue.js(1).下载"></script>
  <script src="./防汛抗旱态势分析系统_files/index.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/jquery-3.1.1.min.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/jquery-ui.min.js.下载"></script>
  <!--<script src="/plugin/jquery.cookie/jquery.cookie.js"></script>-->
  <script src="./防汛抗旱态势分析系统_files/moment.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/moment-range.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/echarts.min.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/yangtze-config.js.下载"></script>
  <!--<script src="/plugin/echarts3/echarts.min.js"></script>-->
  <script src="./防汛抗旱态势分析系统_files/jquery.ztree.core.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/jquery.ztree.exedit.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/jquery.ztree.excheck.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/Radar.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/animationCounter.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/layui.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/moment.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/WdatePicker.js.下载"></script><link href="./防汛抗旱态势分析系统_files/WdatePicker.css" rel="stylesheet" type="text/css">
  <script src="./防汛抗旱态势分析系统_files/index.js(1).下载"></script>
  <script src="./防汛抗旱态势分析系统_files/hashmap.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/notifier.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/util.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/config.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/config.js(1).下载"></script>
  <script src="./防汛抗旱态势分析系统_files/objects.js.下载"></script>
  <script>
    var privilegeBaseData = ('{"userId":"gz@520000","userName":"贵州省应急管理厅","adcd":["520000000000000"],"userZoom":8,"adnm":"贵州省","privilege":[{"mocd":null,"ptype":0,"id":null,"userid":"gz@520000"}],"isLan":0,"rid":null,"usertype":1,"pwdSafe":null,"pwdSafeTxt":"&nbsp;&nbsp;&nbsp;&nbsp;根据中央网信办、公安部关于网络安全保卫工作的有关要求,对系统密码要求必须为强密码,要求如下：密码长度8位以上，同时含有数字、字母、特殊字符，不能含有自然顺序的数字或字母，不能与用户名重复等。<br>&nbsp;&nbsp;&nbsp;&nbsp;检测到您的"}');
    var wkt = ('');
    var userPrivilege = ('520000000000000');
    var adnm = ('贵州省');
    var userAdnm = ('贵州省');
    var userZoom = ('8');
    var DOWNLOAD_URL = ('http://120.52.31.33:8083/weather_files/');
    var SYSTEM_TIME = parseInt('1573354724850');
    var LOCAL_TIME = Date.now();
    var user = JSON.parse(privilegeBaseData);
    $(function () {
      layui.use('layer', function () {
        layer = layui.layer;
      });
      var basicLayers = [];
      note.on("map.ready", () => {
        initOnLoadWeather("", "subject");
      });
    });
    var isBigdataIndex = false;
  </script>
<link id="layuicss-layer" rel="stylesheet" href="./防汛抗旱态势分析系统_files/layer.css" media="all"><link id="layuicss-laydate" rel="stylesheet" href="./防汛抗旱态势分析系统_files/laydate.css" media="all"></head>

<body id="index-body">

  <style>
    /*本地地址*/
    /* @import url(https://arcgis.dfsjcloud.com/arcgis_js_api/library/4.9/dijit/themes/claro/claro.css);
    @import url(https://arcgis.dfsjcloud.com/arcgis_js_api/library/4.9/esri/css/main.css); */

    /*华为云地址*/
    /* @import url(http://120.52.31.33:8083/arcgis_js_api/library/4.9/dijit/themes/claro/claro.css);
    @import url(http://120.52.31.33:8083/arcgis_js_api/library/4.9/esri/css/main.css); */

    /*华为云地址58*/
    /* @import url(http://58.42.247.176:8089/arcgis_js_api/library/4.9/dijit/themes/claro/claro.css);
    @import url(http://58.42.247.176:8089/arcgis_js_api/library/4.9/esri/css/main.css); */

    /*本地测试地址*/
    /* @import url(localhost:3000/arcgis_js_api/library/4.9/dijit/themes/claro/claro.css);
    @import url(localhost:3000/arcgis_js_api/library/4.9/esri/css/main.css); */

    /*本地地址*/
    @import url(/plugin/arcgis4.9/arcgis_js_api/library/4.9/dijit/themes/claro/claro.css);
    @import url(/plugin/arcgis4.9/arcgis_js_api/library/4.9/esri/css/main.css);

    #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
    }

    .popup {
        width: 300px;
        height: 300px;
        background-color: black;
        color: white;
    }

    #bg {
        height: 100%;
        width: 100%;
        background-image: url(/images/Default_background.png);
        background-color: #000;
        background-repeat: no-repeat;
        background-size: 100% 100%;
    }
</style>

<div id="viewDiv" style="position: fixed; cursor: default;" class="esri-view esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge esri-view-orientation-landscape esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge"><div class="esri-view-root"><div class="esri-view-surface esri-view-surface--inset-outline" role="application" tabindex="0" style="user-select: none; touch-action: none;" data-interacting="false"><canvas style="width: 100%; height:100%; display:block;" width="1034" height="803"></canvas></div><div class="esri-overlay-surface" style="user-select: none;"><div style="visibility: hidden;"></div></div><div class="esri-ui" style="top: 0px; left: 0px; right: 0px; bottom: 0px;"><div class="esri-ui-inner-container esri-ui-manual-container"><div class="esri-component esri-popup" role="presentation"></div><div class="esri-component esri-spinner"></div></div><div class="esri-ui-inner-container esri-ui-corner-container" style="top: 15px; left: 15px; right: 15px; bottom: 15px;"><div class="esri-ui-top-left esri-ui-corner"></div><div class="esri-ui-top-right esri-ui-corner"></div><div class="esri-ui-bottom-left esri-ui-corner"></div><div class="esri-ui-bottom-right esri-ui-corner"></div></div></div></div><div class="esri-view-user-storage">
    <div id="bg"></div>
</div></div>
<script src="./防汛抗旱态势分析系统_files/map.config.js.下载"></script>
<!--本地地址-->
<!-- <script src="https://arcgis.dfsjcloud.com/arcgis_js_api/library/4.9/dojo/dojo.js"></script> -->

<!--华为云地址-->
<!-- <script src="http://120.52.31.33:8083/arcgis_js_api/library/4.9/dojo/dojo.js"></script> -->

<!--华为云地址58-->
<!-- <script src="http://58.42.247.176:8089/arcgis_js_api/library/4.9/dojo/dojo.js"></script> -->

<!-- 本地测试地址 -->
<!-- <script src="localhost:3000/arcgis_js_api/library/4.9/dojo/dojo.js"></script> -->

<!-- 本地地址 -->
<script src="./防汛抗旱态势分析系统_files/dojo.js.下载"></script>

<!-- <script>
    var theHead = document.getElementsByTagName('head').item(0);
    //创建脚本的dom对象实例
    var myScript = document.createElement('script');
    if (isLan == 0) {
        //外网
        myScript.src = 'http://120.52.31.33:8083/arcgis_js_api/library/4.9/dojo/dojo.js';           //指定脚本路径
    } else {
        //内网
        myScript.src = 'http://120.52.31.33:8083/arcgis_js_api/library/4.9/dojo/dojo.js';           //指定脚本路径
    }
    myScript.type = 'text/javascript';  //指定脚本类型
    myScript.defer = true;              //程序下载完后再解析和执行
    theHead.appendChild(myScript);      //把dom挂载到头部

</script> -->

  <!--  &lt;!&ndash; 地图 &ndash;&gt;-->
  <div id="mainHeader"><div id="typhoon-path-head-title" style="position: absolute; left: 45%; top: 100px; color: rgb(235, 238, 245); display: none; font-size: 20px;"></div> <div id="header-back"><div class="mainheader-playinfo"><div class="mainheader-playinfo-box"><span style="background: rgb(0, 93, 204);">降水实况</span> <span style="background: rgb(0, 93, 204);">2019年11月10日8时 ~ 11月10日11时</span></div></div></div> <div class="user-repasswrod"><div class="re-password-div" style="overflow: hidden;"><div style="color: red; font-size: 12px;"></div> <div><div class="password-input-left">
          原密码:
        </div> <div class="user-repwd-input-right"><input type="password" id="user_old_password" placeholder="请输入原密码" class="form-control"></div> <div style="display: inline-block;"><span style="color: red;">*</span></div></div> <div><div class="password-input-left">
          新密码:
        </div> <div class="user-repwd-input-right"><input type="password" id="user_new_password" placeholder="请输入新密码" class="form-control"></div> <div style="display: inline-block;"><span style="color: red;">*</span><span style="margin-left: 5px; font-size: 12px; color: green;"></span></div></div> <div><div class="password-input-left">
          再次输入新密码:
        </div> <div class="user-repwd-input-right"><input type="password" id="user_new_repassword" placeholder="请再次输入密码" class="form-control"></div> <div style="display: inline-block;"><span style="color: red;">*</span><span style="margin-left: 5px; font-size: 12px; color: green;"></span></div></div> <div style="color: green; font-size: 14px;">提示：密码长度8位以上，同时含有数字、字母、特殊字符，不能含有自然顺序的数字或字母，不能与用户名重复</div> <div id="user_re_password_submit" style="margin-top: 30px; margin-left: 100px;"><button class="btn-info" style="width: 65px; height: 33px; background-image: url(&quot;/images/window/btn.png&quot;); border: none;">提交</button></div></div></div></div>

<script type="text/javascript">
  $(function () {
    let vm = new Vue({
      el: "#mainHeader",
      data: {
        subject: {
          selected: null,
          list: []
        },
        playinfo: {
          visible: true,
          label: "",
          time: ""
        },
        icon: "",
        isActive: true,
        isActiveOne: false,
        user: {
          show: false
        },
        newPassword: '',
        oldPassword: '',
        againPassword: '',
        tips: '',
        againTips: '',
        message: '',
        tipsState: ''
      },
      mounted() {
        //获取专题
        note.on("layer.play.frame", this.onFrame);
        note.on("play.control.visible", (e, v) => this.playinfo.visible = v);
      },
      methods: {
        onFrame(e, index, provider) {
          let info = provider.playinfo(index);
          this.playinfo.label = info.label;
          this.playinfo.time = info.time;
        },
        keyupValid() {
          this.tips = this.valid(this.newPassword);
        },
        keyupAgainValid() {
          this.againTips = this.validIsSame(this.againPassword);
        },
        validIsSame(pwd) {
          var txt = '';
          if (pwd == this.newPassword) {
            txt = '与新密码一致'
          } else {
            txt = '与新密码不一致';
          }
          if (pwd.length == 0) txt = '';
          this.message = '';
          return txt;
        },
        valid(pwd) {
          var pattern_d = /^\d+$/;            //全数字
          var pattern_s = /^[A-Za-z]+$/       //全字符
          var pattern_w = /^\w+$/;            //数字或者字符
          var pattern_W = /^\W+$/             //全非数字也非字符
          var pattern_r = /^\w+\W+[\w\W]*\w+$/    //以字母或者数字开头结尾的字符串
          var pattern_all = /^(?=.*\d)(?=.*[a-zA-Z])(?=.*[~!@#$%^&*])[\da-zA-Z~!@#$%^&*]{8,}$/  // 必须包含数字、英文字母、特殊符号且大于等于8位,特殊符号包括: ~!@#$%^&*
          var txt = '';
          if (pattern_d.exec(pwd) || pattern_s.exec(pwd) || pwd.length < 8) {
            txt = "密码强度：低";
            this.tipsState = "低";
          }

          if (pattern_w.exec(pwd) && pwd.length > 8) {
            txt = "密码强度：中";
            this.tipsState = "中";
          }

          if (pattern_all.exec(pwd)) {
            txt = "密码强度：高";
            this.tipsState = "高";
          }
          if (pwd.length == 0) txt = '';
          this.message = '';
          return txt;
        },
        submit() {
          if (!this.oldPassword || !this.newPassword) {
            this.message = '原密码或新密码不能为空！';
            return;
          }
          if (this.newPassword != this.againPassword) {
            this.message = '两次新密码不一致，请重新输入！'
            return;
          }
          if (this.tipsState == '低') {
            this.message = '密码强度过“低”,不能修改，请按提示要求重新输入！';
            return;
          }
          ajaxCallJson({ oldPwd: this.oldPassword, newPwd: this.newPassword }, '/user/updateUserPwd', function (result) {
            if (result && result.flag) {
              layer.msg('密码修改成功', { time: 1500 });
              layer.close(rePasswordLayer);
              window.location.href = 'login/logout';
            } else {
              layer.msg(result.error, { time: 1500 });
            }
          });
        }
      },
    });
  });
</script>

<!-- 其他 -->
<style>
  .myFloodRight{
    position: absolute;
    right: 10px;
    top:157px;
    width: 137px;
    /*height: 180px;*/
    height: 136px;
    background-color: rgba(9,25,57,.99) !important;
    border-radius:5px;
    display: flex;
    align-items: center;
    flex-direction: column;
  }
  .myFloodRight .myFhead{
    width: 100%;
    height: 30px;
    line-height: 30px;
    text-align: center;
    color: white;
  }
  .myFloodRight .mt10{
    margin-top: 10px;
  }
</style>
<div id="mainbox-others"><div class="myFloodRight"><div class="myFhead">暴雨影响分析</div> <div class="mt10" style="padding-left: 10px;"><div role="group" aria-label="checkbox-group" class="el-checkbox-group" style="display: flex; flex-direction: column;"><label role="checkbox" aria-checked="true" class="el-checkbox is-checked"><span aria-checked="mixed" class="el-checkbox__input is-checked"><span class="el-checkbox__inner"></span><input type="checkbox" aria-hidden="true" name="01" class="el-checkbox__original" value="水库"></span><span class="el-checkbox__label">水库</span></label><label role="checkbox" class="el-checkbox is-checked" aria-checked="true"><span aria-checked="mixed" class="el-checkbox__input is-checked"><span class="el-checkbox__inner"></span><input type="checkbox" aria-hidden="true" name="50" class="el-checkbox__original" value="村庄"></span><span class="el-checkbox__label">村庄</span></label></div></div> <div class="mt10"><button type="button" class="el-button el-button--default el-button--mini"><!----><!----><span>选择</span></button> <button type="button" class="el-button el-button--primary el-button--mini"><!----><!----><span>取消</span></button></div></div></div>
<script>
  var clickFloodMapPoint = function (pointObj, mapPoint) {
    console.log(pointObj,mapPoint);
    var parm = {
      mocd: pointObj.mocd,
      time: today + ' ' + '00:00:00'
    };
    ajaxCallJson(parm, "/base/getRealRsvrData", (data) => {
      if (data.flag) {
        var obj = {
          stcd: data.data.stcd ? data.data.stcd : '-', //站点编码
          drp: data.data.drp ? data.data.drp : '-', //日雨量(mm)
          inq: data.data.inq ? data.data.inq : '-', //入库流量
          monm: data.data.monm ? data.data.monm : '-', //名称
          otq: data.data.otq ? data.data.otq : '-', //出库流量
          rz: data.data.rz ? data.data.rz : '-', //库水位(m)
          tm: data.data.tm ? moment(parseInt(data.data.tm)).format('YYYY-MM-DD HH:mm:ss') : '-', //时间
          w: data.data.w ? data.data.w : '-', //库容(万/m³)
          warnnm: data.data.warnnm ? data.data.warnnm : '-', //预警名称
          floodLevel: data.data.floodLevel ? data.data.floodLevel : '-', //top点洪水等级编码
          floodName: data.data.floodName ? data.data.floodName : '-', //洪水等级
          mapPoint: mapPoint
        }
        var html = '';
        html += '<div id="popup" class="pointlayer-popup">' +
                '<div class="pointlayer-popup-item">' +
                '<div class="popup-item-name popup-item">站点编码</div>' +
                '<div class="popup-item-vlaue popup-item">' + obj.stcd + '</div>' +
                '</div>' +
                '<div class="pointlayer-popup-item">' +
                '<div class="popup-item-name popup-item">洪水等级</div>' +
                '<div class="popup-item-vlaue popup-item">' + obj.floodName + '</div>' +
                '</div>' +
                '<div class="pointlayer-popup-item">' +
                '<div class="popup-item-name popup-item">库水位(m)</div>' +
                '<div class="popup-item-vlaue popup-item">' + obj.rz + '</div>' +
                '</div>' +
                '<div class="pointlayer-popup-item">' +
                '<div class="popup-item-name popup-item">库容(万m³)</div>' +
                '<div class="popup-item-vlaue popup-item">' + obj.w + '</div>' +
                '</div>';
        html += '<div class="pointlayer-popup-item">' +
                '<div class="popup-item-name popup-item">时间</div>' +
                '<div class="popup-item-vlaue popup-item">' + obj.tm + '</div>' +
                '</div>' +
                '</div>';
        showPopup(html, obj);

      }
    });
  }
  var myFolTo;
  $(function () {
    note.on("other.rainAffect.tochecked", (event, checked, station,type) => {
      console.log(station);
      if (checked) {
        toAddMapHong(station,type);
      } else {
        let mysta = {
          motype: [type],
          sttype: 123
        }
        clearCurrentPointForMap(mysta);
        clearCurrentParam(mysta);//
        clearCurrentParamObj(gloablePointTypeObj, mysta);//删除取消的地图上存在的点的全局参数对象
      }
    })
    function toAddMapHong(station,type) {
      let body = {
        interface: "/com.ec.ws.service.def.analyse.AnalyseService",
        method: "findRainAffectList",
        param :[3,station.adcd ,station.datatime]
      }
      ajaxCallJson(body, '/rpc/findArea', function (data) {
        if (data.resflag) {
          if (data.data) {
            layer.close(subjectIndex);
            let mydata = data.data.points;
            console.log(mydata);
            let obj = {};
            let objClass = [];
            let icon1 = {
              maxValue:2,
              minValue: 1,
              symbol: {type: "picture-marker", url: "/images/mapIcon/01/5.png", width: "25px", height: "25px"}};
            let icon2 = {
              maxValue:5,
              minValue: 3,
              symbol: {type: "picture-marker", url: "/images/mapIcon/01/6.png", width: "25px", height: "25px"}};
            objClass.push(icon1);
            objClass.push(icon2);
            let trueMydata1 = [];
            let trueMydata2 = [];
            for(let i in mydata){
              //mydata[i]['monm'] = mydata[i]['nodenm'];
              //mydata[i]['ObjectID'] = mydata[i]['adcd'];
              mydata[i]['occurtime'] = mydata[i]['warning'];
              mydata[i]['wname'] = mydata[i]['warning'];
              mydata[i]['index'] = mydata[i]['warning'];
              mydata[i]['intv'] = mydata[i]['warning'];

              if(mydata[i]['motype']=='01'){
                mydata[i]['wlevel'] = 2;
                trueMydata1.push(mydata[i]);
              } else{
                mydata[i]['wlevel'] = 3;
                trueMydata2.push(mydata[i]);
              }
            }
            obj['classBreakInfos'] = objClass;
            if(type=='01'){
              obj['mapPointArr'] = trueMydata1;
            } else if(type=='50'){
              obj['mapPointArr'] = trueMydata2;
            }
            addPointToMap1({}, obj,type);
          } else {
            // layer.close(subjectIndex);
            // clearRemovePoint(obj.motype);
            // noDataAddFeatureLayer(obj);
          }
        }
      })
    }
    var addPointToMap1 = function (pobj, data,type) {
      require([
        "myMap/layer/FloodLayer", //引用加载地图点模块
      ], function (PointLayer) {
        var pointLayerObj;
        pointLayerObj = new PointLayer(data.mapPointArr, data.classBreakInfos, 'featurePoint'+type+'123');
        addToMapPoint(pointLayerObj);
      })
    }

  });
 $(function () {
  myFolTo = new Vue({
     el: "#mainbox-others",
     data:{
       dialogVisible:true,
       myshow:1,
       myparam:{},
       checkOption:[
         {
           label:'水库',
           value:'01'
         },
         {
           label:'村庄',
           value:'50'
         }
       ],
       checkList:[]
     },
     mounted(){
       this.test1();
     },
     methods:{
       getType(par){
         //this.checkOption = par;
       },
       checkChange(val,a){
         console.log(val);
         console.log(a.target.name);
         if(val){
             note.notify("other.rainAffect.tochecked", true,this.myparam,a.target.name);
         } else {
           note.notify("other.rainAffect.tochecked", false, this.myparam,a.target.name);
         }
       },
       cancel(){
         // note.notify("other.rainAffect.tochecked", false,this.myparam);
         // this.dialogVisible = false;
       },
       test1(){
         let body = {
           interface: "/com.ec.ws.service.def.analyse.AnalyseService",
           method: "findRainAffect",
           param :[3]
         }
         ajaxCallJson(body, "/rpc/findArea", (data) => {
           this.test(data.data[0]);
           //this.cityCas= data.data;
         });
       },
       test(params){
         this.myparam = params;
         note.notify("other.rainAffect.tochecked", true,params,'01');
         note.notify("other.rainAffect.tochecked", true,params,'50');
       }
     }
  });
 });
</script>

<div id="mainBox">
  <div class="mainBox-temp">
    <div class="hideBox">
      <img src="./防汛抗旱态势分析系统_files/left.png">
    </div>
    <!-- 头部 -->
    <div id="mainBox-logo">
      <img src="./防汛抗旱态势分析系统_files/logo.png">
    </div>
    <div class="mainBox-header">
      <div class="mainBox-header-left" onmouseenter="showLoginOut()" onmouseleave="hideLoginOut()">
        <div class="mainBox-outlogin">
          <div style="width: 100%;height: 100%;display: flex;flex-direction: column;">
            <span onclick="loginOut()" style="height: 50%">注销登录</span>
            <span onclick="changePassword()" style="height: 50%">修改密码</span>
          </div>
        </div>
        <div class="mainBox-header-user-box">
          <img src="./防汛抗旱态势分析系统_files/user.png">
        </div>
        <div class="mainBox-header-left-username">
          贵州省应急管理厅</div>
      </div>
      <div class="mainBox-header-right">
        <a id="big-data-windows" class="mainBox-header-calendar"><img src="./防汛抗旱态势分析系统_files/日历_大数据.png" title="综合态势" onclick="changBigData()"></a>
        <a id="trend-briefing" class="mainBox-header-calendar"><img src="./防汛抗旱态势分析系统_files/日历_趋势快报.png" title="趋势快报"></a>
        <a id="real-time-briefing" class="mainBox-header-calendar"><img src="./防汛抗旱态势分析系统_files/日历_实时简报.png" title="实时简报"></a>

        <a id="mySearchShu" class="mainBox-header-calendar"><img src="./防汛抗旱态势分析系统_files/mysearch.png" title="历史查询"></a>
      </div>
    </div>

    <!-- 日历 -->
    <div class="mainBox-calender"></div>
    <div class="date-box" id="date-box">
  <div class="date-main" id="date-main" lay-key="1"><div id="layui-laydate1" class="layui-laydate layui-laydate-static laydate-theme-calendarBox"><div class="layui-laydate-main laydate-main-list-0"><div class="layui-laydate-header"><i class="layui-icon laydate-icon laydate-prev-y"></i><i class="layui-icon laydate-icon laydate-prev-m"></i><div class="laydate-set-ym"><span lay-ym="2019-11" lay-type="year">2019年</span><span lay-ym="2019-11" lay-type="month">11月</span></div><i class="layui-icon laydate-icon laydate-next-m"></i><i class="layui-icon laydate-icon laydate-next-y"></i></div><div class="layui-laydate-content"><table><thead><tr><th>日</th><th>一</th><th>二</th><th>三</th><th>四</th><th>五</th><th>六</th></tr></thead><tbody><tr><td lay-ymd="2019-10-27" class="laydate-day-prev">27</td><td lay-ymd="2019-10-28" class="laydate-day-prev">28</td><td lay-ymd="2019-10-29" class="laydate-day-prev">29</td><td lay-ymd="2019-10-30" class="laydate-day-prev">30</td><td lay-ymd="2019-10-31" class="laydate-day-prev">31</td><td lay-ymd="2019-11-1" class="">1</td><td lay-ymd="2019-11-2" class="">2</td></tr><tr><td lay-ymd="2019-11-3" class="">3</td><td lay-ymd="2019-11-4" class="">4</td><td lay-ymd="2019-11-5" class="">5</td><td lay-ymd="2019-11-6" class="">6</td><td lay-ymd="2019-11-7" class="">7</td><td lay-ymd="2019-11-8" class="">8</td><td lay-ymd="2019-11-9" class="">9</td></tr><tr><td lay-ymd="2019-11-10" class="layui-this">10</td><td lay-ymd="2019-11-11" class="">11</td><td lay-ymd="2019-11-12" class="">12</td><td lay-ymd="2019-11-13" class="">13</td><td lay-ymd="2019-11-14" class="">14</td><td lay-ymd="2019-11-15" class="">15</td><td lay-ymd="2019-11-16" class="">16</td></tr><tr><td lay-ymd="2019-11-17" class="">17</td><td lay-ymd="2019-11-18" class="">18</td><td lay-ymd="2019-11-19" class="">19</td><td lay-ymd="2019-11-20" class="">20</td><td lay-ymd="2019-11-21" class="">21</td><td lay-ymd="2019-11-22" class="">22</td><td lay-ymd="2019-11-23" class="">23</td></tr><tr><td lay-ymd="2019-11-24" class="">24</td><td lay-ymd="2019-11-25" class="">25</td><td lay-ymd="2019-11-26" class="">26</td><td lay-ymd="2019-11-27" class="">27</td><td lay-ymd="2019-11-28" class="">28</td><td lay-ymd="2019-11-29" class="">29</td><td lay-ymd="2019-11-30" class="">30</td></tr><tr><td lay-ymd="2019-12-1" class="laydate-day-next">1</td><td lay-ymd="2019-12-2" class="laydate-day-next">2</td><td lay-ymd="2019-12-3" class="laydate-day-next">3</td><td lay-ymd="2019-12-4" class="laydate-day-next">4</td><td lay-ymd="2019-12-5" class="laydate-day-next">5</td><td lay-ymd="2019-12-6" class="laydate-day-next">6</td><td lay-ymd="2019-12-7" class="laydate-day-next">7</td></tr></tbody></table></div></div><div class="layui-laydate-footer"><div class="laydate-footer-btns"><span lay-type="now" class="laydate-btns-now">回到今天</span></div></div></div></div>
</div>

<div id="calendar-main" class="calendar-toolbar-main">
  <div class="calendar-toolbar-top">
    <div class="calendar-toolbar-top-left">
      <div id="calendarDate" class="calendar-link" onclick="calendarOpen()">
    <ul>
        <li>2019年11月10日</li>
    </ul></div>
    </div>
    <div class="calendar-toolbar-top-right">
      <div id="calendarGoToday" class="calendar-back"><img src="./防汛抗旱态势分析系统_files/日历_回到今天.png" style="height: 20px;" title="回到今天">
      </div>
      <div id="calendarChangeDay" class="calendar-change">
        <span name="prev">上一天</span>
        <span name="next">下一天</span>
      </div>
    </div>
  </div>

  <div class="calendar-toolbar-bottom">
    <div class="warning-box">
      <div class="warning-main">
        <div class="calendar-warning-count">

          <!-- <div id="count-loading">
            <i class="layui-icon layui-icon-loading-1 layui-icon layui-anim layui-anim-rotate layui-anim-loop"
              style="font-size: 25px;"></i>
          </div> -->

          <div class="warning-storm">
            <span class="warning-tips">暴雨预警</span>
            <div class="warning-storm-tips">
              <span><i class="fa fa-window-minimize fa-rotate-90 fa-font-size" style="color: #FF0000;" aria-hidden="true"></i>红色预警</span>
              <span><i class="fa fa-window-minimize fa-rotate-90 fa-font-size" style="color: #FF9900;" aria-hidden="true"></i>橙色预警</span>
              <span><i class="fa fa-window-minimize fa-rotate-90 fa-font-size" style="color: #FFFF00;" aria-hidden="true"></i>黄色预警</span>
              <span><i class="fa fa-window-minimize fa-rotate-90 fa-font-size" style="color: #3266FF;" aria-hidden="true"></i>蓝色预警</span>
            </div>
            <div id="暴雨预警" class="warning-storm-data">
      <span class="very-danger-color" data-total="0">0</span>
      <span class="high-danger-color" data-total="0">0</span>
      <span class="danger-color" data-total="0">0</span>
      <span class="low-dange-color" data-total="0">0</span></div>
          </div>
          <div class="line"></div>
          <div class="warning-flood">
            <div class="warning-flood-box">
              <span class="warning-tips">洪水等级</span>
              <span class="warning-point" id="warning-point">
                <form class="layui-form" action="http://127.0.0.1:9527/">
                  <input type="checkbox" name="like1[write]" checked="" lay-skin="blueBox" title="预警点" value="" id="13" lay-filter="watershedlayers"><div class="layui-unselect layui-form-checkbox layui-form-checked" lay-skin="blueBox"><span>预警点</span><i class="layui-icon layui-icon-ok"></i></div>
                </form>
              </span>
            </div>
            <div class="warning-flood-tips">
              <span><i class="fa fa-window-minimize fa-rotate-90 fa-font-size" style="color: #FF0000;" aria-hidden="true"></i>特大洪水</span>
              <span><i class="fa fa-window-minimize fa-rotate-90 fa-font-size" style="color: #FF9900;" aria-hidden="true"></i>大洪水</span>
              <span><i class="fa fa-window-minimize fa-rotate-90 fa-font-size" style="color: #FFFF00;" aria-hidden="true"></i>中洪水</span>
              <span><i class="fa fa-window-minimize fa-rotate-90 fa-font-size" style="color: #3266FF;" aria-hidden="true"></i>小洪水</span>
            </div>
            <div id="洪水预警" class="warning-flood-data">
      <span class="very-danger-color" data-total="0">0</span>
      <span class="high-danger-color" data-total="0">0</span>
      <span class="danger-color" data-total="0">0</span>
      <span class="low-dange-color" data-total="0">0</span></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div id="calendar-zoom" title="展开日历">
  <img src="./防汛抗旱态势分析系统_files/缩放.png">
</div>

<div id="flood-back" class="flood-back-main" title="返回" onclick="onFloodAnalysisBack()" style="display: none;"></div>

    <!-- 气象态势 、洪水态势-->
    <style>
  .el-dialog{
    background-color: rgba(9,25,57,.99) !important;
  }
   .el-range-editor.el-input__inner{
    background-color: rgba(9,25,57,.99);
  }
   .el-date-editor .el-range-input{
    background-color: rgba(9,25,57,.99);
  }
  .el-cascader .el-input, .el-cascader .el-input__inner{
    background-color: rgba(9,25,57,.99);
  }
  .el-table th{
    background-color: rgba(9,25,57,.99) !important;
    color: #29ABE2;
  }
  .el-dialog__title{
    color: white;
  }
  .el-dialog__body{
    padding-bottom: 8px !important;
  }
  .el-dialog__header {
    border-bottom: 1px solid #29ABE2;
    padding: 20px 20px 10px;
    text-align: center;
  }
  .el-table th, .el-table tr{
    border-top: 1px solid white;
  }

  .el-table td{
    background-color: rgba(9,25,57,.99) !important;
    color: white;
  }
  .el-table__empty-block{
    background-color: rgba(9,25,57,.99) !important;
  }
  .el-form--inline .el-form-item__label{
    color: #00FFFF;
  }
  .el-dialog__title{
    color: #29ABE2 !important;
  }
  .el-radio__label{
    color: white;
  }
  .el-range-editor--small .el-range-separator{
    color: #29ABE2 !important;
  }

</style>
<div id="mainBox-header-header"><div class="mainBox-meteorological"><div class="mainBox-header-header">
      气象态势
    </div> <div id="mainBox-mete-content" class="mainBox-mete-content"><div class="mainBox-mete"><img src="./防汛抗旱态势分析系统_files/rain_checked.png"> <span>降水</span></div><div class="mainBox-mete"><img src="./防汛抗旱态势分析系统_files/weather.png"> <span>天气</span></div><div class="mainBox-mete"><img src="./防汛抗旱态势分析系统_files/cloud.png"> <span>云图</span></div><div class="mainBox-mete"><img src="./防汛抗旱态势分析系统_files/radar.png"> <span>雷达</span></div><div class="mainBox-mete"><img src="./防汛抗旱态势分析系统_files/juping.png"> <span>距平</span></div><div class="mainBox-mete"><img src="./防汛抗旱态势分析系统_files/taifeng.png"> <span>台风</span></div><div class="mainBox-mete"><img src="./防汛抗旱态势分析系统_files/temperature.png"> <span>温度</span></div></div></div> <div class="mainBox-flood"><div class="mainBox-header-header">
      水旱态势
    </div> <div class="mainBox-flood-content"><div class="mainBox-flood"><img src="./防汛抗旱态势分析系统_files/flood.png"> <span>洪水</span></div><div class="mainBox-flood"><img src="./防汛抗旱态势分析系统_files/river.png"> <span>河网</span></div><div class="mainBox-flood"><img src="./防汛抗旱态势分析系统_files/dispatch.png"> <span>调度</span></div><div class="mainBox-flood"><img src="./防汛抗旱态势分析系统_files/2d.png"> <span>实景</span></div><div class="mainBox-flood"><img src="./防汛抗旱态势分析系统_files/water.png"> <span>含水量 </span></div><div class="mainBox-flood"><img src="./防汛抗旱态势分析系统_files/drought.png"> <span>旱情</span></div><div class="mainBox-flood"><img src="./防汛抗旱态势分析系统_files/image.png"> <span>图像</span></div></div></div> <div class="myNewLog"><div class="el-dialog__wrapper" style="display: none;"><div role="dialog" aria-modal="true" aria-label="查询" class="el-dialog" style="margin-top: 15vh; width: 80%;"><div class="el-dialog__header"><span class="el-dialog__title">查询</span><button type="button" aria-label="Close" class="el-dialog__headerbtn"><i class="el-dialog__close el-icon el-icon-close"></i></button></div><!----><div class="el-dialog__footer"><div class="dialog-footer" style="text-align: center;"><button type="button" class="el-button el-button--default el-button--small"><!----><!----><span>取 消</span></button> <button type="button" class="el-button el-button--primary el-button--small"><!----><!----><span>确 定</span></button></div></div></div></div></div></div>
<script type="text/javascript">
  let NewMyNeed;
  $('#mySearchShu').click(function () {
    NewMyNeed.myadd();
  });
  let faid = 0;
  $(function () {
    NewMyNeed =  new Vue({
      el: "#mainBox-header-header",
      data: {
        cityCas:[],
        cityCasConfig:{
          label: 'adnm',
          value: 'adcd',
          children: 'subdata'
        },
        riverCas:[],
        riverCasConfig:{
          label: 'wsnm',
          value: 'wscd',
          children: 'subdata'
        },
        formInline:{
          myclass:1,
          sttype: 1,
          adcd: [],
          wscd: [],
          start:'',
          end:'',
          date:[]
        },
        pickerOptions0: {
          disabledDate(time) {
            return time.getTime() > Date.now() - 8.64e6;//如果没有后面的-8.64e6就是不可以选择今天的
          }
        },
        dialogVisible1:false,
        search:{
          total:10,
        },
        tableData1:[],
        tableData2:[],
        tableData3:[],
        rules:{},
        subject: {
          selected: null,
          list: [],
        }
      },
      mounted() {
        this.loadSubject();
        //获取专题
        this.getArea('');
        this.getRiver('');

        note.on("map.ready", () => this.$nextTick(this.loadSubject))
        // note.on("layer.play.frame", this.onFrame);
        // note.on("play.control.visible", (e, v) => this.playinfo.visible = v);
      },
      methods: {
        classChange(){
          this.myaddSubmit();
        },
        myreset(){
          this.$refs['formInline'].resetFields();
          this.myaddSubmit();
        },
        getRiver(number){
          // if(this.xunh==3) return;
          let body = {
            interface: "/com.ec.ws.service.def.base.AdcdCodeInfoService",
            method: "findWscdTreeByParentId",
            param :[number]
          }
          ajaxCallJson(body, "/rpc/findArea", (data) => {
            this.riverCas= data.data;
          });
        },
        getArea(number){
         // if(this.xunh==3) return;
          let body = {
            interface: "/com.ec.ws.service.def.base.AdcdCodeInfoService",
            method: "findAdcdTreeByParentId",
            param :[number]
          }
          ajaxCallJson(body, "/rpc/findArea", (data) => {
            this.cityCas= data.data;
          });
        },
        myadd(){
          //this.getArea('');
          this.myaddSubmit();
          this.dialogVisible1 = true;
        },
        myaddSubmit(){
          let data = this.formInline;
          let method = '';
          if(this.formInline.myclass==1){
            method = 'findRsvrByPage'
          } else if(this.formInline.myclass==2){
            method = 'findRiverByPage'
          } else if(this.formInline.myclass==3){
            method = 'findPptnByPage'
          }
          let body = {
            interface: "/com.ec.ws.service.def.monitoring.MonitorObjectService",
            method:method,
            param :[
                {
                  pageNow:1,
                  pageSize:20
                },
                {
                  sttype: data.sttype,
                  adcd: data.adcd[data.adcd.length - 1],
                  wscd: data.wscd[data.wscd.length - 1],
                  start:data.date[0],
                  end:data.date[1]
                },
              ]
            }
            ajaxCallJson(body, "/rpc/findRmyByPage", (data) => {
              this.search.total = data.data.total;
              if(this.formInline.myclass==1){
                this.tableData1 = data.data.rows;
              } else if(this.formInline.myclass==2){
                this.tableData2 = data.data.rows;
              } else if(this.formInline.myclass==3){
                this.tableData3 = data.data.rows;
              }
            });
        },
        loadSubject() {
          let body = {
            interface: "com.ec.ws.service.def.xyyj.LayerManagerV1Service",
            method: "getLayerTypeList",
            args: []
          };
          ajaxCallJson(body, "/rpc", ({
            data
          }) => {
            this.subject.list = data;
            // this.onSubjectSelect(data.find(e => e.checked), true);
            // setTimeout(function () {
            //   initMainTitle();
            // }, 1)
          });
        },
        onSubjectSelect(subject, checked) {
          if (!checked) {
            note.notify("map.clearlayer");
          }

          subject.checked = checked;
          if (this.subject.selected) {
            this.subject.selected.checked = false;
          }
          if (map.findLayerById('1112') != undefined) {
            map.findLayerById('1112').visible = false;
            map.findLayerById('1112').opacity = 0;
          }
          if (checked) {
            $("#footer-legend").show();
            $("#footer-legend").attr("src", subject.legend);
            this.icon = subject.icon.split(".")[0];
            if (this.subject.selected) {
              if (this.subject.selected.id != subject.id) {
                if (this.subject.selected.icon.split("_checked")[1] != undefined) {
                  this.subject.selected.icon = this.subject.selected.icon.split("_checked")[0] + ".png";
                }
                subject.icon = this.icon + "_checked.png";
              } else {
                this.subject.selected.checked = checked;
              }
            } else {
              subject.icon = this.icon + "_checked.png";
            }
          } else {
            $("#footer-legend").attr("src", "");
            if (subject.icon.split("_checked")[1] != undefined) {
              this.icon = subject.icon.split("_checked")[0];
            }
            if (this.subject.selected) {
              if (this.subject.selected.id == subject.id) {
                this.subject.selected.checked = checked;
              } else {
                this.subject.selected.icon = this.icon + ".png";
              }
            } else {
              subject.icon = this.icon + ".png";
            }
          }
          setTimeout(() => {
            note.notify("layer.terrainTo3D");
          }, 1000);
          note.notify("subject.change", this.subject.selected = subject);
        },
        onFrame(e, index, provider) {
          let info = provider.playinfo(index);
          this.playinfo.label = info.label;
          this.playinfo.time = info.time;
        }
      }
    })
  })
</script>


    <!-- 底部 -->
    <div class="mainBox-footer">
      <div id="footerLayer"><input id="main-monitor-object" type="radio" name="tabs" checked="checked"> <label for="main-monitor-object">监控对象</label> <input id="main-basic-layer" type="radio" name="tabs"> <label for="main-basic-layer">基础图层</label> <div class="footer-line"><div class="mainBox-tab-name"><div class="mainBox-tab-content mainBox-tab-type">类型</div> <div class="mainBox-tab-content mainBox-tab-alarm">告警</div> <div class="mainBox-tab-content mainBox-tab-early">风险</div> <div class="mainBox-tab-content mainBox-tab-detail">列表</div></div></div> <section id="mainBox-footer-content-monitor" class="mainBox-footer-content-b mainBox-footer-content-monitor" style="height: 277px;"><div class="mainBox-content"><div class="mainBox-content-name"><span class="mainBox-content-name-one">水库水电站</span></div> <div class="mainBox-content-box"><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="011clickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="大一型" id="01" lay-filter="subjectlayers" value="1"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>大一型</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="011" title="告警数"></span> <span id="101" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="012clickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="大二型" id="01" lay-filter="subjectlayers" value="2"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>大二型</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="012" title="告警数"></span> <span id="201" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="013clickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="中型" id="01" lay-filter="subjectlayers" value="3"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>中型</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="013" title="告警数"></span> <span id="301" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="014clickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="小型" id="01" lay-filter="subjectlayers" value="4"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>小型</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="014" title="告警数"></span> <span id="401" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div></div></div><div class="mainBox-content"><div class="mainBox-content-name"><span class="mainBox-content-name-two">河道水文站</span></div> <div class="mainBox-content-box"><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="151clickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="中央报汛站" id="15" lay-filter="subjectlayers" value="1"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>中央报汛站</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="151" title="告警数"></span> <span id="115" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="152clickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="省级报汛站" id="15" lay-filter="subjectlayers" value="2"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>省级报汛站</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="152" title="告警数"></span> <span id="215" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="153clickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="其他报汛站" id="15" lay-filter="subjectlayers" value="3"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>其他报汛站</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="153" title="告警数"></span> <span id="315" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div></div></div><div class="mainBox-content"><div class="mainBox-content-name"><span class="mainBox-content-name-three">雨量站</span></div> <div class="mainBox-content-box"><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="041clickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="防汛站点" id="04" lay-filter="subjectlayers" value="1"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>防汛站点</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="041" title="告警数"></span> <span id="104" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="042clickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="气象站点" id="04" lay-filter="subjectlayers" value="2"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>气象站点</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="042" title="告警数"></span> <span id="204" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div></div></div><div class="mainBox-content"><div class="mainBox-content-name"><span class="mainBox-content-name-four">其他站点</span></div> <div class="mainBox-content-box"><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="14nullclickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="沿河村落" id="14" lay-filter="subjectlayers" value=""><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>沿河村落</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="14null" title="告警数"></span> <span id="null14" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="16nullclickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="城市积水点" id="16" lay-filter="subjectlayers" value=""><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>城市积水点</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="16null" title="告警数"></span> <span id="null16" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="hpzhyhdnullclickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="滑坡隐患点" id="hpzhyhd" lay-filter="subjectlayers" value=""><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>滑坡隐患点</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="hpzhyhdnull" title="告警数"></span> <span id="nullhpzhyhd" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="30nullclickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="土壤墒情站" id="30" lay-filter="subjectlayers" value=""><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>土壤墒情站</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="30null" title="告警数"></span> <span id="null30" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div><div class="mainBox-content-box-item"><div class="mainBox-content-center"><form action="http://127.0.0.1:9527/" id="09nullclickbtn" class="layui-form"><input type="checkbox" name="like1[write]" lay-skin="blueBox" title="视频图像站" id="09" lay-filter="subjectlayers" value=""><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>视频图像站</span><i class="layui-icon layui-icon-ok"></i></div></form></div> <div class="mainBox-content-warning-num"><span id="09null" title="告警数"></span> <span id="null09" title="预警数"></span></div> <div class="mainBox-content-warning-table"><img src="./防汛抗旱态势分析系统_files/table.png"></div></div></div></div></section> <section id="mainBox-footer-content-basic" class="mainBox-footer-content-b mainBox-footer-content-basic"><div class="mainBox-footer-content-basic-box" style="height: 277px;"><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_2" lay-skin="blueBox" title="国界" lay-filter="basiclayers" value="layer_base_2"><div class="layui-unselect layui-form-checkbox layui-form-checked" lay-skin="blueBox"><span>国界</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_39" lay-skin="blueBox" title="流域界" lay-filter="basiclayers" value="layer_base_39"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>流域界</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_0" lay-skin="blueBox" title="行政区界" lay-filter="basiclayers" value="layer_base_0"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>行政区界</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_1" lay-skin="blueBox" title="河网水系" lay-filter="basiclayers" value="layer_base_1"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>河网水系</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_6" lay-skin="blueBox" title="行政驻地" lay-filter="basiclayers" value="layer_base_6"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>行政驻地</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_40" lay-skin="blueBox" title="蓄滞洪区" lay-filter="basiclayers" value="layer_base_40"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>蓄滞洪区</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_41" lay-skin="blueBox" title="地名标注" lay-filter="basiclayers" value="layer_base_41"><div class="layui-unselect layui-form-checkbox layui-form-checked" lay-skin="blueBox"><span>地名标注</span><i class="layui-icon layui-icon-ok"></i></div></form><!----><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_38" lay-skin="blueBox" title="交通道路" lay-filter="basiclayers" value="layer_base_38"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>交通道路</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_10" lay-skin="blueBox" title="抢险队伍" lay-filter="basiclayers" value="layer_base_10"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>抢险队伍</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_42" lay-skin="blueBox" title="居民地" lay-filter="basiclayers" value="layer_base_42"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>居民地</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_8" lay-skin="blueBox" title="防洪物资" lay-filter="basiclayers" value="layer_base_8"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>防洪物资</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_43" lay-skin="blueBox" title="库湖水面" lay-filter="basiclayers" value="layer_base_43"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>库湖水面</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_9" lay-skin="blueBox" title="抗旱物资" lay-filter="basiclayers" value="layer_base_9"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>抗旱物资</span><i class="layui-icon layui-icon-ok"></i></div></form><form action="http://127.0.0.1:9527/" class="layui-form"><input type="checkbox" name="layer_base_11" lay-skin="blueBox" title="企事业单位" lay-filter="basiclayers" value="layer_base_11"><div class="layui-unselect layui-form-checkbox" lay-skin="blueBox"><span>企事业单位</span><i class="layui-icon layui-icon-ok"></i></div></form></div></section></div>


<div id="boxLatLon" class="boxLatLon" style="position: fixed;left: 50%;bottom: 0;">经纬度：<span id="boxLatLon-info">110.302158,30.224075</span>
</div>

<script type="text/javascript">
    var isCheckedType=false;
    $(function () {
        // var basicLayers = [];
        new Vue({
            el: "#footerLayer",
            data: {
                calendar: Date.now(),
                warnings: [], //预警
                alarm: null, //告警
                noShowBaseMap: ["layer_base_elev", "layer_base_41"],
                basic: {
                    name: "基础图层",
                    visible: false,
                    layers: [],
                    inner: [],
                    sttypes: [],
                    subjectLayer: [],
                    colorClass: ["mainBox-content-name-one", "mainBox-content-name-two",
                        "mainBox-content-name-three", "mainBox-content-name-four"
                    ]
                },
                subject: {
                    name: "专题图层",
                    visible: false,
                    layers: []
                },
            },
            mounted() {
                this.onSubjectLayerLoaded()
                // note.on("view.ready", () => {
                // });
            },
            methods:
            {
                getTest(number){
                    // if(this.xunh==3) return;
                    let body = {
                        interface: "/com.ec.ws.service.def.analyse.AnalyseService",
                        method: "findRainAffect",
                        param :[3]
                    }
                    ajaxCallJson(body, "/rpc/findArea", (data) => {
                        console.log(3333);
                        console.log(data);
                        //this.cityCas= data.data;
                    });
                },
                onTableSelect(ele, stype) {
                    var id = "#" + stype.code + stype.sttype + "clickbtn" + " i";
                    var divId = "#" + stype.code + stype.sttype + "clickbtn" + " div";
                    if ($(divId).hasClass("layui-form-checked") === false) {
                        $(id).trigger('click');
                    }
                    note.notify("subject.data.load", subject = {
                        code: stype.code,
                        label: stype.name + ele.label,
                        sttype: stype.sttype
                    });
                },
                getCountColor(value) {
                    var levelname = "", color = "#fff";
                    if (value == 1) {
                        levelname = '低危';
                        color = "#3266FF";
                    } else if (value == 4) {
                        levelname = '危险';
                        color = "#FF0";
                    } else if (value == 6) {
                        levelname = '高危';
                        color = "#F90";
                    } else if (value == 10) {
                        levelname = '极危';
                        color = "red";
                    } else if (value == 0) {
                        levelname = '无预警';
                        color = "#fff";
                    }
                    return { levelname: levelname, color: color }
                },
                onWarningSelect(ele, stype, type) {
                    let html = $(
                        `#${type == 1 ? stype.code + stype.sttype : stype.sttype + stype.code}`
                    ).html();
                    // html = type == 1 ? html.slice(0, html.length - 1) : html;
                    if(isCheckedType===false){
                      return
                    }
                    if (html <= 0) return
                    note.notify("subject.data.Immediate", subject = {
                        code: stype.code,
                        label: stype.name + ele.label,
                        sttype: stype.sttype,
                        type,
                    });
                },
                loadAlarm(time) { //告警
                    if (time == "000") {
                        this.subject.visible = false;
                    } else {
                        this.calendar = time;
                        let body = {
                            interface: "com.ec.ws.service.def.rwdb.RealCountService",
                            method: "countRealData",
                            args: [user.userId,
                            moment(time).format("YYYY-MM-DD 00:00:00"),
                            moment(time + 24 * 3600 * 1000).format("YYYY-MM-DD 00:00:00"),
                            ]
                        };
                        ajaxCallJson(body, "/rpc", ({
                            data
                        }) => {
                            this.alarm = Object.values(data);
                            var arr = [], levelArr = [];
                            this.alarm.forEach(function (ele, i) {
                                arr.push(Object.values(ele.sttypeMap));
                                levelArr.push(Object.values(ele.levelMap))
                            })
                            this.alarm = arr;
                            let labelData=this.basic.subjectLayer[0].label ;
                            this.basic.subjectLayer[0].sttypes.forEach(function (ele, i) {
                                var id = "#" + ele.code + ele.sttype;
                                $(id).empty();
                                if (arr[2][i] != 0) {
                                    // $(id).append("告警:" + arr[2][i] + '<span class="dataCut" style="color:#30baff">&nbsp&nbsp</span>');
                                    // $(id).append(arr[2][i]);
                                  var html='<input type="checkbox" style="display: block" code="'+ele.code+'" onclick="checkWaringLoadData(this,'+ele.sttype+','+ele.code+',1)"><span code="'+ele.code+'" name="'+ele.name+'" label="'+labelData+'" onclick="onWarningSelect(this,'+ele.sttype+',1)"> '+arr[2][i]+'</span>';
                                  $(id).append(html);
                                    var color = getAlarmColor(levelArr[2][i]);
                                    $(id).css({ "color": color });
                                }
                            })
                            let labelDataOne=this.basic.subjectLayer[1].label ;
                            this.basic.subjectLayer[1].sttypes.forEach(function (ele, i) {
                                var id = "#" + ele.code + ele.sttype;
                                $(id).empty();
                                if (arr[0][i] != 0) {
                                    // $(id).append("告警:" + arr[0][i] + '<span class="dataCut" style="color:#30baff">&nbsp&nbsp</span>');
                                    // $(id).append(arr[0][i]);
                                  var html='<input type="checkbox" style="display: block" code="'+ele.code+'" onclick="checkWaringLoadData(this,'+ele.sttype+','+ele.code+',1)"><span code="'+ele.code+'" name="'+ele.name+'" label="'+labelDataOne+'" onclick="onWarningSelect(this,'+ele.sttype+',1)"> '+arr[0][i]+'</span>';
                                  $(id).append(html);
                                    var color = getAlarmColor(levelArr[0][i]);
                                    var hoverStr = id + ":hover";
                                    $(id).css({ "color": color });
                                }
                            })
                            let labelDataTwo=this.basic.subjectLayer[2].label ;
                            this.basic.subjectLayer[2].sttypes.forEach(function (ele, i) {
                                var id = "#" + ele.code + ele.sttype;
                                $(id).empty();
                                if (arr[1][i] != 0) {
                                    // $(id).append("告警:" + arr[1][i] + '<span class="dataCut" style="color:#30baff">&nbsp&nbsp</span>');
                                    // $(id).append(arr[1][i]);
                                  var html='<input type="checkbox" style="display: block" code="'+ele.code+'" onclick="checkWaringLoadData(this,'+ele.sttype+','+ele.code+',1)"><span code="'+ele.code+'" name="'+ele.name+'" label="'+labelDataTwo+'" onclick="onWarningSelect(this,'+ele.sttype+',1)"> '+arr[1][i]+'</span>';
                                  $(id).append(html);
                                    var color = getAlarmColor(levelArr[1][i]);
                                    var hoverStr = id + ":hover";
                                    $(id).css({ "color": color });
                                }
                            })
                        });
                    }
                },
                loadWarnings(time) { //预警
                    if (time == "000") {
                        this.subject.visible = false;
                    } else {
                        this.calendar = time;
                        let body = {
                            interface: "com.ec.ws.service.def.rwdb.RealCountService",
                            method: "countTopWarning",
                            args: [user.userId,
                            moment(time).format("YYYY-MM-DD 00:00:00"),
                            moment(time + 24 * 3600 * 1000).format("YYYY-MM-DD 00:00:00"),
                            ]
                        };
                        ajaxCallJson(body, "/rpc", ({
                            data
                        }) => {
                            this.warnings = Object.values(data);
                            var arr = [], levelArr = [];
                            for (var i = 0; i < this.warnings.length; i++) {
                                var index = this.warnings[i];
                                if (index.sttypeMap) {
                                    arr.push(Object.values(index.sttypeMap));
                                    levelArr.push(Object.values(index.levelMap));
                                }
                            }
                            this.warnings = arr;
                            if (this.warnings.length < 3) {
                                for (var i = 0; i < this.warnings.length; i++) {
                                    var index = this.warnings[i];
                                    if (index.length == 3) continue;
                                    if (index.length == 4) {
                                        var temp = [0, 0];
                                        this.warnings.push(temp);
                                        levelArr.push(temp);
                                    };
                                }
                            }
                            for (var i = 0; i < this.warnings.length; i++) {
                                var index = this.warnings[i];
                                var levelIndex = levelArr[i];
                                if (index.length == 3) {
                                    for (var j = 0; j < this.basic.subjectLayer[1].sttypes
                                        .length; j++) {
                                        var index2 = this.basic.subjectLayer[1].sttypes[j];
                                        var id = "#" + index2.sttype + index2.code;
                                        let labelData=this.basic.subjectLayer[1].label ;
                                        $(id).empty();
                                        if (index[j] != 0) {
                                            // $(id).append("预警:" + index[j]);
                                          var html='<input type="checkbox" style="display: block" code="'+index2.code+'" onclick="checkWaringLoadData(this,'+index2.sttype+','+index2.code+',2)"><span code="'+index2.code+'" name="'+index2.name+'" label="'+labelData+'" onclick="onWarningSelect( this,'+index2.sttype+',2)"> '+index[j]+'</span>';
                                          $(id).append(html);
                                          $(id).css({ "color": this.getCountColor(levelIndex[j]).color });
                                        } else {
                                            $(id).empty();
                                            // $(id).hide();
                                        }
                                    }
                                } else if (index.length == 4) {
                                    for (var j = 0; j < this.basic.subjectLayer[0].sttypes
                                        .length; j++) {
                                        var index2 = this.basic.subjectLayer[0].sttypes[j];
                                        var id = "#" + index2.sttype + index2.code;
                                        let labelData=this.basic.subjectLayer[1].label ;
                                        $(id).empty();
                                        if (index[j] != 0) {
                                            // $(id).append("预警:" + index[j]);
                                          var html='<input type="checkbox" style="display: block" code="'+index2.code+'" onclick="checkWaringLoadData(this,'+index2.sttype+','+index2.code+',2)"><span code="'+index2.code+'" name="'+index2.name+'" label="'+labelData+'" onclick="onWarningSelect( this,'+index2.sttype+',2)"> '+index[j]+'</span>';
                                          $(id).append(html);
                                          $(id).css({ "color": this.getCountColor(levelIndex[j]).color });
                                        } else {
                                            $(id).empty();
                                            // $(id).hide();
                                        }
                                    }
                                } else if (index.length == 2) {
                                    for (var j = 0; j < this.basic.subjectLayer[2].sttypes
                                        .length; j++) {
                                        var index2 = this.basic.subjectLayer[2].sttypes[j];
                                        var id = "#" + index2.sttype + index2.code;
                                        let labelData=this.basic.subjectLayer[1].label ;
                                        $(id).empty();
                                        if (index[j] != 0) {
                                            // $(id).append("预警:" + index[j]);
                                          var html='<input type="checkbox" style="display: block" code="'+index2.code+'" onclick="checkWaringLoadData(this,'+index2.sttype+','+index2.code+',2)"><span code="'+index2.code+'" name="'+index2.name+'" label="'+labelData+'" onclick="onWarningSelect( this,'+index2.sttype+',2)"> '+index[j]+'</span>';
                                          $(id).append(html);
                                          $(id).css({ "color": this.getCountColor(levelIndex[j]).color });
                                        } else {
                                            $(id).empty();
                                            // $(id).hide();
                                        }
                                    }
                                }
                            }
                        });
                    }
                },
                onSubjectLayerLoaded() {
                    let body = {
                        interface: "com.ec.ws.service.def.xyyj.LayerManagerV1Service",
                        method: "getBaseLayerVoList",
                        args: [isLan]
                    };
                    note.on("map.ready", (event, checked, station) => {
                        ajaxCallJson(body, "/rpc", ({
                            data
                        }) => {
                            this.basic.layers = data.baselayer || [];
                            basicLayers = data.baselayer || [];
                            note.notify("layer.terrainTo3D");
                            setTimeout(() => {
                                this.basic.layers.forEach(e => e.checked && this.onLayerChecked(e,
                                    true));
                            }, 1500);
                            this.basic.subjectLayer = data.stations;
                            note.notify("subjectLayerLoaded");
                            // this.subject.layers.forEach(e => {
                            //     if (e.checked) {
                            //         note.notify("layer.remove", e.id);
                            //         note.notify("subject.station.checked", false, e);
                            //     }
                            // });
                            // data.stations.forEach(e => {
                            //     if (e.checked) {
                            //         note.notify("layer.add", e);
                            //         note.notify("subject.station.checked", true, e);
                            //     }
                            //     e.warningCount = e.warningCount || 0;
                            // });
                            this.subject.layers = data.stations;
                            this.loadAlarm(this.calendar);
                            setTimeout(() => {
                                this.loadWarnings(this.calendar);
                            }, 500);
                        });
                    })
                },
                onLayerChecked(layer, checked, outer) {
                    layer.checked = checked;
                    checked ? note.notify("layer.add", layer) : note.notify("layer.remove", layer.id);
                    if (!outer) {
                        this.basic.inner.switch(layer.id, checked);
                    }
                },
            }
        })

        note.on("subjectLayerLoaded", () => {
            //基础图层监听
            layui.use('form', function () {
                var form = layui.form;
                form.on('checkbox(basiclayers)', function (data) {
                    var checked = data.elem.checked; //是否被选中
                    var value = data.value; //复选框value值
                    var currentLayer = {};
                    basicLayers.forEach((ele, index) => {
                        if (ele.id == value) currentLayer = basicLayers[index];
                    })
                    checked ? note.notify("layer.add", currentLayer) : note.notify(
                        "layer.remove", currentLayer.id);
                });
            })
            //监控对象监听
            layui.use('form', function () {
                var form = layui.form;
                form.on('checkbox(subjectlayers)', function (data) {
                    var checked = data.elem.checked; //是否被选中
                    var value = data.value; //站点子类型
                    var code = data.elem.id; //站点类型
                    var stationObj = {
                        code: code,
                        value: value
                    }
                    geographicCheck = false;
                    // station.checked = !station.checked;
                    if (isRainfallFunc) {
                        note.notify("subject.station.rainfall.checked", checked, stationObj);
                    } else {
                        note.notify("subject.station.checked", checked, stationObj);
                    }

                });
            })
            //洪水预警点监听
            layui.use('form', function () {
                var form = layui.form;
                watershedFormCheckbox = form;
                form.on('checkbox(watershedlayers)', function (data) {
                    var checked = data.elem.checked; //是否被选中
                    var value = data.value; //站点子类型
                    var code = data.elem.id; //站点类型
                    var stationObj = {
                        motype: code,
                        sttype: value || ''
                    }
                    console.log("洪水预警")
                    isWatershedOpen = checked;//是否点击了洪水预警
                    addMapNewPoint(checked, stationObj);
                });
            })
            setTimeout(() => {
                note.notify("watershed.ready");
            }, 1000);
        });

    })
    async function checkWaringLoadData(dom,sttype,code,warningType) {
      var checked=$(dom).is(":checked");
      isCheckedType=checked;
      let codeData=$(dom).attr("code");
      let name;
      if (warningType == 1) {
        name = "riskHydrologicalAlarm"+sttype+code+warningType;
      } else if (warningType == 2) {
        name = "riskHydrologicalWarning"+sttype+code+warningType;
      }
      if(checked===true){
        var obj = {
          code: codeData,
          label: "",
          sttype: sttype,
          type: warningType,
          warningType: warningType
        };
        let mapInfo = await getRiskMapWarningPoint(obj);
        if (mapInfo.flag) {
          let mapdata = mapInfo.mapInfo.rows;
          let obj = {
            mapdata: mapdata,
            name: name
          };
          addRiskPointToMap(obj);
        }
      }else{
        clearRiskMapPoint(name);
        propertiesWin.hide();
      }
    }
    function getRiskMapWarningPoint(subject) {
      pageNow = 1;
      pageSize = 100;
      adcdUser = '';
      tableAdcd = '';
      drnaType = -1;
      motype = subject.code;
      tableName = subject.label;
      sttype = subject.sttype;
      warningType = subject.type;
      listChecked = '';
      const params = {
        type: adcdUser,
        areacode: tableAdcd,
        wlevel: drnaType,
        motype,
        sttype,
        startTime: `${today} 00:00:00`,
        endTime: `${today} 24:00:00`,
        pageNow,
        pageSize,
      };
      let data, flag = false;
      if (subject.warningType == 1) {
        return new Promise(function (resolve, reject) {
          ajaxCallJson(params, '/warning/getRealRecordList', function (res) {
            if (!res.info) {
              showTip(1)
              return;
            }
            // $('#base-properties-table').bootstrapTable('destroy');
            if (res.flag) {
              flag = true;
              data = res.info;
              adcdUser = res.type;
              resolve(res);
            } else {
              propertiesWin.hide();
              showTip(1)
              reject('获取告警信息失败！');
            }
          })
        }).catch(e => console.log(e));
      } else if (subject.warningType == 2) {
        return new Promise(function (resolve, reject) {
          ajaxCallJson(params, '/warning/findTopwarningList', function (res) {
            if (!res.info) {
              showTip(1)
              return;
            }
            // $('#base-properties-table').bootstrapTable('destroy');
            if (res.flag) {
              flag = true;
              data = res.info;
              adcdUser = res.type;
              resolve(res);
            } else {
              propertiesWin.hide();
              showTip(1)
              reject('获取预警信息失败！');
            }
          })
        }).catch(e => console.log(e));
      }
    };
    function addRiskPointToMap(data) {
      if (data) {
        var mapPointArr = [];
        var classBreakInfos = [];
        var uniqueValuesInfos = [];
        var url;
        for (let i = 0; i < data.mapdata.length; i++) {
          var index = data.mapdata[i];
          var wlevel = "";
          wlevel = index.wlevel;
          var mapPointObj = {
            monm: index.monm, //名称
            addr: index.addr, //地址
            adnm: index.adnm, //所属区县
            wlevel: index.wlevel || 0, //预警级别
            lgtd: index.lgtd, //经度
            lttd: index.lttd, //纬度
            motype: index.motype, //所属类型编号
            mocd: index.mocd, //mocd
            adcd: index.adcd,
            oecd: index.oecd,
            stcd: index.stcd,
            topoid: index.eacId || '',
            exparams: index.exparams,
            wscd: index.wscd || "",
            typeId: index.mocd
          };
          mapPointArr.push(mapPointObj);
          url = getmapPointUrl(index);
          var width = "25px";
          var height = "25px";
          if (index.motype == "04" || index.motype == "05") {
            width = "15px";
            height = "15px";
          }
          var classBreakInfosObj = {
            minValue: wlevel || 0,
            maxValue: wlevel || 0,
            symbol: {
              type: "picture-marker",
              url: url,
              width: width,
              height: height
            }
          }
          classBreakInfos.push(classBreakInfosObj);
        }
        var obj = {
          mapPointArr: mapPointArr,
          classBreakInfos: classBreakInfos,
          name: data.name
        };
        makePointObject(obj);
      }
    }
    function getmapPointUrl(index) {
      var fileurl = "/images/mapIcon/";
      var url = '';
      if (index.motype == "04" || index.motype == "05") {
        if (index.wlevel == null || index.wlevel == 0) {
          url = fileurl + index.motype + '/' + 0 + '.png';
        } else {
          url = fileurl + index.motype + '/' + index.wlevel + '.png';
        }
      } else {
        if (index.wlevel == null || index.wlevel == 0) {
          url = fileurl + index.motype + '/' + 5 + '.png';
        } else {
          if (index.wlevel == 6) {

          }
          url = fileurl + index.motype + '/' + index.wlevel + '.png';
        }
      }
      return url;
    }

    function makePointObject(dataObj) {
      require([
        "myMap/layer/PointLayer", //引用加载地图点模块
      ], function (PointLayer) {
        var pointLayerObj;
        pointLayerObj = new PointLayer(dataObj.mapPointArr, dataObj.classBreakInfos, dataObj.name);
        addToMapPoint(pointLayerObj);
      })
    }
    function clearRiskMapPoint(clearName) {
      if (clearName) {
        if (map.findLayerById(clearName)) {
          map.remove(map.findLayerById(clearName));
        }
      }
    }
    function onWarningSelect(dom,sttype,warningType) {
      let codeData=$(dom).attr("code");
      let nameData=$(dom).attr("name");
      let labelData=$(dom).attr("label");
      let html = $(
        `#${warningType == 1 ? codeData + sttype : sttype + codeData}`
      ).html();
      if (html <= 0) return
      note.notify("subject.data.Immediate", subject = {
        code: codeData,
        label: nameData+labelData ,
        sttype: sttype,
        type:warningType,
      });
    }
</script>

    </div>

    <div class="mainBox-footer-bottom">
      <div class="mainbox-footer-search">
        <div id="mainbox-footer-search"><div class="search-box h-box-vc"><div aria-haspopup="listbox" role="combobox" aria-owns="el-autocomplete-7166" class="el-autocomplete search full"><div class="el-input el-input--suffix"><!----><input type="text" autocomplete="off" valuekey="archive.name" popperclass="search-list" placeholder="请输入关键字..." fetchsuggestions="function () { [native code] }" debounce="300" placement="top" popperappendtobody="true" class="el-input__inner" role="textbox" aria-autocomplete="list" aria-controls="id" aria-activedescendant="el-autocomplete-7166-item--1"><!----><!----><!----></div><div role="region" class="el-autocomplete-suggestion el-popper search-list" style="display: none;"><div class="el-scrollbar"><div class="el-autocomplete-suggestion__wrap el-scrollbar__wrap" style="margin-bottom: -8px; margin-right: -8px;"><ul class="el-scrollbar__view el-autocomplete-suggestion__list" role="listbox" id="el-autocomplete-7166"></ul></div><div class="el-scrollbar__bar is-horizontal"><div class="el-scrollbar__thumb" style="transform: translateX(0%);"></div></div><div class="el-scrollbar__bar is-vertical"><div class="el-scrollbar__thumb" style="transform: translateY(0%);"></div></div></div></div></div></div></div>
<script type="text/javascript">
  $(function () {
    function addSearchPointToMap(data) {
      if (data) {
        var mapPointArr = [];
        var classBreakInfos = [];
        var uniqueValuesInfos = [];
        var url;
        for (let i = 0; i < data.mapdata.length; i++) {
          var index = data.mapdata[i];
          var wlevel = "";
          wlevel = index.wlevel;
          var mapPointObj = {
            monm: index.monm, //名称
            addr: index.addr, //地址
            adnm: index.adnm, //所属区县
            wlevel: index.wlevel || 0, //预警级别
            lgtd: index.lgtd, //经度
            lttd: index.lttd, //纬度
            motype: index.motype, //所属类型编号
            mocd: index.mocd, //mocd
            adcd: index.adcd,
            oecd: index.oecd,
            stcd: index.stcd,
            topoid: index.eacId || '',
            exparams: index.exparams,
            wscd: index.wscd || "",
            typeId: index.mocd
          };
          mapPointArr.push(mapPointObj);
          url = getSearchMapPointUrl(index);
          var width = "25px";
          var height = "25px";
          if (index.motype == "04" || index.motype == "05") {
            width = "15px";
            height = "15px";
          }
          var classBreakInfosObj = {
            minValue: wlevel || 0,
            maxValue: wlevel || 0,
            symbol: {
              type: "picture-marker",
              url: url,
              width: width,
              height: height
            }
          }
          classBreakInfos.push(classBreakInfosObj);
        }
        var obj = {
          mapPointArr: mapPointArr,
          classBreakInfos: classBreakInfos,
          name: data.name
        };
        makeSearchPointObject(obj);
      }
    }

    function makeSearchPointObject(dataObj) {
      require([
        "myMap/layer/PointLayer", //引用加载地图点模块
      ], function (PointLayer) {
        var pointLayerObj;
        pointLayerObj = new PointLayer(dataObj.mapPointArr, dataObj.classBreakInfos, dataObj.name);
        clearSearchMapPoint(dataObj.name);
        $("#search-close").css({ "visibility": "visible" });
        addToMapPoint(pointLayerObj);
      })
    }

    function getSearchMapPointUrl(index) {
      var fileurl = "/images/mapIcon/";
      var url = '';
      if (index.motype == "04" || index.motype == "05") {
        if (index.wlevel == null || index.wlevel == 0) {
          url = fileurl + index.motype + '/' + 0 + '.png';
        } else {
          url = fileurl + index.motype + '/' + index.wlevel + '.png';
        }
      } else {
        if (index.wlevel == null || index.wlevel == 0) {
          url = fileurl + index.motype + '/' + 5 + '.png';
        } else {
          if (index.wlevel == 6) {

          }
          url = fileurl + index.motype + '/' + index.wlevel + '.png';
        }
      }
      return url;
    };

    function clearSearchMapPoint(clearName) {
      if (clearName) {
        if (map.findLayerById(clearName)) {
          map.remove(map.findLayerById(clearName));
        }
      }
    }

    var isSearchCloseClick = false;
    $("body").on('click', "#search-close", function () {
      clearSearchMapPoint("searchPoint");
      setTimeout(() => {
        $(this).css({ "visibility": "hidden" });
      }, 1000);
    })

    const DOC_TYPE = {
      default: {
        heading: 0,
        tilt: 0
      },
      Area: {
        label: "行政区域",
        height: 20000,
      },
      Rsvr: {
        label: "水库",
        height: 10000,
      },
      River: {
        label: "河流",
        height: 20000,
      },
    };
    new Vue({
      el: "#mainbox-footer-search",
      data: {
        search: {
          placeholder: "请输入关键字...",
          selected: null,
          show: false,
          items: []
        },
      },
      mounted() {

      },
      methods: {
        onSearch(keyword, fetch) {
          if (!keyword) return;
          const body = {
            interface: "com.eastcentury.enode.service.SearchService",
            method: "doSearch",
            args: [userPrivilege || "", keyword || ""],
          };
          ajaxCallJson(body, "/rpc", (data) => fetch(data.data), () => fetch([]));
        },
        getSearchInfoToMap(motype,code) {
          const body = {
            interface: "com.ec.ws.service.def.monitoring.MonitorObjectService",
            method: "findMonitorObjectByStcd",
            args: [isLan,motype,code, moment(SYSTEM_TIME).format("YYYY-MM-DD HH:mm:ss")],
          };
          ajaxCallJson(body, "/rpc", (data) => {
            if (data.resflag) {
              addSearchPointToMap({ "mapdata": [data.data], "name": "searchPoint" });
            }
          });
        },
        getSearchInfoToMapOther(info) {
          require([
            "myMap/layer/PointLayer", //引用加载地图点模块
            "myMap/layer/EmptyPointLayer", //引用加载地图点模块
          ], function (PointLayer, EmptyPointLayer) {

            var classBreakInfos = {
              maxValue: 0,
              minValue: 0,
              symbol: {
                height: "25px",
                type: "picture-marker",
                url: "/images/main/spacetool/mapMarker.png",
                width: "25px",
              }
            }
            var txt = info.name;
            if (info.wkt == "-") return;
            var wkt = info.wkt.replace("POINT(", "").replace(")", "").split(" ");
            var mapPointArr = [{
              adcd: "",
              addr: "",
              adnm: "",
              exparams: {
                createtime: "",
                detail: [],
                mocd: "",
                monm: "",
              },
              lgtd: wkt[0],
              lttd: wkt[1],
              mocd: "",
              monm: txt,
              motype: "",
              oecd: "",
              stcd: "",
              topoid: "123",
              typeId: "",
              wlevel: 0,
              wscd: "",
            }]

            var pointLayerObj = new PointLayer(mapPointArr, classBreakInfos, "searchPoint");
            clearSearchMapPoint("searchPoint");
            $("#search-close").css({ "visibility": "visible" });
            map.add(pointLayerObj.pointLayer);
          })
        },
        onSearchSelected(item) {
          let wkt = item.archive.wkt;
          if (wkt == "-") return;
          let motype;
          if(item.archive.docType==="Rsvr"){
            motype="01";
          }
          if(item.archive.docType==="River"){
            motype="15";
          }
          if (wkt) {
            if (item.archive.docType != 'Area') {
              this.getSearchInfoToMap(motype,item.archive.code);
            } else {
              this.getSearchInfoToMapOther(item.archive);
            }
            let doc = DOC_TYPE[item.archive.docType];
            let point = WKTUtil.read(wkt).map(e => parseFloat(e));
            let target = Object.assign({
              position: {
                x: point[0],
                y: point[1],
                z: doc.height
              }
            }, doc.camera || DOC_TYPE.default);
            if (dimension === "3D") {
              view.goTo(target, { duration: 2000, easing: "linear" });
            } else {
              require([
                "esri/geometry/Point",
                "esri/Camera",
                "esri/widgets/Home",
                "esri/Viewpoint"
              ], function (Point, Camera, Home, Viewpoint) {
                var pt = new Point({
                  latitude: point[1],
                  longitude: point[0]
                });
                var opts = {
                  duration: 1000  // Duration of animation will be 5 seconds
                };
                view.goTo({
                  target: pt,
                  zoom: 15
                }, opts);
              })
            }
          }
        }
      },
      filters: {
        docType(type) {
          let doc = DOC_TYPE[type];
          return doc && doc.label;
        }
      }
    })
  })
</script>
        <div class="mainbox-search-icon">
          <img src="./防汛抗旱态势分析系统_files/search-icon.png">
        </div>
        <div id="quick-inquiry-zoom" class="mainbox-collect">
          <img src="./防汛抗旱态势分析系统_files/collect.png" width="23px" height="23px">
        </div>
        <div id="quick-inquiry-div">
    <div class="quick-tittle-div">
        <span>典型场景</span>
        <!-- <img src='images/quickInquiry/收缩.png'> -->
        <i class="fa fa-times" aria-hidden="true" id="close-quick-inquiry"></i>
    </div>
    <div class="title-lines"> </div>
    <div class="quick-content-div" style="z-index: -999">
        <div id="quick-inquiry"><span name="江西湖口">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>江西湖口</span><span name="江西九江">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>江西九江</span><span name="湖北汉口">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>湖北汉口</span><span name="湖北宜昌">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>湖北宜昌</span><span name="重庆武隆">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>重庆武隆</span><span name="重庆寸滩">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>重庆寸滩</span><span name="湖南衡阳">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>湖南衡阳</span><span name="湖南衡山">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>湖南衡山</span><span name="湖南株洲">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>湖南株洲</span><span name="湖南湘潭">
    <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>湖南湘潭</span>
            <span name="山竹台风洪水预警">
                <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>&nbsp;&nbsp;‘山竹’&nbsp;&nbsp;台风洪水预警
            </span>
            <span name="阳江9.17洪灾">
                <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>广东阳江9.17洪水预警</span>
            <span name="98历史洪水演进">
                <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>1998历史洪水演进</span>
            <span name="松柏山水库">
                <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>贵阳市松柏山水库水情</span>
            <span name="甲秀楼断面">
                <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>贵阳市甲秀楼河道水情</span>
            <span name="贵阳优化调度">
                <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>贵阳市&nbsp;&nbsp;'三库'&nbsp;&nbsp;优化调度</span>
            <span name="贵阳城市三维">
                <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>贵阳市三维洪水淹没</span>
            <!--<span name="羊午水库三维">-->
                <!--<i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>贵阳市羊午水库三维</span>-->
            <span name="概化调度">
                <i class="fa fa-window-minimize fa-rotate-90 fa-font-size" aria-hidden="true"></i>贵州省重点流域概化调度</span>
        </div>
    </div>
</div>
<!-- <div id='quick-inquiry-zoom' title="展开典型场景">
    <img src='images/quickInquiry/缩放.png'>
</div> -->
      </div>
      <div class="mainbox-footer-legend">
        <div class="warning-number" id="init-load-waring-number" title="国家预警信息发布中心">
          <img id="warn-number" style="width: 30px" src="./防汛抗旱态势分析系统_files/warn.png">
          <i style="display: inline; width: 25px; height: 20px; text-align: center;">4</i>
        </div>
        <div id="mainbox-footer-legend-left" class="mainbox-footer-legend-left">
          <span>图例</span>
          <i class="fa fa-angle-left" aria-hidden="true"></i>
        </div>
        <img id="footer-legend" width="240px" src="./防汛抗旱态势分析系统_files/day.png" style="width: 240px;">
      </div>
    </div>

  </div>
</div>

  <div class="module generalized-scheduling">
    <!---->
    <script type="text/x-template" id="template">
        <div class="schedule">
            <div class="chart fill" ref="chart"></div>
            <div class="labels" :style="{left:grid.left+'px',top:grid.top+'px'}" v-if="chart">
                <div v-for="e in points" class="info-box light-border-container"
                     :style="{left:e.offset.x,top:e.offset.y,height:HEIGHTS[e.node.nodeType]+'px'}">
                    <div class="info v-box around">
                        <li><label class="title">{{e.node.nodeName}}</label></li>
                        <template v-if="e.node.nodeType===1">
                            <li>
                                <label class="name">入库流量：</label>
                                <label class="value">{{e.node.q != null ? e.node.q : '--'}}<i>(m³/s)</i></label>
                            </li>
                            <li>
                                <label class="name">当前水位：</label>
                                <label class="value">{{e.node.z || '--'}}<i>(m)</i></label>
                            </li>
                            <li>
                                <label class="name">下泄流量：</label>
                                <input class="value" v-model.number="e.node.q2" @keyup.enter="onSchedule"/>
                                <i>(m³/s)</i>
                            </li>
                            <li>
                                <label class="name">最大下泄流量：</label>
                                <label class="value">{{e.node.maxQ != null ? e.node.maxQ : '--'}}<i>(m³/s)</i></label>
                            </li>
                        </template>
                        <template v-else-if="e.node.nodeType===2">
                            <li>
                                <label class="name">警戒流量：</label>
                                <label class="value">{{e.node.warnQ != null ? e.node.warnQ : '--'}}<i>(m³/s)</i></label>
                            </li>
                            <li>
                                <label class="name">保证流量：</label>
                                <label class="value">{{e.node.maxQ != null ? e.node.maxQ : '--'}}<i>(m³/s)</i></label>
                            </li>
                            <li>
                                <label class="name">计算流量：</label>
                                <label class="value">{{e.node.q != null ? e.node.q : '--'}}<i>(m³/s)</i></label>
                            </li>
                        </template>
                        <template v-else-if="e.node.nodeType===3">
                            <li>
                                <label class="name">汇 流 量：</label>
                                <label class="value">{{e.node.q != null ? e.node.q : '--'}}<i>(m³/s)</i></label>
                            </li>
                            <li>
                                <label class="name">24小时降雨量：</label>
                                <input class="value" v-model.number="e.node.r" @keyup.enter="onSchedule"/>
                                <i>(mm)</i>
                            </li>
                        </template>
                        <span class="line"
                              :style="{width:e.label.width,top:e.label.top,left:e.label.left,transform:e.label.rotate}"></span>
                    </div>
                </div>
            </div>
        </div>
    </script>
    <script type="text/javascript">
      $(function () {
        const schedules = {
          // AFE160012A000000: {
          //   id: "AFE160012A000000",
          //   title: "南明河",
          //   image: "NMH",
          //   selected: false,
          //   editing: false,
          //   width: 1440,
          //   height: 900,
          //   enabled: false
          // },
          FDD00000000L: {
            id: "FDD00000000L",
            title: "芙蓉江",
            image: "FRJ",
            selected: false,
            editing: false,
            width: 1440,
            height: 900,
          },
          FDB00000000R: {
            id: "FDB00000000R",
            title: "清水江",
            image: "QSJ",
            selected: false,
            editing: false,
            width: 1440,
            height: 900,
          },
          FD3BF000000L: {
            id: "FD3BF000000L",
            title: "乌江",
            image: "WJ",
            selected: false,
            editing: false,
            width: 1440,
            height: 900,
          },
          AFF1230003K00000: {
            id: "AFF1230003K00000",
            title: "舞阳河",
            image: "WYH",
            selected: false,
            editing: false,
            width: 1440,
            height: 900,
          },
        }
        const styles = {
          "1"(node) {
            let style = {
              symbol: "image://images/dispatch/reservoir.png",
              itemStyle: {
                normal: {
                  shadowBlur: 10,
                  shadowColor: '#333'
                },
              }
            };
            if (node.q2 > node.maxQ && node.maxQ) {
              style.symbol = "image://images/dispatch/reservoir1.png";
            }
            return style;
          },
          "2"(node) {
            let style = {
              symbol: "image://images/dispatch/HydrologyStation.png",
              itemStyle: {
                normal: {
                  shadowBlur: 10,
                },
              }
            };
            if (node.q > node.warnQ && node.maxQ) {
              style.symbol = "image://images/dispatch/HydrologyStation3.png";
            }
            if (node.q > node.maxQ && node.maxQ) {
              style.symbol = "image://images/dispatch/HydrologyStation1.png";
            }
            return style;
          },
          "3"(node) {
            let style = {
              symbol: "image://images/dispatch/section.png",
              itemStyle: {
                normal: {
                  shadowBlur: 10,
                  shadowColor: '#333'
                },
              }
            };
            return style;
          },
        };
        const decider = {
          "1"(node) {
            return node.q2 > node.maxQ && node.maxQ;
          },
          "2"(node) {
            return (node.q > node.maxQ || node.q > node.warnQ) && node.maxQ;
          },
          "3"(node) {
            return false;
          }
        };
        const grid = {
          left: 0,
          right: 0,
          bottom: 0,
          top: 0
        };
        const chart_option = {
          grid,
          legend: false,
          tooltip: false,
          xAxis: {
            min: 0,
            max: 1440,
            type: "value",
            axisTick: false,
            axisLabel: false,
            splitLine: false,
            axisLine: false,
          },
          yAxis: {
            min: 0,
            max: 900,
            type: "value",
            axisTick: false,
            axisLabel: false,
            splitLine: false,
            axisLine: false,
          },
          dataset: {source: null},
          graphic: [{
            type: 'image',
            bounding: 'raw',
            left: grid.left,
            bottom: grid.bottom,
            zlevel: 1,

          }, {
            type: 'image',
            bounding: 'raw',
            left: grid.left,
            bottom: grid.bottom,
            zlevel: 2,
            style: {
              image: null,
              width: null,
              height: null,
            }
          }],
          series: [
            {
              type: "scatter",
              hoverAnimation: true,
              symbolKeepAspect: true,
              zlevel: 3,
              symbolSize: 30,
              symbolOffset: [0, 0],
              data: null,
              label: false,
            },
            {
              type: "effectScatter",
              hoverAnimation: true,
              symbolKeepAspect: true,
              zlevel: 4,
              symbolSize: 30,
              symbolOffset: [0, 0],
              data: null,
              label: false,
            }]
        };
        const HEIGHTS = [0, 100, 80, 65], WIDTH = 185;
        const Schedule = {
          template: "#template",
          props: {
            value: Array,
            option: Object
          },
          data() {
            return {
              grid,
              WIDTH,
              HEIGHTS,
              chart: null,
              optioned: null
            }
          },
          beforeDestroy() {
            this.chart.dispose();
          },
          mounted() {
            this.chart = echarts.init(this.$refs.chart);
            if (this.value) this.update();
          },
          watch: {
            value() {
              this.update();
            }
          },
          methods: {
            update() {
              const width = this.chart.getWidth() - grid.left - grid.right;
              const height = this.chart.getHeight() - grid.top - grid.bottom;
              let optioned = this.optioned = this.optioned || Object.assigns({}, chart_option);
              optioned.graphic[0].style = {
                image: `/images/modules/schedule/${this.option.image}_BG.png`,
                width: width,
                height: height,
              };
              optioned.graphic[1].style = {
                image: `/images/modules/schedule/${this.option.image}_FG.png`,
                width: width,
                height: height,
              };
              optioned.series[0].data = this.value.filter(e => !decider[e.nodeType](e))
              .map(e => Object.assign({},
                {value: [e.nodePosition.x, this.option.height - e.nodePosition.y],},
                styles[e.nodeType](e)));
              optioned.series[1].data = this.value.filter(e => decider[e.nodeType](e))
              .map(e => Object.assign({}, {
                value: [e.nodePosition.x, this.option.height - e.nodePosition.y],
              }, styles[e.nodeType](e)));
              this.chart.clear();
              this.chart.setOption(optioned);
            },
            onSchedule() {
              this.$emit("schedule", this.value);
            }
          },
          computed: {
            points() {
              const width = this.chart.getWidth(), height = this.chart.getHeight();
              return this.value.map(e => {
                let n = e.nodePosition, l = e.labelPosition;
                let sw = width / this.option.width, sh = height / this.option.height;
                let offset = {
                  x: (l.x * sw) + "px",
                  y: (l.y * sh) + "px"
                };
                let p1 = [sw * n.x, sh * (height - n.y)], p2 = [sw * l.x, sh * (height - l.y)];
                let p = [p2[0], p2[1]];
                //east
                if (p2[0] - p1[0] < 0 && p1[0] - p2[0] > WIDTH) p[0] += WIDTH;
                if (p2[1] - p1[1] > HEIGHTS[e.nodeType]) p[1] -= HEIGHTS[e.nodeType];
                let label = {
                  width: Math.sqrt(Math.pow(p[0] - p1[0], 2) + Math.pow(p[1] - p1[1], 2)) + "px",
                  left: (p2[0] - p1[0] < 0 && p1[0] - p2[0] > WIDTH ? WIDTH - 1 : 0) + "px",
                  top: (p2[1] - p1[1] > HEIGHTS[e.nodeType] ? HEIGHTS[e.nodeType] - 1 : 0) + "px",
                  rotate: "rotate(" + (180 - Math.atan2(p[1] - p1[1], p[0] - p1[0]) * (180 / Math.PI)) + "deg)"
                }
                return {offset, label, node: e};
              });
            }
          }
        };
        const vm = new Vue({
          el: "#module-generalized-scheduling",
          components: {Schedule},
          data: {
            data: null,
            schedule: {
              list: schedules,
              current: null
            },
            visible: false
          },
          mounted() {
            note.on("scheduling.generalized.open", (e, river) => {
              this.visible = true;
              this.loadNode(schedules[river] || schedules.FDD00000000L);
            });
          },
          methods: {
            onSchedule(data) {
              let values = data.map(e => Object.assign({}, {
                id: e.nodeId,
                hour: 24,
                name: e.nodeName,
                type: e.nodeType,
                maxQ: e.q2,
                rainValue: e.r,
              }))
              const body = {
                interface: "com.ec.ws.service.def.dispatch.DispatchService",
                method: "dispatch",
                args: [this.schedule.current.id, values]
              };
              ajaxCallJson(body, "/rpc", ({data}) => this.data = data);
            },
            onSwitch(current) {
              if (this.schedule.current === current) return;
              if (this.schedule.current) {
                this.schedule.current.selected = false;
              }
              current.selected = true;
              this.schedule.current = current;
            },
            loadNode(node) {
              const body = {
                interface: "com.ec.ws.service.def.dispatch.DispatchService",
                method: "findRiverNodes",
                args: [node.id],
                prevent: true
              };
              let index = layer.load(2, {shade: 0.3, time: 0});
              ajaxCallJson(body, "/rpc", (data) => {
                layer.close(index);
                if (data && data.resflag) {
                  this.data = data.data;
                  this.onSwitch(node);
                }
              }, () => {
                layer.msg("获取数据失败，请稍后再试！");
                layer.close(index);
              });
            }
          }
        });
      });
    </script>
</div>

  <script type="text/x-template" id="playbar">
    <div class="component playbar v-box">
        <div class="buttons h-box east-self" v-if="optioned.playable">
            <i class="button fa fa-undo" @click="handler.onReset" title="重置"
               :disabled="count<2"></i>
            <i class="button fa fa-backward" @click="handler.onJump(-1)" title="回退"
               :disabled="index===0"></i>
            <i class="button fa play" :class="{'fa-play':!playing,'fa-pause':playing}"
               @click="handler.onSwitchPlay(!playing)"
               :disabled="index>=count-1"></i>
            <i class="button fa fa-forward" @click="handler.onJump(1)" title="前进"
               :disabled="index>=count-1"></i>
        </div>
        <div class="box full" ref="bar" :playing="playing.toString()"
             @wheel.stop="handler.onWheel"
             @mousemove="handler.onMouseMove"
             @mouseup="handler.onMouseUp">
            <div class="container full" v-if="count">
                <div class="tooltip">
                    <slot name="tooltip" :model="{index,count}"></slot>
                </div>
                <div class="bar fill-x" :title="track.tip"
                     @mousedown.stop="handler.onBarMouseDown"
                     @mousemove="handler.onBarMouseMove"
                     @click.stop="handler.onBarClick"
                     v-if="count">
                    <li class="cursor" :style="[style.list.cursor,{left:cursor.x+'px'}]"
                        :title="cursor.tip"
                        :status="provider.status"
                        @mousedown.stop="handler.onCursorMouseDown"
                        @mouseenter="handler.onCursorEnter"
                        v-show="!isNaN(cursor.x)"></li>
                    <li class="track" :style="style.list.track"></li>
                    <div class="sections" v-if="sections">
                        <li class="section" v-for="e in sections" :style="e.style"></li>
                    </div>
                    <div class="points" v-if="of('point.enabled')">
                        <li class="point" v-for="(e,i) in points"
                            :style="{left:style.pointOffset(e)}"
                            :title="sample.tooltip(e)">
                        </li>
                    </div>
                </div>
                <div class="labels" v-if="of('label.enabled')">
                    <template v-for="e in points">
                        <li class="label" :style="[style.list.label,{left:style.labelOffset(e)}]">
                            <slot name="label" :point="e">{{sample.label(e)}}</slot>
                        </li>
                    </template>
                </div>
            </div>
        </div>
    </div>
</script>

<script>
  $(function () {
    const SCALE_FACTOR = 1.2;
    const basic = {
      playable: true,
      split: 7,
      scale: {
        enabled: true,
        min: 0,
        max: 100,
      },
      range: null,
      sections: null,
      duration: 1000,
      loop: false,
      track: {
        height: 6,
      },
      cursor: {
        width: 10,
        height: 10,
      },
      point: {
        enabled: true,
        width: 6,
        height: 6
      },
      label: {
        enabled: true,
        width: 60
      },
      tooltip: {},
    };


    let component = {
      template: "#playbar",
      props: {
        option: Object,
        value: Object
      },
      data() {
        return {
          player: new Player(this),
          handler: new Handler(this),
          sample: new Sample(this),
          playing: false,
          extent: null,
          sections: null,
          index: 0,
          scale: [],
          points: [],
          status: [],
          range: [],
          cursor: {
            x: 0,
            tip: null
          },
          track: {
            tip: null
          },
          reset: {
            range: [],
            index: 0
          }
        }
      },
      watch: {
        value() {
          this.reinit();
        },
        "optioned.range"(range) {
          if (range == null) return;
          this.setRange(range[0], range[1]);
          this.player.set(range[2] === -1 ? this.index : range[2]);
          this.style.update();
          this.$emit("range-change", range, this.index);
        },
      },
      mounted() {
        if (this.value) this.reinit();
      },
      methods: {
        update() {
          this.player.stop();
          let range = this.sample.init();
          this.index = range[2] === -1 ? 0 : range[2];
          this.setRange(range[0], range[1]);
          this.style.update();
          if (this.count) this.$emit("ready", this.index, range);
        },
        setRange(min, max) {
          this.range = [min, max];
          this.scale = [min / this.count * 100, max / this.count * 100];
          this.reset.range = [min, max];
          this.reset.index = this.index;
          if (this.of("point.enabled")) {
            this.points = this.sample.extract(min, max, this.optioned.split);
          }
        },
        of(key, def) {
          return Object.get(this.optioned, key, def);
        },
        reinit() {
          let bound = this.$refs.bar.getBoundingClientRect();
          this.extent = [bound.x, bound.y, bound.width, bound.height];
          this.update();
        }
      },
      computed: {
        optioned() {
          return Object.assigns({}, basic, this.option);
        },
        provider() {
          return Array.isArray(this.value) ? new Provider(this.value, this.optioned) : this.value;
        },
        style() {
          return new Style(this, this.optioned);
        },
        count() {
          return this.provider && this.provider.count();
        }
      }
    }

    Vue.component("Playbar", component);

    function Provider(data, option) {

      /**
       * Init provider and get the init range and index.
       *
       * @return Array<Number> The init range and index: [start{include},end(exclude),index]
       */
      this.init = function () {

      };

      this.count = function () {

        return data.length;
      };

      this.get = function (index) {

        return data[index];
      };

      this.scale = function (scale, count) {

      };
      this.extract = function (min, max) {
      };

      this.sections = function () {

      }
    }

    /**
     * The sample for handle/get data.
     * @constructor
     */
    function Sample(context) {

      this.init = function () {
        let value = context.provider.init && context.provider.init();
        if (value == null) value = context.optioned.range;
        if (value != null) return value;
        return [0, context.provider.count(), Math.floor(context.provider.count() / 2)];
      };

      this.count = function () {

        return context.provider.count() || 0;
      };

      this.get = function (index) {

        return context.provider.get(index);
      };

      this.scale = function (scale, count) {
        if (Function.is(context.provider.scale)) {
          let range = context.provider.scale(scale, count);
          if (range) return range;
        }
        return [Math.round(scale[0] / 100 * count), Math.round(scale[1] / 100 * count)];
      };

      this.extract = function (min, max, split) {
        if (Function.is(context.provider.extract)) {
          let points = context.provider.extract(min, max, split);
          if (points) return points;
        }
        let count = max - min;
        if (count <= split) return Array.make(min, max);
        let buf = [], f = split / count;
        for (let i = 0; i < count; i++) {
          if (Math.floor((i - 1) * f) !== Math.floor(i * f)) {
            buf.push(min + i);
          }
        }
        buf[split - 1] = Math.max(buf[split - 1], max - 1);
        return buf;
      }

      // this.extract = function (min, max) {
      //   let data = context.provider.extract && context.provider.extract(min, max);
      //   if (data) return data;
      //   let count = max - min, maxCount = context.optioned.split;
      //   if (count <= maxCount) return Array.make(min, max);
      //   let interval = Computer.nice((count - 2) / maxCount, true), buf = [min];
      //   // let remain = (count - 3) % interval, start = min + Math.floor(remain / 2);
      //   for (let i = min + interval; i < max - interval; i += interval) {
      //     buf.push(i);
      //   }
      //   buf.push(max - 1);
      //   return buf;
      // };

      this.sections = function () {
        if (context.provider.sections) {
          return context.provider.sections();
        }
        return context.optioned.sections;
      };

      this.translation = function (range, points, step) {
        if (step === 0) return;
        let split = context.optioned.split;
        if (points.length < split && context.count > split) {
          range[0] = Math.max(0, range[0] + step);
          if (context.of("point.enabled")) {
            context.points = this.extract(range[0], range[1], split);
          }
        } else {
          for (let i = points.length - 1; i >= 0; i--) {
            points[i] += step;
          }
          range[0] += step;
          range[1] += step;
        }
      };

      this.label = function (index) {
        let format = context.provider.label || context.optioned.label.format;
        if (Function.is(format)) return format.call(context.provider, index);
        let node = this.get(index);
        return (Object.ordinary(node) && node.label) || node;
      };

      this.tooltip = function (index) {
        let format = context.provider.tooltip || context.optioned.tooltip.format;
        if (Function.is(format)) return format.call(context.provider, index);
        let node = this.get(index);
        return (Object.ordinary(node) && node.label) || node;
      };
    }

    /**
     * The style for playbar to help position the point.
     * @constructor
     */
    function Style(context, option) {

      this.list = function () {
        let width = option.label.width;
        if (Function.is(width)) width = width();
        return {
          cursor: {
            top: -((option.cursor.height - option.track.height) / 2) + "px",
            width: option.cursor.width + "px",
            height: option.cursor.height + "px",
            backgroundColor: option.cursor.color
          },
          track: {
            height: option.track.height + "px",
            backgroundColor: option.track.color
          },
          label: {
            width: width + "px"
          }
        };
      }();

      context.sections = function () {
        let sections = Array.ensure(context.sample.sections());
        return sections && sections.map(e => {
          return Object.assigns({}, e, {style: {background: e.color, borderRadius: e.radius, zIndex: e.zIndex}})
        })
      }();

      this.updateSections = function () {
        let range = context.range, sections = context.sections;
        sections && sections.forEach(e => {
          let min = Math.min(Math.max(e.min == null ? range[0] : e.min, range[0]), range[1] - 1);
          let max = Math.max(Math.min(e.max == null ? range[1] : e.max, range[1]) - 1, range[0]);
          let L = Computer.offset(min, range, context.extent);
          let R = Computer.offset(max, range, context.extent);
          e.style.left = L + "px";
          e.style.width = (R - L) + "px";
        });
      };

      this.pointOffset = function (index) {
        return Computer.left(index, option.point.width, context.range, context.extent, true);
      };

      this.cursorOffset = function (index) {
        let offset = Computer.offset(index, context.range, context.extent);
        if (index === context.range[0] && context.range[1] - context.range[0] === 1) {
          offset = context.extent[2] / 2;
        }
        return offset == null ? null : offset - option.cursor.width / 2;
      };

      this.labelOffset = function (index) {
        let width = context.optioned.label.width, range = context.range;
        if (Function.is(width)) width = width();
        if (range[1] - range[0] === 1) return `${context.extent[2] / 2 - width / 2}px`;
        if (index === range[0]) return "0px";
        if (index === range[1] - 1) return `${context.extent[2] - width}px`;
        let offset = Computer.offset(index, range, context.extent);
        return `${offset - width / 2}px`;
      };

      this.update = function () {
        context.cursor.x = this.cursorOffset(context.index);
        this.updateSections();
      };
    }

    /**
     * The static class for compute some value.
     */
    function Computer() {

    }

    /**
     * Compute the left position she it to center if need(when center is true).
     */
    Computer.left = function (index, width, range, extent, center) {
      if (range[1] - range[0] === 1) return `${extent[2] / 2 - width / 2}px`;
      let value = Computer.offset(index, range, extent);
      return `${value - (center ? width / 2 : width)}px`;
    };

    /**
     * Compute the left offset by given node index.
     *
     * Compute by:
     *
     * left = (index/count)*width
     *
     * @param index Current node index.
     * @param range The range of current visible nodes :[start,end].
     * @param extent The bar extent: [width,height].
     * @return {number|null} The offset of left.
     */
    Computer.offset = function (index, range, extent) {
      if (range[1] - range[0] === 1) return null;
      return ((index - range[0]) / (range[1] - range[0] - 1)) * extent[2]
    };

    /**
     * Compute the node index by given point offset.
     *
     * Compute by:
     *
     * index = (x*count)/width
     *
     * @param offset Current offset x of point.
     * @param range The range of current visible nodes :[start,end].
     * @param extent The bar extent: [width,height].
     * @return {number} The node index of current point offset.
     */
    Computer.index = function (offset, range, extent) {
      return Math.round(offset * (range[1] - range[0] - 1) / extent[2] + range[0]);
    };

    Computer.nice = function (interval, round) {
      let exponent = Math.floor(Math.log(interval) / Math.LN10);
      let exp10 = Math.pow(10, exponent);
      let f = interval / exp10; // 1 <= f < 10

      let nf;

      if (round) {
        if (f < 1.5) {
          nf = 1;
        } else if (f < 2.5) {
          nf = 2;
        } else if (f < 4) {
          nf = 3;
        } else if (f < 7) {
          nf = 5;
        } else {
          nf = 10;
        }
      } else {
        if (f < 1) {
          nf = 1;
        } else if (f < 2) {
          nf = 2;
        } else if (f < 3) {
          nf = 3;
        } else if (f < 5) {
          nf = 5;
        } else {
          nf = 10;
        }
      }

      interval = nf * exp10; // Fix 3 * 0.1 === 0.30000000000000004 issue (see IEEE 754).
      // 20 is the uppper bound of toFixed.
      return exponent >= -20 ? +interval.toFixed(exponent < 0 ? -exponent : 0) : interval;
    }

    Computer.logarithm = function (x, scale, extent, dir) {
      return Computer.gradually(x, scale, extent, dir);
    };


    Computer.gradually = function (x, scale, extent, dir) {
      let percent = (x - extent[0]) / extent[2] * (scale[1] - scale[0]) + scale[0];
      let clone = scale.slice(), s = dir < 0 ? 1 / SCALE_FACTOR : SCALE_FACTOR;
      clone[0] = (clone[0] - percent) * s + percent;
      clone[1] = (clone[1] - percent) * s + percent;
      return clone;
    }

    Computer.scale = function (x, scale, limit, extent, dir) {
      let range = Computer.gradually(x, scale, extent, dir);
      if (range[1] - range[0] === 0) return scale;
      range[0] = Math.max(range[0], limit.min);
      range[1] = Math.min(range[1], limit.max);
      return range;
    };

    /**
     * The player for control play.
     * @constructor
     */
    function Player(context) {
      let handler;

      this.start = function () {
        if (context.index >= context.count - 1 && !context.optioned.loop) return;
        if (context.playing) clearInterval(handler);
        handler = setInterval(this.play.bind(this), context.optioned.duration);
        context.playing = true;
        context.$emit("start", context.index);
      };

      this.stop = function () {
        if (context.playing) {
          context.playing = false;
          clearInterval(handler);
          context.$emit("stop");
        }
      };

      this.end = function () {
        this.pause();
        context.$emit("end");
      };

      this.pause = function () {
        if (context.playing) {
          clearInterval(handler);
          context.playing = false;
          context.$emit("pause");
        }
      };

      this.play = function () {
        if (context.index < context.count - 1) {
          context.$emit("play", ++context.index);
        }
        if (context.index === context.count - 1) {
          if (context.optioned.loop) context.index = 0;
          else this.end();
        }
        this.translation(1);
      };

      this.reset = function () {
        if (context.index !== context.reset.index) {
          context.player.pause();
          this.set(context.reset.index);
          let r = context.reset.range;
          if (r[0] !== context.range[0] && r[1] !== context.range[1]) {
            context.range = r.slice();
            context.points = context.sample.extract(r[0], r[1], context.optioned.split);
          }
          context.style.update();
        }
      }

      this.translation = function (direction) {
        let index = context.index - direction, range = context.range;
        let middle = range[0] + ((range[1] - range[0]) >> 1);
        if ((direction > 0 && index >= middle && range[1] < context.count) || (direction < 0 && index <= middle && range[0] > 0)) {
          context.sample.translation(range, context.points, direction);
          context.$emit("range-change", range, context.index);
        }
        context.style.update();
      };

      this.forward = function () {
        if (context.index < context.count - 1) {
          this.set(context.index + 1);
          this.translation(1);
        }
      };

      this.backward = function () {
        if (context.index > 0) {
          this.set(context.index - 1);
          this.translation(-1);
        }
      };

      this.set = function (index) {
        let old = context.index;
        if (old !== index) {
          context.index = index;
          context.cursor.x = context.style.cursorOffset(context.index);
          context.$emit("jump", index, old);
        }
      }
    }

    /**
     * The event handler for handler all playbar events.
     *
     * @param context The playbar instance.
     * @constructor
     */
    function Handler(context) {
      const self = this;
      let handler, X, L, range = [], index;

      this.onReset = function () {
        context.player.reset();
      };

      this.onJump = function (direction) {
        if (context.playing) context.player.pause();
        direction > 0 ? context.player.forward() : context.player.backward();
      };

      this.onSwitchPlay = function (playing) {
        playing ? context.player.start() : context.player.pause();
      };

      this.onBarClick = function (event) {
        let index = Computer.index(event.x - context.extent[0], context.range, context.extent);
        context.player.set(index);
        context.style.update();
      };
      this.onBarMouseMove = function (e) {
        let index = Computer.index(e.x - context.extent[0], context.range, context.extent);
        context.track.tip = context.sample.tooltip(index);
      };

      this.onCursorMouseDown = function (e) {
        X = e.x, L = e.target.offsetLeft;
        handler = self.handlerCursor;
        index = context.index;
      };
      this.onCursorEnter = function () {
        context.cursor.tip = context.sample.tooltip(context.index);
      };
      this.onBarMouseDown = function (e) {
        X = e.x, L = e.target.offsetLeft;
        // handler = self.handlerBar;
        range[0] = context.range[0];
        range[1] = context.range[1];
        index = context.index;
      };

      this.onMouseUp = function () {
        if (handler) handler.up();
        handler = null;
      };
      this.onMouseMove = function (e) {
        if (handler) handler.move(e);
      };

      this.onWheel = function (e) {
        if (!context.optioned.scale.enabled) return;
        let extent = context.extent;
        let limit = context.optioned.scale;
        let scale = Computer.scale(e.x, context.scale, limit, extent, e.deltaY);
        if (scale[0] === context.scale[0] && scale[1] === context.scale[1]) return;
        let range = context.sample.scale(scale, context.count);
        if (range[1] - range[0] === 0) return;
        context.scale = scale;
        context.range = range;
        if (context.of("point.enabled")) {
          context.points = context.sample.extract(range[0], range[1], context.optioned.split);
        }
        context.style.update();
      };

      this.handlerCursor = {
        move(e) {
          let x = (e.x - (X - L)), w = context.optioned.cursor.width;
          context.cursor.x = Math.min(Math.max(-w / 2, x), context.extent[2] - w / 2);
          context.index = Computer.index(context.cursor.x + context.optioned.cursor.width / 2, context.range, context.extent);
        },
        up() {
          context.$emit("jump", context.index, index);
        }
      };

      this.handlerBar = {
        move(e) {
          let distance = e.x - X, direction = distance < 0 ? -1 : 1;
          if (distance === 0) return;
          let count = Math.round(Math.abs(distance) / (context.extent[2] / (range[1] - range[0])));
          let max = distance < 0 ? Math.min(range[0], count) : Math.min(context.count - range[1], count);
          if (count === 0 || max === 0) return;
          context.range[0] = range[0] - max * direction;
          context.range[1] = range[1] - max * direction;
          context.style.update();
        },
        up() {

        }
      };

    }
  });
</script>
  <style>
  .myTimeDialog .el-time-spinner .el-time-spinner__wrapper:nth-child(1){
    width: 100%;
  }
  .myTimeDialog .el-time-spinner .el-time-spinner__wrapper:nth-child(2){
    width: 0px;
    height: 0px;
  }
  .myTimeDialog .el-range-editor.el-input__inner{
    background-color: rgba(9,25,57,.99);
  }
  .myTimeDialog .el-date-editor .el-range-input{
    background-color: rgba(9,25,57,.99);
  }
  .myTimeDialog{
    width: 496px;
    height:178px;
    position: absolute;
    top: 80px;
    right: 100%;
    background-color: rgba(9,25,57,.99);
  }
  .myTimeDialog .time-head{
    width: 100%;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    border-bottom: 2px solid #00AEDB;

  }
  .myTimeDialog .time-head .time-icon{
    position: absolute;
    right: 20px;
    top:4px;
  }
  .myTimeDialog .time-content{
    width: 100%;
    text-align: center;
    margin-top:20px;
    border-bottom: 2px solid #00AEDB;
    height: 66px;
  }

  .myTimeDialog .time-bottom{
    width: 100%;
    text-align: center;
    margin-top:10px;
  }
 .timeIcon{
    position: absolute;
    right: 54px;
    top: 12px;
  }
 .timeLabel{
    display: flex;
    align-items: center;
    flex-direction: column;
    margin-left: 20px;
    font-size: 17px;
  }
</style>
<div class="module play-control" xmlns:v-slot="http://www.w3.org/1999/xhtml">
  <div id="module-play-control" mode="1" class="h-box " visible="visible"><!----> <i title="切换" class="switch button hover h-box-cc fa fa-exchange" style="cursor: pointer;"></i> <i title="展开" class="open button hover h-box-cc fa fa-angle-double-left"></i> <i title="隐藏" class="close button hover h-box-cc fa fa-angle-double-right"></i> <div class="component playbar v-box fill" id="myPlaybar"><div class="buttons h-box east-self"><i title="重置" class="button fa fa-undo"></i> <i title="回退" class="button fa fa-backward"></i> <i class="button fa play fa-play"></i> <i title="前进" class="button fa fa-forward"></i></div> <div playing="false" class="box full"><div class="container full"><div class="tooltip"><label title="中央气象台预报成果" class="info"><img src="./防汛抗旱态势分析系统_files/link.png"></label> <span class="label">
          2019年11月10日 <!----></span></div> <div class="bar fill-x" title="2019年11月12日"><li status="fetched" class="cursor" style="top: -2px; width: 10px; height: 10px; left: 72.5px;"></li> <li class="track" style="height: 6px;"></li> <div class="sections"><li class="section" style="background: rgb(51, 51, 51); left: 0px; width: 77.5px;"></li><li class="section" style="background: rgb(18, 159, 214); left: 77.5px; width: 232.5px;"></li></div> <div class="points"><li title="2019年11月9日" class="point" style="left: -3px;"></li><li title="2019年11月10日" class="point" style="left: 74.5px;"></li><li title="2019年11月11日" class="point" style="left: 152px;"></li><li title="2019年11月12日" class="point" style="left: 229.5px;"></li><li title="2019年11月13日" class="point" style="left: 307px;"></li></div></div> <div class="labels"><li class="label" style="width: 60px; left: 0px;">11月
9日</li><li class="label" style="width: 60px; left: 47.5px;">11月
10日</li><li class="label" style="width: 60px; left: 125px;">未来
24时</li><li class="label" style="width: 60px; left: 202.5px;">未来
48时</li><li class="label" style="width: 60px; left: 250px;">未来
72时</li></div></div></div></div> <div id="timeLabel" class="timeLabel" style="display: none;"><div style="margin-top: 13px;">降雨分布<!----></div> <div id="myTimeRange" style="margin-top: 5px;">2017-05-54 12:00-2017-05-54 12:00</div></div> <div id="module-mytime" class="myTimeDialog" style="display: none;"><div class="time-head"><span>时间选择</span> <span class="window-close-icon window-close time-icon"></span></div> <div class="time-content"><div class="el-date-editor el-range-editor el-input__inner el-date-editor--datetimerange"><i class="el-input__icon el-range__icon el-icon-time"></i><input autocomplete="off" placeholder="开始日期" name="" class="el-range-input"><span class="el-range-separator">至</span><input autocomplete="off" placeholder="结束日期" name="" class="el-range-input"><i class="el-input__icon el-range__close-icon"></i></div></div> <div class="time-bottom"><button type="button" class="el-button el-button--primary el-button--small"><!----><!----><span>确定</span></button></div></div></div>
  <script type="text/javascript">
    $(function () {
      const option = {
        playable: true,
        scale: { enabled: false },
        range: null,
        duration: 1000,
        split: 7,
      };

      let vm = new Vue({
        el: "#module-play-control",
        data: {
          mybox:{},
          pickerOptions0: {
            disabledDate(time) {
              return time.getTime() > Date.now() - 8.64e6;//如果没有后面的-8.64e6就是不可以选择今天的
            }
          },
          value1:null,
          myTime:{},
          option,
          provider: undefined,
          interval: {
            list: [],
            selected: null
          },
          layer: {
            selected: null,
            list: null,
          },
          visible: true,
          subject: null,
          time: getSystemTime(),
          isTimeSet: false,
          player: null,
          mode: 1,
          playable: null,
        },
        watch: {
          provider(p) {
            if (p) {
              this.option = Object.assigns({}, option, { duration: p.option().duration });
            }
          }
        },
        mounted() {
          note.on("subject.change", (event, subject) => this.onSubjectChange(subject));
          note.on("calendar.change", (event, time) => this.onCalendarChange(time));
          note.on("map.ready", () => this.player = new LayerPlayer(map.layers));
          note.on("map.clearlayer", () => {
            this.player && this.player.dispose();
          });
          note.on("visible.layer", () => {
            this.onVisible(!!0)
          })
          note.on("visible.typhoon.radar", (event,id) => this.onLoadCloudChart(id));//台风加载云图
          note.on("visible.typhoon.cloud", (event,id) => this.onLoadCadarChart(id));//台风加载雷达
          note.on("clear.typhoon.radar", (event,id) => {
            if (this.player) this.player.dispose()
          });
          this.onVisible(!!0)
          //获取mybox
          this.getMyBox();
        },
        methods: {
          getMyBox:function(){
            let self = this;
            ajaxCallJson({}, "/region/getUserExtent", (data) => {
              let mydata = JSON.parse(data.data);
                  self.mybox = mydata.data.adcdlist[0];
                  console.log(self.mybox);

            });
          },
          openTime:function(){
            $('#module-mytime').show();
          },
          timeClose:function(){
            $('#module-mytime').hide();
          },
          closeTime:function(){
            map.layers.remove(this.myTime);
          },
          getTimeLayer:function(info,from,to){
            let body = {
              interface: "com.ec.ws.service.def.transfer.TransferService",
              method: "rainPolygonQuery",
              param :{
                from:from,
                to:to,
                // maxx: this.mybox.maxx,
                // maxy:this.mybox.maxy,
                // minx: this.mybox.minx,
                // miny: this.mybox.miny,
              }
            };
            ajaxCallJson(body, "/rpc/getRainAnyToWms", (data) => {
                  console.log(data);
                  info.viewparams.batch = data.data;
                  this.loadTimeLayer(info);
                  this.timeClose();
                  $('#myTimeRange').html(this.value1[0]+'时-'+this.value1[1]+'时')
                  $('#myPlaybar').hide();
                  $('#timeLabel').show();
            });
          },
          loadTimeLayer(option){
            let self = this;
              require([
                "esri/layers/WMSLayer",
              ], function (WMSLayer) {
                self.myTime = new WMSLayer({
                  id: 'Time8890',
                  url: option.url,
                  sublayers: [{
                    name: option.layers
                  }],
                  fullExtent: {
                    xmin:option.minx,
                    xmax: option.maxx,
                    ymin: option.miny,
                    ymax: option.maxy,
                  },
                  customLayerParameters: option.viewparams,
                  spatialReference:4326,
                })
                  map.layers.add(self.myTime);
              });
          },
          timeSure:function(a,b){
            if(!this.value1){
              this.$message({
                message: '请选择时间段！',
                type: 'warning'
              });
              return;
            };
            map.layers.remove(this.myTime);
            this.player && this.player.dispose();
            this.timeClose();
            let body = {
              interface: "com.ec.ws.service.def.xyyj.LayerManagerV1Service",
              method: "getLayerPlayInfo",
              args: [1001,isLan]
            }
            console.log(this.value1);
            let from = this.value1[0]+':00:00';
            let to =  this.value1[1]+':00:00';
            ajaxCallJson(body, "/rpc", (result) => {
                  this.getTimeLayer(result.data.nodes[0],from,to);
            })

          },
          onLayerChange(layer) {
            // if (this.layer.selected === layer) return;
            this.layer.selected = layer;
            note.notify("play.layer.change", layer, this.subject, (intervals) => {
              this.interval.list = intervals;
              this.onInterval(intervals && intervals[0]);
            });
          },
          onInterval(interval) {
            // if (this.interval.selected === interval) return;
            this.interval.selected = interval;
            if (this.player) this.player.dispose();
            note.notify("layer.play.stop");
            note.notify("layer.play.interval.change", this.layer.selected, this.layer.selected, (provider) => {
              if (this.provider && this.provider.dispose) {
                this.provider.dispose();
              }
              this.provider = provider;
            });
          },
          onSubjectChange(subject) {
            this.subject = subject;
            if (subject.id === "26" || subject.id === "27"|| subject.id === "10") {
              this.visible = false;
              this.onVisible(false);
            } else {
              this.visible = true;
              note.notify("play.control.visible", true);
            }
            this.mode = Object.get(subject.configure, "mode", 1);
            this.loadPlayinfo();
            // if (this.mode & 4) {
            //   let body = {
            //     interface: "com.ec.ws.service.def.xyyj.LayerManagerV1Service",
            //     method: "getLayerUrlList",
            //     args: [subject.id]
            //   };
            //   ajaxCallJson(body, "/rpc", ({data}) => {
            //     this.layer.list = data;
            //     this.onLayerChange(data[0]);
            //   });
            // } else {
            //   this.layer.list = [];
            //   this.onLayerChange(subject);
            //   // note.notify("subject.layer.loaded", subject);
            // }
          },
          onCalendarChange(time) {
            if (time === "000") {
              this.visible = false;
              this.onVisible(false);
            } else {
              if (moment.range(time, getSystemTime()).diff("day") === 0) {
                time = Object.get(this.playable, "current", time);
              }
              this.isTimeSet = true;
              this.time = time;
              if (this.provider && this.provider.name !== "weather") {
                if (this.provider.option().linkage) {
                  this.provider.update(time);
                  note.notify("layer.play.update");
                }
                let range = this.provider.rangeOf(time, false);
                if (range) this.option.range = range;
              }
            }
          },
          onReady(index,range) {
            note.notify("layer.play.init", index, this.provider,range);
            note.notify("layer.play.frame", index, this.provider);
            this.player.initialize(index, this.provider);
          },
          onStart(index) {
            note.notify("layer.play.start", index);
          },
          onStop() {
            note.notify("layer.play.stop");
            this.player.stop();
          },
          onPause() {
            note.notify("layer.play.pause");
            this.player.pause();
          },
          onEnd() {
            note.notify("layer.play.end");
            this.player.end();
          },
          onJump(index, old) {
            if (this.provider && this.provider.jump) {
              this.provider.jump(index, old);
            }
            note.notify("layer.play.jump", index);
            note.notify("layer.play.frame", index, this.provider);
            this.player.jump(index);
          },
          onPlay(index) {
            note.notify("layer.play.play", index);
            note.notify("layer.play.frame", index, this.provider);
            this.player.play();
          },
          onRangeChange(range,index){
            note.notify("layer.play.range-change", range,index, this.provider);
          },
          onVisible(visible) {
            this.visible = visible;
            this.player.visible(visible);
            note.notify("play.control.visible", visible);
          },
          g(key, def) {
            return Object.get(this, key, def);
          },
          onInfoClick(event) {
            note.notify(`play.info.${event}`, this.provider);
          },
          onModeSwitch() {
            this.mode = this.mode === 2 ? 1 : 2;
            weatherShow7day=true;
            this.loadPlayinfo();
          },
          loadPlayinfo(id) {
            if(id===undefined){
              id=this.subject.id;
            }
            this.player && this.player.dispose();
            map.layers.remove(this.myTime);
            $('#timeLabel').hide();
            $('#module-mytime').hide();
            $('#myPlaybar').show();
            if (this.subject.id === "26" || id === "10" || this.subject.id === "27" || this.subject.id === "28") return;
            let body = {
              interface: "com.ec.ws.service.def.xyyj.LayerManagerV1Service",
              method: "getLayerPlayInfoByMode",
              args: [id, this.mode, isLan, {}],
              prevent: true,
            };
            ajaxCallJson(body, "/rpc", (data) => {
              let playable = data && data.data, provider;
              if (playable) {
                provider = ProviderFactory[playable.provider || "default"](playable);
              }
              this.provider && this.provider.dispose();
              this.provider = provider;
              this.playable = playable;
            });
          },
          onLoadCloudChart(id){
            this.loadPlayinfo("8");
          },
          onLoadCadarChart(id){
            this.loadPlayinfo("9");
          }
        },
        computed: {
          optioned() {
            let optioned = Object.assigns({}, this.option);
            if (!this.provider) return optioned;
            optioned.playable = this.mode !== 2;
            optioned.duration = this.provider.option().duration;
            optioned.split = this.provider.option().initSize || 5;
            return optioned;
          }
        }
      });

      const configure = { opacity: 0.6, transaction: false, duration: 1000 };
      const SYMBOLS = ["year", "month", "day", "hour", "minute", "second"];
      const NODES = 5;

      function Provider() {
        this.status = "unload";
      }

      function IntervalProvider(playable) {
        Provider.call(this);
        this.total = 0;
        this.configure = playable.configure || configure;
        this.configure.duration = playable.duration;
        this.nodes = null;

        this.init = function () {
          this.compute();
          let time = (!vm.isTimeSet && playable.current) || vm.time;
          return this.rangeOf(time, true, this.configure.initSize);
        };

        this.count = function () {
          return this.total;
        };

        this.option = function () {
          return this.configure;
        }

        this.get = function (index) {
          let node = this.decode(index);
          let decoder = Decoder[node.changeflag];
          if (decoder) decoder(node);
          let factory = Factory[node.service.toUpperCase()];
          return factory(node, index);
        };

        this.sections = function () {
          return this.nodes.map(e => ({
            min: Math.max(e.range[0] - 1, 0),
            max: e.range[1],
            color: e.layer.configure.color
          }));
        };

        this.rangeOf = function (time, amend, size = NODES) {
          if (size < 0) return [0, this.count(), 0];
          let index = this.nearest(time, amend);
          if (index === -1) return null;
          // let count = Math.min(Math.min(index, size), Math.min(full - index - 1, size));
          // if (index === 0) {
          //   return [0, Math.min(full, size * 2), 0];
          // }
          // if (index === full - 1) {
          //   return [Math.max(0, index - size), full, index];
          // }
          // return [index - count, index + count + 1, index];
          let left = this.count() - index, count = Math.min(size, left);
          return [Math.max(0, index - (size - count)), index + count, index];
        };

        /**
         * Find the nearest node in by time.
         *
         * This method may amend the node when time out of range.
         *
         * @param time {number} The time to find.
         * @param amend {boolean} Amend the index.
         */
        this.nearest = function (time, amend = true) {
          if (amend === false) {
            if (time < this.nodes[0].times[0] || time > this.nodes.last.times[1]) {
              return -1;
            }
          }
          let index = -1, diff = time;
          Object.each(this.nodes, e => {
            let count = e.count, start = moment(e.times[0]);
            for (let i = 0; i < count; i++) {
              let value = Math.abs(start.valueOf() - time);
              if (value < diff) {
                diff = value;
                index = e.range[0] + i;
              }
              start.add(e.step, e.symbol);
            }
          }, this, true);
          return index;
        }

        this.process = function (layer) {
          if (SYMBOLS.indexOf(layer.stepUnit) === -1) {
            throw new Error("Invalid step unit: " + layer.stepUnit);
          }
          let count = this.countOf(layer);
          return {
            count: count,
            range: [this.total, this.total += count],
            times: [layer.starttime, layer.endtime],
            step: layer.stepSize,
            symbol: layer.stepUnit,
            format: layer.format,
            layer: layer
          };
        };

        this.countOf = function (layer) {
          return Math.floor(moment.range(layer.starttime, layer.endtime).diff(layer.stepUnit) / layer.stepSize) + 1;
        }

        this.nodeOf = function (index) {
          return this.nodes.find(e => index >= e.range[0] && index < e.range[1]);
        };

        this.decode = function (index) {
          let node = this.nodeOf(index), time = this.timeOf(index, node);
          return Object.assigns({}, node.layer, { times: [time], viewparams: {} })
        }

        this.label = function (index) {
          let node = this.nodeOf(index), time = this.timeOf(index, node);
          let base = moment(node.times[0]).add(-1 * node.step, node.symbol).valueOf();
          return message.format(node.format.short, time, Math.abs(time - base)).replace("&", "\n");
        };

        this.tooltip = function (index) {
          let node = this.nodeOf(index);
          return message.format(node.format.long, this.timeOf(index, node));
        };

        this.playinfo = function (index) {
          let node = this.nodeOf(index), option = node.layer.configure;
          let offset = option.showOffset || 0, time = this.timeOf(index, node) + offset;
          if (!option.timeType) {
            return { label: node.layer.label, time: message.format(node.format.play, time) }
          }
          let now = getSystemTime(), next = moment(time).add(node.step, node.symbol).valueOf();
          if (option.timeType === 1 && index === node.range[1] - 1) {
            if (time > now || moment.range(time, now).diff(node.symbol) === 0) {
              time = moment(time).add(-node.step, node.symbol).valueOf();
            }
            next = Math.min(now, next);
          }
          let times = [time, next];
          if (option.timeType === 2) {
            times.insert(moment(time).add(-node.step, node.symbol).valueOf());
            times.pop();
          }
          return { label: node.layer.label, time: message.format(node.format.play, ...times) };
        };

        this.timeOf = function (index, node) {
          if (node == null) node = this.nodeOf(index);
          return moment(node.times[0]).add((index - node.range[0]) * node.step, node.symbol).valueOf();
        }

        this.dispose = function () {
          this.nodes.clear();
        };

        this.compute = function () {
          this.nodes = playable.nodes.map(e => this.process(e));
        };

        this.update = function (time) {
          this.nodes.forEach(e => {
            e.times[0] = time;
            e.times[1] = moment(time).add((e.count - 1) * e.step, e.symbol).valueOf();
          });
        }
      }

      function CompositeProvider(playable) {
        IntervalProvider.call(this, playable);

        this.get = function (index) {
          return new GroupLayer({
            visibilityMode: "inherited",
            layers: this.itemsOf(index).map((e, i) => {
              let decoder = Decoder[e.changeflag];
              if (decoder) decoder(e);
              let factory = Factory[e.service.toUpperCase()];
              return factory(e, `${index}.${i}`, e.configure.opacity || 1);
            })
          });
        };

        this.itemsOf = function (index) {
          let node = this.nodeOf(index), time = this.timeOf(index, node);
          let times = [time, moment(time).add(node.step, node.symbol).valueOf()];
          return node.layer.items.map(e => Object.assigns({}, e, { times }));
        }
      }

      function NodeProvider(playable) {
        IntervalProvider.call(this, playable);

        this.countOf = function () {
          return 1;
        }

        this.timeOf = function (index, node) {
          if (node == null) node = this.nodeOf(index);
          return moment(node.times[0]).valueOf();
        }

        this.nearest = function (time, amend) {
          if (amend === false) {
            if (time < this.nodes[0].times[0] || time > this.nodes.last.times[1]) {
              return -1;
            }
          }
          let index = -1, diff = time;
          Object.each(this.nodes, (e, i) => {
            let value = Math.abs(e.times[0] - time);
            if (value < diff) {
              diff = value;
              index = i;
            }
          }, this);
          return index;
        }
      }

      function XUNProvider(playable) {
        IntervalProvider.call(this, playable);

        this.names = ["上旬", "中旬", "下旬"];
        this.nodes = [];
        this.split = [];

        this.count = function () {
          return this.nodes.length;
        };

        this.compute = function () {
          playable.nodes.forEach((e, i) => {
            this.split.push(this.nodes.length);
            if (i > 0) {
              e.starttime = this.niceStep(playable.nodes[i - 1].endtime, e.starttime);
            }
            this.process(e);
          });
          this.split.push(this.nodes.length);
        };

        this.sections = function () {
          return playable.nodes.map((e, i) => ({
            min: Math.max(this.split[i] - 1, 0),
            max: this.split[i + 1],
            color: e.configure.color
          }));
        };

        this.label = function (index) {
          let node = this.nodes[index];
          return message.format(node.format.short, node.times[0], this.names[node.times[2]]).replace("&", "\n");
        };

        this.tooltip = function (index) {
          let node = this.nodes[index];
          return message.format(node.format.long, node.times[0], this.names[node.times[2]]);
        };

        this.playinfo = function (index) {
          let node = this.decode(index);
          return {
            label: node.label,
            time: message.format(node.format.play, node.times[0], this.names[node.times[2]])
          };
        };

        this.dispose = function () {
          this.nodes.clear();
        };

        this.process = function (layer) {
          this.month(layer, moment(layer.starttime), this.nodes, false);
          let start = moment(layer.starttime).add(1, "months").set("date", 1);
          let end = moment(layer.endtime).add(-1, "months").set("date", 1);
          Array.from(moment.range(start, end).by("month")).forEach(e => this.month(layer, e, this.nodes, false));
          this.month(layer, moment(layer.endtime), this.nodes, true);
        }

        this.niceStep = function (endTime, startTime) {
          let end = moment(endTime), start = moment(startTime);
          if (moment.range(end, start).diff("month") > 1) return start.valueOf();
          let endDay = end.date(), startDay = start.date();
          if ((startDay - endDay) / 10 >= 1) return start.valueOf();
          let day = (Math.floor(startDay / 10) + 1) * 10 + 1, month = start.month();
          if (day > 30) {
            month++ , day = 1;
          }
          return moment([start.year(), month, day]).valueOf();
        }

        /**
         * Compute the xun date in one month.
         * @param layer History or future.
         * @param date {Object} The date in month.
         * @param buf {Array} Accept the xun data.
         * @param ended {boolean} Specify the date is end date or not.
         */
        this.month = function (layer, date, buf, ended) {
          let year = date.year(), month = date.month(), day = date.date(), days = date.daysInMonth();
          let quotient = Math.min(Math.floor(day / 10), 2);
          let s = ended ? 0 : quotient, e = ended ? quotient : 2;
          for (let i = s; i <= e; i++) {
            let start = moment([year, month, i * 10 + 1]);
            let end = moment([year, month, i === 2 ? days : (i + 1) * 10]);
            buf.push(this.make(layer, i, start.valueOf(), end.valueOf()));
          }
        }

        this.nearest = function (time, amend = true) {
          if (amend === false) {
            if (time < this.nodes.first.times[0] || time > this.nodes.last.times[1]) return -1;
          }
          time = moment(time).hour(0).minute(0).second(0).millisecond(0).valueOf();
          for (let i = this.nodes.length - 1; i >= 0; i--) {
            let t = this.nodes[i].times;
            if (time >= t[0] && time <= t[1]) {
              return i;
            }
          }
          return (time < this.nodes[0].times[0]) ? 0 : this.count() - 1;
        };

        this.make = function (node, part, start, end) {
          return Object.assigns({}, node, {
            times: [start, end, part],
            viewparams: { viewparams: "datatime:" + moment(start).format("YYYYMM") + part }
          });
        }

        this.timeOf = function (index) {
          return this.nodes[index].times[0];
        }

        this.decode = function (index) {
          return this.nodes[index];
        }
      }

      function WeatherProvider() {
        Provider.call(this);
        this.status = "fetched";
        this.name = "weather";
        this.labels = ["今天", "明天", "后天", "{0,mt,M月D日}"];
        this.nodes = function () {
          let time = moment(getSystemTime());
          return [0, 1, 2, 3].map(e => moment(time).add(e, "day"));
        }.call(this);

        this.init = function () {
          if (weatherLayers.length < 4) {
            layer.msg("天气正在加载中，请稍后再试！");
            return null;
          }
          return this.rangeOf(vm.time, true);
        };

        this.count = function () {
          if (weatherLayers.length < 4) return 0;
          return this.nodes.length;
        };

        this.option = function () {
          return { opacity: 1, transaction: false };
        };

        this.sections = function () {
          return [
            {
              min: 0, max: 1, color: "#333"
            },
            {
              min: 0, max: 4, color: "#129FD6"
            }
          ];
        }

        this.rangeOf = function (time, amend) {
          if (amend === false) {
            if (time < this.nodes[0] || time > this.nodes.last) return -1;
          }
          let index = 0, diff = time, start = moment(this.nodes[0]);
          for (let i = 0; i < 4; i++) {
            let value = Math.abs(time - start.valueOf());
            if (value < diff) {
              diff = value;
              index = i;
            }
            start.add(1, "day");
          }
          return [0, this.nodes.length, index];
        };

        this.get = function (index) {
          return weatherLayers[index];
        };

        this.decode = function (index) {
          return {
            times: [this.nodes[index]],
            stepSize: 1,
            stepUnit: "day"
          };
        };

        this.label = function (index) {
          return message.format(this.labels[index], this.nodes[index]);
        };

        this.tooltip = function (index) {
          return message.format("{mt,YYYY年M月D日}", this.nodes[index]);
        };

        this.playinfo = function (index) {
          return { label: "天气预报", time: this.tooltip(index) };
        };

        this.dispose = function () {
          hideWeatherLayer();
        }
      }

      const Decoder = {
        "1"(node) {
          let utc = node.times[0] + node.offset;
          node.viewparams.time = moment(utc).format(node.formattime);
          return node;
        },
        "11"(node) {
          let utc = node.times[0], offset = node.offset, now = moment(getSystemTime());
          if (moment.range(utc, now).diff("day") === 0) {
            let nine = moment([now.year(), now.month(), now.date(), 9]).valueOf();
            if (now < nine) offset = 0;
          }
          node.viewparams.time = moment(utc + offset).format(node.formattime);
          return node;
        },
        "2"(node) {
          let time = moment(moment(node.times[0]).format(node.configure.time)).valueOf();
          node.viewparams = { viewparams: "pubts:" + (time + node.offset) / 1000 };
          return node;
        },
        "3"(node) {
          node.layers += moment(node.times[0]).format(node.formattime);
          return node;
        },
        "4"(node) {
          node.viewparams.dim_batch = moment(node.times[0] + node.offset).format("YYYYMMDDHH00");
          node.viewparams.time = moment(node.times[0] + node.offset).format(node.formattime);
          return node;
        },
        "5"(node) {
          node.viewparams = { viewparams: "datatime:" + moment(node.times[0]).format(node.formattime) };
          return node;
        },
        "6"(node) {
          node.viewparams = { viewparams: "dt:" + (node.times[0] + node.offset) / 1000 };
          return node;
        },
        "7"(node) {
          node.viewparams.DTIME = (node.times[0] + node.offset) / 1000;
          return node;
        },
        "8"(node) {
          let date = moment(node.times[0]);
          node.viewparams = { viewparams: "datatime:" + date.format(node.formattime) + Math.floor(date.date() / 10) };
          return node;
        },
        "9"(node) {
          node.viewparams.time = moment(node.times[0]).format(node.formattime);
          return node;
        },
      }

      const prefix = "play.layer:";
      const Factory = {
        "WMS"(option, id, opacity = 0) {
          return new StatusableWMSLayer({
            id: prefix + id,
            url: option.url,
            sublayers: [{
              name: option.layers
            }],
            fullExtent: {
              xmin: option.minx,
              xmax: option.maxx,
              ymin: option.miny,
              ymax: option.maxy,
            },
            customLayerParameters: option.viewparams,
            spatialReference: 4326,
            opacity: opacity,
            visible: true
          });
        }
      }

      const ProviderFactory = {
        default(playable) {
          return new IntervalProvider(playable);
        },
        xun(playable) {
          return new XUNProvider(playable);
        },
        weather(playable) {
          return new WeatherProvider(playable);
        },
        composite(playable) {
          return new CompositeProvider(playable);
        },
        node(playable) {
          return new NodeProvider(playable);
        }
      }
    });
  </script>
</div>

  <div id="search-close" class="search-close" title="清除搜索点">
  <img src="./防汛抗旱态势分析系统_files/clear.png">
</div>
<div id="space-tool-switch" class="3d/2d">
  <img src="./防汛抗旱态势分析系统_files/3D.png" class="" title="2D/3D切换">
</div>
<div id="space-tool-screenshot" class="screenshot" style="display: none;">
  <!-- <img src="/images/main/screenshot.png" title="生成快照"> -->
  <i class="fa fa-camera" aria-hidden="true" title="生成快照"></i>
</div>
<div id="space-tool-init" title="重置地图视角">
  <img src="./防汛抗旱态势分析系统_files/compass.png" class="">
</div>
<div id="spacetoolbar">
  <div class="spacetoolbar-box">
    <div class="spacetoolbar-tools" style="right: 30px;">
      <div id="frame-selection-init" class="spacetoolbar-child" title="河网查询">
        <img src="./防汛抗旱态势分析系统_files/frame-selection.png" class="">
      </div>
      <div id="space-tool-zoom-in" class="spacetoolbar-child" title="放大图层">
        <img src="./防汛抗旱态势分析系统_files/zoom-out.png" class="">
      </div>
      <div id="space-tool-zoom-out" class="spacetoolbar-child" title="缩小图层">
        <img src="./防汛抗旱态势分析系统_files/zoom-in.png" class="">
      </div>
      <div class="spacetoolbar-child" id="xzqPointButton" title="行政区分析">
        <img src="./防汛抗旱态势分析系统_files/district.png" class="">
      </div>
      <div class="spacetoolbar-child" id="xzqPolygonButton" title="流域分析">
        <img src="./防汛抗旱态势分析系统_files/watershed.png" class="">
      </div>
      <div class="spacetoolbar-child" id="pointButton" title="点空间分析">
        <img src="./防汛抗旱态势分析系统_files/point-analysis.png" class="">
      </div>
      <div class="spacetoolbar-child active" id="polygonButton" title="面空间分析1">
        <img src="./防汛抗旱态势分析系统_files/area-analysis.png" class="">
      </div>
      <div class="spacetoolbar-child" id="addpointBtn" title="点选分析周边预警点">
        <img src="./防汛抗旱态势分析系统_files/addpoint.png" class="">
      </div>
      <div class="spacetoolbar-child" id="addPointMarker" title="地图标记">
        <img src="./防汛抗旱态势分析系统_files/mapMarker.png" class="" height="25px" width="25px" style="object-fit: contain">
      </div>
      <div class="spacetoolbar-child" id="resetBtn" title="清除图层">
        <img src="./防汛抗旱态势分析系统_files/clear.png" class="">
      </div>
    </div>
    <div id="spacetoolbar-icon" class="spacetoolbar-icon">
      <img src="./防汛抗旱态势分析系统_files/spacetool-icon-checked.png" class="">
    </div>
  </div>
</div>

<div id="maplayer-switch">
  <div class="maplayer-switch-box">
    <div class="maplayer-switch-item-main">
      <div class="maplayer-switch-item">
        <img src="./防汛抗旱态势分析系统_files/google-have.png" class="view-thumb-img" title="谷歌影像图">
      </div>
      <div class="maplayer-switch-item">
        <img src="./防汛抗旱态势分析系统_files/google-no.png" class="view-thumb-img" title="谷歌底图(无影像)">
      </div>
      <div class="maplayer-switch-item">
        <img src="./防汛抗旱态势分析系统_files/gaode-have.png" class="view-thumb-img" title="高德影像图">
      </div>
      <div class="maplayer-switch-item">
        <img src="./防汛抗旱态势分析系统_files/gaode-no.png" class="view-thumb-img" title="高德底图(无影像)">
      </div>
      <div class="maplayer-switch-item">
        <img src="./防汛抗旱态势分析系统_files/td-have.png" class="view-thumb-img" title="天地图影像">
      </div>
    </div>
  </div>

  <div class="maplayer-switch-control" id="maplayer-switch-control">
    <img src="./防汛抗旱态势分析系统_files/google-have.png" class="view-thumb-img">
  </div>
</div>


<div id="mapMarker-list">
  <div class="mapMarker-header">
    <div class="mapMarker-header-icon"></div>
    <div class="mapMarker-header-item" style="padding-left: 14px;">标记点名称</div>
    <div class="mapMarker-header-item">经度</div>
    <div class="mapMarker-header-item" style="position: relative;">纬度<span style="position: absolute;right:5px;cursor:pointer" title="关闭标记点" onclick="clearAllMapMarker(this)"><i class="fa fa-close"></i></span></div>
  </div>
  <div class="mapMarker-content">

  </div>
</div>
<div id="webScreenshotBox">
  <div id="closeScreenshot" class="closeScreenshot" title="关闭">
    <i class="fa fa-close fa-2x" aria-hidden="true"></i>
  </div>
  <div id="webScreenshot" class="webScreenshot" title="下载快照"></div>
</div>
<script>
  var mapMarkerFunc = false; //是否启用 地图标记  功能
  var isTianDitu = false; //是否启用天地图
  $(function () {
    //影像图
    var ismaplayerClick = false;
    $("#addPointMarker").unbind("click").bind("click", function () {
      $(".mapMarker-header").show();
      if (mapMarkerFunc) {
        mapMarkerFunc = false;
        layer.msg("关闭地图标记");
        $("#mapMarker-list").css({
          'right': '-500px'
        });
        clearAllMapMarker();
        $(this).css({
          "background": "#fff"
        });
      } else {
        mapMarkerFunc = true;
        layer.msg("启用地图标记")
        $("#mapMarker-list").css({
          'right': '10px'
        });
        $(this).css({
          "background": "#0079c1"
        })
      }
    })
    $("#maplayer-switch-control").unbind("click").bind("click", function () {
      if (!ismaplayerClick) {
        $("#maplayer-switch .maplayer-switch-item-main").css({
          "right": "65px"
        })
        ismaplayerClick = true;
      } else {
        $("#maplayer-switch .maplayer-switch-item-main").css({
          "right": "-345px"
        })
        ismaplayerClick = false;
      }
    });

    $(".maplayer-switch-item").unbind("cilick").bind("click", function () {
      if (!ismaplayerClick) {
        $("#maplayer-switch .maplayer-switch-item-main").css({
          "right": "65px"
        })
        ismaplayerClick = true;
      } else {
        $("#maplayer-switch .maplayer-switch-item-main").css({
          "right": "-345px"
        })
        ismaplayerClick = false;
      };
      const index = $(".maplayer-switch-item").index(this);
      switchBaseMap(index);
    })

    //缩放
    var initzoom = 3;
    $("#space-tool-zoom-in").unbind("click").bind("click", function () {
      if (initzoom <= 18) {
        initzoom++;
        view.zoom = initzoom;
      } else {
        initzoom = 18;
      }
    })
    $("#space-tool-zoom-out").unbind("click").bind("click", function () {
      if (initzoom >= 3) {
        initzoom--;
        view.zoom = initzoom;
      } else {
        initzoom = 3;
      }
    })

    $("#space-tool-init").unbind("click").bind("click", function () {
      getUserRegion();
    })

    note.on("map.ready", () => {
      init3Dor2D();
    })

    if (THREE_DIMENSION_SUPPORT === false) {
      $("#space-tool-switch").css("display", "none");
    } else {
      $("#space-tool-switch").unbind("click").bind("click", function () {
        dimensionSwitch((dimension === "3D" ? dimension = "2D" : dimension = "3D")).then((dimension) => {
          note.notify("layer.terrainTo3D");
          if (dimension == "3D") {
            getUserRegion()
            $("#space-tool-switch img").attr("src", `/images/main/3D.png`);
            $("#space-tool-screenshot").hide();
          } else {
            goInitView();
            $("#space-tool-switch img").attr("src", `/images/main/2D.png`);
            $("#space-tool-screenshot").show();
          }
        });
      })
    }

    $('#space-tool-screenshot').on('click', function () {
      html2canvas(document.body, {
        useCORS: true, //允许跨域
        allowTaint: false, //允许跨域数据污染'被污染'的canvas
        foreignObjectRendering: true, //在浏览器支持的情况下使用ForeignObject模式渲染图片
        taintTest: true,
        scale: 1, //比例，越大分辨率越高，图片越小
        onrendered: function (canvas) {
          downloadFile('防汛抗旱态势分析系统快照.png', canvas.toDataURL('image/png'));

          // $("#webScreenshot").empty().append(canvas).unbind().on('click', function () {
          //   downloadFile('防汛抗旱态势分析系统快照.png', canvas.toDataURL('image/png'));
          //   $("#webScreenshotBox").animate({
          //     height: 'hide',
          //     width: 'hide',
          //   })
          // });
          // $("#webScreenshotBox").animate({
          //   height: 'show',
          //   width: 'show'
          // })
        }
      });
    })

    // $('#closeScreenshot').on('click', function () {
    //   $("#webScreenshotBox").animate({
    //     height: 'hide',
    //     width: 'hide',
    //   })
    // })
  })

  function downloadFile(fileName, content) {

    var aLink = document.createElement('a');
    var blob = base64Img2Blob(content); //new Blob([content]);
    aLink.download = fileName;
    aLink.href = URL.createObjectURL(blob);

    document.body.appendChild(aLink);
    aLink.click();
    aLink.remove(); // 下载之后把创建的元素删除
  }

  function base64Img2Blob(code) {
    var parts = code.split(';base64,');
    var contentType = parts[0].split(':')[1];
    var raw = window.atob(parts[1]);
    var rawLength = raw.length;

    var uInt8Array = new Uint8Array(rawLength);

    for (var i = 0; i < rawLength; ++i) {
      uInt8Array[i] = raw.charCodeAt(i);
    }

    return new Blob([uInt8Array], {
      type: contentType
    });
  }

  function init3Dor2D() {
    if (dimension == "2D") {
      $("#space-tool-switch img").attr("src", `/images/main/2D.png`);
      $("#space-tool-screenshot").show();
    } else {
      $("#space-tool-switch img").attr("src", `/images/main/3D.png`);
      $("#space-tool-screenshot").hide();
    }
  }

  function switchBaseMap(index) {
    require([
      "esri/Map",
      "myMap/layer/GoogleImageLayerBaseMap", //引用自定义谷歌影像图
      "myMap/layer/GoogleNoImageLayerBaseMap",
      "myMap/layer/GaodeImageLayerBaseMap", //引用自定义高德影像图
      "myMap/layer/GaodeNoImageLayerBaseMap",
      "myMap/layer/GoogleAnnoLayer", //引用自定义谷歌地图标注
      "myMap/layer/TianDiBaseMapLayer", //引用自定义天地图影像图
      "myMap/layer/TianDiTuImageLayerBaseMap2D", //引用自定义天地图影像图2D使用
    ], function (Map, GoogleImageLayerBaseMap, GoogleNoImageLayerBaseMap, GaodeImageLayerBaseMap,
      GaodeNoImageLayerBaseMap, GoogleAnnoLayer, TianDiBaseMapLayer, TianDiTuImageLayerBaseMap2D
    ) {
      let text;
      isRiverEvo = true;
      delMapLayersById('GoogleAnnoLayer');

      if (dimension == '2D') {
        let isTDMap = (index == 4);
        dimensionSwitch((isTDMap ? dimension = "2D" : dimension)).then(() => {
          if (isTDMap) {
            note.notify("layer.terrainTo3D");
          } else {
          }
        });
      }

      switch (index) {
        case 0:
          text = `<img src="/images/map/google-have.png" class="view-thumb-img">`;
          var GoogleImageLayerBaseMap = new GoogleImageLayerBaseMap({});
          map.basemap = GoogleImageLayerBaseMap;
          break;
        case 1:
          text = `<img src="/images/map/google-no.png" class="view-thumb-img">`;
          var GoogleNoImageLayerBaseMap = new GoogleNoImageLayerBaseMap({
            index: 1
          });
          map.basemap = GoogleNoImageLayerBaseMap;
          break;
        case 2:
          text = `<img src="/images/map/gaode-have.png" class="view-thumb-img">`;
          var GaodeImageLayerBaseMap = new GaodeImageLayerBaseMap({
            index: 2
          });
          map.basemap = GaodeImageLayerBaseMap;
          break;
        case 3:
          text = `<img src="/images/map/gaode-no.png" class="view-thumb-img">`;
          var GaodeNoImageLayerBaseMap = new GaodeNoImageLayerBaseMap({
            index: 3
          });
          map.basemap = GaodeNoImageLayerBaseMap;
          break;
        case 4:
          text = `<img src="/images/map/td-have.png" class="view-thumb-img">`;
          var tian = new TianDiBaseMapLayer();
          if (dimension == '2D') {
            var tianTemp = new TianDiTuImageLayerBaseMap2D({
              index: 1
            });
            tian = tianTemp;
          }
          map.basemap = tian;
          isTianDitu = true;
          break;
      }

      window.basemap = map.basemap;
      note.notify("layer.terrainTo3D");
      loadOtherBasicLayer(); //将清除掉的基础图层添加上
      $('#maplayer-switch-control').empty().append(text);
    })
  }


  function delMapLayersById(id) {
    let layer = map.allLayers.find((item) => item.id === id);
    if (layer) {
      map.layers.remove(layer);
    }
  }

  function loadOtherBasicLayer() {
    let body = {
      interface: "com.ec.ws.service.def.xyyj.LayerManagerV1Service",
      method: "getBaseLayerVoList",
      args: [isLan]
    };
    ajaxCallJson(body, "/rpc", ({
      data
    }) => {
      data.baselayer.forEach(e => e.checked && layerChecked(e, true))
    });
  }

  function layerChecked(layer, checked, outer) {
    layer.checked = checked;
    checked ? note.notify("layer.add", layer) : note.notify("layer.remove", layer.id);
  }
</script>

<!-- <style>
    #clickTest {
        position: fixed;
        bottom: 0;
        left: 60%;
        z-index: 1000;
        color: #fff;
    }
</style>
<div id="clickTest">
    <div onclick="addQiang()">添加抢险</div>
</div> -->

  <div id="navFooter" class="footer h-box-vc">
  <div id="footer-main" class="footer-box full h-box vc between"><div class="module subject-layers footer-layer-list h-box-vc"><div class="layers v-box"><div class="container"><div class="layer-box"><div class="background"><div class="t i"></div> <div class="m i"></div> <div class="b i"></div></div> <div class="list"></div></div></div></div></div> <div class="footer-item h-box west"></div> <div class="footer-item h-box-cc" style="margin-bottom: 5px;"></div> <div class="footer-item lonlatBox h-box west"></div> <div class="footer-item h-box east" style="margin-right: 100px;"></div></div>
  <script type="text/javascript">
    $(function () {
      const DOC_TYPE = {
        default: {
          heading: 3,
          tilt: 32
        },
        Area: {
          label: "行政区域",
          height: 20000,
        },
        Rsvr: {
          label: "水库",
          height: 10000,
        },
        River: {
          label: "河流",
          height: 20000,
        },
      };
      var vm = new Vue({
        el: "#footer-main",
        data: {
          levels: ["红色预警", "橙色预警", "黄色预警", "蓝色预警", "绿色预警"],
          warnings: [],
          calendar: Date.now(),
          basic: {
            name: "基础图层",
            visible: false,
            layers: [],
            inner: []
          },
          layers: {
            visible: false,
          },
          subject: {
            name: "专题图层",
            visible: false,
            layers: []
          },
          legend: {
            visible: false,
            image: ""
          },
          systemTime: "不可用",
          adnm: "",
          lastSubject: null,
          search: {
            placeholder: "请输入关键字...",
            selected: null,
            show: false,
            items: []
          },
          user: {
            show: false
          },
          dataListArray: [],
        },
        mounted() {
          note.on("flood.analysis", (event, data) => this.onFloodAnalysis(data));
          note.on("flood.back", () => {
            this.subject = this.lastSubject;
            this.basic.visible = false;
            this.subject.visible = false;
          });
          this.adnm = adnm;
        },
        methods: {
          loadBasic() {
            let body = {
              interface: "com.ec.ws.service.def.xyyj.LayerManagerService",
              method: "getBaseLayerList",
              args: []
            };
            ajaxCallJson(body, "/rpc", ({ data }) => {
              this.basic.layers = data || [];
              this.basic.layers.forEach(e => e.checked && this.onLayerChecked(e, true));
            });
          },
          loadWarnings(time) {
            if (time == "000") {
              this.subject.visible = false;
            } else {
              this.calendar = time;
              let body = {
                interface: "com.ec.ws.service.def.rwdb.RealCountService",
                method: "countRealData",
                args: [user.userId,
                moment(time).format("YYYY-MM-DD 00:00:00"),
                moment(time + 24 * 3600 * 1000).format("YYYY-MM-DD 00:00:00"),
                ]
              };
              ajaxCallJson(body, "/rpc", ({ data }) => {
                this.warnings = data;
                // this.subject.layers.forEach(e => {
                //     let item = data.find(x => x.motype === e.code);
                //     e.warningCount = item && item.count;
                //     e.warningLevel = item && item.wlevel;
                // });
              });
            }
          },
          switchBasicLayers(ids, checked) {
            Array.ensure(ids).filter(a => checked ? true : !this.basic.inner.find(b => a === b))
              .forEach(c => {
                let layer = this.basic.layers.find(d => d.id === c);
                if (layer && (layer.checked !== checked)) {
                  this.onLayerChecked(layer, checked, true);
                }
              });
          },
          switchSubjectLayers(ids, checked) {
            Array.ensure(ids).forEach(c => {
              let layer = this.subject.layers.find(function (d) {
                return d.code === c
              });
              if (layer && (layer.checked !== checked)) {
                this.onLayerChecked(layer, checked, true);
              }
            });
          },
          onLayerChecked(layer, checked, outer) {
            layer.checked = checked;
            checked ? note.notify("layer.add", layer) : note.notify("layer.remove", layer.id);
            if (!outer) {
              this.basic.inner.switch(layer.id, checked);
            }
          },
          onSubjectStationChecked(station) {
            if (station.type === "ymfx") {
              if (station.checked) {
                return
              }
              station.checked = !station.checked;
              this.subject.layers.forEach(e => {
                if (e.code !== station.code) {
                  e.checked = false;
                }
              })
              this.onFloodChange(station);
            } else {
              station.checked = !station.checked;
              note.notify("subject.station.checked", station.checked, station);
            }
          },
          onSubjectLayerLoaded(data) {
            let body = {
              interface: "com.ec.ws.service.def.xyyj.LayerManagerV1Service",
              method: "getBaseLayerVoList",
              args: [isLan]
            };
            note.on("map.ready", (event, checked, station) => {
              ajaxCallJson(body, "/rpc", ({ data }) => {
                this.subject.layers.forEach(e => {
                  if (e.checked) {
                    note.notify("layer.remove", e.id);
                    note.notify("subject.station.checked", false, e);
                  }
                });
                data.stations.forEach(e => {
                  if (e.checked) {
                    note.notify("layer.add", e);
                    note.notify("subject.station.checked", true, e);
                  }
                  e.warningCount = e.warningCount || 0;
                });
                this.subject.layers = data.stations;
                this.loadWarnings(this.calendar);
              });
            })
          },
          onFloodAnalysis(data) {
            this.lastSubject = Object.assigns({}, this.subject);
            let iLayers = [];
            data && data.forEach((item) => {
              if (item.stcd == "520112000000000") {
                item.remark = "溃坝洪水";
              }
              let param = {
                id: item.stcd,
                checked: item.checked,
                code: item.code,
                label: item.remark,
                bindingflag: item.bindingflag,
                warningCount: 0,
                type: "ymfx"
              };
              if (item.checked) {
                this.onFloodChange(param);
                note.notify("box.hide");
              }
              iLayers.push(param);
            })
            this.subject.layers = iLayers;
            this.layers.visible = false;
            this.initShowLayer();
          },
          onFloodChange(item) {
            floodIndex = layer.load(2, { time: 10 * 1000, shade: [0.2, '#393D49'] });
            let body = {
              interface: "com.ec.ws.service.def.monitoring.MonitorObjectService",
              method: "findModelWaters",
              args: [item.id, item.code]
            };
            ajaxCallJson(body, "/rpc", ({ data }) => {
              if (data) {
                loadFloodModel(data, 1);
              } else {
                onFloodAnalysisBack();
                layer.msg("暂无该地区淹没分析图层数据...");
              }
            });
          },
          onLayerSwitch() {
            this.subject.visible = !this.subject.visible;
            this.basic.visible = !this.basic.visible;
          },
          initShowLayer() {
            if (this.layers.visible) {
              this.layers.visible = false;
              this.subject.visible = false;
              this.basic.visible = false;
            } else {
              this.layers.visible = true;
              this.subject.visible = true;
              this.basic.visible = false;
            }
          },
          loadSubjectData(subject) {
            note.notify("subject.data.load", subject);
            // if (!subject.checked) this.onSubjectStationChecked(subject);
          },
          loadSubjectData_Immediate(subject) {
            note.notify("subject.data.Immediate", subject);
          },
          onSearch(keyword, fetch) {
            if (!keyword) return;
            const body = {
              interface: "com.eastcentury.enode.service.SearchService",
              method: "doSearch",
              args: [keyword || ""],
            };
            ajaxCallJson(body, "/rpc", (data) => fetch(data.data), () => fetch([]));
          },
          onSearchSelected(item) {
            let wkt = item.archive.wkt;
            if (wkt) {
              let doc = DOC_TYPE[item.archive.docType];
              let point = WKTUtil.read(wkt).map(e => parseFloat(e));
              let target = Object.assign({
                position: {
                  x: point[0],
                  y: point[1],
                  z: doc.height
                }
              }, doc.camera || DOC_TYPE.default);
              view.goTo(target, { duration: 2000, easing: "linear" });
            }
          },
          loginOut() {
            window.location.href = 'login/logout';
          }
        },
        filters: {
          docType(type) {
            let doc = DOC_TYPE[type];
            return doc && doc.label;
          }
        }
      });
      // setInterval(() => {
      //   vm.systemTime = moment(getSystemTime()).format("YYYY-MM-DD HH:mm:ss")
      // }, 1000)
    });
  </script>
</div>
  <!-- <link rel="stylesheet" href="css/monitor/monitor-detail.css"> -->

<div id="monitor-detail">
    <div class="monitor-detail-container">
        <div class="pull-right monitor-detail-tool">
            <!--<span class="window-close"  id="p_hidden"></span>-->
            <!--<span><img src="images/close.png" id="p_hidden"></span>-->
        </div>
        <div class="monitor-detail-header">
            <div class="monitor-detail-title"></div>
        </div>
        <div class="bottom-window-line"></div>
        <br>
        <div id="monitor-detail-content">
            <ul>
                <li id="detail-one">
                    <div class="title"></div>
                    <div class="content-img"><img></div>
                </li>
                <li id="detail-dispatch">
                    <div class="title"></div>
                    <div class="content-img"><img></div>
                </li>
                <li id="detail-real-time">
                    <div class="title"></div>
                    <div class="content-img">
                        <img>
                    </div>
                </li>
                <li id="detail-reservoir-waring">
                    <div class="title"></div>
                    <div class="content-img">
                        <img>
                    </div>
                </li>
                <li id="detail-two">
                    <div class="title"></div>
                    <div class="content-img"><img></div>
                </li>
                <li id="detail-three">
                    <div class="title"></div>
                    <div class="content-img"><img></div>
                </li>
                <li id="detail-four">
                    <div class="title"></div>
                    <div class="content-img"><img></div>
                </li>
                <li id="detail-five">
                    <div class="title"></div>
                    <div class="content-img"><img></div>
                </li>
                <li id="detail-six">
                    <div class="title"></div>
                    <div class="content-img"><img></div>
                </li>
                <li id="detail-video">
                    <div class="title">视频监控</div>
                    <div class="content-img">
                        <img src="./防汛抗旱态势分析系统_files/videos.png" style="width: 180px;height: 120px;border: 1px solid #fff">
                    </div>
                </li>
                <li id="detail-basic">
                    <div class="title"></div>
                    <div class="content-img">
                    </div>
                </li>
                <li id="detail-report">
                    <div class="title"></div>
                    <div class="content-img">
                    </div>
                </li>
                <li id="detail-dam-break">
                    <div class="title"></div>
                    <div class="content-img">
                        <img src="./防汛抗旱态势分析系统_files/station_broken.png" style="width: 150px;height: 105px;">
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>
<div id="monitor-detail-right">
    <div id="monitor-detail-right-content">
        <div id="monitor-detail-right-content-video" style="display: flex;width: 100%;height: 100%;flex-direction:column;">
            <div class="monitor-detail-right-header" style="display: flex;justify-content: center;width: 100%">
                <div class="monitor-detail-right-title" id="show-monitor-detail-right-title" style="width: 50%">图像监控</div>
                <div style="position: absolute;right: 0px" class="monitor-detail-right-button">
                    <div style="cursor: pointer" id="video-max">
                        <span><img src="./防汛抗旱态势分析系统_files/max-window.png"></span>
                    </div>
                    <div style="margin-right: 20px;cursor: pointer" id="p_hidden">
                        <span><img src="./防汛抗旱态势分析系统_files/close.png"></span>
                    </div>
                </div>
            </div>
            <div class="bottom-window-right-line"></div>
            <br>
            <div id="detail-right-one" style="width: 480px;height: 230px;overflow: hidden">
                <div class="content-img"><img></div>
            </div>
        </div>
        <div id="peripheral-information-max" style="display: flex;width: 100%;height: 100%;flex-direction:column;">
            <div class="monitor-detail-right-header" style="margin-top: 10px;display: flex;justify-content: center;width: 100%">
                <div class="monitor-detail-right-title" id="show-two-monitor-detail-right-title"></div>
                <div style="position: absolute;right: 0px">
                    <div style="margin-right: 20px;cursor: pointer" id="peripheral-information">
                        <span><img src="./防汛抗旱态势分析系统_files/max-window.png"></span>
                    </div>
                </div>
            </div>
            <div class="bottom-window-right-two-line" style=""></div>
            <br>
            <div id="detail-right-peripheral">
                <div id="detail-right-peripheral-content" style="width: 100%;height: 100%">

                </div>
                <!--<div class="content-img"><img /></div>-->
            </div>
        </div>
    </div>
</div>
<!-- 中小流域 -->
<div id="monitor-detail-right-warning" style="height:490px;width:490px;">
    <div id="monitor-detail-right-content-warning">
        <div id="early-information" style="display: flex;width: 100%;height: 100%;flex-direction:column;">
            <div class="monitor-detail-right-header" style="margin-top: 10px;display: flex;justify-content: space-between;width: 100%">
                <div class="monitor-detail-right-title">预警<span class="early-warning-box-title-name" style="margin-left: 10px;font-size: 12px;color: #fff;"></span></div>
                <div class="monitor-detail-right-button">
                    <div style="margin-right: 20px;cursor: pointer" id="early-warning-max">
                        <span><img src="./防汛抗旱态势分析系统_files/max-window.png"></span>
                    </div>
                    <div style="margin-right: 20px;cursor: pointer" id="early-warning-close">
                        <span><img src="./防汛抗旱态势分析系统_files/close.png"></span>
                    </div>
                </div>
            </div>
            <div class="bottom-window-right-two-line" style=""></div>
            <div id="detail-right-early">
                <div id="early-warning-mini-chart1" class="early-warning-chart"></div>
                <div id="early-warning-mini-chart2" class="early-warning-chart"></div>
                <div id="early-warning-mini-chart3" class="early-warning-chart"></div>
            </div>
        </div>
        <div id="early-prediction" style="display: flex;width: 100%;height: 100%;flex-direction:column;">
            <div class="monitor-detail-right-header" style="margin-top: 10px;display: flex;justify-content: space-between;width: 100%">
                <div class="monitor-detail-right-title">预报<span class="early-warning-box-title-name" style="margin-left: 10px;font-size: 12px;color: #fff;"></span></div>
                <div style="margin-right: 20px;cursor: pointer" id="early-prediction-max">
                    <span><img src="./防汛抗旱态势分析系统_files/max-window.png"></span>
                </div>
            </div>
            <div class="bottom-window-right-two-line" style=""></div>
            <div id="detail-right-prediction">
                <div id="early-warning-mini-chart4" class="early-warning-chart"></div>
                <div id="early-warning-mini-chart5" class="early-warning-chart"></div>
                <div id="early-warning-mini-chart6" class="early-warning-chart"></div>
            </div>
        </div>
    </div>
</div>

<!-- 滑坡灾害 -->
<div id="monitor-detail-right-hpzh" style="height:490px;width:490px;">
    <div id="monitor-detail-right-content-hpzh">
        <div id="hpzh-information" style="display: flex;width: 100%;height: 100%;flex-direction:column;">
            <div class="monitor-detail-right-header" style="margin-top: 10px;display: flex;justify-content: space-between;width: 100%">
                <div class="monitor-detail-right-title">基本情况<span id="hpzh-box-basic-title-name" class="hpzh-box-title-name" style="margin-left: 10px;font-size: 12px;color: #fff;"></span></div>
                <div class="monitor-detail-right-button">
                    <div style="margin-right: 20px;cursor: pointer" id="hpzh-basic-max">
                        <span><img src="./防汛抗旱态势分析系统_files/max-window.png"></span>
                    </div>
                    <div style="margin-right: 20px;cursor: pointer" id="hpzh-basic-close">
                        <span><img src="./防汛抗旱态势分析系统_files/close.png"></span>
                    </div>
                </div>
            </div>
            <div class="bottom-window-right-two-lines" style="border-top: 2px soli;"></div>
            <div id="detail-right-hpzh">
                <table style="width: 100%;text-align: left;" class="base-">
                    <tbody id="hpzh-basic-mini">

                    </tbody>
                </table>
            </div>
        </div>
        <div id="hpzh-chart" style="display: flex;width: 100%;height: 100%;flex-direction:column;">
            <div class="monitor-detail-right-header" style="margin-top: 10px;display: flex;justify-content: space-between;width: 100%">
                <div class="monitor-detail-right-title">滑坡灾害防治预测<span id="hpzh-box-chart-title-name" class="hpzh-box-title-name" style="margin-left: 10px;font-size: 12px;color: #fff;"></span></div>
                <div style="margin-right: 20px;cursor: pointer" id="hpzh-chart-max">
                    <span><img src="./防汛抗旱态势分析系统_files/max-window.png"></span>
                </div>
            </div>
            <div class="bottom-window-right-two-lines" style="border-top: 2px soli ;"></div>
            <div id="detail-right-hpzh-chart">
                <div id="hpzh-mini-chart1" class="hpzh-mini-chart" style="height:50%;width:100%"></div>
                <div id="hpzh-mini-chart2" class="hpzh-mini-chart" style="height:50%;width:100%"></div>
            </div>
        </div>
    </div>
</div>


<!-- //空间分析 -->
<div id="monitor-detail-right-kjfx" style="height: 490px; width: 490px; display: block;">
    <div id="monitor-detail-right-content-kjfx">
        <div id="kjfx-information" style="display: flex;width: 100%;height: 100%;flex-direction:column;">
            <div class="monitor-detail-right-header" style="margin-top: 10px;display: flex;justify-content: space-between;width: 100%">
                <div class="monitor-detail-right-title">1小时降水预报<span id="kjfx-box-basic-title-name" class="kjfx-box-title-name" style="margin-left: 10px;font-size: 12px;color: #fff;"></span></div>
                <div class="monitor-detail-right-button">
                    <div style="margin-right: 20px;cursor: pointer" id="kjfx-basic-max">
                        <span><img src="./防汛抗旱态势分析系统_files/max-window.png"></span>
                    </div>
                    <div style="margin-right: 20px;cursor: pointer" id="kjfx-basic-close">
                        <span><img src="./防汛抗旱态势分析系统_files/close.png"></span>
                    </div>
                </div>
            </div>
            <div class="bottom-window-right-two-lines" style="border-top: 2px soli;"></div>
            <div id="detail-right-kjfx-chart">
                <div id="kjfx-mini-chart1" class="kjfx-mini-chart1" style="height: 100%; width: 100%; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;" _echarts_instance_="ec_1573354725235"><div style="position: relative; overflow: hidden; width: 470px; height: 202px; padding: 0px; margin: 0px; border-width: 0px; cursor: ew-resize;"><canvas data-zr-dom-id="zr_0" width="470" height="202" style="position: absolute; left: 0px; top: 0px; width: 470px; height: 202px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div style="position: absolute; display: none; border-style: solid; white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s; background-color: rgba(50, 50, 50, 0.7); border-width: 0px; border-color: rgb(51, 51, 51); border-radius: 4px; color: rgb(255, 255, 255); font: 14px/21px &quot;Microsoft YaHei&quot;; padding: 5px; left: 211px; top: 133px; pointer-events: none;">2019-11-12 14:00:00<br>降水(mm):0</div></div>
            </div>
        </div>
        <div id="kjfx-chart" style="display: flex;width: 100%;height: 100%;flex-direction:column;">
            <div class="monitor-detail-right-header" style="margin-top: 10px;display: flex;justify-content: space-between;width: 100%">
                <div class="monitor-detail-right-title">24小时降水预报<span id="kjfx-box-chart-title-name" class="kjfx-box-title-name" style="margin-left: 10px;font-size: 12px;color: #fff;"></span></div>
                <div style="margin-right: 20px;cursor: pointer" id="kjfx-chart-max">
                    <span><img src="./防汛抗旱态势分析系统_files/max-window.png"></span>
                </div>
            </div>
            <div class="bottom-window-right-two-lines" style="border-top: 2px soli ;"></div>
            <div id="detail-right-kjfx-chart">
                <div id="kjfx-mini-chart2" class="kjfx-mini-chart3" style="height: 100%; width: 100%; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;" _echarts_instance_="ec_1573354725236"><div style="position: relative; overflow: hidden; width: 470px; height: 202px; padding: 0px; margin: 0px; border-width: 0px; cursor: default;"><canvas data-zr-dom-id="zr_0" width="470" height="202" style="position: absolute; left: 0px; top: 0px; width: 470px; height: 202px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div style="position: absolute; display: none; border-style: solid; white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s; background-color: rgba(50, 50, 50, 0.7); border-width: 0px; border-color: rgb(51, 51, 51); border-radius: 4px; color: rgb(255, 255, 255); font: 14px/21px &quot;Microsoft YaHei&quot;; padding: 5px; left: 165px; top: 55px; pointer-events: none;">2019-11-12 00:00:00<br>降水(mm):0.3</div></div>
            </div>
        </div>
    </div>
</div>

<div id="map-load-early-warn-right" style="height:300px;width:490px;">
    <div id="map-load-early-warn-right-content">
        <div style="display: flex;width: 100%;height: 100%;flex-direction:column;">
            <div class="monitor-detail-right-header" style="margin-top: 10px;display: flex;justify-content: space-between;width: 100%">
                <div class="monitor-detail-right-title" id="map-load-early-warn-right-content-title">预警分布</div>
                <div class="monitor-detail-right-button">
                    <div style="margin-right: 20px;cursor: pointer" id="map-load-early-close">
                        <span><img src="./防汛抗旱态势分析系统_files/close.png"></span>
                    </div>
                </div>
            </div>
            <div class="bottom-window-right-two-lines" style="border-top: 2px solid #0FF;"></div>
            <div id="map-load-early-warn-content">
                  <div id="early-warning-release-center" style="border-bottom: 1px solid #0FF;margin: 10px 0 0 0 ">
                      <span>预警发布中心:</span>
                  </div>
                  <div id="actual-monitoring-warning" style="border-bottom: 1px solid #0FF;margin: 20px 0 0 0 ">
                      <span>实况监测告警:</span>
                  </div>
                  <div id="actual-monitoring-warning-content" style="border-bottom: 1px solid #0FF;margin: 10px 0 0 0;text-indent: 80px">
                        <div>
                            <span id="actual-monitoring-reservoir" style="cursor: pointer">水库:</span>
                            <span id="actual-monitoring-river" style="margin-left: 30px;cursor: pointer">水文站:</span>
                            <span id="actual-monitoring-rain" style="margin-left: 30px;cursor: pointer">雨量站:</span>
                        </div>
                  </div>
                  <div id="other-early-warning">
                  </div>
            </div>
        </div>
    </div>
</div>
<div style="display: none">
    <div id="peripheral-information-echarts">
        <div id="information-echarts" style="width: 100%;height: 100%;overflow: auto">

        </div>

    </div>

</div>
  <!-- <link href="css/monitor/monitor.css" rel="stylesheet"> -->
<!--监控对象-河道-->
<div style="display: none">
    <div id="monitor-river">
        <div id="forecast-rain" style="overflow: hidden">
            <div id="river-rain-view" flag="chart" class="chart-table">
                <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格">
            </div>
            <div class="export-excel">

            </div>
            <div class="chart-container">
                <div id="forecast-rain-chart">
                </div>
                <div id="forecast-other-chart">
                </div>
            </div>
            <div id="river-rain-table" class="chart-table-container">
            </div>
        </div>
        <div id="cross-sectional">
            <!--<div id="river-rating-curve">-->
            <!--<button onclick="getRiverRatingCurve(this)" flag="image" style="margin-top: 5px">水位流量</button>-->
            <!--<span id="river-rating-view"  flag="chart" style="display: none"><img src="/images/data-table.png"  class='data-table' title="数据表格" ></span>-->
            <!--</div>-->
            <div id="cross-sectional-chart">
            </div>
            <div id="river-rating-chart" style="display: none"></div>
            <div id="river-rating-table" style="display: none;white-space: nowrap">
                <table id="river-rating-table-content"></table>
            </div>
        </div>
        <div id="vertical-sectional">
            <div id="vertical-sectional-chart">
            </div>
        </div>
        <div id="river-video">
            <div class="content"></div>
        </div>
        <div id="river-basic-data">
            <ul class="tabs">

                <li>
                    <a href="http://127.0.0.1:9527/#" name=".river-water-flood">水位流量</a>
                </li>
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".river-basic-document" id="river-basic-document">资料文档</a>
                </li>
                <!--<li>-->
                <!--<a href="#" name=".river-early-warning-setting"  >预警设置</a>-->
                <!--</li>-->
            </ul>
            <div class="tabs-content" style="overflow: hidden">

                <div class="river-water-flood" style="width: 100%;height: 100%;overflow: hidden">
                    <!--<div style="width: 3%;height: 100%;float: right" >-->
                    <!--<div id="river-water-view"  flag="chart" style="z-index: 999"  class="chart-table">-->
                    <!--<img src="/images/data-table.png"  class='data-table' title="数据表格"  style="margin-top: 5px">-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--<div style="width: 95%;height: 100%;float: left;margin-left: 5px;">-->
                    <!--<div id="river-water-flood-chart"> </div>-->
                    <!--<div id="river-water-flood-table" style="display: none">-->
                    <!--</div>-->
                    <!--</div>-->

                    <div id="river-water-view" flag="chart" class="chart-table" style="margin-right: 25px;">
                        <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格">
                    </div>
                    <div class="chart-container" id="river-water-parent-flood-chart" style="margin-top: -20px">
                        <div id="river-water-flood-chart">
                        </div>
                    </div>
                    <div id="river-water-flood-table" class="chart-table-container">
                        <!--<table id="water-depth-table-content"></table>-->
                    </div>

                </div>
                <div class="river-basic-document" style="width: 100%;height: 100%;">
                    <div id="river-basic-document-left" class="common-basic-left">
                    </div>
                    <div class="menu-hidden">
                        <img src="./防汛抗旱态势分析系统_files/back.png" onclick="hideTreeMenu()" class="showImage">
                        <img src="./防汛抗旱态势分析系统_files/back-right.png" onclick="showTreeMenu()" style="display: none" class="hideImage">
                    </div>
                    <div id="river-basic-document-menu" class="common-basic-menu">
                        <ul id="river-basic-document-tree" class="ztree"></ul>
                    </div>
                </div>
                <div class="river-early-warning-setting" style="width: 100%;height: 100%;">

                </div>
            </div>
        </div>
        <div id="river-report">
            <div id="river-report-content" style="position: relative; overflow:hidden;height: 99%;background-color: #fff"></div>
        </div>
    </div>

    <!--监控对象-防洪城镇-->
    <div id="monitor-city">
        <div id="monitor-city-section" style="overflow: hidden">
            <div id="city-rain-view" flag="chart" style="display: none" class="chart-table ">
                <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格">
            </div>
            <div class="export-excel">

            </div>
            <div style="width: 120px;position: absolute;float: left;z-index: 9999999" id="city-section-choose">
            </div>
            <div class="chart-container">
                <div id="city-section-rain-chart">
                </div>
                <div id="city-section-other-chart">
                </div>
            </div>
            <div class="chart-table-container" id="city-section-table">
            </div>
        </div>
        <!--基础资料-->
        <div id="monitor-city-data" style="width: 100%;height: 85%;font-size:  14px">
            <div id="monitor-city-data-top" style="color: #00A8FF">
            </div>
            <div id="monitor-city-data-bottom" style="width: 100%;height:89%">
                <div id="monitor-city-data-left" class="common-basic-left">
                </div>
                <div class="menu-hidden">
                    <img src="./防汛抗旱态势分析系统_files/back.png" onclick="hideTreeMenu()" class="showImage">
                    <img src="./防汛抗旱态势分析系统_files/back-right.png" onclick="showTreeMenu()" style="display: none" class="hideImage">
                </div>
                <div id="monitor-city-data-menu" class="common-basic-menu">
                    <ul id="monitor-city-data-tree" class="ztree"></ul>
                </div>
            </div>

        </div>
        <!--城镇预案-->
        <div id="monitor-city-plan" style="width: 100%;height: 100%">
            <div id="monitor-city-plan-left" class="common-basic-left">
            </div>
            <div class="menu-hidden">
                <img src="./防汛抗旱态势分析系统_files/back.png" onclick="hideTreeMenu()" class="showImage">
                <img src="./防汛抗旱态势分析系统_files/back-right.png" onclick="showTreeMenu()" style="display: none" class="hideImage">
            </div>
            <div id="monitor-city-plan-menu" class="common-basic-menu">
                <ul id="monitor-city-plan-tree" class="ztree"></ul>
            </div>
        </div>
        <!--城镇风险图-->
        <div id="monitor-city-risk">
            <div id="monitor-city-risk-left" class="common-basic-left">
            </div>
            <div class="menu-hidden">
                <img src="./防汛抗旱态势分析系统_files/back.png" onclick="hideTreeMenu()" class="showImage">
                <img src="./防汛抗旱态势分析系统_files/back-right.png" onclick="showTreeMenu()" style="display: none" class="hideImage">
            </div>
            <div id="monitor-city-risk-menu" class="common-basic-menu">
                <ul id="monitor-city-risk-tree" class="ztree"></ul>
            </div>

        </div>
        <div id="monitor-city-video">
            <div class="content"></div>
        </div>
        <div id="city-report">
            <div id="city-report-content" style="position: relative; overflow: hidden;height: 99%;background-color: #fff"></div>
        </div>
    </div>

    <!--监控对象-水库水电站-->
    <div id="monitor-reservoir">
        <div id="reservoir-fore-rain" style="overflow: hidden">
            <div id="reservoir-rain-view" flag="chart" class="chart-table ">
                <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格">
            </div>
            <div class="export-excel">

            </div>
            <div id="reservoir-chart-container" class="chart-container">
                <div id="reservoir-rain-chart">
                </div>
                <div id="reservoir-other-chart">
                </div>
            </div>
            <div id="reservoir-rain-table" style="display: none;white-space: nowrap;margin-top: 42px">
            </div>
        </div>
        <div id="reservoir-dispatch" style="overflow:hidden">
            <div id="reservoir-dispatch-view" flag="chart" class="chart-table" style="right: 100px">
                <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格">
            </div>
            <div class="export-excel" style="right: 35px">

            </div>
            <div class="chart-container">
                <div id="reservoir-dispatch-chart">
                </div>
            </div>
            <div id="reservoir-dispatch-table" class="chart-table-container">
            </div>
        </div>
        <!--水库大坝示意图-->
        <div id="reservoir-dam">
            <ul class="tabs">
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".reservoir-dam-chart-img">水库大坝示意图</a>
                </li>
                <!--<li>-->
                <!--<a href="#" name=".reservoir-daily-news" >日常报讯</a>-->
                <!--</li>-->
            </ul>
            <div style="width: 100%;height: 94%;overflow: hidden">
                <div id="reservoir-dam-chart" class="reservoir-dam-chart-img" style="">
                </div>
                <div class="reservoir-daily-news" id="reservoir-daily-news" style="width: 100%;height: 100%;color: #00A8FF">
                </div>
            </div>
        </div>
        <!--水库预警-->
        <div id="reservoir-monitor-early-warning">
            <div id="reservoir-monitor-early-warning-box" style="overflow: hidden;height:100%;">
                <div class="early-warning-box-main" style="height: calc(100% - 30px);">
                    <div id="reservoir-early-warning-box-main-chart-warning" style="height:100%;">
                        <div id="reservoir-early-warning-chart1" class="early-warning-chart"></div>
                        <div id="reservoir-early-warning-chart2" class="early-warning-chart"></div>
                        <div id="reservoir-early-warning-chart3" class="early-warning-chart"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="reservoir-video">
            <div class="content-img"></div>
        </div>
        <div id="reservoir-basic-data" style="white-space: nowrap">
            <ul class="tabs">
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".reservoir-basic-infor" class="current">基础信息</a>
                </li>
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".reservoir-release-flood">泄洪曲线</a>
                </li>
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".early-warning-setting-basic">水库三类责任人</a>
                </li>
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".reservoir-basic-document">资料文档</a>
                </li>
            </ul>
            <div class="tabs-content">
                <div class="reservoir-basic-infor" style="width:100%;height: 100%;margin-top: -20px">
                    <div id="basic-data-left">
                        <!--<div style="width: 90%;height: 22px;display: block;text-align: right;" id="basic-data-left-one-view">-->
                        <!--<div id="basic-data-left-view"  flag="chart" style="width: 100%;margin-right: 0;cursor: pointer">-->
                        <!--<img src="/images/data-table.png"  class='data-table' title="数据图表">-->
                        <!--</div>-->
                        <!--</div>-->
                        <div style="width: 100%;height:100%;float: left;">
                            <div id="reservoir-data-basic-top" style="">
                                <button id="add-reservoir-data-basic" style="display: inline-block;" onclick="addReservoirBasicContent()">新增</button>
                                <button id="edit-reservoir-data-basic" style="display: inline-block;" onclick="editReservoirBasicContent()">编辑</button>
                                <button id="delete-reservoir-data-basic" style="display: inline-block;" onclick="deleteReservoirBasicContent()">删除</button>
                            </div>
                            <div id="basic-data-left-view" flag="chart" class="chart-table" style="margin-right: 25px;right: 40%">
                                <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格">
                            </div>
                            <div id="basic-data-left-one-chart" style="width: 100%;height: 100%;margin-top: 10px;">
                            </div>
                            <!--<div id="basic-data-left-two-chart" style="width: 95%;height: 95%;display: none"></div>-->
                            <div id="basic-data-left-table" style="width: 100%;height:100%;display: none;margin-top: 55px;">
                                <!--<table id="basic-data-left-table-content"></table>-->
                            </div>
                        </div>
                    </div>
                    <div id="basic-data-right" style="overflow-y: auto;margin-top: 15px;font-size: 14px;">
                    </div>
                </div>
                <!--泄洪曲线-->
                <div class="reservoir-release-flood" style="height: 100%;width: 100%;margin-top:-20px">
                    <div id="release-flood-noData" style="display: none"></div>
                    <div id="reservoir-release-view" flag="chart" class="chart-table" style="right:62px;z-index:999999999">
                        <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格">
                    </div>
                    <div id="reservoir-release-table" style="float: right;margin-right: 10px;z-index:999999999;display: none;cursor: pointer;margin-top: 5px;margin-bottom: 5px">
                        <img src="./防汛抗旱态势分析系统_files/data-chart.png" class="data-table" title="数据图表">
                    </div>
                    <div style="position: absolute;float: left;z-index: 999999999" class="reservoir-release-flood-select select-chart">
                        <div id="reservoir-release-flood-select" style="width: 120px;display: inline-block"></div>
                        <div id="reservoir-release-flood-height" style="width: 120px;display: inline-block;margin-left: 120px"></div>
                    </div>
                    <div class="chart-container"></div>
                    <div id="reservoir-release-flood-chart" style="width:100%;height: 100%">

                    </div>

                    <div id="reservoir-release-flood-table" style="display: none;margin-top: 40px">
                        <div></div>
                    </div>
                </div>
                <!--水库基本资料-->
                <div class="reservoir-basic-document" style="width: 100%;height: 100%">
                    <span style="font-size: 14px;color: #00A8FF;display: none" id="reservoir-basic-document-message">资料文档暂无数据</span>
                    <div id="reservoir-basic-data-document" style="height: 100%;width: 100%">
                        <div id="reservoir-basic-document-left" class="common-basic-left">
                        </div>
                        <div class="menu-hidden" id="reservoir-basic-document-menu-hidden">
                            <img src="./防汛抗旱态势分析系统_files/back.png" onclick="hideTreeMenu()" class="showImage">
                            <img src="./防汛抗旱态势分析系统_files/back-right.png" onclick="showTreeMenu()" style="display: none" class="hideImage">
                        </div>
                        <div id="reservoir-basic-document-menu" class="common-basic-menu">
                            <ul id="reservoir-basic-document-tree" class="ztree"></ul>
                        </div>
                    </div>
                </div>
                <!--水库三类责任人-->
                <div class="early-warning-setting-basic" id="three-responsible-persons" style="">
                    <div id="early-warning-setting-basic-top">
                        <!--<div>职位<input type="text" class="early-warning-setting-basic-duty"></div>-->
                        <!--<div>姓名<input type="text"  class="early-warning-setting-basic-name"></div>-->
                        <!--<div>手机<input type="text"  class="early-warning-setting-basic-phone"></div>-->
                        <!--<button id="select-early-warning-setting-basic" onclick="">查询</button>-->
                        <!--<button id="save-early-warning-setting-basic" class="save-mail" onclick="addEarlyWarningContent()" style="display: none;">确定</button>-->
                        <button id="add-early-warning-setting-basic" style="display: inline-block;" onclick="addEarlyWarningContent()">新增</button>
                        <button id="edit-early-warning-setting-basic" style="display: inline-block;" onclick="editEarlyWarningContent()">编辑</button>
                        <button id="delete-early-warning-setting-basic" style="display: inline-block;" onclick="deleteEarlyWarningContent()">删除</button>
                    </div>
                    <div id="three-responsible-persons-content" style="margin-top: 10px;">

                    </div>
                </div>

            </div>
        </div>
        <div id="reservoir-report">
            <div id="reservoir-report-content" style="position: relative; overflow: hidden;height: 99%;background-color: #fff"></div>
        </div>
        <!--水库溃坝-->
        <div id="reservoir-dam-break">
            <div id="reservoir-dam-break-content" style="position: relative; overflow: hidden;height: 99%;background-color: rgba(77, 80, 86, 0.21)"></div>
        </div>
    </div>

    <!--监控对象-山洪小流域-->
    <div id="monitor-watershed">
        <div id="watershed-rain" style="overflow: hidden">
            <div id="watershed-rain-view" flag="chart" class="chart-table ">
                <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格">
            </div>
            <div class="export-excel">

            </div>
            <div class="chart-container">
                <div id="watershed-rain-chart">
                </div>
                <div id="watershed-other-chart">
                </div>
            </div>
            <div id="watershed-rain-table" class="chart-table-container">
            </div>
        </div>
        <div id="watershed-cross-sectional">
            <div id="watershed-cross-chart">
            </div>
        </div>
        <div id="watershed-vertical-sectional">
            <div id="watershed-vertical-chart">
            </div>
        </div>
        <!--山洪小流域调查图片-->
        <div id="watershed-image" style="width: 100%;height: 99%">
            <div id="watershed-image-left" class="common-basic-left">
            </div>
            <div class="menu-hidden">
                <img src="./防汛抗旱态势分析系统_files/back.png" onclick="hideTreeMenu()" class="showImage">
                <img src="./防汛抗旱态势分析系统_files/back-right.png" onclick="showTreeMenu()" style="display: none" class="hideImage">
            </div>
            <div id="watershed-image-menu" class="common-basic-menu">
                <ul id="watershed-image-tree" class="ztree"></ul>
            </div>
        </div>
        <div id="watershed-video">
        </div>
        <div id="watershed-basic-data">
            <ul class="tabs" style="">
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".watershed-basic-infor" class="current" style="font-size: 12pt">基本特性表</a>
                </li>
                <!--<li>-->
                <!--<a href="#" name=".watershed-water-flood">预警指标成果</a>-->
                <!--</li>-->
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".watershed-basic-document" id="watershed-basic-document" style="font-size: 12pt">资料文档</a>
                </li>
            </ul>
            <div class="tabs-content" style="overflow-y: auto;overflow-x: hidden;margin-top: 5px;">
                <div class="watershed-basic-infor">
                    <div id="watershed-basic-infor-data" style="font-size: 14px;word-break: keep-all;">
                    </div>
                    <div style="border: solid 1px #163174;margin-top: 22px;margin-bottom: 30px">
                    </div>
                    <div id="watershed-basic-warning-indicator" style="margin-top: 5px;font-size: 14px;">
                    </div>
                    <div id="watershed-basic-rainfall-indicator" style="margin-top: 5px;font-size:  14px;">
                    </div>
                </div>
                <!--<div class="watershed-water-flood">-->
                <!--小流域预警指标成果-->
                <!--</div>-->
                <div class="watershed-basic-document" style="height: 100%;width: 100%">
                    <div id="watershed-basic-left" class="common-basic-left">
                    </div>
                    <div class="menu-hidden">
                        <img src="./防汛抗旱态势分析系统_files/back.png" onclick="hideTreeMenu()" class="showImage">
                        <img src="./防汛抗旱态势分析系统_files/back-right.png" onclick="showTreeMenu()" style="display: none" class="hideImage">
                    </div>
                    <div id="reservoir-infor-menu" class="common-basic-menu">
                        <ul id="base-data-tree" class="ztree"></ul>
                    </div>
                </div>
            </div>
        </div>
        <div id="watershed-report">
            <div id="watershed-report-content" style="position: relative; overflow:hidden;height: 99%;background-color: #fff"></div>
        </div>
    </div>

    <!--监控对象-城市易涝点-->
    <div id="monitor-waterlogged">
        <div id="waterlogged-fore-rain" style="overflow: hidden">
            <div id="waterlogged-rain-view" flag="chart" class="chart-table">
                <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格">
            </div>
            <div class="export-excel">

            </div>
            <div class="chart-container">
                <div id="waterlogged-rain-chart">
                </div>
            </div>
            <div id="waterlogged-rain-table" class="chart-table-container">
            </div>
        </div>
        <!--实测水深-->
        <div id="waterlogged-water-depth">
            <div id="water-depth-view" flag="chart" class="chart-table"><img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" title="数据表格"></div>
            <div id="water-depth-chart">
            </div>
            <div id="water-depth-table" style="display: none">
                <!--<table id="water-depth-table-content"></table>-->
            </div>
        </div>
        <!--易涝点调查图片-->
        <div id="waterlogged-image" style="width: 100%;height: 99%">
            <div id="waterlogged-image-left" class="common-basic-left" style="">
            </div>
            <div class="menu-hidden">
                <img src="./防汛抗旱态势分析系统_files/back.png" onclick="hideTreeMenu()" class="showImage">
                <img src="./防汛抗旱态势分析系统_files/back-right.png" onclick="showTreeMenu()" style="display: none" class="hideImage">
            </div>
            <div id="waterlogged-image-menu" class="common-basic-menu">
                <ul id="waterlogged-image-tree" class="ztree"></ul>
            </div>
        </div>
        <!--易涝点基础信息-->
        <div id="waterlogged-basic-data">
            <ul class="tabs" style="">
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".waterlogged-basic-infor" class="current" style="font-size: 12pt">基本信息</a>
                </li>
                <li>
                    <a href="http://127.0.0.1:9527/#" name=".waterlogged-basic-document" style="font-size: 12pt">资料文档</a>
                </li>
            </ul>
            <div class="tabs-content" style="overflow-y: hidden;overflow-x: hidden;margin-top: 5px;">
                <div class="waterlogged-basic-infor" style="height: 100%;width: 100% ">
                    <div id="waterlogged-basic-data-top" style="font-size: 11pt;color: #00AEDB;word-break:keep-all">

                    </div>
                    <div id="waterlogged-basic-data-infor-bottom" style="width: 100%;height: 85%;display: flex;justify-content: space-between;border-top: 1px solid #00AEDB;margin-top: 5px">
                        <div id="waterlogged-basic-data-left-chart">

                        </div>
                        <div style="width: 39%;margin-top: 8px;text-align: center">
                            <span style="color:#fff;font-size: 15px;">时段降雨～积水深度数据表</span>
                            <div id="waterlogged-basic-data-right-table" style="width: 100%;margin-top: 16px;height: 100%">

                            </div>
                        </div>

                    </div>
                </div>
                <div class="waterlogged-basic-document" id="waterlogged-basic-data-bottom" style="height: 100%;width: 100% ">
                    <span style="font-size: 14px;color: #00A8FF;display: none" id="waterlogged-basic-message">资料文档暂无数据</span>
                    <div id="waterlogged-basic-data-document" style="height: 100%;width: 100% ">
                        <div id="waterlogged-basic-data-bottom-left" class="common-basic-left" style="overflow: auto">
                        </div>
                        <div class="menu-hidden">
                            <img src="./防汛抗旱态势分析系统_files/back.png" onclick="hideTreeMenu()" class="showImage">
                            <img src="./防汛抗旱态势分析系统_files/back-right.png" onclick="showTreeMenu()" style="display: none" class="hideImage">
                        </div>
                        <div id="waterlogged-basic-data-bottom-menu" class="common-basic-menu">
                            <ul id="waterlogged-basic-data-bottom-tree" class="ztree"></ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="waterlogged-report">
            <div id="waterlogged-report-content" style="position: relative; overflow:hidden;height: 99%;background-color: #fff"></div>
        </div>

    </div>

    <!--图、列表-->
    <div id="area-bigdata-forcast">
        <div id="area-forcast-view" name="table" class="chart-table" style="right: 80px">
            <img src="./防汛抗旱态势分析系统_files/data-table.png" class="data-table" alt="数据视图">
        </div>
        <div class="export-excel">

        </div>
        <div id="area-forcast-chart" style="position: absolute;margin-top: 35px;width: 100%;height: calc(100% - 70px);bottom: 10px"></div>
        <div id="area-forcast-table" style="display:none;white-space: nowrap;overflow: auto;margin-top: 35px "></div>
    </div>

    <!-- 预警 -->
    <div id="monitor-early-warning">
        <div id="monitor-early-warning-box" style="overflow: hidden;height:100%;">
            <div class="early-warning-box-title"><span class="early-warning-box-title-name" style="margin-right: 15px;"></span><span class="early-warning-box-title-info"></span></div>
            <div class="early-warning-box-main" style="height: calc(100% - 30px);">
                <div id="early-warning-box-main-chart-warning" style="height:100%;">
                    <div id="early-warning-chart1" class="early-warning-chart"></div>
                    <div id="early-warning-chart2" class="early-warning-chart"></div>
                    <div id="early-warning-chart3" class="early-warning-chart"></div>
                </div>
            </div>
        </div>
    </div>
    <!-- 预报 -->
    <div id="monitor-early-warning-prediction">
        <div id="monitor-early-warning-box" style="overflow: hidden;height:100%;">
            <div class="early-warning-box-title"><span class="early-warning-box-title-name" style="margin-right: 15px;"></span><span class="early-warning-box-title-info"></span></div>
            <div class="early-warning-box-main" style="height: calc(100% - 30px);">
                <div id="early-warning-box-main-chart-prediction" style="height:100%;">
                    <div id="early-warning-chart4" class="early-warning-chart"></div>
                    <div id="early-warning-chart5" class="early-warning-chart"></div>
                    <div id="early-warning-chart6" class="early-warning-chart"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 滑坡基本情况 -->
    <div id="monitor-hpzh-basic">
        <div id="monitor-hpzh-basic-box" style="overflow: hidden;height:100%;">
            <div class="hpzh-basic-box-title"><span class="early-warning-box-title-name" style="margin-right: 15px;"></span><span class="early-warning-box-title-info"></span></div>
            <div class="hpzh-basic-box-main" style="height: calc(100% - 30px);">
                <div id="hpzh-basic-main" style="height:100%;">
                    <div class="detail-right-hpzh-left detail-right-hpzh-box">
                        <table style="width: 100%;text-align: left;" class="base-">
                            <tbody id="hpzh-basic-left">

                            </tbody>
                        </table>
                    </div>
                    <div class="detail-right-hpzh-right detail-right-hpzh-box">
                        <table style="width: 100%;text-align: left;" class="base-">
                            <tbody id="hpzh-basic-right">

                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 滑坡灾害防治预测 -->
    <div id="monitor-hpzh-chart">
        <div id="monitor-hpzh-basic-box" style="overflow: hidden;height:100%;">
            <div class="hpzh-basic-box-title"><span class="early-warning-box-title-name" style="margin-right: 15px;"></span><span class="early-warning-box-title-info"></span></div>
            <div class="hpzh-basic-box-main" style="height: calc(100% - 30px);">
                <div id="hpzh-main-chart" style="height:100%;">
                    <div id="hpzh-chart-chart1" class="hpzh-chart" style="height:50%;width:100%"></div>
                    <div id="hpzh-chart-chart2" class="hpzh-chart" style="height:50%;width:100%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 空间分析,1小时预报 -->
    <div id="monitor-kjfx-chart1">
        <div id="monitor-kjfx-basic-box1" style="overflow: hidden;height:100%;">
            <div class="kjfx-basic-box-title"><span class="early-warning-box-title-name" style="margin-right: 15px;"></span><span class="early-warning-box-title-info"></span></div>
            <div class="kjfx-basic-box-main" style="height: calc(100% - 30px);">
                <div id="kjfx-main-chart1" style="height:100%;">
                    <div id="kjfx-chart-chart1" class="kjfx-chart" style="height:100%;width:100%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 空间分析,24小时预报 -->
    <div id="monitor-kjfx-chart2">
        <div id="monitor-kjfx-basic-box2" style="overflow: hidden;height:100%;">
            <div class="kjfx-basic-box-title"><span class="early-warning-box-title-name" style="margin-right: 15px;"></span><span class="early-warning-box-title-info"></span></div>
            <div class="kjfx-basic-box-main" style="height: calc(100% - 30px);">
                <div id="kjfx-main-chart2" style="height:100%;">
                    <div id="kjfx-chart-chart2" class="kjfx-chart" style="height:100%;width:100%"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- <div id="analysisTable" style="width:100%;height:100%">
        <div id="analysisTable-box" style="width:100%;height:100%">
            <table id="analysisTable-box-table">
            </table>
        </div>
    </div> -->
</div>
  <!--  &lt;!&ndash;小地图&ndash;&gt;-->
  <div id="min-map-shrink" flag="false" onclick="initLoadSshrink()" style="right: 197px; bottom: 192px; display: none;">
    <img src="./防汛抗旱态势分析系统_files/query-left.svg">
</div>
<div id="min-map-shrink-bottom" onclick="initLoadSshrink()" style="display: block;">
    <img src="./防汛抗旱态势分析系统_files/query-left.svg">
</div>
<div id="echarts-canves" style="display: none; -webkit-tap-highlight-color: transparent; user-select: none;" _echarts_instance_="ec_1573354725210"><div style="position: relative; overflow: hidden; width: 215px; height: 200px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="215" height="200" style="position: absolute; left: 0px; top: 0px; width: 215px; height: 200px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div></div></div>
<style>
    .esri-view-root :focus {
        outline: none;
    }
</style>

<script>
    $(function () {
        $("#echarts-canves").css("display","block");
        let adcd=('520000000000000');
        let param={
            adcd:adcd,
        };
        userPrivilege=('520000000000000');
        // userAdnm="贵州"
        let adnm=('贵州省');
        ajaxCallJson(param,"/getPoint/findMiniMapByParent",function (_data) {
            geoDataList={};
            if(_data.flag&&_data!=null){
                var geoData=JSON.parse(_data.data);
                if(geoData.resflag==false){
                  return;
                }
                geoDataList=geoData;
                initMiniMap(geoData.data[0].adnm,adcd,geoData,1);
            }else{
                layui.use('layer', function () {
                    var layer = layui.layer;
                    index= layer.msg("数据加载错误！请联系管理员");
                })
            }
        });
    })
</script>


  <!--  &lt;!&ndash;start水库联合调度&ndash;&gt;-->
  <!--<link href="css/dispatch/dispatchs.css" rel="stylesheet">-->
<div style="display: none">
    <div id="union-dispatch">
        <div id="union-dispatch-button">
            <button value="1" style="">实时</button>
            <button value="2">历史</button>
            <button value="3">模拟</button>
            <button value="4" play="true" class="play-controller">播放</button>
            <button value="5" style="float: right;margin-right: 10px" class="button-check-class">刷新</button>
            <button value="6" style="float: right;margin-right: 10px" class="button-check-class">优化</button>
            <span class="dispatch-current-time" style="margin-left: 30px"></span>
            <span class="dispatch-publish-time" style="margin-left: 30px"></span>
            <!--实时成果报告-->
            <button value="7" style="float: right;margin-right: 10px;display: none;width: 84px;" class="button-check-class">成果报告</button>
            <!--历史成果报告-->
            <button value="8" style="float: right;margin-right: 10px;display: none;width: 84px;" class="button-check-class">成果报告</button>
            <!--模拟成果报告-->
            <button value="9" style="float: right;margin-right: 10px;display: none;width: 84px" class="button-check-class">成果报告</button>
            <!--实时保存优化-->
            <button value="10" style="float: right;margin-right: 10px;display: none;width: 65px" class="button-check-class" title="保存当前调度成果">保存</button>
            <!--历史保存优化-->
            <button value="11" style="float: right;margin-right: 10px;display: none;width: 65px" class="button-check-class" title="保存当前调度成果">保存</button>
            <!--模拟保存优化-->
            <button value="12" style="float: right;margin-right: 10px;display: none;width: 65px" class="button-check-class" title="保存当前调度成果">保存</button>
            <button value="13" style="float: right;margin-right: 10px;display: block;width: 65px" class="button-check-class" title="查看已有调度成果">查看</button>
            <span style="float: right;margin-right: 20px;margin-top:5px;text-decoration-line: none;color:#FFFFFF;cursor:pointer;" class="dispatch-message" onclick="click_optimizationtimes(this)"></span>
            <span style="float: right;margin-right: 20px;margin-top:5px;text-decoration-line: none;color:#FFFFFF;" class="save-dispatch-title"></span>
        </div>
        <div id="union-dispatch-content" style="height: 0px;">
            <div id="union-dispatch-top">
                <div id="dispatch-top-left" class="dispatch-union-chart">
                    <div id="dispatch-union-chart" style="width: 100%;height: 100%"></div>
                    <img src="./防汛抗旱态势分析系统_files/enlarge.png" width="15" height="15" class="dispatch-enlarge-img">
                </div>
                <div id="dispatch-top-right">
                    <!--洪水过程表-->
                    <div class="dispatch-flood-process">
                        <div id="flood-process-chart" style="width: 100%;height: 100%">
                        </div>
                        <img src="./防汛抗旱态势分析系统_files/enlarge.png" width="15" height="15" class="dispatch-enlarge-img">
                    </div>
                    <!--水位出库过程线-->
                    <div class="dispatch-water-process">
                        <div id="water-process-chart" style="width: 100%;height: 100%">
                        </div>
                        <img src="./防汛抗旱态势分析系统_files/enlarge.png" width="15" height="15" class="dispatch-enlarge-img">
                    </div>
                </div>
            </div>
            <div id="union-dispatch-bottom">
                <div id="dispatch-bottom-left">
                    <!--降水过程线-->
                    <div class="dispatch-rain-process">
                        <div id="rain-process-chart" style="width: 100%;height:100%">
                        </div>
                        <img src="./防汛抗旱态势分析系统_files/enlarge.png" width="15" height="15" class="dispatch-enlarge-img">
                    </div>
                    <!--区域洪水过程线-->
                    <div class="dispatch-area-flood">
                        <div id="area-flood-chart" style="width: 100%;height:100%"></div>
                        <img src="./防汛抗旱态势分析系统_files/enlarge.png" width="15" height="15" class="dispatch-enlarge-img">
                    </div>
                </div>
                <div id="dispatch-bottom-right">
                    <!--下游河道洪水过程线-->
                    <div class="dispatch-downstream-flood">
                        <div id="downstream-flood-chart" style="width: 100%;height:100%"></div>
                        <img src="./防汛抗旱态势分析系统_files/enlarge.png" width="15" height="15" class="dispatch-enlarge-img">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!--联合调度图表放大-->
    <div id="enlarge-dispatch-data-window">

    </div>
    <!--花溪区间流量放大相应的图表-->
    <div id="enlarge-dispatch-window">
        <div id="enlarge-dispatch-view" flag="chart" class="chart-table" style="right: 100px;">
            <!--<img src="/images/data-table.png"  class='data-table' title="数据表格" >-->
        </div>
        <div class="export-excel" style="right: 35px;margin-top: -35px; display: block;">
        </div>
        <div class="chart-container" style="width: 100%;height: 100%">
            <div id="enlarge-dispatch-chart" style="width: 100%;height: 100%">

            </div>
        </div>
        <div id="enlarge-dispatch-table" class="chart-table-container">
        </div>
    </div>
    <!--放大下游河道洪水过程线-->
    <div id="enlarge-downstream-channel-window">
        <div id="enlarge-downstream-channel-view" flag="chart" class="chart-table" style="right: 100px;">
            <!--<img src="/images/data-table.png"  class='data-table' title="数据表格" >-->
        </div>
        <div class="export-excel" style="right: 35px;margin-top: -35px; display: block;">
        </div>
        <div class="chart-container" style="width: 100%;height: 100%">
            <div id="enlarge-downstream-channel-chart" style="width: 100%;height: 100%">

            </div>
        </div>
        <div id="enlarge-downstream-channel-table" class="chart-table-container">
        </div>
    </div>
    <!--松柏山水库放大-->
    <div id="enlarge-pine-mountain-window">
        <div id="enlarge-pine-mountain-view" flag="chart" class="chart-table" style="right: 100px;">
            <!--<img src="/images/data-table.png"  class='data-table' title="数据表格" >-->
        </div>
        <div class="export-excel" style="right: 35px;margin-top: -35px; display: block;">
        </div>
        <div class="chart-container" style="width: 100%;height: 100%">
            <div id="enlarge-pine-mountain-chart" style="width: 100%;height: 100%">

            </div>
        </div>
        <div id="enlarge-pine-mountain-table" class="chart-table-container">
        </div>
    </div>
    <!--花溪水库放大-->
    <div id="enlarge-huaxi-mountain-window">
        <div id="enlarge-huaxi-mountain-view" flag="chart" class="chart-table" style="right: 100px;">
            <!--<img src="/images/data-table.png"  class='data-table' title="数据表格" >-->
        </div>
        <div class="export-excel" style="right: 35px;margin-top: -35px; display: block;">
        </div>
        <div class="chart-container" style="width: 100%;height: 100%">
            <div id="enlarge-huaxi-mountain-chart" style="width: 100%;height: 100%">

            </div>
        </div>
        <div id="enlarge-huaxi-mountain-table" class="chart-table-container">
        </div>
    </div>
    <!--阿哈水库放大-->
    <div id="enlarge-aha-mountain-window">
        <div id="enlarge-aha-mountain-view" flag="chart" class="chart-table" style="right: 100px;">
        </div>
        <div class="export-excel" style="right: 35px;margin-top: -35px; display: block;">
        </div>
        <div class="chart-container" style="width: 100%;height: 100%">
            <div id="enlarge-aha-mountain-chart" style="width: 100%;height: 100%">

            </div>
        </div>
        <div id="enlarge-aha-mountain-table" class="chart-table-container">
        </div>
    </div>
</div>
<div style="display: none">
    <div id="dispatch-simulation-catalog">
        <div class="simulation-catalog-left">
            <div id="simulation-catalog-option">
                <select class="form-control" style="background-color: rgba(18, 51, 51, 0.7);color: #fff;margin-bottom: 5px;padding:0 0 0 5px;">
                    <option value="3" selected="">按频率</option>
                    <option value="4">按降水</option>
                </select>
            </div>
            <div id="dispatch-simulation-left-table" style="font-size: 11pt;align-items: center"></div>
        </div>
        <div class="simulation-catalog-right">
            <div style="margin-right: 5px">
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>水库名称</th>
                        <th>最高库水位控制</th>
                        <th>下泄流量控制</th>
                        <th>起调水位</th>
                        <th>期末水位</th>
                    </tr>
                    </thead>
                    <tbody class="simulation-reservoir-table-body"></tbody>
                </table>
            </div>
            <div style="margin-right: 5px">
                <table class="table table-bordered">
                    <thead>
                    <tr>
                        <th>控制断面</th>
                        <th>最高水位控制</th>
                        <th>最大流量控制</th>
                    </tr>
                    </thead>
                    <tbody class="simulation-river-table-body"></tbody>
                </table>
            </div>
        </div>
        <div style="position: absolute;left: 20px;bottom: 80px;display: block;">
            <label style="font-weight: normal"><input type="checkbox" name="holeEnabled" checked="true" id="check-hong-dong"> 是否启用分洪洞</label>
        </div>
        <div style="position: absolute;left: 48%;bottom: 20px">
            <button style="width: 65px;height: 33px;;color: #00A8FF;background-image: url(&#39;/images/window/btn.png&#39;);border: none;">确定</button>
        </div>
    </div>
</div>
<!--联合调度历史-->
<div style="display: none">
    <div id="dispatch-history-catalog">
        <div class="dispatch-history-table"></div>
    </div>
</div>

<!--成果报告-->
<div style="display: none">
</div>

  <style type="text/css">
    .optimization-view {
        height: 465px;
        margin: 0px;
        padding: 0px;
        font-size: 12px;
    }
    .optimization-view-top{
        height: 57.6%;
        white-space: nowrap;
        display: flex;
        justify-content: space-between;
    }
    .optimization-view-top-left{
        display: inline-block;
        width: 234px;
        height: 100%;
        padding: 0px 15px;
        border-right:1px solid #163174;
    }
    .optimization-view-top-left p{
        width: 100%;
        top: 0px;
        text-align: center;
    }
    .optimization-view-top-right{
        display: inline-block;
        width: 700px;
        height: 100%;
    }
    .optimization-view-line{
        width: 100%;
        height: 3px;
        border-top: 1px solid #163174;
    }
    .optimization-view-bottom{
        height: 35.5333%;
        white-space: nowrap;
    }
    .optimization-view-bottom-left{
        display: inline-block;
        width: 310px;
        height: 100%;
        margin-left: 1px;
    }
    #optimization-view-bottom-left-chart,#optimization-view-bottom-center-chart,#optimization-view-bottom-right-chart{
        width: 100%;
        height: 100%;
        border: 1px solid #163174;
    }
    .optimization-view-bottom-left p{
        width: 100%;
        top: 0px;
        font-size: 14px;
        font-weight:bold;
        text-align: center;
        color: #1f9cff;
    }
    .optimization-view-bottom-center{
        display: inline-block;
        width: 310px;
        height: 100%;
    }
    .optimization-view-bottom-center p{
        width: 100%;
        top: 0px;
        font-size: 14px;
        font-weight:bold;
        text-align: center;
        color: #1f9cff;
    }
    .optimization-view-bottom-right{
        display: inline-block;
        width: 310px;
        height: 100%;
    }
    .optimization-view-bottom-right p{
        width: 100%;
        top: 0px;
        font-size: 14px;
        font-weight:bold;
        text-align: center;
        color: #1f9cff;
    }

    .pie{
        position: relative;
        z-index: 0;
        left:0;
        top:0;
        width: 200px;
        height: 200px;
        line-height: 200px;
        border-radius:50%;
        text-align: center;
        color: #000;
        font-size: 120%;
        background-color:#123841;
        background-image: linear-gradient(to right, transparent 50%, yellowgreen 0);
        cursor:pointer;
        overflow: hidden;
    }
    .pie strong{
        position: absolute;
        width: 100%;
        left: 0;
        z-index: 1;
        color: #FFFFFF;
    }
    .pie span{
        display: block;
        border-radius: 50%;
        position: absolute;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        z-index: 0;
        background:rgba(18, 51, 51, 1);
    }
    .pie div{
        position:absolute;
        top:0;
        width:60%;
        height:100%;
        left:50%;
        transform:rotate(0turn);
        transform-origin: center left;
        transition:transform 0.7s linear;
    }
    .pie>.div_1{
        background-color: inherit;
        z-index: -2;
    }
    .pie>.div_2{
        height:110%;
        opacity: 0;
        z-index: -1;
        background-color: yellowgreen;
    }
    #optimization-view-stop button:hover{
        color: #00A8FF;
        background-image: url('/images/window/btn.png');
        border: none;
    }
    .transition-loader {
        position: absolute;
        top: 0;
        left: 0;
        height: 100%;
        width: 100%;
    }

    .transition-loader-inner {
        transform: translateY(-50%);
        top: 50%;
        position: absolute;
        width: calc(100% - 15px);
        color: #FFF;
        text-align: center;
    }
    .transition-loader-inner label {
        font-size: 0.365em;
        padding: 1%;
        opacity: 0;
        display: inline-block;
    }
    .transition-loader-inner label:after {
        font-family: FontAwesome;
        content: '\f111';
        font-size: 1.6em;
    }

    .transition-loader-inner label:nth-child(1) {
        -webkit-animation: loader 3s 500ms infinite ease-in-out;
        animation: loader 3s 500ms infinite ease-in-out;
    }

    .transition-loader-inner label:nth-child(2) {
        -webkit-animation: loader 3s 400ms infinite ease-in-out;
        animation: loader 3s 400ms infinite ease-in-out;
    }

    .transition-loader-inner label:nth-child(3) {
        -webkit-animation: loader 3s 300ms infinite ease-in-out;
        animation: loader 3s 300ms infinite ease-in-out;
    }
    .transition-loader-inner label:nth-child(4) {
        -webkit-animation: loader 3s 200ms infinite ease-in-out;
        animation: loader 3s 200ms infinite ease-in-out;
    }
    @keyframes loader {
        0% {
            opacity: 0;
            transform: translateX(-10px) scale(0.5);
        }
        33% {
            opacity: 1;
            transform: translateX(0px) scale(1);
        }
        66% {
            opacity: 1;
            transform: translateX(0px) scale(0.5);
        }
        100% {
            opacity: 0;
            transform: translateX(10px) scale(1);
        }
    }
    @-webkit-keyframes loader {
        0% {
            opacity: 0;
            -webkit-transform: translateX(-10px);
        }
        33% {
            opacity:1;
            -webkit-transform: translateX(0px);
        }
        66% {
            opacity: 1;
            -webkit-transform: translateX(0px);
        }
        100% {
            opacity: 0;
            -webkit-transform: translateX(10px);
        }
    }
</style>
<!--<link rel="stylesheet" href="css/dispatch/pie.css"/>-->
<div style="display: none;">
    <div id="optimizationrate" class="optimization-view">
        <div class="optimization-view-top">
            <div class="optimization-view-top-left">
                <p>甲秀楼控制断面优化率</p>
                <div id="optimization-view-top-left-pie" class="pie"></div>
                <div style="position: absolute;left:9%;top: 28%;width: 88px;height: 100px;display: none" id="load-optimization-div">
                    <div class="transition-loader">
                        <div class="transition-loader-inner">
                            <label></label>
                            <label></label>
                            <label></label>
                            <label></label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="optimization-view-top-right">
                <div class="chart-table" style="right: 14px;" id="optimization-view-stop">
                    <button value="1" style="margin-top: -5px;background-color: #0a2d4b;color: #00A8FF;border:none;">手动结束</button>
                </div>
                <div id="optimization-view-top-right-chart" style="width: 100%;height: 100%"></div>
                <div id="water-view-top-right-chart" style="display: none;width: 100%;height: 100%"></div>
                <div style="position: absolute;right: 20px;margin-top: -100px;cursor: pointer" id="click-chart-data" flag="chart">
                    <!--<img src="images/footer/down.png" style="width: 15px">-->
                </div>
            </div>
        </div>
        <div class="optimization-view-line"></div>
        <div class="optimization-view-bottom">
            <div class="optimization-view-bottom-left">
                <div id="optimization-view-bottom-left-chart"></div>
                <p>阿哈水库</p>
            </div>
            <div class="optimization-view-bottom-center">
                <div id="optimization-view-bottom-center-chart"></div>
                <p>花溪水库</p>
            </div>
            <div class="optimization-view-bottom-right">
                <div id="optimization-view-bottom-right-chart"></div>
                <p>松柏山水库</p>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="./防汛抗旱态势分析系统_files/optimizationrate.js.下载"></script>
<script type="text/javascript">

</script>
  <!--  &lt;!&ndash;end水库联合调度&ndash;&gt;-->
  <!--  &lt;!&ndash;start大数据视图窗口&ndash;&gt;-->
  <div style="display: none">
    
</div>
  <!--  &lt;!&ndash;实时数据图表&ndash;&gt;-->
  <div style="display: none">
    <div id="real-time-process-window">
        <!--河道实时数据图表-->
        <div class="river-course-content" style="width: 100%;height:100%">
            <div id="river-course-content-view" flag="chart" class="chart-table" style="right:120px">
                <!--<img src="/images/data-chart.png"  class='data-table' title="数据图表" >-->
            </div>
            <div class="river-export-excel">
            </div>
            <div id="river-course-content-max-one-chart" style="margin-top: 20px">
            </div>
            <div id="river-course-content-max-two-chart">
            </div>
            <div id="river-course-content-table" class="chart-table-container">
            </div>
        </div>
    </div>
</div>
  <!--  &lt;!&ndash;溃坝分析&ndash;&gt;-->
  <div id="dam-break-control" class="dam-break h-box-vc">
    <!---->
    <script type="text/javascript">
      $(function () {
        var vm = new Vue({
          el: "#dam-break-main",
          data: {
            provider: undefined,
            option: {
              duration: 2000,
              scale: {enabled: false},
              track: {
                height: 3
              },
              point: {
                width: 4,
                height: 4
              },
              cursor: {
                width: 6,
                height: 6,
              },
              label: false
            },
            reservoirInfo: {
              adnm: "暂无...",
              stcd: "",
              option: []
            },
            selected: "",
            wmsConfig: null,
            player: null,
            visible: false
          },
          mounted() {
            this.getConfigReadyData();
            note.on("reservoir.dambreak", (event, param) => {
              view.goTo({
                center: [param.lgtd, param.lttd],
                zoom: 14,
                heading: 15,
                tilt: 45
              })

              this.visible = true;
              if (this.player) this.player.dispose();
              this.player = new LayerPlayer(map.layers)
              this.initDamBreak(param)
            });
          },
          methods: {
            onChange() {
              this.getDamBreakInfo([this.reservoirInfo.stcd, this.selected])
            },
            initDamBreak(param) {
              let body = {
                interface: "com.eastcentury.enode.support.wms.DamBreakInfoService",
                method: "damBreakList",
                args: [param.stcd]
              }
              ajaxCallJson(body, "/rpc", (result) => {
                if (result && result.data) {
                  let option = [];
                  result.data.forEach((item, index) => {
                    let label = "";
                    if (item == "-1") {
                      label = "全溃"
                    } else if (item == "-2") {
                      label = "半溃"
                    } else if (item == "-3") {
                      label = "三分之二溃"
                    } else if (item == "-4") {
                      label = "三分之一溃"
                    } else if (item == "-9") {
                      label = "溢洪道溃"
                    }
                    option.push({value: item, label: label})
                    if (index === 0) {
                      this.selected = option[index].value;
                    }
                  })

                  this.reservoirInfo = {
                    adnm: param.adnm,
                    stcd: param.stcd,
                    option: option
                  };
                  if (option.length) {
                    this.getDamBreakInfo([param.stcd, this.selected]);
                  }
                } else {
                  this.reservoirInfo = {
                    adnm: param.adnm,
                    stcd: param.stcd,
                    option: []
                  };
                  layer.msg("暂无该站点溃坝数据")
                }
              })
            },
            getDamBreakInfo(param) {
              let body = {
                interface: "com.eastcentury.enode.support.wms.DamBreakInfoService",
                method: "getDamBreakInfo",
                args: param
              }
              ajaxCallJson(body, "/rpc", (result) => {
                if (result && result.data) {
                  if (this.wmsConfig === null) {
                    layer.msg("获取数据失败");
                    return
                  }
                  if (this.player) this.player.dispose();
                  this.provider = new Provider(result.data.indexList, this.wmsConfig);
                } else {
                  layer.msg("请求溃坝分析数据错误");
                }
              })
            },
            getConfigReadyData() {
              let body = {
                interface: "com.ec.ws.service.def.xyyj.LayerManagerV1Service",
                method: "getLayerPlayInfo",
                args: [1000,isLan]
              }
              ajaxCallJson(body, "/rpc", (result) => {
                this.wmsConfig = result.data.nodes[0];
                this.option.duration = result.data.duration;
              })
            },
            onDamEffect() {
              let body = {
                interface: "com.ec.ws.service.def.rsvr.RsvrHydrService",
                method: "findFloodInfluence",
                args: [this.reservoirInfo.stcd, this.selected]
              }
              ajaxCallJson(body, '/rpc', (result) => {
                damBreakWin.setTitle(this.reservoirInfo.adnm + '实时数据表');
                damBreakWin.dom.css("z-index", "999");
                damBreakWin.show();
                var columns = [{
                  field: 'id',
                  title: '序号',
                  align: 'center'
                }, {
                  field: 'P',
                  title: '频率',
                  align: 'center',
                  formatter: function (value) {
                    let label = "";
                    if (value == "-1") {
                      label = "全溃"
                    } else if (value == "-2") {
                      label = "半溃"
                    } else if (value == "-3") {
                      label = "三分之二溃"
                    } else if (value == "-4") {
                      label = "三分之一溃"
                    } else if (value == "-9") {
                      label = "溢洪道溃"
                    }
                    return label;
                  }
                }, {
                  field: 'adnm',
                  title: '行政区名称',
                  align: 'center'
                }, {
                  field: 'adarea',
                  title: '面积',
                  align: 'center'
                }, {
                  field: 'farm',
                  title: '耕地面积',
                  align: 'center'
                }, {
                  field: 'gdp',
                  title: 'GDP',
                  align: 'center'
                }, {
                  field: 'homes',
                  title: '家庭数',
                  align: 'center'
                }, {
                  field: 'houses',
                  title: '房屋数',
                  align: 'center'
                }, {
                  field: 'outpop',
                  title: '外出人口',
                  align: 'center'
                }, {
                  field: 'population',
                  title: '人口',
                  align: 'center'
                }
                ];
                var tableData = [];
                for (var i = 0; i < result.data.length; i++) {
                  var temp = {};
                  temp.id = i + 1;
                  temp.P = result.data[i].p;
                  temp.adnm = result.data[i].adnm;
                  temp.adarea = result.data[i].adarea;
                  temp.farm = result.data[i].farm;
                  temp.gdp = result.data[i].gdp;
                  temp.homes = result.data[i].homes;
                  temp.houses = result.data[i].houses;
                  temp.outpop = result.data[i].outpop;
                  temp.population = result.data[i].population;
                  tableData.push(temp)
                }
                var params = {
                  id: "dam-break-div-table",
                  columns: columns,
                  data: tableData,
                  height: getWaterLevelClickTableHeight(damBreakWin) + 20,
                }
                createChartTable(params);
              })
            },
            onCloseDamBreak() {
              this.provider = undefined;
              this.player.dispose();
              this.player = null;
              this.visible = false;
            },
            onReady(index) {
              this.player.initialize(index, this.provider);
            },
            onJump(index) {
              this.player.jump(index);
            },
            onPlay() {
              this.player.play();
            },
            onVisible(visible) {

            }
          }
        });

        function Provider(values, config) {

          this.init = function () {
            return [0, this.count(), 0];
          }

          this.count = function () {
            return values.length;
          }

          this.option = function () {
            return {transition: false, opacity: 0.6};
          };

          this.get = function (index) {
            let viewparams = Object.assigns({}, config.viewparams, {
              p: Math.abs(vm.selected),
              code: vm.reservoirInfo.stcd,
              index: values[index]
            })

            return new StatusableWMSLayer({
              id: "reservoir-dam-brake:" + index,
              url: config.url,
              sublayers: [{
                name: config.layers
              }],
              fullExtent: extent,
              customLayerParameters: viewparams,
              spatialReferences: [],
              opacity: 1,
              visible: true
            });
          }

          this.extract = function (min, max) {
            return Array.make(min, max);
          }

          this.tooltip = function (index) {
            let hour = Math.floor((values[index] * 5) / 60);
            let min = (values[index] * 5) % 60;
            let lable = "";
            if (hour > 0) {
              lable = hour + "小时"
            }
            if (min > 0) {
              lable += min + "分钟"
            }
            return lable === "" ? "无播放信息" : lable;
          };
        }
      });
    </script>
</div>
  <!--  &lt;!&ndash;台风查询&ndash;&gt;-->
  <div class="fill " style="cursor: pointer;display: none;position: absolute;right: 0px;top: 23%;margin: 5px;width: 20px;flex-direction: column;height: 20px;color: #0ff" id="click-typhoon-path-list">
    <i class="h-box-cc fa fa-angle-double-left" title="显示"></i>
</div>
<div id="typhoon-query-win" class="typhoon_win" style="display: none;z-index: 999;width: 400px;">
    <div class="border_5">
        <div style="" class="form-inline">
             <span id="typhoon-query-hide-content" style="cursor: pointer">
                 <i class=" fa fa-angle-double-right" title="隐藏"></i>
            </span>
            <span id="typhoon-query-close">
               <span class="window-close"></span>
            </span>
        </div>
    </div>
    <div class="border_6">
        <div style="width: 100%;height: 25px;margin-left: 10px;margin-bottom: 3px">
            <span style="font-size: 16px">台风列表</span>
            <select name="level" style="margin-left: 5px">
                <option value="0">年份选择</option>
                <option value="2019" selected="selected">2019</option>
                <option value="2018">2018</option>
                <option value="2017">2017</option>
                <option value="2016">2016</option>
                <option value="2015">2015</option>
            </select>
        </div>
        <div id="query_typhoon_div" class=""></div>
    </div>
</div>
<div id="typhoon-query-content" class="typhoon_win" style="width: 400px;display:none">
    <div class="border_5">
        <div style="" class="form-inline">
        </div>
    </div>
    <div class="border_6">
        <div style="width: 100%;height: 25px;margin-bottom: 3px">
            <span style="font-size: 16px;color: yellow" id="typhoon-content-title"></span>
        </div>
        <div id="query_typhoon_content" class="">
        </div>
    </div>
</div>
<div id="typhoon-query-layer-contort" class="typhoon_win" style="width: 400px; display: none;">
    <div style="display: flex;justify-content: space-between;margin: 5px">
        <div id="raincloud" style="float: right; padding-right: 4px; margin-right: 11px;width: 100%;height: 100%;display: flex;justify-content: center;cursor: pointer">
            <div style="display: flex;justify-content: space-between;width: 100%;height: 100%;">
                <div style="width: 80%;display: flex;justify-content: center;height: 100%;align-items: center;flex-direction: column;">
                    <div style="width: 100%;height: 50%;display: flex;justify-content: center;align-items: center;margin: 5px 5px 0 0">
                        <div id="check-typhoon-rain-data" onclick="onLoadTyphoonRain()" style="display: flex;justify-content: center;width: 22%;height:100%;" flag="rain">
                            <img src="./防汛抗旱态势分析系统_files/rain-check.png" alt="24"><span>降水</span>
                        </div>
                        <div style="border: 1px solid;display: flex;justify-content: space-evenly;width: 80%;" id="check-typhoon-rain-data">
                            <span id="real01">实时</span>
                            <span style="border-right: 1px solid"></span>
                            <span id="rc01">未来24h</span>
                            <span style="border-right: 1px solid"></span>
                            <span id="rc02">未来48h</span>
                            <span style="border-right: 1px solid"></span>
                            <span id="rc03">未来72h</span>
                        </div>
                    </div>
                    <div style="width: 100%;height: 50%;display: flex;justify-content: center;align-items: center;margin: 5px 5px 0 0">
                        <div id="check-typhoon-flood-data" onclick="onLoadTyphoonFlood()" style="display: flex;justify-content: center;width: 22%;height:100%;" flag="flood">
                            <img id="" src="./防汛抗旱态势分析系统_files/flood-check.png" alt="24"><span>洪水</span>
                        </div>
                        <div style="border: 1px solid;display: flex;justify-content: space-evenly;width: 80%;" id="check-typhoon-flood-data">
                            <span id="flood01">实时</span>
                            <span style="border-right: 1px solid"></span>
                            <span id="flood02">短临</span>
                            <span style="border-right: 1px solid"></span>
                            <span id="flood03">趋势</span>
                        </div>
                    </div>
                </div>
                <div style="height: 100%;display: flex;align-items: center;flex-direction: column;">
                    <div style="display: flex;width: 100%;height: 50%;margin-top: 5px" onclick="onLoadTyphoonCloudChart()" id="typhoon-path-cloud-chart" flag="radar">
                        <img src="./防汛抗旱态势分析系统_files/radar(1).png"><span>云图</span>
                    </div>
                    <div style="width: 100%;display: flex;height: 50%;margin-top: 5px" id="typhoon-path-radar" flag="cloud" onclick="onLoadTyphoonRadar()"><img src="./防汛抗旱态势分析系统_files/cloud-check.png"><span style="color: #00A8FF">雷达</span></div>
                </div>
            </div>
        </div>
    </div>
</div>
<div id="typhoon-newest-query-content" class="typhoon_win" style="width: 400px;display:none">
    <div class="border_6">
        <div id="query-typhoon-newest-content">
        </div>
    </div>
</div>
<div id="dispatch-query-win" class="dispatch_win">
    <div class="border_5">
        <div style="" class="form-inline">
            <span id="dispatch-query-close">
               <span class="window-close"></span>
            </span>
        </div>
    </div>
    <div class="border_6">
        <table id="dispatch_warn_table" class=""></table>
    </div>
</div>
<!--<div class="typhoon_win" id="typhoon-play" >-->
    <!--<button onclick="playTyphoonData(true)">播放</button>-->
<!--</div>-->
<div id="real-scene-query-win" class="real_scene_win">
    <div class="border_5">
        <div style="" class="form-inline">
            <span id="real-scene-query-close">
               <span class="window-close"></span>
            </span>
        </div>
    </div>
    <div class="border_6">
        <table id="real_scene_warn_table" class=""></table>
    </div>
</div>


  <div id="module-comparison" class="v-box" @wheel.alt.prevent="onWheel" v-cloak="">
    <div class="content full auto-scroll-y v-box-hc">
        <div class="link">中央气象台：
            <a target="_blank" href="http://www.nmc.cn/" title="点击进入">http://www.nmc.cn/</a>
        </div>
        <div class="container" :style="{width:width+&#39;%&#39;}">
            <div class="item" v-for="e in listed">
                <div>
                    <img :src="`${DOWNLOAD_URL}${e.fileid}`">
                </div>
            </div>
        </div>

    </div>
</div>
  <!--  &lt;!&ndash;三类责任人&ndash;&gt;-->
  <!--新增三类责任人-->
<div id="early-warning-setting-content-input">
    <div class="early-warning-setting-content-input" style="overflow: hidden;display: none">
        <div>
            <div class="early-warning-setting-input-left">姓名:</div>
            <div class="early-warning-setting-input-right">
                <input type="text" class="form-control" id="early-warning-setting-name" placeholder="请输入姓名">
            </div>
        </div>
        <div>
            <div class="early-warning-setting-input-left">单位:</div>
            <div class="early-warning-setting-input-right">
                <input type="text" class="form-control" id="early-warning-setting-depart" placeholder="请输入单位名称" disabled="disabled">
            </div>
        </div>
        <div>
            <div class="early-warning-setting-input-left">手机:</div>
            <div class="early-warning-setting-input-right">
                <input type="text" class="form-control" id="early-warning-setting-mobelphone" placeholder="请输入手机">
            </div>
        </div>
        <div>
            <div class="early-warning-setting-input-left">电话:</div>
            <div class="early-warning-setting-input-right">
                <input type="text" class="form-control" id="early-warning-setting-phone" placeholder="请输入电话">
            </div>
        </div>
        <div>
            <div class="early-warning-setting-input-left">邮箱:</div>
            <div class="early-warning-setting-input-right">
                <input type="text" class="form-control" id="early-warning-setting-email" placeholder="请输入邮箱">
            </div>
        </div>
        <div>
            <!--<div class="early-warning-setting-input-left">机构:</div>-->
            <!--<div class="early-warning-setting-input-right">-->
            <!--<input type="text" class="form-control" id="early-warning-setting-unit"-->
            <!--placeholder="请输入机构" readonly>-->
            <!--</div>-->
            <div class="early-warning-setting-choose-unit">
                <ul id="early-warning-setting-choose-unit-tree" class="ztree"></ul>
            </div>
        </div>
        <!--
        <div>
        <div class="mail-input-left">职位:</div>
        <div class="mail-input-right">
        <input type="text" class="form-control" id="mail-title"
        placeholder="请输入职位">
        </div>
        </div>
        -->
        <div>
            <div class="early-warning-setting-input-left">职务:</div>
            <div class="early-warning-setting-input-right">
                <input type="text" class="form-control" id="early-warning-setting-job" placeholder="请输入单位职务">
            </div>
        </div>
        <div id="early-warning-setting-add-submit">
            <button class="btn-info" style="border: none">提交</button>
        </div>
        <div id="early-warning-setting-edit-submit">
            <button style="border: none" class="btn-info">提交</button>
        </div>
    </div>
</div>
  <!--长江调度-->
  <div xmlns:v-slot="http://www.w3.org/1999/xhtml">
    <!---->
    <script id="yangtze-schedule-editor" type="text/x-template">
        <div class="fill">
            <div class="title">{{node.name}}【{{NODE_MAP[node.type]}}】</div>
            <div class="fill v-box-vc" v-if="node.type==='01'">
                <fieldset>
                    <legend>初始</legend>
                    <div class="v-box">
                        <label class="row">
                            <span class="name">水位：</span>
                            <input class="value" v-model.number="node.calc.initialstate.stage" pattern="\d+(\.\d+)?"/>
                            <i class="unit">(m)</i>
                        </label>
                        <label class="row">
                            <span class="name">库容：</span>
                            <input class="value" v-model.number="node.calc.initialstate.capacity"
                                   pattern="\d+(\.\d+)?"/>
                            <i class="unit">(万m³)</i>
                        </label>
                        <label class="row">
                            <span class="name">入流：</span>
                            <input class="value" v-model.number="node.calc.initialstate.inflow" pattern="\d+(\.\d+)?"/>
                            <i class="unit">(m³/s)</i>
                        </label>
                        <label class="row">
                            <span class="name">出流：</span>
                            <input class="value" v-model.number="node.calc.initialstate.outflow" pattern="\d+(\.\d+)?"/>
                            <i class="unit">(m³/s)</i>
                        </label>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>洪水</legend>
                    <div class="fill">
                        <el-radio-group class="fill-x" v-model="flood" @change="onFloodChange">
                            <div class="row h-box">
                                <el-radio label="ori" class="name">实时预报</el-radio>
                            </div>
                            <div class="row h-box">
                                <el-radio label="rate" class="name" :disabled="!rates.length">频率洪水</el-radio>
                                <select v-model="node.calc.flood.inflowfloodid" :disabled="flood!=='rate'">
                                    <option v-for="(e,i) in rates" :value="e.floodid">{{e.ratedesc}}</option>
                                </select>
                            </div>
                        </el-radio-group>
                    </div>
                </fieldset>
                <fieldset class="v-box full">
                    <legend>过程数据</legend>
                    <div class="series full">
                        <div style="position:absolute;">
                            <table>
                                <thead>
                                <tr class="row">
                                    <th width="100">时段（h）</th>
                                    <th>出流（m³/s）</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr class="row" v-for="i in count">
                                    <td class="name">{{i|date}}</td>
                                    <td class="value">
                                        <input v-model.number="node.calc.series[i-1]" pattern="\d+(\.\d+)?"
                                               @keyup.enter="onSeriesEnter(i,$event)"/>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </fieldset>
            </div>
            <div class="fill" v-else-if="node.type==='15'">
                <fieldset>
                    <legend>当前</legend>
                    <div class="v-box">
                        <label class="row">
                            <span class="name">水位：</span>
                            <input class="value" v-model.number="node.calc.initialstate.stage" pattern="\d+(\.\d+)?"/>
                            <i class="unit">(m)</i>
                        </label>
                        <label class="row">
                            <span class="name">流量：</span>
                            <input class="value" v-model.number="node.calc.initialstate.inflow" pattern="\d+(\.\d+)?"/>
                            <i class="unit">(m³/s)</i>
                        </label>
                    </div>
                </fieldset>
                <fieldset>
                    <legend>洪水</legend>
                    <div class="fill">
                        <el-radio-group class="fill-x" v-model="flood" @change="onFloodChange">
                            <div class="row h-box">
                                <el-radio label="ori" class="name">实时预报</el-radio>
                            </div>
                            <div class="row h-box">
                                <el-radio label="rate" class="name" :disabled="!rates.length">频率洪水</el-radio>
                                <select v-model="node.calc.flood.inflowfloodid" :disabled="flood!=='rate'">
                                    <option v-for="(e,i) in rates" :value="e.floodid">{{e.ratedesc}}</option>
                                </select>
                            </div>
                        </el-radio-group>
                    </div>
                </fieldset>
            </div>
            <i class="fa fa-times close" @click="onClose"></i>
        </div>
    </script>
    <script id="yangtze-schedule-table" type="text/x-template">
        <div class="v-box" :style="{top:OFFSET.Y,right:OFFSET.R}" @mousemove="onDragOver"
             @mouseup="onDragEnd">
            <div class="h-box-vc selector" @mousedown="onDragStart($event,$el)">
                <el-radio-group class="full" v-model="filter">
                    <el-radio label="01">水库水电站</el-radio>
                    <el-radio label="15">水文站</el-radio>
                </el-radio-group>
                <time>{{time}}</time>
            </div>
            <div class="full auto-scroll-y">
                <table class="fill-x">
                    <thead>
                    <tr>
                        <th>序号</th>
                        <th>名称</th>
                        <th v-for="e in dimensions[filter]">{{e.name}}({{e.unit}})</th>
                        <th>洪峰（时间）</th>
                        <th>预警</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr v-for="(node,idx) in list" :value="node.source[index].value" @dblclick="onDoubleClick(node)">
                        <td>{{idx+1}}</td>
                        <td class="name" @mouseenter="onNameEnter(node,$event)" @mouseout="onNameOut">{{node.name}}</td>
                        <td v-for="c in dimensions[filter]">{{node.source[index][c.field]}}</td>
                        <td>
                            <div class="h-box-cc" style="color:white">
                                <i class="fa fa-flag" v-if="node.source[index].floodPeak"></i>
                                <time v-if="node.floodPeakTime">({{node.floodPeakTime}})</time>
                            </div>
                        </td>
                        <td>
                            <template v-for="i in node.source[index].indices">
                                <span>{{i.name}}：{{i.diff | fixed}}（{{i.unit}}）</span>
                            </template>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="tool-tip" :style="{top:y,left:x}" v-if="node">
                <li>极值</li>
                <li v-for="e in dimensions[filter]">最大{{e.name}}：{{node.max[e.field]}}({{e.unit}})</li>
                <li>指标</li>
                <li v-for="i in node.indices">
                    <ul>
                        <li v-for="v in i.values">
                            {{v.name}}：{{v.index}}({{i.unit}})
                        </li>
                    </ul>
                </li>
            </div>
            <i class="fa fa-times close" @click="$emit('close')"></i>
        </div>
    </script>
    <script>
      $(function () {

        const draggable = {
          data() {
            return {
              DRAGGING: false,
              OFFSET: {X: undefined, Y: undefined, R: undefined},
              DRAG: {
                X: undefined,
                Y: undefined,
                L: undefined,
                T: undefined,
                R: undefined
              }
            }
          },
          methods: {
            onDragStart(e, el) {
              this.DRAGGING = true;
              this.DRAG.L = el.offsetLeft;
              this.DRAG.T = el.offsetTop;
              this.DRAG.R = el.offsetLeft + el.offsetWidth;
              this.DRAG.X = e.x;
              this.DRAG.Y = e.y;
            },
            onDragOver(e) {
              if (!this.DRAGGING) return;
              let dx = e.x - this.DRAG.X;
              let dy = e.y - this.DRAG.Y;
              this.OFFSET.X = (this.DRAG.L + dx) + "px";
              this.OFFSET.Y = (this.DRAG.T + dy) + "px";
              this.OFFSET.R = `calc(100% - ${this.DRAG.R + dx}px)`
            },
            onDragEnd() {
              this.DRAGGING = false;
            }
          }
        };

        let TRANSFER = {
          interface: "com.ec.ws.service.def.transfer.TransferService",
          method: "transfer"
        }
        const SERVER = yangtzeConfig.host;
        const URL_MAX = `${SERVER}/calculate:result:analysis`;
        const URL_DET = `${SERVER}/calculate:result`;
        const URL_CALC = `${SERVER}/calculate`;
        const URL_RATE = `${SERVER}/flood:rateList?spid=cj240&topoid=`;

        const NODE_MAP = {"01": "水库", "15": "水文站"}

        let editor = {
          template: "#yangtze-schedule-editor",
          props: {
            node: Object,
            data: Object,
            start: Object,
            count: Number
          },
          data() {
            return {
              flood: "ori",
              rates: [],
              NODE_MAP
            }
          },
          watch: {
            node: {
              immediate: true,
              handler(node) {
                this.rates.clear();
                this.getFloodRate(node.topoid);
              }
            }
          },
          methods: {
            onSeriesEnter(index, event) {
              let value = parseFloat(event.target.value);
              for (let i = index; i < this.count; i++) {
                this.$set(this.node.calc.series, i, value);
              }
              this.$forceUpdate();
            },
            onClose() {
              this.$emit("close");
            },
            onFloodChange(flood) {
              if (flood === "ori") {
                this.node.calc.flood.inflowfloodid = this.node.flood.inflowfloodid;
              }
            },
            getFloodRate(topoid) {
              let args = [`${URL_RATE}${topoid}`, "get", {}];
              ajaxCallJson(Object.assign(TRANSFER, {args}), "/rpc", res => {
                let json = JSON.parse(res.data);
                json.code === 0 && (this.rates = json.data);
              });
            }
          },
          filters: {
            date(value) {
              return moment(this.start).add(value, "h").format("M月DD日HH时");
            }
          }
        };

        let tabular = {
          template: "#yangtze-schedule-table",
          mixins: [draggable],
          props: {
            nodes: Array,
            index: Number,
            time: String,
          },
          data() {
            return {
              filter: "01",
              node: null,
              y: null,
              x: null,
              colors: ["无", "一级预警", "二级预警", "三级预警", "四级预警"],
              dimensions: {
                "01": [
                  {name: "水位", field: "stage", unit: "m"},
                  {name: "入流", field: "inflow", unit: "m³/s"},
                  {name: "出流", field: "outflow", unit: "m³/s"},
                  {name: "库容", field: "capacity", unit: "m³"},
                ],
                "15": [
                  {name: "水位", field: "stage", unit: "m"},
                  {name: "流量", field: "outflow", unit: "m³/s"},
                ]
              }
            }
          },
          methods: {
            onDoubleClick(e) {
              let attachment = Object.assign({exparams: {detail: e.detail}}, e);
              monitorClick(e, attachment, 10001);
            },
            onNameEnter(node, event) {
              this.node = node;
              this.x = event.target.offsetLeft + event.offsetX + 10 + "px";
              this.y = event.target.offsetTop + event.offsetY + 2 + "px";
            },
            onNameOut() {
              this.node = null;
            }
          },
          filters: {
            fixed(v) {
              return isNaN(v) ? v : v.toFixed(2);
            }
          },
          computed: {
            list() {
              return this.nodes.filter(e => e.type === this.filter);
            }
          }
        }

        let chart = null, modalChart = null, config = yangtzeConfig;
        let option = {}, series = [], map = null, rivers;

        let vm = new Vue({
          el: "#yangtze-schedule",
          mixins: [draggable],
          components: {editor, tabular},
          data: {
            data: null,
            item: null,
            config: null,
            code: null,
            provider: undefined,
            index: 0,
            option: {duration: 2000},
            instanceid: null,
            isShow: false,
            mode: "simple",
            modalTitle: '',
            modal: true,
            editorShow: false,
            tableShow: false,
            visible: false,
            stage: "max",
            position: "left"
          },
          mounted() {
            note.on("scheduling.yangtze.open", () => {
              this.visible = true;
              this.$nextTick(this.onOpen);
            });
            note.on("scheduling.yangtze.close", () => {
              this.onClose();
            });
            // note.notify("scheduling.yangtze.open");
          },
          methods: {
            switchMode() {
              this.mode = this.mode === "map" ? "simple" : "map";
              chart.clear();
              Object.free(option);
              Object.free(map);
              Object.free(this.data);
              this.editorShow = false;
              this.tableShow = false;
              this.init();
            },
            onItemClick(item, event) {
              this.item = item;
              this.editorShow = !!item[1];
              this.position = event.event.offsetX < 500 ? "right" : "left";
            },
            onItemDoubleClick(item) {
              this.isShow = true;
              this.modal = true;
              this.openHydrologyChart(this.node);
            },
            onCloseModal() {
              this.isShow = false;
              this.modal = false;
            },
            onModalSwitch(modal) {
              this.modal = !modal;
            },
            onOpen() {
              chart = echarts.init(this.$refs.chart);
              chart.on("click", "series", e => this.onItemClick(e.value, e));
              chart.on("dblclick", "series", e => this.onItemDoubleClick(e.value));
              this.init();
            },
            init() {
              this.loadMap()
                .then(this.loadNodes)
                .then(this.initNodes)
                .then(this.loadPlay)
                .catch(msg => msg && layer.msg(msg));
            },
            onReload() {
              this.initNodes().then(this.loadPlay);
            },
            onClose() {
              chart.dispose();
              modalChart = null;
              Object.free(option);
              Object.free(map);
              Object.free(this.data);
              this.visible = false;
              this.editorShow = false;
              this.tableShow = false;
            },
            loadMap() {
              return new Promise((resolve, reject) => {
                series.clear();
                if (this.mode === "map") {
                  $.get("/js/dataConfig/yangtze-map.json", data => {
                    echarts.registerMap(config[this.mode].chart.geo.map, map = data);

                    let names_data = data.names.map(e => ({
                      name: e.properties.name,
                      value: e.geometry.coordinates,
                    }));
                    series.push(Object.assigns({}, config.map.riverName, {data: names_data}));

                    let cities_data = data.cities.map(e => ({
                      name: e.properties.name,
                      value: e.geometry.coordinates,
                    }));
                    series.push(Object.assigns({}, config.map.cities, {data: cities_data}));
                    let opt = Object.assigns(option, config.chart, config.map.chart, {series})
                    resolve(chart.setOption(opt));
                  });
                } else {
                  $.get("/js/dataConfig/yangtze-map-simple.json", data => {
                    echarts.registerMap("yangtze", map = data);

                    function textOf(e) {
                      return e.properties.TEXT_DIR === "0" ? e.properties.NAME : e.properties.NAME.split("").join("\n")
                    }

                    let names = data.names.map(e => ({
                      name: textOf(e),
                      value: e.geometry.coordinates,
                      symbolRotate: e.properties.ICON_DIR * 90,
                    }));
                    series.push(Object.assigns({}, config.simple.name, {data: names}));

                    let lakes = data.lakes.map(e => ({
                        name: textOf(e),
                        coords: e.geometry.coordinates,
                      }
                    ));
                    series.push(Object.assigns({}, config.simple.lake, {data: lakes}));

                    let lakesName = data.lakesName.map(e => ({
                        name: textOf(e),
                        value: e.geometry.coordinates,
                      }
                    ));
                    series.push(Object.assigns({}, config.simple.lakeName, {data: lakesName}));

                    let cities = data.cities.map(e => ({
                      name: textOf(e),
                      value: e.geometry.coordinates,
                      label: {
                        normal: {position: e.properties.TEXT_POS, align: e.properties.ALIGN}
                      }
                    }));
                    series.push(Object.assigns({}, config.simple.city, {data: cities}));

                    let towns = data.towns.map(e => ({
                      name: textOf(e),
                      value: e.geometry.coordinates,
                      label: {
                        normal: {position: e.properties.TEXT_POS, align: e.properties.ALIGN}
                      },
                    }));
                    series.push(Object.assigns({}, config.simple.town, {data: towns}));

                    let opt = Object.assigns(option, config.chart, config.simple.chart, {series});
                    resolve(chart.setOption(opt));
                  });
                }

              });
            },
            loadNodes() {
              return new Promise((resolve, reject) => {
                let rpc = {
                  interface: "com.ec.ws.service.def.dispatch.DispatchCjService",
                  method: "findDispatchNodes",
                  args: []
                }
                ajaxCallJson(rpc, "/rpc", (res) => {
                    if (this.mode === "simple") {
                      let nodes = map.reservoirs.concat(map.hydrologies);
                      res.data.nodes.forEach(e => {
                        let find = nodes.find(x => x.properties.MOCD === e.mocd);
                        if (find) Object.assign(e, {properties: find.properties, coord: find.geometry.coordinates});
                      })
                    }
                    resolve(this.data = res.data);
                  },
                  () => reject("获取调度节点失败，请稍后再试！")
                );
              });
            },
            initNodes() {
              return new Promise(resolve => {
                this.provider = new Provider(this.data.play);
                let handler = layer.msg("数据加载中...", {time: 0});
                let args = [URL_MAX, "post", {instanceid: this.instanceid}];

                ajaxCallJson(Object.assign(TRANSFER, {args}), "/rpc", res => {
                    layer.close(handler);
                    let json = JSON.parse(res.data);
                    if (json.code !== 0) layer.msg(json.msg || "获取调度数据失败，请稍后再试！");
                    if (json.data.result == null) layer.msg("当前实例计算未完成，请稍后再试！");
                    this.instanceid = json.data.instanceid;
                    merge(this.data, json.data) && resolve();
                  },
                  () => {
                    layer.close(handler);
                    layer.msg("获取调度数据失败，请稍后再试！")
                    resolve();
                  });
              });
            },
            loadPlay() {
              return new Promise((resolve, reject) => {
                let handler = layer.msg("数据加载中...", {time: 0});
                let args = [URL_DET, "post", {instanceid: this.instanceid}];
                ajaxCallJson(Object.assign(TRANSFER, {args}), "/rpc", res => {
                    layer.close(handler);
                    let json = JSON.parse(res.data);
                    if (json.code !== 0) return layer.msg(json.msg || "获取调度播放数据失败，请稍后再试！");
                    if (json.data.result == null) return layer.msg("当前实例计算未完成，请稍后再试！");
                    merge(this.data, json.data).nodes.forEach(e => config.convert(e,this.provider));
                    resolve(this.update(this.index = 0));
                  },
                  () => {
                    layer.close(handler);
                    layer.msg("获取调度数据失败，请稍后再试！");
                    resolve(this.update(this.index = 0));
                  })
              });
            },

            openHydrologyChart(node) {
              // 水库----[时间，水位, 入库流量， 出库流量]
              // 水文站----[时间，水位, 流量]
              this.modalTitle = node.name;
              let args = [URL_DET, "post", {instanceid: this.instanceid, topoid: node.topoid, resulttype: 2}];
              ajaxCallJson(Object.assign(TRANSFER, {args}), "/rpc", ({data}) => {
                let result = JSON.parse(data);
                if (result.code !== 0) return layer.msg(result.msg || "获取过程数据失败，请稍后再试！");
                if (modalChart == null) {
                  modalChart = echarts.init(this.$refs.modalChart);
                }
                modalChart.clear();
                let value = result && result.data.result[0];
                let setting = simpleWaterFlowChart({type: node.type}, value);
                modalChart.setOption(setting.optioned);

                let height = this.$refs.modalChart.clientHeight;
                $('#modalTable').bootstrapTable('destroy');
                $('#modalTable').bootstrapTable({
                  height: height - 100,
                  columns: setting.tableColumns,
                  data: setting.tableData,
                  pagination: true,
                  pageNumber: 1,
                  pageSize: 50,
                  pageList: [20, 50, 100]
                })
              }, () => layer.msg("获取调度节点失败，请稍后再试！"));
            },
            calc() {
              let req = {
                spid: "cj240",
                userid: window.user.userId,
                originrequest: {
                  calculationoptions: {
                    calculationperiod: this.provider.count(),
                    calculationmode: 0
                  },
                  metadatas: {
                    calculatetype: 1,
                    name: "长江概化调度"
                  },
                  nodedatas: this.data.nodes.map(e => Object.assigns({}, e.calc, {
                    series: null,
                    topoid: e.topoid,
                    flood: {outfloodvalue: e.calc.series.join(",")}
                  }))
                },
              };
              let handler = layer.msg("提交中...", {time: 0});
              ajaxCallJson(Object.assign(TRANSFER, {args: [URL_CALC, "post", req]}), "/rpc", res => {
                layer.close(handler);
                let json = JSON.parse(res.data);
                if (json.code !== 0) return layer.msg(json.msg || "提交计算失败，请稍后再试！");
                this.instanceid = json.data;
                this.initNodes().catch(msg => layer.msg(msg));
              }, () => !layer.close(handler) && layer.msg("提交计算失败，请稍后再试！"));
            },
            update(index = 0) {
              this.index = index;
              const local = series.slice(), time = this.provider.tooltip(index);
              this.data.nodes.group("type").forEach((nodes, type) => {
                let option = config[this.mode][type];
                if (option.filter instanceof Function) {
                  let normal = nodes.filter(e => !e.source || !option.filter(e.source[index]));
                  if (normal.length) local.push(seriesOf(option.series.normal, normal, index, time, option));
                  let effect = nodes.filter(e => e.source && option.filter(e.source[index]));
                  if (effect.length) local.push(seriesOf(option.series.effect, effect, index, time, option));
                } else {
                  local.push(seriesOf(option.series, nodes, index, time, option));
                }
              });
              let rivers = this.data.river;
              let data = map.rivers.map(e => ({
                coords: e.geometry.coordinates,
                lineStyle: {
                  normal: {
                    width: e.properties.WIDTH || 2,
                    color: rivers[e.properties.ID] && rivers[e.properties.ID][index] ? "red" : undefined
                  }
                },
              }));
              local.push(Object.assigns({data}, config[this.mode].river));
              Object.assign(option.geo, chart.getOption().geo[0]);
              chart.setOption(Object.assign(option, {series: local}), true);
              console.log(chart.getOption());
            },
            onPlay(index) {
              this.update(index);
            },
            onJump(index) {
              this.update(index);
            },
          },
          computed: {
            node() {
              return this.data.nodes.find(e => e.topoid === this.item[1].topoid);
            },
            nodes() {
              return Object.freeze(this.data.nodes);
            }
          }
        });

        function seriesOf(series, nodes, index, time, option) {
          let data = option.decode ? option.decode(nodes, index, time, option) :
            nodes.map(e => {
              let source = e.source && e.source[index];
              return {
                name: e.name,
                value: [time, source, e.max, source && source.value, ...e.coord],
                label: {show: true, offset: e.label.offset},
                markPoint: {}
              }
            });
          let points = nodes.filter(e => e.source && e.source[index].floodPeak).map(x => ({coord: x.coord}));
          let local = Object.assigns({}, series);
          return Object.assign(local, {
            markPoint: Object.assigns({data: points}, config.flag),
            data, encode: local.encode || {lng: 4, lat: 5, val: 3, vis: 4, lbl: 5},
          });
        }

        function Provider(play) {
          let time = play && play.start || getSystemTime();
          this.start = moment(time);
          this.end = moment(play && play.end || getSystemTime()) + 10 * 24 * 3600 * 1000;
          this.total = moment.range(this.start, this.end).diff("hour")

          this.init = function () {
            return [0, this.count(), 0];
          }
          this.count = function () {
            return this.total;
          }

          this.label = function (index) {
            return this.timeOf(index).format(Object.get(play, "format.short", "D日H时"));
          }

          this.tooltip = function (index) {
            return this.timeOf(index).format(Object.get(play, "format.long", "YYYY年M月D日H时"));
          }

          this.timeOf = function (index) {
            return moment(this.start).add(index, "h");
          }
        }

        function merge(target, source, key = "topoid") {
          let target_nodes = target.nodes, source_nodes = source.result;
          Object.assign(target, source);
          source_nodes && target_nodes.forEach(node => {
            let find = source_nodes.find(s => s[key] != null && s[key] === node[key]);
            if (find) Object.assign(node, find);
          });
          return Object.assign(target, {nodes: target_nodes});
        }
      });
    </script>
</div>



  <script src="./防汛抗旱态势分析系统_files/bootstrap.min.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/layui.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/tabScript.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/html2canvas.min.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/bootstrap-table.min.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/bootstrap-table-zh-CN.min.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/dom-to-image.min.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/MyWindow.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/windowManager.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/commonZtree.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/message.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/common-chart.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/earthTool.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/realTime.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/earthClick.js.下载"></script><div id="window_1573354725637" style="display: none;box-shadow: rgba(81, 109, 162, 0.85) 1px 2px 5px;border-radius: 4px"><div>	<div class="window-header" id="window_1573354725637_header" style="border-radius: 4px">		<div class="window-icon"></div>		<span class="window-title"><span style="font-size: 30px;color: rgb(0, 255, 255);font-weight: bold;">贵州省防汛抗旱综合态势</span></span>		<div class="window-tool">		    <img src="./防汛抗旱态势分析系统_files/window-restore.png" class="window-restore-icon" style="display: none">			<img src="./防汛抗旱态势分析系统_files/window-max.png" class="window-max-icon">			<span class="window-close-icon window-close"></span>		</div>	</div>	<div class="window-line"></div></div>	<div class="window-body-container">	    <div style="padding: 5px 0 5px 0;"></div>	</div></div>
  <script src="./防汛抗旱态势分析系统_files/enlarge.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/addReservoirBasic.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/map.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/frameSelection.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/addMapList.js.下载"></script><div id="window_1573354725782" style="display: none; box-shadow: rgba(81, 109, 162, 0.85) 1px 2px 5px; border-radius: 4px; height: 596.4px; width: 723.8px; background: rgba(9, 25, 57, 0.95); position: absolute; top: 127.5px; left: 155px; z-index: 9999; border: 1px solid rgba(9, 25, 57, 0.95);" class="ui-draggable ui-draggable-handle"><div>	<div class="window-header" id="window_1573354725782_header" style="border-radius: 4px">		<div class="window-icon"></div>		<span class="window-title"><span style="font-size: 30px;color: rgb(0, 255, 255);font-weight: bold;">贵州省防汛抗旱综合态势</span></span>		<div class="window-tool">		    <img src="./防汛抗旱态势分析系统_files/window-restore.png" class="window-restore-icon" style="display: none">			<img src="./防汛抗旱态势分析系统_files/window-max.png" class="window-max-icon">			<span class="window-close-icon window-close"></span>		</div>	</div>	<div class="window-line" style="display: block;"></div></div>	<div class="window-body-container">	    <div style="padding: 5px 0px; height: 594.391px;"><div id="base-properties-div" style="width: 99%; margin-left: 0.5%; height: 584.391px; margin-top: 10px;"><div style="width: 62px;position: absolute;right: 50px;display: flex;flex-direction: column;" id="export-properties-data"></div><table id="base-properties-table" style="font-size: 16px;cursor: pointer;word-break: "></table></div></div>	</div></div><div id="window_1573354725787" style="display: none; box-shadow: rgba(81, 109, 162, 0.85) 1px 2px 5px; border-radius: 4px; height: 596.4px; width: 723.8px; background: rgba(9, 25, 57, 0.95); position: absolute; top: 127.5px; left: 155px; z-index: 9999; border: 1px solid rgba(9, 25, 57, 0.95);" class="ui-draggable ui-draggable-handle"><div>	<div class="window-header" id="window_1573354725787_header" style="border-radius: 4px">		<div class="window-icon"></div>		<span class="window-title"><span style="font-size: 30px;color: rgb(0, 255, 255);font-weight: bold;">贵州省防汛抗旱综合态势</span></span>		<div class="window-tool">		    <img src="./防汛抗旱态势分析系统_files/window-restore.png" class="window-restore-icon" style="display: none">			<img src="./防汛抗旱态势分析系统_files/window-max.png" class="window-max-icon" style="display: none;">			<span class="window-close-icon window-close"></span>		</div>	</div>	<div class="window-line" style="display: block;"></div></div>	<div class="window-body-container">	    <div style="padding: 5px 0px; height: 594.391px;"><div id="dam-break-div" style="height: 584.391px;"><table id="dam-break-div-table" style="cursor: pointer; width: 100%;height: 100%"></table></div></div>	</div></div>
  <script src="./防汛抗旱态势分析系统_files/globalMes.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/LayerPlayer.js.下载"></script>
  <!--日历-->
  <script src="./防汛抗旱态势分析系统_files/calendar.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/warning-table.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/wkt-util.js.下载"></script>
  <!--小地图-->
  <script src="./防汛抗旱态势分析系统_files/minimap.js.下载"></script>
  <!--start水库联合调度-->
  <script src="./防汛抗旱态势分析系统_files/timer.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/dispatch.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/optimizationrate.js.下载"></script>
  <!--end水库联合调度-->
  <!--start加载贵阳市视频-->
  <script src="./防汛抗旱态势分析系统_files/initVideo.js.下载"></script>
  <!--end加载贵阳市视频-->
  <!--start加载天气预报-->
  <!--<script src="/js/weather/weather.js"></script>-->
  <script src="./防汛抗旱态势分析系统_files/newWeather.js.下载"></script>
  <!--end加载天气预报-->
  <!--大数据视图窗口-->
  <script src="./防汛抗旱态势分析系统_files/bigData.js.下载"></script>
  <!--淹没分析-->
  <script src="./防汛抗旱态势分析系统_files/earthFlood.js.下载"></script>
  <!--实时过程图表-->
  <!--<script src="/js/realTime/realtimeprocess.js"></script>-->
  <!--简报-->
  <script src="./防汛抗旱态势分析系统_files/briefing.js.下载"></script><div id="window_1573354725794" style="display: none;box-shadow: rgba(81, 109, 162, 0.85) 1px 2px 5px;border-radius: 4px"><div>	<div class="window-header" id="window_1573354725794_header" style="border-radius: 4px">		<div class="window-icon"></div>		<span class="window-title"><span style="font-size: 30px;color: rgb(0, 255, 255);font-weight: bold;">贵州省防汛抗旱综合态势</span></span>		<div class="window-tool">		    <img src="./防汛抗旱态势分析系统_files/window-restore.png" class="window-restore-icon" style="display: none">			<img src="./防汛抗旱态势分析系统_files/window-max.png" class="window-max-icon">			<span class="window-close-icon window-close"></span>		</div>	</div>	<div class="window-line"></div></div>	<div class="window-body-container">	    <div style="padding: 5px 0 5px 0;"></div>	</div></div>
  <!-- // 山洪小流域过程线 -->
  <script src="./防汛抗旱态势分析系统_files/earlyWarning.js.下载"></script>
  <!-- 滑坡 -->
  <script src="./防汛抗旱态势分析系统_files/landslide.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/initMapEarly.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/quickInquiry.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/earlywarningmanage.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/newFunction.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/addMapLayer.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/main.js.下载"></script>

  <!--台风-->
  <script src="./防汛抗旱态势分析系统_files/typhoonPath.js.下载"></script>

  <script src="./防汛抗旱态势分析系统_files/notifiers.js.下载"></script>
  <!--水库三类责任人-->
  <script src="./防汛抗旱态势分析系统_files/dailynews.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/clickMaxRight.js.下载"></script>
  <!-- 大数据页面 -->
  <script src="./防汛抗旱态势分析系统_files/bigDataPage.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/bigdatawarning.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/simpleWaterFlowChart.js.下载"></script>
  <script src="./防汛抗旱态势分析系统_files/Geo.js.下载"></script>
  <!-- 引入l elmentUI -->
  <script src="./防汛抗旱态势分析系统_files/index.js.下载"></script>
  <link href="./防汛抗旱态势分析系统_files/index.css" rel="stylesheet">
  <style>
    body .pwdSafe-class .layui-layer-title {
      background: rgb(30, 58, 114);
      border: none;
    }

    body .pwdSafe-class .layui-layer-content span {
      color: #c00;
      border: none;
    }
  </style>
  <script>
    window.addEventListener('message',function(event) {
      goToGraphisc([parseFloat(JSON.parse(event.data).lng), parseFloat(JSON.parse(event.data).lat)]);
    },false);
    if (JSON.parse(privilegeBaseData).userId == 'demo1') { } else {
      // initLoadBigData();
    }
    setTimeout(() => {
      if (pwdSafe) {
        var pwdSafeTips = layer.confirm(pwdSafeTxt, {
          skin: "pwdSafe-class",
          btn: ['修改密码', '继续使用'],
          title: ['温馨提示!', 'color:#dff0d8;', 'font-size:15px'],
          closeBtn: 1
        }, function () {
          changePassword();
          layer.close(pwdSafeTips);
        }, function () {
          layer.close(pwdSafeTips);
        });
      }
    }, 2000);

  </script>



<div id="window_1573354726133" style="box-shadow: rgba(81, 109, 162, 0.85) 1px 2px 5px; border-radius: 4px; height: 803px; width: 1034px; background: rgba(9, 25, 57, 0.95); position: absolute; top: 0px; left: 0px; z-index: 10000; border: 1px solid rgba(9, 25, 57, 0.95); display: none;" class="ui-draggable ui-draggable-handle"><div>	<div class="window-header" id="window_1573354726133_header" style="border-radius: 4px">		<div class="window-icon"></div>		<span class="window-title"><span style="font-size: 30px;color: rgb(0, 255, 255);font-weight: bold;">贵州省防汛抗旱综合态势</span></span>		<div class="window-tool">		    <img src="./防汛抗旱态势分析系统_files/window-restore.png" class="window-restore-icon" style="display: none">			<img src="./防汛抗旱态势分析系统_files/window-max.png" class="window-max-icon" style="display: none;">			<span class="window-close-icon window-close"></span>		</div>	</div>	<div class="window-line" style="display: block;"></div></div>	<div class="window-body-container">	    <div style="padding: 5px 0px; height: 801px;"><div id="big-data-window" style="color: rgb(0, 255, 255); height: 791px;">
        <div id="big-data-header">
            <div class="bigdata-header-content bigdata-header-left">
                <div class="bigdata-header-left-left">
                    <div class="bigdatawarning">
  <div style="position: relative;width: 50%;">
    <div class="title"><span>暴雨风险</span></div>
    <div id="暴雨风险" style="position: absolute; width: 100%; height: 80%; -webkit-tap-highlight-color: transparent; user-select: none;" _echarts_instance_="ec_1573354725207"><div style="position: relative; overflow: hidden; width: 127px; height: 193px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="127" height="193" style="position: absolute; left: 0px; top: 0px; width: 127px; height: 193px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div></div></div>
    <div id="暴雨风险-Tips" class="warning-tips">
      <span></span>
      <span>0</span>
      <span></span>
      <span></span>
    </div>
  </div>
  <div style="position: relative;width: 50%;">
    <div class="title"><span>洪水风险</span></div>
    <div id="洪水风险" style="position: absolute; width: 100%; height: 80%; -webkit-tap-highlight-color: transparent; user-select: none;" _echarts_instance_="ec_1573354725209"><div style="position: relative; overflow: hidden; width: 127px; height: 193px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="127" height="193" style="position: absolute; left: 0px; top: 0px; width: 127px; height: 193px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div></div></div>
    <div id="洪水风险-Tips" class="warning-tips">
      <span></span>
      <span>0</span>
      <span></span>
      <span></span>
    </div>
  </div>
</div>
                </div>
                <div class="bigdata-header-left-right">
                    <div id="bigdataPie">
  <div class="bigdataPie-box-one bigdataPie-box">
    <div id="bigdata-info-one" class="bigdata-info-one bigdata-info">
        <div style="margin: 2px 0px;">大一&nbsp;<span>0</span></div>
        <div style="margin: 2px 0px;">大二&nbsp;<span>0</span></div>
        <div style="margin: 2px 0px;">中型&nbsp;<span>0</span></div>
        <div style="margin: 2px 0px;">小型&nbsp;<span>0</span></div></div>
    <div class="bigdataPie-content bigdataPie-left" id="bigdataPie-left" _echarts_instance_="ec_1573354725211" style="-webkit-tap-highlight-color: transparent; user-select: none; position: relative;"><div style="position: relative; overflow: hidden; width: 127px; height: 242px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="127" height="242" style="position: absolute; left: 0px; top: 0px; width: 127px; height: 242px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div style="position: absolute; display: block; border-style: solid; white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s; background-color: rgba(50, 50, 50, 0.7); border-width: 0px; border-color: rgb(51, 51, 51); border-radius: 4px; color: rgb(255, 255, 255); font: 14px/21px &quot;Microsoft YaHei&quot;; padding: 5px; left: 48.575px; top: 150.525px; pointer-events: none;">水库水电站<br>中型站点总数：134<br>中型告警数量：0</div></div>
  </div>
  <div class="bigdataPie-box-two bigdataPie-box">
    <div id="bigdata-info-two" class="bigdata-info-two bigdata-info">
        <div style="margin: 2px 0px;">中央&nbsp;<span>0</span></div>
        <div style="margin: 2px 0px;">省级&nbsp;<span>0</span></div>
        <div style="margin: 2px 0px;">其它&nbsp;<span>0</span></div></div>
    <div class="bigdataPie-content bigdataPie-right" id="bigdataPie-right" _echarts_instance_="ec_1573354725212" style="-webkit-tap-highlight-color: transparent; user-select: none; position: relative;"><div style="position: relative; overflow: hidden; width: 127px; height: 242px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="127" height="242" style="position: absolute; left: 0px; top: 0px; width: 127px; height: 242px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div style="position: absolute; display: block; border-style: solid; white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s, top 0.4s cubic-bezier(0.23, 1, 0.32, 1) 0s; background-color: rgba(50, 50, 50, 0.7); border-width: 0px; border-color: rgb(51, 51, 51); border-radius: 4px; color: rgb(255, 255, 255); font: 14px/21px &quot;Microsoft YaHei&quot;; padding: 5px; left: 58.1px; top: 153.7px; pointer-events: none;">河道水文站<br>省级站点总数：262<br>省级告警数量：0</div></div>
  </div>
</div>
                </div>
            </div>
            <div class="bigdata-header-content bigdata-header-right">
                <div style="display: flex;flex-direction: column;width: 100%;height: 100%;font-size: 20px">
                    <div style="text-align: center">
                        <span>监测采集数据量</span>
                    </div>
                    <div style="display: flex;flex-direction:column;text-align: end">
                        <span id="echarts-top-total"></span>
                        <span id="echarts-top-taday"></span>
                    </div>
                    <div id="natural-disaster-charts" style="width: 100%; height: 100%; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;" _echarts_instance_="ec_1573354725231"><div style="position: relative; overflow: hidden; width: 100px; height: 100px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="100" height="100" style="position: absolute; left: 0px; top: 0px; width: 100px; height: 100px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div></div></div>
                </div>
            </div>
        </div>

        <div style="width: 100%;height: 70%;display: flex;flex-direction:column;">
            <div style="border: solid 1px #3a3e52"></div>
            <div id="natural-disaster-bottom" style="width: 100%;height: 100%;display: flex;justify-content: space-between">
                <div style="width: 50%;height: 100%;background: #001a35;display: flex;flex-direction: column">
                    <div style="display: flex;flex-direction: column;width: 100%;height: 50%;margin-left: 15px">
                        <div style="display: flex;justify-content: space-between;">
                            <span style="color: rgb(0, 255, 255);margin-top: 2px;font-size: 20px">暴雨风险态势</span>
                            <span style="color: rgb(0, 255, 255);font-size: 20px" id="rain-move-title">时间:2019-11-10  风险数:0</span>
                            <span style="color: rgb(0, 255, 255);font-size: 20px"></span>
                        </div>
                        <div style="width: 100%; height: 100%; margin-top: 15px; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;" id="early-warning-charts" _echarts_instance_="ec_1573354725232"><div style="position: relative; overflow: hidden; width: 100px; height: 100px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="100" height="100" style="position: absolute; left: 0px; top: 0px; width: 100px; height: 100px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div></div></div>
                    </div>
                    <div style="display: flex;flex-direction: column;width: 100%;height: 50%;margin-left: 15px">
                        <div style="display: flex;justify-content: space-between;">
                            <span style="color: rgb(0, 255, 255);font-size: 20px">洪水风险态势</span>
                            <span style="color: rgb(0, 255, 255);font-size: 20px" id="flood-move-title">时间:2019-11-10  风险数:0</span>
                            <span style="color: rgb(0, 255, 255);font-size: 20px"></span>
                        </div>
                        <div style="width: 100%; height: 100%; margin-top: 5px; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;" id="early-warning-type-charts" _echarts_instance_="ec_1573354725233"><div style="position: relative; overflow: hidden; width: 100px; height: 100px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="100" height="100" style="position: absolute; left: 0px; top: 0px; width: 100px; height: 100px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div></div></div>
                    </div>
                </div>
                <div id="map-div-show" style="position: absolute;left: 50%; width:64px;height: 20px;z-index: 999;cursor: pointer" onclick="mapDivShow()"><i class="fa fa-exchange"></i></div>
                <div style="width:50%;height: 100%;margin-right: 5px;">
                    <div style="width: 100%; height: 100%; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;" id="echarts-map-data" class="echartsmapdata" _echarts_instance_="ec_1573354725213"><div style="position: relative; overflow: hidden; width: 100px; height: 100px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="100" height="100" style="position: absolute; left: 0px; top: 0px; width: 100px; height: 100px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div></div></div>
                    <div style="width: 100px; height: 100px; display: none; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;" id="early-warning-map-data" _echarts_instance_="ec_1573354725234"><div style="position: relative; overflow: hidden; width: 100px; height: 100px; padding: 0px; margin: 0px; border-width: 0px;"><canvas data-zr-dom-id="zr_0" width="100" height="100" style="position: absolute; left: 0px; top: 0px; width: 100px; height: 100px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div><div></div></div>
                    <div id="show-big-data-south" style="position: absolute; width: 120px; height: 140px; right: 5px; bottom: 10px; z-index: 500; border: 1px solid rgba(255, 255, 255, 0.1); display: none;">
                            <img src="./防汛抗旱态势分析系统_files/sj_nh.png" style="width: 100%;height: 100%;">
                    </div>
                </div>
            </div>
        </div>
    </div></div>	</div></div><div id="window_1573354728147" style="display: none; box-shadow: rgba(81, 109, 162, 0.85) 1px 2px 5px; border-radius: 4px; height: 596.4px; width: 723.8px; background: rgba(9, 25, 57, 0.95); position: absolute; top: 127.5px; left: 155px; z-index: 9999; border: 1px solid rgba(9, 25, 57, 0.95);" class="ui-draggable ui-draggable-handle"><div>	<div class="window-header" id="window_1573354728147_header" style="border-radius: 4px">		<div class="window-icon"></div>		<span class="window-title"></span>		<div class="window-tool">		    <img src="./防汛抗旱态势分析系统_files/window-restore.png" class="window-restore-icon" style="display: none">			<img src="./防汛抗旱态势分析系统_files/window-max.png" class="window-max-icon">			<span class="window-close-icon window-close"></span>		</div>	</div>	<div class="window-line" style="display: block;"></div></div>	<div class="window-body-container">	    <div style="padding: 5px 0px; height: 594.391px;"><div id="analysisTable" style="width: 100%; height: 584.391px;"><div id="analysisTable-box" style="width:100%;height:100%"><table id="analysisTable-box-table"></table></div></div></div>	</div></div><div class="layui-layer-move"></div></body></html>