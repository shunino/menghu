// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/4.9/esri/copyright.txt for details.
//>>built
require({cache:{"esri/views/BreakpointsOwner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-class ../core/Accessor ../core/ArrayPool ../core/Handles ../core/watchUtils ../core/accessorSupport/decorators ./DOMContainer".split(" "),function(n,g,c,a,f,b,l,e,h,m,k,d){var q={widthBreakpoint:{getValue:function(a){var b=a.viewSize[0];a=a.breakpoints;var d=this.values;return b<=a.xsmall?d.xsmall:b<=a.small?
d.small:b<=a.medium?d.medium:b<=a.large?d.large:d.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",
large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},heightBreakpoint:{getValue:function(a){var b=a.viewSize[1];a=a.breakpoints;var d=this.values;return b<=a.xsmall?d.xsmall:b<=a.small?d.small:b<=a.medium?d.medium:
b<=a.large?d.large:d.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",
large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},orientation:{getValue:function(a){a=a.viewSize;var b=this.values;return a[1]>=a[0]?b.portrait:b.landscape},values:{portrait:"portrait",landscape:"landscape"},
valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},p={xsmall:544,small:768,medium:992,large:1200};return function(d){function l(){var a=null!==d&&d.apply(this,arguments)||this;a._breakpointsHandles=new h;a.breakpoints=p;a.orientation=null;a.widthBreakpoint=null;a.heightBreakpoint=null;return a}c(l,d);l.prototype.initialize=function(){this._breakpointsHandles.add([m.init(this,["breakpoints","size"],this._updateClassNames)])};l.prototype.destroy=
function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles.destroy(),this._breakpointsHandles=null)};l.prototype._updateClassNames=function(){if(this.container){var a=e.acquire(),b=e.acquire(),d=!1,c,f,h;for(c in q)f=this[c],h=q[c].getValue({viewSize:this.size,breakpoints:this.breakpoints}),f!==h&&(d=!0,this[c]=h,b.push(q[c].valueToClassName[f]),a.push(q[c].valueToClassName[h]));d&&(this._applyClassNameChanges(a,b),e.release(a),e.release(b))}};l.prototype._applyClassNameChanges=
function(a,d){var e=this.container;e&&(b.remove(e,d),b.add(e,a))};l.prototype._removeActiveClassNames=function(){var a=this.container;if(a)for(var d in q)b.remove(a,q[d].valueToClassName[this[d]])};a([k.property({set:function(a){var b=this._get("breakpoints");if(a!==b){b=(b=a)&&b.xsmall<b.small&&b.small<b.medium&&b.medium<b.large;if(!b){var d=JSON.stringify(p,null,2);console.warn("provided breakpoints are not valid, using defaults:"+d)}a=b?a:p;this._set("breakpoints",f({},a))}}})],l.prototype,"breakpoints",
void 0);a([k.property()],l.prototype,"orientation",void 0);a([k.property()],l.prototype,"widthBreakpoint",void 0);a([k.property()],l.prototype,"heightBreakpoint",void 0);return l=a([k.subclass("esri.views.BreakpointsOwner")],l)}(k.declared(l,d))})},"esri/views/DOMContainer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/dom dojo/dom-construct dojo/on ../core/Accessor ../core/Evented ../core/Handles ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ./PopupManager ./overlay/ViewOverlay ../widgets/Popup".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){var t=[0,0];return function(e){function h(){var a=e.call(this)||this;a._domHandles=new m;a._freqInfo={freq:16,time:750};a._overlayRenderTaskHandle=null;a.height=0;a.popup=new u({view:a});a.position=null;a.resizing=!1;a.root=null;a.surface=null;a.suspended=!0;a.ui=null;a.userContent=null;a.width=0;a.watch("cursor",function(b){var d=a.surface;d&&d.setAttribute("data-cursor",b)});a.watch("interacting",function(b){var d=a.surface;d&&d.setAttribute("data-interacting",
b.toString())});a._focusEvent=a._focusEvent.bind(a);a._blurEvent=a._blurEvent.bind(a);return a}c(h,e);h.prototype.initialize=function(){this.watch("ui",this._handleUIChange);this._wireUI(this.ui)};h.prototype.destroy=function(){this.ui.destroy();this.popup&&!this.popup.destroyed&&this.popup.destroy();this.container=null;this._domHandles.destroy()};Object.defineProperty(h.prototype,"container",{set:function(a){var e=this,c=this._get("container");if(c!==a){this._domHandles.remove("dom-size");this._stopMeasuring();
if(c){var h=this.surface;h&&(h.removeEventListener("focus",this._focusEvent),h.removeEventListener("blur",this._blurEvent));c.classList.remove("esri-view");this.popupManager.destroy();this._set("popupManager",null);this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null);this.overlay.destroy();this._set("overlay",null);b.destroy(this.root);this._set("root",null);b.destroy(this.userContent);this._set("userContent",null)}if(a){a.classList.add("esri-view");
c=document.createElement("div");for(c.className="esri-view-user-storage";a.hasChildNodes();)c.appendChild(a.firstChild);a.appendChild(c);c=document.createElement("div");c.className="esri-view-root";a.insertBefore(c,a.firstChild);this._set("root",c);var l=document.createElement("div");l.className="esri-view-surface";l.setAttribute("role","application");l.tabIndex=0;l.addEventListener("focus",this._focusEvent);l.addEventListener("blur",this._blurEvent);f.setSelectable(l,!1);c.appendChild(l);this._set("surface",
l);h=new r;c.appendChild(h.surface);this._set("overlay",h);h.watch("needsRender",function(a){a&&!e._overlayRenderTaskHandle?e._overlayRenderTaskHandle=k.addFrameTask({render:function(){e.overlay.render()}}):e._overlayRenderTaskHandle&&(e._overlayRenderTaskHandle.remove(),e._overlayRenderTaskHandle=null)});this._forceReadyCycle();this._domHandles.add(d.init(this,"size",function(a){var b=a[1];l.classList.toggle("esri-view-surface--inset-outline",a[0]>=document.body.clientWidth||b>=document.body.clientHeight)}),
"dom-size");this._set("container",a);this._startMeasuring();a=new p({enabled:!0,view:this});this._set("popupManager",a)}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"focused",{get:function(){return document.activeElement===this.surface},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"size",{get:function(){return[this.width,
this.height]},enumerable:!0,configurable:!0});h.prototype.blur=function(){this.surface&&this.surface.blur()};h.prototype.focus=function(){this.surface&&this.surface.focus()};h.prototype.pageToContainer=function(a,b,d){var e=this.position;a-=e[0];b-=e[1];d?(d[0]=a,d[1]=b):d=[a,b];return d};h.prototype.containerToPage=function(a,b,d){var e=this.position;a+=e[0];b+=e[1];d?(d[0]=a,d[1]=b):d=[a,b];return d};h.prototype._handleUIChange=function(a,b){b&&(this._domHandles.remove("ui"),b.destroy());a&&this._wireUI(a);
this._set("ui",a)};h.prototype._wireUI=function(a){this._domHandles.remove("ui");a&&(a.view=this,this._domHandles.add([d.init(this,"root",function(d){a.container=d?b.create("div",null,d):null}),d.init(this,"popup",function(b,d){d&&(a.remove(d,"popup"),d!==b&&d.destroy());b&&(b.view=a.view,a.add(b,{key:"popup",position:"manual"}))})],"ui"))};h.prototype._focusEvent=function(a){this.notifyChange("focused");this.emit("focus",{native:a})};h.prototype._blurEvent=function(a){this.notifyChange("focused");
this.emit("blur",{native:a})};h.prototype._stopMeasuring=function(){this._domHandles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};h.prototype._startMeasuring=function(){var a=this,b=this._freqInfo;b.freq=16;b.time=750;this._domHandles.add([l(window,"resize",function(){b.freq=16;b.time=750}),k.addFrameTask({prepare:function(b){var d=a._measure(),e=a._freqInfo;e.time+=b.deltaTime;d&&(e.freq=16,a._get("resizing")||a._set("resizing",!0));e.time<e.freq||(e.time=0,a._position()||
d?e.freq=16:e.freq=Math.min(750,2*e.freq),!d&&512<=e.freq&&a._get("resizing")&&a._set("resizing",!1))}})],"measuring");this._measure();this._position()};h.prototype._measure=function(){var a=this.container,b=a?a.clientWidth:0,d=a?a.clientHeight:0;if(0===b||0===d||"hidden"===window.getComputedStyle(a).visibility)return this.suspended||this._set("suspended",!0),!1;var a=this.width,e=this.height;if(b===a&&d===e)return this.suspended&&this._set("suspended",!1),!1;this._set("width",b);this._set("height",
d);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:a,oldHeight:e,width:b,height:d});return!0};h.prototype._position=function(){var a=this.container,b=this.position,d=(a.ownerDocument||window.document).defaultView,a=a.getBoundingClientRect();t[0]=a.left+d.pageXOffset;t[1]=a.top+d.pageYOffset;return b&&t[0]===b[0]&&t[1]===b[1]?!1:(this._set("position",[t[0],t[1]]),!0)};a([q.property({value:null,cast:function(a){return f.byId(a)}})],h.prototype,"container",null);a([q.property({readOnly:!0,
dependsOn:["surface"]})],h.prototype,"focused",null);a([q.property({readOnly:!0})],h.prototype,"height",void 0);a([q.property({type:u})],h.prototype,"popup",void 0);a([q.property({type:p})],h.prototype,"popupManager",void 0);a([q.property({type:r})],h.prototype,"overlay",void 0);a([q.property({readOnly:!0})],h.prototype,"position",void 0);a([q.property({readOnly:!0})],h.prototype,"resizing",void 0);a([q.property({readOnly:!0})],h.prototype,"root",void 0);a([q.property({value:null,dependsOn:["width",
"height"],readOnly:!0})],h.prototype,"size",null);a([q.property({readOnly:!0})],h.prototype,"surface",void 0);a([q.property({readOnly:!0})],h.prototype,"suspended",void 0);a([q.property()],h.prototype,"ui",void 0);a([q.property({readOnly:!0})],h.prototype,"userContent",void 0);a([q.property({readOnly:!0})],h.prototype,"width",void 0);return h=a([q.subclass("esri.views.DOMContainer")],h)}(q.declared(e,h))})},"esri/views/overlay/ViewOverlay":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators maquette".split(" "),
function(n,g,c,a,f,b,l,e,h){return function(b){function k(){var a=null!==b&&b.apply(this,arguments)||this;a.items=new l;a._callbacks=new Map;a._projector=h.createProjector();a._hiddenProjector=h.createProjector();return a}c(k,b);Object.defineProperty(k.prototype,"needsRender",{get:function(){return 0<this.items.length},enumerable:!0,configurable:!0});k.prototype.initialize=function(){var a=this,b=document.createElement("div");b.className="esri-overlay-surface";f.setSelectable(b,!1);this._set("surface",
b);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style","visibility: hidden;");b.appendChild(this._hiddenSurface);this._itemsChangeHandle=this.items.on("change",function(b){b.added.map(function(b){var d=function(){return b.render()};a._callbacks.set(b,d);a._projector.append(a.surface,d)});b.removed.map(function(b){var d=a._projector.detach(a._callbacks.get(b));a.surface.removeChild(d.domNode);a._callbacks.delete(b)})})};k.prototype.addItem=function(a){this.items.add(a)};
k.prototype.removeItem=function(a){this.items.remove(a)};k.prototype.destroy=function(){this.items.removeAll();this._itemsChangeHandle.remove();this._projector=this._callbacks=null};k.prototype.render=function(){this._projector.renderNow()};k.prototype.computeBoundingRect=function(a){var b=this._hiddenSurface,d=this._hiddenProjector,e=null,c=function(){return e=a.render()};d.append(b,c);d.renderNow();var f={left:0,top:0,right:0,bottom:0};if(e&&e.domNode){var h=e.domNode.getBoundingClientRect();f.left=
h.left;f.top=h.top;f.right=h.right;f.bottom=h.bottom}for(d.detach(c);b.firstChild;)b.removeChild(b.firstChild);return f};k.prototype.overlaps=function(a,b){a=this.computeBoundingRect(a);b=this.computeBoundingRect(b);return Math.max(a.left,b.left)<=Math.min(a.right,b.right)&&Math.max(a.top,b.top)<=Math.min(a.bottom,b.bottom)};a([e.property({readOnly:!0})],k.prototype,"surface",void 0);a([e.property({readOnly:!0})],k.prototype,"items",void 0);a([e.property({readOnly:!0,dependsOn:["items.length"]})],
k.prototype,"needsRender",null);return k=a([e.subclass("esri.views.overlay.ViewOverlay")],k)}(e.declared(b))})},"esri/widgets/Popup":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/assignHelper dojo/dom-geometry dojo/i18n!./Popup/nls/Popup dojo/keys ../core/Handles ../core/lang ../core/Logger ../core/watchUtils ../core/accessorSupport/decorators ./Feature ./Spinner ./Widget ./Popup/PopupViewModel ./support/widget ./support/widgetUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A){function z(a,b){return void 0===b?"esri-popup__"+a:"esri-popup__"+a+"-"+b}var x={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},B=k.getLogger("esri.widgets.Popup");return function(k){function u(a){a=k.call(this)||this;a._blurContainer=!1;a._containerNode=null;a._mainContainerNode=null;a._featureMenuNode=null;a._focusContainer=!1;a._focusDockButton=!1;a._focusFeatureMenuButton=!1;a._focusFirstFeature=!1;a._handles=new h;a._displayActionTextLimit=
2;a._pointerOffsetInPx=16;a._spinner=null;a.actions=null;a.alignment="auto";a.autoCloseEnabled=null;a.content=null;a.collapsed=!1;a.collapseEnabled=!0;a.dockEnabled=!1;a.featureCount=null;a.features=null;a.featureNavigationEnabled=!0;a.goToOverride=null;a.highlightEnabled=null;a.location=null;a.featureWidgets=[];a.promises=null;a.selectedFeature=null;a.selectedFeatureIndex=null;a.selectedFeatureWidget=null;a.spinnerEnabled=!0;a.title=null;a.updateLocationEnabled=null;a.view=null;a.viewModel=new t;
a.visible=null;return a}c(u,k);u.prototype.postInitialize=function(){var a=this;this._addSelectedFeatureIndexHandle();this.own(d.watch(this,"viewModel.screenLocation",function(){return a._positionContainer()}),d.watch(this,["viewModel.visible","dockEnabled"],function(){return a._toggleScreenLocationEnabled()}),d.watch(this,"viewModel.screenLocation",function(b,d){!!b!==!!d&&a.reposition()}),d.watch(this,"viewModel.features",function(b){return a._createFeatureWidgets(b)}),d.watch(this,"viewModel.view.padding viewModel.view.size viewModel.visible viewModel.waitingForResult viewModel.location alignment".split(" "),
function(){return a.reposition()}),d.watch(this,"spinnerEnabled",function(b){return a._spinnerEnabledChange(b)}),d.watch(this,"viewModel.view.size",function(b,d){return a._updateDockEnabledForViewSize(b,d)}),d.watch(this,"viewModel.view",function(b,d){return a._viewChange(b,d)}),d.watch(this,"viewModel.view.ready",function(b,d){return a._viewReadyChange(b,d)}),d.watch(this,["viewModel.waitingForResult","viewModel.location"],function(){return a._displaySpinner()}),d.watch(this,["featureWidgets","viewModel.selectedFeatureIndex"],
function(){return a._updateFeatureWidget()}),d.watch(this,"selectedFeatureWidget.viewModel.title",function(b){return a._setTitleFromFeatureWidget(b)}),d.watch(this,["selectedFeatureWidget.viewModel.content","selectedFeatureWidget.viewModel.waitingForContent"],function(){return a._setContentFromFeatureWidget()}),d.on(this,"viewModel","trigger-action",function(b){return a._zoomToAction(b)}))};u.prototype.destroy=function(){this._destroyFeatureWidgets();this._destroySpinner();this._handles&&this._handles.destroy();
this._handles=null};Object.defineProperty(u.prototype,"currentAlignment",{get:function(){return this._getCurrentAlignment()},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"currentDockPosition",{get:function(){return this._getCurrentDockPosition()},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"dockOptions",{get:function(){return this._get("dockOptions")||x},set:function(a){var b=f({},x),d=this.get("viewModel.view.breakpoints"),e={};d&&(e.width=d.xsmall,e.height=
d.xsmall);a=f({},b,a);b=f({},b.breakpoint,e);e=a.breakpoint;!0===e?a.breakpoint=b:"object"===typeof e&&(a.breakpoint=f({},b,e));this._set("dockOptions",a);this._setCurrentDockPosition();this.reposition()},enumerable:!0,configurable:!0});Object.defineProperty(u.prototype,"featureMenuOpen",{get:function(){return this.viewModel.visible?this._get("featureMenuOpen"):!1},set:function(a){this._set("featureMenuOpen",!!a)},enumerable:!0,configurable:!0});u.prototype.blur=function(){this.visible||B.warn("Popup cannot be blurred while visible is false");
this._blurContainer=!0;this.scheduleRender()};u.prototype.clear=function(){};u.prototype.close=function(){this.visible=!1};u.prototype.focus=function(){this.visible||B.warn("Popup cannot be focused while visible is false");this._focusContainer=!0;this.scheduleRender()};u.prototype.next=function(){return null};u.prototype.open=function(a){this._handles.remove("selected-index");this.set({featureMenuOpen:a?!!a.featureMenuOpen:!1});this.viewModel.open(a);this._addSelectedFeatureIndexHandle()};u.prototype.previous=
function(){return null};u.prototype.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};u.prototype.triggerAction=function(a){return null};u.prototype.render=function(){var a,b,d,e,c,f,h,k=this.collapsed,p=this.collapseEnabled,q=this.dockEnabled,t=this.featureMenuOpen,r=this.featureNavigationEnabled,u=this.featureWidgets,x=this.visible,B=this.viewModel,g=B.allActions,D=B.content,C=B.featureCount,n=B.pendingPromisesCount,ea=B.selectedFeatureIndex,Z=B.title,
B=1<C&&r,r=1<C&&t,da=p&&!r&&k,k=g&&g.length,W=B&&this._getPageText(C,ea),ja=this._renderContent(),ca=A.isRtl(),ba=this.get("selectedFeatureWidget")?this.get("selectedFeatureWidget.viewModel.waitingForContent")||this.get("selectedFeatureWidget.viewModel.content"):ja,ha=q?l.undock:l.dock,C=this.currentAlignment,g=this.currentDockPosition,n=n?v.tsx("div",{key:z("loading-container"),role:"presentation",class:"esri-popup__loading-container","aria-label":l.loading,title:l.loading},v.tsx("span",{"aria-hidden":"true",
class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})):null,fa=(a={},a["esri-icon-layer-list"]=!r,a["esri-icon-close"]=r,a);a=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",fa)});fa=(b={},b["esri-icon-right-triangle-arrow"]=ca,b["esri-popup__pagination-previous-icon--rtl"]=ca,b["esri-icon-left-triangle-arrow"]=!ca,b["esri-popup__pagination-previous-icon"]=!ca,b);b=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",fa)});
fa=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":l.previous,title:l.previous},b);b=(d={},d["esri-icon-left-triangle-arrow"]=ca,d["esri-popup__pagination-next-icon--rtl"]=ca,d["esri-icon-right-triangle-arrow"]=!ca,d["esri-popup__pagination-next-icon"]=!ca,d);d=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",b)});ca=v.tsx("div",{role:"button",
tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":l.next,title:l.next},d);b=A.cssTransition("enter","esri-popup--feature-updated");d=this.id+"-feature-menu";t=v.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),
"aria-haspopup":"true","aria-controls":d,"aria-expanded":t,"aria-label":l.menu,title:l.menu},a);W=v.tsx("div",{class:"esri-popup__pagination-page-text"},W);t=B?v.tsx("div",{class:"esri-popup__navigation-buttons",enterAnimation:b},fa,W,ca,n||t):null;W=this._wouldDockTo();W=(e={},e["esri-icon-minimize"]=q,e["esri-popup__icon--dock-icon"]=!q,e["esri-icon-dock-right"]=!q&&("top-right"===W||"bottom-right"===W),e["esri-icon-dock-left"]=!q&&("top-left"===W||"bottom-left"===W),e["esri-icon-maximize"]=!q&&
"top-center"===W,e["esri-icon-dock-bottom"]=!q&&"bottom-center"===W,e);e=v.tsx("span",{"aria-hidden":"true",class:this.classes(W,"esri-popup__icon")});e=this.get("dockOptions.buttonEnabled")?v.tsx("div",{role:"button","aria-label":ha,title:ha,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},e):null;p=p&&Z&&(ba||k||B);
ha=(c={},c["esri-popup__header-title--button"]=p,c);W=p?"button":"heading";n=p?da?l.expand:l.collapse:"";c=this.id+"-popup-title";Z=Z?v.tsx("h2",{class:this.classes("esri-popup__header-title",ha),key:Z,enterAnimation:b,id:c,role:W,"aria-label":n,title:n,bind:this,tabIndex:p?0:-1,onclick:this._toggleCollapsed,onkeydown:this._toggleCollapsed,innerHTML:Z}):null;p=v.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")});p=v.tsx("div",{role:"button",tabIndex:0,bind:this,
onclick:this._close,onkeydown:this._close,class:"esri-popup__button","aria-label":l.close,title:l.close},p);p=v.tsx("header",{class:"esri-popup__header"},Z,v.tsx("div",{class:"esri-popup__header-buttons"},e,p));e=this.id+"-popup-content";D=ba&&!da?v.tsx("article",{key:D,enterAnimation:b,id:e,class:"esri-popup__content"},ja):null;ja=!da&&("bottom-left"===C||"bottom-center"===C||"bottom-right"===C||"top-left"===g||"top-center"===g||"top-right"===g);da=!da&&("top-left"===C||"top-center"===C||"top-right"===
C||"bottom-left"===g||"bottom-center"===g||"bottom-right"===g);ba=r?null:v.tsx("div",{key:z("actions"),class:"esri-popup__actions"},this._renderActions());b=v.tsx("section",{key:z("navigation"),class:"esri-popup__navigation"},t);B=B||k?v.tsx("div",{key:z("feature-buttons"),class:"esri-popup__feature-buttons"},ba,b):null;ea=this._renderFeatureMenuNode(u,ea,r,d);u=m.substitute({total:u.length},l.selectedFeatures);d=v.tsx("section",{key:z("menu"),class:"esri-popup__feature-menu"},v.tsx("h2",{class:"esri-popup__feature-menu-header"},
u),v.tsx("nav",{class:"esri-popup__feature-menu-viewport",afterCreate:this._featureMenuViewportNodeUpdated,afterUpdate:this._featureMenuViewportNodeUpdated},ea));u=q?null:v.tsx("div",{key:z("pointer"),class:"esri-popup__pointer",role:"presentation"},v.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}));ea=this.get("selectedFeature.layer.title");k=this.get("selectedFeature.layer.id");ba=(f={},f["esri-popup--shadow"]=q,f);f=(h={},h["esri-popup--aligned-top-center"]=
x&&"top-center"===C,h["esri-popup--aligned-bottom-center"]=x&&"bottom-center"===C,h["esri-popup--aligned-top-left"]=x&&"top-left"===C,h["esri-popup--aligned-bottom-left"]=x&&"bottom-left"===C,h["esri-popup--aligned-top-right"]=x&&"top-right"===C,h["esri-popup--aligned-bottom-right"]="bottom-right"===C,h["esri-popup--is-docked"]=x&&q,h["esri-popup--shadow"]=x&&!q,h["esri-popup--is-docked-top-left"]=x&&"top-left"===g,h["esri-popup--is-docked-top-center"]=x&&"top-center"===g,h["esri-popup--is-docked-top-right"]=
x&&"top-right"===g,h["esri-popup--is-docked-bottom-left"]=x&&"bottom-left"===g,h["esri-popup--is-docked-bottom-center"]=x&&"bottom-center"===g,h["esri-popup--is-docked-bottom-right"]=x&&"bottom-right"===g,h["esri-popup--feature-menu-open"]=x&&r,h);h=ja?d:null;q=da?d:null;r=ja?B:null;C=da?B:null;h=v.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",ba),tabIndex:-1,role:"dialog","aria-labelledby":Z?c:"","aria-describedby":D?e:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,
afterUpdate:this._mainContainerNodeUpdated},r,h,p,D,C,q);return v.tsx("div",{key:z("base"),class:this.classes("esri-popup",f),role:"presentation","data-layer-title":ea,"data-layer-id":k,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},x?[h,u]:null)};u.prototype._featureMenuOpenChanged=function(a){a?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};u.prototype._setTitleFromFeatureWidget=function(a){this.selectedFeatureWidget&&(this.viewModel.title=a||"")};
u.prototype._setContentFromFeatureWidget=function(){var a=this.selectedFeatureWidget;a&&(this.viewModel.content=a)};u.prototype._handleFeatureMenuKeyup=function(a){a.keyCode===e.ESCAPE&&(a.stopPropagation(),this.featureMenuOpen=!1)};u.prototype._handleFeatureMenuItemKeyup=function(a){var b=a.keyCode,d=this._featureMenuNode,c=this.get("features.length"),h=a.currentTarget["data-feature-index"];d&&(d=d.querySelectorAll("li"),b===e.UP_ARROW?(a.stopPropagation(),d[(h-1+c)%c].focus()):b===e.DOWN_ARROW?
(a.stopPropagation(),d[(h+1+c)%c].focus()):b===e.HOME?(a.stopPropagation(),d[0].focus()):b===e.END&&(a.stopPropagation(),d[d.length-1].focus()))};u.prototype._handleMainKeyup=function(a){var b=a.keyCode;b===e.LEFT_ARROW&&(a.stopPropagation(),this.previous());b===e.RIGHT_ARROW&&(a.stopPropagation(),this.next())};u.prototype._zoomToAction=function(a){a.action&&!a.action.disabled&&"zoom-to"===a.action.id&&this.viewModel.zoomToLocation()};u.prototype._spinnerEnabledChange=function(a){this._destroySpinner();
a&&(a=this.get("viewModel.view"),this._createSpinner(a))};u.prototype._displaySpinner=function(){var a=this._spinner;if(a){var b=this.viewModel,d=b.location;b.waitingForResult?a.show({location:d}):a.hide()}};u.prototype._getIconStyles=function(a){return{"background-image":a?"url("+a+")":""}};u.prototype._renderAction=function(a,b,e,c){var h=this,f,k,p=d.watch(a,"active className disabled id title image visible".split(" "),function(){return h.scheduleRender()});this._handles.add(p,c);p=this.get("selectedFeature.attributes");
"zoom-to"===a.id&&(a.title=l.zoom,a.className="esri-icon-zoom-in-magnifying-glass");c=a.title;var q=a.className,t=a.image,q=t||q?q:"esri-icon-default-action";c=c&&p?m.substitute(p,c):c;var r=q&&p?m.substitute(p,q):q,p=t&&p?m.substitute(p,t):t,t=(f={},f["esri-icon-loading-indicator"]=a.active,f["esri-rotating"]=a.active,f["esri-popup__icon"]=!!q,f["esri-popup__action-image"]=!a.active&&!!p,f);r&&(t[r]=!a.active);f=(k={},k["esri-popup__action"]="toggle"!==a.type,k["esri-popup__action-toggle"]="toggle"===
a.type,k["esri-popup__action-toggle--on"]="toggle"===a.type&&a.value,k["esri-popup__button--disabled"]=a.disabled,k);e=e<=this._displayActionTextLimit?v.tsx("span",{key:"text",class:"esri-popup__action-text"},c):null;return a.visible?v.tsx("div",{key:a,role:"button",tabIndex:0,title:c,"aria-label":c,class:this.classes("esri-popup__button",f),bind:this,"data-action-index":b,onclick:this._triggerAction,onkeydown:this._triggerAction},v.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",
t),styles:this._getIconStyles(p)}),e):null};u.prototype._renderActions=function(){var a=this;this._handles.remove("actions");var b=this.viewModel.allActions;if(b){var d=b.length;return b.map(function(b,e){return a._renderAction(b,e,d,"actions")}).toArray()}};u.prototype._addSelectedFeatureIndexHandle=function(){var a=this,b=d.watch(this,"viewModel.selectedFeatureIndex",function(b,d){return a._selectedFeatureIndexUpdated(b,d)});this._handles.add(b,"selected-index")};u.prototype._selectedFeatureIndexUpdated=
function(a,b){var d=this.featureMenuOpen;this.featureCount&&d&&a!==b&&-1!==a&&(this.featureMenuOpen=!1)};u.prototype._updateFeatureWidget=function(){var a=this.featureWidgets[this.viewModel.selectedFeatureIndex]||null;a&&!a.contentEnabled&&(a.contentEnabled=!0);this._set("selectedFeatureWidget",a)};u.prototype._destroyFeatureWidgets=function(){this.featureWidgets.forEach(function(a){return a.destroy()});this._set("featureWidgets",[])};u.prototype._createFeatureWidgets=function(a){var b=this.featureWidgets.slice(0),
d=this.get("viewModel.view"),e=[];a.forEach(function(a,c){if(a){var h=null;b.some(function(d,e){d&&d.graphic===a&&(h=d,b.splice(e,1));return!!h});e[c]=h||new p({contentEnabled:!1,graphic:a,view:d})}});b.forEach(function(a){return a&&a.destroy()});this._set("featureWidgets",e)};u.prototype._isScreenLocationWithinView=function(a,b){return-1<a.x&&-1<a.y&&a.x<=b.width&&a.y<=b.height};u.prototype._isOutsideView=function(a){var b=a.popupHeight,d=a.popupWidth,e=a.screenLocation,c=a.side;a=a.view;if(isNaN(d)||
isNaN(b)||!a||!e)return!1;var h=a.padding;return"right"===c&&e.x+d/2>a.width-h.right||"left"===c&&e.x-d/2<h.left||"top"===c&&e.y-b<h.top||"bottom"===c&&e.y+b>a.height-h.bottom?!0:!1};u.prototype._determineCurrentAlignment=function(){var a=this._pointerOffsetInPx,d=this._containerNode,e=this._mainContainerNode,c=this.viewModel,h=c.screenLocation,c=c.view;if(!h||!c||!d)return"top-center";if(!this._isScreenLocationWithinView(h,c))return this._get("currentAlignment")||"top-center";var f=e?window.getComputedStyle(e,
null):null,e=f?parseInt(f.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,f=f?parseInt(f.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0,l=b.getContentBox(d),d=l.w+a,l=Math.max(l.h,e,f)+a,a=this._isOutsideView({popupHeight:l,popupWidth:d,screenLocation:h,side:"right",view:c}),e=this._isOutsideView({popupHeight:l,popupWidth:d,screenLocation:h,side:"left",view:c}),f=this._isOutsideView({popupHeight:l,popupWidth:d,screenLocation:h,side:"top",view:c}),h=this._isOutsideView({popupHeight:l,
popupWidth:d,screenLocation:h,side:"bottom",view:c});return e?f?"bottom-right":"top-right":a?f?"bottom-left":"top-left":f?h?"top-center":"bottom-center":"top-center"};u.prototype._getCurrentAlignment=function(){var a=this.alignment;return this.dockEnabled?null:"auto"===a?this._determineCurrentAlignment():"function"===typeof a?a.call(this):a};u.prototype._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};u.prototype._setCurrentDockPosition=function(){this._set("currentDockPosition",
this._getCurrentDockPosition())};u.prototype._getDockPosition=function(){var a=this.get("dockOptions.position");return"auto"===a?this._determineCurrentDockPosition():"function"===typeof a?a.call(this):a};u.prototype._getCurrentDockPosition=function(){return this.dockEnabled?this._getDockPosition():null};u.prototype._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};u.prototype._renderFeatureMenuItemNode=function(a,b,d,e){var c,h=b===d;e=(c={},c["esri-popup__feature-menu-item--selected"]=
h,c);c=h?v.tsx("span",{key:z("feature-menu-selected-feature-"+d),title:l.selectedFeature,"aria-label":l.selectedFeature,class:"esri-icon-check-mark"}):null;a=v.tsx("span",{innerHTML:a.title||l.untitled});return v.tsx("li",{role:"menuitem",tabIndex:-1,key:z("feature-menu-feature-"+d),class:this.classes(e,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":b,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature},v.tsx("span",{class:"esri-popup__feature-menu-title"},
a,c))};u.prototype._renderFeatureMenuNode=function(a,b,d,e){var c=this;return 1<a.length?v.tsx("ol",{class:"esri-popup__feature-menu-list",id:e,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},a.map(function(a,e){return c._renderFeatureMenuItemNode(a,e,b,d)})):null};u.prototype._determineCurrentDockPosition=function(){var a=this.get("viewModel.view"),b=A.isRtl()?"top-left":"top-right";if(!a)return b;var d=
a.padding||{left:0,right:0,top:0,bottom:0},d=a.width-d.left-d.right;return(a=a.get("breakpoints"))&&d<=a.xsmall?"bottom-center":b};u.prototype._renderContent=function(){var a=this.get("viewModel.content");if("string"===typeof a)return v.tsx("div",{key:a,innerHTML:a});if(v.isWidget(a))return v.tsx("div",{key:a},a.render());if(a instanceof HTMLElement)return v.tsx("div",{key:a,bind:a,afterCreate:this._attachToNode});if(v.isWidgetBase(a))return v.tsx("div",{key:a,bind:a.domNode,afterCreate:this._attachToNode})};
u.prototype._attachToNode=function(a){a.appendChild(this)};u.prototype._positionContainer=function(a){void 0===a&&(a=this._containerNode);a&&(this._containerNode=a);if(a){var d=this.viewModel.screenLocation,e=b.getContentBox(a);if(d=this._calculatePositionStyle(d,e))a.style.top=d.top,a.style.left=d.left,a.style.bottom=d.bottom,a.style.right=d.right}};u.prototype._calculateFullWidth=function(a){var b=this.currentAlignment,d=this._pointerOffsetInPx;return"top-left"===b||"bottom-left"===b||"top-right"===
b||"bottom-right"===b?a+d:a};u.prototype._calculateAlignmentPosition=function(a,b,d,e){var c=this.currentAlignment,h=this._pointerOffsetInPx;e/=2;var f=d.height-b;d=d.width-a;var l=this.view.padding;if("bottom-center"===c)return{top:b+h-l.top,left:a-e-l.left};if("top-left"===c)return{bottom:f+h-l.bottom,right:d+h-l.right};if("bottom-left"===c)return{top:b+h-l.top,right:d+h-l.right};if("top-right"===c)return{bottom:f+h-l.bottom,left:a+h-l.left};if("bottom-right"===c)return{top:b+h-l.top,left:a+h-l.left};
if("top-center"===c)return{bottom:f+h-l.bottom,left:a-e-l.left}};u.prototype._calculatePositionStyle=function(a,b){var d=this.view;if(d){if(this.dockEnabled)return{left:"",top:"",right:"",bottom:""};if(a&&b&&(b=this._calculateFullWidth(b.w),a=this._calculateAlignmentPosition(a.x,a.y,d,b)))return{top:void 0!==a.top?a.top+"px":"auto",left:void 0!==a.left?a.left+"px":"auto",bottom:void 0!==a.bottom?a.bottom+"px":"auto",right:void 0!==a.right?a.right+"px":"auto"}}};u.prototype._viewChange=function(a,
b){a&&b&&(this.close(),this.clear())};u.prototype._viewReadyChange=function(a,b){a?(a=this.get("viewModel.view"),this._wireUpView(a)):b&&(this.close(),this.clear())};u.prototype._wireUpView=function(a){this._destroySpinner();a&&(this.spinnerEnabled&&this._createSpinner(a),this._setDockEnabledForViewSize(this.dockOptions))};u.prototype._dockingThresholdCrossed=function(a,b,d){var e=a[0];a=a[1];var c=b[0];b=b[1];var h=d.width;d=d.height;return e<=h&&c>h||e>h&&c<=h||a<=d&&b>d||a>d&&b<=d};u.prototype._updateDockEnabledForViewSize=
function(a,b){if(a&&b){var d=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},e=d.left+d.right,c=d.top+d.bottom,d=[],h=[];d[0]=a[0]-e;d[1]=a[1]-c;h[0]=b[0]-e;h[1]=b[1]-c;a=this.dockOptions;this._dockingThresholdCrossed(d,h,a.breakpoint)&&this._setDockEnabledForViewSize(a);this._setCurrentDockPosition()}};u.prototype._focusDockButtonNode=function(a){this._focusDockButton&&(this._focusDockButton=!1,a.focus())};u.prototype._mainContainerNodeUpdated=function(a){this._mainContainerNode=
a;this._focusContainer?(this._focusContainer=!1,a.focus()):this._blurContainer&&(this._blurContainer=!1,a.blur())};u.prototype._featureMenuNodeUpdated=function(a){(this._featureMenuNode=a)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,a=a.querySelectorAll("li"),a.length&&a[0].focus())};u.prototype._focusFeatureMenuButtonNode=function(a){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,a.focus())};u.prototype._featureMenuViewportNodeUpdated=function(a){a&&(a.scrollTop=0)};u.prototype._toggleScreenLocationEnabled=
function(){var a=this.dockEnabled,b=this.viewModel;b&&(b.screenLocationEnabled=this.visible&&!a)};u.prototype._shouldDockAtCurrentViewSize=function(a){a=a.breakpoint;var b=this.get("viewModel.view.ui"),d=b.width,b=b.height;if(isNaN(d)||isNaN(b))return!1;d=a.hasOwnProperty("width")&&d<=a.width;a=a.hasOwnProperty("height")&&b<=a.height;return d||a};u.prototype._setDockEnabledForViewSize=function(a){a.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(a))};u.prototype._getPageText=function(a,
b){return m.substitute({index:b+1,total:a},l.pageText)};u.prototype._destroySpinner=function(){var a=this._spinner,b=this.view;a&&(b&&b.ui.remove(this._spinner,"popup-spinner"),a.destroy(),this._spinner=null)};u.prototype._createSpinner=function(a){a&&(this._spinner=new r({view:a}),a.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};u.prototype._toggleCollapsed=function(){this.collapsed=!this.collapsed};u.prototype._close=function(){this.close();this.view&&this.view.focus()};u.prototype._toggleDockEnabled=
function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};u.prototype._toggleFeatureMenu=function(){var a=!this.featureMenuOpen;this._featureMenuOpenChanged(a);this.featureMenuOpen=a};u.prototype._triggerAction=function(a){a=a.currentTarget["data-action-index"];var b=this.viewModel.allActions.getItemAt(a);b&&"toggle"===b.type&&(b.value=!b.value);this.viewModel.triggerAction(a)};u.prototype._selectFeature=function(a){a=a.currentTarget["data-feature-index"];isNaN(a)||
(this.viewModel.selectedFeatureIndex=a)};u.prototype._next=function(){this.next()};u.prototype._previous=function(){this.previous()};a([q.aliasOf("viewModel.actions"),v.renderable()],u.prototype,"actions",void 0);a([q.property()],u.prototype,"alignment",void 0);a([q.aliasOf("viewModel.autoCloseEnabled")],u.prototype,"autoCloseEnabled",void 0);a([q.aliasOf("viewModel.content"),v.renderable()],u.prototype,"content",void 0);a([q.property(),v.renderable()],u.prototype,"collapsed",void 0);a([q.property(),
v.renderable()],u.prototype,"collapseEnabled",void 0);a([q.property({readOnly:!0,dependsOn:["dockEnabled","alignment"]}),v.renderable()],u.prototype,"currentAlignment",null);a([q.property({readOnly:!0,dependsOn:["viewModel.view.ready","dockEnabled","dockOptions"]}),v.renderable()],u.prototype,"currentDockPosition",null);a([q.property(),v.renderable()],u.prototype,"dockOptions",null);a([q.property(),v.renderable()],u.prototype,"dockEnabled",void 0);a([q.aliasOf("viewModel.featureCount"),v.renderable()],
u.prototype,"featureCount",void 0);a([q.property({dependsOn:["viewModel.visible"]}),v.renderable()],u.prototype,"featureMenuOpen",null);a([q.aliasOf("viewModel.features"),v.renderable()],u.prototype,"features",void 0);a([q.property(),v.renderable()],u.prototype,"featureNavigationEnabled",void 0);a([q.aliasOf("viewModel.goToOverride")],u.prototype,"goToOverride",void 0);a([q.aliasOf("viewModel.highlightEnabled")],u.prototype,"highlightEnabled",void 0);a([q.aliasOf("viewModel.location"),v.renderable()],
u.prototype,"location",void 0);a([q.property({readOnly:!0}),v.renderable()],u.prototype,"featureWidgets",void 0);a([q.aliasOf("viewModel.promises")],u.prototype,"promises",void 0);a([q.aliasOf("viewModel.selectedFeature"),v.renderable()],u.prototype,"selectedFeature",void 0);a([q.aliasOf("viewModel.selectedFeatureIndex"),v.renderable()],u.prototype,"selectedFeatureIndex",void 0);a([q.property({readOnly:!0}),v.renderable()],u.prototype,"selectedFeatureWidget",void 0);a([q.property()],u.prototype,"spinnerEnabled",
void 0);a([q.aliasOf("viewModel.title"),v.renderable()],u.prototype,"title",void 0);a([q.aliasOf("viewModel.updateLocationEnabled")],u.prototype,"updateLocationEnabled",void 0);a([q.aliasOf("viewModel.view")],u.prototype,"view",void 0);a([q.property({type:t}),v.renderable("viewModel.allActions viewModel.screenLocation viewModel.screenLocationEnabled viewModel.state viewModel.pendingPromisesCount viewModel.promiseCount viewModel.waitingForResult".split(" ")),v.vmEvent(["triggerAction","trigger-action"])],
u.prototype,"viewModel",void 0);a([q.aliasOf("viewModel.visible"),v.renderable()],u.prototype,"visible",void 0);a([q.aliasOf("viewModel.clear")],u.prototype,"clear",null);a([q.aliasOf("viewModel.next")],u.prototype,"next",null);a([q.aliasOf("viewModel.previous")],u.prototype,"previous",null);a([q.aliasOf("viewModel.triggerAction")],u.prototype,"triggerAction",null);a([v.accessibleHandler()],u.prototype,"_toggleCollapsed",null);a([v.accessibleHandler()],u.prototype,"_close",null);a([v.accessibleHandler()],
u.prototype,"_toggleDockEnabled",null);a([v.accessibleHandler()],u.prototype,"_toggleFeatureMenu",null);a([v.accessibleHandler()],u.prototype,"_triggerAction",null);a([v.accessibleHandler()],u.prototype,"_selectFeature",null);a([v.accessibleHandler()],u.prototype,"_next",null);a([v.accessibleHandler()],u.prototype,"_previous",null);return u=a([q.subclass("esri.widgets.Popup")],u)}(q.declared(u))})},"esri/widgets/Feature":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Feature/nls/Feature dojo/keys ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Feature/FeatureViewModel ./Feature/support/attachmentUtils ./support/uriUtils ./support/widget".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p){function r(a,b){return void 0===b?"esri-feature__"+a:"esri-feature__"+a+"-"+b}return function(m){function t(a){a=m.call(this)||this;a._chartMap=new Map;a._activeMediaMap=new Map;a._chartRequirePromise=null;a._refreshTimers=new Map;a._mediaInfo=new Map;a.contentEnabled=null;a.graphic=null;a.title=null;a.view=null;a.viewModel=new k;return a}c(t,m);t.prototype.postInitialize=function(){var a=this;this.own(e.init(this,"viewModel.content",function(){return a._setupMediaRefreshTimers()}))};
t.prototype.destroy=function(){this._clearMediaRefreshTimers();this._activeMediaMap.clear();this._activeMediaMap=null;this._cancelChartModules();this._destroyCharts()};t.prototype.render=function(){var a=p.tsx("div",{key:r("loading-container"),class:"esri-feature__loading-container"},p.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")})),a=this.viewModel.waitingForContent?a:this._renderContent();return p.tsx("div",{class:"esri-feature"},p.tsx("div",
{class:"esri-feature__size-container"},p.tsx("div",{class:"esri-feature__main-container"},a)))};t.prototype.goToMedia=function(a,b){this._setContentElementMedia(a,b)};t.prototype.nextMedia=function(a){this._pageContentElementMedia(a,"next")};t.prototype.previousMedia=function(a){this._pageContentElementMedia(a,"previous")};t.prototype._cancelChartModules=function(){var a=this._chartRequirePromise;a&&a.cancel();this._chartRequirePromise=null};t.prototype._destroyChart=function(a){var b=this._chartMap.get(a);
b&&(b.chart.destroy(),b.tooltip.destroy());this._chartMap.delete(a)};t.prototype._destroyCharts=function(){this._chartMap.forEach(function(a){a.chart.destroy();a.tooltip.destroy()});this._chartMap.clear()};t.prototype._renderContent=function(){this._destroyCharts();var a=this.viewModel.content;if("string"===typeof a)return p.tsx("div",{key:r("content-string"),innerHTML:a});if(p.isWidget(a))return p.tsx("div",{key:r("content-widget")},a.render());if(a instanceof HTMLElement)return p.tsx("div",{key:r("content-html-element"),
bind:a,afterCreate:this._attachToNode});if(p.isWidgetBase(a))return p.tsx("div",{key:r("content-dijit"),bind:a.domNode,afterCreate:this._attachToNode});if(Array.isArray(a))return a.length?p.tsx("div",{key:r("content-content-elements")},a.map(this._renderContentElement,this)):null};t.prototype._renderContentElement=function(a,b){switch(a.type){case "attachments":return this._renderAttachments(a,b);case "fields":return this._renderFields(a,b);case "media":return this._renderMedia(a,b);case "text":return this._renderText(a,
b);default:return null}};t.prototype._renderAttachmentInfo=function(a){var b,e,c=a.attachmentInfo,h=a.supportsResizeAttachments,l=c.contentType;a=c.name;var k=c.url,m=h&&d.isSupportedImage(l),q=-1===k.indexOf("?")?"?":"\x26",l=m?""+k+q+"w\x3d48":d.getIconPath(l),m=(b={},b["esri-feature__attachment-item-mask--icon"]=!m,b);b=(e={},e["esri-feature__attachments-image--resizable"]=h,e);return p.tsx("li",{class:"esri-feature__attachments-item",key:c},p.tsx("a",{class:"esri-feature__attachments-item-link",
href:k,target:"_blank"},p.tsx("div",{class:this.classes(m,"esri-feature__attachment-item-mask")},p.tsx("img",{alt:a,class:this.classes(b,"esri-feature__attachments-image"),title:a,src:l}),p.tsx("span",{class:"esri-feature__attachments-image-overlay"},p.tsx("span",{"aria-hidden":"true",class:"esri-feature__attachments-link-icon esri-icon-link-external"}))),p.tsx("span",{class:"esri-feature__attachments-filename"},a||f.noTitle)))};t.prototype._renderAttachments=function(a,b){var d=this,e,c=a.displayType,
h=(b=a.attachmentInfos)&&b.length,l=this.get("graphic.layer.capabilities.operations.supportsResizeAttachments"),c=(e={},e["esri-feature__attachments--list"]="preview"!==c,e["esri-feature__attachments--preview"]="preview"===c,e);return h?p.tsx("div",{key:r("attachments-element"),class:this.classes("esri-feature__attachments","esri-feature__content-element",c)},p.tsx("div",{class:"esri-feature__attachments-title"},f.attach),p.tsx("ul",{class:"esri-feature__attachments-items"},b.map(function(b,e){return d._renderAttachmentInfo({attachmentInfo:b,
attachmentInfoIndex:e,supportsResizeAttachments:l,contentElement:a})}))):null};t.prototype._forceLTR=function(a){return"\x26lrm;"+a};t.prototype._renderFieldInfo=function(a,b){var d,e=this.viewModel.formattedAttributes,c=e?e.content[b]||e.global:null,h=a.fieldName,e=a.label||h,c=c?null==c[h]?"":c[h]:"";a=!(!a.format||!a.format.dateFormat);c="number"!==typeof c||a?q.autoLink(c):this._forceLTR(c);a=(d={},d["esri-feature__field-data--date"]=a,d);return p.tsx("tr",{key:r("fields-element-info-row",b)},
p.tsx("th",{key:r("fields-element-info-row-header",b),class:"esri-feature__field-header",innerHTML:e}),p.tsx("td",{key:r("fields-element-info-row-data",b),class:this.classes("esri-feature__field-data",a),innerHTML:c}))};t.prototype._renderFields=function(a,b){var d=this;return(a=a.fieldInfos)?p.tsx("div",{key:r("fields-element",b),class:this.classes("esri-feature__fields","esri-feature__content-element")},p.tsx("table",{class:"esri-widget__table",summary:f.fieldsSummary,key:r("fields-element-table",
b)},p.tsx("tbody",{key:r("fields-element-table-body",b)},a.map(function(a){return d._renderFieldInfo(a,b)})))):null};t.prototype._shouldOpenInNewTab=function(a){void 0===a&&(a="");return!/^(?:mailto:|tel:)/.test(a.trim().toLowerCase())};t.prototype._clearMediaRefreshTimers=function(){this._refreshTimers.forEach(function(a){return clearTimeout(a)});this._refreshTimers.clear()};t.prototype._clearMediaRefreshTimer=function(a){var b=this._refreshTimers.get(a);b&&(clearTimeout(b),this._refreshTimers.delete(a))};
t.prototype._getImageSource=function(a,b){var d=-1!==a.indexOf("?")?"\x26":"?";a=a.split("#");var e=a[1],e=void 0===e?"":e;return""+a[0]+d+"timestamp\x3d"+b+(e?"#":"")+e};t.prototype._setupMediaRefreshTimer=function(a){var b=this.get("viewModel.content");if(Array.isArray(b)&&(b=b[a])&&"media"===b.type){var d=this._activeMediaMap.get(a);isNaN(d)&&(d=0);(b=b.mediaInfos[d])&&"image"===b.type&&b.refreshInterval&&this._setRefreshTimeout(a,b)}};t.prototype._setupMediaRefreshTimers=function(){var a=this;
this._clearMediaRefreshTimers();var b=this.get("viewModel.content");Array.isArray(b)&&b.forEach(function(b,d){return a._setupMediaRefreshTimer(d)})};t.prototype._updateMediaInfoTimestamp=function(a,b){var d=Date.now();this._mediaInfo.set(b,{timestamp:d,sourceURL:this._getImageSource(a,d)});this.scheduleRender()};t.prototype._setRefreshTimeout=function(a,b){var d=this,e=b.refreshInterval,c=b.value;e&&(b=6E4*e,this._updateMediaInfoTimestamp(c.sourceURL,a),b=setInterval(function(){d._updateMediaInfoTimestamp(c.sourceURL,
a)},b),this._refreshTimers.set(a,b))};t.prototype._renderMediaInfoType=function(a,b){var d=a.value,e=a.title,e=void 0===e?"":e,c=a.type,h=a.refreshInterval,f=d.sourceURL,d=d.linkURL;if("image"===c)return a=this._shouldOpenInNewTab(d)?"_blank":"_self",f=(h=h?this._mediaInfo.get(b):null)?h.sourceURL:f,b=p.tsx("img",{alt:e,key:r("media-image-"+(h?h.timestamp:0),b),src:f}),(e=d?p.tsx("a",{title:e,href:d,target:a},b):null)?e:b;if(-1!==c.indexOf("chart"))return p.tsx("div",{key:r("chart",b),bind:this,"data-media-info":a,
"data-content-element-index":b,class:"esri-feature__media-chart",afterCreate:this._getChartDependencies,afterUpdate:this._getChartDependencies})};t.prototype._getChartDependencies=function(a){var b=this,d=a["data-media-info"],e=a["data-content-element-index"],c=d.value,h=c.theme||"Claro",f=d.type,k=h;"string"===typeof h&&(k=h.replace(/\./g,"/"));this._cancelChartModules();this._chartRequirePromise=l.create(function(a){return n(["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip","dojox/charting/themes/"+
k],function(){for(var b=[],d=0;d<arguments.length;d++)b[d]=arguments[d];return a(b)})}).then(function(d){b._renderChart(a,e,f,c,d[0],d[1],d[2]);b._chartRequirePromise=null})};t.prototype._renderChart=function(a,b,d,e,c,h,f){a=new c(a,{margins:{l:4,t:4,r:4,b:4}});f&&a.setTheme(f);switch(d){case "pie-chart":a.addPlot("default",{type:"Pie",labels:!1});a.addSeries("Series A",e.chartOptions);break;case "line-chart":a.addPlot("default",{type:"Markers"});a.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,
majorLabels:!1,minorLabels:!1});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});e.chartOptions.forEach(function(a,b){a.x=b+1});a.addSeries("Series A",e.chartOptions);break;case "column-chart":a.addPlot("default",{type:"Columns",gap:3});a.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});a.addSeries("Series A",e.chartOptions);break;case "bar-chart":a.addPlot("default",{type:"Bars",gap:3}),a.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),a.addAxis("y",{vertical:!0,
majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),a.addSeries("Series A",e.chartOptions)}d=new h(a);a.render();this._chartMap.set(b,{chart:a,tooltip:d})};t.prototype._renderMediaInfo=function(a,b){this._destroyChart(b);var d=this._renderMediaInfoType(a,b),e=a.title?p.tsx("div",{key:r("media-title",b),class:"esri-feature__media-item-title",innerHTML:a.title}):null;a=a.caption?p.tsx("div",{key:r("media-caption",b),class:"esri-feature__media-item-caption",innerHTML:a.caption}):null;return p.tsx("div",
{key:r("media-container",b),class:"esri-feature__media-item-container"},p.tsx("div",{key:r("media-item-container",b),class:"esri-feature__media-item"},d),e,a)};t.prototype._renderMediaStatsItem=function(a,b,d){d="chart"===d?this.classes("esri-feature__media-chart-icon","esri-icon-chart"):this.classes("esri-feature__media-image-icon","esri-icon-media");return p.tsx("li",{class:"esri-feature__media-image-summary"},p.tsx("span",{"aria-hidden":"true",class:d}),p.tsx("span",{class:"esri-feature__media-count",
"aria-label":a},"("+b+")"))};t.prototype._renderMediaPageButton=function(a,b){var d=(a="previous"===a)?f.previous:f.next,e=a?this.classes("esri-feature__button","esri-feature__media-previous"):this.classes("esri-feature__button","esri-feature__media-next"),c=a?this.classes("esri-feature__icon","esri-feature__media-previous-icon","esri-icon-left-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon","esri-icon-right-triangle-arrow"),h=a?this.classes("esri-feature__icon",
"esri-feature__media-previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature__icon","esri-feature__media-next-icon--rtl","esri-icon-left-triangle-arrow"),l=a?this._previousClick:this._nextClick;return p.tsx("div",{key:r(a?"previous":"next",b),title:d,tabIndex:0,role:"button",class:e,"data-content-element-index":b,bind:this,onkeydown:l,onclick:l},p.tsx("span",{"aria-hidden":"true",class:c}),p.tsx("span",{"aria-hidden":"true",class:h}),p.tsx("span",{class:"esri-icon-font-fallback-text"},
d))};t.prototype._handleMediaKeyup=function(a){var d=a.currentTarget["data-content-element-index"],e=a.keyCode;e===b.LEFT_ARROW&&(a.stopPropagation(),this.previousMedia(d));e===b.RIGHT_ARROW&&(a.stopPropagation(),this.nextMedia(d))};t.prototype._renderMedia=function(a,b){var d;a=a.mediaInfos;var e=this._getMediaStats(a),c=e.total,h=(d={},d["esri-feature--media-pagination-visible"]=1<e.total,d);d=this._renderMediaStatsItem(f.numImages,e.images,"image");var e=this._renderMediaStatsItem(f.numCharts,
e.charts,"chart"),l=this._renderMediaPageButton("previous",b),k=this._renderMediaPageButton("next",b),m=this._activeMediaMap.get(b);isNaN(m)&&(this._activeMediaMap.set(b,0),m=0);return c?p.tsx("div",{key:r("media-element",b),"data-content-element-index":b,bind:this,onkeyup:this._handleMediaKeyup,class:this.classes("esri-feature__media","esri-feature__content-element",h)},p.tsx("ul",{class:"esri-feature__media-summary"},d,e),p.tsx("div",{key:r("media-element-container",b),class:"esri-feature__media-container"},
l,this._renderMediaInfo(a[m],b),k)):null};t.prototype._renderText=function(a,b){return a.text?p.tsx("div",{key:r("text-element",b),innerHTML:a.text,class:this.classes("esri-feature__text","esri-feature__content-element")}):null};t.prototype._attachToNode=function(a){a.appendChild(this)};t.prototype._getMediaStats=function(a){var b=0,d=0;a.forEach(function(a){a=a.type;"image"===a?b++:-1!==a.indexOf("chart")&&d++});return{total:d+b,images:b,charts:d}};t.prototype._setContentElementMedia=function(a,
b){this._clearMediaRefreshTimer(a);var d=this.viewModel.content;(d=(d=d&&d[a])&&d.mediaInfos)&&d.length&&(this._activeMediaMap.set(a,(b+d.length)%d.length),this._setupMediaRefreshTimer(a),this.scheduleRender())};t.prototype._pageContentElementMedia=function(a,b){b="previous"===b?-1:1;b=this._activeMediaMap.get(a)+b;this._setContentElementMedia(a,b)};t.prototype._previousClick=function(a){this.previousMedia(a.currentTarget["data-content-element-index"])};t.prototype._nextClick=function(a){this.nextMedia(a.currentTarget["data-content-element-index"])};
a([h.aliasOf("viewModel.contentEnabled")],t.prototype,"contentEnabled",void 0);a([h.aliasOf("viewModel.graphic")],t.prototype,"graphic",void 0);a([h.aliasOf("viewModel.title")],t.prototype,"title",void 0);a([h.aliasOf("viewModel.view")],t.prototype,"view",void 0);a([h.property({type:k}),p.renderable(["viewModel.waitingForContent","viewModel.content"])],t.prototype,"viewModel",void 0);a([p.accessibleHandler()],t.prototype,"_previousClick",null);a([p.accessibleHandler()],t.prototype,"_nextClick",null);
return t=a([h.subclass("esri.widgets.Feature")],t)}(h.declared(m))})},"esri/widgets/Feature/FeatureViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper dojo/i18n!dojo/cldr/nls/number ../../Graphic ../../core/date ../../core/Error ../../core/Handles ../../core/lang ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../support/arcadeUtils ../../tasks/support/AttachmentQuery ./support/featureUtils ./support/RelatedFeatures ../support/widget".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z){function x(a,b){return a&&"feature"===a.type?a.getField(b):null}function B(a){return a.replace(/[\u00A0-\u99999<>\&]/gim,function(a){return"\x26#"+a.charCodeAt(0)+";"})}var D=d.getLogger("esri.widgets.FeatureViewModel"),C=/^\s*expression\//i,G=new RegExp(""+b.group,"g"),E=new h("cancelled-query","cancelled feature query"),F=e.getFormat("short-date-short-time"),I="DateFormat"+F;return function(d){function h(a){a=d.call(this)||this;a._handles=new m;
a._featurePromise=void 0;a._layerDateFields=null;a._expressionAttributes=null;a.content=null;a.contentEnabled=!0;a.formattedAttributes=null;a.title="";a.view=null;return a}c(h,d);h.prototype.destroy=function(){this._clear();this._handles.destroy();this._expressionAttributes=this._layerDateFields=this.graphic=this.view=this._handles=null};Object.defineProperty(h.prototype,"graphic",{get:function(){return this._get("graphic")||null},set:function(a){if(a){var b=v.getSourceLayer(a);this._layerDateFields=
b?this._getDateFields(b):[]}this._set("graphic",a);this._graphicChanged(a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"waitingForContent",{get:function(){return!!this._featurePromise},enumerable:!0,configurable:!0});h.prototype._clear=function(){this._cancelFeatureQuery();this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};h.prototype._graphicChanged=function(a){var b=this,d=this._handles;if(d&&(d.remove("graphic"),this._clear(),a)){d.add(p.watch(this,
"graphic.sourceLayer.popupTemplate.title graphic.sourceLayer.popupTemplate.content graphic.sourceLayer.popupTemplate.fieldInfos graphic.popupTemplate.title graphic.popupTemplate.content graphic.popupTemplate.fieldInfos contentEnabled".split(" "),function(){b._graphicChanged(b.graphic)}),"graphic");var e=!1;a=this._queryFeature().catch(function(a){a!==E&&D.error("error","error loading template",a)}).then(function(){e=!0;b._featurePromise=null;b.notifyChange("waitingForContent")});e||(this._featurePromise=
a,this.notifyChange("waitingForContent"))}};h.prototype._cancelFeatureQuery=function(){var a=this._featurePromise;a&&"function"===typeof a.cancel&&a.cancel(E);this._featurePromise=null;this.notifyChange("waitingForContent")};h.prototype._compileContent=function(a,b){var d=this;if(a&&(a.nodeName||a&&z.isWidgetBase(a)||z.isWidget(a)))return a;if("string"===typeof a)return this._compileText({type:"text",text:a}).text;if(Array.isArray(a))return a.map(function(a,e){e=(e=b&&b[e])&&e.value;var h=a.type;
if("attachments"===h)return d._compileAttachments(a,e);if("fields"===h)return d._compileFields(a);if("media"===h)return d._compileMedia(a);if("text"===h)return d._compileText(a)});a&&D.warn("invalid content type.")};h.prototype._compileFields=function(a){var b=this,d=this.graphic;a=k.clone(a);var e=(d=d.getEffectivePopupTemplate())&&d.expressionInfos,d=a.fieldInfos?void 0:d&&d.fieldInfos,d=a.fieldInfos||k.clone(d),h=[];d&&d.forEach(function(a){var d=a.fieldName.toLowerCase();if(!a.hasOwnProperty("visible")||
a.visible)d=b._isExpressionField(d)?b._getExpressionInfo(e,d):null,a.label=d?d.title:a.label,h.push(a)});a.fieldInfos=h;return a};h.prototype._setImageValue=function(a){var b=a.value,d=a.formattedAttributes;a=a.layer;var e=b.linkURL,h=b.sourceURL;h&&(h=this._fixTokens(h,a),b.sourceURL=this._substituteAttributes(d,h));e&&(a=this._fixTokens(e,a),b.linkURL=this._substituteAttributes(d,a))};h.prototype._compileMedia=function(a){var b=this,d=this._expressionAttributes,e=this._layerDateFields,h=this.graphic;
a=k.clone(a);var c=a.mediaInfos||[],l=f({},h.attributes,d),m=v.getSourceLayer(h),p=this.formattedAttributes.global,q={dateFormat:{properties:e,formatter:I}};a.mediaInfos=c.map(function(a){if(a=k.clone(a)){var d=a.value,e=a.type,h=a.title?b._processFieldsInLinks(a.title,l):"",c=a.caption?b._processFieldsInLinks(a.caption,l):"";a.title=h?b._substituteAttributes(p,h,q):"";a.caption=c?b._substituteAttributes(p,c,q):"";if("image"===e)return b._setImageValue({value:d,formattedAttributes:p,layer:m}),a.value.sourceURL?
a:void 0;if("pie-chart"===e||"line-chart"===e||"column-chart"===e||"bar-chart"===e)return b._setChartValue({value:d,attributes:l,formattedAttributes:p,layer:m}),a}}).filter(Boolean);return a};h.prototype._substituteAttributes=function(a,b,d){return(""+this._removeEmptyHref(k.substitute(a,b,d))).trim()};h.prototype._compileText=function(a){var b=this._expressionAttributes,d=this._layerDateFields,e=this.graphic;(a=k.clone(a))&&a.text&&(e=f({},e.attributes,b),b=this.formattedAttributes.global,d={dateFormat:{properties:d,
formatter:I}},e=this._processFieldsInLinks(a.text,e),a.text=this._substituteAttributes(b,e,d));return a};h.prototype._compileTitle=function(){var a=this._expressionAttributes,b=this._layerDateFields,d=this.graphic,e=d.getEffectivePopupTemplate(),e=e&&e.title,a=f({},d.attributes,a),b={dateFormat:{properties:b,formatter:I}},h=this.formattedAttributes.global;return"function"===typeof e?e.call(null,{graphic:d}):"string"===typeof e&&e?(d=this._processFieldsInLinks(e,a),this._substituteAttributes(h,d,b)):
""};h.prototype._getExpressionInfo=function(a,b){if(this._isExpressionField(b)){var d=b.replace(C,"").toLowerCase(),e;a.some(function(a){if(a.name.toLowerCase()===d)return e=a,!0});return e}};h.prototype._fixTokens=function(a,b){return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,d,e){return(a=x(b,e))?"{"+a.name+"}":d})};h.prototype._encodeAttributes=function(a){var b=a?k.clone(a):{};Object.keys(b).forEach(function(a){var d=b[a];"string"===typeof d&&(d=encodeURIComponent(d).replace(/\'/g,"\x26apos;"),
b[a]=d)});return b};h.prototype._formatAttributesToFieldInfos=function(a,b,d){var e=this,h=k.clone(this._layerDateFields);a.forEach(function(c){var f=e._getFixedFieldName(c.fieldName,b);c.fieldName=f;d[f]=e._formatValue(d[f],{fieldInfos:a,fieldName:f,layer:b});h&&c.format&&c.format.dateFormat&&(c=h.indexOf(f),-1<c&&h.splice(c,1))})};h.prototype._getArcadeViewingMode=function(a){return a&&"local"===a.viewingMode?"localScene":"globalScene"};h.prototype._getViewInfo=function(){var a=this.view;if(a){var b=
"3d"===a.type?this._getArcadeViewingMode(a):"map";return u.getViewInfo({viewingMode:b,scale:a.scale,spatialReference:a.spatialReference})}};h.prototype._formatAttributes=function(a){var b=this,d=this._expressionAttributes,e=this.graphic,h=e.attributes,e=v.getSourceLayer(e),c=h?k.clone(h):{},l=f({},c,d);this.addRelatedFeatureAttributes(l);a&&this._formatAttributesToFieldInfos(a,e,l);if(e){var m=e.typeIdField;h&&Object.keys(h).forEach(function(a){if(!b.isRelatedField(a)){var d=h[a];null!=d&&(d=b._getDomainName(a,
d),null!=d?l[a]=d:a===m&&(d=b._getTypeName(),null!=d&&(l[a]=d)))}})}return l};h.prototype._formatValue=function(a,d){var h={dateFormat:{properties:this._layerDateFields,formatter:I}},c=d.fieldName,f=this._getFieldInfo(d.fieldInfos,c),l=k.clone(f),f=d.preventPlacesFormatting;(d=x(d.layer,c))&&"date"===d.type&&(d=l.format||{},d.dateFormat=d.dateFormat||"short-date-short-time",l.format=d);c=l&&l.format;if(null==a||!l||null==c)return a;var m=[],l=c.hasOwnProperty("places")||c.hasOwnProperty("digitSeparator");
d=c.hasOwnProperty("digitSeparator")?c.digitSeparator:!0;f=null!=c.places&&(!f||0<c.places);l&&f&&m.push("places: "+Number(c.places));f=l?f?"NumberFormat("+m.join(",")+")":"NumberFormat":c.dateFormat?"DateFormat"+(e.getFormat(c.dateFormat)||F):void 0;if(!f)return a;a=k.substitute({myKey:a},"{myKey:"+f+"}",h)||"";return l&&!d&&b.group?a.replace(G,""):a};h.prototype._getDomainName=function(a,b){var d=this.graphic,e=v.getSourceLayer(d);return e&&"feature"===e.type?(a=e.getFieldDomain(a,{feature:d}))&&
"coded-value"===a.type?a.getName(b):null:null};h.prototype._getFieldInfo=function(a,b){if(a&&a.length&&b){var d=b.toLowerCase(),e=void 0;a.some(function(a){if(a.fieldName&&a.fieldName.toLowerCase()===d)return e=a,!0});return e}};h.prototype._getTypeName=function(){var a=this.graphic,b=v.getSourceLayer(a);if(b&&"feature"===b.type&&(a=b.getFeatureType(a)))return a.name};h.prototype._removeEmptyHref=function(a){return a.replace(/href=(""|'')/gi,"")};h.prototype._processFieldsInLinks=function(a,b){var d=
this.get("graphic.layer");a=this._fixTokens(a,d);var e=this._encodeAttributes(b),d=/href\s*=\s*(?:\"([^\"]+)\"|\'([^\']+)\')/gi;return a?a.replace(d,function(a,d,h){d=(""+(d||h)).trim();return k.substitute(d&&"{"===d[0]?b:e,a)}):a};h.prototype._compileAttachments=function(a,b){a=k.clone(a);if(!b)return a;a.attachmentInfos=b;return a};h.prototype._queryAttachments=function(){var a=this.graphic,b=v.getSourceLayer(a);if(!b)return q.resolve([]);if((b="scene"===b.type&&b.associatedLayer?b.associatedLayer:
b)&&"feature"===b.type){var d=b.objectIdField,e=(a=a.attributes)&&a[d],a=new t({objectIds:[e]});return b.queryAttachments(a).then(function(a){return a[e]||[]})}return q.resolve([])};h.prototype._queryContentElements=function(a){var b=this;if(!Array.isArray(a))return q.resolve();var d={};a.forEach(function(a,e){"attachments"===a.type&&(a=b._queryAttachments())&&(d[e]=a)});return Object.keys(d).length?q.eachAlways(d):q.resolve()};h.prototype._getContent=function(){var a=this.graphic;if(!this.contentEnabled)return q.resolve();
var b=a.getEffectivePopupTemplate(),b=b&&b.content,a="function"===typeof b?b.call(null,{graphic:a}):b;return q.isThenable(a)?a:q.resolve(a)};h.prototype._queryFeature=function(){var a=this;return this._getContent().then(function(b){return a._checkForRelatedFeatures(b).then(function(){a._expressionAttributes=a._createFormattedExpressions();a._set("formattedAttributes",a._createFormattedAttributes(b));a._set("title",a._compileTitle());return a._queryContentElements(b).then(function(d){d=a._compileContent(b,
d);a._set("content",d||null);return d})})})};h.prototype._isExpressionField=function(a){return C.test(a)};h.prototype._createCompiledExpressionDictionary=function(a){var b=new Map;if(!a)return b;a.forEach(function(a){return b.set(a.name,u.createFunction(a.expression))});return b};h.prototype._getDateFields=function(a){return(a=a.fields)?a.filter(function(a){return"date"===a.type}).map(function(a){return a.name}):[]};h.prototype._createFormattedExpressions=function(){var a=this,b=this.graphic,d=b.getEffectivePopupTemplate(),
d=d&&d.expressionInfos,e=this._createCompiledExpressionDictionary(d),h={};d&&d.forEach(function(d){var c="expression/"+d.name;d=e.get(d.name);var f=a._getViewInfo();d=u.executeFunction(d,u.createExecContext(b,f));h[c]="string"===typeof d?B(d):d});return h};h.prototype._createFormattedAttributes=function(a){var b=this,d=this.graphic.getEffectivePopupTemplate(),e={global:this._formatAttributes(d&&d.fieldInfos),content:[]};Array.isArray(a)&&a.forEach(function(a,d){"fields"===a.type&&a.fieldInfos&&(e.content[d]=
b._formatAttributes(a.fieldInfos))});return e};h.prototype._getAllFieldInfos=function(a){var b=[],d=this.graphic.getEffectivePopupTemplate();(d=d&&d.fieldInfos)&&b.push.apply(b,d);if(!a||!Array.isArray(a))return b;a.forEach(function(a){b.push.apply(b,a&&a.fieldInfos)});return b};h.prototype._checkForRelatedFeatures=function(a){var b=this.graphic;a=this._getAllFieldInfos(a);return this.queryRelatedInfos(b,a)};h.prototype._getChartOption=function(a){var d=a.value,e=a.attributes,h=a.formattedAttributes,
c=a.fieldName,f=a.relatedFieldName,l=a.fieldInfos;a=v.getSourceLayer(this.graphic);var k=d.normalizeField,m=d.tooltipField,k=k?this.isRelatedField(k)?e[this.getRelatedFieldInfo(k).fieldName]:e[k]:null,d=f&&void 0!==e[f]?e[f]:void 0!==e[c]?e[c]:h[c],d="string"===typeof d&&b.group?parseFloat(d.replace(G,"")):d,p=void 0===d?null:d&&k?d/k:d,d={y:p};if(this.isRelatedField(c))return h=this.getRelatedFieldInfo(c),c=(c=this.getRelatedFieldInfo(m))?c.fieldName:null,a=this._formatValue(p,{fieldInfos:l,fieldName:f,
layer:a,preventPlacesFormatting:!!k}),f=h?h.label||h.fieldName:f,d.tooltip=(c&&void 0!==e[c]?e[c]:f)+": "+a,d;e=this._getFieldInfo(l,c);f=this._getFixedFieldName(c,a);e=e?e.label||e.fieldName:c;d.tooltip=(m&&void 0!==h[m]?h[m]:e)+": "+h[f];return d};h.prototype._getFixedFieldName=function(a,b){return(b=x(b,a))?b.name:a};h.prototype._getFixedFieldNames=function(a,b){var d=this;return a&&a.map(function(a){return d._getFixedFieldName(a,b)})};h.prototype._setChartValue=function(a){var b=this,d=a.value,
e=a.attributes,h=a.formattedAttributes,c=a.layer,f=this.graphic,l=this.relatedInfoCount;a=d.fields;var k=d.normalizeField;d.fields=this._getFixedFieldNames(a,c);k&&(d.normalizeField=this._getFixedFieldName(k,c));if(a.some(function(a){return!!(null!=h[a]||b.isRelatedField(a)&&l)})){var m=(c=f.getEffectivePopupTemplate())&&c.fieldInfos;d.chartOptions=d.chartOptions||[];a.forEach(function(a){b.isRelatedField(a)?d.chartOptions=d.chartOptions.concat(b._getRelatedChartInfos({fieldInfos:m,fieldName:a,formattedAttributes:h,
value:d})):(a=b._getChartOption({value:d,attributes:e,formattedAttributes:h,fieldName:a,fieldInfos:m}),d.chartOptions.push(a))})}};h.prototype._getRelatedChartInfos=function(a){var b=this,d=a.fieldInfos,e=a.fieldName,h=a.formattedAttributes,c=a.value,f=[];a=this.getRelatedFieldInfo(e);var l=a.fieldName,k=this.getRelatedInfo(a.layerId);if(!k)return f;a=k.relatedFeatures;k=k.relation;if(!k||!a)return f;k=k.cardinality;a.forEach(function(a){var k=a.attributes;k&&Object.keys(k).forEach(function(a){a===
l&&f.push(b._getChartOption({value:c,attributes:k,formattedAttributes:h,fieldName:e,relatedFieldName:a,fieldInfos:d}))})});return"one-to-many"===k||"many-to-many"===k?f:[f[0]]};a([r.property({readOnly:!0})],h.prototype,"content",void 0);a([r.property()],h.prototype,"contentEnabled",void 0);a([r.property({readOnly:!0})],h.prototype,"formattedAttributes",void 0);a([r.property({type:l})],h.prototype,"graphic",null);a([r.property({readOnly:!0})],h.prototype,"title",void 0);a([r.property()],h.prototype,
"view",void 0);a([r.property({readOnly:!0})],h.prototype,"waitingForContent",null);return h=a([r.subclass("esri.widgets.FeatureViewModel")],h)}(r.declared(A))})},"esri/widgets/Feature/support/featureUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.getSourceLayer=function(c){if(c)return c.get("sourceLayer")||c.get("layer")}})},"esri/widgets/Feature/support/RelatedFeatures":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../request ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../tasks/QueryTask ../../../tasks/support/Query ../../../tasks/support/StatisticDefinition ./featureUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p){var r=new Map,u=e.getLogger("esri.widgets.Popup.support.RelatedFeatures");return function(b){function e(a){a=b.call(this)||this;a.relatedInfoCount=null;a.relatedInfos=new Map;return a}c(e,b);e.prototype.destroy=function(){this.relatedInfos.clear()};e.prototype.addRelatedFeatureAttributes=function(a){var b=this;this.relatedInfos.forEach(function(d){return b._addRelatedFeatureAttribute(a,d)})};e.prototype.getRelatedFieldInfo=function(a){if(-1===a.indexOf("relationships/"))return null;
a=a.split("/").slice(1);return{layerId:a[0],fieldName:a[1]}};e.prototype.getRelatedInfo=function(a){return this.relatedInfos.get(a.toString())};e.prototype.isRelatedField=function(a){void 0===a&&(a="");return a?-1!==a.indexOf("relationships/"):!1};e.prototype.queryRelatedInfos=function(a,b){var d=this;this.relatedInfos.clear();var e=p.getSourceLayer(a);if(!e)return h.resolve();var c=b.filter(function(a){return a&&d.isRelatedField(a.fieldName)});if(!c||!c.length)return h.resolve();this._createRelatedInfos(b,
e);return this._queryLayerInfos(e,b).then(function(b){d._updateRelatedInfoLayerInfos(b);return d._queryRelatedFeatureMap(a).then(function(a){Object.keys(a).forEach(function(b){d._setRelatedFeatures(a[b],b.toString())});return a})})};e.prototype._addRelatedFeatureAttribute=function(a,b){var d=this;a&&b&&("one-to-one"===b.relation.cardinality&&b.relatedFeatures&&b.relatedFeatures.forEach(function(e){return d._addAttributesFromFeature(a,e,b)}),b.relatedStatsFeatures&&b.relatedStatsFeatures.forEach(function(e){return d._addAttributesFromFeature(a,
e,b)}))};e.prototype._updateRelatedInfoLayerInfo=function(a,b){if(a=a.value)this.getRelatedInfo(b).layerInfo=a.data};e.prototype._updateRelatedInfoLayerInfos=function(a){var b=this;Object.keys(a).forEach(function(d){return b._updateRelatedInfoLayerInfo(a[d],d.toString())})};e.prototype._addAttributesFromFeature=function(a,b,d){var e=this;a&&b&&d&&Object.keys(b.attributes).forEach(function(h){var c=e._relatedFieldInfoToString({layerId:d.relation.id.toString(),fieldName:h});a[c]=b.attributes[h]})};
e.prototype._relatedFieldInfoToString=function(a){return a?"relationships/"+a.layerId+"/"+a.fieldName:""};e.prototype._createRelatedInfoForFieldInfo=function(a,b){var d=this.getRelatedFieldInfo(a.fieldName);if(d){var e=d.layerId,d=d.fieldName;e&&(b=this.getRelatedInfo(e)||this._createRelatedInfo(e,b))&&(b.relatedFields.push(d),a.statisticType&&(a=new q({statisticType:a.statisticType,onStatisticField:d,outStatisticFieldName:d}),b.outStatistics.push(a)))}};e.prototype._createRelatedInfos=function(a,
b){var d=this;a.forEach(function(a){return d._createRelatedInfoForFieldInfo(a,b)})};e.prototype._queryRelatedFeatureMap=function(a){var b=this,d={};this.relatedInfos.forEach(function(e,h){d[h]=b._queryRelatedLayerFeatures(a,e)});return h.eachAlways(d)};e.prototype._queryLayerInfos=function(a,b){var d=this,e={};this.relatedInfos.forEach(function(b,c){b=b.relation;if(!b)return c=new l("relation-required","A relation is required on a layer to retrieve related records."),u.error(c),h.reject(c);b=b.relatedTableId;
if(!b)return c=new l("A related table ID is required on a layer to retrieve related records."),u.error(c),h.reject(c);b=a.url+"/"+b;var f=r.get(b),k=f?f:d._queryLayerInfo(b);f||r.set(b,k);e[c]=k});return h.eachAlways(e)};e.prototype._queryLayerInfo=function(a){return f(a,{query:{f:"json"}})};e.prototype._queryRelatedLayerFeatures=function(a,b){var e=p.getSourceLayer(a).layerId.toString(),c=b.layerInfo,f=b.queryTask,l=b.relation;if(e=this._getDestinationRelation(c,e)){var l=l.keyField,k=e.keyField,
e="string"===this._getDestinationFieldType(c,e)?k+"\x3d'"+a.attributes[l]+"'":k+"\x3d"+a.attributes[l];a=f.execute(new d({where:e,outFields:b.relatedFields}));b=b.outStatistics&&0<b.outStatistics.length&&c.supportsStatistics?f.execute(new d({where:e,outFields:b.relatedFields,outStatistics:b.outStatistics})):null;return h.eachAlways({features:a,statsFeatures:b?b:h.resolve()})}return h.resolve()};e.prototype._setRelatedFeatures=function(a,b){if(b=this.getRelatedInfo(b)){var d=a.value;d&&(a=d.features,
d=d.statsFeatures,a=a&&a.value,b.relatedFeatures=a?a.features:[],a=d&&d.value,b.relatedStatsFeatures=a?a.features:[])}};e.prototype._getRelation=function(a,b){if("feature"!==b.type)return null;var d=null;b.relationships.some(function(b){if(b.id===parseInt(a,10))return d=b,!0});return d};e.prototype._createRelatedInfo=function(a,b){var d=this._getRelation(a,b);if(d){b=b.url+"/"+d.relatedTableId;var e=new k({url:b}),d={url:b,queryTask:e,relation:d,relatedFields:[],outStatistics:[]};this.relatedInfos.set(a,
d);return d}};e.prototype._getDestinationRelation=function(a,b){var d;a&&a.relationships&&a.relationships.some(function(a){if(""+a.relatedTableId===b)return d=a,!0});return d};e.prototype._getDestinationFieldType=function(a,b){var d=void 0;a.fields.some(function(a){if(a.name===b.keyField)return d=-1!==["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)?"number":"string",!0});return d};a([m.aliasOf("relatedInfos.size")],e.prototype,"relatedInfoCount",
void 0);a([m.property()],e.prototype,"relatedInfos",void 0);return e=a([m.subclass("esri.widgets.Popup.support.RelatedFeatures")],e)}(m.declared(b))})},"esri/widgets/Feature/support/attachmentUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});var c=n.toUrl("../../../themes/base/images/files/");g.isSupportedImage=function(a){a=a.toLowerCase();return"image/bmp"===a||"image/emf"===a||"image/exif"===a||"image/gif"===a||"image/x-icon"===a||"image/jpeg"===
a||"image/png"===a||"image/tiff"===a||"image/x-wmf"===a};g.getIconPath=function(a){return"text/plain"===a?c+"text-32.svg":"application/pdf"===a?c+"pdf-32.svg":"text/csv"===a?c+"csv-32.svg":"application/gpx+xml"===a?c+"gpx-32.svg":"application/x-dwf"===a?c+"cad-32.svg":"application/postscript"===a||"application/json"===a||"text/xml"===a||"model/vrml"===a?c+"code-32.svg":"application/x-zip-compressed"===a||"application/x-7z-compressed"===a||"application/x-gzip"===a||"application/x-tar"===a||"application/x-gtar"===
a||"application/x-bzip2"===a||"application/gzip"===a||"application/x-compress"===a||"application/x-apple-diskimage"===a||"application/x-rar-compressed"===a||"application/zip"===a?c+"zip-32.svg":-1!==a.indexOf("image/")?c+"image-32.svg":-1!==a.indexOf("audio/")?c+"sound-32.svg":-1!==a.indexOf("video/")?c+"video-32.svg":-1!==a.indexOf("msexcel")||-1!==a.indexOf("ms-excel")||-1!==a.indexOf("spreadsheetml")?c+"excel-32.svg":-1!==a.indexOf("msword")||-1!==a.indexOf("ms-word")||-1!==a.indexOf("wordprocessingml")?
c+"word-32.svg":-1!==a.indexOf("powerpoint")||-1!==a.indexOf("presentationml")?c+"report-32.svg":c+"generic-32.svg"}})},"esri/widgets/support/uriUtils":function(){define(["require","exports","dojo/i18n!./nls/uriUtils","../../core/lang"],function(n,g,c,a){function f(a){var e=null;b.some(function(b){b.pattern.test(a)&&(e=b);return!!e});return e}Object.defineProperty(g,"__esModule",{value:!0});var b=[{id:"http",pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:c.view},{id:"tel",pattern:/^\s*(tel:([^\s]+))\s*$/i,
label:"{hierPart}"},{id:"mailto",pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{id:"arcgis-appstudio-player",pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:c.openInApp,appName:"App Studio Player"},{id:"arcgis-collector",pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:c.openInApp,appName:"Collector"},{id:"arcgis-explorer",pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:c.openInApp,appName:"Explorer"},{id:"arcgis-navigator",pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,
label:c.openInApp,appName:"Navigator"},{id:"arcgis-survey123",pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:c.openInApp,appName:"Survey123"},{id:"arcgis-trek2there",pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:c.openInApp,appName:"Trek2There"},{id:"arcgis-workforce",pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:c.openInApp,appName:c.workforce},{id:"iform",pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:c.openInApp,appName:"iForm"},{id:"flow",pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,
label:c.openInApp,appName:"FlowFinity"},{id:"lfmobile",pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:c.openInApp,appName:"Laserfische"},{id:"mspbi",pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:c.openInApp,appName:"Microsoft Power Bi"}];g.autoLink=function(b){if("string"!==typeof b||!b)return b;var e=f(b);if(!e)return b;var h=b.match(e.pattern),h=a.substitute({appName:e.appName,hierPart:h&&h[2]},e.label);return b.replace(e.pattern,"\x3ca "+(e.target?'target\x3d"'+e.target+'"':"")+'" href\x3d"$1"\x3e'+
h+"\x3c/a\x3e")}})},"esri/widgets/Spinner":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/promiseUtils ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./support/AnchorElementViewModel ./support/widget".split(" "),function(n,g,c,a,f,b,l,e,h,m){return function(e){function d(a){a=e.call(this)||this;a._animationDelay=500;a._animationPromise=null;a.location=null;a.view=null;a.visible=!1;a.viewModel=new h;return a}c(d,e);
d.prototype.postInitialize=function(){var a=this;this.own([b.watch(this,"visible",function(b){return a._visibleChange(b)})])};d.prototype.destroy=function(){this._cancelAnimationPromise()};d.prototype.show=function(a){var b=this,d=a.location;a=a.promise;d&&(this.viewModel.location=d);this.visible=!0;d=function(){return b.hide()};a&&a.catch(function(){}).then(d)};d.prototype.hide=function(){this.visible=!1};d.prototype.render=function(){var a,b=this.visible,d=!!this.viewModel.screenLocation,b=(a={},
a["esri-spinner--start"]=b&&d,a["esri-spinner--finish"]=!b&&d,a);a=this._getPositionStyles();return m.tsx("div",{class:this.classes("esri-spinner",b),styles:a})};d.prototype._cancelAnimationPromise=function(){var a=this._animationPromise;a&&a.cancel();this._animationPromise=null};d.prototype._visibleChange=function(a){var b=this;a?this.viewModel.screenLocationEnabled=!0:(this._cancelAnimationPromise(),this._animationPromise=f.after(this._animationDelay).then(function(){b.viewModel.screenLocationEnabled=
!1;b._animationPromise=null}))};d.prototype._getPositionStyles=function(){var a=this.viewModel,b=a.screenLocation,a=a.view;if(!a||!b)return{};a=a.padding;return{left:b.x-a.left+"px",top:b.y-a.top+"px"}};a([l.aliasOf("viewModel.location")],d.prototype,"location",void 0);a([l.aliasOf("viewModel.view")],d.prototype,"view",void 0);a([l.property(),m.renderable()],d.prototype,"visible",void 0);a([l.property({type:h}),m.renderable(["viewModel.screenLocation","viewModel.screenLocationEnabled"])],d.prototype,
"viewModel",void 0);return d=a([l.subclass("esri.widgets.Spinner")],d)}(l.declared(e))})},"esri/widgets/support/AnchorElementViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b,l,e,h,m){return function(b){function d(){var a=b.call(this)||this;a._anchorHandles=
new l;a.location=null;a.screenLocation=null;a.screenLocationEnabled=!1;a.view=null;a._anchorHandles.add([h.watch(a,"screenLocationEnabled,location,view.size",function(){return a._updateScreenPointAndHandle()}),h.watch(a,"view, view.ready",function(){return a._wireUpView()})]);return a}c(d,b);d.prototype.destroy=function(){this.view=null;this._anchorHandles&&this._anchorHandles.destroy();this._viewpointHandle=this._anchorHandles=null};d.prototype._wireUpView=function(){var a=this;this._anchorHandles.remove("view");
this._viewpointHandle=null;if(this.get("view.ready")){this._setScreenLocation();var b=this.view,b=e.pausable(b,"3d"===b.type?"camera":"viewpoint",function(){return a._viewpointChange()});this._anchorHandles.add(b,"view");this._viewpointHandle=b;this._toggleWatchingViewpoint()}};d.prototype._viewpointChange=function(){this._setScreenLocation();this.emit("view-change")};d.prototype._updateScreenPointAndHandle=function(){this._setScreenLocation();this._toggleWatchingViewpoint()};d.prototype._toggleWatchingViewpoint=
function(){var a=this._viewpointHandle,b=this.screenLocationEnabled;a&&(this.location&&b?a.resume():a.pause())};d.prototype._setScreenLocation=function(){var a=this.location,b=this.view,d=this.screenLocationEnabled,e=this.get("view.ready"),a=d&&a&&e?b.toScreen(a):null;this._set("screenLocation",a)};a([m.property()],d.prototype,"location",void 0);a([m.property({readOnly:!0})],d.prototype,"screenLocation",void 0);a([m.property()],d.prototype,"screenLocationEnabled",void 0);a([m.property()],d.prototype,
"view",void 0);return d=a([m.subclass("esri.widgets.support.AnchorElementViewModel")],d)}(m.declared(f,b))})},"esri/widgets/Popup/PopupViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/promiseUtils ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/Point ../../geometry/support/webMercatorUtils ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../views/support/layerViewUtils ../support/AnchorElementViewModel ../support/GoTo".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z){var x=new u({id:"zoom-to"}),B=b.ofType({key:"type",defaultKeyValue:"button",base:r,typeMap:{button:u,toggle:t}}),D=new B([x]),C=h.getLogger("esri.widgets.Popup.PopupViewModel");return function(b){function h(a){a=b.call(this)||this;a._handles=new e;a._pendingPromises=new Set;a._zoomToLocation=null;a.actions=D;a.autoCloseEnabled=!1;a.content=null;a.highlightEnabled=!0;a.title=null;a.updateLocationEnabled=!1;a.view=null;a.visible=!1;a.zoomFactor=4;return a}
c(h,b);h.prototype.initialize=function(){var a=this;this._handles.add([this.on("view-change",this._autoClose),k.watch(this,["highlightEnabled","selectedFeature","visible","view"],this._highlightFeature),k.watch(this,"view.animation.state",function(b){a._zoomToLocation||(x.disabled="waiting-for-target"===b)})])};h.prototype.destroy=function(){this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.view=null};Object.defineProperty(h.prototype,"allActions",{get:function(){var a=
this._get("allActions")||new B;a.removeAll();var b=this.selectedFeature&&("function"===typeof this.selectedFeature.getEffectivePopupTemplate&&this.selectedFeature.getEffectivePopupTemplate()||this.selectedFeature.popupTemplate),d=b&&b.actions;(b=b&&b.overwriteActions?d:this.actions.concat(d))&&b.filter(Boolean).forEach(function(b){return a.add(b)});return a},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"featureCount",{get:function(){return this.features.length},enumerable:!0,
configurable:!0});Object.defineProperty(h.prototype,"features",{get:function(){return this._get("features")||[]},set:function(a){a=a||[];this._set("features",a);var b=this.pendingPromisesCount,d=this.selectedFeatureIndex,e=this.promiseCount&&a.length;e&&b&&-1===d?this.selectedFeatureIndex=0:e&&-1!==d||(this.selectedFeatureIndex=a.length?0:-1)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"location",{get:function(){return this._get("location")||null},set:function(a){var b=this.get("location"),
d=this.get("view.spatialReference.isWebMercator");a&&a.get("spatialReference.isWGS84")&&d&&(a=p.geographicToWebMercator(a));this._set("location",a);a!==b&&this._centerAtLocation()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"pendingPromisesCount",{get:function(){return this._pendingPromises.size},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"waitingForResult",{get:function(){return 0<this.pendingPromisesCount&&0===this.featureCount},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"promiseCount",{get:function(){return this.promises.length},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"promises",{get:function(){return this._get("promises")||[]},set:function(a){var b=this,d=this._get("promises");d&&d.forEach(function(a){a&&"function"===typeof a.cancel&&a.cancel()});this._pendingPromises.clear();this.features=[];Array.isArray(a)&&a.length?(this._set("promises",a),a=a.slice(0),a.forEach(function(a){b._pendingPromises.add(a);
a.then(function(d){b._updatePendingPromises(a);b._updateFeatures(d)},function(){return b._updatePendingPromises(a)})})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"selectedFeature",{get:function(){var a=this.selectedFeatureIndex;if(-1===a)return null;a=this.features[a];if(!a)return null;this.updateLocationEnabled&&(this.location=this._getPointFromGeometry(a.geometry));return a},enumerable:!0,configurable:!0});
Object.defineProperty(h.prototype,"selectedFeatureIndex",{get:function(){var a=this._get("selectedFeatureIndex");return"number"===typeof a?a:-1},set:function(a){var b=this.featureCount;a=isNaN(a)||-1>a||!b?-1:(a+b)%b;this._set("selectedFeatureIndex",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});h.prototype.centerAtLocation=function(){var a=this.location,b=this.view;return a&&
b?this.callGoTo({target:{target:a,scale:b.scale}}):(a=new l("center-at-location:invalid-location-or-view","Cannot center at a location without a location and view.",{location:a,view:b}),C.error(a),m.reject(a))};h.prototype.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null})};h.prototype.open=function(a){this.set(f({visible:!1},{updateLocationEnabled:!1,promises:[]},a));this._setVisibleWhenContentExists()};h.prototype.triggerAction=function(a){(a=this.allActions.getItemAt(a))&&
this.emit("trigger-action",{action:a})};h.prototype.next=function(){this.selectedFeatureIndex+=1;return this};h.prototype.previous=function(){--this.selectedFeatureIndex;return this};h.prototype.zoomToLocation=function(){var a=this,b=this.location,d=this.selectedFeature,e=this.view,h=this.zoomFactor;if(!b||!e)return d=new l("zoom-to:invalid-location-or-view","Cannot zoom to location without a location and view.",{location:b,view:e}),C.error(d),m.reject(d);var h=e.scale/h,c=this.get("selectedFeature.geometry"),
e=d&&"3d"===e.type,b=(e=c||e)?d:b,f=c&&"point"===c.type,k=e&&f&&this._isScreenSize(d),d={target:b,scale:k?h:void 0};x.active=!0;x.disabled=!0;return this._zoomToLocation=d=this.callGoTo({target:d}).then(function(){k&&f&&(a.location=c);x.active=!1;x.disabled=!1;a._zoomToLocation=null}).catch(function(){x.active=!1;x.disabled=!1;a._zoomToLocation=null})};h.prototype._updatePendingPromises=function(a){a&&this._pendingPromises.has(a)&&(this._pendingPromises.delete(a),this.notifyChange("pendingPromisesCount"))};
h.prototype._setVisibleWhenContentExists=function(){var a=this,b=this._handles,d=this.promiseCount;b.remove("pendingVisible");d?(d=k.init(this,"pendingPromisesCount",function(d){a.featureCount&&(a.set("visible",!0),b.remove("pendingVisible"));d||b.remove("pendingVisible")}),b.add(d,"pendingVisible")):this.set("visible",!0)};h.prototype._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};h.prototype._isScreenSize=function(a){var b=this.view;if("3d"!==b.type||"esri.Graphic"!==a.declaredClass)return!0;
if((b=b.getViewForGraphic(a))&&b.whenGraphicBounds){var d=!1;b.whenGraphicBounds(a,{useViewElevation:!0}).then(function(a){d=!a||!a.boundingBox||a.boundingBox[0]===a.boundingBox[3]&&a.boundingBox[1]===a.boundingBox[4]&&a.boundingBox[2]===a.boundingBox[5]});return d}return!0};h.prototype._getPointFromGeometry=function(a){return a?"point"===a.type?a:"extent"===a.type?a.center:"polygon"===a.type?a.centroid:"multipoint"===a.type||"polyline"===a.type?a.extent.center:null:null};h.prototype._centerAtLocation=
function(){var a=this.location,b=this.updateLocationEnabled,d=this.get("view.extent");b&&d&&a&&!d.contains(a)&&this.centerAtLocation()};h.prototype._highlightFeature=function(){var a=this;this._handles.remove("highlight");var b=this.selectedFeature,d=this.highlightEnabled,e=this.view,h=this.visible;if(b&&e&&d&&h){var c=b.layer;c&&e.when(function(){e.whenLayerView(c).then(function(d){if(d&&v.hasHighlight(d)){var e=c.objectIdField,h=b.attributes;d=d.highlight(h&&h[e]||b,{});a._handles.add(d,"highlight")}})})}};
h.prototype._updateFeatures=function(a){var b=this.features;a&&a.length&&(b.length?(a=a.filter(function(a){return-1===b.indexOf(a)}),this.features=b.concat(a)):this.features=a)};a([d.property({type:B})],h.prototype,"actions",void 0);a([d.property({dependsOn:["actions.length","selectedFeature.sourceLayer.popupTemplate.actions.length","selectedFeature.sourceLayer.popupTemplate.overwriteActions","selectedFeature.popupTemplate.actions.length","selectedFeature.popupTemplate.overwriteActions"],readOnly:!0})],
h.prototype,"allActions",null);a([d.property()],h.prototype,"autoCloseEnabled",void 0);a([d.property()],h.prototype,"content",void 0);a([d.property({readOnly:!0,dependsOn:["features"]})],h.prototype,"featureCount",null);a([d.property()],h.prototype,"features",null);a([d.property()],h.prototype,"highlightEnabled",void 0);a([d.property({type:q})],h.prototype,"location",null);a([d.property({readOnly:!0,dependsOn:["promises"]})],h.prototype,"pendingPromisesCount",null);a([d.property({readOnly:!0,dependsOn:["featureCount",
"pendingPromisesCount"]})],h.prototype,"waitingForResult",null);a([d.property({readOnly:!0,dependsOn:["promises"]})],h.prototype,"promiseCount",null);a([d.property()],h.prototype,"promises",null);a([d.property({value:null,readOnly:!0,dependsOn:["features","selectedFeatureIndex","updateLocationEnabled"]})],h.prototype,"selectedFeature",null);a([d.property({value:-1})],h.prototype,"selectedFeatureIndex",null);a([d.property({readOnly:!0,dependsOn:["view.ready"]})],h.prototype,"state",null);a([d.property()],
h.prototype,"title",void 0);a([d.property()],h.prototype,"updateLocationEnabled",void 0);a([d.property()],h.prototype,"view",void 0);a([d.property()],h.prototype,"visible",void 0);a([d.property()],h.prototype,"zoomFactor",void 0);a([d.property()],h.prototype,"centerAtLocation",null);a([d.property()],h.prototype,"clear",null);a([d.property()],h.prototype,"triggerAction",null);a([d.property()],h.prototype,"next",null);a([d.property()],h.prototype,"previous",null);a([d.property()],h.prototype,"zoomToLocation",
null);return h=a([d.subclass("esri.widgets.Popup.PopupViewModel")],h)}(d.declared(A,z))})},"esri/views/support/layerViewUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.hasHighlight=function(c){return c&&"function"===typeof c.highlight}})},"esri/widgets/support/GoTo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b){return function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a.goToOverride=null;a.view=null;return a}c(e,f);e.prototype.callGoTo=function(a){var b=this.view;return this.goToOverride?this.goToOverride(b,a):b.goTo(a.target,a.options)};a([b.property()],e.prototype,"goToOverride",void 0);a([b.property()],e.prototype,"view",void 0);return e=a([b.subclass("esri.widgets.support.GoTo")],e)}(b.declared(f))})},"esri/views/3d/constraints/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ./AltitudeConstraint ./ClipDistanceConstraint ./CollisionConstraint ./TiltConstraint".split(" "),
function(n,g,c,a,f,b,l,e,h,m){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function d(){var a=null!==f&&f.apply(this,arguments)||this;a.tilt=new m.default;a.altitude=new l.default;a.clipDistance=new e.default;a.collision=new h.default;return a}c(d,f);a([b.property({type:m.default})],d.prototype,"tilt",void 0);a([b.property({type:l.default})],d.prototype,"altitude",void 0);a([b.property({type:e.default})],d.prototype,"clipDistance",void 0);a([b.property({type:h.default})],d.prototype,
"collision",void 0);return d=a([b.subclass("esri.views.3d.constraints.Constraints")],d)}(b.declared(f));g.Constraints=n;g.default=n})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints".split(" "),function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function h(){var a=
null!==b&&b.apply(this,arguments)||this;a.min=e.AltitudeDefault.min;a.max=e.AltitudeDefault.max;return a}c(h,b);Object.defineProperty(h.prototype,"mode",{get:function(){f.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.","","4.6");return"manual"},set:function(a){f.deprecated("esri.views.SceneView.constraints.altitude.mode is deprecated. The altitude constraint no longer applies to local scenes and does not have an automatic mode anymore.",
"","4.6")},enumerable:!0,configurable:!0});a([l.property({type:Number})],h.prototype,"min",void 0);a([l.property({type:Number})],h.prototype,"max",void 0);return h=a([l.subclass("esri.views.3d.constraints.AltitudeConstraint")],h)}(l.declared(b));g.AltitudeConstraint=n;g.default=n})},"esri/views/3d/state/Constraints":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Logger ../../../core/accessorSupport/decorators ../support/earthUtils ../support/mathUtils".split(" "),
function(n,g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});var m=b.getLogger("esri.views.3d.state.Constraints");n=function(b){function e(a){a=b.call(this)||this;a.collision=new d;a.distance=Infinity;a.minimumPoiDistance=4;return a}c(e,b);Object.defineProperty(e.prototype,"altitude",{get:function(){return"local"===this.mode?null:this._get("altitude")||null},set:function(a){"local"===this.mode?m.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",a)},enumerable:!0,
configurable:!0});e.prototype.clampAltitude=function(a){return this.altitude?h.clamp(a,this.altitude.min,this.altitude.max):a};e.prototype.clampTilt=function(a,b){if(!this.tilt)return b;a=this.tilt(a);return h.clamp(b,a.min,a.max)};e.prototype.clampDistance=function(a){return Math.min(a,this.distance)};e.prototype.createDefaultTilt=function(){return"local"===this.mode?this.createDefaultTiltLocal():this.createDefaultTiltGlobal()};e.prototype.createConstantMaxTilt=function(a){return function(b,d){void 0===
d&&(d=k);d.min=g.TiltDefault.min;d.max=a;return d}};e.prototype.createDefaultTiltLocal=function(){var a=this.collision.enabled?h.makePiecewiseLinearFunction([[4E3,g.TiltDefault.max],[1E4,h.deg2rad(88)],[6E6,h.deg2rad(88)]]):function(){return g.TiltDefault.max};return function(b,d){void 0===d&&(d=k);d.min=g.TiltDefault.min;d.max=a(b);return d}};e.prototype.createDefaultTiltGlobal=function(){var a=this.collision.enabled?h.makePiecewiseLinearFunction([[4E3,g.TiltDefault.max],[5E4,h.deg2rad(88)],[6E6,
h.deg2rad(88)],[2E7,g.TiltDefault.min]]):h.makePiecewiseLinearFunction([[3E5,g.TiltDefault.max],[3E6,h.deg2rad(88)],[6E6,h.deg2rad(88)],[2E7,g.TiltDefault.min]]);return function(b,d){void 0===d&&(d=k);d.min=g.TiltDefault.min;d.max=a(b);return d}};a([l.property()],e.prototype,"altitude",null);a([l.property({readOnly:!0})],e.prototype,"collision",void 0);a([l.property()],e.prototype,"distance",void 0);a([l.property({readOnly:!0})],e.prototype,"minimumPoiDistance",void 0);a([l.property()],e.prototype,
"tilt",void 0);a([l.property({constructOnly:!0})],e.prototype,"mode",void 0);return e=a([l.subclass("esri.views.3d.state.Constraints")],e)}(l.declared(f));g.Constraints=n;g.AltitudeDefault={min:-2E5,max:4*e.earthRadius};g.TiltDefault={min:h.deg2rad(.5),max:h.deg2rad(179.5)};var k={min:0,max:0},d=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.elevationMargin=5;return a}c(d,b);a([l.property({type:Boolean})],d.prototype,"enabled",void 0);a([l.property({type:Number})],
d.prototype,"elevationMargin",void 0);return d=a([l.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],d)}(l.declared(f));g.default=n})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function e(){var a=
null!==f&&f.apply(this,arguments)||this;a.mode="auto";return a}c(e,f);Object.defineProperty(e.prototype,"near",{get:function(){return this._get("near")},set:function(a){this._set("near",a);a>=this._get("far")&&(this.far=a+1E-9);this.mode="manual"},enumerable:!0,configurable:!0});e.prototype.castNear=function(a){return Math.max(1E-8,a)};Object.defineProperty(e.prototype,"far",{get:function(){return this._get("far")},set:function(a){this._set("far",a);a<=this._get("near")&&(this.near=a-1E-9);this.mode=
"manual"},enumerable:!0,configurable:!0});e.prototype.castFar=function(a){return Math.max(1E-8,a)};e.prototype.autoUpdate=function(a,b){"auto"===this.mode&&(this._get("near")!==a&&this._set("near",a),this._get("far")!==b&&this._set("far",b))};a([b.property({type:Number,value:1E-8})],e.prototype,"near",null);a([b.cast("near")],e.prototype,"castNear",null);a([b.property({type:Number,value:1E-8})],e.prototype,"far",null);a([b.cast("far")],e.prototype,"castFar",null);a([b.property({type:String})],e.prototype,
"mode",void 0);return e=a([b.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],e)}(b.declared(f));g.ClipDistanceConstraint=n;g.default=n})},"esri/views/3d/constraints/CollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/_base/kernel ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function e(){return null!==
b&&b.apply(this,arguments)||this}c(e,b);Object.defineProperty(e.prototype,"enabled",{set:function(a){f.deprecated("SceneView.constraint.collision.enabled","Use Map.ground.navigationConstraint instead","4.8");this._set("enabled",a)},enumerable:!0,configurable:!0});a([l.property({value:!0})],e.prototype,"enabled",null);return e=a([l.subclass("esri.views.3d.constraints.CollisionConstraint")],e)}(l.declared(b));g.CollisionConstraint=n;g.default=n})},"esri/views/3d/constraints/TiltConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../state/Constraints ../support/mathUtils".split(" "),
function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});var h=e.rad2deg(l.TiltDefault.min),m=e.rad2deg(l.TiltDefault.max);n=function(f){function d(){var a=null!==f&&f.apply(this,arguments)||this;a.mode="auto";return a}c(d,f);Object.defineProperty(d.prototype,"max",{get:function(){return this._get("max")},set:function(a){this._set("max",a);this.mode="manual"},enumerable:!0,configurable:!0});d.prototype.castMax=function(a){return e.clamp(a,h,m)};d.prototype.autoUpdate=function(a){"auto"===
this.mode&&this._get("max")!==a&&this._set("max",a)};a([b.property({type:String})],d.prototype,"mode",void 0);a([b.property({type:Number,value:m})],d.prototype,"max",null);a([b.cast("max")],d.prototype,"castMax",null);return d=a([b.subclass("esri.views.3d.constraints.TiltConstraint")],d)}(b.declared(f));g.TiltConstraint=n;g.default=n})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/lang ../../../core/accessorSupport/decorators ./SceneViewAtmosphere ./SceneViewLighting ../../../webscene/Environment ../../../webscene/Lighting".split(" "),
function(n,g,c,a,f,b,l,e,h,m){return function(h){function d(){var a=null!==h&&h.apply(this,arguments)||this;a.atmosphere=new l.default;return a}c(d,h);k=d;Object.defineProperty(d.prototype,"lighting",{set:function(a){if(a)if(this.lighting)null!=a.date&&(this.lighting.date=a.date),null!=a.defaultDate&&(this.lighting.defaultDate=a.defaultDate),null!=a.displayUTCOffset&&(this.lighting.displayUTCOffset=a.displayUTCOffset),this.lighting.directShadowsEnabled=a.directShadowsEnabled,null!=a.ambientOcclusionEnabled&&
(this.lighting.ambientOcclusionEnabled=a.ambientOcclusionEnabled),null!=a.cameraTrackingEnabled&&(this.lighting.cameraTrackingEnabled=a.cameraTrackingEnabled);else if(a instanceof e.default)this._set("lighting",a);else if(a instanceof m){var b={directShadowsEnabled:a.directShadowsEnabled};null!=a.date&&(b.date=a.date);null!=a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);null!=a.defaultDate&&(b.defaultDate=a.defaultDate);this._set("lighting",new e.default(b))}else this._set("lighting",
new e.default(a));else this.lighting||this._set("lighting",new e.default)},enumerable:!0,configurable:!0});d.prototype.clone=function(){return new k({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:f.clone(this.background)})};var k;a([b.property({type:l.default,json:{read:!1}})],d.prototype,"atmosphere",void 0);a([b.property()],d.prototype,"lighting",null);return d=k=a([b.subclass("esri.views.3d.environment.SceneViewEnvironment")],
d)}(b.declared(h))})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function e(){return null!==f&&f.apply(this,arguments)||this}c(e,f);Object.defineProperty(e.prototype,"quality",{set:function(a){-1!==["low","high"].indexOf(a)&&
this._set("quality",a)},enumerable:!0,configurable:!0});e.prototype.clone=function(){return new this.constructor({quality:this.quality})};a([b.property({type:String,value:"low"})],e.prototype,"quality",null);return e=a([b.subclass("esri.views.3d.environment.SceneViewAtmosphere")],e)}(b.declared(f));g.SceneViewAtmosphere=n;g.default=n})},"esri/views/3d/environment/SceneViewLighting":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Evented ../../../core/accessorSupport/decorators ../../../webscene/Lighting".split(" "),
function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function d(a){a=f.call(this)||this;a.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};a.cameraTrackingEnabled=!0;a.ambientOcclusionEnabled=!1;var b=(new Date).getFullYear(),b=new Date("March 15, "+b+" 12:00:00 UTC");a._set("defaultDate",b);a._set("date",b);return a}c(d,f);Object.defineProperty(d.prototype,"defaultDate",{get:function(){return new Date(this._get("defaultDate").getTime())},set:function(a){var b=
this._get("date")===this._get("defaultDate");a=new Date(a.getTime());this._set("defaultDate",a);b&&this._set("date",a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"date",{set:function(a){null!=a&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(a.getTime())),this._emitDateWillChange())},enumerable:!0,configurable:!0});d.prototype.autoUpdate=function(a,b){var d=this._calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=b.hours;
this.positionTimezoneInfo.minutes=b.minutes;this.positionTimezoneInfo.seconds=b.seconds;b=null;null!=a&&(this.positionTimezoneInfo.autoUpdated=!0,b=this.date&&this.date.getTime(),this._set("date",new Date(a.getTime())),this._emitDateWillChange());var e=this._calculateTimezoneOffset(this.positionTimezoneInfo);d!==e&&(m.target=this,m.timezoneOffset=e,this.emit("timezone-will-change",m));if(null!=a)return b!==a.getTime()};d.prototype._calculateTimezoneOffset=function(a){return Math.round(a.hours+a.minutes/
60+a.seconds/3600)};d.prototype._emitDateWillChange=function(){h.target=this;e.setTime(this._get("date").getTime());h.date=e;this.emit("date-will-change",h)};a([b.property({type:Boolean})],d.prototype,"cameraTrackingEnabled",void 0);a([b.property({type:Boolean})],d.prototype,"ambientOcclusionEnabled",void 0);a([b.property({type:Date})],d.prototype,"defaultDate",null);a([b.property({type:Date})],d.prototype,"date",null);return d=a([b.subclass("esri.views.3d.environment.SceneViewLighting")],d)}(b.declared(l,
f));g.SceneViewLighting=n;var e=new Date,h={target:null,date:null},m={target:null,timezoneOffset:0};g.default=n})},"esri/webscene/Lighting":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b){return function(f){function e(a){a=f.call(this,a)||this;a.date=null;a.directShadowsEnabled=!1;a.displayUTCOffset=null;return a}c(e,f);h=e;e.prototype.readDate=function(a,
b){return null!=b.datetime&&new Date(b.datetime)||null};e.prototype.writeDate=function(a,b,d){b[d]=a.getTime()};e.prototype.readDirectShadowsEnabled=function(a,b){return!!b.directShadows};e.prototype.writedirectShadowsEnabled=function(a,b,d){a&&(b[d]=a)};e.prototype.writeDisplayUTCOffset=function(a,b){null!=a&&(b.displayUTCOffset=a)};e.prototype.clone=function(){return new h({date:null!=this.date?new Date(this.date.getTime()):null,directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=
this.displayUTCOffset?this.displayUTCOffset:null})};e.sanitizeJSON=function(a){var b={datetime:a.datetime};void 0!==a.directShadows&&(b.directShadows=!!a.directShadows);void 0!==a.displayUTCOffset&&(b.displayUTCOffset=a.displayUTCOffset);return b};var h;a([b.property({type:Date,json:{type:Number,write:{target:"datetime"}}})],e.prototype,"date",void 0);a([b.reader("date",["datetime"])],e.prototype,"readDate",null);a([b.writer("date")],e.prototype,"writeDate",null);a([b.property({type:Boolean,json:{write:{target:"directShadows"}}})],
e.prototype,"directShadowsEnabled",void 0);a([b.reader("directShadowsEnabled",["directShadows"])],e.prototype,"readDirectShadowsEnabled",null);a([b.writer("directShadowsEnabled")],e.prototype,"writedirectShadowsEnabled",null);a([b.property({type:Number,json:{write:!0}})],e.prototype,"displayUTCOffset",void 0);a([b.writer("displayUTCOffset")],e.prototype,"writeDisplayUTCOffset",null);return e=h=a([b.subclass("esri.webscene.Lighting")],e)}(b.declared(f))})},"esri/webscene/Environment":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/lang ../core/accessorSupport/decorators ./Lighting ./background/utils".split(" "),
function(n,g,c,a,f,b,l,e,h){var m=function(a,b,e){return{enabled:!e||!e.isPresentation}};return function(f){function d(a){a=f.call(this,a)||this;a.lighting=new e;a.background=null;a.atmosphereEnabled=!0;a.starsEnabled=!0;return a}c(d,f);k=d;d.prototype.clone=function(){return new k({lighting:e.prototype.clone.call(this.lighting),background:b.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled})};d.sanitizeJSON=function(a){return{lighting:a.lighting?e.sanitizeJSON(a.lighting):
(new e).toJSON(),background:a.background,atmosphereEnabled:a.atmosphereEnabled,starsEnabled:a.starsEnabled}};var k;a([l.property({type:e,json:{write:!0}})],d.prototype,"lighting",void 0);a([l.property(h.backgroundProperty)],d.prototype,"background",void 0);a([l.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],d.prototype,"atmosphereEnabled",void 0);a([l.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:m}}})],d.prototype,"starsEnabled",void 0);return d=k=a([l.subclass("esri.webscene.Environment")],
d)}(l.declared(f))})},"esri/webscene/background/utils":function(){define(["require","exports","./Background","./ColorBackground"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n={base:c,key:"type",typeMap:{color:a}};g.backgroundProperty={types:n,json:{read:function(a){return function(b,c,e){if(!b)return b;for(var h in a.typeMap)if(b.type===h)return c=new a.typeMap[h],c.read(b,e),c}}(n),write:{overridePolicy:function(a,b,c){return{enabled:!c||!c.isPresentation}}}}}})},"esri/webscene/background/Background":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../core/JSONSupport ../../core/kebabDictionary ../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b,l,e){var h=l.strict()({color:"color"});return function(b){function l(a){return b.call(this)||this}c(l,b);l.prototype.normalizeCtorArgs=function(a){a&&a.type&&(a=f({},a),delete a.type);return a};l.prototype.clone=function(){};a([e.property({type:h.apiValues,readOnly:!0,json:{type:h.jsonValues,read:!1,write:h.write}})],l.prototype,"type",void 0);return l=a([e.subclass("esri.webscene.background.Background")],l)}(e.declared(b))})},"esri/webscene/background/ColorBackground":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/tsSupport/assignHelper ../../Color ../../core/accessorSupport/decorators ../../symbols/support/materialUtils ./Background".split(" "),
function(n,g,c,a,f,b,l,e,h){var m=f({},e.colorAndTransparencyProperty,{nonNullable:!0});return function(e){function d(a){a=e.call(this)||this;a.type="color";a.color=new b([0,0,0,1]);return a}c(d,e);h=d;d.prototype.clone=function(){return new h(this.cloneProperties())};d.prototype.cloneProperties=function(){return{color:this.color.clone()}};var h;a([l.enumeration.serializable()({color:"color"})],d.prototype,"type",void 0);a([l.property(m)],d.prototype,"color",void 0);return d=h=a([l.subclass("esri.webscene.background.ColorBackground")],
d)}(l.declared(h))})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ./EnvironmentRenderer ../lib/gl-matrix ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z){Object.defineProperty(g,"__esModule",{value:!0});var x=[.5773502691896258,-.5773502691896258,.5773502691896258];n=function(b){function l(a){a=b.call(this)||this;a.referencePointUpdateDelay=200;a.referencePointUpdateInterval=3E3;a.referencePointUpdateDistThreshold=1E6;a._referencePosUpdateQuery=null;a._referencePosMapCoordsRequested=null;a._viewHandles=new e;a._preserveAbsoluteDateTime=!1;a._trackingEnabled=!1;a._viewConnected=!1;a._referencePosResetPreserveAbsoluteTime=
!1;a._referencePosUpdateTimer=null;a._referencePosWGS84=null;a._referencePosMapCoords=null;a._mainLight=new A.MainLight;a._ambientLight=new A.AmbientLight;a._moonLight=new A.FillLight;a._environmentRenderer=null;a._resetReferencePosition();return a}c(l,b);l.prototype.destroy=function(){this._viewHandles.destroy();this.disposeRendering()};Object.defineProperty(l.prototype,"updating",{get:function(){return!this.noReferencePositionQueries&&(!!this._referencePosUpdateQuery||!!this._referencePosMapCoordsRequested)},
enumerable:!0,configurable:!0});l.prototype.updateReadyChange=function(a){a&&!this._viewConnected?(this._viewConnected=!0,this.connectView(this.view)):!a&&this._viewConnected&&(this._viewConnected=!1,this.disconnectView(this.view))};l.prototype.disposeRendering=function(){this._environmentRenderer&&(this._environmentRenderer.destroy(),this._environmentRenderer=null);this._resetReferencePosition(!0)};l.prototype.connectView=function(a){var b=this;this._environmentRenderer=new r({view:a});this._viewHandles.add([this.view.watch("environment.lighting.date",
function(a){return b._lightingDateHandler(a)},!0),this.view.watch("interacting,stationary",this._interactingStationaryHandler.bind(this)),this.view.watch(["environment.lighting.directShadowsEnabled","environment.lighting.ambientOcclusionEnabled","environment.background.color"],this._updateRenderParamsHandler.bind(this)),this.view.watch("spatialReference",this._spatialReferenceHandler.bind(this)),m.init(this.view,"viewingMode",this._viewingModeHandler.bind(this)),m.init(this.view,"environment.lighting.cameraTrackingEnabled",
this._updateCameraTracking.bind(this),!0),m.init(this,"view.state.camera",this._cameraHandler.bind(this,null),!0),this.watch("noReferencePositionQueries",this._cameraHandler.bind(this,null))]);this._updateRenderParamsHandler();this._updateLightParams();this._cameraHandler()};l.prototype._updateCameraTracking=function(a){if(this._trackingEnabled=a)this._cameraHandler();else if(a=this.get("view.environment.lighting"))a.positionTimezoneInfo.autoUpdated=!1};l.prototype.disconnectView=function(a){this.disposeRendering();
this._viewHandles.removeAll()};l.prototype._lightingDateHandler=function(a){if(a){var b=this.view.environment.lighting;if(!b.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;var d=this.view.spatialReference;if(!(d.isWGS84||d.isWebMercator||(d=this.view.camera.position,this._referencePosMapCoords&&this._referencePosMapCoords.equals(d)))){this._requestReferencePositionUpdate(d);return}this._preupdateTracking(a);this._referencePosWGS84&&(d=t.positionToTimezone(this._referencePosWGS84,
D),b.autoUpdate(null,d),this._trackingEnabled&&(b.positionTimezoneInfo.autoUpdated=!0))}this._updateLightParams(a)}};l.prototype._preupdateTracking=function(a){!this._trackingEnabled&&this.get("view.environment.lighting.cameraTrackingEnabled")&&this._cameraHandler(a)};l.prototype._cameraHandler=function(a){void 0===a&&(a=null);if(this.view.ready){var b=this.view.camera;if(b){var d=this.view.spatialReference;d.isWGS84||d.isWebMercator?this._cameraHandlerGlobal(b,a):this._cameraHandlerLocal(b,a)}}};
l.prototype._cameraHandlerGlobal=function(a,b){a=a.position;this._referencePosWGS84||(this._referencePosWGS84=new d({spatialReference:q.WGS84}));a.spatialReference.isWebMercator?p.webMercatorToGeographic(a,!1,this._referencePosWGS84):(this._referencePosWGS84.x=a.x,this._referencePosWGS84.y=a.y);this._referencePosWGS84.z=a.z;this._autoUpdateTimezone(a,b)||this._updateLightParams(b)};l.prototype._cameraHandlerLocal=function(a,b){a=a.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||
this._exceedsReferencePosDistThreshold(a))&&this._requestReferencePositionUpdate(a,!0);this.view.mapCoordsHelper&&this._referencePosWGS84&&(this._referencePosWGS84.z=a.z*this.view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};l.prototype._interactingStationaryHandler=function(){!this.view.interacting&&this.view.stationary&&this._executePendingReferencePositionUpdate()};l.prototype._updateLightParams=function(a){void 0===a&&(a=null);var b=this.view.environment.lighting;a=a||b.date;var b=
this.view._stage,d;this._referencePosWGS84?(d=v.computeColorAndIntensity(a,this._referencePosWGS84),v.computeDirection(a,this._referencePosWGS84,this.view.viewingMode,d.diffuse.direction)):d={diffuse:{color:[1,1,1],intensity:.55,direction:x},ambient:{color:[1,1,1],intensity:.55},noonFactor:.5,globalFactor:0};u.vec3d.scale(d.diffuse.color,d.diffuse.intensity*Math.PI,this._mainLight.intensity);u.vec3d.negate(d.diffuse.direction,this._mainLight.direction);u.vec3d.scale(d.ambient.color,d.ambient.intensity,
this._ambientLight.intensity);u.vec3d.lerp(C,G,d.globalFactor,this._moonLight.intensity);u.vec3d.scale(this._moonLight.intensity,(1-.5*d.globalFactor)*(1-.4*d.noonFactor*(1-d.globalFactor)));u.vec3d.set(d.diffuse.direction,this._moonLight.direction);b.setLighting({lights:[this._mainLight,this._ambientLight,this._moonLight],globalFactor:d.globalFactor,groundLightingFactor:1-d.noonFactor});this._updateRenderParamsHandler()};l.prototype._autoUpdateTimezone=function(a,b){void 0===b&&(b=null);if(!this.view.get("environment.lighting.cameraTrackingEnabled"))return!1;
var d=B;d.setTime((b||this.view.environment.lighting.date).getTime());a=t.positionToTimezone(a,D);var e=this.view.environment.lighting.positionTimezoneInfo;if(!e.autoUpdated)e=a;else if(e.hours===a.hours&&e.minutes===a.minutes&&e.seconds===a.seconds)return!1;var h=d.getUTCHours()-(a.hours-e.hours),c=d.getUTCMinutes()-(a.minutes-e.minutes),e=d.getUTCSeconds()-(a.seconds-e.seconds);d.setUTCHours(h);d.setUTCMinutes(c);d.setUTCSeconds(e);return b?!1:this.view.environment.lighting.autoUpdate(d,a)};l.prototype._updateRenderParamsHandler=
function(){var a=this.view._stage,b=!0;this._referencePosWGS84&&(b=v.computeShadowsEnabled(this._referencePosWGS84,this.view.viewingMode));var d=this.view.environment.background,d=d instanceof z?{type:"color",color:f.toUnitRGBA(d.color)}:{type:"color",color:[0,0,0,1]};a&&a.setRenderParams({shadowMap:this.view.environment.lighting.directShadowsEnabled&&b,ssao:this.view.environment.lighting.ambientOcclusionEnabled,background:d})};l.prototype._spatialReferenceHandler=function(){this._resetReferencePosition()};
l.prototype._viewingModeHandler=function(){this._resetReferencePosition()};l.prototype._resetReferencePosition=function(a){void 0===a&&(a=!1);this._cancelReferencePosUpdates();this._referencePosWGS84=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=this._referencePosMapCoords=null;a||this.notifyChange("updating")};l.prototype._requestReferencePositionUpdate=function(a,b){var d=this;void 0===b&&(b=!1);if(this.view.mapCoordsHelper.canProject()&&!this.noReferencePositionQueries&&
(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(a):this._referencePosMapCoordsRequested=a.clone(),this._referencePosResetPreserveAbsoluteTime=!!b,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&!this.view.interacting&&this.view.stationary)){var e=this._referencePosUpdateQuery=h.after(this.referencePointUpdateDelay).then(function(){if(d._referencePosUpdateQuery===e)return d._doReferencePositionUpdateQuery(function(){return d._referencePosUpdateQuery!==
e})}).always(function(){d._referencePosUpdateQuery===e&&(d._referencePosUpdateQuery=null,d._referencePosUpdateTimer||d._executePendingReferencePositionUpdate(),d.notifyChange("updating"))}),c=this._referencePosUpdateTimer=h.after(this.referencePointUpdateInterval).then(function(){d._referencePosUpdateTimer===c&&(d._referencePosUpdateTimer=null,d._referencePosUpdateQuery||d._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};l.prototype._doReferencePositionUpdateQuery=function(a){var b=
this;this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=this._referencePosResetPreserveAbsoluteTime=null;return this.view.mapCoordsHelper.toGeographic(this._referencePosMapCoords).then(function(e){if(!a()&&!isNaN(e[0])&&!isNaN(e[1])){var h=b._referencePosMapCoords.z*
b.view.mapCoordsHelper.unitInMeters;b._referencePosWGS84?(b._referencePosWGS84.x=e[0],b._referencePosWGS84.y=e[1],b._referencePosWGS84.z=h):b._referencePosWGS84=new d({x:e[0],y:e[1],z:h,spatialReference:q.WGS84});b._referencePosChanged()}})};l.prototype._executePendingReferencePositionUpdate=function(){var a=this._referencePosMapCoordsRequested;a&&this._requestReferencePositionUpdate(a,this._referencePosResetPreserveAbsoluteTime)};l.prototype._referencePosChanged=function(){this._preserveAbsoluteDateTime?
this._updateLightParams():this._autoUpdateTimezone(this._referencePosWGS84)||this._updateLightParams()};l.prototype._exceedsReferencePosDistThreshold=function(a){return this._referencePosMapCoords?(a=this._referencePosMapCoords.distance(a),this.view.mapCoordsHelper&&(a*=this.view.mapCoordsHelper.unitInMeters),a>this.referencePointUpdateDistThreshold):!0};l.prototype._cancelReferencePosUpdates=function(){this._referencePosUpdateTimer=this._referencePosUpdateQuery=null};l.FIXED_LIGHT_DIRECTION=x;a([k.property({type:Boolean,
dependsOn:["noReferencePositionQueries"],readOnly:!0})],l.prototype,"updating",null);a([k.property()],l.prototype,"noReferencePositionQueries",void 0);a([k.property({constructOnly:!0})],l.prototype,"view",void 0);a([k.property()],l.prototype,"_environmentRenderer",void 0);return l=a([k.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],l)}(k.declared(b,l));g.SceneViewEnvironmentManager=n;var B=new Date,D={hours:0,minutes:0,seconds:0},C=u.vec3d.createFrom(.22,.22,.33),G=u.vec3d.createFrom(.22,
.22,.22);g.default=n})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./PanoramicAtmosphere ./RealisticAtmosphere ./SimpleAtmosphere ./Stars ../webgl-engine/lib/RenderSlot".split(" "),function(n,g,c,a,f,b,l,e,h,m,k,d,q){var p=[q.POSTPROCESSING_ATMOSPHERE_OPAQUE,q.POSTPROCESSING_ATMOSPHERE_TRANSPARENT];
return function(f){function q(){var a=null!==f&&f.apply(this,arguments)||this;a.needsRender=!1;a.didRender=!0;a._handles=new b;a._initContext=null;a._atmosphereReadyPromise=null;a._atmosphere=null;a._stars=null;return a}c(q,f);q.prototype.initialize=function(){this.view._stage.addRenderPlugin(p,this)};q.prototype.destroy=function(){this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=null);this._stars&&(this._stars.destroy(),this._stars=null);this._handles&&this._handles.removeAll();this.view&&
(this.view._stage.removeRenderPlugin(this),this.view=null)};q.prototype.initializeRenderContext=function(a){this._initContext=a;this.setup(a)};q.prototype.setup=function(a){var b=this;this._handles.add(l.when(this.view,"basemapTerrain",function(){return b._updateBasemapTerrain()}));this._handles.add([l.init(this.view,["viewingMode","environment.atmosphereEnabled","environment.atmosphere.quality"],function(){return b._updateAtmosphere()}),l.init(this.view,"environment.starsEnabled",function(){return b._updateStars()})])};
q.prototype.uninitializeRenderContext=function(a){this._stars&&(this._stars.uninitializeRenderContext(a),this._stars.destroy(),this._stars=null);this._atmosphere&&(this._atmosphere.uninitializeRenderContext(a),this._atmosphere.destroy(),this._atmosphere=null)};q.prototype.render=function(a){var b=this.view.basemapTerrain;if(!(b&&b.loaded||"global"!==this.view.viewingMode))return!1;b=!0;this._stars&&(b=this._stars.render(a)&&b);this._atmosphere&&(b=this._atmosphere.render(a)&&b);return b};q.prototype._updateStars=
function(){var a=this.view.get("environment.starsEnabled")||!1;a&&!this._stars?(this._stars=new d(this.view),this._stars.initializeRenderContext(this._initContext),this.needsRender=!0):!a&&this._stars&&(this._stars.destroy(),this._stars=null,this.needsRender=!0)};q.prototype._updateAtmosphere=function(){var a=this,b=this._getAtmosphereType(this._initContext);if(this.atmosphereType!==b){this.atmosphereType=b;var d=null;switch(b){case "realistic":d=m;break;case "panoramic":d=h;break;case "simple":d=
k}if(d){var e=new d(this.view);this._atmosphereReadyPromise&&(this._atmosphereReadyPromise.cancel(),this._atmosphereReadyPromise=null);e.initializeRenderContext(this._initContext);null==this._atmosphere&&(this._atmosphere=e,this.needsRender=!0);this._atmosphereReadyPromise=e.when(function(){a._atmosphere!==e&&(a._atmosphere&&(a._atmosphere.destroy(),a._atmosphere=null),a._atmosphere=e);a._atmosphereReadyPromise=null;a.needsRender=!0;a._updateBasemapTerrain()})}else this._atmosphere&&(this._atmosphere.destroy(),
this._atmosphere=null),this._updateBasemapTerrain()}};q.prototype._getAtmosphereType=function(a){var b=this.view.get("environment.atmosphereEnabled"),d=this.view.get("environment.atmosphere.quality"),e=this.view.viewingMode;return b&&null!=d?"local"===e?"panoramic":"high"===d&&m.isSupported(a)?"realistic":"simple":"none"};q.prototype._updateBasemapTerrain=function(){var a=this.view.basemapTerrain;a&&(a.velvetOverground=null!=this._atmosphere&&"simple"===this.atmosphereType)};a([e.property()],q.prototype,
"view",void 0);return q=a([e.subclass("esri.views.3d.environment.EnvironmentRenderer")],q)}(e.declared(f))})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("require exports ./resources/SimpleAtmosphereTexture ../lib/gl-matrix ../support/imageUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Texture ../../webgl/Util ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v){n=function(){function l(a){this.needsRender=!1;this.didRender=!0;this.slot=m.POSTPROCESSING_ATMOSPHERE_OPAQUE;this.view=a}l.prototype.destroy=function(){this._program&&(this._program.dispose(),this._program=null);this._texture&&(this._texture.dispose(),this._texture=null)};l.prototype.when=function(a){return this._readyPromise.then(a)};l.prototype.initializeRenderContext=function(a){var b=this,e=a.rctx;this._program=p.createProgram(e,d.colorPass,{panoramic:!0});
this._vao=this._createVertexArrayObject(e);this._vaoCount=t.vertexCount(this._vao,"geometry");this._readyPromise=f.requestImage(c).then(function(d){b._texture=new r(a.rctx,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},d);b.needsRender=!0})};l.prototype.uninitializeRenderContext=function(a){this.destroy()};l.prototype.render=function(b){if(b.slot!==this.slot||b.pass!==h.MATERIAL||null==this._texture)return!1;var d=b.rctx,e=this._program;d.bindProgram(e);d.bindTexture(this._texture);
e.setUniform1i("tex",0);e.setUniformMatrix4fv("proj",b.camera.projectionMatrix);a.mat4d.toRotationMat(b.camera.viewMatrix,A);e.setUniformMatrix4fv("view",A);e.setUniform4f("color",1,1,1,1);e.setUniform3fv("lightDirection",b.lightingData.direction);d.setDepthTestEnabled(!0);d.setFaceCullingEnabled(!0);d.setDepthFunction(515);d.setBlendingEnabled(!0);d.setDepthWriteEnabled(!1);d.bindVAO(this._vao);u.assertCompatibleVertexAttributeLocations(this._vao,e);d.drawArrays(4,0,this._vaoCount);d.setDepthWriteEnabled(!0);
d.setBlendingEnabled(!1);d.setDepthFunction(513);d.setFaceCullingEnabled(!1);return!0};l.prototype._createVertexArrayObject=function(a){for(var h=e.createPolySphereGeometry(1,2,!1),c=h.indices[k.VertexAttrConstants.POSITION],f=0;f<c.length;f+=3){var l=c[f];c[f]=c[f+2];c[f+2]=l}for(var h=h.vertexAttributes[k.VertexAttrConstants.POSITION].data,l=z.createBuffer(c.length),m=l.position,f=0;f<c.length;++f){var p=3*c[f];m.set(f,0,h[p]);m.set(f,1,h[p+1]);m.set(f,2,h[p+2])}return new v(a,d.colorPass.attributes,
{geometry:b.glLayout(z)},{geometry:q.createVertex(a,35044,l.buffer)})};return l}();var A=a.mat4d.create(),z=l.newLayout().vec3f("position");return n})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(["require","exports"],function(n,g){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAAB3RJTUUH4QkLDx4bnqU2+QAAAd1JREFUSMd9lkmWxDAIQ/Xluv+V0wuDjaeuhV+IGQUoJUnNwGfAVvx+lsBCWJIsCaMpQn8nuhgqyyEzbAX1Ih0oHaQZN5X5jul581diaDVbSgAdZv1YLoCLyn/RruCsOdcqR7RS/jXkLMa9UddcDn9O7G8gwprzs6xbQl/Fns3BE90r9veQ/wzNrTM5p1yDF1yokLCosDX5kik1lxeSWxfWsihN/lZcHuPIOuhccZ4Ovt74qQK3USkFzsQx7Ki5NgqoMI1J5ILztr9UrGoGHN2qnSEwOHiD97ByDghs/KIVYp9DfdIIoJPcBkWWnM2O2s5ru3su+8GdPLhM5048r/09UDsZmJ3HRwe5MT/aA9Ul4cG74+lIvICYlZcFY42B6vAzuz/HEVn5VbP3DDgQ7xuAGZtnI76cEkbPczDDgSMDR8iFkfBMTQV728mnsx84GopNWZxQsWJxbI9pD0hmNAzWB8bun41hRk+3mNlRFvbY86mcMEVCWWAX+xJbERJHWVPP3Wkq91uyDtuKDLrYNKLl7bww6rZulo3jnafyePJ64ZZi67aEl0MkbJtTbE1h+2vIzVOU3JwWISrNyNtfi+9xqECIXZk87ODcEMeBhjj41GN1Xf+DzP9c9UmPd39C1BID2rDpAwAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/support/imageUtils":function(){define(["require","exports","../../../request"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.dataURItoBlob=function(a){var c=atob(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];for(var b=new ArrayBuffer(c.length),l=new Uint8Array(b),e=0;e<c.length;e++)l[e]=c.charCodeAt(e);return new Blob([b],{type:a})};g.requestImage=function(a){return c(a,{responseType:"image"}).then(function(a){return a.data})}})},"esri/views/3d/support/buffer/glUtil":function(){define(["require",
"exports","../../../../core/tsSupport/assignHelper"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});var a={divisor:0,prefixA:!1};g.glLayout=function(b,l){void 0===l&&(l={});l=c({},a,l);var e=b.stride;return b.fieldNames.filter(function(a){a=b.fields.get(a).optional;return!(a&&a.glPadding)}).map(function(a){var h=b.fields.get(a),c=h.constructor.ElementCount,d;d=f[h.constructor.ElementType];if(!d)throw Error("BufferType not supported in WebGL");var q=h.offset,h=!(!h.optional||!h.optional.glNormalized);
return{name:l.prefixA?"a"+a[0].toUpperCase()+a.substr(1):a,stride:e,count:c,type:d,offset:q,normalized:h,divisor:l.divisor}})};var f={u8:5121,u16:5123,u32:5125,i8:5120,i16:5122,i32:5124,f32:5126}})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["require","exports","./BufferView"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});var a=function(){function a(a,b){this.layout=a;this.buffer="number"===typeof b?new ArrayBuffer(b*a.stride):b;b=0;for(var e=a.fieldNames;b<
e.length;b++){var c=e[b],f=a.fields.get(c);this[c]=new f.constructor(this.buffer,f.offset,this.stride)}}Object.defineProperty(a.prototype,"stride",{get:function(){return this.layout.stride},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"count",{get:function(){return this.buffer.byteLength/this.stride},enumerable:!0,configurable:!0});a.prototype.getField=function(a,b){return(a=this[a])&&a.elementCount===b.ElementCount&&a.elementType===b.ElementType?a:null};a.prototype.slice=function(b,
e){return new a(this.layout,this.buffer.slice(b*this.stride,e*this.stride))};return a}(),f=function(){function b(){this.stride=0;this.fields=new Map;this.fieldNames=[]}b.prototype.vec2f=function(a,b){this.fields.set(a,{size:8,constructor:c.BufferViewVec2f,offset:this.stride,optional:b});this.stride+=8;this.fieldNames.push(a);return this};b.prototype.vec2f64=function(a,b){this.fields.set(a,{size:16,constructor:c.BufferViewVec2f64,offset:this.stride,optional:b});this.stride+=16;this.fieldNames.push(a);
return this};b.prototype.vec3f=function(a,b){this.fields.set(a,{size:12,constructor:c.BufferViewVec3f,offset:this.stride,optional:b});this.stride+=12;this.fieldNames.push(a);return this};b.prototype.vec3f64=function(a,b){this.fields.set(a,{size:24,constructor:c.BufferViewVec3f64,offset:this.stride,optional:b});this.stride+=24;this.fieldNames.push(a);return this};b.prototype.vec4f=function(a,b){this.fields.set(a,{size:16,constructor:c.BufferViewVec4f,offset:this.stride,optional:b});this.stride+=16;
this.fieldNames.push(a);return this};b.prototype.vec4f64=function(a,b){this.fields.set(a,{size:32,constructor:c.BufferViewVec4f64,offset:this.stride,optional:b});this.stride+=32;this.fieldNames.push(a);return this};b.prototype.mat3f=function(a,b){this.fields.set(a,{size:36,constructor:c.BufferViewMat3f,offset:this.stride,optional:b});this.stride+=36;this.fieldNames.push(a);return this};b.prototype.mat4f=function(a,b){this.fields.set(a,{size:64,constructor:c.BufferViewMat4f,offset:this.stride,optional:b});
this.stride+=64;this.fieldNames.push(a);return this};b.prototype.vec4u8=function(a,b){this.fields.set(a,{offset:this.stride,size:4,optional:b,constructor:c.BufferViewVec4u8});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.f32=function(a,b){this.fields.set(a,{offset:this.stride,size:4,optional:b,constructor:c.BufferViewFloat});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.f64=function(a,b){this.fields.set(a,{offset:this.stride,size:8,optional:b,constructor:c.BufferViewFloat64});
this.stride+=8;this.fieldNames.push(a);return this};b.prototype.u8=function(a,b){this.fields.set(a,{offset:this.stride,size:1,optional:b,constructor:c.BufferViewUint8});this.stride+=1;this.fieldNames.push(a);return this};b.prototype.u16=function(a,b){this.fields.set(a,{offset:this.stride,size:2,optional:b,constructor:c.BufferViewUint16});this.stride+=2;this.fieldNames.push(a);return this};b.prototype.i8=function(a,b){this.fields.set(a,{offset:this.stride,size:1,optional:b,constructor:c.BufferViewInt8});
this.stride+=1;this.fieldNames.push(a);return this};b.prototype.vec2i8=function(a,b){this.fields.set(a,{offset:this.stride,size:2,optional:b,constructor:c.BufferViewVec2i8});this.stride+=2;this.fieldNames.push(a);return this};b.prototype.vec2i16=function(a,b){this.fields.set(a,{offset:this.stride,size:4,optional:b,constructor:c.BufferViewVec2i16});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.vec2u8=function(a,b){this.fields.set(a,{offset:this.stride,size:2,optional:b,constructor:c.BufferViewVec2u8});
this.stride+=2;this.fieldNames.push(a);return this};b.prototype.vec4u16=function(a,b){this.fields.set(a,{offset:this.stride,size:8,optional:b,constructor:c.BufferViewVec4u16});this.stride+=8;this.fieldNames.push(a);return this};b.prototype.u32=function(a,b){this.fields.set(a,{offset:this.stride,size:4,optional:b,constructor:c.BufferViewUint32});this.stride+=4;this.fieldNames.push(a);return this};b.prototype.hasField=function(a){return 0<=this.fieldNames.indexOf(a)};b.prototype.createBuffer=function(b){return new a(this,
b)};b.prototype.createView=function(b){return new a(this,b)};b.prototype.clone=function(){var a=new b;a.stride=this.stride;a.fields=new Map;this.fields.forEach(function(b,h){return a.fields.set(h,b)});a.fieldNames=this.fieldNames.slice();a.BufferType=this.BufferType;return a};return b}();g.InterleavedLayout=f;g.newLayout=function(){return new f}})},"esri/views/3d/support/buffer/BufferView":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./internals/Mat3 ./internals/Mat4 ./internals/Single ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),
function(n,g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});n=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Float32Array,b,e,h)||this;b.elementType="f32";return b}c(b,a);b.ElementType="f32";return b}(b.BufferViewSingle);g.BufferViewFloat=n;n=function(a){function b(b,e,h,c){void 0===e&&(e=0);b=a.call(this,Float32Array,b,e,h,c)||this;b.elementType="f32";return b}c(b,a);b.ElementType="f32";return b}(l.BufferViewVec2Impl);g.BufferViewVec2f=n;n=function(a){function b(b,
e,h,c){void 0===e&&(e=0);b=a.call(this,Float32Array,b,e,h,c)||this;b.elementType="f32";return b}c(b,a);b.ElementType="f32";return b}(e.BufferViewVec3Impl);g.BufferViewVec3f=n;n=function(a){function b(b,e,h,c){void 0===e&&(e=0);b=a.call(this,Float32Array,b,e,h,c)||this;b.elementType="f32";return b}c(b,a);b.ElementType="f32";return b}(h.BufferViewVec4Impl);g.BufferViewVec4f=n;a=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Float32Array,b,e,h)||this;b.elementType="f32";return b}c(b,a);
b.ElementType="f32";return b}(a.BufferViewMat3);g.BufferViewMat3f=a;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Float32Array,b,e,h)||this;b.elementType="f32";return b}c(b,a);b.ElementType="f32";return b}(f.BufferViewMat4);g.BufferViewMat4f=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Float64Array,b,e,h)||this;b.elementType="f64";return b}c(b,a);b.ElementType="f64";return b}(b.BufferViewSingle);g.BufferViewFloat64=f;f=function(a){function b(b,e,h){void 0===
e&&(e=0);b=a.call(this,Float64Array,b,e,h)||this;b.elementType="f64";return b}c(b,a);b.ElementType="f64";return b}(l.BufferViewVec2Impl);g.BufferViewVec2f64=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Float64Array,b,e,h)||this;b.elementType="f64";return b}c(b,a);b.ElementType="f64";return b}(e.BufferViewVec3Impl);g.BufferViewVec3f64=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Float64Array,b,e,h)||this;b.elementType="f64";return b}c(b,a);b.ElementType="f64";
return b}(h.BufferViewVec4Impl);g.BufferViewVec4f64=f;f=function(a){function b(b,e,h,c){void 0===e&&(e=0);b=a.call(this,Uint8Array,b,e,h,c)||this;b.elementType="u8";return b}c(b,a);b.ElementType="u8";return b}(b.BufferViewSingle);g.BufferViewUint8=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Uint8Array,b,e,h)||this;b.elementType="u8";return b}c(b,a);b.ElementType="u8";return b}(l.BufferViewVec2Impl);g.BufferViewVec2u8=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,
Uint8Array,b,e,h)||this;b.elementType="u8";return b}c(b,a);b.ElementType="u8";return b}(e.BufferViewVec3Impl);g.BufferViewVec3u8=f;f=function(a){function b(b,e,h,c){void 0===e&&(e=0);b=a.call(this,Uint8Array,b,e,h,c)||this;b.elementType="u8";return b}c(b,a);b.ElementType="u8";return b}(h.BufferViewVec4Impl);g.BufferViewVec4u8=f;f=function(a){function b(b,e,h,c){void 0===e&&(e=0);b=a.call(this,Uint16Array,b,e,h,c)||this;b.elementType="u16";return b}c(b,a);b.ElementType="u16";return b}(b.BufferViewSingle);
g.BufferViewUint16=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Uint16Array,b,e,h)||this;b.elementType="u16";return b}c(b,a);b.ElementType="u16";return b}(l.BufferViewVec2Impl);g.BufferViewVec2u16=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Uint16Array,b,e,h)||this;b.elementType="u16";return b}c(b,a);b.ElementType="u16";return b}(e.BufferViewVec3Impl);g.BufferViewVec3u16=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Uint16Array,b,e,h)||
this;b.elementType="u16";return b}c(b,a);b.ElementType="u16";return b}(h.BufferViewVec4Impl);g.BufferViewVec4u16=f;f=function(a){function b(b,e,h,c){void 0===e&&(e=0);b=a.call(this,Uint32Array,b,e,h,c)||this;b.elementType="u32";return b}c(b,a);b.ElementType="u32";return b}(b.BufferViewSingle);g.BufferViewUint32=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Uint32Array,b,e,h)||this;b.elementType="u32";return b}c(b,a);b.ElementType="u32";return b}(l.BufferViewVec2Impl);g.BufferViewVec2u32=
f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Uint32Array,b,e,h)||this;b.elementType="u32";return b}c(b,a);b.ElementType="u32";return b}(e.BufferViewVec3Impl);g.BufferViewVec3u32=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Uint32Array,b,e,h)||this;b.elementType="u32";return b}c(b,a);b.ElementType="u32";return b}(h.BufferViewVec4Impl);g.BufferViewVec4u32=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int8Array,b,e,h)||this;b.elementType=
"i8";return b}c(b,a);b.ElementType="i8";return b}(b.BufferViewSingle);g.BufferViewInt8=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int8Array,b,e,h)||this;b.elementType="i8";return b}c(b,a);b.ElementType="i8";return b}(l.BufferViewVec2Impl);g.BufferViewVec2i8=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int8Array,b,e,h)||this;b.elementType="i8";return b}c(b,a);b.ElementType="i8";return b}(e.BufferViewVec3Impl);g.BufferViewVec3i8=f;f=function(a){function b(b,
e,h){void 0===e&&(e=0);b=a.call(this,Int8Array,b,e,h)||this;b.elementType="i8";return b}c(b,a);b.ElementType="i8";return b}(h.BufferViewVec4Impl);g.BufferViewVec4i8=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int16Array,b,e,h)||this;b.elementType="i16";return b}c(b,a);b.ElementType="i16";return b}(b.BufferViewSingle);g.BufferViewInt16=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int16Array,b,e,h)||this;b.elementType="i16";return b}c(b,a);b.ElementType="i16";
return b}(l.BufferViewVec2Impl);g.BufferViewVec2i16=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int16Array,b,e,h)||this;b.elementType="i16";return b}c(b,a);b.ElementType="i16";return b}(e.BufferViewVec3Impl);g.BufferViewVec3i16=f;f=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int16Array,b,e,h)||this;b.elementType="i16";return b}c(b,a);b.ElementType="i16";return b}(h.BufferViewVec4Impl);g.BufferViewVec4i16=f;b=function(a){function b(b,e,h){void 0===e&&(e=0);b=
a.call(this,Int32Array,b,e,h)||this;b.elementType="i32";return b}c(b,a);b.ElementType="i32";return b}(b.BufferViewSingle);g.BufferViewInt32=b;l=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int32Array,b,e,h)||this;b.elementType="i32";return b}c(b,a);b.ElementType="i32";return b}(l.BufferViewVec2Impl);g.BufferViewVec2i32=l;e=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int32Array,b,e,h)||this;b.elementType="i32";return b}c(b,a);b.ElementType="i32";return b}(e.BufferViewVec3Impl);
g.BufferViewVec3i32=e;h=function(a){function b(b,e,h){void 0===e&&(e=0);b=a.call(this,Int32Array,b,e,h)||this;b.elementType="i32";return b}c(b,a);b.ElementType="i32";return b}(h.BufferViewVec4Impl);g.BufferViewVec4i32=h})},"esri/views/3d/support/buffer/internals/Mat3":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a,c,b,l){void 0===b&&(b=0);this.TypedArrayConstructor=a;this.elementCount=9;a=this.TypedArrayConstructor;
void 0===l&&(l=9*a.BYTES_PER_ELEMENT);this.data=new a(c,0===c.byteLength?0:b);this.elementStride=l/a.BYTES_PER_ELEMENT}c.prototype.getMat=function(a,c){a*=this.elementStride;for(var b=0;9>b;b++)c[b]=this.data[a+b];return c};c.prototype.setMat=function(a,c){a*=this.elementStride;for(var b=0;9>b;b++)this.data[a+b]=c[b]};c.prototype.get=function(a,c){return this.data[a*this.elementStride+c]};c.prototype.set=function(a,c,b){this.data[a*this.elementStride+c]=b};Object.defineProperty(c.prototype,"count",
{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});c.ElementCount=
9;return c}();g.BufferViewMat3=n})},"esri/views/3d/support/buffer/internals/Mat4":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a,c,b,l){void 0===b&&(b=0);this.TypedArrayConstructor=a;this.elementCount=16;a=this.TypedArrayConstructor;void 0===l&&(l=16*a.BYTES_PER_ELEMENT);this.data=new a(c,0===c.byteLength?0:b);this.elementStride=l/a.BYTES_PER_ELEMENT}c.prototype.getMat=function(a,c){a*=this.elementStride;for(var b=0;16>
b;b++)c[b]=this.data[a+b];return c};c.prototype.setMat=function(a,c){a*=this.elementStride;for(var b=0;16>b;b++)this.data[a+b]=c[b]};c.prototype.get=function(a,c){return this.data[a*this.elementStride+c]};c.prototype.set=function(a,c,b){this.data[a*this.elementStride+c]=b};Object.defineProperty(c.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"buffer",{get:function(){return this.data.buffer},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});c.ElementCount=16;return c}();g.BufferViewMat4=n})},"esri/views/3d/support/buffer/internals/Single":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});
n=function(){function c(a,c,b,l,e){void 0===b&&(b=0);this.TypedArrayConstructor=a;this.elementCount=1;a=this.TypedArrayConstructor;void 0===l&&(l=a.BYTES_PER_ELEMENT);var h=0===c.byteLength?0:b;this.data=null==e?new a(c,h):new a(c,h,(e-b)/a.BYTES_PER_ELEMENT);this.elementStride=l/a.BYTES_PER_ELEMENT}c.prototype.get=function(a){return this.data[a*this.elementStride]};c.prototype.set=function(a,c){this.data[a*this.elementStride]=c};Object.defineProperty(c.prototype,"count",{get:function(){return Math.ceil(this.data.length/
this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});c.ElementCount=1;return c}();g.BufferViewSingle=n})},"esri/views/3d/support/buffer/internals/Vec2":function(){define(["require",
"exports","../../../lib/gl-matrix"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a,b,c,e,h){void 0===c&&(c=0);this.TypedArrayConstructor=a;this.elementCount=2;a=this.TypedArrayConstructor;void 0===e&&(e=2*a.BYTES_PER_ELEMENT);var f=0===b.byteLength?0:c;this.data=null==h?new a(b,f):new a(b,f,(h-c)/a.BYTES_PER_ELEMENT);this.elementStride=e/a.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,b){return c.vec2d.set2(this.data[a*this.elementStride],this.data[a*
this.elementStride+1],b)};a.prototype.setVec=function(a,b){this.data[a*this.elementStride]=b[0];this.data[a*this.elementStride+1]=b[1]};a.prototype.get=function(a,b){return this.data[a*this.elementStride+b]};a.prototype.set=function(a,b,c){this.data[a*this.elementStride+b]=c};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBufferStride",{get:function(){return this.elementStride},enumerable:!0,configurable:!0});a.ElementCount=2;return a}();g.BufferViewVec2Impl=n})},"esri/views/3d/support/buffer/internals/Vec3":function(){define(["require",
"exports","../../../lib/gl-matrix"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a,b,c,e,h){void 0===c&&(c=0);this.TypedArrayConstructor=a;this.elementCount=3;a=this.TypedArrayConstructor;void 0===e&&(e=3*a.BYTES_PER_ELEMENT);var f=0===b.byteLength?0:c;this.data=null==h?new a(b,f):new a(b,f,(h-c)/a.BYTES_PER_ELEMENT);this.elementStride=e/a.BYTES_PER_ELEMENT}a.prototype.getVec=function(a,b){return c.vec3d.set3(this.data[a*this.elementStride],this.data[a*
this.elementStride+1],this.data[a*this.elementStride+2],b)};a.prototype.setVec=function(a,b){this.data[a*this.elementStride]=b[0];this.data[a*this.elementStride+1]=b[1];this.data[a*this.elementStride+2]=b[2]};a.prototype.get=function(a,b){return this.data[a*this.elementStride+b]};a.prototype.set=function(a,b,c){this.data[a*this.elementStride+b]=c};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBufferStride",{get:function(){return this.elementStride},enumerable:!0,configurable:!0});a.ElementCount=
3;return a}();g.BufferViewVec3Impl=n})},"esri/views/3d/support/buffer/internals/Vec4":function(){define(["require","exports","../../../lib/gl-matrix"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a,b,c,e,h){void 0===c&&(c=0);this.TypedArrayConstructor=a;this.elementCount=4;a=this.TypedArrayConstructor;void 0===e&&(e=4*a.BYTES_PER_ELEMENT);var f=0===b.byteLength?0:c;this.data=null==h?new a(b,f):new a(b,f,(h-c)/a.BYTES_PER_ELEMENT);this.elementStride=e/a.BYTES_PER_ELEMENT}
a.prototype.getVec=function(a,b){return c.vec4d.set4(this.data[a*this.elementStride],this.data[a*this.elementStride+1],this.data[a*this.elementStride+2],this.data[a*this.elementStride+3],b)};a.prototype.setVec=function(a,b){this.data[a*this.elementStride]=b[0];this.data[a*this.elementStride+1]=b[1];this.data[a*this.elementStride+2]=b[2];this.data[a*this.elementStride+3]=b[3]};a.prototype.get=function(a,b){return this.data[a*this.elementStride+b]};a.prototype.set=function(a,b,c){this.data[a*this.elementStride+
b]=c};Object.defineProperty(a.prototype,"count",{get:function(){return Math.ceil(this.data.length/this.elementStride)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this.data.buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBuffer",{get:function(){return this.data},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"stride",{get:function(){return this.elementStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"typedBufferStride",{get:function(){return this.elementStride},enumerable:!0,configurable:!0});a.ElementCount=4;return a}();g.BufferViewVec4Impl=n})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("require exports ../../lib/gl-matrix ../../support/geometryUtils ./BufferVectorMath ./GeometryData ./Util".split(" "),function(n,g,c,a,f,b,l){function e(a,b,e,d,h){if(Math.abs(c.vec3.dot(b,a))>h)return!1;c.vec3.cross(a,b,
e);c.vec3.normalize(e);c.vec3.cross(e,a,d);c.vec3.normalize(d);return!0}var h=f.Vec3Compact,m;(function(a){for(var e=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],d=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],h=[0,0,1,0,1,1,0,1],c=[0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5],f=Array(36),k=0;6>k;k++)for(var m=0;6>m;m++)f[6*k+m]=k;for(var p=Array(36),k=0;6>k;k++)p[6*k+0]=0,p[6*k+1]=1,p[6*k+2]=2,p[6*k+3]=2,p[6*k+4]=3,p[6*
k+5]=0;a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var k=new Float32Array(24),m=0;8>m;m++)k[3*m]=e[m][0]*a[0],k[3*m+1]=e[m][1]*a[1],k[3*m+2]=e[m][2]*a[2];a={};a[l.VertexAttrConstants.POSITION]=new Uint32Array(c);a[l.VertexAttrConstants.NORMAL]=new Uint32Array(f);a[l.VertexAttrConstants.UV0]=new Uint32Array(p);m={};m[l.VertexAttrConstants.POSITION]={size:3,data:k};m[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};m[l.VertexAttrConstants.UV0]={size:2,data:new Float32Array(h)};
return new b(m,a)}})(m||(m={}));var k;(function(a){var e=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,0,.5],[0,-.5,0],[0,.5,0]],d=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],h=[5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0],c=[0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var f=new Float32Array(18),k=0;6>k;k++)f[3*k]=e[k][0]*a[0],f[3*k+1]=e[k][1]*a[1],f[3*k+2]=e[k][2]*a[2];a={};a[l.VertexAttrConstants.POSITION]=new Uint32Array(h);
a[l.VertexAttrConstants.NORMAL]=new Uint32Array(c);k={};k[l.VertexAttrConstants.POSITION]={size:3,data:f};k[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(d)};return new b(k,a)}})(k||(k={}));var d;(function(a){var e=c.vec3.createFrom(-.5,0,-.5),d=c.vec3.createFrom(.5,0,-.5),h=c.vec3.createFrom(0,0,.5),f=c.vec3.createFrom(0,.5,0),k=c.vec3.create(),m=c.vec3.create(),p=c.vec3.create(),q=c.vec3.create(),t=c.vec3.create();c.vec3.subtract(e,f,k);c.vec3.subtract(e,d,m);c.vec3.cross(k,m,p);c.vec3.normalize(p,
p);c.vec3.subtract(d,f,k);c.vec3.subtract(d,h,m);c.vec3.cross(k,m,q);c.vec3.normalize(q,q);c.vec3.subtract(h,f,k);c.vec3.subtract(h,e,m);c.vec3.cross(k,m,t);c.vec3.normalize(t,t);var r=[e,d,h,f],u=[0,-1,0,p[0],p[1],p[2],q[0],q[1],q[2],t[0],t[1],t[2]],g=[0,1,2,3,1,0,3,2,1,3,0,2],N=[0,0,0,1,1,1,2,2,2,3,3,3];a.createGeometry=function(a){Array.isArray(a)||(a=[a,a,a]);for(var e=new Float32Array(12),d=0;4>d;d++)e[3*d]=r[d][0]*a[0],e[3*d+1]=r[d][1]*a[1],e[3*d+2]=r[d][2]*a[2];a={};a[l.VertexAttrConstants.POSITION]=
new Uint32Array(g);a[l.VertexAttrConstants.NORMAL]=new Uint32Array(N);d={};d[l.VertexAttrConstants.POSITION]={size:3,data:e};d[l.VertexAttrConstants.NORMAL]={size:3,data:new Float32Array(u)};return new b(d,a)}})(d||(d={}));var q;(function(q){q.createBoxGeometry=m.createGeometry;q.createDiamondGeometry=k.createGeometry;q.createTetrahedronGeometry=d.createGeometry;q.createSphereGeometry=function(a,e,d,h,c,f,k){a=a||50;h=void 0!==h?h:-Math.PI;c=void 0!==c?c:2*Math.PI;f=void 0!==f?f:.5*-Math.PI;k=void 0!==
k?k:Math.PI;var m=Math.max(3,Math.floor(e)||8),p=Math.max(2,Math.floor(d)||6),q=(m+1)*(p+1);d=new Float32Array(3*q);e=new Float32Array(3*q);for(var q=new Float32Array(2*q),t=[],r=0,u=0;u<=p;u++){for(var x=[],v=u/p,z=f+v*k,B=Math.cos(z),g=0;g<=m;g++){var A=g/m,D=h+A*c,C=Math.cos(D)*B,n=Math.sin(z),D=-Math.sin(D)*B;d[3*r]=C*a;d[3*r+1]=n*a;d[3*r+2]=D*a;e[3*r]=C;e[3*r+1]=n;e[3*r+2]=D;q[2*r]=A;q[2*r+1]=v;x.push(r);++r}t.push(x)}a=new Uint32Array(2*m*(p-1)*3);for(u=r=0;u<p;u++)for(g=0;g<m;g++)h=t[u][g],
c=t[u][g+1],f=t[u+1][g+1],k=t[u+1][g],0===u?(a[r++]=h,a[r++]=f,a[r++]=k):u===p-1?(a[r++]=h,a[r++]=c,a[r++]=f):(a[r++]=h,a[r++]=c,a[r++]=f,a[r++]=f,a[r++]=k,a[r++]=h);l.assert(r===a.length);m={};m[l.VertexAttrConstants.POSITION]=a;m[l.VertexAttrConstants.NORMAL]=a;m[l.VertexAttrConstants.UV0]=a;p={};p[l.VertexAttrConstants.POSITION]={size:3,data:d};p[l.VertexAttrConstants.NORMAL]={size:3,data:e};p[l.VertexAttrConstants.UV0]={size:2,data:q};return new b(p,m)};q.createPolySphereGeometry=function(a,e,
d){function c(b,d){b>d&&(d=[d,b],b=d[0],d=d[1]);var e=b.toString()+"."+d.toString();if(m[e])return m[e];var c=f.length;f.length+=3;h.add(f,3*b,f,3*d,f,c);h.scale(f,c,a/h.length(f,c));c/=3;return m[e]=c}var f;d?(f=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],d=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(d=a*(1+Math.sqrt(5))/2,f=[-a,d,0,a,d,0,-a,-d,0,a,-d,0,0,-a,d,0,a,d,0,-a,-d,0,a,-d,d,0,-a,d,0,a,-d,0,-a,-d,0,a],d=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,
11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var k=0;k<f.length;k+=3)h.scale(f,k,a/h.length(f,k));for(var m={},k=0;k<e;k++){for(var p=d.length,q=new Uint32Array(4*p),r=0;r<p;r+=3){var t=d[r],u=d[r+1],v=d[r+2],z=c(t,u),g=c(u,v),A=c(v,t),n=4*r;q[n]=t;q[n+1]=z;q[n+2]=A;q[n+3]=u;q[n+4]=g;q[n+5]=z;q[n+6]=v;q[n+7]=A;q[n+8]=g;q[n+9]=z;q[n+10]=g;q[n+11]=A}d=q;m={}}e=new Float32Array(f);for(k=0;k<e.length;k+=3)h.normalize(e,k);k={};k[l.VertexAttrConstants.POSITION]=
d;k[l.VertexAttrConstants.NORMAL]=d;d={};d[l.VertexAttrConstants.POSITION]={size:3,data:new Float32Array(f)};d[l.VertexAttrConstants.NORMAL]={size:3,data:e};return new b(d,k)};q.createPointGeometry=function(a,d,e,h,c,f,k){d=d?new Float32Array([d[0],d[1],d[2]]):new Float32Array([0,0,0]);a=a?new Float32Array([a[0],a[1],a[2]]):new Float32Array([0,0,1]);f=f?new Float32Array(f):new Float32Array([0,0]);var m=e?new Uint8Array([255*e[0],255*e[1],255*e[2],3<e.length?255*e[3]:255]):new Uint8Array([255,255,
255,255]),p=null!=h&&2===h.length?new Float32Array(h):new Float32Array([1,1]);h=new Uint32Array([0]);e={};e[l.VertexAttrConstants.POSITION]=h;e[l.VertexAttrConstants.NORMAL]=h;e[l.VertexAttrConstants.UV0]=h;e[l.VertexAttrConstants.COLOR]=h;e[l.VertexAttrConstants.SIZE]=h;var q={};q[l.VertexAttrConstants.POSITION]={size:3,data:d};q[l.VertexAttrConstants.NORMAL]={size:3,data:a};q[l.VertexAttrConstants.UV0]={size:f.length,data:f};q[l.VertexAttrConstants.COLOR]={size:4,data:m};q[l.VertexAttrConstants.SIZE]=
{size:2,data:p};null!=c&&(c=new Float32Array([c[0],c[1],c[2],c[3]]),e[l.VertexAttrConstants.AUXPOS1]=h,q[l.VertexAttrConstants.AUXPOS1]={size:4,data:c});null!=k&&(k=new Float32Array([k[0],k[1],k[2],k[3]]),e[l.VertexAttrConstants.AUXPOS2]=h,q[l.VertexAttrConstants.AUXPOS2]={size:4,data:k});return new b(q,e,b.DefaultOffsets,"point")};q.createPointArrayGeometry=function(a,d){for(var e=new Float32Array(3*a.length),h=new Float32Array(d?3*a.length:3),c=new Uint32Array(a.length),f=new Uint32Array(a.length),
k=0;k<a.length;k++)e[3*k]=a[k][0],e[3*k+1]=a[k][1],e[3*k+2]=a[k][2],d&&(h[3*k]=d[k][0],h[3*k+1]=d[k][1],h[3*k+2]=d[k][2]),c[k]=k,f[k]=0;d||(h[0]=0,h[1]=1,h[2]=0);a=new Float32Array(2);a[0]=0;a[1]=0;k={};k[l.VertexAttrConstants.POSITION]=c;k[l.VertexAttrConstants.NORMAL]=d?c:f;k[l.VertexAttrConstants.UV0]=f;d={};d[l.VertexAttrConstants.POSITION]={size:3,data:e};d[l.VertexAttrConstants.NORMAL]={size:3,data:h};d[l.VertexAttrConstants.UV0]={size:2,data:a};return new b(d,k,b.DefaultOffsets,"point")};q.createTriangleGeometry=
function(){var a=new Float32Array([0,0,0,0,0,100,100,0,0]),d=new Uint32Array([0,1,2]),e=new Float32Array([0,1,0]),h=new Uint32Array([0,0,0]),c=new Float32Array([0,0]),f=new Uint32Array([0,0,0]),k={};k[l.VertexAttrConstants.POSITION]=d;k[l.VertexAttrConstants.NORMAL]=h;k[l.VertexAttrConstants.UV0]=f;d={};d[l.VertexAttrConstants.POSITION]={size:3,data:a};d[l.VertexAttrConstants.NORMAL]={size:3,data:e};d[l.VertexAttrConstants.UV0]={size:2,data:c};return new b(d,k)};q.createSquareGeometry=function(a){var d=
new Float32Array(12);if(a)for(var e=0;4>e;e++)for(var h=0;3>h;h++)d[3*e+h]=a[e][h];else d[0]=-1,d[1]=-1,d[2]=0,d[3]=1,d[4]=-1,d[5]=0,d[6]=1,d[7]=1,d[8]=0,d[9]=-1,d[10]=1,d[11]=0;var c=new Uint32Array([0,1,2,2,3,0]);a=new Float32Array([0,0,1]);var f=new Uint32Array([0,0,0,0,0,0]),e=new Float32Array([0,0,1,0,1,1,0,1]),h=new Uint8Array([255,255,255,255]),k={};k[l.VertexAttrConstants.POSITION]=c;k[l.VertexAttrConstants.NORMAL]=f;k[l.VertexAttrConstants.UV0]=c;k[l.VertexAttrConstants.COLOR]=f;c={};c[l.VertexAttrConstants.POSITION]=
{size:3,data:d};c[l.VertexAttrConstants.NORMAL]={size:3,data:a};c[l.VertexAttrConstants.UV0]={size:2,data:e};c[l.VertexAttrConstants.COLOR]={size:4,data:h};return new b(c,k)};q.createConeGeometry=function(a,d,e,h){var f=0,k=c.vec3.createFrom(0,f,0),m=c.vec3.createFrom(0,f+a,0),p=c.vec3.createFrom(0,-1,0),q=c.vec3.createFrom(0,1,0);h&&(f=a,m=c.vec3.createFrom(0,0,0),k=c.vec3.createFrom(0,f,0),p=c.vec3.createFrom(0,1,0),q=c.vec3.createFrom(0,-1,0));k=[m,k];p=[p,q];q=e+2;m=Math.sqrt(a*a+d*d);if(h)for(h=
e-1;0<=h;h--)r=2*Math.PI/e*h,t=c.vec3.createFrom(Math.cos(r)*d,f,Math.sin(r)*d),k.push(t),r=c.vec3.createFrom(a*Math.cos(r)/m,-d/m,a*Math.sin(r)/m),p.push(r);else for(h=0;h<e;h++){var r=2*Math.PI/e*h,t=c.vec3.createFrom(Math.cos(r)*d,f,Math.sin(r)*d);k.push(t);r=c.vec3.createFrom(a*Math.cos(r)/m,d/m,a*Math.sin(r)/m);p.push(r)}a=new Uint32Array(6*(e+2));e=new Uint32Array(6*(e+2));f=d=0;for(h=3;h<k.length;h++)a[d++]=1,a[d++]=h-1,a[d++]=h,e[f++]=0,e[f++]=0,e[f++]=0;a[d++]=k.length-1;a[d++]=2;a[d++]=
1;e[f++]=0;e[f++]=0;e[f++]=0;for(h=3;h<k.length;h++)a[d++]=h,a[d++]=h-1,a[d++]=0,e[f++]=h,e[f++]=h-1,e[f++]=1;a[d++]=0;a[d++]=2;a[d++]=k.length-1;e[f++]=1;e[f++]=2;e[f++]=p.length-1;d=new Float32Array(3*q);for(h=0;h<q;h++)d[3*h]=k[h][0],d[3*h+1]=k[h][1],d[3*h+2]=k[h][2];k=new Float32Array(3*q);for(h=0;h<q;h++)k[3*h]=p[h][0],k[3*h+1]=p[h][1],k[3*h+2]=p[h][2];p={};p[l.VertexAttrConstants.POSITION]=a;p[l.VertexAttrConstants.NORMAL]=e;q={};q[l.VertexAttrConstants.POSITION]={size:3,data:d};q[l.VertexAttrConstants.NORMAL]=
{size:3,data:k};return new b(q,p)};q.createCylinderGeometry=function(a,d,e,h,f,k){h=h?c.vec3.create(h):c.vec3.createFrom(1,0,0);f=f?c.vec3.create(f):c.vec3.createFrom(0,0,0);k=void 0===k?!0:k;var m=c.vec3.create();c.vec3.normalize(h,m);h=c.vec3.create();c.vec3.scale(m,Math.abs(a),h);var p=c.vec3.create();c.vec3.scale(h,-.5,p);c.vec3.add(p,f);var q=c.vec3.createFrom(0,1,0);.2>Math.abs(1-c.vec3.dot(m,q))&&c.vec3.set3(0,0,1,q);var r=c.vec3.create();c.vec3.cross(m,q,r);c.vec3.normalize(r);c.vec3.cross(r,
m,q);var t=2*e+(k?2:0),u=e+(k?2:0);a=new Float32Array(3*t);f=new Float32Array(3*u);var x=new Float32Array(2*t),v=new Uint32Array(3*e*(k?4:2)),g=new Uint32Array(3*e*(k?4:2));k&&(a[3*(t-2)+0]=p[0],a[3*(t-2)+1]=p[1],a[3*(t-2)+2]=p[2],x[2*(t-2)]=0,x[2*(t-2)+1]=0,a[3*(t-1)+0]=a[3*(t-2)+0]+h[0],a[3*(t-1)+1]=a[3*(t-2)+1]+h[1],a[3*(t-1)+2]=a[3*(t-2)+2]+h[2],x[2*(t-1)]=1,x[2*(t-1)+1]=1,f[3*(u-2)+0]=-m[0],f[3*(u-2)+1]=-m[1],f[3*(u-2)+2]=-m[2],f[3*(u-1)+0]=m[0],f[3*(u-1)+1]=m[1],f[3*(u-1)+2]=m[2]);for(var m=
function(a,b,d){v[a]=b;g[a]=d},z=0,B=c.vec3.create(),A=c.vec3.create(),D=0;D<e;D++){var n=2*Math.PI/e*D;c.vec3.scale(q,Math.sin(n),B);c.vec3.scale(r,Math.cos(n),A);c.vec3.add(B,A);f[3*D+0]=B[0];f[3*D+1]=B[1];f[3*D+2]=B[2];c.vec3.scale(B,d);c.vec3.add(B,p);a[3*D+0]=B[0];a[3*D+1]=B[1];a[3*D+2]=B[2];x[2*D+0]=D/e;x[2*D+1]=0;a[3*(D+e)+0]=a[3*D+0]+h[0];a[3*(D+e)+1]=a[3*D+1]+h[1];a[3*(D+e)+2]=a[3*D+2]+h[2];x[2*(D+e)+0]=D/e;x[2*D+1]=1;n=(D+1)%e;m(z++,D,D);m(z++,D+e,D);m(z++,n,n);m(z++,n,n);m(z++,D+e,D);m(z++,
n+e,n)}if(k){for(D=0;D<e;D++)n=(D+1)%e,m(z++,t-2,u-2),m(z++,D,u-2),m(z++,n,u-2);for(D=0;D<e;D++)n=(D+1)%e,m(z++,D+e,u-1),m(z++,t-1,u-1),m(z++,n+e,u-1)}d={};d[l.VertexAttrConstants.POSITION]=v;d[l.VertexAttrConstants.NORMAL]=g;d[l.VertexAttrConstants.UV0]=v;e={};e[l.VertexAttrConstants.POSITION]={size:3,data:a};e[l.VertexAttrConstants.NORMAL]={size:3,data:f};e[l.VertexAttrConstants.UV0]={size:2,data:x};return new b(e,d)};q.createTubeGeometry=function(a,b,d,e,h){d=d||10;e=null!=e?e:!0;l.assert(1<a.length);
for(var c=[],f=[],k=0;k<d;k++){c.push([0,-k-1,-((k+1)%d)-1]);var m=k/d*2*Math.PI;f.push([Math.cos(m)*b,Math.sin(m)*b])}return q.createPathExtrusionGeometry(f,a,[[0,0,0]],c,e,h)};q.createPathExtrusionGeometry=function(d,h,f,k,m,q){var r=d.length,t=new Float32Array(h.length*r*3+(6*f.length||0)),u=new Float32Array(h.length*r+(2*f.length||0)),x=new Float32Array(h.length*r*3+(f?6:0)),v=(h.length-1)*r*6+6*k.length,g=new Uint32Array(v),v=new Uint32Array(v),B=0,z=0,A=0,D=0,n=0,U=c.vec3.create(),J=c.vec3.create(),
O=c.vec3.create(),P=c.vec3.create(),R=c.vec3.create(),Q=c.vec3.create(),L=c.vec3.create(),S=c.vec3.create(),aa=c.vec3.create(),ea=c.vec3.create(),Z=c.vec3.create(),da=c.vec3.create(),W=c.vec3.create(),ja=a.plane.create();c.vec3.set3(0,1,0,aa);c.vec3.subtract(h[1],h[0],J);c.vec3.normalize(J);m?(c.vec3.add(h[0],q,S),c.vec3.normalize(S,O)):c.vec3.set3(0,0,1,O);var ca=p;e(J,O,R,O,ca)||e(J,aa,R,O,ca)||e(J,aa,R,O,ca);c.vec3.set(O,P);c.vec3.set(R,da);for(var ba=0;ba<f.length;ba++)c.vec3.scale(R,f[ba][0],
Q),c.vec3.scale(O,f[ba][2],S),c.vec3.add(Q,S),c.vec3.add(Q,h[0]),t[B++]=Q[0],t[B++]=Q[1],t[B++]=Q[2],u[A++]=0;x[z++]=-J[0];x[z++]=-J[1];x[z++]=-J[2];for(ba=0;ba<k.length;ba++)g[D++]=0<k[ba][0]?k[ba][0]:-k[ba][0]-1+f.length,g[D++]=0<k[ba][1]?k[ba][1]:-k[ba][1]-1+f.length,g[D++]=0<k[ba][2]?k[ba][2]:-k[ba][2]-1+f.length,v[n++]=0,v[n++]=0,v[n++]=0;for(var ca=f.length,ba=f.length-1,ha=0;ha<h.length;ha++){var fa=!1;if(0<ha){c.vec3.set(J,U);ha<h.length-1?(c.vec3.subtract(h[ha+1],h[ha],J),c.vec3.normalize(J)):
fa=!0;c.vec3.add(U,J,ea);c.vec3.normalize(ea);c.vec3.add(h[ha-1],P,Z);a.plane.fromPositionAndNormal(h[ha],ea,ja);if(a.plane.intersectRay(ja,Z,U,S))c.vec3.subtract(S,h[ha]),c.vec3.normalize(S,O),c.vec3.cross(ea,O,R),c.vec3.normalize(R);else{var ia=ea,X=da,ma=aa,oa=R,ka=O,w=p;e(ia,P,oa,ka,w)||e(ia,X,oa,ka,w)||e(ia,ma,oa,ka,w)}c.vec3.set(O,P);c.vec3.set(R,da)}m&&(c.vec3.add(h[ha],q,S),c.vec3.normalize(S,W));for(ia=0;ia<r;ia++)if(c.vec3.scale(R,d[ia][0],Q),c.vec3.scale(O,d[ia][1],S),c.vec3.add(Q,S),c.vec3.normalize(Q,
L),x[z++]=L[0],x[z++]=L[1],x[z++]=L[2],m?u[A++]=c.vec3.dot(Q,W):u[A++]=Q[2],c.vec3.add(Q,h[ha]),t[B++]=Q[0],t[B++]=Q[1],t[B++]=Q[2],!fa)for(X=(ia+1)%r,g[D++]=ca+ia,g[D++]=ca+r+ia,g[D++]=ca+X,g[D++]=ca+X,g[D++]=ca+r+ia,g[D++]=ca+r+X,X=0;6>X;X++)v[n++]=g[D-6+X]-ba;ca+=r}d=h[h.length-1];for(ba=0;ba<f.length;ba++)c.vec3.scale(R,f[ba][0],Q),c.vec3.scale(O,f[ba][1],S),c.vec3.add(Q,S),c.vec3.add(Q,d),t[B++]=Q[0],t[B++]=Q[1],t[B++]=Q[2],u[A++]=0;f=z/3;x[z++]=J[0];x[z++]=J[1];x[z++]=J[2];r=ca-r;for(ba=0;ba<
k.length;ba++)g[D++]=0<=k[ba][0]?ca+k[ba][0]:-k[ba][0]-1+r,g[D++]=0<=k[ba][2]?ca+k[ba][2]:-k[ba][2]-1+r,g[D++]=0<=k[ba][1]?ca+k[ba][1]:-k[ba][1]-1+r,v[n++]=f,v[n++]=f,v[n++]=f;k={};k[l.VertexAttrConstants.POSITION]=g;k[l.VertexAttrConstants.NORMAL]=v;g={};g[l.VertexAttrConstants.POSITION]={size:3,data:t};g.zOffset={size:1,data:u};g[l.VertexAttrConstants.NORMAL]={size:3,data:x};return new b(g,k)};q.createPolylineGeometry=function(a,d){l.assert(1<a.length,"createPolylineGeometry(): polyline needs at least 2 points");
l.assert(3===a[0].length,"createPolylineGeometry(): malformed vertex");l.assert(void 0===d||d.length===a.length,"createPolylineGeometry: need same number of points and normals");l.assert(void 0===d||3===d[0].length,"createPolylineGeometry(): malformed normal");for(var e=new Float32Array(3*a.length),h=new Uint32Array(2*(a.length-1)),c=0,f=0,k=0;k<a.length;k++){for(var m=0;3>m;m++)e[c++]=a[k][m];0<k&&(h[f++]=k-1,h[f++]=k)}c={};f={};c[l.VertexAttrConstants.POSITION]=h;f[l.VertexAttrConstants.POSITION]=
{size:3,data:e};if(d){for(var e=new Float32Array(3*d.length),p=0,k=0;k<a.length;k++)for(m=0;3>m;m++)e[p++]=d[k][m];c[l.VertexAttrConstants.NORMAL]=h;f[l.VertexAttrConstants.NORMAL]={size:3,data:e}}return new b(f,c,b.DefaultOffsets,"line")};q.addVertexColors=function(a,d){var e=d||[1,1,1,1];d=new Uint8Array(4);d[0]=255*e[0];d[1]=255*e[1];d[2]=255*e[2];d[3]=255*(3<e.length?e[3]:1);var e={},h=a.getVertexAttr(),c;for(c in h)e[c]=h[c];e[l.VertexAttrConstants.COLOR]={size:4,data:d};d={};for(c in a.indices)d[c]=
a.indices[c];d[l.VertexAttrConstants.COLOR]=new Uint32Array(d[l.VertexAttrConstants.POSITION].length);return a=new b(e,d,a.componentOffsets,a.primitiveType)};q.addNormals=function(a){var b=a.getVertexAttr();a=a.indices;for(var d=f.Vec3Compact.subtract,e=new Float32Array(a.position.length/3*3),h=b.position.data,k=0,m=a.position,p=new Uint32Array(m.length),q=0;q<m.length;q+=3){d(h,3*m[q],h,3*m[q+2],u,0);d(h,3*m[q],h,3*m[q+1],r,0);c.vec3d.cross(r,u);c.vec3d.normalize(r);var t=k/3;e[k++]=r[0];e[k++]=
r[1];e[k++]=r[2];p[q]=t;p[q+1]=t;p[q+2]=t}b[l.VertexAttrConstants.NORMAL]={size:3,data:e,offsetIdx:0,strideIdx:3};a[l.VertexAttrConstants.NORMAL]=p};q.cgToGIS=function(a,b){void 0===b&&(b=a);var d=a.getVertexAttr();a=d.position.data;var d=d.normal.data,e=b.getVertexAttr(),h=e.position.data,e=e.normal.data;if(d)for(var c=0;c<d.length;c+=3){var f=d[c+1];e[c+1]=-d[c+2];e[c+2]=f}if(a)for(c=0;c<a.length;c+=3)f=a[c+1],h[c+1]=-a[c+2],h[c+2]=f;return b}})(q||(q={}));var p=.99619469809,r=c.vec3.create(),u=
c.vec3.create();return q})},"esri/views/3d/support/geometryUtils":function(){define(["require","exports","./geometryUtils/lineSegment","./geometryUtils/plane","./geometryUtils/triangle"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});g.plane=a;g.triangle=f;g.lineSegment=c})},"esri/views/3d/support/geometryUtils/lineSegment":function(){define(["require","exports","../../lib/gl-matrix","../mathUtils"],function(n,g,c,a){function f(a,b){void 0===a&&(a=c.vec3d.create());void 0===
b&&(b=c.vec3d.create());return{origin:a,vector:b}}Object.defineProperty(g,"__esModule",{value:!0});g.create=f;g.fromOriginAndVector=function(a,b,h){void 0===h&&(h=f());c.vec3d.set(a,h.origin);c.vec3d.set(b,h.vector);return h};g.distance2=function(f,e){e=c.vec3d.subtract(e,f.origin);var h=c.vec3d.dot(f.vector,e),l=c.vec3d.dot(f.vector,f.vector),h=a.clamp(h/l,0,1);f=c.vec3d.subtract(c.vec3d.scale(f.vector,h,b),e,b);return c.vec3d.dot(f,f)};var b=c.vec3d.create()})},"esri/views/3d/support/geometryUtils/plane":function(){define(["require",
"exports","../../lib/gl-matrix"],function(n,g,c){function a(a){void 0===a&&(a=g.UP);return[a[0],a[1],a[2],a[3]]}function f(b,e,d){void 0===d&&(d=a());c.vec3d.set(e,d);d[3]=-c.vec3d.dot(e,b);return d}function b(b,e,d,l){void 0===l&&(l=a());c.vec3d.cross(e,b,h);return f(d,c.vec3d.normalize(h),l)}Object.defineProperty(g,"__esModule",{value:!0});g.create=a;g.fromValues=function(b,e,d,h,c){void 0===c&&(c=a());c[0]=b;c[1]=e;c[2]=d;c[3]=h;return c};g.fromNormalAndOffset=function(b,e,d){void 0===d&&(d=a());
c.vec3d.set(b,d);d[3]=e;return d};g.fromPositionAndNormal=f;g.projectVector=function(a,b,d){void 0===d&&(d=b);return c.vec3d.cross(a,c.vec3d.cross(b,a,e),d)};g.distance=function(a,b){return c.vec3d.dot(a,b)+a[3]};g.fromPoints=function(h,f,d,q){void 0===q&&(q=a());return b(c.vec3d.subtract(h,f,l),c.vec3d.subtract(d,f,e),h,q)};g.set=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};g.negate=function(a,b){void 0===b&&(b=a);b[0]=-a[0];b[1]=-a[1];b[2]=-a[2];b[3]=-a[3];return b};g.fromVectorsAndPoint=
b;g.intersectRay=function(a,b,d,e){var h=c.vec3d.dot(a,d);if(0===h)return!1;a=-(c.vec3d.dot(a,b)+a[3])/h;if(0>a)return!1;c.vec3d.add(b,c.vec3d.scale(d,a,e),e);return!0};g.UP=[0,0,1,0];var l=c.vec3d.create(),e=c.vec3d.create(),h=c.vec3d.create()})},"esri/views/3d/support/geometryUtils/triangle":function(){define(["require","exports","../../lib/gl-matrix","./lineSegment"],function(n,g,c,a){function f(a,b,d){var e=c.vec2d.dist(a,b);b=c.vec2d.dist(b,d);a=c.vec2d.dist(d,a);d=(e+b+a)/2;return Math.sqrt(d*
(d-e)*(d-b)*(d-a))}Object.defineProperty(g,"__esModule",{value:!0});g.create=function(a,b,d){void 0===a&&(a=c.vec3d.create());void 0===b&&(b=c.vec3d.create());void 0===d&&(d=c.vec3d.create());return{p0:a,p1:b,p2:d}};g.distance2=function(f,r){var p=f.p0,t=f.p1;f=f.p2;var g=c.vec3d.subtract(t,p,b),A=c.vec3d.subtract(f,t,l),z=c.vec3d.subtract(p,f,e),x=c.vec3d.subtract(r,p,h),B=c.vec3d.subtract(r,t,m),D=c.vec3d.subtract(r,f,k),C=c.vec3d.cross(g,z),G=c.vec3d.dot(c.vec3d.cross(g,C,d),x),B=c.vec3d.dot(c.vec3d.cross(A,
C,d),B),D=c.vec3d.dot(c.vec3d.cross(z,C,d),D);if(0<G&&0<B&&0<D)return r=c.vec3d.dot(C,x),r*r/c.vec3d.dot(C,C);p=a.distance2(a.fromOriginAndVector(p,g,q),r);t=a.distance2(a.fromOriginAndVector(t,A,q),r);r=a.distance2(a.fromOriginAndVector(f,z,q),r);return Math.min(p,t,r)};g.areaPoints2d=f;g.area2d=function(a){return f(a.p0,a.p1,a.p2)};var b=c.vec3d.create(),l=c.vec3d.create(),e=c.vec3d.create(),h=c.vec3d.create(),m=c.vec3d.create(),k=c.vec3d.create(),d=c.vec3d.create(),q=a.create()})},"esri/views/3d/webgl-engine/lib/GeometryData":function(){define(["require",
"exports","./ComponentUtils","./geometryDataUtils","./Util"],function(n,g,c,a,f){return function(){function b(l,e,h,m){void 0===e&&(e=b.DefaultIndices);void 0===h&&(h=b.DefaultOffsets);void 0===m&&(m="triangle");this.preinterleaved=!1;var k={},d;for(d in l){var q=l[d],p=q.size;k[d]={data:q.data,size:p,offsetIdx:0,strideIdx:p}}if(e===b.DefaultIndices){e=f.getFirstObjectValue(k);l=a.generateDefaultIndexArray(e.data.length/e.size);e={};for(var r in k)e[r]=l}this._id=a.getNewId();this._vertexAttributes=
k;this._indices=e;this._componentOffsets=c.createOffsets(h);this._primitiveType=m}Object.defineProperty(b.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"vertexAttributes",{get:function(){return this._vertexAttributes},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indices",{get:function(){return this._indices},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"componentOffsets",{get:function(){return this._componentOffsets},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"indexCount",{get:function(){return f.getFirstObjectValue(this._indices).length},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"primitiveType",{get:function(){return this._primitiveType},enumerable:!0,configurable:!0});b.prototype.getVertexAttr=function(){return this.vertexAttributes};b.prototype.toRenderData=function(){return{id:this._id.toString(),preinterleaved:!1,indices:this._indices,vertexAttr:this._vertexAttributes}};
b.prototype.getIndices=function(a){return this._indices[a]};b.prototype.getAttribute=function(a){return this._vertexAttributes[a]};b.prototype.estimateGpuMemoryUsage=function(){var a=0;this._indices.position&&(a+=12*this._indices.position.length);this._indices.normal&&(a+=12*this._indices.normal.length);this._indices.uv0&&(a+=8*this._indices.uv0.length);this._indices.color&&(a+=4*this._indices.color.length);return a};b.DefaultIndices={};b.DefaultOffsets=new Uint32Array(0);return b}()})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["require",
"exports","../../../../core/arrayUtils"],function(n,g,c){function a(a,b){if(null!=a){var d=a.isVisibleBit,e=a.data,h=8*e.BYTES_PER_ELEMENT;return b<e.length*h?q(d,e,b,h):!a.isVisibleBit}return!0}function f(a){return null===a.component?-1:a.component}function b(b,d,e,h,c){a(d,h)&&l(b,d,e,e[h],e[h+1]-1,c)}function l(a,b,d,e,h,c){d=(b=0<a.length?a[a.length-1]:null)?b.range[1]:-1;var f=b?b.options:null;d>=e||(d+1===e&&f===c?b.range[1]=h:a.push({range:[e,h],options:c}))}function e(a){void 0===a&&(a=!0);
return{isVisibleBit:!a,data:new Uint32Array(0)}}function h(a,b){return k(a,b,!0)}function m(a,b){return k(a,b,!1)}function k(a,b,d){var e=!1;a=a||r;e=a.isVisibleBit;a=a.data;b=p(b);var h=8*a.BYTES_PER_ELEMENT,c=a.length*h;d=d===e;if(0===a.length||0===b)e=!d;else if(c<b&&!d)e=!0;else{for(var f=u[h],c=u[0],k=0;k<a.length-1;k++)if(e=!d&&a[k]!==f||d&&a[k]!==c)return e;e=a.length-1;b=u[(b-1)%h+1];e=!d&&(a[e]&b)!==b||d&&(a[e]&b)!==c}return e}function d(a){return 0<a.length}function q(a,b,d,e){var h=d/e|
0;return 0!==(b[h]&1<<d-h*e)===a}function p(a){return Math.max(0,a.length-1)}Object.defineProperty(g,"__esModule",{value:!0});g.updateVisibility=function(a,b,d,h){if(d<p(b)){null==a&&(a=e());var c=a.isVisibleBit,f=a.data,k=8*f.BYTES_PER_ELEMENT,l=d/k|0,m=d-k*l;b=(p(b)-1)/k|0;var q=f;h=h===c;d<q.length*k||!h||(d=Math.max(l+1,Math.ceil(1.5*q.length)),d=Math.min(d,b+1),f=new Uint32Array(d),f.set(q));l<f.length&&(f[l]=f[l]&~(1<<m)|(h?1:0)<<m);a.data=f}return a};g.getVisibility=a;g.hideAllComponents=function(a){if(null==
a)a=e(!1);else{a.isVisibleBit=!0;for(var b=0;b<a.data.length;b++)a.data[b]=0}return a};g.unhideAllComponents=function(a){var b;if(null!=a)for(b=a,b.isVisibleBit=!1,a=0;a<b.data.length;a++)b.data[a]=0;return b};g.generateVisibleIndexRanges=function(a,b){var e;if(a)if(d(b))if(0===a.data.length)e=[],b=[[b[0],b[b.length-1]-1]],e=a.isVisibleBit?e:b;else{e=[];for(var h=a.isVisibleBit,c=a.data,f=8*c.BYTES_PER_ELEMENT,k=c.length*f,l=p(b),m=!1,r=0;r<k&&r<l;r++){var t=q(h,c,r,f);if(t!==m){var u=b[r];t?e.push([u,
0]):(m=e[e.length-1],m[1]=u-1);m=t}}a=!a.isVisibleBit;l>k&&a&&!m?e.push([b[k],b[l]-1]):m&&(m=e[e.length-1],m[1]=b[a?l:Math.min(l,k)]-1)}else e=[],e=a.isVisibleBit?e:null;else e=null;return e};g.addHighlight=function(a,b,d,e){a=a||[];b={component:b,options:d,id:e};a.push(b);d=f(b);for(e=a.length-1;0<e&&d<f(a[e-1]);)b=[a[e],a[e-1]],a[e-1]=b[0],a[e]=b[1],--e;return a};g.removeHighlight=function(a,b){return a?(a=a.filter(function(a){return a.id!==b}),0===a.length?null:a):a};g.generateHighlightedIndexRanges=
function(a,e,h){if(!e)return null;if(!d(h))return a&&a.isVisibleBit?null:e.map(function(a){return{range:null,options:a.options}});for(var c=h[0],f=h[h.length-1]-1,k=[],q=!m(a,h),r=0;r<e.length;++r){var t=e[r].options,u=e[r].component;if(null!==u)b(k,a,h,u,t);else if(q)l(k,a,h,c,f,t);else for(u=0;u<p(h);++u)b(k,a,h,u,t)}return 0<k.length?k:null};g.defaultVisibilities=e;g.isAllVisible=function(a,b){return!m(a,b)};g.isAllHidden=function(a,b){return!h(a,b)};g.hasVisible=h;g.hasHidden=m;var r=e();g.createOffsets=
function(a){return Array.isArray(a)?new Uint32Array(a):a};g.hasComponent=function(a,b){return b<p(a)};g.hasComponents=d;var u=[];for(n=0;65>n;n++)u.push(Math.pow(2,n)-1);g.componentCount=p;g.componentFind=function(a,b){a=c.binaryIndexOf(a,b,!0);return 0<=a?a:null}})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});var c=1,a=null;g.generateDefaultIndexArray=function(b){if(b>c||null==a){for(;b>
c;)c*=2;a=new Uint32Array(c);for(var f=0;f<c;f++)a[f]=f}return new Uint32Array(a.buffer,0,b)};var f=0;g.getNewId=function(){return f++}})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["require","exports","../../lib/gl-matrix","../../support/geometryUtils","../../support/mathUtils"],function(n,g,c,a,f){function b(a,b){if(!a)throw a=Error("dummy"),a.stack&&console.log(a.stack),new N(b);}function l(a,b,d){c.mat4d.multiply(b,a,q);c.mat4d.inverse(q);for(a=0;8>a;++a)c.mat4d.multiplyVec4(q,p[a],
r),c.vec3d.set3(r[0]/r[3],r[1]/r[3],r[2]/r[3],d[a])}function e(b,d){a.plane.fromPoints(b[4],b[0],b[3],d[0]);a.plane.fromPoints(b[1],b[5],b[6],d[1]);a.plane.fromPoints(b[4],b[5],b[1],d[2]);a.plane.fromPoints(b[3],b[2],b[6],d[3]);a.plane.fromPoints(b[0],b[1],b[2],d[4]);a.plane.fromPoints(b[5],b[4],b[7],d[5])}function h(a){for(var b in a)return b}function m(a,b){a[12]=b[0];a[13]=b[1];a[14]=b[2]}function k(a,b){void 0===b&&(b=0);for(var d=0,e=0;4>e;e++)d+=a[b+e]*M[e];return d}function d(a){return a-Math.floor(a)}
Object.defineProperty(g,"__esModule",{value:!0});var q=c.mat4d.create(),p=[c.vec4d.createFrom(-1,-1,-1,1),c.vec4d.createFrom(1,-1,-1,1),c.vec4d.createFrom(1,1,-1,1),c.vec4d.createFrom(-1,1,-1,1),c.vec4d.createFrom(-1,-1,1,1),c.vec4d.createFrom(1,-1,1,1),c.vec4d.createFrom(1,1,1,1),c.vec4d.createFrom(-1,1,1,1)],r=c.vec4d.create(),u=[c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),c.vec3d.create(),c.vec3d.create()],t=c.vec3d.create(),v=c.vec3d.create(),
A=c.vec3d.create(),z=c.vec3d.create(),x=c.vec3d.create(),B=c.vec3d.create(),D=c.vec3d.create(),C=c.vec3d.create(),G=c.vec3d.create(),E=c.vec3d.create(),F=c.vec3d.create(),I=c.vec3d.create(),K=c.vec3d.createFrom(0,0,0),N=function(){function a(a){this.message=a}a.prototype.toString=function(){return"AssertException: "+this.message};return a}();g.AssertException=N;g.VertexAttrConstants={POSITION:"position",NORMAL:"normal",NORMALCOMPRESSED:"normalCompressed",UV0:"uv0",AUXPOS1:"auxpos1",AUXPOS2:"auxpos2",
COLOR:"color",SYMBOLCOLOR:"symbolColor",SIZE:"size",REGION:"region",COMPONENTINDEX:"componentIndex"};g.assert=b;g.verify=function(a,b){a||(console.log("Verify failed: "+b),console.log(Error("dummy").stack))};g.encodeInt16=function(a){return f.clamp(Math.round(32767*a),-32767,32767)};g.encodeNormal=function(a,b){var d=Math.abs(a[0]),e=Math.abs(a[1]),h=1/(d+e+Math.abs(a[2])),c=Math.min(a[2]*h,0);b[0]=(0>a[0]?-1:1)*(d*h-c);b[1]=(0>a[1]?-1:1)*(e*h-c)};g.fallbackIfUndefined=function(a,b){return void 0===
a?b:a};g.hex2rgb=function(a){a=Math.floor(a);return[(a>>16&255)/255,(a>>8&255)/255,(a&255)/255]};g.rgb2hex=function(a){var b=f.clamp(Math.round(255*a[0]),0,255),d=f.clamp(Math.round(255*a[1]),0,255);a=f.clamp(Math.round(255*a[2]),0,255);return"0x"+((b<<16)+(d<<8)+a).toString(16)};g.dec2hex=function(a){a=a.toString(16);return"00000000".substr(0,8-a.length)+a};g.raySphere=function(a,b,d,e,h){d=d||K;var f=c.vec3d.subtract(a,d,t);d=c.vec3d.dot(b,b);var k=2*c.vec3d.dot(b,f);e=c.vec3d.dot(f,f)-e*e;e=k*
k-4*d*e;if(0>e)return!1;f=Math.sqrt(e);e=(-k-f)/(2*d);d=(-k+f)/(2*d);if(0>e||d<e&&0<d)e=d;return 0<e?(h&&c.vec3d.add(a,c.vec3d.scale(b,e,I),h),!0):!1};g.rayTriangle3D=function(a,b,d,e,h,f,k,l,m){void 0===m&&(m=c.vec3d.create());var p=e[k]-d[f],q=e[k+1]-d[f+1],r=e[k+2]-d[f+2];e=h[l]-d[f];k=h[l+1]-d[f+1];h=h[l+2]-d[f+2];var t=b[1]*h-k*b[2],u=b[2]*e-h*b[0],x=b[0]*k-e*b[1];l=p*t+q*u+r*x;if(-1E-5<l&&1E-5>l)return!1;l=1/l;var g=a[0]-d[f],B=a[1]-d[f+1];a=a[2]-d[f+2];m[1]=l*(g*t+B*u+a*x);if(0>m[1]||1<m[1])return!1;
d=B*r-q*a;a=a*p-r*g;p=g*q-p*B;m[2]=l*(b[0]*d+b[1]*a+b[2]*p);if(0>m[2]||1<m[1]+m[2])return!1;m[0]=l*(e*d+k*a+h*p);return!0};g.rayBoxTest=function(a,b,d,e){var h,c=(d[0]-a[0])/b[0],f=(e[0]-a[0])/b[0];c>f&&(h=c,c=f,f=h);var k=(d[1]-a[1])/b[1],l=(e[1]-a[1])/b[1];k>l&&(h=k,k=l,l=h);if(c>l||k>f)return!1;k>c&&(c=k);l<f&&(f=l);d=(d[2]-a[2])/b[2];a=(e[2]-a[2])/b[2];d>a&&(h=d,d=a,a=h);if(c>a||d>f)return!1;a<f&&(f=a);return 0>f?!1:!0};g.rayRay2D=function(a,b,d,e,h,f){void 0===f&&(f=c.vec2d.create());var k=(e[h]-
d[h])*(b[0]-a[0])-(e[0]-d[0])*(b[h]-a[h]);if(0===k)return!1;d=((e[0]-d[0])*(a[h]-d[h])-(e[h]-d[h])*(a[0]-d[0]))/k;f[0]=a[0]+d*(b[0]-a[0]);f[1]=a[h]+d*(b[h]-a[h]);return!0};g.matrixToFrustumPoints=l;g.matrixToFrustumPlanes=function(a,b,d,h){void 0===h&&(h=d,d=u);l(a,b,d);e(d,h)};g.frustumPointsToPlanes=e;g.project=function(a,d,e,h,f){f||(f=a);r[0]=a[0];r[1]=a[1];r[2]=a[2];r[3]=1;c.mat4d.multiplyVec4(d,r);2<f.length&&(f[2]=-r[2]);c.mat4d.multiplyVec4(e,r);b(0!==r[3]);f[0]=r[0]/r[3];f[1]=r[1]/r[3];f[2]=
r[2]/r[3];f[0]=(.5*f[0]+.5)*h[2]+h[0];f[1]=(.5*f[1]+.5)*h[3]+h[1]};g.getFirstObjectKey=h;g.getFirstObjectValue=function(a){return a[h(a)]};g.objectEmpty=function(a){for(var b in a)return!1;return!0};g.logWithBase=function(a,b){return Math.log(a)/Math.log(b)};g.setMatrixTranslation=m;g.setMatrixTranslation3=function(a,b,d,e){a[12]=b;a[13]=d;a[14]=e};g.getMatrixTranslation=function(a,b){void 0===b&&(b=c.vec3d.create());b[0]=a[12];b[1]=a[13];b[2]=a[14];return b};g.createTranslationMatrix=function(a,
b){a=c.mat4d.identity(a);m(a,b);return a};g.isTranslationMatrix=function(a){return 1===a[0]&&0===a[1]&&0===a[2]&&0===a[3]&&0===a[4]&&1===a[5]&&0===a[6]&&0===a[7]&&0===a[8]&&0===a[9]&&1===a[10]&&0===a[11]&&1===a[15]};g.fovx2fovy=function(a,b,d){return 2*Math.atan(d*Math.tan(.5*a)/b)};g.fovy2fovx=function(a,b,d){return 2*Math.atan(b*Math.tan(.5*a)/d)};g.fovx2fovd=function(a,b,d){return 2*Math.atan(Math.sqrt(b*b+d*d)*Math.tan(.5*a)/b)};g.fovy2fovd=function(a,b,d){return 2*Math.atan(Math.sqrt(b*b+d*d)*
Math.tan(.5*a)/d)};g.fovd2fovx=function(a,b,d){return 2*Math.atan(b*Math.tan(.5*a)/Math.sqrt(b*b+d*d))};g.fovd2fovy=function(a,b,d){return 2*Math.atan(d*Math.tan(.5*a)/Math.sqrt(b*b+d*d))};g.lineLineDistanceSquared3D=function(a,b,d,e,h){v[0]=a[0]-d[0];v[1]=a[1]-d[1];v[2]=a[2]-d[2];A[0]=e[0]-d[0];A[1]=e[1]-d[1];A[2]=e[2]-d[2];if(1E-4>Math.abs(A[0])&&1E-4>Math.abs(A[1])&&1E-4>Math.abs(A[2]))return h.success=!1,h;z[0]=b[0]-a[0];z[1]=b[1]-a[1];z[2]=b[2]-a[2];if(1E-4>Math.abs(z[0])&&1E-4>Math.abs(z[1])&&
1E-4>Math.abs(z[2]))return h.success=!1,h;b=v[0]*A[0]+v[1]*A[1]+v[2]*A[2];e=A[0]*z[0]+A[1]*z[1]+A[2]*z[2];var k=v[0]*z[0]+v[1]*z[1]+v[2]*z[2],l=A[0]*A[0]+A[1]*A[1]+A[2]*A[2],m=(z[0]*z[0]+z[1]*z[1]+z[2]*z[2])*l-e*e;if(1E-4>Math.abs(m))return h.success=!1,h;k=f.clamp((b*e-k*l)/m,0,1);b=f.clamp((b+e*k)/l,0,1);x[0]=a[0]+k*z[0];x[1]=a[1]+k*z[1];x[2]=a[2]+k*z[2];B[0]=d[0]+b*A[0];B[1]=d[1]+b*A[1];B[2]=d[2]+b*A[2];a=c.vec3d.dist2(x,B);h.success=!0;h.dist2=a;h.pa=x;h.pb=B;return h};g.pointLineSegmentDistanceSquared2D=
function(a,b,d){E[0]=b[0]-a[0];E[1]=b[1]-a[1];E[2]=0;F[0]=d[0]-a[0];F[1]=d[1]-a[1];F[2]=0;I[0]=d[0];I[1]=d[1];I[2]=0;b=c.vec2d.dot(F,E);d=c.vec2d.dot(E,E);b=f.clamp(b/d,0,1);G[0]=E[0]*b;G[1]=E[1]*b;D[0]=a[0]+G[0];D[1]=a[1]+G[1];c.vec2d.subtract(I,D,C);a=c.vec2d.dot(C,C);b=c.vec2d.dot(F,F);d=c.vec2d.dot(E,E);var e=c.vec2d.dot(G,G);if(e>b||e>d)a=Number.MAX_VALUE;return a};g.packFloatRGBA=function(a,b,e){void 0===e&&(e=0);a=f.clamp(a,0,T);for(var h=0;4>h;h++)b[e+h]=Math.floor(256*d(a*H[h]))};g.unpackFloatRGBA=
k;var H=[1,256,65536,16777216],M=[1/256,1/65536,1/16777216,1/4294967296],T=k(new Uint8ClampedArray([255,255,255,255]));g.inverseProjectionInfo=function(a,b,d,e,h){0===a[11]?(e[0]=2/(b*a[0]),e[1]=2/(d*a[5]),e[2]=(1+a[12])/a[0],e[3]=(1+a[13])/a[5],c.vec2d.set2(0,1,h)):(e[0]=-2/(b*a[0]),e[1]=-2/(d*a[5]),e[2]=(1-a[8])/a[0],e[3]=(1-a[9])/a[5],c.vec2d.set2(1,0,h))}})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["require","exports"],function(n,g){var c;n=c||(c={});n[n.MATERIAL=0]="MATERIAL";
n[n.MATERIAL_DEPTH=1]="MATERIAL_DEPTH";n[n.MATERIAL_NORMAL=2]="MATERIAL_NORMAL";n[n.MATERIAL_DEPTH_SHADOWMAP=3]="MATERIAL_DEPTH_SHADOWMAP";n[n.MATERIAL_HIGHLIGHT=4]="MATERIAL_HIGHLIGHT";n[n.MAX_PASS=5]="MAX_PASS";return c})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["require","exports"],function(n,g){var c;n=c||(c={});n[n.BACKGROUND=0]="BACKGROUND";n[n.INTERNAL_MATERIAL=1]="INTERNAL_MATERIAL";n[n.STENCIL_MATERIAL=2]="STENCIL_MATERIAL";n[n.OPAQUE_TERRAIN=3]="OPAQUE_TERRAIN";n[n.OPAQUE_MATERIAL=
4]="OPAQUE_MATERIAL";n[n.OPAQUE_EXTERNAL=5]="OPAQUE_EXTERNAL";n[n.TRANSPARENT_MATERIAL=6]="TRANSPARENT_MATERIAL";n[n.TRANSPARENT_EXTERNAL=7]="TRANSPARENT_EXTERNAL";n[n.TRANSPARENT_TERRAIN=8]="TRANSPARENT_TERRAIN";n[n.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";n[n.POSTPROCESSING_HIGHLIGHT=10]="POSTPROCESSING_HIGHLIGHT";n[n.POSTPROCESSING_ATMOSPHERE_OPAQUE=11]="POSTPROCESSING_ATMOSPHERE_OPAQUE";n[n.POSTPROCESSING_ATMOSPHERE_TRANSPARENT=12]="POSTPROCESSING_ATMOSPHERE_TRANSPARENT";n[n.POSTPROCESSING_EXTERNAL=
13]="POSTPROCESSING_EXTERNAL";n[n.HUDMATERIAL1=14]="HUDMATERIAL1";n[n.HUDMATERIAL2=15]="HUDMATERIAL2";n[n.LINE_CALLOUTS=16]="LINE_CALLOUTS";n[n.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";n[n.MAX_SLOTS=18]="MAX_SLOTS";return c})},"esri/views/3d/webgl-engine/shaders/SimpleAtmospherePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});
g.colorPass={name:"simple-atmosphere-color",shaders:function(b){return{vertexShader:f.glslifyDefineMap({PANORAMIC:b.panoramic})+a.resolveIncludes("environment/simpleAtmosphere.vert"),fragmentShader:f.glslifyDefineMap({PANORAMIC:b.panoramic})+a.resolveIncludes("environment/simpleAtmosphere.frag")}},attributes:c.Default3D};g.fadePass={name:"simple-atmosphere-fade",shaders:{vertexShader:a.resolveIncludes("environment/simpleAtmosphereFade.vert"),fragmentShader:a.resolveIncludes("environment/simpleAtmosphereFade.frag")},
attributes:c.Default3D}})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.Default3D={position:0,normal:1,normalCompressed:1,uv0:2,color:3,instanceColor:3,size:4,auxpos1:5,symbolColor:5,componentIndex:5,auxpos2:6,featureAttribute:6,instanceFeatureAttribute:6,region:7,model:8,modelNormal:12,modelOriginHi:11,modelOriginLo:15}})},"esri/views/3d/webgl-engine/shaders/sources/resolver":function(){define(["require",
"exports","./shaderRepository","../../../../webgl/ShaderCompiler"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});var f=new a(function(a){var b=c;a.split("/").forEach(function(a){b&&(b=b[a])});return b});g.resolveIncludes=function(a){return f.resolveIncludes(a)}})},"esri/views/3d/webgl-engine/shaders/sources/shaderRepository":function(){define(["require","exports"],function(n,g){return{edgeRenderer:{"adjustProjectedPosition.glsl":"uniform vec2 uDepthBias;\r\nuniform vec2 uViewportDimInv;\r\n\r\n// Utility function to check for NaN values\r\nbool isNaN(float val) {\r\n  return ( val \x3c 0.0 || 0.0 \x3c val || val \x3d\x3d 0.0 ) ? false : true;\r\n  // important: some nVidias failed to cope with version below.\r\n  // Probably wrong optimization.\r\n  /*return ( val \x3c\x3d 0.0 || 0.0 \x3c\x3d val ) ? false : true;*/\r\n}\r\n\r\n// An offset in xy screen space, along the projected normal of the edge\r\n// This reduces depth fighting when looking at a face from a flat angle\r\nvec2 calculateProjectedBiasXY(vec4 projPos, vec3 worldNormal) {\r\n  float offsetXY \x3d uDepthBias.x;\r\n  float offsetZ  \x3d uDepthBias.y;\r\n\r\n  // screen space pixel offset\r\n  // we multiply by two to account for the fact that NDC go from -1 to 1\r\n  // we multiply by projPos.w to compensate for the perspective divison that happens later\r\n  // normalizing over xyz means that the xy influence is reduced the more the normal is pointing\r\n  // towards the camera\r\n  vec4 projNormal \x3d uProj * uView * vec4(worldNormal, 0.0);\r\n\r\n  return offsetXY * projPos.w * 2.0 * uViewportDimInv * normalize(projNormal.xyz).xy;\r\n}\r\n\r\n// A z-offset, using a depth based heuristic.\r\nfloat calculateProjectedBiasZ(vec4 projPos) {\r\n  float offsetZ \x3d uDepthBias.y;\r\n  return sqrt(projPos.z) * offsetZ;\r\n}\r\n\r\nvec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {\r\n  vec2 offsetXY \x3d calculateProjectedBiasXY(projPos, worldNormal);\r\n\r\n  // we currently have to do this check because some geometries come with 0 length edge normals.\r\n  // see https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12890\r\n  if (!isNaN(offsetXY.x) \x26\x26 !isNaN(offsetXY.y)) {\r\n    projPos.xy +\x3d offsetXY;\r\n  }\r\n\r\n  projPos.z +\x3d calculateProjectedBiasZ(projPos);\r\n\r\n  return projPos;\r\n}\r\n",
"edgeRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec4 vColor;\r\nvarying float vRadius;\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\nvarying float vLineIndex;\r\n\r\n// At which coverage threshold we discard a fragment completely\r\n#define COVERAGE_TEST_THRESHOLD 0.01\r\n\r\n#include \x3cedgeRenderer/lineOffset.glsl\x3e\r\n\r\nvec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {\r\n  float lineOffset \x3d calculateLineOffset();\r\n  float positionX \x3d position.x - lineOffset;\r\n\r\n  if (radius \x3c 1.0) {\r\n    // Handle this specifically for subpixel sizes:\r\n    // 1. Compute correct coverage (note coverage is computed by\r\n    //    0.5 - dist, so we make sure that that will lead to correct\r\n    //    subpixel coverage\r\n    // 2. Ignore rounded caps\r\n    float coverageX \x3d clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);\r\n    float coverageY \x3d clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);\r\n\r\n    float coverage \x3d min(coverageX, coverageY);\r\n\r\n    return vec2(0.5 - coverage, 0.0);\r\n  }\r\n  else {\r\n    // Between -radius -\x3e 0 for start cap, 0 for line, 0 -\x3e radius\r\n    float positionOnCap \x3d position.y - clamp(position.y, 0.0, lineLength);\r\n\r\n    vec2 lineToPosition \x3d vec2(positionX, positionOnCap);\r\n    return vec2(length(lineToPosition) - radius, positionOnCap / radius);\r\n  }\r\n}\r\n\r\nvoid main() {\r\n\r\n  float radius \x3d vRadius * calculateLinePressure();\r\n\r\n  vec2 distance \x3d lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);\r\n  float coverage \x3d clamp(0.5 - distance.x, 0.0, 1.0);\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float coverageLimit \x3d COVERAGE_TEST_THRESHOLD;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Use subpixel coverage computation when lines get subpixel widths\r\n  // so we still render them appropriately. Otherwise discard anything\r\n  // that is not fully within the line\r\n  float coverageLimit \x3d radius \x3c\x3d 0.5 ? COVERAGE_TEST_THRESHOLD : 0.75;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  if (coverage \x3c coverageLimit) {\r\n    discard;\r\n  }\r\n\r\n  discardBySlice(vWorldPosition);\r\n\r\n  float alpha \x3d vColor.a * coverage;\r\n\r\n  gl_FragColor \x3d vec4(vColor.rgb, alpha);\r\n}\r\n",
"edgeRenderer.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Transformations\r\nuniform mat4 uProj;\r\nuniform mat4 uView;\r\nuniform mat4 uModel;\r\nuniform vec3 uCameraPosition;\r\n\r\n// Line configuration\r\n\r\n// Conversion constants\r\nuniform vec2 uPixelToNDC;\r\nuniform vec2 uNDCToPixel;\r\nuniform float uPixelRatio;\r\n\r\n// Inputs\r\nattribute vec3 aPosition0;\r\nattribute vec3 aPosition1;\r\nattribute float aVariantOffset;\r\nattribute float aVariantStroke;\r\nattribute float aVariantExtension;\r\n\r\n#ifdef SILHOUETTE\r\n\r\nattribute vec3 aNormalA;\r\nattribute vec3 aNormalB;\r\n\r\n#else /* SILHOUETTE */\r\n\r\nattribute vec3 aNormal;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\nattribute vec2 aSideness;\r\nattribute vec2 aPackedAttributes;\r\n\r\nstruct UnpackedAttributes {\r\nvec2 sideness;\r\nvec2 sidenessNorm;\r\nfloat lineWidthPixels;\r\nfloat extensionLengthPixels;\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nfloat type;\r\n\r\n#endif\r\n};\r\n\r\n// Output required to compute color\r\nvarying vec4 vColor;\r\n\r\n// Output required to compute distance to line/caps\r\nvarying vec3 vPosition;\r\nvarying vec3 vWorldPosition;\r\nvarying float vRadius;\r\nvarying float vLineLengthPixels;\r\nvarying float vSizeFalloffFactor;\r\n\r\n#include \x3cedgeRenderer/adjustProjectedPosition.glsl\x3e\r\n#include \x3cedgeRenderer/styleOutputs.glsl\x3e\r\n#include \x3cedgeRenderer/lineAmplitude.glsl\x3e\r\n#include \x3cedgeRenderer/util.glsl\x3e\r\n\r\nvec4 calculateGeometricOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  vec2 sideness \x3d unpackedAttributes.sideness;\r\n  vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n  vWorldPosition \x3d mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;\r\n\r\n  vec4 viewPos \x3d mix(viewPosV0, viewPosV1, sidenessNorm.y);\r\n  vec4 projPosV0 \x3d uProj * viewPosV0;\r\n  vec4 projPosV1 \x3d uProj * viewPosV1;\r\n  vec4 projPos \x3d uProj * viewPos;\r\n\r\n  vec3 screenSpaceLineNDC \x3d (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);\r\n  vec2 screenSpaceLinePixels \x3d screenSpaceLineNDC.xy * uNDCToPixel;\r\n  float lineLengthPixels \x3d length(screenSpaceLinePixels);\r\n\r\n  float dzPerPixel \x3d screenSpaceLineNDC.z / lineLengthPixels;\r\n  vec2 screenSpaceDirection \x3d screenSpaceLinePixels / lineLengthPixels;\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;\r\n\r\n  float falloffFactor \x3d distanceBasedPerspectiveFactor(-viewPos.z) * uPixelRatio;\r\n  float lineWidthPixels \x3d unpackedAttributes.lineWidthPixels * falloffFactor;\r\n\r\n  float extensionLengthPixels \x3d calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;\r\n  float lineAmplitudePixels \x3d calculateLineAmplitude(unpackedAttributes) * uPixelRatio;\r\n\r\n  vSizeFalloffFactor \x3d falloffFactor;\r\n\r\n  float lineWidthAndAmplitudePixels \x3d lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;\r\n  float extendedLineLengthPixels \x3d lineLengthPixels + extensionLengthPixels + extensionLengthPixels;\r\n\r\n#ifdef ANTIALIASING\r\n\r\n  const float aaPaddingPixels \x3d 1.0;\r\n\r\n  // Line size with padding\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;\r\n  float aaPaddedRoundedCapSizePixels \x3d lineWidthPixels * 0.5 + aaPaddingPixels;\r\n\r\n  // Line length with padding\r\n  float aaPaddedLineLengthPixels \x3d extendedLineLengthPixels + aaPaddingPixels + aaPaddingPixels;\r\n  float halfAAPaddedLineLengthPixels \x3d aaPaddedLineLengthPixels * 0.5;\r\n\r\n#else /* ANTIALIASING */\r\n\r\n  // Even if there is no AA, we still want to do proper \x3c1px rendering,\r\n  // so we effectively clamp the pixel sizes to minimum of 1px and compute\r\n  // coverage in the fragment shader\r\n  float halfAAPaddedLineWidthAndAmplitudePixels \x3d max(lineWidthAndAmplitudePixels, 1.0) * 0.5;\r\n  float aaPaddedRoundedCapSizePixels \x3d max(lineWidthPixels, 1.0) * 0.5;\r\n\r\n  float halfAAPaddedLineLengthPixels \x3d max(extendedLineLengthPixels, 1.0) * 0.5;\r\n\r\n#endif /* ANTIALIASING */\r\n\r\n  // Half line width in NDC including padding for anti aliasing\r\n  vec2 halfAAPaddedLineWidthAndAmplitudeNDC \x3d halfAAPaddedLineWidthAndAmplitudePixels * uPixelToNDC;\r\n  vec2 aaPaddedRoundedCapSizeNDC \x3d aaPaddedRoundedCapSizePixels * uPixelToNDC;\r\n  vec2 extensionLengthNDC \x3d extensionLengthPixels * uPixelToNDC;\r\n\r\n  // Compute screen space position of vertex, offsetting for line size and end caps\r\n  vec2 ndcOffset \x3d (\r\n      screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)\r\n    + perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC\r\n  );\r\n\r\n  projPos.xy +\x3d ndcOffset * projPos.w;\r\n  projPos.z +\x3d (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;\r\n\r\n  projPos \x3d adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));\r\n\r\n  // Line length with end caps\r\n  float aaPaddedLineWithCapsLengthPixels \x3d extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;\r\n\r\n  float pixelPositionAlongLine \x3d aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;\r\n\r\n  // Position in pixels with origin at first vertex of line segment\r\n  vPosition \x3d vec3(\r\n    halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,\r\n    pixelPositionAlongLine,\r\n    pixelPositionAlongLine / extendedLineLengthPixels\r\n  );\r\n\r\n  // The line width radius in pixels\r\n  vRadius \x3d lineWidthPixels * 0.5;\r\n  vLineLengthPixels \x3d extendedLineLengthPixels;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  gl_Position \x3d isSilhouetteEdge(viewPosV0, aNormalA, aNormalB) ? projPos : vec4(10, 10, 10, 1);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  gl_Position \x3d projPos;\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  if (unpackedAttributes.type \x3c\x3d 0.0 \x26\x26 lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10, 10, 10, 1);\r\n  }\r\n\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  if (lineLengthPixels \x3c\x3d 3.0) {\r\n    gl_Position \x3d vec4(10, 10, 10, 1);\r\n  }\r\n\r\n#endif\r\n\r\n  return projPos;\r\n}\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n\r\n  float fType \x3d component.type;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  if (fType \x3c\x3d 0.0) {\r\n    extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n  }\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);\r\n}\r\n\r\n#else /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nUnpackedAttributes unpackAttributes(ComponentData component) {\r\n  vec2 sidenessNorm \x3d aSideness;\r\n  vec2 sideness \x3d sidenessNorm * 2.0 - 1.0;\r\n  float extensionLengthPixels \x3d component.extensionLength;\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  extensionLengthPixels *\x3d aVariantExtension * 2.0 - 1.0;\r\n\r\n#endif\r\n\r\n  float lineWidth \x3d component.lineWidth;\r\n\r\n  return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);\r\n}\r\n\r\n#endif /* (MODE \x3d\x3d MODE_UBER) */\r\n\r\nvoid main() {\r\n  ComponentData component \x3d readComponentData();\r\n  UnpackedAttributes unpackedAttributes \x3d unpackAttributes(component);\r\n\r\n  vec4 worldPosV0 \x3d uModel * vec4(aPosition0, 1.0);\r\n  vec4 worldPosV1 \x3d uModel * vec4(aPosition1, 1.0);\r\n\r\n  vec4 viewPosV0 \x3d uView * worldPosV0;\r\n  vec4 viewPosV1 \x3d uView * worldPosV1;\r\n\r\n#ifdef SILHOUETTE\r\n\r\n  vec3 worldNormal \x3d silhouetteWorldNormal(aNormalA, aNormalB);\r\n\r\n#else /* SILHOUETTE */\r\n\r\n  vec3 worldNormal \x3d modelToWorldNormal(aNormal);\r\n\r\n#endif /* SILHOUETTE */\r\n\r\n  // General geometric computation for all types of edges\r\n  vec4 projPos \x3d calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal, unpackedAttributes);\r\n\r\n  // Component color\r\n  vColor \x3d component.color;\r\n\r\n  // Specific computation for different edge styles\r\n  calculateStyleOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, projPos, worldNormal, unpackedAttributes);\r\n}\r\n",
"lineAmplitude.glsl":"// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitudeSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform float uStrokesAmplitude;\r\n\r\n  float calculateLineAmplitudeSketch() {\r\n    return uStrokesAmplitude;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    return calculateLineAmplitudeSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n\r\n  float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {\r\n    float type \x3d unpackedAttributes.type;\r\n\r\n    if (type \x3c\x3d 0.0) {\r\n      return calculateLineAmplitudeSketch();\r\n    }\r\n    else {\r\n      return calculateLineAmplitudeSolid();\r\n    }\r\n  }\r\n\r\n#endif\r\n",
"lineOffset.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\n// Sketch\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform sampler2D uStrokesTexture;\r\n  uniform float uStrokesNormalizationScale;\r\n\r\n  varying vec2 vStrokeUV;\r\n\r\n  float calculateLineOffsetSketch() {\r\n    float offsetNorm \x3d rgba2float(texture2D(uStrokesTexture, vStrokeUV));\r\n    return (offsetNorm - 0.5) * uStrokesNormalizationScale;\r\n  }\r\n\r\n  float calculateLinePressureSketch() {\r\n    return rgba2float(texture2D(uStrokesTexture, vStrokeUV + vec2(0, 0.5)));\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSketch();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSketch();\r\n  }\r\n\r\n#endif\r\n\r\n// Solid\r\n\r\n#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffsetSolid() {\r\n    return 0.0;\r\n  }\r\n\r\n  float calculateLinePressureSolid() {\r\n    return 1.0;\r\n  }\r\n\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n\r\n  float calculateLineOffset() {\r\n    return calculateLineOffsetSolid();\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    return calculateLinePressureSolid();\r\n  }\r\n\r\n#endif\r\n\r\n// Uber\r\n\r\n#if (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  float calculateLineOffset() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLineOffsetSketch();\r\n    }\r\n    else {\r\n      return calculateLineOffsetSolid();\r\n    }\r\n  }\r\n\r\n  float calculateLinePressure() {\r\n    if (vType \x3c\x3d 0.0) {\r\n      return calculateLinePressureSketch();\r\n    }\r\n    else {\r\n      return calculateLinePressureSolid();\r\n    }\r\n  }\r\n#endif\r\n",
"styleOutputs.glsl":"#if (MODE \x3d\x3d MODE_UBER || MODE \x3d\x3d MODE_SKETCH)\r\n\r\n  uniform vec2 uStrokesTextureScale;\r\n  uniform float uStrokesLog2Resolution;\r\n  uniform float uStrokeVariants;\r\n\r\n  varying vec2 vStrokeUV;\r\n  varying float vLineIndex;\r\n\r\n  void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {\r\n    vec2 sidenessNorm \x3d unpackedAttributes.sidenessNorm;\r\n\r\n    float lineIndex \x3d clamp(ceil(log2(lineLength)), 0.0, uStrokesLog2Resolution);\r\n\r\n    vStrokeUV \x3d vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * uStrokeVariants + aVariantStroke + 0.5) * uStrokesTextureScale;\r\n    vStrokeUV.x +\x3d aVariantOffset;\r\n\r\n    vLineIndex \x3d lineIndex;\r\n  }\r\n#endif\r\n\r\n#if (MODE \x3d\x3d MODE_SOLID)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n  }\r\n#elif (MODE \x3d\x3d MODE_SKETCH)\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n  }\r\n#elif (MODE \x3d\x3d MODE_UBER)\r\n  varying float vType;\r\n\r\n  void calculateStyleOutputs(vec4 viewPosV0, vec4 viewPosV1, vec4 worldPosV0, vec4 worldPosV1, vec4 projPos, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {\r\n    vType \x3d unpackedAttributes.type;\r\n\r\n    if (unpackedAttributes.type \x3c\x3d 0.0) {\r\n      calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);\r\n    }\r\n  }\r\n#endif\r\n",
"util.glsl":"uniform float uDistanceFalloffFactor;\r\n\r\nfloat distanceBasedPerspectiveFactor(float distance) {\r\n  return clamp(sqrt(uDistanceFalloffFactor / distance), 0.0, 1.0);\r\n}\r\n\r\nuniform sampler2D uComponentDataTex;\r\nuniform vec2 uComponentDataTexInvDim;\r\n\r\nattribute float aComponentIndex;\r\n\r\n#define COMPONENT_COLOR_FIELD_OFFSET 0.0\r\n#define COMPONENT_OTHER_FIELDS_OFFSET 1.0\r\n#define COMPONENT_FIELD_COUNT 2.0\r\n\r\n#define LINE_WIDTH_FRACTION_FACTOR 8.0\r\n#define EXTENSION_LENGTH_OFFSET 128.0\r\n\r\n#define COMPONENT_TEX_WIDTH 4096.0\r\n\r\nvec2 componentTextureCoords(float componentIndex, float fieldOffset) {\r\n  float fieldIndex \x3d COMPONENT_FIELD_COUNT * componentIndex + fieldOffset;\r\n\r\n  float rowIndex \x3d floor(fieldIndex / COMPONENT_TEX_WIDTH);\r\n  float colIndex \x3d mod(fieldIndex, COMPONENT_TEX_WIDTH);\r\n\r\n  vec2 linearIndex \x3d vec2(\r\n    (colIndex + 0.5) / COMPONENT_TEX_WIDTH,\r\n    (rowIndex + 0.5) * uComponentDataTexInvDim.y\r\n  );\r\n\r\n  return linearIndex;\r\n}\r\n\r\nstruct ComponentData {\r\n  vec4 color;\r\n  float lineWidth;\r\n  float extensionLength;\r\n  float type;\r\n};\r\n\r\nComponentData readComponentData() {\r\n  vec2 colorIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_COLOR_FIELD_OFFSET);\r\n  vec2 otherIndex \x3d componentTextureCoords(aComponentIndex, COMPONENT_OTHER_FIELDS_OFFSET);\r\n\r\n  vec4 colorValue \x3d texture2D(uComponentDataTex, colorIndex);\r\n  vec4 otherValue \x3d texture2D(uComponentDataTex, otherIndex);\r\n\r\n  return ComponentData(\r\n    vec4(colorValue.rgb, colorValue.a * otherValue.w), // otherValue.w stores separate opacity\r\n    otherValue.x * (255.0 / LINE_WIDTH_FRACTION_FACTOR),\r\n    otherValue.y * 255.0 - EXTENSION_LENGTH_OFFSET,\r\n    -(otherValue.z * 255.0) + 0.5 // SOLID (\x3d0/255) needs to be \x3e 0.0, SKETCHY (\x3d1/255) needs to be \x3c\x3d 0;\r\n  );\r\n}\r\n\r\nvec3 modelToWorldNormal(vec3 normal) {\r\n  return (uModel * vec4(normal, 0)).xyz;\r\n}\r\n\r\nvec3 silhouetteWorldNormal(vec3 normalA, vec3 normalB) {\r\n  return modelToWorldNormal(normalize(normalA + normalB));\r\n}\r\n\r\n// Fall-off extension length for shorter strokes, starting from strokes that are 256 size,\r\n// fall-off exponentially\r\nfloat calculateExtensionLength(float extensionLength, float lineLength) {\r\n  return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);\r\n}\r\n\r\n#ifdef SILHOUETTE\r\n\r\n// #uniforms: uView, uModel\r\nbool isSilhouetteEdge(vec4 viewPos, vec3 normalA, vec3 normalB) {\r\n  // transform the two face normals\r\n  vec3 viewNormalA \x3d (uView * uModel * vec4(normalA, 0.0)).xyz;\r\n  vec3 viewNormalB \x3d (uView * uModel * vec4(normalB, 0.0)).xyz;\r\n\r\n  // compute the direction from the edge to the camera\r\n  vec3 viewDir \x3d -viewPos.xyz;\r\n\r\n  // check which of the two faces are visible\r\n  // display the edge if exactly one of the two is visible\r\n  float faceAVisible \x3d dot(viewDir, viewNormalA); // positive if visible\r\n  float faceBVisible \x3d dot(viewDir, viewNormalB); // positive if visible\r\n\r\n  // 1 if exactly one face visible, 0 otherwise\r\n  return faceAVisible * faceBVisible \x3c 0.0;\r\n}\r\n\r\n#endif /* SILHOUETTE */\r\n"},
environment:{"realisticAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\n// Light\r\nuniform vec3 v3LightDir;      // The direction vector to the light source\r\nuniform vec3 v3InvWavelength; // 1 / pow(wavelength, 4) for the red, green, and blue channels\r\nuniform vec3 v3InvWavelengthScaled; //v3InvWavelength * fKr4PI + fKm4PI\r\n\r\n// Atmosphere\r\nconst float fKrESun \x3d 0.075;        // Kr * ESun \x3d 0.005 * 15.0\r\nconst float fKmESun \x3d 0.015;        // Km * ESun \x3d 0.005 * 15\r\n\r\n// Radii\r\nuniform vec4 v4Radii; // (fInnerRadius, fInnerRadius^2, fOuterRadius, fOuterRadius^2)\r\n\r\nfloat fInnerRadius \x3d v4Radii[0];   // The inner (planetary) radius\r\nfloat fInnerRadius2 \x3d v4Radii[1];  // fInnerRadius^2\r\nfloat fOuterRadius \x3d v4Radii[2];   // The outer (atmosphere) radius\r\nfloat fOuterRadius2 \x3d v4Radii[3];  // fOuterRadius^2\r\n\r\n// Atmosphere parameters:\r\n// fScale:                    1.0 / (fOuterRadius - fInnerRadius)\r\n// fScaleDepth:               The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepth:      fScale / fScaleDepth\r\n// fOneOverScaleDepth:        1.0 / fScaleDepth\r\n\r\n// fScaleDepthBlue:           The scale depth (i.e. the altitude at which the atmosphere's average density is found)\r\n// fScaleOverScaleDepthBlue:  fScale / fScaleDepthBlue\r\n// fOneOverScaleDepthBlue;    1.0 / fScaleDepthBlue\r\n\r\nuniform vec4 v4AtmosParams1; // (fScale, fScaleDepth, fScaleOverScaleDepth, fOneOverScaleDepth)\r\nuniform vec4 v4AtmosParams2; // (g, fScaleDepthBlue, fScaleOverScaleDepthBlue, fOneOverScaleDepthBlue)\r\n\r\nfloat fScale \x3d v4AtmosParams1.x;\r\nvec2 v2ScaleDepth \x3d vec2(v4AtmosParams1.y,v4AtmosParams2.y);//fScaleDepth, fScaleDepthBlue\r\nvec2 v2ScaleOverScaleDepth \x3d vec2(v4AtmosParams1.z,v4AtmosParams2.z);//fScaleOverScaleDepth, fScaleOverScaleDepthBlue\r\nvec2 v2OneOverScaleDepth \x3d vec2(v4AtmosParams1.w,v4AtmosParams2.w);//fOneOverScaleDepth, fOneOverScaleDepthBlue\r\n\r\n#ifndef HAZE\r\nuniform vec4 v4AtmosParams3; // (g2, fMiePhaseCoefficients, fLowerAlphaBlendBound, fOneOverOuterRadiusMinusAlphaBlendBound)\r\nuniform float fInnerFadeDistance;\r\nuniform float fAltitudeFade;\r\n\r\nfloat g \x3d v4AtmosParams2.x;\r\nfloat g2 \x3d v4AtmosParams3.x;\r\nfloat fMiePhaseCoefficients \x3d v4AtmosParams3.y;\r\nfloat fLowerAlphaBlendBound \x3d v4AtmosParams3.z;\r\nfloat fOneOverOuterRadiusMinusAlphaBlendBound \x3d v4AtmosParams3.w;\r\n#endif\r\n\r\n// Camera\r\nuniform vec3 v3CameraPos;     // The camera's current position\r\nuniform vec2 nearFar;\r\n\r\nuniform vec4 v4SphereComp;              // (fCameraHeight, fCameraHeight2, fC, fCSur)\r\nfloat fCameraHeight \x3d v4SphereComp[0];  // The camera's current height\r\nfloat fCameraHeight2 \x3d v4SphereComp[1]; // fCameraHeight^2\r\nfloat fC \x3d v4SphereComp[2];             // fCameraHeight2 - fOuterRadius2; // C \x3d ||o-c||^2 - r^2\r\nfloat fCSur \x3d v4SphereComp[3];          // fCameraHeight2 - (fInnerRadius2 - 63756370000.0); // C \x3d ||o-c||^2 - r^2\r\n\r\n// Camera HDR\r\n#ifdef HAZE\r\nconst float fExposure \x3d 1.5;\r\n#else\r\nconst float fExposure \x3d 2.0;\r\n#endif\r\n\r\n#ifdef HAZE\r\n// Depth texture\r\nuniform sampler2D tDepth;\r\n#endif\r\n\r\n// Testing variables\r\nuniform float showTest;\r\n\r\n// Varyings\r\nvarying vec3 v3EyeDir;\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n// Loop constants for integral approximation\r\nconst float fSamples \x3d 5.0;\r\nconst int maxSamples \x3d 5;\r\n\r\n#ifdef HAZE\r\n  const float fOneOverGamma \x3d 1.0;//Gamma \x3d 1.0\r\n#else\r\n  const float fOneOverGamma \x3d 0.454545; // Gamma \x3d 2.2\r\n#endif\r\n  const vec3 v3OneOverGamma \x3d vec3(fOneOverGamma);\r\n\r\n// ToneMapping operators\r\nvec3 expTM(vec3 inputColor,float exposure){\r\n    return pow(1.0 - exp(inputColor * -exposure), v3OneOverGamma);\r\n}\r\n\r\n#ifndef HAZE\r\nvec3 reinhardTM(vec3 inputColor, float exposure){\r\n  vec3 intermediate \x3d inputColor *exposure;\r\n  intermediate /\x3d (1.0+intermediate);\r\n  return pow(intermediate, v3OneOverGamma);\r\n}\r\n#endif\r\n\r\n// Approximation for inner integral based on a radii ratio of 10.25:10\r\nfloat scale(float fCos){\r\n  float x \x3d 1.0 - fCos;\r\n  return exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\r\n}\r\n\r\nvoid main() {\r\n  vec3 cameraPosition \x3d v3CameraPos;\r\n\r\n  // Debug variables\r\n  vec3 test \x3d vec3(0.0,0.0,0.0);\r\n\r\n  // Obtain ray from Camera\r\n  vec3 worldSpaceRay \x3d normalize(v3WorldRay);\r\n\r\n  // Compute Atmosphere intersection; i.e. ray/sphere intersection\r\n  float B \x3d 2.0 * dot(cameraPosition, worldSpaceRay); // B \x3d 2(l * (o-c))\r\n  float det \x3d B*B - 4.0 * fC; // det \x3d B^2 - 4.0* C\r\n\r\n  // idealized sphere intersection to discard early some pixels\r\n  float detSur \x3d B*B - 4.0 * fCSur; // det \x3d B^2 - 4.0* C\r\n\r\n  // the minimal sample start position:\r\n  // at the camera by default, on the earth radius surface if the camera is underground.\r\n  float fMinRayStart \x3d 0.0;\r\n#ifndef HAZE\r\n  // When the ray intersects the earth surface, fade the sky to a simple light direction\r\n  // based color. This is used to make sure we have a white background in underground\r\n  // mode (at noon).\r\n  float fSurfaceBlend \x3d 0.0;\r\n  vec4 surfaceColor \x3d vec4(0.0);\r\n  if (detSur \x3e\x3d 0.0) {\r\n    float nearSurfaceT \x3d max(0.0, 0.5 *(-B - sqrt(detSur)));\r\n    float farSurfaceT \x3d max(0.0, 0.5 *(-B + sqrt(detSur)));\r\n\r\n    if (nearSurfaceT \x3d\x3d 0.0) {\r\n      fMinRayStart \x3d farSurfaceT;\r\n    }\r\n\r\n    // Compute lighting at the point where the ray enters the earth surface\r\n    // Lighting computation is copied from the terrain shader.\r\n    vec3 vPos \x3d cameraPosition + worldSpaceRay * nearSurfaceT;\r\n    float fLightAngle \x3d dot(v3LightDir, normalize(vPos));\r\n    float fBrightness \x3d max(0.0, (smoothstep(-1.0, 0.8, 2.0 * fLightAngle)));\r\n\r\n    // Make the surface transparent based on altitude\r\n    surfaceColor \x3d vec4(fBrightness, fBrightness, fBrightness, 1.0 - fAltitudeFade);\r\n\r\n    // Fade based on the distance the ray travels below the earth surface\r\n    float fRelDist \x3d (farSurfaceT - nearSurfaceT) / fInnerFadeDistance;\r\n\r\n    // early exit\r\n    if (fRelDist \x3e 1.0) {\r\n      gl_FragColor \x3d surfaceColor;\r\n      return;\r\n    }\r\n\r\n    fSurfaceBlend \x3d smoothstep(0.0, 1.0, fRelDist * fRelDist);\r\n  }\r\n#endif\r\n\r\n  // Inside Atmosphere\r\n  if (det \x3e\x3d 0.0) {\r\n#ifdef HAZE\r\n    // only use red channel from depth texture.\r\n    // see 'Issues' at https://www.khronos.org/registry/webgl/extensions/WEBGL_depth_texture\r\n    float depthSample \x3d texture2D(tDepth, vtc).r;\r\n\r\n    float zNear \x3d nearFar[0];\r\n    float zFar \x3d nearFar[1];\r\n\r\n    // http://web.archive.org/web/20130416194336/http://olivers.posterous.com/linear-depth-in-glsl-for-real\r\n    float zNorm \x3d 2.0 * depthSample - 1.0;\r\n    float linDepth \x3d 2.0 * zNear * zFar /\r\n      (zFar + zNear - zNorm * (zFar - zNear));\r\n\r\n    float rayEndT;\r\n    float altitudeAlpha \x3d 1.0;\r\n\r\n    // find intersections with ground, but only between the near and far\r\n    // clipping planes.\r\n    if (depthSample \x3c 1.0 \x26\x26 depthSample \x3e 0.0) {\r\n      vec3 cameraSpaceRay \x3d normalize(v3EyeDir);\r\n      cameraSpaceRay /\x3d cameraSpaceRay.z;\r\n      cameraSpaceRay *\x3d linDepth;\r\n\r\n      float cameraSpaceRayLength \x3d length(cameraSpaceRay);\r\n\r\n      vec3 v3World \x3d cameraPosition + worldSpaceRay * cameraSpaceRayLength;\r\n      float v3WorldRadius2 \x3d dot(v3World, v3World);\r\n\r\n      // Handle tall structures:\r\n      // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/5450\r\n      float transitionStart \x3d fInnerRadius + 20000.0;\r\n      float transitionHeight \x3d 25000.0;\r\n      float transitionEnd \x3d transitionStart + transitionHeight;\r\n\r\n      float edge0 \x3d transitionStart * transitionStart;\r\n      float edge1 \x3d transitionEnd * transitionEnd;\r\n\r\n      altitudeAlpha \x3d 1.0 - clamp((v3WorldRadius2 - edge0) / (edge1 - edge0), 0.0, 1.0);\r\n      rayEndT \x3d cameraSpaceRayLength;\r\n\r\n      if (altitudeAlpha \x3e 0.0 \x26\x26 detSur \x3e 0.0) {\r\n        float nearSurfaceT \x3d 0.5 *(-B - sqrt(detSur));\r\n        float interp \x3d clamp(((fCameraHeight - fInnerRadius) - 2000000.0) / 6000000.0, 0.0, 1.0);\r\n        rayEndT \x3d mix(cameraSpaceRayLength, nearSurfaceT, interp);\r\n      }\r\n    }\r\n#endif\r\n\r\n    float rayStartT \x3d 0.5 *(-B - sqrt(det)); //near intersection with atmosphere\r\n#ifdef HAZE\r\n    float nearT \x3d abs(rayStartT);\r\n    float farT \x3d abs(rayEndT);\r\n#else\r\n    float rayEndT \x3d 0.5 *(-B + sqrt(det)); //far intersection with atmosphere\r\n\r\n#endif\r\n\r\n    float fDistance; // calculate its scattering offset\r\n    // Calculate the ray's starting position\r\n    if (rayStartT \x3c fMinRayStart)\r\n    { // ray starts from camera or inner radius sphere to far\r\n      rayStartT \x3d fMinRayStart;\r\n#ifndef HAZE\r\n      // clamp to value at inner radius altitude\r\n      fDistance \x3d fScale * min(0.0, fInnerRadius - fCameraHeight);\r\n#endif\r\n    }\r\n#ifndef HAZE\r\n    else\r\n    { // outside atmosphere\r\n      fDistance \x3d -1.0;\r\n    }\r\n#endif\r\n\r\n    // Initialize the scattering loop variables\r\n    vec3 v3Start \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n\r\n#ifdef HAZE\r\n    vec3 v3End \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n\r\n    float fEndLength \x3d length(v3End);\r\n    float fAltitudeEnd \x3d fEndLength - fInnerRadius;\r\n    float fAltitudeStart \x3d length(v3Start) - fInnerRadius;\r\n\r\n    // for camera positions below altitude 0, invert the altitudes, to achieve\r\n    // a similar haze as above ground. Note that there is a small but visible change\r\n    // when the camera passes altitude 0.\r\n    if (fAltitudeStart \x3c 0.0) {\r\n      fAltitudeStart \x3d -fAltitudeStart;\r\n      fAltitudeEnd \x3d -fAltitudeEnd;\r\n    }\r\n\r\n    // computed for the original end point to get consistent light angles after possible inversions\r\n    float fLightAngle \x3d dot(v3LightDir, v3End) / fEndLength;\r\n\r\n    if (nearT \x3e farT)\r\n    {\r\n      if (fAltitudeStart \x3c fAltitudeEnd)\r\n      {\r\n        // Switch positive slopes for flipped rays\r\n        v3End \x3d cameraPosition + worldSpaceRay * rayStartT;\r\n        v3Start \x3d cameraPosition + worldSpaceRay * rayEndT;\r\n        worldSpaceRay *\x3d -1.0;\r\n        float fTmp \x3d fAltitudeStart;\r\n        fAltitudeStart \x3d fAltitudeEnd;\r\n        fAltitudeEnd \x3d fTmp;\r\n      }\r\n      else if (fAltitudeStart \x3d\x3d fAltitudeEnd)\r\n      { // create minuscule fake slope for integration if the slope is zero\r\n        fAltitudeStart +\x3d 1.0; //BUGFIX, if the height of camera and ground is equal the equation breaks, add fake meter to camera height to get\r\n        // slope for the camera function\r\n      }\r\n    }\r\n\r\n    // Calculate its scattering offset\r\n    // Assumes camera constrains of WSV 3.8\r\n    float fCameraDepth;\r\n    float fCameraDepthBlue;\r\n    if (fAltitudeStart \x3e fOuterRadius - fInnerRadius)\r\n    { // outside atmosphere\r\n      fDistance \x3d fInnerRadius - fOuterRadius;\r\n    } else\r\n    {\r\n      fDistance \x3d fAltitudeEnd - fAltitudeStart;\r\n    }\r\n\r\n#endif\r\n    vec2 v2OpticalStartDepth \x3d exp(fDistance * v2OneOverScaleDepth);\r\n\r\n    float fRayLength \x3d rayEndT - rayStartT;\r\n    float fSampleLength \x3d fRayLength / fSamples;\r\n    float fScaledLength \x3d fSampleLength * fScale;\r\n    vec3 v3SampleRay \x3d worldSpaceRay * fSampleLength;\r\n    vec3 v3SamplePoint \x3d v3Start + v3SampleRay * 0.5;\r\n\r\n#ifdef HAZE\r\n    float fCameraAngle \x3d dot(-worldSpaceRay, v3End) / length(v3End);\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth;\r\n\r\n    float scaledValues \x3d scale(fLightAngle) + fScaleCameraAngle;\r\n    vec2 v2ScaledValuesDepth \x3d scaledValues * v2ScaleDepth;\r\n#else\r\n    float fCameraAngle \x3d dot(worldSpaceRay, v3Start / length(v3Start));\r\n    float angleMultiplier \x3d fCameraAngle\x3e0.0?fCameraAngle:0.0;\r\n\r\n    float fScaleCameraAngle \x3d scale(fCameraAngle);\r\n    vec2 v2CameraOffset \x3d fScaleCameraAngle*v2OpticalStartDepth * v2ScaleDepth;\r\n#endif\r\n\r\n    // Loop variables\r\n    vec3 v3FrontColor \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3FrontColorBlue \x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3Attenuate\x3d vec3(0.0, 0.0, 0.0);\r\n    vec3 v3AttenuateBlue \x3d vec3(0.0, 0.0, 0.0);\r\n\r\n    // Now loop through the sample rays\r\n    for(int i\x3d0; i\x3cmaxSamples; i++) {\r\n      float fHeight \x3d length(v3SamplePoint);\r\n      float fAltitude \x3d abs(fHeight - fInnerRadius);\r\n\r\n      vec2 v2Depth \x3d exp(-fAltitude * v2ScaleOverScaleDepth);\r\n#ifdef HAZE\r\n      vec2 v2Scatter \x3d v2Depth*v2ScaledValuesDepth-v2CameraOffset;\r\n#else\r\n      float fLightAngle \x3d dot(v3LightDir, v3SamplePoint) / fHeight;\r\n      float fCameraAngle \x3d dot(worldSpaceRay, v3SamplePoint) / fHeight;\r\n      float fTempScaledValues \x3d scale(fLightAngle) - scale(fCameraAngle);\r\n      vec2 v2Scatter \x3d v2CameraOffset + fTempScaledValues*v2Depth* v2ScaleDepth;\r\n#endif\r\n      v3Attenuate \x3d exp(-v2Scatter.x * v3InvWavelengthScaled);\r\n      v3AttenuateBlue \x3d exp(-v2Scatter.y * v3InvWavelengthScaled);\r\n\r\n      v3FrontColor +\x3d v3Attenuate * v2Depth.x;\r\n      v3FrontColorBlue +\x3d v3AttenuateBlue * v2Depth.y;\r\n\r\n      v3SamplePoint +\x3d v3SampleRay;\r\n    }\r\n\r\n    // Phase computation\r\n    // clamp to avoid numerical instability at fCos \x3d\x3d -1.0 (and close values) to display fake sun\r\n    float fCos \x3d clamp(dot(v3LightDir, -worldSpaceRay ),-0.9999999,1.0);\r\n    float fOnePlusCos2 \x3d fCos*fCos + 1.0;\r\n#ifdef HAZE\r\n    // Finally, scale the Rayleigh colors and set up the varying variables for the pixel shader\r\n    vec3 colorCoefficients \x3d (fScaledLength* 0.75 * fOnePlusCos2)*(fKrESun*v3InvWavelength+fKmESun);\r\n\r\n    // Scaled Length is only applied afterwards to save multiplications\r\n    vec3 v3Color \x3d colorCoefficients *v3FrontColor;\r\n    vec3 v3ColorBlue \x3d colorCoefficients *v3FrontColorBlue;\r\n#else\r\n    vec3 v3RayleighCoefficients \x3d (fScaledLength*0.75 * fOnePlusCos2*fKrESun)*v3InvWavelength;\r\n    float fMieCoefficients \x3d fScaledLength*fKmESun * fMiePhaseCoefficients * fOnePlusCos2 / pow(1.0 + g2 - 2.0*g*fCos, 1.5);\r\n\r\n    // Calculate the attenuation factor for the ground\r\n    vec3 v3Color \x3d v3RayleighCoefficients * v3FrontColor + fMieCoefficients * v3FrontColor;\r\n    vec3 v3ColorBlue \x3d v3RayleighCoefficients * v3FrontColorBlue + fMieCoefficients * v3FrontColorBlue;\r\n#endif\r\n\r\n    // HDR to LDR conversion\r\n    vec3 ldrBlue \x3d expTM(v3ColorBlue,2.0*fExposure);\r\n    vec3 ldrRed \x3d expTM(v3Color,fExposure);\r\n\r\n    // mix reddish and blueish atmosphere\r\n    vec3 LDR \x3d mix(ldrBlue,ldrRed,0.2);\r\n#ifdef HAZE\r\n    LDR *\x3d (1.0-fCameraAngle);\r\n    vec3 hsv \x3d rgb2hsv(LDR);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost haze saturation by 50%\r\n    LDR \x3d hsv2rgb(hsv);\r\n    vec3 finalColor \x3d LDR;\r\n    // when rendering we specify the blend functions such that\r\n    // newDestColor \x3d oldDestColor*(1.0-finalColor) + finalColor\r\n#else\r\n    // reinhard tonemapper for looking upwards\r\n    vec3 ldrReinhard \x3d reinhardTM(v3Color,fExposure);\r\n    LDR +\x3d angleMultiplier*ldrReinhard;\r\n\r\n    // height dependent parameter to smooth out reddish atmosphere\r\n    float side \x3d (rayEndT+rayStartT)*0.5;\r\n    float atmoHeight \x3d sqrt(fCameraHeight2 - side*side);\r\n    float h2 \x3d clamp(1.0-(atmoHeight-fLowerAlphaBlendBound)/(fOuterRadius-fLowerAlphaBlendBound),0.0,1.0);\r\n\r\n    vec3 finalColor \x3d LDR*h2;\r\n    vec3 hsv \x3d rgb2hsv(finalColor);\r\n    hsv.y \x3d clamp(hsv.y*1.5,0.0,1.0); // boost sky saturation by 50%\r\n    finalColor \x3d hsv2rgb(hsv);\r\n#endif\r\n\r\n#ifndef HAZE\r\n    float atmosStrength \x3d clamp((length(ldrRed)-0.05)*1.05,0.0,1.0);\r\n    gl_FragColor \x3d vec4(finalColor, atmosStrength*clamp(1.0-(atmoHeight-fInnerRadius)/(fOuterRadius-fInnerRadius),0.0,1.0));\r\n    if (fSurfaceBlend \x3e 0.0) {\r\n      gl_FragColor \x3d mix(gl_FragColor, surfaceColor, fSurfaceBlend);\r\n    }\r\n#else\r\n    gl_FragColor \x3d vec4(finalColor, 1.0) * altitudeAlpha;\r\n#endif\r\n\r\n    // Debug variable overlay\r\n    if(showTest\x3e0.0){\r\n      gl_FragColor \x3d vec4(test,1.0);\r\n    }\r\n  } else { // Outside Atmosphere\r\n    gl_FragColor \x3d vec4(0.0);\r\n  }\r\n}\r\n",
"realisticAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n// Camera\r\nuniform vec2 halfSizeNearPlane;\r\nuniform vec3 v3CameraUp;\r\nuniform vec3 v3CameraRight;\r\nuniform vec3 v3CameraDir;\r\nuniform vec2 v2CameraCenterOffset;\r\n\r\n// Attributes\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\n// Varyings\r\nvarying vec3 v3WorldRay;\r\nvarying vec2 vtc;\r\n\r\n#ifdef HAZE\r\nvarying vec3 v3EyeDir;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec3 v3Pos \x3d position;\r\n  vtc \x3d uv0;\r\n  vec2 rayvtc \x3d uv0 - v2CameraCenterOffset;\r\n\r\n#ifdef HAZE\r\n  v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#else\r\n  vec3 v3EyeDir \x3d vec3((2.0*halfSizeNearPlane *rayvtc)-halfSizeNearPlane,-1.0);\r\n#endif\r\n  v3WorldRay \x3d v3EyeDir.z*v3CameraDir + v3EyeDir.y*v3CameraUp + v3EyeDir.x*v3CameraRight;\r\n  gl_Position \x3d vec4(v3Pos, 1.0);\r\n}\r\n",
"simpleAtmosphere.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\n#ifndef PANORAMIC\r\nuniform float altitudeFade;\r\nvarying float innerFactor;\r\n#endif\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n\r\n#ifdef PANORAMIC\r\n  gl_FragColor \x3d texColor * falloff;\r\n#else\r\n  vec4 atmosphereColor \x3d texColor * falloff;\r\n  vec4 innerColor \x3d vec4(texColor.rgb * falloff, 1.0 - altitudeFade);\r\n  gl_FragColor \x3d mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));\r\n#endif\r\n}\r\n",
"simpleAtmosphere.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\n\r\n#ifndef PANORAMIC\r\nconst float TWICEPI \x3d 2.0*3.14159265;\r\nconst float ATMOSPHERE_RIM_SEGMENTS \x3d 128.0;\r\n\r\nuniform vec3 silCircleCenter;\r\nuniform vec3 silCircleV1;\r\nuniform vec3 silCircleV2;\r\nuniform vec2 texV;\r\n\r\nuniform float innerScale;  // scale for inner rim\r\nvarying float innerFactor; // 0: outer atmosphere, 1: inner atmosphere\r\n#endif\r\n\r\nuniform vec3 lightDirection;\r\n\r\nattribute vec3 position;\r\nvarying vec2 vtc;\r\nvarying float falloff;\r\n\r\nvoid main(void) {\r\n\r\n#ifdef PANORAMIC\r\n\r\n  vec3 pos \x3d position;\r\n  float ndotl \x3d lightDirection.z;\r\n  vtc \x3d vec2(0, position.z+0.05);\r\n\r\n#else\r\n\r\n  innerFactor \x3d clamp(-position.z, 0.0, 1.0);\r\n  float scale \x3d position.y * (1.0 + innerFactor * innerScale);\r\n  float phi \x3d position.x * (TWICEPI / ATMOSPHERE_RIM_SEGMENTS) + 1.0;\r\n  vec3 pos \x3d  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;\r\n  float ndotl \x3d dot(normalize(position.y \x3e 0.0 ? pos: silCircleCenter), lightDirection);\r\n\r\n  vtc.x \x3d position.x / ATMOSPHERE_RIM_SEGMENTS;\r\n  vtc.y \x3d texV.x * (1.0 - position.z) + texV.y * position.z;\r\n\r\n#endif\r\n\r\n  falloff \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  gl_Position \x3d proj * view * vec4(pos, 1.0);\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n}\r\n",
"simpleAtmosphereFade.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","simpleAtmosphereFade.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 cameraPosition;\r\n\r\nuniform float undergroundFadeAlpha;\r\n\r\nvarying vec4 color;\r\n\r\nvoid main(void) {\r\n  float ndotl \x3d dot(normalize(cameraPosition), lightDirection);\r\n  float lighting \x3d max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));\r\n\r\n  color \x3d vec4(vec3(lighting), undergroundFadeAlpha);\r\n\r\n  gl_Position \x3d vec4(position.xy, 1.0, 1.0); // on the far plane\r\n}\r\n",
"stars.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main() {\r\n  float cap \x3d 0.7;\r\n  float scale \x3d 1.0/cap;\r\n  float helper \x3d clamp(length(abs(gl_PointCoord-vec2(0.5))),0.0,cap);\r\n  float alpha \x3d clamp((cap-helper)*scale,0.0,1.0);\r\n  float intensity \x3d alpha*alpha*alpha;\r\n  if (vsize \x3c 3.0)\r\n    intensity *\x3d 0.5;\r\n  gl_FragColor \x3d vec4(1.0,1.0,1.0,intensity);\r\n  gl_FragColor.xyz *\x3d vcolor.xyz;\r\n}\r\n",
"stars.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\nuniform vec4 viewport;\r\nuniform float pixelRatio;\r\n\r\nattribute vec3 position;\r\nattribute vec4 color;\r\nattribute float size;\r\n\r\nvarying vec4 vcolor;\r\nvarying float vsize;\r\n\r\nvoid main(void) {\r\n  vec4 posProj \x3d proj * view * model*vec4(position*1.0e25,1.0);//move infinitely far away\r\n  gl_Position \x3d alignToPixelCenter(posProj, viewport.zw); //pixel align position\r\n  gl_Position.z \x3d gl_Position.w; // project atmosphere onto the far plane\r\n  vcolor \x3d color / 1.2;\r\n  vsize \x3d size * 5.0 * pixelRatio;\r\n  gl_PointSize \x3d vsize;\r\n}\r\n"},
materials:{checkerBoard:{"checkerBoard.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec2 size;\r\nuniform vec4 color1;\r\nuniform vec4 color2;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main() {\r\n  vec2 uvScaled \x3d vUV / (2.0 * size);\r\n\r\n  vec2 uv \x3d fract(uvScaled - 0.25);\r\n  vec2 ab \x3d clamp((abs(uv - 0.5) - 0.25) / fwidth(uvScaled), -0.5, 0.5);\r\n  float fade \x3d smoothstep(0.25, 0.5, max(fwidth(uvScaled.x), fwidth(uvScaled.y)));\r\n  float t \x3d mix(abs(ab.x + ab.y), 0.5, fade);\r\n\r\n  gl_FragColor \x3d mix(color2, color1, t);\r\n}\r\n",
"checkerBoard.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vUV;\r\n\r\nvoid main(void) {\r\n  vUV \x3d uv0;\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n"},color:{"color.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\n#ifdef VERTEX_COLORS\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef VERTEX_COLORS\r\n  gl_FragColor \x3d vColor * eColor;\r\n#else\r\n  gl_FragColor \x3d eColor;\r\n#endif\r\n}\r\n",
"color.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n#ifdef VERTEX_COLORS\r\nattribute vec4 color;\r\n\r\nvarying vec4 vColor;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef VERTEX_COLORS\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255;\r\n#endif\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},
defaultMaterial:{"colorMixMode.glsl":"#include \x3cutil/color.glsl\x3e\r\n\r\n/*\r\n * The color mix modes are encoded in the symbol color as follows:\r\n *  - Fully transparent symbols are represented with alpha 0 for\r\n *    all color mix modes (except ignore).\r\n *  - color mix mode ignore is encoded as multiply with white\r\n *  - the other 3 color mix modes (tint, replace, multiply) are\r\n *    equally distributed on the remaining 255 alpha values, which\r\n *    gives us 85 possible alpha values\r\n *\r\n * alpha             0 : fully transparent\r\n * alpha in [  1 -  85]: tint\r\n * alpha in [ 86 - 170]: replace\r\n * alpha in [171 - 255]: multiply\r\n */\r\nvec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {\r\n  float symbolAlpha \x3d 0.0;\r\n\r\n  const float maxTint \x3d 85.0;\r\n  const float maxReplace \x3d 170.0;\r\n  const float scaleAlpha \x3d 3.0;\r\n\r\n  if (symbolColor.a \x3d\x3d 0.0) {\r\n    colorMixMode \x3d 1; // fully transparent -\x3e multiply\r\n    symbolAlpha \x3d 0.0;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxTint) {\r\n    colorMixMode \x3d 0; // tint\r\n    symbolAlpha \x3d scaleAlpha * symbolColor.a;\r\n  }\r\n  else if (symbolColor.a \x3c\x3d maxReplace) {\r\n    colorMixMode \x3d 3; // replace\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxTint);\r\n  }\r\n  else {\r\n    colorMixMode \x3d 1;  // multiply\r\n    symbolAlpha \x3d scaleAlpha * (symbolColor.a - maxReplace);\r\n  }\r\n\r\n  return vec4(symbolColor.rgb, symbolAlpha);\r\n}\r\n\r\nvec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  vec3 internalMixed \x3d internalColor * textureColor;\r\n  vec3 allMixed \x3d internalMixed * externalColor;\r\n\r\n  if (mode \x3d\x3d 1 /* multiply */) {\r\n    return allMixed;\r\n  }\r\n  else if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalColor;\r\n  }\r\n  else {\r\n    // tint (or something invalid)\r\n    vec3 hsvIn \x3d rgb2hsv(internalMixed);\r\n    vec3 hsvTint \x3d rgb2hsv(externalColor);\r\n    vec3 hsvOut \x3d vec3(hsvTint.x, hsvTint.y, hsvIn.z * hsvTint.z);\r\n    return hsv2rgb(hsvOut);\r\n  }\r\n}\r\n\r\nfloat mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {\r\n\r\n  // workaround for artifacts in OSX using Intel Iris Pro\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475\r\n  float internalMixed \x3d internalOpacity * textureOpacity;\r\n  float allMixed \x3d internalMixed * externalOpacity;\r\n\r\n  if (mode \x3d\x3d 2 /* ignore */ ) {\r\n    return internalMixed;\r\n  }\r\n  else if (mode \x3d\x3d 3 /* replace */ ) {\r\n    return externalOpacity;\r\n  }\r\n  else {\r\n    // multiply or tint (or something invalid)\r\n    return allMixed;\r\n  }\r\n}\r\n",
"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n// material parameters\r\n//////////////////////////////////////////\r\nuniform vec3 ambient;\r\nuniform vec3 diffuse;\r\nuniform vec3 specular;\r\nuniform float opacity;\r\nuniform float layerOpacity;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#else\r\nuniform int colorMixMode;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\n#endif\r\n\r\n#ifdef RECEIVE_SSAO\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\n#endif\r\n\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\nvarying vec4 vcolorExt;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#include \x3cutil/shadow.glsl\x3e\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  vec4 texColor \x3d textureLookup(tex, vtc);\r\n\r\n  if (texColor.a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#else /* TEXTURING */\r\n  vec4 texColor \x3d vec4(1,1,1,1);\r\n#endif /* TEXTURING */\r\n\r\n  vec3 viewDir \x3d vpos - camPos;\r\n\r\n  // compute normal\r\n  // TODO: this is not in sync with the normal pass\r\n#ifdef GROUND_NORMAL_SHADING\r\n#ifdef VIEWING_MODE_GLOBAL\r\n  vec3 normal \x3d normalize(vpos + localOrigin);\r\n#else\r\n  vec3 normal \x3d vec3(0,0,1);\r\n#endif\r\n#else\r\n#ifdef DOUBLESIDED\r\n  vec3 normal \x3d dot(vnormal, viewDir)\x3e0.0 ? -vnormal : vnormal;\r\n#elif defined(WINDINGORDERDOUBLESIDED)\r\n  vec3 normal \x3d gl_FrontFacing ? vnormal : -vnormal;\r\n#else\r\n  vec3 normal \x3d vnormal;\r\n#endif\r\n  normal \x3d normalize(normal);\r\n#endif\r\n\r\n  // compute ssao\r\n#ifdef RECEIVE_SSAO\r\n  float ssao \x3d texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  ssao \x3d viewportPixelSz.z \x3c 0.0 ? 1.0 : ssao;\r\n#else\r\n  float ssao \x3d 1.0;\r\n#endif\r\n\r\n  // At global scale we create some additional ambient light based on the main light to simulate global illumination\r\n  float additionalAmbientScale;\r\n  vec3 additionalLight \x3d sceneLightingAdditionalLightGlobal(vpos + localOrigin, ssao, additionalAmbientScale);\r\n\r\n  // compute shadowing\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#elif defined(VIEWING_MODE_GLOBAL)\r\n  // at global scale (and in global scenes) we fall back to this approximation\r\n  // to shadow objects on the dark side of the earth\r\n  shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);\r\n#endif\r\n\r\n  vec3 matColor \x3d max(ambient, diffuse); // combine the old material parameters into a single one\r\n#if defined(VERTEXCOLORS)\r\n  // Internal colors: varying vcolor + uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(vcolor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(vcolor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#else\r\n  // Internal colors: uniform ambient/diffuse, external colors: varying vcolorExt\r\n  vec3 albedo_ \x3d mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));\r\n  float opacity_ \x3d layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));\r\n#endif\r\n  albedo_+\x3d 0.25 * specular; // don't completely ignore specular for now\r\n\r\n#ifdef TRANSPARENCY_DISCARD\r\n  if (opacity_ \x3c 0.001) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 shadedColor \x3d evaluateSceneLighting(normal, albedo_, shadow, 1.0 - ssao, additionalLight);\r\n  gl_FragColor \x3d vec4(shadedColor, opacity_);\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\n#ifdef INSTANCEDCOLOR\r\nattribute vec4 instanceColor;\r\n#endif\r\nattribute vec3 position;\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\nvarying vec3 vpos;\r\nvarying vec3 vnormal;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef COMPONENTCOLORS\r\nuniform sampler2D uComponentColorTex;\r\nuniform vec2 uComponentColorTexInvDim;\r\n\r\nattribute float componentIndex;\r\n\r\nvec4 readComponentColor() {\r\n  float normalizedIndex \x3d (componentIndex + 0.5) * uComponentColorTexInvDim.x;\r\n  vec2 indexCoord \x3d vec2(\r\n    mod(normalizedIndex, 1.0),\r\n    (floor(normalizedIndex) + 0.5) * uComponentColorTexInvDim.y\r\n  );\r\n  return texture2D(uComponentColorTex, indexCoord);\r\n}\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\nattribute vec4 color;\r\n#endif\r\n\r\n#ifdef SYMBOLVERTEXCOLORS\r\nattribute vec4 symbolColor;\r\n#endif\r\n\r\n#if defined(VERTEXCOLORS)\r\nvarying vec4 vcolor;\r\n#endif\r\n\r\n// Workaround for https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/13452\r\n// We pass the externalColor uniform from VS to FS through the vcolorExt varying because\r\n// there is a driver bug for Intel Integrated Graphics which led to rendering artifacts\r\n// since the introduction of https://devtopia.esri.com/WebGIS/arcgis-js-api/pull/12673\r\n// This should be further cleaned up later with through the following issue:\r\n// https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/12763\r\nuniform vec4 externalColor;\r\nvarying vec4 vcolorExt;\r\n\r\n#if defined(SYMBOLVERTEXCOLORS) || defined(COMPONENTCOLORS)\r\nvarying mediump float colorMixMode; // varying int is not supported in WebGL\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_SIZE) || defined(VV_COLOR)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/colorMixMode.glsl\x3e\r\n\r\nvoid main() {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vnormal \x3d normalize(modelNormal * localNormal().xyz);\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  vnormal \x3d normalize((modelNormal * localNormal()).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n#ifdef VERTEXCOLORS\r\n  vcolor \x3d color * 0.003921568627451; // \x3d 1/255\r\n#endif\r\n\r\n  vcolorExt \x3d externalColor;\r\n\r\n#ifdef INSTANCEDCOLOR\r\n  vcolorExt *\x3d instanceColor;\r\n#endif\r\n#ifdef VV_COLOR\r\n  vcolorExt *\x3d vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);\r\n#endif\r\n#ifdef SYMBOLVERTEXCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n#ifdef COMPONENTCOLORS\r\n  int symbolColorMixMode;\r\n  vcolorExt *\x3d decodeSymbolColor(readComponentColor() * 255.0, symbolColorMixMode) * 0.003921568627451; // \x3d 1/255;\r\n  colorMixMode \x3d float(symbolColorMixMode) + 0.5; // add 0.5 to avoid interpolation artifacts\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"commonFunctions.glsl":"#include \x3cmaterials/defaultMaterial/localPosition.glsl\x3e\r\n#include \x3cutil/doublePrecision.glsl\x3e\r\n\r\nvec3 calculateVPos() {\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  return model * localPosition().xyz;\r\n#else\r\n  return (model * localPosition()).xyz;\r\n#endif\r\n}\r\n\r\n#ifdef VERTICAL_OFFSET\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#endif\r\n\r\nvec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {\r\n  float viewDistance \x3d length((view * vec4(worldPos, 1)).xyz);\r\n  float verticalOffsetOffsetDistance \x3d verticalOffset.x * viewDistance;\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n  vec3 worldNormal \x3d normalize(worldPos + localOrigin);\r\n#else\r\n  vec3 worldNormal \x3d vec3(0, 0, 1);\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float cosAngle \x3d dot(worldNormal, normalize(worldPos - camPos));\r\n\r\n  float verticalOffsetScreenHeight \x3d screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);\r\n\r\n  return worldNormal * worldOffset;\r\n}\r\n#endif\r\n",
"commonInputs.glsl":"uniform mat4 proj;\r\nuniform mat4 view;\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nuniform vec3 viewOriginHi;\r\nuniform vec3 viewOriginLo;\r\n#endif\r\nuniform vec3 camPos;\r\nuniform vec3 localOrigin;\r\n\r\n#ifdef INSTANCED\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\nattribute vec3 modelOriginHi;\r\nattribute vec3 modelOriginLo;\r\nattribute mat3 model;\r\nattribute mat3 modelNormal;\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\nattribute mat4 model;\r\nattribute mat4 modelNormal;\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n#else /* INSTANCED */\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n#endif /* INSTANCED */\r\n\r\n#ifdef VERTICAL_OFFSET\r\n// [ verticalOffsetPerDistance, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n#endif\r\n#endif\r\n",
"depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n",
"depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform vec2 nearFar;\r\nattribute vec3 position;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1);\r\n\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nattribute vec3 position;\r\n\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"localCenter.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vvTransformPosition(vec3(0, 0, 0), instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef VERTICAL_OFFSET\r\nvec4 localCenter() { return vec4(vec3(0, 0, 0), 1.0); }\r\n# endif\r\n#endif\r\n","localNormal.glsl":"#include \x3cutil/normalEncoding.glsl\x3e\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vvTransformNormal(decodeNormal(normalCompressed), instanceFeatureAttribute); }\r\n# else\r\nvec4 localNormal() { return vvTransformNormal(normal, instanceFeatureAttribute); }\r\n# endif\r\n#else\r\n# ifdef COMPRESSED_NORMALS\r\nvec4 localNormal() { return vec4(decodeNormal(normalCompressed), 1.0); }\r\n# else\r\nvec4 localNormal() { return vec4(normal, 1.0); }\r\n# endif\r\n#endif\r\n",
"localPosition.glsl":"#ifdef VV_CUSTOM_MODEL_MATRIX\r\nvec4 localPosition() { return vvTransformPosition(position, instanceFeatureAttribute); }\r\n#else\r\nvec4 localPosition() { return vec4(position, 1.0); }\r\n#endif\r\n","normalPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#ifdef TEXTURING\r\nuniform sampler2D tex;\r\nuniform vec2 texSize;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\n#ifdef TEXTURING\r\n#include \x3cmaterials/defaultMaterial/texturing.glsl\x3e\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef TEXTURING\r\n  if (textureLookup(tex, vtc).a * coverageCorrectionFactor(vtc) \x3c ALPHA_THRESHOLD) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n",
"normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\n#include \x3cmaterials/defaultMaterial/commonInputs.glsl\x3e\r\n\r\nuniform mat4 viewNormal;\r\nattribute vec3 position;\r\n#ifdef COMPRESSED_NORMALS\r\nattribute vec2 normalCompressed;\r\n#else\r\nattribute vec3 normal;\r\n#endif\r\n\r\n#ifdef TEXTURING\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n#ifdef TEXTURE_ATLAS\r\nattribute vec4 region;\r\nvarying vec4 regionV;\r\n#endif\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\n#if defined(VV_CUSTOM_MODEL_MATRIX)\r\nattribute vec4 instanceFeatureAttribute;\r\n#endif\r\n\r\n#include \x3cmaterials/defaultMaterial/commonFunctions.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localCenter.glsl\x3e\r\n#include \x3cmaterials/defaultMaterial/localNormal.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vpos \x3d calculateVPos();\r\n\r\n#ifdef INSTANCED_DOUBLE_PRECISION\r\n  vpos +\x3d modelOriginHi;\r\n  vnormal \x3d normalize((viewNormal * vec4(modelNormal * localNormal().xyz, 1.0)).xyz);\r\n\r\n  vec3 originDelta \x3d dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);\r\n  vpos -\x3d originDelta;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d model * localCenter().xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#else /* INSTANCED_DOUBLE_PRECISION */\r\n  vnormal \x3d normalize((viewNormal * modelNormal * localNormal()).xyz);\r\n\r\n#ifdef VERTICAL_OFFSET\r\n  vec3 centerPos \x3d (model * localCenter()).xyz;\r\n  vpos +\x3d calculateVerticalOffset(centerPos, localOrigin);\r\n#endif\r\n#endif /* INSTANCED_DOUBLE_PRECISION */\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1);\r\n\r\n#ifdef TEXTURING\r\n#ifndef FLIPV\r\n  vtc \x3d uv0;\r\n#else\r\n  vtc \x3d vec2(uv0.x, 1.0-uv0.y);\r\n#endif\r\n#ifdef TEXTURE_ATLAS\r\n  regionV \x3d region;\r\n#endif\r\n#endif /* TEXTURING */\r\n\r\n}\r\n",
"texturing.glsl":"float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {\r\n  // from:\r\n  //   - OpenGLES Common Profile Specification Version 2.0.25, Section 3.7.7 - Texture Minification\r\n  //   - https://www.opengl.org/discussion_boards/showthread.php/171485-Texture-LOD-calculation-(useful-for-atlasing)\r\n  //   - http://www.linedef.com/virtual-texture-demo.html\r\n  float deltaMaxSqr \x3d max(dot(ddx, ddx), dot(ddy, ddy));\r\n  return max(0.0, 0.5 * log2(deltaMaxSqr));\r\n}\r\n\r\n// based on https://medium.com/@bgolus/anti-aliased-alpha-test-the-esoteric-alpha-to-coverage-8b177335ae4f\r\nfloat coverageCorrectionFactor(vec2 uv) {\r\n#ifdef ALPHA_COVERAGE_CORRECTION\r\n  const float MipScale \x3d 0.25;\r\n  uv *\x3d texSize;\r\n#ifdef TEXTURE_ATLAS\r\n  uv *\x3d region.zw - region.xy;\r\n#endif\r\n  return 1.0 + max(0.0, calcMipMapLevel(dFdx(uv), dFdy(uv))) * MipScale;\r\n#else\r\n  return 1.0;\r\n#endif\r\n}\r\n\r\n#ifdef ALPHA_COVERAGE_CORRECTION\r\n  #define ALPHA_THRESHOLD 0.5\r\n#else\r\n  #define ALPHA_THRESHOLD 0.33\r\n#endif\r\n\r\nvec4 textureAtlasLookup(sampler2D tex, vec2 uv, vec4 region, vec2 texSize) {\r\n  //[umin, vmin, umax, vmax]\r\n  vec2 atlasScale \x3d region.zw - region.xy;\r\n  vec2 uvAtlas \x3d fract(uv) * atlasScale + region.xy;\r\n\r\n  vec4 texColor;\r\n\r\n  // calculate derivative of continuous texture coordinate\r\n  // to avoid mipmapping artifacts caused by manual wrapping in shader\r\n  vec2 dUVdx \x3d dFdx(uv) * atlasScale;\r\n  vec2 dUVdy \x3d dFdy(uv) * atlasScale;\r\n\r\n#ifdef GL_EXT_shader_texture_lod\r\n  return texture2DGradEXT(tex, uvAtlas, dUVdx, dUVdy);\r\n#else\r\n  // use bias to compensate for difference in automatic vs desired mipmap level\r\n  vec2 dUVdxAuto \x3d dFdx(uvAtlas);\r\n  vec2 dUVdyAuto \x3d dFdy(uvAtlas);\r\n  float mipMapLevel \x3d calcMipMapLevel(dUVdx * texSize, dUVdy * texSize);\r\n  float autoMipMapLevel \x3d calcMipMapLevel(dUVdxAuto * texSize, dUVdyAuto * texSize);\r\n\r\n  return texture2D(tex, uvAtlas, mipMapLevel - autoMipMapLevel);\r\n#endif\r\n}\r\n\r\nvec4 textureLookup(sampler2D tex, vec2 uv) {\r\n#ifdef TEXTURE_ATLAS\r\n  return textureAtlasLookup(tex, uv, regionV, texSize);\r\n#else\r\n  return texture2D(tex, uv);\r\n#endif\r\n}\r\n\r\n"},
hud:{"colorPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n}\r\n","highlightPass.frag":"#include \x3cmaterials/hud/hudHeader.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n#include \x3cmaterials/hud/hudMain.glsl\x3e\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\n  // Instead of deciding on a per-pixel basis if the highlight is occluded,\r\n  // do it for all highlight pixel based on the centroid occlusion. This\r\n  // is a temporary solution for:\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/9645\r\n  if (voccluded \x3d\x3d 1.0) {\r\n    gl_FragColor \x3d vec4(1.0, 1.0, 0.0, 1.0);\r\n  } else {\r\n    gl_FragColor \x3d vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n#else\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n#endif\r\n}\r\n",
"hud.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/visualVariables.glsl\x3e\r\n\r\nuniform vec2 screenOffset;\r\nuniform vec2 anchorPos;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\nuniform vec4 screenSizePerspective;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\nattribute vec2 size;\r\nattribute vec4 auxpos2;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\nvoid main(void) {\r\n  ProjectHUDAux projectAux;\r\n  vec4 posProj \x3d projectPositionHUD(projectAux);\r\n\r\n  vec2 inputSize;\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  inputSize \x3d screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);\r\n\r\n  vec2 screenOffsetScaled \x3d screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n\r\n#else\r\n\r\n  inputSize \x3d size;\r\n\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n#ifdef VV_SIZE\r\n  // only use width (.xx) for proportional scaling\r\n  // (if no width was defined in vv, width\r\n  //  will be a copy of height vv)\r\n  inputSize *\x3d vvGetScale(auxpos2).xx;\r\n#endif\r\n\r\n  vec2 combinedSize \x3d inputSize * pixelRatio;\r\n  vec4 quadOffset \x3d vec4(0);\r\n\r\n#if defined(OCCL_TEST) || defined(BINARY_HIGHLIGHT_OCCLUSION)\r\n  bool visible \x3d testVisibilityHUD(posProj);\r\n#endif\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvoccluded \x3d visible ? 0.0 : 1.0;\r\n#endif\r\n\r\n#ifdef OCCL_TEST\r\n  if (visible) {\r\n#endif\r\n    // UV goes from 0 to 1.99999, where the integer part is used\r\n    // for the normalized vertex coordinates, and the fractional\r\n    // part is used for texture sampling\r\n    vec2 uv01 \x3d floor(uv0);\r\n    vec2 uv \x3d uv0 - uv01;\r\n\r\n    // Displace icon based on anchor position (normalized for size) and\r\n    // absolute screen offset. anchorPos is [-0.5, 0.5]\r\n    quadOffset.xy \x3d ((uv01 - anchorPos) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;\r\n\r\n#ifdef SIGNED_DISTANCE_FIELD\r\n\r\n    // SDF primitives might be scaled so that the SDF texture resolution does\r\n    // not match the resolution of the canvas, but we still want to render\r\n    // outline-only ('cross' and 'x') primitives cleanly. Aligning to a screen\r\n    // pixel border at the geometry center achieves this, since SDF textures\r\n    // always have power of 2 dimensions.\r\n    posProj \x3d alignToPixelOrigin(posProj, viewport.zw) + quadOffset;\r\n#else\r\n    posProj +\x3d quadOffset;\r\n\r\n    // Aligning vertex positions to the nearest (using 'floor') screen pixel\r\n    // border renders textures with pixel-perfect results. If the texture\r\n    // resolution does not match the canvas resolution then aligning is\r\n    // redundant.\r\n    if (inputSize.x \x3d\x3d size.x) {\r\n      posProj \x3d alignToPixelOrigin(posProj, viewport.zw);\r\n    }\r\n#endif\r\n\r\n    gl_Position \x3d posProj;\r\n\r\n    vtc \x3d uv;\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(uv01, 1.0 / combinedSize);\r\n#endif\r\n\r\n    vsize \x3d inputSize;\r\n#ifdef OCCL_TEST\r\n  } else {\r\n    vtc \x3d vec2(.0);\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n    debugBorderCoords \x3d vec3(0);\r\n#endif\r\n\r\n  }\r\n#endif\r\n\r\n  gl_Position \x3d posProj;\r\n\r\n#ifdef VV_COLOR\r\n  vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors);\r\n#else\r\n  vcolor \x3d color / 255.0;\r\n#endif\r\n}\r\n",
"hudHeader.glsl":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/color.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 overrideColor;\r\nuniform vec4 outlineColor;\r\nuniform float outlineSize;\r\n\r\nvarying vec4 vcolor;\r\n\r\nvarying vec2 vtc;\r\nvarying vec2 vsize;\r\n\r\n#ifdef BINARY_HIGHLIGHT_OCCLUSION\r\nvarying float voccluded;\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\nvarying vec3 debugBorderCoords;\r\n#endif\r\n",
"hudMain.glsl":"#ifdef SIGNED_DISTANCE_FIELD\r\n  vec4 color \x3d vec4(0.0, 0.0, 0.0, 0.0);\r\n  vec4 fillPixelColor \x3d overrideColor * vcolor;\r\n\r\n  // Attempt to sample texel centers to avoid that thin cross outlines\r\n  // disappear with large symbol sizes.\r\n  // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041\r\n  const float txSize \x3d 128.0;\r\n  const float texelSize \x3d 1.0 / txSize;\r\n  // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel\r\n  vec2 scaleFactor \x3d (vsize - txSize) * texelSize;\r\n  vec2 samplePos \x3d vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;\r\n\r\n  // Get distance and map it into [-0.5, 0.5]\r\n  float d \x3d rgba2float(texture2D(tex, samplePos)) - 0.5;\r\n\r\n  // Distance in output units (i.e. pixels)\r\n  float dist \x3d d * vsize.x;\r\n\r\n  // Create smooth transition from the icon into its outline\r\n  fillPixelColor.a *\x3d clamp(0.5 - dist, 0.0, 1.0);\r\n\r\n  if (outlineSize \x3e 0.25) {\r\n    vec4 outlinePixelColor \x3d outlineColor;\r\n    float clampedOutlineSize \x3d min(outlineSize, 0.5*vsize.x);\r\n\r\n    // Create smooth transition around outline\r\n    outlinePixelColor.a *\x3d clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);\r\n\r\n    // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)\r\n    float compositeAlpha \x3d outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n    vec3 compositeColor \x3d vec3(outlinePixelColor) * outlinePixelColor.a +\r\n      vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);\r\n\r\n    gl_FragColor \x3d vec4(compositeColor, compositeAlpha);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d premultiplyAlpha(fillPixelColor);\r\n  }\r\n\r\n  // visualize SDF:\r\n  // gl_FragColor \x3d vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);\r\n#else\r\n\r\n  // HUDMaterial is rendered with a blending mode that assumes a pre-multiplied\r\n  // fragment color. Input textures should already be pre-multiplied and so\r\n  // don't require adjustment, but the override and vertex colors must be\r\n  // modulated by their alpha values.\r\n\r\n  gl_FragColor \x3d texture2D(tex, vtc, -0.5) * premultiplyAlpha(overrideColor * vcolor);\r\n\r\n#endif\r\n\r\n#ifdef DEBUG_DRAW_BORDER\r\n   float isBorder \x3d float(any(lessThan(debugBorderCoords.xy, vec2(debugBorderCoords.z))) || any(greaterThan(debugBorderCoords.xy, vec2(1.0 - debugBorderCoords.z))));\r\n   gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), isBorder);\r\n#endif\r\n\r\n  if (gl_FragColor.a \x3c 0.1) {\r\n    discard;\r\n  }\r\n",
"occlusionTest.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","occlusionTest.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvoid main(void) {\r\n  vec4 posProjCenter;\r\n\r\n  // Check for special value of position (0, 0, 0) which is used by the Renderer when graphics\r\n  // are removed before the VBO is recompacted. If this is the case, then we just project outside\r\n  // of clip space.\r\n  if (dot(position, position) \x3e 0.0) {\r\n    // Render single point to center of the pixel to avoid subpixel filtering to affect\r\n    // the marker color\r\n    ProjectHUDAux projectAux;\r\n    vec4 posProj \x3d projectPositionHUD(projectAux);\r\n    posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n    vec3 vpos \x3d projectAux.posModel;\r\n    if (rejectBySlice(vpos)) {\r\n      // Project out of clip space\r\n      posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n    }\r\n  }\r\n  else {\r\n    // Project out of clip space\r\n    posProjCenter \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n  }\r\n\r\n  gl_Position \x3d posProjCenter;\r\n  gl_PointSize \x3d 1.0;\r\n}\r\n"},
lineCallout:{"lineCallout.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\nuniform vec4 borderColor;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main() {\r\n  // Mix between line and border coverage offsets depending on whether we need\r\n  // a border (based on the sidedness).\r\n  vec2 coverage \x3d min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);\r\n\r\n  // Mix between border and line color based on the line coverage (conceptually the line\r\n  // blends on top of the border background).\r\n  //\r\n  // Anti-alias by blending final result using the full (including optional border) coverage\r\n  // and the color alpha\r\n  float borderAlpha \x3d color.a * borderColor.a * coverage.y;\r\n  float colorAlpha \x3d color.a * coverage.x;\r\n\r\n  float finalAlpha \x3d mix(borderAlpha, 1.0, colorAlpha);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n  if (finalAlpha \x3c 0.01) {\r\n    discard;\r\n  }\r\n\r\n#else\r\n\r\n  // Compute the finalRgb, but keep it pre-multiplied (for unpre-multiplied you\r\n  // need to divide by finalAlpha). We avoid the division here by setting the\r\n  // appropriate blending function in the material.\r\n  vec3 finalRgb \x3d mix(borderColor.rgb * borderAlpha, color.rgb, colorAlpha);\r\n\r\n  gl_FragColor \x3d vec4(finalRgb, finalAlpha);\r\n\r\n#endif\r\n\r\n}\r\n",
"lineCallout.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cutil/alignPixel.glsl\x3e\r\n#include \x3cutil/hud.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nattribute vec2 uv0;\r\n\r\nuniform float lineSize;\r\nuniform vec2 pixelToNDC;\r\nuniform float borderSize;\r\nuniform vec2 screenOffset;\r\n\r\nvarying vec4 coverageSampling;\r\nvarying vec2 lineSizes;\r\n\r\nvoid main(void) {\r\n\r\n  ProjectHUDAux projectAux;\r\n  vec4 endPoint \x3d projectPositionHUD(projectAux);\r\n\r\n  vec3 vpos \x3d projectAux.posModel;\r\n  if (rejectBySlice(vpos)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\r\n    return;\r\n  }\r\n\r\n#ifdef OCCL_TEST\r\n  if (!testVisibilityHUD(endPoint)) {\r\n    gl_Position \x3d vec4(1e38, 1e38, 1e38, 1);\r\n    return;\r\n  }\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);\r\n  vec2 screenOffsetScaled \x3d applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);\r\n#else\r\n  vec2 screenOffsetScaled \x3d screenOffset;\r\n#endif\r\n\r\n  // Add view dependent polygon offset to get exact same original starting point. This is mostly\r\n  // used to get the correct depth value\r\n  vec3 posView \x3d (view * (model * vec4(position, 1.0))).xyz;\r\n  applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);\r\n\r\n  vec4 startPoint \x3d proj * vec4(posView, 1.0);\r\n\r\n  // Apply screen offset to both start and end point\r\n  vec2 screenOffsetNorm \x3d screenOffsetScaled * 2.0 / viewport.zw;\r\n\r\n  startPoint.xy +\x3d screenOffsetNorm * startPoint.w;\r\n  endPoint.xy +\x3d screenOffsetNorm * endPoint.w;\r\n\r\n  // Align start and end to pixel origin\r\n  vec4 startAligned \x3d alignToPixelOrigin(startPoint, viewport.zw);\r\n  vec4 endAligned \x3d alignToPixelOrigin(endPoint, viewport.zw);\r\n\r\n#ifdef DEPTH_HUD\r\n\r\n#ifdef DEPTH_HUD_ALIGN_START\r\n  endAligned \x3d vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);\r\n#else\r\n  startAligned \x3d vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);\r\n#endif\r\n\r\n#endif\r\n\r\n  vec4 projectedPosition \x3d mix(startAligned, endAligned, uv0.y);\r\n\r\n  // The direction of the line in screen space\r\n  vec2 screenSpaceDirection \x3d normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);\r\n  vec2 perpendicularScreenSpaceDirection \x3d vec2(screenSpaceDirection.y, -screenSpaceDirection.x);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n  float lineSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);\r\n  float borderSizeScaled \x3d applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);\r\n\r\n#else\r\n\r\n  float lineSizeScaled \x3d lineSize;\r\n  float borderSizeScaled \x3d borderSize;\r\n\r\n#endif\r\n\r\n  float halfPixelSize \x3d lineSizeScaled * 0.5;\r\n  // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned\r\n  // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,\r\n  // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel\r\n  // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).\r\n  float halfWholePixelSize \x3d floor(lineSizeScaled) * 0.5;\r\n  float halfPixelSizeInt \x3d floor(halfWholePixelSize);\r\n\r\n  // Sub-pixel offset if we need to grow sub-pixels to the left\r\n  float subpixelOffset \x3d -fract(lineSizeScaled) * float(halfWholePixelSize \x3e 0.0);\r\n\r\n  // Pixel offset aligning to whole pixels and adding subpixel offset if needed\r\n  float pixelOffset \x3d -halfPixelSizeInt + subpixelOffset;\r\n\r\n  // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size\r\n  float padding \x3d 1.0 + borderSizeScaled;\r\n  vec2 ndcOffset \x3d (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;\r\n\r\n  // Offset x/y from the center of the line in screen space\r\n  projectedPosition.xy +\x3d perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;\r\n\r\n  // Compute a coverage varying which we can use in the fragment shader to determine\r\n  // how much a pixel is actually covered by the line (i.e. to anti alias the line).\r\n  // This works by computing two coordinates that can be linearly interpolated and then\r\n  // subtracted to find out how far away from the line edge we are.\r\n  float edgeDirection \x3d (uv0.x * 2.0 - 1.0);\r\n\r\n  float halfBorderSize \x3d 0.5 * borderSizeScaled;\r\n  float halfPixelSizeAndBorder \x3d halfPixelSize + halfBorderSize;\r\n  float outerEdgeCoverageSampler \x3d edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);\r\n\r\n  float isOneSided \x3d float(lineSizeScaled \x3c 2.0 \x26\x26 borderSize \x3c 2.0);\r\n\r\n  coverageSampling \x3d vec4(\r\n    // Edge coordinate\r\n    outerEdgeCoverageSampler,\r\n\r\n    // Border edge coordinate\r\n    outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,\r\n\r\n    // Line offset\r\n    halfPixelSize - 0.5,\r\n\r\n    // Border offset\r\n    halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)\r\n  );\r\n\r\n  lineSizes \x3d vec2(lineSizeScaled, borderSizeScaled);\r\n\r\n  gl_Position \x3d projectedPosition;\r\n}\r\n"},
measurementArrow:{"measurementArrow.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform float outlineSize;\r\nuniform vec4 outlineColor;\r\nuniform float stripeLength;\r\nuniform vec4 stripeEvenColor;\r\nuniform vec4 stripeOddColor;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\n#define INV_SQRT2 (1.0 / sqrt(2.0))\r\n\r\nvec4 arrowColor(vec2 tc, float len) {\r\n  float d \x3d INV_SQRT2 * (tc.x - abs(tc.y));\r\n  d \x3d min(d, INV_SQRT2 * (len - tc.x - abs(tc.y)));\r\n  d \x3d min(d, 1.0 - abs(tc.y));\r\n\r\n  if (d \x3c 0.0) {\r\n    return vec4(0.0);\r\n  } else if (d \x3c outlineSize) {\r\n    return outlineColor;\r\n  } else {\r\n    return fract(0.5 / stripeLength * tc.x * vradius) \x3e\x3d 0.5 ? stripeOddColor : stripeEvenColor;\r\n  }\r\n}\r\n\r\nvoid main(void) {\r\n  vec2 ntc \x3d vec2(vtc.x / vradius, vtc.y);\r\n  vec4 color \x3d arrowColor(ntc, vlength / vradius);\r\n  if (color.a \x3d\x3d 0.0) {\r\n    discard;\r\n  }\r\n  gl_FragColor \x3d color;\r\n}\r\n",
"measurementArrow.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float width;\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec2 uv0;\r\nattribute float auxpos1;\r\n\r\nvarying vec2 vtc;\r\nvarying float vlength;\r\nvarying float vradius;\r\n\r\nvoid main(void) {\r\n  vec3 bitangent \x3d normal;\r\n\r\n  vtc \x3d uv0;\r\n  vlength \x3d auxpos1;\r\n  vradius \x3d 0.5 * width;\r\n\r\n  vec4 pos \x3d view * vec4((model * vec4(position + vradius * bitangent * uv0.y, 1.0)).xyz, 1.0);\r\n  gl_Position \x3d proj * pos;\r\n}\r\n"},
nativeLine:{"colorPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 color;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  gl_FragColor \x3d color;\r\n}\r\n","highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n\r\nvarying vec3 vpos;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"nativeLine.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n"},ribbonLine:{"colorPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nuniform vec4 eColor;\r\nvarying vec4 vColor;\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d eColor * vColor;\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/slice.glsl\x3e\r\n\r\nvarying vec2 vtc;\r\nvarying vec3 vpos;\r\n\r\n#ifdef STIPPLE\r\nuniform float stippleLengthDoubleInv;\r\n#endif\r\n\r\nvoid main() {\r\n  discardBySlice(vpos);\r\n\r\n#ifdef STIPPLE\r\n  if (fract(vtc.x * stippleLengthDoubleInv) \x3e 0.5) {\r\n    discard;\r\n  }\r\n#endif\r\n\r\n  gl_FragColor \x3d vec4(1.0, 1.0, 1.0, 1.0);\r\n}\r\n","ribbonLine.vert":'#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nuniform float extLineWidth;\r\nuniform float nearPlane;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\nattribute vec4 color;\r\n\r\nvarying vec2 vtc;\r\nvarying vec4 vColor;\r\nvarying vec3 vpos;\r\n\r\nattribute float size;\r\n\r\n#ifndef WALL\r\nuniform float miterLimit;\r\nattribute vec3 auxpos1;\r\nattribute vec3 auxpos2;\r\n#endif\r\n\r\n#ifdef SCREENSCALE\r\nuniform vec2 screenSize;\r\n\r\nvec4 toScreenCoords(vec3 vertex) {\r\n  vec4 vClipSpace \x3d proj * view * vec4((model * vec4(vertex, 1.0)).xyz, 1.0);\r\n  vClipSpace.xy *\x3d screenSize;\r\n  return vClipSpace/abs(vClipSpace.w);\r\n}\r\n\r\n#define VECTYPE vec2\r\n#define ZEROVEC vec2(0.0, 0.0)\r\n#define PERPENDICULAR(v) vec2(v.y, -v.x);\r\n#define ISOUTSIDE (left.x * right.y - left.y * right.x)*uv0.y \x3e 0.0\r\n\r\n#else //ifdef SCREENSCALE\r\n\r\n#define VECTYPE vec3\r\n#define ZEROVEC vec3(0.0, 0.0, 0.0)\r\n// these macros are only valid for "strip" type lines:\r\n#define PERPENDICULAR(v) cross(up/*vec3(0.0, 1.0, 0.0)*/, v)\r\n#define ISOUTSIDE dot(cross(left, right), up/*vec3(0.0, 1.0, 0.0)*/)*uv0.y \x3c 0.0\r\n\r\n#endif //ifdef SCREENSCALE\r\n\r\nfloat interp(float ncp, vec4 a, vec4 b) {\r\n  return (-ncp - a.z) / (b.z - a.z);\r\n}\r\n\r\n#ifdef SCREENSCALE\r\n\r\nvoid clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next) {\r\n  float vnp \x3d nearPlane*0.99;\r\n\r\n  //We have four vertices per point on the line. Start and end vertices\r\n  //are treated differently --\x3e d \x3e 0, d \x3c 0\r\n  float d \x3d abs(uv0.y) - 1.1;\r\n\r\n  //current pos behind ncp --\x3e we need to clip\r\n  if(pos.z \x3e -nearPlane) {\r\n    if (d \x3c 0.0) {\r\n      //previous in front of ncp\r\n      if(prev.z \x3c -nearPlane) {\r\n        pos \x3d mix(prev, pos, interp(vnp, prev, pos));\r\n        next \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0, 0, 0, 1);\r\n      }\r\n    }\r\n    //next in front of ncp\r\n    if(d \x3e 0.0) {\r\n      if(next.z \x3c -nearPlane) {\r\n        pos \x3d mix(pos, next, interp(vnp, pos, next));\r\n        prev \x3d pos;\r\n      } else {\r\n        pos \x3d vec4(0, 0, 0, 1);\r\n      }\r\n    }\r\n  } else {\r\n    //current position visible\r\n    //previous behind ncp\r\n    if (prev.z \x3e -nearPlane) {\r\n      prev \x3d mix(pos, prev, interp(vnp, pos, prev));\r\n    }\r\n    //next behind ncp\r\n    if (next.z \x3e -nearPlane) {\r\n      next \x3d mix(next, pos, interp(vnp, next, pos));\r\n    }\r\n  }\r\n\r\n  pos\x3d proj * pos;\r\n  pos.xy *\x3d screenSize;\r\n  pos /\x3d pos.w;\r\n\r\n  next \x3d proj * next;\r\n  next.xy *\x3d screenSize;\r\n  next /\x3d next.w;\r\n\r\n  prev \x3d proj * prev;\r\n  prev.xy *\x3d screenSize;\r\n  prev /\x3d prev.w;\r\n}\r\n\r\n#endif // SCREENSCALE\r\n\r\nvoid main(void) {\r\n  vpos \x3d (model * vec4(position, 1.0)).xyz;\r\n\r\n#ifdef SCREENSCALE\r\n// Check for special value of uv0.y which is used by the Renderer when graphics\r\n// are removed before the VBO is recompacted. If this is the case, then we just\r\n// project outside of clip space.\r\nif (uv0.y \x3d\x3d 0.0) {\r\n  // Project out of clip space\r\n  gl_Position \x3d vec4(1e038, 1e038, 1e038, 1.0);\r\n}\r\nelse {\r\n#endif\r\n\r\nfloat lineWidth \x3d extLineWidth + size;\r\n\r\n#ifdef SCREENSCALE\r\n\r\n#if 0\r\n  vec4 pos \x3d toScreenCoords(position.xyz);\r\n  vec2 left \x3d (pos - toScreenCoords(auxpos1)).xy;\r\n  vec2 right \x3d (toScreenCoords(auxpos2) - pos).xy;\r\n#else\r\n  vec4 pos  \x3d view * vec4((model * vec4(position.xyz, 1.0)).xyz, 1.0);\r\n  vec4 prev \x3d view * vec4((model * vec4(auxpos1.xyz, 1.0)).xyz, 1.0);\r\n  vec4 next \x3d view * vec4((model * vec4(auxpos2.xyz, 1.0)).xyz, 1.0);\r\n\r\n  clipAndTransform(pos, prev, next);\r\n\r\n  vec2 left \x3d (pos - prev).xy;\r\n  vec2 right \x3d (next - pos).xy;\r\n#endif\r\n\r\n#else // ifdef SCREENSCALE\r\n  vec4 pos \x3d vec4(position, 1.0);\r\n#ifndef WALL\r\n  vec3 left \x3d position.xyz - auxpos1;\r\n  vec3 right \x3d auxpos2 - position.xyz;\r\n  vec3 up \x3d normalize(position.xyz);\r\n#endif // ifndef WALL\r\n#endif // ifdef SCREENSCALE\r\n\r\n#ifdef WALL\r\n  float displacementLen \x3d lineWidth;\r\n  vec3 displacementDir \x3d normalize(position.xyz);//vec3(0.0, 1.0, 0.0);\r\n#else // ifdef WALL\r\n\r\n  float leftLen \x3d length(left);\r\n  left \x3d (leftLen \x3e 0.001) ? left/leftLen : ZEROVEC;\r\n\r\n  float rightLen \x3d length(right);\r\n  right \x3d (rightLen \x3e 0.001) ? right/rightLen : ZEROVEC;\r\n\r\n  // determine if vertex is on the "outside or "inside" of the join\r\n  bool isOutside \x3d ISOUTSIDE;\r\n\r\n  // compute miter join position first\r\n  float displacementLen \x3d lineWidth;\r\n  VECTYPE displacementDir \x3d normalize(left + right);\r\n  displacementDir \x3d PERPENDICULAR(displacementDir);\r\n  if (leftLen \x3e 0.001 \x26\x26 rightLen \x3e 0.001) {\r\n    float nDotSeg \x3d dot(displacementDir, left);\r\n    displacementLen /\x3d length(nDotSeg*left - displacementDir);\r\n\r\n    // limit displacement of inner vertices\r\n    if (!isOutside) {\r\n      displacementLen \x3d min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));\r\n    }\r\n  }\r\n\r\n  if (isOutside \x26\x26 (displacementLen \x3e miterLimit*lineWidth)) {\r\n    // convert to bevel join if miterLimit is exceeded\r\n    if (leftLen \x3c 0.001) {\r\n      displacementDir \x3d right;\r\n    }\r\n    else if (rightLen \x3c 0.001) {\r\n      displacementDir \x3d left;\r\n    }\r\n    else {\r\n      displacementDir \x3d (abs(uv0.y) - 1.1 \x3c 0.0) ? left : right;\r\n    }\r\n    displacementDir \x3d normalize(displacementDir);\r\n    displacementDir \x3d PERPENDICULAR(displacementDir);\r\n    displacementLen \x3d lineWidth;\r\n  }\r\n\r\n#endif // ifdef WALL\r\n\r\n#ifdef SCREENSCALE\r\n  pos.xy +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos.xy /\x3d screenSize;\r\n#else\r\n  pos.xyz +\x3d displacementDir * floor(uv0.y + 0.5) * displacementLen;\r\n  pos \x3d proj * view * model * pos;\r\n#endif\r\n\r\n  vtc \x3d uv0;\r\n  vColor \x3d color * 0.003921568627451; // \x3d 1/255\r\n  gl_Position \x3d pos;\r\n\r\n#ifdef SCREENSCALE\r\n  }\r\n#endif\r\n}\r\n'}},
misc:{"blendLayers.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec2 uv;\r\n\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\nvoid main() {\r\n  vec4 color \x3d texture2D(tex, uv);\r\n\r\n  // Note: output in pre-multiplied alpha for correct alpha compositing\r\n  gl_FragColor \x3d vec4(color.xyz, 1.0) * color.a * opacity;\r\n}\r\n","blendLayers.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nuniform float scale;\r\nuniform vec2 offset;\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position, 1.0);\r\n  uv \x3d uv0 * scale + offset;;\r\n}\r\n",
"showDepth.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\nuniform sampler2D depthTex;\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n// gl_FragColor \x3d vec4(vec3(texture2D(depthTex, vtc).a), 1.0);\r\n   gl_FragColor \x3d vec4(rgba2float(texture2D(depthTex, vtc)));\r\n// gl_FragColor \x3d texture2D(depthTex, vtc);\r\n}\r\n","showDepth.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nattribute vec2 position;\r\nattribute vec2 uv0;\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d proj * vec4(position.x, position.y, .0, 1.0);\r\n  vtc \x3d uv0;\r\n}\r\n",
"simple.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform vec4 color;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d color;\r\n}\r\n","simple.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n}\r\n","texOnly.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\nuniform vec4 color;\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  vec4 texColor \x3d texture2D(tex, vtc);\r\n  gl_FragColor \x3d texColor * color;\r\n}\r\n",
"texOnly.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 model;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d proj * view * vec4((model * vec4(position, 1.0)).xyz, 1.0);\r\n  vtc \x3d uv0;\r\n}\r\n"},pointRenderer:{"pointRenderer.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\n#ifdef DEPTH_PASS\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n  vec2 vOffset \x3d gl_PointCoord - vec2(0.5, 0.5);\r\n  float r2 \x3d dot(vOffset, vOffset);\r\n\r\n  if (r2 \x3e 0.25) {\r\n    discard;\r\n  }\r\n\r\n#ifdef DEPTH_PASS\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d vec4(vColor, 1.0);\r\n#endif\r\n}\r\n",
"pointRenderer.vert":"#include \x3cutil/slice.glsl\x3e\r\n#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec3 aPosition;\r\nattribute vec3 aColor;\r\n\r\nuniform mat4 uModelViewMatrix;\r\nuniform mat4 uProjectionMatrix;\r\nuniform vec2 uScreenMinMaxSize;\r\nuniform vec2 uPointScale;\r\nuniform vec3 uClipMin;\r\nuniform vec3 uClipMax;\r\n\r\n#ifdef DEPTH_PASS\r\nuniform vec2 nearFar;\r\n\r\nvarying float depth;\r\n#else\r\nvarying vec3 vColor;\r\n#endif\r\n\r\nvoid main(void) {\r\n\r\n  // Move clipped points outside of clipspace\r\n  if (aPosition.x \x3c uClipMin.x || aPosition.y \x3c uClipMin.y || aPosition.z \x3c uClipMin.z ||\r\n      aPosition.x \x3e uClipMax.x || aPosition.y \x3e uClipMax.y || aPosition.z \x3e uClipMax.z) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  if (rejectBySlice(aPosition)) {\r\n    gl_Position \x3d vec4(0.0,0.0,0.0,2.0);\r\n    gl_PointSize \x3d 0.0;\r\n    return;\r\n  }\r\n\r\n  // Position in camera space\r\n  vec4 camera \x3d uModelViewMatrix * vec4(aPosition, 1.0);\r\n\r\n  float pointSize \x3d uPointScale.x;\r\n  vec4 position \x3d uProjectionMatrix * camera;\r\n\r\n  // Calculate Size\r\n#ifdef DRAW_SCREEN_SIZE\r\n    float clampedScreenSize \x3d pointSize;\r\n#else\r\n    float pointRadius \x3d 0.5 * pointSize;\r\n    vec4 cameraOffset \x3d camera + vec4(0.0, pointRadius, 0.0, 0.0);\r\n    vec4 positionOffset \x3d uProjectionMatrix * cameraOffset;\r\n    float radius \x3d abs(positionOffset.y - position.y);\r\n\r\n    float viewHeight \x3d uPointScale.y;\r\n\r\n    // screen diameter \x3d (2 * r / w) * (h / 2)\r\n    float screenPointSize \x3d (radius / position.w) * viewHeight;\r\n    float clampedScreenSize \x3d clamp(screenPointSize, uScreenMinMaxSize.x, uScreenMinMaxSize.y);\r\n\r\n    // Shift towards camera, to move rendered point out of terrain i.e. to\r\n    // the camera-facing end of the virtual point when considering it as a\r\n    // 3D sphere.\r\n    camera.xyz -\x3d normalize(camera.xyz) * pointRadius * clampedScreenSize / screenPointSize;\r\n    position \x3d uProjectionMatrix * camera;\r\n#endif\r\n\r\n  gl_PointSize \x3d clampedScreenSize;\r\n  gl_Position \x3d position;\r\n\r\n#ifdef DEPTH_PASS\r\n  depth \x3d (-camera.z - nearFar[0]) / (nearFar[1] - nearFar[0]);\r\n#else\r\n  vColor \x3d aColor;\r\n#endif\r\n}\r\n"},
renderer:{highlight:{"apply.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Merging blurred outlines with source image, advanced version\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GRID_DEBUG (set or !set)\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform sampler2D origin;\r\n\r\nuniform vec4 color;\r\nuniform float outlineSize;\r\nuniform float blurSize;\r\nuniform vec4 opacities; // [outline, outlineOccluded, fill, fillOccluded]\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main() {\r\n  #if defined(GRID_OPTIMIZATION) \x26\x26 defined(GRID_DEBUG)\r\n    gl_FragColor \x3d vec4(uv, 0, 1.0);\r\n  #else\r\n    // Read the highlight intensity from the blurred highlight image\r\n    vec4 blurredHighlightValue \x3d texture2D(tex, uv);\r\n    float highlightIntensity \x3d blurredHighlightValue.a;\r\n\r\n    // Discard all pixels which are not affected by highlight\r\n    if (highlightIntensity \x3d\x3d 0.0) {\r\n      discard;\r\n    }\r\n\r\n    vec4 origin_color \x3d texture2D(origin, uv);\r\n\r\n    float outlineIntensity;\r\n    float fillIntensity;\r\n\r\n    // if occluded\r\n    if (blurredHighlightValue.g \x3e blurredHighlightValue.b) {\r\n      outlineIntensity \x3d color.w * opacities[1];\r\n      fillIntensity \x3d color.w * opacities[3];\r\n    }\r\n    // if unoccluded\r\n    else {\r\n      outlineIntensity \x3d color.w * opacities[0];\r\n      fillIntensity \x3d color.w * opacities[2];\r\n    }\r\n\r\n    float inner \x3d 1.0 - outlineSize / 9.0;\r\n    float outer \x3d 1.0 - (outlineSize + blurSize) / 9.0;\r\n\r\n    float outlineFactor \x3d smoothstep(outer, inner, highlightIntensity);\r\n    //float fillFactor \x3d smoothstep(0.6, 0.72, highlightIntensity);\r\n    float fillFactor \x3d any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;\r\n    float intensity \x3d outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;\r\n\r\n    // Blending equation: gl.blendFunc(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA);\r\n    // I.e., color should not be premultiplied with alpha\r\n    gl_FragColor \x3d vec4(color.xyz, intensity);\r\n  #endif\r\n}\r\n",
"apply.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  attribute vec2 uv0;\r\n  uniform sampler2D coverageTex;\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    #ifdef GRID_DEBUG\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block,\r\n      // or all pixels set, hide block\r\n      if (cov.r \x3d\x3d 0.0 || cov.g \x3d\x3d 1.0 || cov.b \x3d\x3d 1.0) {\r\n        gl_Position \x3d vec4(0,0,0,0);\r\n        return;\r\n      }\r\n      gl_Position \x3d vec4(position, .0, 1.0);\r\n      uv \x3d uv0;\r\n      return;\r\n    #else\r\n      vec4 cov \x3d texture2D(coverageTex, uv0);\r\n      // if no highlight pixel set in this block, hide block\r\n      if (cov.r \x3d\x3d 0.0) {\r\n        gl_Position \x3d vec4(0,0,0,0);\r\n        return;\r\n      }\r\n    #endif\r\n  #endif\r\n\r\n  gl_Position \x3d vec4(position, .0, 1.0);\r\n  uv \x3d position.xy * .5 + vec2(.5);\r\n}\r\n",
"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Gaussian blur with linear sampling. Supports different number of samples, but\r\n// only 5 samples have proper weights. Uses linear texture interpolation to reduce\r\n// the number of samples taken.\r\n\r\n// Defines:\r\n// GRID_OPTIMIZATION (set or !set)\r\n// GAUSSIAN_SAMPLES (3,5,7)\r\n\r\n// This technique requires linear filtering on source texture\r\n// http://rastergrid.com/blog/2010/09/efficient-gaussian-blur-with-linear-sampling/\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform vec2 blurSize;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  #ifdef GRID_OPTIMIZATION\r\n    vec2 uv \x3d blurCoordinate.xy;\r\n    vec4 center \x3d texture2D(tex, uv);\r\n\r\n    // do not blur if no pixel or all pixels in neighborhood are set\r\n    if (blurCoordinate.z \x3d\x3d 1.0) {\r\n      gl_FragColor \x3d center;\r\n    }\r\n    else {\r\n      vec4 sum \x3d vec4(0.0);\r\n\r\n      #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.204164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.407333) * 0.304005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.294215) * 0.093913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.1) * 0.03;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.1) * 0.03;\r\n      #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n        // not proper gaussian weights\r\n        sum +\x3d center * 0.154164;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 1.5) * 0.204005;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 3.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 5.5) * 0.123913;\r\n        sum +\x3d texture2D(tex, uv + blurSize * 7.5) * 0.05;\r\n        sum +\x3d texture2D(tex, uv - blurSize * 7.5) * 0.05;\r\n      #endif\r\n\r\n      gl_FragColor \x3d sum;\r\n    }\r\n  #else\r\n    vec4 sum \x3d vec4(0.0);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.204164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.304005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.093913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.03;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.03;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      sum +\x3d texture2D(tex, blurCoordinates[0]) * 0.154164;\r\n      sum +\x3d texture2D(tex, blurCoordinates[1]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[2]) * 0.204005;\r\n      sum +\x3d texture2D(tex, blurCoordinates[3]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[4]) * 0.123913;\r\n      sum +\x3d texture2D(tex, blurCoordinates[5]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[6]) * 0.09;\r\n      sum +\x3d texture2D(tex, blurCoordinates[7]) * 0.05;\r\n      sum +\x3d texture2D(tex, blurCoordinates[8]) * 0.05;\r\n    #endif\r\n\r\n    gl_FragColor \x3d sum;\r\n  #endif\r\n}\r\n",
"blur.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nattribute vec2 uv0;\r\n\r\n#ifdef GRID_OPTIMIZATION\r\n  uniform sampler2D coverageTex;\r\n  varying vec3 blurCoordinate;\r\n#else\r\n  uniform vec2 blurSize;\r\n  varying vec2 blurCoordinates[GAUSSIAN_SAMPLES];\r\n#endif\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(position, 0.0, 1.0);\r\n\r\n  #ifdef GRID_OPTIMIZATION\r\n    // sample the coverage texture at the block center\r\n    // and if no coverage detected, create degenerate triangle\r\n    vec4 cov \x3d texture2D(coverageTex, uv0);\r\n    if (cov.r \x3d\x3d 0.0) {\r\n      gl_Position \x3d vec4(0,0,0,0);\r\n    }\r\n\r\n    // create texture coordinate for blur center\r\n    // encode information about fully inside block in z coordinate\r\n    blurCoordinate \x3d vec3(gl_Position.xy * .5 + vec2(.5), max(cov.g, cov.b));\r\n  #else\r\n    vec2 uv \x3d position.xy * .5 + vec2(.5);\r\n\r\n    #if GAUSSIAN_SAMPLES \x3d\x3d 3\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 5\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 7\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n    #elif GAUSSIAN_SAMPLES \x3d\x3d 9\r\n      // not proper gaussian weights\r\n      blurCoordinates[0] \x3d uv;\r\n      blurCoordinates[1] \x3d uv + blurSize * 1.407333;\r\n      blurCoordinates[2] \x3d uv - blurSize * 1.407333;\r\n      blurCoordinates[3] \x3d uv + blurSize * 3.294215;\r\n      blurCoordinates[4] \x3d uv - blurSize * 3.294215;\r\n      blurCoordinates[5] \x3d uv + blurSize * 5.1;\r\n      blurCoordinates[6] \x3d uv - blurSize * 5.1;\r\n      blurCoordinates[7] \x3d uv + blurSize * 7.1;\r\n      blurCoordinates[8] \x3d uv - blurSize * 7.1;\r\n    #endif\r\n  #endif\r\n}\r\n",
"downsample.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n// Smartly downsamples a texture, halfing its resolution. This allows for a square\r\n// screen region to check if none, any or all pixels were set.\r\n\r\n// The red channel is always ceiled after interpolating the 4 merged pixels.\r\n// This allows to evaluate:\r\n// any(pixels.red !\x3d 0.0) as red \x3d\x3d 1.0\r\n// none(pixels.red !\x3d 0.0) as red \x3d\x3d 0.0\r\n\r\n// The green and blue channels are set to floor(max(green, blue)).\r\n// This allows to evaluate:\r\n// all(pixels.green || pixels.blue) as green \x3d\x3d 1.0\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\nuniform sampler2D tex;\r\nuniform vec2 invFramebufferDim;\r\n\r\nvoid main() {\r\n  vec2 coord \x3d gl_FragCoord.xy * invFramebufferDim;\r\n  vec4 value \x3d texture2D(tex, coord);\r\n  float mx \x3d floor(max(value.g, value.b));\r\n  gl_FragColor \x3d vec4(ceil(value.r), mx, mx, 1.0);\r\n}\r\n",
"downsample.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\n\r\nvoid main() {\r\n  gl_Position \x3d vec4(vec2(1.0) - position * 2.0, .0, 1.0);\r\n}\r\n"},laserLine:{"laserLine.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n\r\n//--------------------------------------------------------------------------\r\n// Uniforms\r\n//--------------------------------------------------------------------------\r\n\r\nuniform sampler2D depthMap;\r\n\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 zScale;\r\nuniform float maxPixelDistance;\r\n\r\n// focus plane in camera space\r\nuniform vec4 focusPlane;\r\n\r\n// focus sphere in camera space\r\nuniform vec4 focusSphere;\r\n\r\n// segment plane in camera space\r\nuniform vec4 segmentPlane;\r\n\r\n// line segment\r\nuniform vec3 segmentStart;\r\nuniform vec3 segmentEnd;\r\n\r\n// styling\r\nuniform vec3 glowColor;\r\nuniform float glowWidth;\r\nuniform vec3 innerColor;\r\nuniform float innerWidth;\r\nuniform float globalAlpha;\r\n\r\n//--------------------------------------------------------------------------\r\n// Inputs\r\n//--------------------------------------------------------------------------\r\n\r\nvarying vec2 uv;\r\n\r\n//--------------------------------------------------------------------------\r\n// Defines\r\n//--------------------------------------------------------------------------\r\n\r\n#define INFINITY 100000.0\r\n\r\n\r\n\r\n// reconstruct depth value from linear depth map\r\nfloat linearDepth(vec2 uv) {\r\n  return -(rgba2float(texture2D(depthMap, uv)) * (nearFar[1] - nearFar[0]) + nearFar[0]);\r\n}\r\n\r\n// reconstruct position in view space\r\nvec3 reconstructPosition(vec2 fragCoord, float depth) {\r\n  return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);\r\n}\r\n\r\nfloat planeDistancePixels(vec4 plane, vec3 pos) {\r\n  // compute distance to plane\r\n  float dist \x3d dot(plane.xyz, pos) + plane.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nfloat sphereDistancePixels(vec4 sphere, vec3 pos) {\r\n  // compute distance to sphere\r\n  float dist \x3d distance(sphere.xyz, pos) - sphere.w;\r\n  // compute derivative of distance function with respect to pixels\r\n  float width \x3d fwidth(dist);\r\n  // normalize distance by the derivative to get a measurement with respect to pixels\r\n  // the clamping is used to prevent excessive artifacts along depth discontinuities\r\n  dist /\x3d min(width, maxPixelDistance);\r\n  return abs(dist);\r\n}\r\n\r\nvec4 blendPremultiplied(vec4 source, vec4 dest) {\r\n  float oneMinusSourceAlpha \x3d 1.0 - source.a;\r\n\r\n  return vec4(\r\n    source.rgb + dest.rgb * oneMinusSourceAlpha,\r\n    source.a + dest.a * oneMinusSourceAlpha\r\n  );\r\n}\r\n\r\nvec4 premultipliedColor(vec3 rgb, float alpha) {\r\n  return vec4(rgb * alpha, alpha);\r\n}\r\n\r\n// computes laser line color based on distance in pixels\r\nvec4 laserLineProfile(float dist) {\r\n  if (dist \x3e glowWidth) {\r\n    return vec4(0.0);\r\n  }\r\n\r\n  float innerAlpha \x3d (1.0 - smoothstep(0.0, innerWidth, dist));\r\n  float glowAlpha \x3d pow(max(0.0, 1.0 - dist / glowWidth), 8.0);\r\n\r\n  return blendPremultiplied(\r\n    premultipliedColor(innerColor, innerAlpha),\r\n    premultipliedColor(glowColor, glowAlpha)\r\n  );\r\n}\r\n\r\nvoid main() {\r\n  // do not draw laserline on background\r\n  float depth \x3d linearDepth(uv);\r\n  if (-depth \x3d\x3d nearFar[0]) {\r\n    discard;\r\n  }\r\n\r\n  // reconstruct position in view space\r\n  vec3 pos \x3d reconstructPosition(gl_FragCoord.xy, depth);\r\n\r\n  // empirical hack to fade out laser line in problematic areas:\r\n  // the derivatives to normalize the distance function are valid inside smooth surfaces,\r\n  // but break down at depth discontinuities (e.g. edges). We fade out the laser lines in\r\n  // areas where depth valus have large variations in order to avoid this problem.\r\n  float ddepth \x3d fwidth(depth);\r\n  float depthDiscontinuityAlpha \x3d 1.0 - smoothstep(0.0, 0.01, -ddepth / depth);\r\n\r\n  // reconstruct normal using derivatives\r\n  vec3 normal \x3d normalize(cross(dFdx(pos), dFdy(pos)));\r\n\r\n  // distance to focus plane\r\n  float focusPlaneDistance \x3d planeDistancePixels(focusPlane, pos);\r\n\r\n  // distance to focus sphere\r\n  float focusSphereDistance \x3d sphereDistancePixels(focusSphere, pos);\r\n\r\n  // distance to segment plane\r\n  float segmentDistance \x3d INFINITY;\r\n  float segmentLength \x3d length(segmentEnd - segmentStart);\r\n  vec3 segmentDir \x3d (segmentEnd - segmentStart) / segmentLength;\r\n  float t \x3d dot(segmentDir, pos - segmentStart);\r\n\r\n  if (segmentLength \x3e 0.0 \x26\x26 t \x3e\x3d 0.0 \x26\x26 t \x3c\x3d segmentLength) {\r\n    segmentDistance \x3d planeDistancePixels(segmentPlane, pos);\r\n  }\r\n\r\n  // evaluate color profile for both planes and the sphere\r\n  vec4 focusPlaneColor \x3d laserLineProfile(focusPlaneDistance);\r\n  vec4 focusSphereColor \x3d laserLineProfile(focusSphereDistance);\r\n  vec4 segmentColor \x3d laserLineProfile(segmentDistance);\r\n\r\n  // empirical hack to fade out laser line when planes are nearly parallel\r\n  float focusPlaneAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, focusPlane.xyz)));\r\n  float focusSphereAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, normalize(pos - focusSphere.xyz))));\r\n  float segmentAlpha \x3d 1.0 - smoothstep(0.995, 0.999, abs(dot(normal, segmentPlane.xyz)));\r\n\r\n  // combine colors\r\n  vec4 color \x3d max(\r\n    focusPlaneColor * focusPlaneAlpha,\r\n    max(\r\n      focusSphereColor * focusSphereAlpha,\r\n      segmentColor * segmentAlpha\r\n    )\r\n  );\r\n\r\n  gl_FragColor \x3d color * globalAlpha * depthDiscontinuityAlpha;\r\n}\r\n"},
occluded:{"combine.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D occludedColorMap;\r\n\r\nvarying vec2 uv;\r\n\r\nvoid main() {\r\n  vec4 occludedColor \x3d texture2D(occludedColorMap, uv);\r\n  gl_FragColor \x3d occludedColor * vec4(1.0, 1.0, 1.0, 0.4);\r\n}\r\n"},offscreen:{"offscreen.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d texture2D(tex, vtc);\r\n}\r\n","offscreen.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 vtc;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.xy, 0.0, 1.0);\r\n  vtc \x3d position.xy * 0.5 + 0.5;\r\n}\r\n",
"transparentToHUDVisibility.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nuniform sampler2D tex;\r\n\r\nvarying vec2 vtc;\r\n\r\nvoid main() {\r\n  gl_FragColor \x3d vec4(1.0 - texture2D(tex, vtc).a);\r\n}\r\n"},ssao:{"blur.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3crenderer/ssao/common.glsl\x3e\r\n\r\n#ifndef RADIUS\r\n#define RADIUS 4\r\n#endif\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\nuniform sampler2D tex;\r\n\r\nuniform vec2 blurSize;\r\n\r\nuniform float g_BlurFalloff;\r\nuniform float projScale;\r\n\r\nuniform vec2    nearFar;\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2 uv;\r\n\r\nfloat BlurFunction(vec2 uv, float r, float center_d, inout float w_total, float sharpness) {\r\n  float c \x3d texture2D(tex, uv).r;\r\n  float d \x3d getDepthLinear(depthMap, nearFar, uv);\r\n\r\n  float ddiff \x3d d - center_d;\r\n\r\n  float w \x3d exp(-r*r*g_BlurFalloff - ddiff*ddiff*sharpness);\r\n\r\n  w_total +\x3d w;\r\n\r\n  return w*c;\r\n}\r\n\r\nvoid main(void) {\r\n  float b \x3d 0.0;\r\n  float w_total \x3d 0.0;\r\n\r\n  float center_d \x3d  getDepthLinear(depthMap, nearFar, uv);\r\n\r\n  float sharpness \x3d -0.05*projScale/(center_d*zScale.x+zScale.y);\r\n  for (int r \x3d -RADIUS; r \x3c\x3d RADIUS; ++r) {\r\n    float rf \x3d float(r);\r\n    vec2 uvOffset \x3d uv + rf*blurSize;\r\n    b +\x3d BlurFunction(uvOffset, rf, center_d, w_total, sharpness);\r\n  }\r\n\r\n  gl_FragColor \x3d vec4(b/w_total);\r\n}\r\n",
"common.glsl":"#include \x3cutil/encoding.glsl\x3e\r\n\r\nfloat getDepthLinear(sampler2D depthMap, vec2 nearFar, vec2 ssC) {\r\n  return -(rgba2float(texture2D(depthMap, ssC))*(nearFar[1] - nearFar[0])+nearFar[0]);\r\n}\r\n","ssao.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3crenderer/ssao/common.glsl\x3e\r\n\r\n#ifndef SAMPLES\r\n#define SAMPLES 4\r\n#endif\r\n\r\nuniform mat4 projMatrixInv;\r\n\r\nuniform sampler2D normalMap;\r\nuniform sampler2D depthMap;\r\n\r\nuniform float intensity;\r\n\r\nuniform float projScale;\r\nuniform float radius;\r\nuniform vec2 nearFar;\r\nuniform vec4 projInfo;\r\nuniform vec2 screenDimensions;\r\n\r\n//noise texture lookup could be replaced with hash function if WebGL gets XOR functionality\r\nuniform vec3 pSphere[SAMPLES]; //tap position\r\nuniform vec2 rnmScale;\r\nuniform sampler2D rnm; //noise texture\r\n\r\n//set z scaling, used to prevent division in ortho mode\r\nuniform vec2 zScale;\r\n\r\nvarying vec2  uv;\r\nvarying vec4  camPos;\r\n\r\nfloat fallOffFunction(float vv, float vn, float bias) {\r\n  float radius2 \x3d radius * radius;\r\n\r\n  // A: From the HPG12 paper\r\n  // Note large epsilon to avoid overdarkening within cracks\r\n  // return float(vv \x3c radius2) * max((vn - bias) / (epsilon + vv), 0.0) * radius2 * 0.6;\r\n\r\n  // B: Smoother transition to zero (lowers contrast, smoothing out corners). [Recommended]\r\n  float f \x3d max(radius2 - vv, 0.0); return f * f * f * max(vn-bias, 0.0);\r\n\r\n  // C: Medium contrast (which looks better at high radii), no division.  Note that the\r\n  // contribution still falls off with radius^2, but we've adjusted the rate in a way that is\r\n  // more computationally efficient and happens to be aesthetically pleasing.\r\n  // return 4.0 * max(1.0 - vv * invRadius2, 0.0) * max(vn - bias, 0.0);\r\n\r\n  // D: Low contrast, no division operation\r\n  // return 2.0 * float(vv \x3c radius * radius) * max(vn - bias, 0.0);\r\n}\r\n\r\n\r\n/** Compute the occlusion due to sample point \\a Q about camera-space point \\a C with unit normal \\a n_C */\r\nfloat aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {\r\n  vec3 v \x3d Q - C;\r\n  float vv \x3d dot(v, v);\r\n  float vn \x3d dot(normalize(v), n_C);\r\n  return fallOffFunction(vv, vn, 0.1);\r\n}\r\n\r\n\r\n/**\r\n * Reconstruct camera-space P.xyz from screen-space S \x3d (x, y) in\r\n * pixels and camera-space z \x3c 0.  Assumes that the upper-left pixel center\r\n * is at (0.5, 0.5) [but that need not be the location at which the sample tap\r\n * was placed!]\r\n *\r\n * Costs 3 MADD.  Error is on the order of 10^3 at the far plane, partly due to z precision.\r\n */\r\nvec3 reconstructCSPosition(vec2 S, float z) {\r\n  return vec3(( (S.xy) * projInfo.xy + projInfo.zw)*(z*zScale.x+zScale.y), z);\r\n}\r\n\r\nvoid main(void) {\r\n  //Hash function used in the HPG12 AlchemyAO paper\r\n  //Not supported in WebGL -\x3e using texture lookup as in old SSAO shader instead\r\n  //ivec2 ssC \x3d ivec2(gl_FragCoord.xy);\r\n  //float randomPatternRotationAngle \x3d float((3 * ssC.x ^ ssC.y + ssC.x * ssC.y) * 10);\r\n  vec3 fres \x3d normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));\r\n\r\n  float currentPixelDepth \x3d getDepthLinear(depthMap, nearFar, uv);\r\n\r\n  if (-currentPixelDepth\x3enearFar.y || -currentPixelDepth\x3cnearFar.x) {\r\n    gl_FragColor \x3d vec4(0);\r\n    return;\r\n  }\r\n\r\n  vec3 currentPixelPos \x3d reconstructCSPosition(gl_FragCoord.xy,currentPixelDepth);\r\n\r\n  // get the normal of current fragment\r\n  vec4 norm4 \x3d texture2D(normalMap, uv);\r\n  vec3 norm \x3d vec3(-1.0) + 2.0 * norm4.xyz;\r\n  bool isTerrain \x3d norm4.w\x3c0.5;\r\n\r\n  float sum \x3d .0;\r\n\r\n  vec4 occluderFragment;\r\n  vec3 ray;\r\n\r\n  vec3 tapPixelPos;\r\n\r\n  // note: the factor 2.0 should not be necessary, but makes ssao much nicer.\r\n  // bug or deviation from CE somewhere else?\r\n  float ps \x3d projScale/(2.0*currentPixelPos.z*zScale.x+zScale.y);\r\n\r\n  for(int i \x3d 0; i \x3c SAMPLES; ++i) {\r\n    // get a vector (randomized inside of a sphere with radius 1.0) from a texture and reflect it\r\n    //float ssR;\r\n    //vec2 unitOffset \x3d tapLocation(i, randomPatternRotationAngle, ssR);\r\n    // get the depth of the occluder fragment\r\n    //vec2 offset \x3d vec2(-unitOffset*radius*ssR*ps);\r\n\r\n    vec2 unitOffset \x3d reflect(pSphere[i], fres).xy;\r\n    vec2 offset \x3d vec2(-unitOffset*radius*ps);\r\n\r\n    //don't use current or very nearby samples\r\n    if ( abs(offset.x)\x3c2.0 || abs(offset.y)\x3c2.0) continue;\r\n\r\n    vec2 tc \x3d vec2(gl_FragCoord.xy + offset);\r\n    if (tc.x \x3c 0.0 || tc.y \x3c 0.0 || tc.x \x3e screenDimensions.x || tc.y \x3e screenDimensions.y) continue;\r\n    vec2 tcTap \x3d tc/screenDimensions;\r\n    float occluderFragmentDepth \x3d getDepthLinear(depthMap, nearFar, tcTap);\r\n\r\n    if (isTerrain) {\r\n      bool isTerrainTap \x3d texture2D(normalMap, tcTap).w\x3c0.5;\r\n      if (isTerrainTap) {\r\n        continue;\r\n      }\r\n    }\r\n\r\n    tapPixelPos \x3d reconstructCSPosition(tc, occluderFragmentDepth);\r\n\r\n    sum+\x3d aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);\r\n  }\r\n\r\n  // output the result\r\n\r\n  float A \x3d max(1.0-sum*intensity/float(SAMPLES),0.0);\r\n\r\n  // Anti-tone map to reduce contrast and drag dark region farther\r\n  // (x^0.2 + 1.2 * x^4)/2.2\r\n  A \x3d (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;\r\n\r\n  //gl_FragColor \x3d vec4(norm/2.0+0.5, 1.0);\r\n  //gl_FragColor \x3d vec4(-currentPixelDepth/1000.0);\r\n  //gl_FragColor \x3d vec4(tapPixelPos.x/100.0);\r\n  gl_FragColor \x3d vec4(A);\r\n}\r\n"}},
terrainRenderer:{"colorPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/sceneLighting.glsl\x3e\r\n#include \x3cutil/screenSizePerspective.glsl\x3e\r\n#include \x3cutil/shadow.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform vec3 lightDirection;\r\nuniform vec3 viewDirection;\r\nuniform sampler2D depthTex;\r\nuniform int shadowMapNum;\r\nuniform vec4 shadowMapDistance;\r\nuniform mat4 shadowMapMatrix[4];\r\nuniform float depthHalfPixelSz;\r\nuniform sampler2D ssaoTex;\r\nuniform vec4 viewportPixelSz;\r\nuniform sampler2D tex;\r\nuniform float opacity;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nstruct WireframeSettings {\r\n  float width;\r\n  float falloff;\r\n  float subdivision;\r\n  vec4 color;\r\n  float wireOpacity;\r\n  float surfaceOpacity;\r\n};\r\n\r\nuniform WireframeSettings wireframe;\r\n#endif\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n#endif\r\n\r\nconst vec3 ambient \x3d vec3(0.2,0.2,0.2);\r\nconst vec3 diffuse \x3d vec3(0.8,0.8,0.8);\r\nconst float diffuseHardness \x3d 2.5;\r\n\r\n#ifdef OVERLAY\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\nfloat lum(vec3 c) {\r\n  float max \x3d max(max(c.r, c.g), c.b);\r\n  float min \x3d min(min(c.r, c.g), c.b);\r\n  return (min + max) * 0.5;\r\n}\r\n\r\n#ifdef ATMOSPHERE\r\nvec3 atmosphere(vec3 lightPos, vec3 normal, vec3 view) {\r\n  vec3 surfaceColor   \x3d vec3(0.0);\r\n  vec3 fuzzySpecColor \x3d vec3(1.0);\r\n  vec3 subColor       \x3d vec3(0.0);\r\n  float rollOff       \x3d 1.0;\r\n\r\n  vec3 Ln \x3d normalize(lightPos);\r\n  vec3 Nn \x3d normalize(normal);\r\n  vec3 Hn \x3d normalize(view + Ln);\r\n\r\n  float ldn \x3d dot(Ln, Nn);\r\n  float diffComp \x3d max(0.0, ldn);\r\n  float vdn \x3d 1.0 - dot(view, Nn);\r\n  float ndv \x3d dot(view, Ln);\r\n\r\n  vec3 diffContrib \x3d surfaceColor * diffComp;\r\n  float subLamb \x3d max(0.0, smoothstep(-rollOff, 1.0, ldn) - smoothstep(0.0, 1.0, ldn));\r\n\r\n  vec3 subContrib \x3d subLamb * subColor;\r\n  vec3 vecColor \x3d vec3(vdn);\r\n\r\n  vec3 diffuseContrib \x3d (subContrib + diffContrib);\r\n  vec3 specularContrib \x3d (vecColor * fuzzySpecColor);\r\n\r\n  return (diffContrib + specularContrib) * rollOff;\r\n}\r\n#endif\r\n\r\nvoid main() {\r\n  vec3 a \x3d ambient;\r\n\r\n  float shadow \x3d 0.0;\r\n#ifdef RECEIVE_SHADOWS\r\n  shadow \x3d evalShadow(vpos, linearDepth, depthTex, shadowMapNum, shadowMapDistance, shadowMapMatrix, depthHalfPixelSz);\r\n#endif\r\n  float vndl \x3d dot(normalize(vnormal), lightDirection);\r\n  float k \x3d smoothstep(0.0, 1.0, clamp(vndl*diffuseHardness, 0.0, 1.0));\r\n  vec3 d \x3d (1.0 - shadow/1.8) * diffuse * k;\r\n\r\n  float ssao \x3d viewportPixelSz.w \x3c .0 ? 1.0 : texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;\r\n  vec4 tileColor \x3d texture2D(tex, vtc) * opacity;\r\n\r\n#ifdef OVERLAY\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  // tileColor and overlayTexCols have pre-multiplied alpha\r\n  tileColor \x3d tileColor * (1.0 - overlayColor.a) + overlayColor;\r\n#endif\r\n\r\n  vec3 atm \x3d vec3(0.0);\r\n#ifdef ATMOSPHERE\r\n  float ndotl \x3d max(0.0, min(1.0, vndl));\r\n  atm \x3d atmosphere(wlight, wnormal, -viewDirection);\r\n  atm *\x3d max(0.0, min(1.0, (1.0-lum(tileColor.rgb)*1.5))); //avoid atmosphere on bright base maps\r\n  atm *\x3d max(0.0, min(1.0, ndotl*2.0)); // avoid atmosphere on dark side of the globe\r\n  atm *\x3d tileColor.a; // premultiply with tile alpha\r\n#endif\r\n\r\n  vec3 albedo \x3d atm + tileColor.rgb;\r\n  vec3 normal \x3d normalize(vnormal);\r\n\r\n  // heuristic shading function used in the old terrain, now used to add ambient lighting\r\n  float additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl*2.5, 0.0, 1.0));\r\n  vec3 additionalLight \x3d ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n\r\n  gl_FragColor \x3d vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n  // This is only used for debug rendering the screenSize perspective\r\n\r\n  float perspectiveScale \x3d screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, screenSizePerspective);\r\n\r\n  if (perspectiveScale \x3c\x3d 0.25) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 0, 1), perspectiveScale * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3c\x3d 0.5) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0, 0, 1, 1), (perspectiveScale - 0.25) * 4.0);\r\n  }\r\n  else if (perspectiveScale \x3e\x3d 0.99) {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(0, 1, 0, 1), 0.2);\r\n  }\r\n  else {\r\n    gl_FragColor \x3d mix(gl_FragColor, vec4(1, 0, 1, 1), (perspectiveScale - 0.5) * 2.0);\r\n  }\r\n\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n\r\n  vec2 vuvScaled \x3d vuv * wireframe.subdivision;\r\n  vec2 vuvMod \x3d fract(vuvScaled);\r\n\r\n  vec2 dVuv \x3d fwidth(vuvScaled);\r\n  dVuv \x3d max(vec2(0.00001), dVuv); // workaround against flickering skirts, see #10245\r\n\r\n  vec2 edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                                wireframe.width * dVuv, min(vuvMod, 1.0 - vuvMod));\r\n\r\n  float edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n#ifdef WIREFRAME_TEXTURE\r\n  vec3 wireframeColor \x3d mix(gl_FragColor.rgb, wireframe.color.rgb, edgeFactor * wireframe.color.a);\r\n  float wireframeAlpha \x3d mix(wireframe.surfaceOpacity, wireframe.wireOpacity, edgeFactor);\r\n  gl_FragColor \x3d vec4(wireframeColor * wireframeAlpha, wireframeAlpha * gl_FragColor.a);\r\n#endif\r\n\r\n\r\n#ifdef TILE_BORDERS\r\n  dVuv \x3d fwidth(vuv);\r\n  edgeFactors \x3d smoothstep((wireframe.width - wireframe.falloff) * dVuv,\r\n                            wireframe.width * dVuv, min(vuv, 1.0 - vuv));\r\n  edgeFactor \x3d 1.0 - min(edgeFactors.x, edgeFactors.y);\r\n\r\n  gl_FragColor \x3d mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);\r\n#endif\r\n\r\n#endif // defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n}\r\n",
"colorPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec3 origin;\r\nuniform vec4 texOffsetAndScale;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\nvarying vec2 vtc;\r\n\r\n#ifdef RECEIVE_SHADOWS\r\nvarying float linearDepth;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\nvarying vec2 vuv;\r\n#endif\r\n\r\n#ifdef ATMOSPHERE\r\nuniform vec3 lightDirection;\r\nvarying vec3 wpos;\r\nvarying vec3 wview;\r\nvarying vec3 wnormal;\r\nvarying vec3 wlight;\r\n#endif\r\n\r\n#ifdef OVERLAY\r\n// these variables combine two possible overlays into one by using a vec4:\r\n// components x/y are x/y of overlay 0, and components z/w are x/y of overlay 1\r\nuniform vec4 overlayTexOffset;\r\nuniform vec4 overlayTexScale;\r\nvarying vec4 vtcOverlay;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\nuniform vec4 screenSizePerspective;\r\n\r\nvarying float screenSizeDistanceToCamera;\r\nvarying float screenSizeCosAngle;\r\n\r\n#endif\r\n\r\nvoid main(void) {\r\n  vpos \x3d position;\r\n\r\n#ifdef SPHERICAL\r\n  vnormal \x3d normalize(vpos + origin);\r\n#else\r\n  vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\r\n#endif\r\n\r\nvec2 uv \x3d uv0;\r\nvpos \x3d applySkirts(uv, vpos, vnormal, skirtScale);\r\n\r\n#ifdef ATMOSPHERE\r\n  wpos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n  wnormal \x3d (viewNormal * vec4(normalize(vpos+origin), 1.0)).xyz;\r\n  wlight \x3d (view  * vec4(lightDirection, 1.0)).xyz;\r\n#endif\r\n\r\n#if defined(WIREFRAME_TEXTURE) || defined(TILE_BORDERS)\r\n  vuv \x3d uv;\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE /* debug only */\r\n\r\n  vec3 viewPos \x3d (view * vec4(vpos, 1.0)).xyz;\r\n\r\n  screenSizeDistanceToCamera \x3d length(viewPos);\r\n\r\n  vec3 viewSpaceNormal \x3d (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;\r\n  screenSizeCosAngle \x3d abs(viewSpaceNormal.z);\r\n\r\n#endif\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n\r\n#ifdef RECEIVE_SHADOWS\r\n  // Shadowmap's cascading index used to be based on '1.0 / gl_FragCoord.w'\r\n  // (i.e. the perspective interpolation of 'gl_Position.w'). Precision\r\n  // issues on iPad/iPhone with the 'w' component require the depth to be\r\n  // passed as varying to properly drive the cascading shadow map index.\r\n  linearDepth \x3d gl_Position.w;\r\n#endif\r\n\r\n  vtc \x3d uv * texOffsetAndScale.zw + texOffsetAndScale.xy;\r\n\r\n#ifdef OVERLAY\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n#endif\r\n}\r\n",
"depthPass.frag":"#include \x3cutil/enableExtensions.glsl\x3e\r\n#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/encoding.glsl\x3e\r\n#include \x3cutil/depth.glsl\x3e\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n#ifndef BIAS_SHADOWMAP\r\n  gl_FragColor \x3d float2rgba(depth);\r\n#else\r\n  gl_FragColor \x3d float2rgba(calcFragDepth(depth));\r\n#endif\r\n}\r\n","depthPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec2 nearFar;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying float depth;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef SPHERICAL\r\n  vec3 normal \x3d normalize(position + origin);\r\n#else\r\n  vec3 normal \x3d vec3(0.0, 0.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  vec4 eye \x3d view * vec4(vpos, 1.0);\r\n  gl_Position \x3d proj * eye;\r\n  depth \x3d (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;\r\n}\r\n",
"highlightPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n#include \x3cutil/highlight.glsl\x3e\r\n#include \x3cterrainRenderer/overlay.glsl\x3e\r\n\r\nuniform sampler2D overlay0Tex;\r\nuniform sampler2D overlay1Tex;\r\nuniform float overlayOpacity;\r\n\r\nuniform sampler2D depthTex;\r\nuniform vec4 highlightViewportPixelSz;\r\n\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  vec4 overlayColor \x3d getOverlayColor(overlay0Tex, overlay1Tex, vtcOverlay, overlayOpacity);\r\n\r\n  if (overlayColor.a \x3d\x3d 0.0) {\r\n    // Here we have to write black, instead of discarding the fragment in order to overwrite\r\n    // the highlights which might have been written by skirts of other tiles.\r\n    // As a consequence skirts are not visible, but terrain overwrites draped highlights.\r\n    gl_FragColor \x3d vec4(0,0,0,0);\r\n    return;\r\n  }\r\n\r\n  gl_FragColor \x3d highlightData(gl_FragCoord, depthTex, highlightViewportPixelSz);\r\n}\r\n",
"highlightPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform vec4 overlayTexScale;\r\nuniform vec4 overlayTexOffset;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vpos;\r\nvarying vec4 vtcOverlay;\r\n\r\nvoid main() {\r\n  #ifdef SPHERICAL\r\n    vec3 vnormal \x3d normalize(position + origin);\r\n  #else\r\n    vec3 vnormal \x3d vec3(0, 0, 1); // WARNING: up-axis dependent code\r\n  #endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, vnormal, skirtScale);\r\n\r\n  vtcOverlay \x3d vec4(uv, uv) * overlayTexScale + overlayTexOffset;\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n}\r\n",
"normalPass.frag":"#include \x3cutil/fsPrecision.glsl\x3e\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main() {\r\n  vec3 normal \x3d normalize(vnormal);\r\n  if (gl_FrontFacing \x3d\x3d false) normal \x3d -normal;\r\n\r\n#ifndef ALPHA_ZERO\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 1.0);\r\n#else\r\n  gl_FragColor \x3d vec4(vec3(.5) + .5 * normal, 0.0);\r\n#endif\r\n}\r\n","normalPass.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n#include \x3cterrainRenderer/skirts.glsl\x3e\r\n\r\nuniform vec3 origin;\r\nuniform mat4 proj;\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\nuniform float skirtScale;\r\n\r\nattribute vec3 position;\r\nattribute vec2 uv0;\r\n\r\nvarying vec3 vnormal;\r\nvarying vec3 vpos;\r\n\r\nvoid main(void) {\r\n#ifdef SPHERICAL\r\n  vec4 normal \x3d vec4(normalize(position + origin), 1.0);\r\n#else\r\n  vec4 normal \x3d vec4(0.0, 0.0, 1.0, 1.0);\r\n#endif\r\n\r\n  vec2 uv \x3d uv0;\r\n  vpos \x3d applySkirts(uv, position, normal.xyz, skirtScale);\r\n\r\n  gl_Position \x3d proj * view * vec4(vpos, 1.0);\r\n  vnormal \x3d normalize((viewNormal * normal).xyz);\r\n}\r\n",
"overlay.glsl":"vec4 getOverlayColor(sampler2D overlay0Tex, sampler2D overlay1Tex, vec4 texCoords, float opacity) {\r\n  vec4 color \x3d vec4(0, 0, 0, 0);\r\n\r\n  if ((texCoords.x \x3e 0.0) \x26\x26 (texCoords.x \x3c 1.0) \x26\x26 (texCoords.y \x3e 0.0) \x26\x26 (texCoords.y \x3c 1.0)) {\r\n    // inner overlay texture coordinates are within bounds -\x3e sample from inner overlay\r\n    color \x3d texture2D(overlay0Tex, texCoords.xy);\r\n  } else if ((texCoords.z \x3e 0.0) \x26\x26 (texCoords.z \x3c 1.0) \x26\x26 (texCoords.w \x3e 0.0) \x26\x26 (texCoords.w \x3c 1.0)) {\r\n    // sample from outer overlay\r\n    color \x3d texture2D(overlay1Tex, texCoords.zw);\r\n  }\r\n\r\n  return color * opacity;\r\n}\r\n",
"skirts.glsl":'vec3 applySkirts(inout vec2 uv, vec3 vpos, vec3 vnormal, float skirtScale) {\r\n  float skirtLength \x3d 0.0;\r\n\r\n  if (uv.x \x3e\x3d 2.0) {\r\n    skirtLength \x3d uv.y * skirtScale;\r\n    // decode original uv-coordinates (see "encodeSkirtPos")\r\n    vec2 x \x3d vec2(uv.x) - vec2(3.5, 4.5);\r\n    uv \x3d clamp(vec2(1.5) - abs(x), vec2(0.0), vec2(1.0));\r\n  }\r\n\r\n  return vpos - vnormal * skirtLength;\r\n}\r\n'},util:{"alignPixel.glsl":"vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1), bias towards right pixel edge\r\n  vec2 xy \x3d vec2(.500123) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel center\r\n  vec2 ij \x3d (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n\r\nvec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {\r\n  // From clip space to (0 : 1),\r\n  vec2 xy \x3d vec2(.5) + .5 * clipCoord.xy / clipCoord.w;\r\n\r\n  // Size of a pixel in range (0 : 1)\r\n  vec2 pixelSz \x3d vec2(1.0) / widthHeight;\r\n\r\n  // Round to nearest pixel border, (0 : 1)\r\n  vec2 ij \x3d floor((xy + .5 * pixelSz) * widthHeight) * pixelSz;\r\n\r\n  // Convert back to clip space\r\n  vec2 result \x3d (ij * 2.0 - vec2(1.0)) * clipCoord.w;\r\n\r\n  return vec4(result, clipCoord.zw);\r\n}\r\n",
"color.glsl":"vec4 premultiplyAlpha(vec4 v) {\r\n  return vec4(v.rgb * v.a, v.a);\r\n}\r\n\r\nvec3 rgb2hsv(vec3 c) {\r\n  vec4 K \x3d vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\r\n  vec4 p \x3d mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\r\n  vec4 q \x3d mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\r\n\r\n  float d \x3d q.x - min(q.w, q.y);\r\n  float e \x3d 1.0e-10;\r\n  return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\r\n}\r\n\r\nvec3 hsv2rgb(vec3 c) {\r\n  vec4 K \x3d vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\r\n  vec3 p \x3d abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\r\n  return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\r\n}\r\n",
"depth.glsl":"float calcFragDepth(const in float depth) {\r\n  //calc polygon offset\r\n  const float SLOPE_SCALE \x3d 2.0;\r\n  const float BIAS \x3d 2.0 * .000015259;    // 1 / (2^16 - 1)\r\n  float m \x3d max(abs(dFdx(depth)), abs(dFdy(depth)));\r\n  float result \x3d depth + SLOPE_SCALE * m + BIAS;\r\n  return clamp(result, .0, .999999);\r\n}\r\n","doublePrecision.glsl":"// based on https://www.thasler.com/blog/blog/glsl-part2-emu\r\nvec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\r\n  vec3 t1 \x3d hiA + hiB;\r\n  vec3 e \x3d t1 - hiA;\r\n  vec3 t2 \x3d ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\r\n  return t1 + t2;\r\n}\r\n",
"enableExtensions.glsl":"\r\n#extension GL_OES_standard_derivatives : enable\r\n#extension GL_EXT_shader_texture_lod : enable\r\n","encoding.glsl":"// This is the maximum float value representable as 32bit fixed point,\r\n// it is rgba2float(vec4(1)) inlined.\r\nconst float MAX_RGBA_FLOAT \x3d\r\n  255.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 +\r\n  255.0 / 256.0 / 256.0 / 256.0 / 256.0;\r\n\r\n// Factors to convert to fixed point, i.e. factors (256^0, 256^1, 256^2, 256^3)\r\nconst vec4 fixedPointFactors \x3d vec4(1, 256, 256 * 256, 256 * 256 * 256);\r\n\r\nvec4 float2rgba(const float value) {\r\n  // Make sure value is in the domain we can represent\r\n  float valueInValidDomain \x3d clamp(value, 0.0, MAX_RGBA_FLOAT);\r\n\r\n  // Decompose value in 32bit fixed point parts represented as\r\n  // uint8 rgba components. Decomposition uses the fractional part after multiplying\r\n  // by a power of 256 (this removes the bits that are represented in the previous\r\n  // component) and then converts the fractional part to 8bits.\r\n  vec4 fixedPointU8 \x3d floor(fract(valueInValidDomain * fixedPointFactors) * 256.0);\r\n\r\n  // Convert uint8 values (from 0 to 255) to floating point representation for\r\n  // the shader\r\n  const float toU8AsFloat \x3d 1.0 / 255.0;\r\n\r\n  return fixedPointU8 * toU8AsFloat;\r\n}\r\n\r\n// Factors to convert rgba back to float\r\nconst vec4 rgba2float_factors \x3d vec4(\r\n  255.0 / (256.0),\r\n  255.0 / (256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0),\r\n  255.0 / (256.0 * 256.0 * 256.0 * 256.0)\r\n);\r\n\r\nfloat rgba2float(vec4 rgba) {\r\n  // Convert components from 0-\x3e1 back to 0-\x3e255 and then\r\n  // add the components together with their corresponding\r\n  // fixed point factors, i.e. (256^1, 256^2, 256^3, 256^4)\r\n  return dot(rgba, rgba2float_factors);\r\n}\r\n",
"fsPrecision.glsl":"#ifdef GL_FRAGMENT_PRECISION_HIGH\r\nprecision highp float;\r\nprecision highp sampler2D;\r\n#else\r\nprecision mediump float;\r\nprecision mediump sampler2D;\r\n#endif\r\n","highlight.glsl":"vec4 highlightData(vec4 fragCoord, sampler2D depthTex, vec4 viewportPixelSize) {\r\n  float sceneDepth \x3d texture2D(depthTex, (fragCoord.xy - viewportPixelSize.xy) * viewportPixelSize.zw).r;\r\n  if (fragCoord.z \x3e sceneDepth + 5e-6) {\r\n    return vec4(1.0, 1.0, 0.0, 1.0);\r\n  }\r\n  else {\r\n    return vec4(1.0, 0.0, 1.0, 1.0);\r\n  }\r\n}\r\n",
"hud.glsl":"#include \x3cutil/screenSizePerspective.glsl\x3e\r\n\r\nattribute vec3 position;\r\nattribute vec3 normal;\r\nattribute vec4 auxpos1;\r\n\r\nuniform mat4 proj;\r\n\r\nuniform mat4 view;\r\nuniform mat4 viewNormal;\r\n\r\nuniform mat4 model;\r\nuniform mat4 modelNormal;\r\n\r\nuniform vec4 viewport;\r\n\r\nuniform vec3 camPos;\r\n\r\nuniform float polygonOffset;\r\nuniform float cameraGroundRelative;\r\nuniform float pixelRatio;\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n// [ screenLength, distanceFactor, minWorldLength, maxWorldLength ]\r\nuniform vec4 verticalOffset;\r\n\r\n#endif\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n// [ divisor, offset, minPixelSize, paddingPixels ]\r\nuniform vec4 screenSizePerspectiveAlignment;\r\n\r\n#endif\r\n\r\nuniform sampler2D hudVisibilityTexture;\r\n\r\n\r\n// Corresponds to cos(10 deg), used to compare against dot product of two vectors\r\nconst float SMALL_OFFSET_ANGLE \x3d 0.984807753012208;\r\n\r\nstruct ProjectHUDAux {\r\n  vec3 posModel;\r\n  vec3 posView;\r\n  vec3 vnormal;\r\n\r\n  float distanceToCamera;\r\n  float absCosAngle;\r\n};\r\n\r\n\r\n/**\r\n  * Apply the simulated polygon offset for HUD objects that improves\r\n  * issues with Z-fighting.\r\n  *\r\n  * @param posView {vec3} (inout) the position in view space. Will be modified in place.\r\n  * @param pointGroundDistance {float} the distance from the point geometry to the ground surface.\r\n  * @param absCosAngle {float} the absolute cosine of the angle between the world-up at the point geometry\r\n  *   and the view direction.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nfloat applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {\r\n  float pointGroundSign \x3d sign(pointGroundDistance);\r\n\r\n  if (pointGroundSign \x3d\x3d 0.0) {\r\n    pointGroundSign \x3d 1.0;\r\n  }\r\n\r\n  // cameraGroundRelative is -1 if camera is below ground, 1 if above ground\r\n  // groundRelative is 1 if both camera and symbol are on the same side of the ground, -1 otherwise\r\n  float groundRelative \x3d cameraGroundRelative * pointGroundSign;\r\n\r\n  // view angle dependent part of polygon offset emulation\r\n  // we take the absolute value because the sign that is dropped is\r\n  // instead introduced using the ground-relative position of the symbol and the camera\r\n  if (polygonOffset \x3e .0) {\r\n    float cosAlpha \x3d clamp(absCosAngle, 0.01, 1.0);\r\n\r\n    float tanAlpha \x3d sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;\r\n    float factor \x3d (1.0 - tanAlpha / viewport[2]);\r\n\r\n    // same side of the terrain\r\n    if (groundRelative \x3e 0.0) {\r\n      posView *\x3d factor;\r\n    }\r\n    // opposite sides of the terrain\r\n    else {\r\n      posView /\x3d factor;\r\n    }\r\n  }\r\n\r\n  return groundRelative;\r\n}\r\n\r\n/**\r\n  * Project the 3d position of a HUD object from world space to clip space. In addition\r\n  * to standard model view projection, it also emulates a polygon offset to\r\n  * help with points above/below ground and icon flickering. The resulting location\r\n  * is the anchor of the HUD object, i.e. the position that is used also for testing\r\n  * visibility of the HUD object. Note that the returned projected position is not\r\n  * aligned to a pixel center or border, it is up to the caller to align if necessary.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Attributes:\r\n  *     - position: contains the point world position\r\n  *     - normal: contains the world normal pointing up at the point\r\n  *     - auxpos1: contains centerOffset and pointGroundDistance\r\n  *\r\n  *   Uniforms:\r\n  *     - model: the object -\x3e world transformation matrix\r\n  *     - modelNormal: the object -\x3e world normal transformation matrix (inv transp of model)\r\n  *     - view: the world -\x3e view transformation matrix\r\n  *     - viewNormal: the world -\x3e view normal transformation matrix (inv transp of view)\r\n  *     - proj: the view -\x3e clip projection matrix\r\n  *     - verticalOffset: a vec4 containing:\r\n  *         - the screen height of the vertical offset\r\n  *         - the screen height of the vertical offset as a fraction of camera distance.\r\n  *         - the minimum world size vertical offset.\r\n  *         - the maximum world size vertical offset.\r\n  *       This will do a screen sized offset of the point along its normal (used for line callouts)\r\n  *     - screenSizePerspectiveAlignment: a vec3 containing\r\n  *         - the view distance dependent divisor\r\n  *         - the view distance dependent offset\r\n  *         - the minimum pixel size\r\n  *         - the amount of padding in pixels around the region to be scaled (not used for alignment)\r\n  *     - cameraGroundRelative: indicates whether camera is above (1) or below (-1) ground.\r\n  *         This is used for emulated polygon offset for improved visibility of points sitting on the surface.\r\n  *     - polygonOffset: a constant polygon offset to bring the point closer to the viewer for\r\n  *         reduced flickering.\r\n  *     - camPos: the position of the camera in world space\r\n  *     - viewport: the viewport [x, y, width, height]\r\n  */\r\nvec4 projectPositionHUD(out ProjectHUDAux aux) {\r\n  // centerOffset is in view space and is used to implement world size offsetting\r\n  // of labels with respect to objects. It also pulls the label towards the viewer\r\n  // so that the label is visible in front of the object.\r\n  vec3 centerOffset \x3d auxpos1.xyz;\r\n\r\n  // The pointGroundDistance is the distance of the geometry to the ground and is\r\n  // negative if the point is below the ground, or positive if the point is above\r\n  // ground.\r\n  float pointGroundDistance \x3d auxpos1.w;\r\n\r\n  aux.posModel \x3d (model * vec4(position, 1.0)).xyz;\r\n  aux.posView \x3d (view * vec4(aux.posModel, 1.0)).xyz;\r\n  aux.vnormal \x3d (modelNormal * vec4(normal, 1.0)).xyz;\r\n\r\n  // Screen sized offset in world space, used for example for line callouts\r\n  // Note: keep this implementation in sync with the CPU implementation, see\r\n  //   - MaterialUtil.verticalOffsetAtDistance\r\n  //   - HUDMaterial.applyVerticalOffsetTransformation\r\n\r\n  aux.distanceToCamera \x3d length(aux.posView);\r\n\r\n  vec3 viewDirObjSpace \x3d normalize(camPos - aux.posModel);\r\n  float cosAngle \x3d dot(aux.vnormal, viewDirObjSpace);\r\n\r\n  aux.absCosAngle \x3d abs(cosAngle);\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n\r\n#if defined(VERTICAL_OFFSET) || defined(CENTER_OFFSET_UNITS_SCREEN)\r\n  vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);\r\n#endif\r\n\r\n#endif\r\n\r\n#ifdef VERTICAL_OFFSET\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);\r\n#else\r\n  float verticalOffsetScreenHeight \x3d verticalOffset.x;\r\n#endif\r\n\r\n  float worldOffset \x3d clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);\r\n  vec3 modelOffset \x3d aux.vnormal * worldOffset;\r\n\r\n  aux.posModel +\x3d modelOffset;\r\n\r\n  vec3 viewOffset \x3d (viewNormal * vec4(modelOffset, 1.0)).xyz;\r\n  aux.posView +\x3d viewOffset;\r\n\r\n  // Since we elevate the object, we need to take that into account\r\n  // in the distance to ground\r\n  pointGroundDistance +\x3d worldOffset;\r\n\r\n#endif\r\n\r\n  float groundRelative \x3d applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);\r\n\r\n#ifndef CENTER_OFFSET_UNITS_SCREEN\r\n  // Apply x/y in view space, but z in screen space (i.e. along posView direction)\r\n  aux.posView +\x3d vec3(centerOffset.x, centerOffset.y, 0);\r\n\r\n  // Same material all have same z !\x3d 0.0 condition so should not lead to\r\n  // branch fragmentation and will save a normalization if it's not needed\r\n  if (centerOffset.z !\x3d 0.0) {\r\n    aux.posView -\x3d normalize(aux.posView) * centerOffset.z;\r\n  }\r\n#endif\r\n\r\n  vec4 posProj \x3d proj * vec4(aux.posView, 1.0);\r\n\r\n#ifdef CENTER_OFFSET_UNITS_SCREEN\r\n\r\n#ifdef SCREEN_SIZE_PERSPECTIVE\r\n  float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);\r\n#else\r\n  float centerOffsetY \x3d centerOffset.y;\r\n#endif\r\n\r\n  posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;\r\n\r\n#endif\r\n\r\n  // constant part of polygon offset emulation\r\n  posProj.z -\x3d groundRelative * polygonOffset * posProj.w;\r\n\r\n  return posProj;\r\n}\r\n\r\nuniform float uRenderTransparentlyOccludedHUD;\r\n\r\n/**\r\n  * Test for visibility of a HUD object.\r\n  *\r\n  * Dependencies:\r\n  *\r\n  *   Uniforms:\r\n  *     - hudVisibilityTexture: the texture that contains the visibility information\r\n  *     - markerColor: the special marker color that is used to write visibility information\r\n  *     - viewport: the viewport\r\n  */\r\nbool testVisibilityHUD(vec4 posProj) {\r\n  // For occlusion testing, use the nearest pixel center to avoid\r\n  // subpixel filtering messing up the color we use to test for\r\n  vec4 posProjCenter \x3d alignToPixelCenter(posProj, viewport.zw);\r\n\r\n  vec4 occlusionPixel \x3d texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);\r\n\r\n  // the red pixel here indicates that the occlusion pixel passed the depth test against solid geometry and was written\r\n  // the green pixel stores transparency of transparent geometry (1.0 -\x3e fully transparent)\r\n  // note that we also check against green \x3d\x3d 0.0, i.e. transparent geometry that has opaque parts\r\n\r\n  // thus we render visible pixels that are occluded by semi-transparent (but not fully transparent!) geometry here\r\n  if (uRenderTransparentlyOccludedHUD \x3e 0.5) {\r\n    // multiplying by uRenderTransparentlyOccludedHUD allows us to ignore the second condition if\r\n    // uRenderTransparentlyOccludedHUD \x3d 0.75\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g * uRenderTransparentlyOccludedHUD \x3c 1.0;\r\n  }\r\n  // and visible pixels that are not occluded by semi-transparent geometry here\r\n  else {\r\n    return occlusionPixel.r * occlusionPixel.g \x3e 0.0 \x26\x26 occlusionPixel.g \x3d\x3d 1.0;\r\n  }\r\n\r\n  // return texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w).r \x3e 0.0;\r\n}\r\n",
"normalEncoding.glsl":"vec3 decodeNormal(vec2 f) {\r\n    float z \x3d 1.0 - abs(f.x) - abs(f.y);\r\n    return vec3(f + sign(f) * min(z, 0.0), z);\r\n}\r\n","quad.vert":"#include \x3cutil/vsPrecision.glsl\x3e\r\n\r\nattribute vec2 position;\r\nvarying vec2 uv;\r\n\r\nvoid main(void) {\r\n  gl_Position \x3d vec4(position.x, position.y, .0, 1.0);\r\n  uv \x3d position * .5 + vec2(.5);\r\n}\r\n","sceneLighting.glsl":"// Scene Lighting Definitions:\r\n// \x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\r\n\r\n// defines:\r\n//   - SH_ORDER: 1|2|3\r\n// input:\r\n//   - normal: vec3\r\n//   - albedo: vec3\r\n//   - shadow: float\r\n//   - ssao: float\r\n// return:\r\n//   - color: vec3\r\n\r\n// main light\r\n/////////////////////////////////////////\r\nuniform vec3 lightingMainDirection;\r\nuniform vec3 lightingMainIntensity;\r\n\r\n// ambient lighting\r\n/////////////////////////////////////////\r\n#ifndef SH_ORDER\r\n  #define SH_ORDER 2\r\n#endif\r\n\r\n#if SH_ORDER \x3d\x3d 0\r\n  uniform vec3 lightingAmbientSH0;\r\n#elif SH_ORDER \x3d\x3d 1\r\n  uniform vec4 lightingAmbientSH_R;\r\n  uniform vec4 lightingAmbientSH_G;\r\n  uniform vec4 lightingAmbientSH_B;\r\n#elif SH_ORDER \x3d\x3d 2\r\n  uniform vec3 lightingAmbientSH0;\r\n  uniform vec4 lightingAmbientSH_R1;\r\n  uniform vec4 lightingAmbientSH_G1;\r\n  uniform vec4 lightingAmbientSH_B1;\r\n  uniform vec4 lightingAmbientSH_R2;\r\n  uniform vec4 lightingAmbientSH_G2;\r\n  uniform vec4 lightingAmbientSH_B2;\r\n#endif\r\n\r\n// special tweaking\r\n//////////////////////////////////////////\r\nuniform float lightingFixedFactor;\r\nuniform float lightingGlobalFactor;\r\n\r\nuniform float ambientBoostFactor;\r\n\r\n// evaluation\r\n//////////////////////////////////////////\r\n\r\nvec3 evaluateSceneLighting(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight) {\r\n  // evaluate the main light\r\n  float dotVal \x3d mix(clamp(-dot(normal, lightingMainDirection), 0.0, 1.0), 1.0, lightingFixedFactor);\r\n  vec3 mainLight \x3d (1.0 - shadow) * lightingMainIntensity * dotVal;\r\n\r\n  // evaluate the sh ambient light\r\n  #if SH_ORDER \x3d\x3d 0\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n  #elif SH_ORDER \x3d\x3d 1\r\n    vec4 sh0 \x3d vec4(\r\n      0.282095,\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y\r\n    );\r\n    vec3 ambientLight \x3d vec3(\r\n      dot(lightingAmbientSH_R, sh0),\r\n      dot(lightingAmbientSH_G, sh0),\r\n      dot(lightingAmbientSH_B, sh0)\r\n    );\r\n  #elif SH_ORDER \x3d\x3d 2\r\n    vec3 ambientLight \x3d 0.282095 * lightingAmbientSH0;\r\n\r\n    vec4 sh1 \x3d vec4(\r\n      0.488603 * normal.x,\r\n      0.488603 * normal.z,\r\n      0.488603 * normal.y,\r\n      1.092548 * normal.x * normal.y\r\n    );\r\n    vec4 sh2 \x3d vec4(\r\n      1.092548 * normal.y * normal.z,\r\n      0.315392 * (3.0 * normal.z * normal.z - 1.0),\r\n      1.092548 * normal.x * normal.z,\r\n      0.546274 * (normal.x * normal.x - normal.y * normal.y)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R1, sh1),\r\n      dot(lightingAmbientSH_G1, sh1),\r\n      dot(lightingAmbientSH_B1, sh1)\r\n    );\r\n    ambientLight +\x3d vec3(\r\n      dot(lightingAmbientSH_R2, sh2),\r\n      dot(lightingAmbientSH_G2, sh2),\r\n      dot(lightingAmbientSH_B2, sh2)\r\n    );\r\n  #endif\r\n  ambientLight *\x3d (1.0 - ssao);\r\n\r\n  // inverse gamma correction on the albedo color\r\n  float gamma \x3d 2.1;\r\n  vec3 albedoGammaC \x3d pow(albedo, vec3(gamma));\r\n\r\n  // physically correct BRDF normalizes by PI\r\n  const float PI \x3d 3.14159;\r\n  vec3 totalLight \x3d mainLight + ambientLight + additionalLight;\r\n  totalLight \x3d min(totalLight, vec3(PI, PI, PI));\r\n  vec3 outColor \x3d vec3((albedoGammaC / PI) * (totalLight));\r\n\r\n  // apply gamma correction to the computed color\r\n  outColor \x3d pow(outColor, vec3(1.0/gamma));\r\n\r\n  return outColor;\r\n}\r\n\r\nvec3 sceneLightingAdditionalLightGlobal(vec3 worldPos, float ssao, out float additionalAmbientScale) {\r\n  // heuristic lighting model originally used in the terrain shading\r\n  // now used to generated additional ambient light\r\n\r\n#ifdef VIEWING_MODE_GLOBAL\r\n    float vndl \x3d -dot(normalize(worldPos), lightingMainDirection);\r\n#else\r\n    float vndl \x3d -dot(vec3(0,0,1), lightingMainDirection);\r\n#endif\r\n\r\n  additionalAmbientScale \x3d smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));\r\n  return ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;\r\n}\r\n",
"screenSizePerspective.glsl":"// Note that the implementation here should be kept in sync with the corresponding\r\n// CPU implementation (used for hitTest etc) in screenSizePerspectiveUtils.ts\r\n\r\n/**\r\n * Compute the screen size perspective lower bound from pre-computed screen\r\n * size perspective factors (or parameters, since both store the pixel lower\r\n * bound information in the same place). When computing the minimum size,\r\n * the padding (e.g. text halo) is scaled with the same factor as the\r\n * original size scales to reach the minimum size.\r\n *\r\n * {\r\n *    x: N/A\r\n *    y: N/A\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveMinSize(float size, vec4 factor) {\r\n\r\n  // Original calculation:\r\n  //   padding \x3d 2 * factor.w\r\n  //   minSize \x3d factor.z\r\n  //\r\n  //   minSize + minSize / size * padding\r\n  //\r\n  // Incorporates padding (factor.w, e.g. text halo size) into the\r\n  // minimum bounds calculation, taking into account that padding\r\n  // would scale down proportionally to the size.\r\n  //\r\n  // Calculation below is the same, but avoids division by zero when\r\n  // size would be zero, without branching using step.\r\n  // https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10683\r\n\r\n  // nonZeroSize is 1 if size \x3e 0, and 0 otherwise\r\n  float nonZeroSize \x3d 1.0 - step(size, 0.0);\r\n\r\n  return (\r\n    factor.z * (\r\n      1.0 +\r\n      nonZeroSize *                // Multiply by nzs ensures if size is 0, then we ignore\r\n                                   // proportionally scaled padding\r\n      2.0 * factor.w / (\r\n        size + (1.0 - nonZeroSize) // Adding 1 - nzs ensures we divide either by size, or by 1\r\n      )\r\n    )\r\n  );\r\n}\r\n\r\n/**\r\n * Computes the view angle dependent screen size perspective factor. The goal\r\n * of this factor is that:\r\n *\r\n *   1. There is no perspective when looking top-down\r\n *   2. There is a smooth and quick transition to full perspective when\r\n *      tilting.\r\n */\r\nfloat screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {\r\n  return absCosAngle * absCosAngle * absCosAngle;\r\n}\r\n\r\n/**\r\n * Precomputes a set of factors that can be used to apply screen size perspective\r\n * The factors are based on the viewing angle, distance to camera and the screen size\r\n * perspective parameters:\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n *\r\n * The result is a set of factors that can be used to apply the perspective:\r\n *\r\n * {\r\n *    x: distance based relative scale factor (0 -\x3e 1)\r\n *    y: view dependent scale factor\r\n *    z: minPixelSize (abs)\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return vec4(min(params.x / (distanceToCamera - params.y), 1.0), screenSizePerspectiveViewAngleDependentFactor(absCosAngle), params.z, params.w);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorFloat.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleFloat can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorFloat.\r\n */\r\n\r\nfloat applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {\r\n  return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a single dimension size, given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nfloat screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorFloat(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n\r\n/**\r\n * Applies screen size perspective factors to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters. The factors can be calculated from the screen size\r\n * perspective parameters using screenSizePerspectiveScaleFactorVec2.\r\n *\r\n * Note that for single scale application, the screenSizePerspectiveScaleVec2 can be used, which\r\n * will call this method, providing it the factors calculated from screenSizePerspectiveScaleFactorVec2.\r\n */\r\nvec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {\r\n  return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / size.y, 1.0), size, factor.y);\r\n}\r\n\r\n/**\r\n * Applies screen size perspective parameters to a vec2 size (width/height), given the viewing angle,\r\n * distance to camera and perspective parameters\r\n * {\r\n *    x: distanceDivisor,\r\n *    y: distanceOffset,\r\n *    z: minPixelSize (abs),\r\n *    w: sizePaddingInPixels (abs)\r\n * }\r\n */\r\nvec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {\r\n  return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));\r\n}\r\n",
"shadow.glsl":'#include \x3cutil/encoding.glsl\x3e\r\n\r\n// "matrix" parameter used to have const qualifier as well, but IE11 couldn\'t deal with it at time of writing.\r\n// once IE11 is fine with it, const should probably be re-introduced\r\nfloat evalShadow(const in vec3 vpos, const in float depth, const in sampler2D depthTex, const int num, const in vec4 distance, in mat4 matrix[4], const in float halfPxSz) {\r\n  //choose correct cascade\r\n  int i \x3d depth \x3c distance[1] ? 0 : depth \x3c distance[2] ? 1 : depth \x3c distance[3] ? 2 : 3;\r\n\r\n  if (i \x3e\x3d num) { return .0; }\r\n\r\n  mat4 mat \x3d i \x3d\x3d 0 ? matrix[0] : i \x3d\x3d 1 ? matrix[1] : i \x3d\x3d 2 ? matrix[2] : matrix[3];\r\n\r\n  vec4 lv \x3d mat * vec4(vpos, 1.0);\r\n  lv.xy /\x3d lv.w;\r\n\r\n  //vertex completely outside? -\x3e no shadow\r\n  vec3 lvpos \x3d .5 * lv.xyz + vec3(.5);\r\n  if (lvpos.z \x3e\x3d 1.0) { return .0; }\r\n  if (lvpos.x \x3c .0 || lvpos.x \x3e 1.0 || lvpos.y \x3c .0 || lvpos.y \x3e 1.0) { return .0; }\r\n\r\n  //calc coord in cascade texture\r\n  vec2 uv \x3d vec2(float(i - 2 * (i / 2)) *.5, float(i / 2) * .5) + .5 * lvpos.xy;\r\n\r\n  float texSize \x3d .5 / halfPxSz;\r\n\r\n  //filter, offset by half pixels\r\n  vec2 st \x3d fract((vec2(halfPxSz) + uv) * texSize);\r\n\r\n  float s00 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s10 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, -halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s11 \x3d rgba2float(texture2D(depthTex, uv + vec2(halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n  float s01 \x3d rgba2float(texture2D(depthTex, uv + vec2(-halfPxSz, halfPxSz))) \x3c lvpos.z ? 1.0 : .0;\r\n\r\n  return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);\r\n}\r\n',
"slice.glsl":"#ifdef SLICE\r\nuniform vec3 slicePlaneOrigin;\r\nuniform vec3 slicePlaneBasis1;\r\nuniform vec3 slicePlaneBasis2;\r\n\r\nbool sliceByPlane(vec3 pos) {\r\n  vec3 rel \x3d pos - slicePlaneOrigin;\r\n\r\n  vec3 slicePlaneNormal \x3d cross(slicePlaneBasis1, slicePlaneBasis2);\r\n  float slicePlaneW \x3d -dot(slicePlaneNormal, slicePlaneOrigin);\r\n\r\n  float basis1Len2 \x3d dot(slicePlaneBasis1, slicePlaneBasis1);\r\n  float basis2Len2 \x3d dot(slicePlaneBasis2, slicePlaneBasis2);\r\n\r\n  float basis1Dot \x3d dot(slicePlaneBasis1, rel);\r\n  float basis2Dot \x3d dot(slicePlaneBasis2, rel);\r\n\r\n  return (dot(slicePlaneNormal, pos) + slicePlaneW) \x3c 0.0\r\n    \x26\x26 -basis1Dot - basis1Len2 \x3c 0.0\r\n    \x26\x26 basis1Dot - basis1Len2 \x3c 0.0\r\n    \x26\x26 -basis2Dot - basis2Len2 \x3c 0.0\r\n    \x26\x26 basis2Dot - basis2Len2 \x3c 0.0;\r\n}\r\n\r\n#define rejectBySlice(_pos_) sliceByPlane(_pos_)\r\n#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }\r\n\r\n#else // SLICE\r\n\r\n#define rejectBySlice(_pos_) false\r\n#define discardBySlice(_pos_) {}\r\n\r\n#endif // SLICE\r\n",
"visualVariables.glsl":"#if defined(VV_SIZE)\r\n  #define VV_CUSTOM_MODEL_MATRIX\r\n#endif\r\n\r\n#if defined(VV_SIZE)\r\n  uniform vec3 vvSizeMinSize;\r\n  uniform vec3 vvSizeMaxSize;\r\n  uniform vec3 vvSizeOffset;\r\n  uniform vec3 vvSizeFactor;\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  uniform vec3 vvSizeValue;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform mat3 vvSymbolRotation;\r\n#endif\r\n\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  uniform vec3 vvSymbolAnchor;\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  #define VV_COLOR_N 8\r\n  uniform float vvColorValues[VV_COLOR_N];\r\n  uniform vec4 vvColorColors[VV_COLOR_N];\r\n#endif\r\n\r\n// Evaluation of size\r\n#if defined(VV_SIZE)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return clamp(vvSizeOffset + featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);\r\n  }\r\n#elif defined(VV_CUSTOM_MODEL_MATRIX)\r\n  vec3 vvGetScale(vec4 featureAttribute) {\r\n    return vvSizeValue;\r\n  }\r\n#endif\r\n\r\n// Applying the model matrix\r\n#ifdef VV_CUSTOM_MODEL_MATRIX\r\n  vec4 vvTransformPosition(vec3 position, vec4 featureAttribute) {\r\n    return vec4(vvSymbolRotation * (vvGetScale(featureAttribute) * (position + vvSymbolAnchor)), 1.0);\r\n  }\r\n\r\n  vec4 vvTransformNormal(vec3 normal, vec4 featureAttribute) {\r\n    // Normal transform is the inverse transpose of model transform\r\n    return vec4(vvSymbolRotation * normal / vvGetScale(featureAttribute), 1.0);\r\n  }\r\n#endif\r\n\r\n#ifdef VV_COLOR\r\n  vec4 vvGetColor(vec4 featureAttribute, float values[VV_COLOR_N], vec4 colors[VV_COLOR_N]) {\r\n    float value \x3d featureAttribute.y;\r\n    if (value \x3c\x3d values[0]) {\r\n      return colors[0];\r\n    }\r\n\r\n    for (int i \x3d 1; i \x3c VV_COLOR_N; ++i) {\r\n      if (values[i] \x3e\x3d value) {\r\n        float f \x3d (value - values[i-1]) / (values[i] - values[i-1]);\r\n        return mix(colors[i-1], colors[i], f);\r\n      }\r\n    }\r\n\r\n    return colors[VV_COLOR_N - 1];\r\n  }\r\n#endif\r\n",
"vsPrecision.glsl":"precision highp float;\r\nprecision highp sampler2D;\r\n"}}})},"esri/views/webgl/ShaderCompiler":function(){define(["require","exports"],function(n,g){return function(){function c(a){this.readFile=a}c.prototype.resolveIncludes=function(a){return this.resolve(a)};c.prototype.resolve=function(a,c){var b=this;void 0===c&&(c=new Map);if(c.has(a))return c.get(a);var f=this.read(a);if(!f)throw Error("cannot find shader file "+a);for(var e=/^\h?#include\s+<(\S+)>\h?/gm,h=e.exec(f),m=
[];null!=h;)m.push({path:h[1],start:h.index,length:h[0].length}),h=e.exec(f);var k=0,d="";m.forEach(function(a){d+=f.slice(k,a.start);d+=c.has(a.path)?"":b.resolve(a.path,c);k=a.start+a.length});d+=f.slice(k);c.set(a,d);return d};c.prototype.read=function(a){return this.readFile(a)};return c}()})},"esri/views/webgl/programUtils":function(){define(["require","exports","./Program"],function(n,g,c){function a(a,b,l){l=l||{};l="function"===typeof b.shaders?b.shaders(l):b.shaders;return new c(a,l.vertexShader,
l.fragmentShader,b.attributes)}Object.defineProperty(g,"__esModule",{value:!0});g.glslifyDefineMap=function(a){var b="",c;for(c in a){var e=a[c];if("boolean"===typeof e)e&&(b+="#define "+c+"\n");else if("number"===typeof e)b+="#define "+c+" "+e.toFixed()+"\n";else if("object"===typeof e){var h=e.options,f=0,k;for(k in h)b+="#define "+h[k]+" "+(f++).toFixed()+"\n";b+="#define "+c+" "+h[e.value]+"\n"}}return b};n=function(){function c(a){this._programCacheByTemplate=new Map;this._rctx=a}c.prototype.dispose=
function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._programCacheByTemplate=null};c.prototype.getProgram=function(b,c){var e=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(h){return a(e._rctx,b,h)});return this.getProgramTemplateInstance(b,c)};c.prototype.addProgramTemplate=function(a,c){this._programCacheByTemplate.set(a,{constructor:c,programs:new Map})};c.prototype.getProgramTemplateInstance=function(a,c){if(a=
this._programCacheByTemplate.get(a)){var b=c?JSON.stringify(c):"default";a.programs.has(b)||(c=a.constructor(c),a.programs.set(b,c));return a.programs.get(b)}return null};return c}();g.ProgramCache=n;g.createProgram=a})},"esri/views/webgl/Program":function(){define(["require","exports","../../core/has","./ShaderTranspiler"],function(n,g,c,a){return function(){function c(a,f,e,h,m){void 0===m&&(m={});this._glName=this._context=null;this._locations={};this._id=void 0;this._initialized=!1;this._fShader=
this._vShader=null;this._defines={};this._nameToUniformLocation={};this._nameToAttribLocation={};this._nameToUniform1={};this._nameToUniform2={};this._nameToUniform3={};this._nameToUniform4={};this._nameToUniformMatrix3={};this._nameToUniformMatrix4={};a||console.error("RenderingContext isn't initialized!");0===f.length&&console.error("Shaders source should not be empty!");this._context=a;this._vertexShaderSource=f;this._fragmentShaderSource=e;if(Array.isArray(m))for(a=0;a<m.length;a++)this._defines[m[a]]=
"1";else this._defines=m;this._id=c._nextId++;this._locations=h}Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});c.prototype.getDefine=function(a){return this._defines[a]};c.prototype.dispose=function(){if(this._context){var a=
this._context.gl;this._vShader&&(a.deleteShader(this._vShader),this._vShader=null);this._fShader&&(a.deleteShader(this._fShader),this._fShader=null);this._glName&&(a.deleteProgram(this._glName),this._glName=null);this._context=null}};c.prototype.initialize=function(){if(!this._initialized){this._vShader=this._loadShader(35633);this._fShader=this._loadShader(35632);this._vShader&&this._fShader||console.error("Error loading shaders!");var a=this._context.gl,c=a.createProgram();a.attachShader(c,this._vShader);
a.attachShader(c,this._fShader);for(var e in this._locations)a.bindAttribLocation(c,this._locations[e],e);a.linkProgram(c);a.getProgramParameter(c,a.LINK_STATUS)||console.error("Could not initialize shader\nVALIDATE_STATUS: "+a.getProgramParameter(c,a.VALIDATE_STATUS)+", gl error ["+a.getError()+"]infoLog: "+a.getProgramInfoLog(c));this._glName=c;this._initialized=!0}};c.prototype.getUniformLocation=function(a){this.initialize();void 0===this._nameToUniformLocation[a]&&(this._nameToUniformLocation[a]=
this._context.gl.getUniformLocation(this._glName,a));return this._nameToUniformLocation[a]};c.prototype.hasUniform=function(a){return null!==this.getUniformLocation(a)};c.prototype.getAttribLocation=function(a){this.initialize();void 0===this._nameToAttribLocation[a]&&(this._nameToAttribLocation[a]=this._context.gl.getAttribLocation(this._glName,a));return this._nameToAttribLocation[a]};c.prototype.setUniform1i=function(a,c){var b=this._nameToUniform1[a];if(void 0===b||c!==b)this._context.bindProgram(this),
this._context.gl.uniform1i(this.getUniformLocation(a),c),this._nameToUniform1[a]=c};c.prototype.setUniform1f=function(a,c){var b=this._nameToUniform1[a];if(void 0===b||c!==b)this._context.bindProgram(this),this._context.gl.uniform1f(this.getUniformLocation(a),c),this._nameToUniform1[a]=c};c.prototype.setUniform1fv=function(a,c){var b=this._nameToUniform1[a];if(void 0===b||c[0]!==b)this._context.bindProgram(this),this._context.gl.uniform1fv(this.getUniformLocation(a),c),this._nameToUniform1[a]=c[0]};
c.prototype.setUniform2f=function(a,c,e){var b=this._nameToUniform2[a];if(void 0===b||c!==b[0]||e!==b[1])this._context.bindProgram(this),this._context.gl.uniform2f(this.getUniformLocation(a),c,e),void 0===b?this._nameToUniform2[a]=[c,e]:(b[0]=c,b[1]=e)};c.prototype.setUniform2fv=function(a,f){var b=this._nameToUniform2[a];void 0!==b&&c._arraysEqual(f,b)||(this._context.bindProgram(this),this._context.gl.uniform2fv(this.getUniformLocation(a),f),void 0===b?this._nameToUniform2[a]=c._arrayCopy(f):c._arrayAssign(f,
b))};c.prototype.setUniform3f=function(a,c,e,h){var b=this._nameToUniform3[a];if(void 0===b||c!==b[0]||e!==b[1]||h!==b[2])this._context.bindProgram(this),this._context.gl.uniform3f(this.getUniformLocation(a),c,e,h),void 0===b?this._nameToUniform3[a]=[c,e,h]:(b[0]=c,b[1]=e,b[2]=h)};c.prototype.setUniform3fv=function(a,f){var b=this._nameToUniform3[a];void 0!==b&&c._arraysEqual(f,b)||(this._context.bindProgram(this),this._context.gl.uniform3fv(this.getUniformLocation(a),f),void 0===b?this._nameToUniform3[a]=
c._arrayCopy(f):c._arrayAssign(f,b))};c.prototype.setUniform4f=function(a,c,e,h,f){var b=this._nameToUniform4[a];if(void 0===b||c!==b[0]||e!==b[1]||h!==b[2]||f!==b[3])this._context.bindProgram(this),this._context.gl.uniform4f(this.getUniformLocation(a),c,e,h,f),void 0===b?this._nameToUniform4[a]=[c,e,h,f]:(b[0]=c,b[1]=e,b[2]=h,b[3]=f)};c.prototype.setUniform4fv=function(a,f){var b=this._nameToUniform4[a];void 0!==b&&c._arraysEqual(f,b)||(this._context.bindProgram(this),this._context.gl.uniform4fv(this.getUniformLocation(a),
f),void 0===b?this._nameToUniform4[a]=c._arrayCopy(f):c._arrayAssign(f,b))};c.prototype.setUniformMatrix3fv=function(a,f,e){void 0===e&&(e=!1);var b=this._nameToUniformMatrix3[a];void 0!==b&&(9===b.length?c._matrix3Equal(b,f):c._arraysEqual(f,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix3fv(this.getUniformLocation(a),e,f),void 0===b?this._nameToUniformMatrix3[a]=c._arrayCopy(f):c._arrayAssign(f,b))};c.prototype.setUniformMatrix4fv=function(a,f,e){void 0===e&&(e=!1);var b=this._nameToUniformMatrix4[a];
void 0!==b&&(16===b.length?c._matrix4Equal(b,f):c._arraysEqual(f,b))||(this._context.bindProgram(this),this._context.gl.uniformMatrix4fv(this.getUniformLocation(a),e,f),void 0===b?this._nameToUniformMatrix4[a]=c._arrayCopy(f):c._arrayAssign(f,b))};c._padToThree=function(a){var b=a.toString();1E3>a&&(b=("  "+a).slice(-3));return b};c.prototype._addLineNumbers=function(a){var b=2;return a.replace(/\n/g,function(){return"\n"+c._padToThree(b++)+":"})};c.prototype._loadShader=function(b){var c=35633===
b,e=c?this._vertexShaderSource:this._fragmentShaderSource,h;h="";for(var f in this._defines)h+="#define "+f+" "+this._defines[f]+"\n";h+=e;"webgl2"===this._context.contextVersion&&(h=a.transpileShader(h,c?"vertex":"fragment"));c=this._context.gl;b=c.createShader(b);c.shaderSource(b,h);c.compileShader(b);c.getShaderParameter(b,c.COMPILE_STATUS)||(console.error(c.getShaderInfoLog(b)),console.error(this._addLineNumbers(h)),"webgl2"===this._context.contextVersion&&(console.log("Shader source before transpilation:"),
console.log(e)));return b};c._matrix4Equal=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]&&a[9]===c[9]&&a[10]===c[10]&&a[11]===c[11]&&a[12]===c[12]&&a[13]===c[13]&&a[14]===c[14]&&a[15]===c[15]};c._matrix3Equal=function(a,c){return a[0]===c[0]&&a[1]===c[1]&&a[2]===c[2]&&a[3]===c[3]&&a[4]===c[4]&&a[5]===c[5]&&a[6]===c[6]&&a[7]===c[7]&&a[8]===c[8]};c._arraysEqual=function(a,c){if(a.length!==c.length)return!1;for(var b=
0;b<a.length;++b)if(a[b]!==c[b])return!1;return!0};c._arrayCopy=function(a){for(var b=[],e=0;e<a.length;++e)b.push(a[e]);return b};c._arrayAssign=function(a,c){for(var b=0;b<a.length;++b)c[b]=a[b]};c._nextId=0;return c}()})},"esri/views/webgl/ShaderTranspiler":function(){define(["require","exports","./reservedWordsGLSL3","./lib/glsl-tokenizer/string"],function(n,g,c,a){function f(a){return a.map(function(a){return"eof"!==a.type?a.data:""}).join("")}function b(a,e,c,d){d=d||c;for(var h=0;h<a.length;h++){var f=
a[h];if("ident"===f.type&&f.data===c)return d in e?e[d]++:e[d]=0,b(a,e,d+"_"+e[d],d)}return c}function l(a,b,e){void 0===e&&(e="afterVersion");var d={data:"\n",type:"whitespace"},c=function(b){return b<a.length?/[^\r\n]$/.test(a[b].data):!1},h=function(a){for(var b=-1,d=0,c=-1,h=0;h<a.length;h++){var f=a[h];"preprocessor"===f.type&&(f.data.match(/\#(if|ifdef|ifndef)\s+.+/)?++d:f.data.match(/\#endif\s*.*/)&&--d);("afterVersion"===e||"afterPrecision"===e)&&"preprocessor"===f.type&&/^#version/.test(f.data)&&
(c=Math.max(c,h));if("afterPrecision"===e&&"keyword"===f.type&&"precision"===f.data){a:{for(f=h;f<a.length;f++){var k=a[f];if("operator"===k.type&&";"===k.data)break a}f=null}if(null===f)throw Error("precision statement not followed by any semicolons!");c=Math.max(c,f)}b<c&&0===d&&(b=h)}return b+1}(a);c(h-1)&&a.splice(h++,0,d);for(var f=0;f<b.length;f++){var k=b[f];a.splice(h++,0,k)}c(h-1)&&c(h)&&a.splice(h,0,d)}Object.defineProperty(g,"__esModule",{value:!0});var e=["GL_OES_standard_derivatives",
"GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"];g.transpileShader=function(h,m){h=a(h);var k;a:{k="100";var d="300 es";void 0===k&&(k="100");void 0===d&&(d="300 es");for(var q=/^\s*\#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/,p=0;p<h.length;p++){var r=h[p];if("preprocessor"===r.type){var u=q.exec(r.data);if(u)if(q=u[1].replace(/\s\s+/g," "),q===d){k=q;break a}else if(q===k){r.data="#version "+d;break a}else throw Error("unknown glsl version: "+q);}}h.splice(0,0,{type:"preprocessor",
data:"#version "+d},{type:"whitespace",data:"\n"});k=null}if("300 es"===k)throw Error("shader is already glsl 300 es");q=r=null;p={};u={};for(k=0;k<h.length;++k)switch(d=h[k],d.type){case "keyword":"vertex"===m&&"attribute"===d.data?d.data="in":"varying"===d.data&&(d.data="vertex"===m?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(d.data.trim())&&(d.data=d.data.replace(/(2D|Cube|EXT)/g,""));if("fragment"===m&&"gl_FragColor"===d.data){if(!r){var r=b(h,p,"fragColor"),
t=void 0;void 0===t&&(t="lowp");l(h,[{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:t},{type:"whitespace",data:" "},{type:"keyword",data:"vec4"},{type:"whitespace",data:" "},{type:"ident",data:r},{type:"operator",data:";"}],"afterPrecision")}d.data=r}else"fragment"===m&&"gl_FragDepthEXT"===d.data&&(q||(q=b(h,p,"gl_FragDepth")),d.data=q);break;case "ident":if(0<=c.indexOf(d.data)){if(t="vertex"===m)a:{for(t=k-1;0<=t;t--){var g=h[t];if("whitespace"!==g.type&&"block-comment"!==
g.type)if("keyword"===g.type){if("attribute"===g.data||"in"===g.data){t=!0;break a}}else break}t=!1}if(t)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");d.data in u||(u[d.data]=b(h,p,d.data));d.data=u[d.data]}}for(k=h.length-1;0<=k;--k)d=h[k],"preprocessor"===d.type&&((m=d.data.match(/\#extension\s+(.*)\:/))&&m[1]&&0<=e.indexOf(m[1].trim())&&(m=h[k+1],h.splice(k,m&&"whitespace"===m.type?2:1)),(m=d.data.match(/\#ifdef\s+(.*)/))&&m[1]&&0<=e.indexOf(m[1].trim())&&
(d.data="#if 1"),(m=d.data.match(/\#ifndef\s+(.*)/))&&m[1]&&0<=e.indexOf(m[1].trim())&&(d.data="#if 0"));return f(h)}})},"esri/views/webgl/reservedWordsGLSL3":function(){define(["require","exports"],function(n,g){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/string":function(){define(["./index"],function(n){"use strict;";return function(g){var c=n(),a=[],a=a.concat(c(g));return a=a.concat(c(null))}})},"esri/views/webgl/lib/glsl-tokenizer/index":function(){define(["./lib/literals","./lib/operators","./lib/builtins"],function(n,g,c){"use strict;";var a="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");return function(){function f(b){b.length&&v.push({type:a[p],
data:b,position:x,line:A,column:z})}function b(){t=t.length?[]:t;if("/"===u&&"*"===r)return x=q+d-1,p=0,u=r,d+1;if("/"===u&&"/"===r)return x=q+d-1,p=1,u=r,d+1;if("#"===r)return p=2,x=q+d,d;if(/\s/.test(r))return p=9,x=q+d,d;B=/\d/.test(r);D=/[^\w_]/.test(r);x=q+d;p=B?4:D?3:9999;return d}function l(){if(("\r"===r||"\n"===r)&&"\\"!==u)return f(t.join("")),p=999,d;t.push(r);u=r;return d+1}function e(){if("."===u&&/\d/.test(r))return p=5,d;if("/"===u&&"*"===r)return p=0,d;if("/"===u&&"/"===r)return p=
1,d;if("."===r&&t.length){for(;h(t););p=5;return d}if(";"===r||")"===r||"("===r){if(t.length)for(;h(t););f(r);p=999;return d+1}var a=2===t.length&&"\x3d"!==r;if(/[\w_\d\s]/.test(r)||a){for(;h(t););p=999;return d}t.push(r);u=r;return d+1}function h(a){var b=0,d,e;do{d=g.indexOf(a.slice(0,a.length+b).join(""));e=g[d];if(-1===d){if(0<b--+a.length)continue;e=a.slice(0,1).join("")}f(e);x+=e.length;t=t.slice(e.length);return t.length}while(1)}function m(){if("."===r||/[eE]/.test(r))return t.push(r),p=5,
u=r,d+1;if("x"===r&&1===t.length&&"0"===t[0])return p=11,t.push(r),u=r,d+1;if(/[^\d]/.test(r))return f(t.join("")),p=999,d;t.push(r);u=r;return d+1}function k(){"f"===r&&(t.push(r),u=r,d+=1);if(/[eE]/.test(r)||"-"===r&&/[eE]/.test(u))return t.push(r),u=r,d+1;if(/[^\d]/.test(r))return f(t.join("")),p=999,d;t.push(r);u=r;return d+1}var d=0,q=0,p=999,r,u,t=[],v=[],A=1,z=0,x=0,B=!1,D=!1,C="",G;return function(a){v=[];if(null!==a){a=a.replace?a.replace(/\r\n/g,"\n"):a;d=0;C+=a;for(G=C.length;r=C[d],d<
G;){a=d;switch(p){case 0:"/"===r&&"*"===u?(t.push(r),f(t.join("")),p=999):(t.push(r),u=r);d+=1;break;case 1:d=l();break;case 2:d=l();break;case 3:d=e();break;case 4:d=m();break;case 11:/[^a-fA-F0-9]/.test(r)?(f(t.join("")),p=999):(t.push(r),u=r,d+=1);break;case 5:d=k();break;case 9999:if(/[^\d\w_]/.test(r)){var h=t.join("");p=-1<n.indexOf(h)?8:-1<c.indexOf(h)?7:6;f(t.join(""));p=999}else t.push(r),u=r,d+=1;break;case 9:/[^\s]/g.test(r)?(f(t.join("")),p=999):(t.push(r),u=r,d+=1);break;case 999:d=b()}if(a!==
d)switch(C[a]){case "\n":z=0;++A;break;default:++z}}q+=d;C=C.slice(d);return v}t.length&&f(t.join(""));p=10;f("(eof)");return v}}})},"esri/views/webgl/lib/glsl-tokenizer/lib/literals":function(){define([],function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})},
"esri/views/webgl/lib/glsl-tokenizer/lib/operators":function(){define([],function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})},"esri/views/webgl/lib/glsl-tokenizer/lib/builtins":function(){define([],function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})},
"esri/views/webgl/BufferObject":function(){define(["require","exports","../../core/has","../3d/support/buffer/typedArrayUtil"],function(n,g,c,a){return function(){function c(a,f,e,h,m){this._glName=this._context=null;this._bufferType=void 0;this._usage=35044;this._size=-1;this._indexType=void 0;this._context=a;this._bufferType=f;this._usage=e;this._id=c._nextId++;this._glName=this._context.gl.createBuffer();h&&this.setData(h,m)}c.createIndex=function(a,f,e,h){return new c(a,34963,f,e,h)};c.createVertex=
function(a,f,e){return new c(a,34962,f,e)};Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"usage",{get:function(){return this._usage},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"bufferType",{get:function(){return this._bufferType},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"indexType",{get:function(){return this._indexType},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"byteSize",{get:function(){return 34962===this._bufferType?this._size:5125===this._indexType?4*this._size:2*this._size},enumerable:!0,configurable:!0});c.prototype.dispose=function(){this._context&&(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=
null),this._context=null)};c.prototype.setData=function(b,c){if(b){if("number"===typeof b){if(0>b&&console.error("Buffer size cannot be negative!"),34963===this._bufferType&&c)switch(this._indexType=c,this._size=b,c){case 5123:b*=2;break;case 5125:b*=4}}else c=b.byteLength,a.isUint16Array(b)&&(c/=2,this._indexType=5123),a.isUint32Array(b)&&(c/=4,this._indexType=5125),this._size=c;c=this._context.getBoundVAO();this._context.bindVAO(null);this._context.bindBuffer(this);this._context.gl.bufferData(this._bufferType,
b,this._usage);this._context.bindVAO(c)}};c.prototype.setSubData=function(b,c,e,h){void 0===c&&(c=0);void 0===e&&(e=0);if(b){(0>c||c>=this._size)&&console.error("offset is out of range!");var f=c,k=e,d=h,l=b.byteLength;a.isUint16Array(b)&&(l/=2,f*=2,k*=2,d*=2);a.isUint32Array(b)&&(l/=4,f*=4,k*=4,d*=4);void 0===h&&(h=l-1);e>=h&&console.error("end must be bigger than start!");c+e-h>this._size&&console.error("An attempt to write beyond the end of the buffer!");c=this._context.getBoundVAO();this._context.bindVAO(null);
this._context.bindBuffer(this);e=this._context.gl;b=ArrayBuffer.isView(b)?b.buffer:b;e.bufferSubData(this._bufferType,f,b.slice(k,d));this._context.bindVAO(c)}};c._nextId=0;return c}()})},"esri/views/3d/support/buffer/typedArrayUtil":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.forEach=function(c,a){if(c.forEach)c.forEach(a);else for(var f=0;f<c.length;f++)a(c[f],f,c)};g.slice=function(c,a,f){if(c.slice)return c.slice(a,f);void 0===a?a=0:
(0>a&&(a+=c.length),a=Math.min(c.length,Math.max(0,a)));void 0===f?f=c.length:(0>f&&(f+=c.length),f=Math.min(c.length,Math.max(0,f)));f=Math.max(0,f-a);for(var b=new c.constructor(f),l=0;l<f;l++)b[l]=c[a+l];return b};g.isArrayBuffer=function(c){return c instanceof ArrayBuffer||c&&c.constructor&&"ArrayBuffer"===c.constructor.name};g.isInt8Array=function(c){return c instanceof Int8Array||c&&c.constructor&&"Int8Array"===c.constructor.name};g.isUint8Array=function(c){return c instanceof Uint8Array||c&&
c.constructor&&"Uint8Array"===c.constructor.name};g.isInt16Array=function(c){return c instanceof Int16Array||c&&c.constructor&&"Int16Array"===c.constructor.name};g.isUint16Array=function(c){return c instanceof Uint16Array||c&&c.constructor&&"Uint16Array"===c.constructor.name};g.isInt32Array=function(c){return c instanceof Int32Array||c&&c.constructor&&"Int32Array"===c.constructor.name};g.isUint32Array=function(c){return c instanceof Uint32Array||c&&c.constructor&&"Uint32Array"===c.constructor.name};
g.isFloat32Array=function(c){return c instanceof Float32Array||c&&c.constructor&&"Float32Array"===c.constructor.name};g.isFloat64Array=function(c){return c instanceof Float64Array||c&&c.constructor&&"Float64Array"===c.constructor.name}})},"esri/views/webgl/Texture":function(){define(["require","exports","../../core/has"],function(n,g,c){return function(){function a(c,b,l){this._glName=this._context=null;this._id=-1;this._desc=void 0;this._wrapModeDirty=this._samplingModeDirty=!1;this._boundToUnits=
new Set;this._context=c;this._desc={pixelFormat:b.pixelFormat,internalFormat:b.internalFormat,dataType:b.dataType,target:b.target?b.target:3553,samplingMode:b.samplingMode?b.samplingMode:9729,wrapMode:b.wrapMode?b.wrapMode:10497,maxAnisotropy:b.maxAnisotropy,flipped:void 0!==b.flipped?b.flipped:!1,hasMipmap:void 0!==b.hasMipmap?b.hasMipmap:!1,unpackAlignment:b.unpackAlignment?b.unpackAlignment:4,width:b.width,height:b.height,preMultiplyAlpha:void 0!==b.preMultiplyAlpha?b.preMultiplyAlpha:!1};this._id=
++a._nextId;this.setData(l)}Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});a.prototype.dispose=function(){var a=this;if(this._context){if(this._glName){var b=this._context.gl;this._boundToUnits.forEach(function(b){a._context.bindTexture(null,
b)});b.deleteTexture(this._glName);this._glName=null}this._context=null}};a.prototype.resize=function(a,b){var c=this._desc;if(c.width!==a||c.height!==b)c.width=a,c.height=b,this.setData(null)};a.prototype.setData=function(c){var b=this._context.gl;this._glName||(this._glName=b.createTexture());void 0===c&&(c=null);null===c&&(this._desc.width=this._desc.width||4,this._desc.height=this._desc.height||4);var f=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var e=this._desc;a._validateTexture(e);
b.pixelStorei(b.UNPACK_ALIGNMENT,e.unpackAlignment);b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,e.flipped?1:0);b.pixelStorei(b.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.preMultiplyAlpha);var h=e.pixelFormat,m=e.internalFormat?e.internalFormat:h;if(c instanceof ImageData||c instanceof HTMLImageElement||c instanceof HTMLCanvasElement||c instanceof HTMLVideoElement)e.width&&e.height&&console.assert(c.width===e.width&&c.height===e.height),b.texImage2D(b.TEXTURE_2D,0,m,h,e.dataType,c),e.hasMipmap&&this.generateMipmap(),
void 0===this._desc.width&&(this._desc.width=c.width),void 0===this._desc.height&&(this._desc.height=c.height);else{null!=e.width&&null!=e.height||console.error("Width and height must be specified!");b.DEPTH24_STENCIL8&&m===b.DEPTH_STENCIL&&(m=b.DEPTH24_STENCIL8);var k=e.width,d=e.height;if(null!=c&&"type"in c&&"compressed"===c.type)for(var q=0;;++q){b.compressedTexImage2D(b.TEXTURE_2D,q,m,k,d,0,c.levels[Math.min(q,c.levels.length-1)]);if(1===k&&1===d||!e.hasMipmap)break;k=Math.max(1,k>>1);d=Math.max(1,
d>>1)}else if(c)b.texImage2D(b.TEXTURE_2D,0,m,k,d,0,h,e.dataType,c),e.hasMipmap&&this.generateMipmap();else for(q=0;;++q){b.texImage2D(b.TEXTURE_2D,q,m,k,d,0,h,e.dataType,null);if(1===k&&1===d||!e.hasMipmap)break;k=Math.max(1,k>>1);d=Math.max(1,d>>1)}}a._applySamplingMode(b,this._desc);a._applyWrapMode(b,this._desc);a._applyAnisotropicFilteringParameters(this._context,this._desc);this._context.bindTexture(f,0)};a.prototype.updateData=function(a,b,c,e,h,m){m||console.error("An attempt to use uninitialized data!");
this._glName||console.error("An attempt to update uninitialized texture!");var f=this._context.gl,d=this._desc,l=this._context.getBoundTexture(0);this._context.bindTexture(this,0);(0>b||0>c||e>d.width||h>d.height||b+e>d.width||c+h>d.height)&&console.error("An attempt to update out of bounds of the texture!");m instanceof ImageData||m instanceof HTMLImageElement||m instanceof HTMLCanvasElement||m instanceof HTMLVideoElement?(console.assert(m.width===e&&m.height===h),f.texSubImage2D(f.TEXTURE_2D,a,
b,c,d.pixelFormat,d.dataType,m)):f.texSubImage2D(f.TEXTURE_2D,a,b,c,e,h,d.pixelFormat,d.dataType,m);this._context.bindTexture(l,0)};a.prototype.generateMipmap=function(){var c=this._desc;c.hasMipmap||(c.hasMipmap=!0,a._validateTexture(c));9729===c.samplingMode?(this._samplingModeDirty=!0,c.samplingMode=9985):9728===c.samplingMode&&(this._samplingModeDirty=!0,c.samplingMode=9984);c=this._context.getBoundTexture(0);this._context.bindTexture(this,0);var b=this._context.gl;b.generateMipmap(b.TEXTURE_2D);
this._context.bindTexture(c,0)};a.prototype.setSamplingMode=function(c){c!==this._desc.samplingMode&&(this._desc.samplingMode=c,a._validateTexture(this._desc),this._samplingModeDirty=!0)};a.prototype.setWrapMode=function(c){c!==this._desc.wrapMode&&(this._desc.wrapMode=c,a._validateTexture(this._desc),this._wrapModeDirty=!0)};a.prototype.applyChanges=function(){var c=this._context.gl,b=this._desc;this._samplingModeDirty&&(a._applySamplingMode(c,b),this._samplingModeDirty=!1);this._wrapModeDirty&&
(a._applyWrapMode(c,b),this._wrapModeDirty=!1)};a.prototype.setBoundToUnit=function(a,b){b?this._boundToUnits.add(a):this._boundToUnits.delete(a)};a._isPowerOfTwo=function(a){return 0===(a&a-1)};a._validateTexture=function(c){(0>c.width||0>c.height)&&console.error("Negative dimension parameters are not allowed!");a._isPowerOfTwo(c.width)&&a._isPowerOfTwo(c.height)||(33071!==c.wrapMode&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),c.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};
a._applySamplingMode=function(a,b){var c=b.samplingMode;if(9985===c||9987===c)c=9729;else if(9984===c||9986===c)c=9728;a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,c);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,b.samplingMode)};a._applyWrapMode=function(a,b){a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,b.wrapMode);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,b.wrapMode)};a._applyAnisotropicFilteringParameters=function(a,b){if(null!=b.maxAnisotropy){var c=a.capabilities.textureFilterAnisotropic;
c&&(a=a.gl,a.texParameterf(a.TEXTURE_2D,c.TEXTURE_MAX_ANISOTROPY,b.maxAnisotropy))}};a._nextId=0;return a}()})},"esri/views/webgl/Util":function(){define(["require","exports","../../core/tsSupport/assignHelper","../../core/Error"],function(n,g,c,a){function f(a){return a[0].stride}function b(a){switch(a){case 5126:return 4;case 5124:return 4;case 5125:return 4;case 5122:return 2;case 5123:return 2;case 5120:return 1;case 5121:return 1;default:throw Error("Unknown data type");}}Object.defineProperty(g,
"__esModule",{value:!0});g.vertexCount=function(a,b){return a.vertexBuffers[b].size/f(a.layout[b])};g.getStride=f;g.getBytesPerElement=b;g.addDescriptor=function(a,e,c,f,k,d){var h=b(f);if(0<a.length){var m=a[0].stride,l=m+h*c;a.forEach(function(a){return a.stride=l});a.push({name:e,count:c,type:f,offset:m,stride:l,normalized:k,divisor:d})}else a.push({name:e,count:c,type:f,offset:0,stride:h*c,normalized:k,divisor:d})};g.assertCompatibleVertexAttributeLocations=function(a,b){(a=a.locations===b.locations)||
console.error("VertexAttributeLocations are incompatible");return a};g.hasAttribute=function(a,b){for(var e=0;e<a.length;e++)if(a[e].name===b)return!0;return!1};g.findAttribute=function(a,b){for(var e=0;e<a.length;e++)if(a[e].name===b)return a[e];return null};g.copyFramebufferToTexture=function(a,b,c,f,k){void 0===k&&(k=0);var d=a.getBoundFramebufferObject(),e=a.getBoundTexture(0);a.bindFramebuffer(b);a.bindTexture(c,0);a.gl.copyTexImage2D(a.gl.TEXTURE_2D,k,c.descriptor.pixelFormat,f[0],f[1],f[2],
f[3],0);a.gl.flush();a.bindFramebuffer(d);a.bindTexture(e,0)};g.assert=function(b,e){if(!b)throw new a(e);};g.setBaseInstanceOffset=function(a,b){var e={},f;for(f in a)e[f]=a[f].map(function(a){return a.divisor?c({},a,{baseInstance:b}):a});return e};g.bindVertexBufferLayout=function(a,b,c,f,k){var d=a.gl,e=a.capabilities.instancing;a.bindBuffer(c);f.forEach(function(a){var c=b[a.name],h=(k?k:0+a.baseInstance?a.baseInstance:0)*a.stride;void 0===c&&console.error("There is no location for vertex attribute '"+
a.name+"' defined.");a.baseInstance&&!a.divisor&&console.error("Vertex attribute '"+a.name+"' uses baseInstanceOffset without divisor.");if(4>=a.count)d.vertexAttribPointer(c,a.count,a.type,a.normalized,a.stride,a.offset+h),d.enableVertexAttribArray(c),a.divisor&&0<a.divisor&&e&&e.vertexAttribDivisor(c,a.divisor);else if(9===a.count)for(var f=0;3>f;f++)d.vertexAttribPointer(c+f,3,a.type,a.normalized,a.stride,a.offset+12*f+h),d.enableVertexAttribArray(c+f),a.divisor&&0<a.divisor&&e&&e.vertexAttribDivisor(c+
f,a.divisor);else if(16===a.count)for(f=0;4>f;f++)d.vertexAttribPointer(c+f,4,a.type,a.normalized,a.stride,a.offset+16*f+h),d.enableVertexAttribArray(c+f),a.divisor&&0<a.divisor&&e&&e.vertexAttribDivisor(c+f,a.divisor);else console.error("Unsupported vertex attribute element count: "+a.count)})};g.unbindVertexBufferLayout=function(a,b,c,f){var e=a.gl,d=a.capabilities.instancing;a.bindBuffer(c);f.forEach(function(a){var c=b[a.name];if(4>=a.count)e.disableVertexAttribArray(c),a.divisor&&0<a.divisor&&
d&&d.vertexAttribDivisor(c,0);else if(9===a.count)for(var h=0;3>h;h++)e.disableVertexAttribArray(c+h),a.divisor&&0<a.divisor&&d&&d.vertexAttribDivisor(c+h,0);else if(16===a.count)for(h=0;4>h;h++)e.disableVertexAttribArray(c+h),a.divisor&&0<a.divisor&&d&&d.vertexAttribDivisor(c+h,0);else console.error("Unsupported vertex attribute element count: "+a.count)});a.unbindBuffer(34962)}})},"esri/views/webgl/VertexArrayObject":function(){define(["require","exports","../../core/has","./Util"],function(n,g,
c,a){return function(){function c(a,f,e,h,m){this._locations=this._layout=this._glName=this._context=null;this._indexBuffer=this._buffers=void 0;this._initialized=!1;this._context=a;this._layout=e;this._buffers=h;this._locations=f;m&&(this._indexBuffer=m);this._id=c._nextId++}Object.defineProperty(c.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"vertexBuffers",{get:function(){return this._buffers},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"indexBuffer",{get:function(){return this._indexBuffer},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"size",{get:function(){var a=this;return Object.keys(this._buffers).reduce(function(b,e){return b+a._buffers[e].size},this._indexBuffer?this._indexBuffer.size:0)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"layout",{get:function(){return this._layout},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"locations",{get:function(){return this._locations},enumerable:!0,configurable:!0});c.prototype.dispose=function(a){void 0===a&&(a=!0);if(this._context){var b=this._context.capabilities.vao;b&&this._glName&&(b.deleteVertexArray(this._glName),this._glName=null);this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(a){for(var e in this._buffers)this._buffers[e].dispose(),delete this._buffers[e];this._indexBuffer&&(this._indexBuffer.dispose(),
this._indexBuffer=null)}this._context=null}};c.prototype.initialize=function(){if(!this._initialized){var a=this._context.capabilities.vao;if(a){var c=a.createVertexArray();a.bindVertexArray(c);this._bindLayout();a.bindVertexArray(null);this._glName=c}this._initialized=!0}};c.prototype.bind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};c.prototype._bindLayout=function(){var b=this._buffers,c=!!this._context.capabilities.vao,
e=this._layout,h=this._indexBuffer;b||console.error("Vertex buffer dictionary is empty!");var f=this._context.gl,k;for(k in b){var d=b[k];d||console.error("Vertex buffer is uninitialized!");var q=e[k];q||console.error("Vertex element descriptor is empty!");a.bindVertexBufferLayout(this._context,this._locations,d,q)}h&&(c?f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,h.glName):this._context.bindBuffer(h))};c.prototype.unbind=function(){this.initialize();var a=this._context.capabilities.vao;a?a.bindVertexArray(null):
this._unbindLayout()};c.prototype._unbindLayout=function(){var b=this._buffers,c=this._layout;b||console.error("Vertex buffer dictionary is empty!");for(var e in b){var h=b[e];h||console.error("Vertex buffer is uninitialized!");a.unbindVertexBufferLayout(this._context,this._locations,h,c[e])}(b=this._indexBuffer)&&this._context.unbindBuffer(b.bufferType)};c._nextId=0;return c}()})},"esri/views/3d/environment/RealisticAtmosphere":function(){define("require exports ../../../core/Handles ../../../core/promiseUtils ../../../core/watchUtils ./atmosphereUtils ../lib/gl-matrix ../support/earthUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/shaders/RealisticAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t){n=function(){function m(a){this.needsRender=!1;this.didRender=!0;this.slot=d.POSTPROCESSING_ATMOSPHERE_OPAQUE;this._hazeSlot=d.POSTPROCESSING_ATMOSPHERE_TRANSPARENT;this._renderData={texDepth:l.vec2d.create(),v3CameraPos:l.vec3d.create(),v3CameraUp:l.vec3d.create(),v3CameraRight:l.vec3d.create(),v3CameraDir:l.vec3d.create(),halfSizeNearPlane:l.vec2d.create(),v2CameraCenterOffset:l.vec2d.create(),v4SphereComp:l.vec4d.create(),v4AtmosParams1:l.vec4d.create(),
v4AtmosParams2:l.vec4d.create(),v4AtmosParams3:l.vec4d.create(),v3InvWavelength:A,v3InvWavelengthScaled:z,v4Radii:l.vec4d.create(),fScale:0,fScaleDepth:x,fLowerAlphaBlendBound:0,fScaleOverScaleDepth:0,fOneOverScaleDepth:0,fScaleDepthBlue:B,fOneOverScaleDepthBlue:C,fScaleOverScaleDepthBlue:0,g:G,g2:G*G,fMiePhaseCoefficients:E,showTest:0,nearFar:l.vec2d.create(),fCameraHeight:0,fCameraHeight2:0,fC:0,fCSur:0,fInnerFadeDistance:0,fAltitudeFade:0};this._lowerElevationBoundRadius=0;this._earthRadius=e.earthRadius;
this.view=a;this._updateRadius(e.earthRadius)}m.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this._hazeProgram&&(this._hazeProgram.dispose(),this._hazeProgram=null);this._skyProgram&&(this._skyProgram.dispose(),this._skyProgram=null);this._vao&&(this._vao.dispose(),this._vao=null)};m.prototype.when=function(b){return a.resolve().then(b)};m.prototype.initializeRenderContext=function(a){var b=this;a=a.rctx;this._handles=new c;this._updateElevation({spatialReference:this.view.basemapTerrain.spatialReference,
tile:this.view.basemapTerrain.rootTiles[0],extent:this.view.basemapTerrain.rootTiles[0].extent});this._handles.add(f.on(this.view,"basemapTerrain","elevation-change",function(a){return b._updateElevation(a)},function(){return b._updateElevation()}));this._handles.add(f.on(this.view,"basemapTerrain","elevation-bounds-change",function(){return b._updateVisibleElevationBounds()},function(){return b._updateVisibleElevationBounds()}));this._hazeProgram=r.createProgram(a,q.program,{haze:!0});this._skyProgram=
r.createProgram(a,q.program);this._vao=this._createVertexArrayObject(a)};m.prototype.uninitializeRenderContext=function(a){this.destroy()};m.prototype.render=function(a){if(a.slot!==this._hazeSlot&&a.slot!==this.slot||a.pass!==k.MATERIAL)return!1;this._update(a.camera);a.slot===this.slot&&this._renderSky(a);a.slot===this._hazeSlot&&this._renderHaze(a);this.needsRender=!1;return!0};m.prototype._renderSky=function(a){var b=a.rctx,d=this._skyProgram;b.bindProgram(d);b.setBlendFunctionSeparate(770,771,
1,771);b.setDepthFunction(515);b.setDepthTestEnabled(!0);d.setUniform4fv("v4AtmosParams3",this._renderData.v4AtmosParams3);this._renderCommon(d,a)};m.prototype._renderHaze=function(a){var b=this,d=a.rctx,e=a.offscreenRenderingHelper,c=this._hazeProgram;d.bindProgram(c);d.setBlendFunctionSeparate(1,769,0,1);e.renderDepthDetached(function(){d.setDepthTestEnabled(!1);d.bindTexture(e.depthTexture,0);c.setUniform1i("tDepth",0);b._renderCommon(c,a)})};m.prototype._renderCommon=function(a,b){var d=b.rctx;
a.setUniform3fv("v3InvWavelength",this._renderData.v3InvWavelength);a.setUniform3fv("v3InvWavelengthScaled",this._renderData.v3InvWavelengthScaled);a.setUniform3fv("v3LightDir",b.lightingData.direction);a.setUniform4fv("v4SphereComp",this._renderData.v4SphereComp);a.setUniform3fv("v3CameraPos",this._renderData.v3CameraPos);a.setUniform3fv("v3CameraUp",this._renderData.v3CameraUp);a.setUniform3fv("v3CameraRight",this._renderData.v3CameraRight);a.setUniform3fv("v3CameraDir",this._renderData.v3CameraDir);
a.setUniform2fv("nearFar",this._renderData.nearFar);a.setUniform2fv("halfSizeNearPlane",this._renderData.halfSizeNearPlane);a.setUniform2fv("v2CameraCenterOffset",this._renderData.v2CameraCenterOffset);a.setUniform4fv("v4Radii",this._renderData.v4Radii);a.setUniform4fv("v4AtmosParams1",this._renderData.v4AtmosParams1);a.setUniform4fv("v4AtmosParams2",this._renderData.v4AtmosParams2);a.setUniform1f("showTest",this._renderData.showTest);a.setUniform1f("fInnerFadeDistance",this._renderData.fInnerFadeDistance);
a.setUniform1f("fAltitudeFade",this._renderData.fAltitudeFade);d.setBlendingEnabled(!0);d.setDepthWriteEnabled(!1);d.bindVAO(this._vao);u.assertCompatibleVertexAttributeLocations(this._vao,a);d.drawArrays(5,0,4);d.setDepthFunction(513);d.setDepthTestEnabled(!1);d.setDepthWriteEnabled(!0);d.setBlendingEnabled(!1);d.setBlendFunctionSeparate(770,771,1,771)};m.prototype._createVertexArrayObject=function(a){var b=F.createBuffer(4);b.position.setVec(0,[-1,-1,1]);b.position.setVec(1,[1,-1,1]);b.position.setVec(2,
[-1,1,1]);b.position.setVec(3,[1,1,1]);b.uv0.setVec(0,[0,0]);b.uv0.setVec(1,[1,0]);b.uv0.setVec(2,[0,1]);b.uv0.setVec(3,[1,1]);return new t(a,q.program.attributes,{geometry:h.glLayout(F)},{geometry:p.createVertex(a,35044,b.buffer)})};m.prototype._adjustRadiusForTesselation=function(a){return a*Math.cos(Math.PI/Math.pow(2,4)/16)};m.prototype._updateElevation=function(a){a=a?a.tile:this.view.basemapTerrain.rootTiles[0];0===a.lij[0]&&(a=this._adjustRadiusForTesselation(e.earthRadius+a.elevationBounds[0]),
a!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=a,this._earthRadius=-1,this._updateVisibleElevationBounds()))};m.prototype._updateVisibleElevationBounds=function(){var a=this._adjustRadiusForTesselation(e.earthRadius+this.view.basemapTerrain.getElevationBounds()[0]);(0>this._earthRadius||a<this._earthRadius)&&this._updateRadius(a)};m.prototype._updateRadius=function(a){this._earthRadius=a;var d=a*a,e=a/10*10.25,c=e*e,h=1/(e-a),f=h/x,k=h/B,m=.3*(e-a)+a,p=1/(e-m),q=this._renderData;
l.vec4d.set4(h,x,f,D,q.v4AtmosParams1);l.vec4d.set4(G,B,k,C,q.v4AtmosParams2);l.vec4d.set4(G*G,E,m,p,q.v4AtmosParams3);l.vec4d.set4(a,d,e,c,q.v4Radii);q.fScale=h;q.fLowerAlphaBlendBound=m;q.fScaleOverScaleDepth=f;q.fScaleOverScaleDepthBlue=k;d=b.INNER_ATMOSPHERE_DEPTH;q.fInnerFadeDistance=2*Math.sqrt((2*a-d)*d)};m.prototype._update=function(a){a&&(l.vec3d.negate(a.viewForward,this._renderData.v3CameraDir),l.vec3d.set(a.viewUp,this._renderData.v3CameraUp),l.vec3d.set(a.viewRight,this._renderData.v3CameraRight),
this._renderData.fCameraHeight=l.vec3d.length(a.eye),this._renderData.fCameraHeight2=this._renderData.fCameraHeight*this._renderData.fCameraHeight,this._renderData.fC=this._renderData.fCameraHeight2-this._renderData.v4Radii[3],this._renderData.fCSur=this._renderData.fCameraHeight2-this._renderData.v4Radii[1],this._renderData.v4SphereComp=l.vec4d.createFrom(this._renderData.fCameraHeight,this._renderData.fCameraHeight2,this._renderData.fC,this._renderData.fCSur),l.vec3d.set(a.eye,this._renderData.v3CameraPos),
l.vec2d.set2(Math.tan(a.fovX/2)/(a.width/a.fullWidth),Math.tan(a.fovY/2)/(a.height/a.fullHeight),this._renderData.halfSizeNearPlane),l.vec2d.set2((a.padding[3]+a.width/2)/a.fullWidth-.5,(a.padding[2]+a.height/2)/a.fullHeight-.5,this._renderData.v2CameraCenterOffset),l.vec2d.set2(a.near,a.far,this._renderData.nearFar),this._renderData.fAltitudeFade=b.computeInnerAltitudeFade(this._renderData.fCameraHeight-this._earthRadius))};m.isSupported=function(a){return a.rctx.capabilities.depthTexture};return m}();
g=.02*Math.PI;var v=.004*Math.PI,A=l.vec3d.createFrom(1/Math.pow(.65,4),1/Math.pow(.57,4),1/Math.pow(.475,4)),z=l.vec3d.create(A);l.vec3d.scale(z,g);l.vec3d.add(z,l.vec3d.createFrom(v,v,v));var x=.25,B=.05,D=1/x,C=1/B,G=-.99999,E=(1-G*G)/(2+G*G)*1.5,F=m.newLayout().vec3f("position").vec2f("uv0");return n})},"esri/views/3d/environment/atmosphereUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.computeInnerAltitudeFade=function(c){return Math.min(1,
Math.max(0,(c-1E5)/9E5))};g.INNER_ATMOSPHERE_DEPTH=1E4})},"esri/views/3d/webgl-engine/shaders/RealisticAtmospherePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});g.program={name:"realistic-atmosphere-color",shaders:function(b){return{vertexShader:f.glslifyDefineMap({HAZE:b.haze})+a.resolveIncludes("environment/realisticAtmosphere.vert"),
fragmentShader:f.glslifyDefineMap({HAZE:b.haze})+a.resolveIncludes("environment/realisticAtmosphere.frag")}},attributes:c.Default3D}})},"esri/views/3d/environment/SimpleAtmosphere":function(){define("require exports ../../../core/watchUtils ./atmosphereUtils ./resources/SimpleAtmosphereTexture ../lib/gl-matrix ../support/earthUtils ../support/imageUtils ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/Util ../webgl-engine/shaders/SimpleAtmospherePrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x){function B(a,d,e,c,h){var f=b.vec3d.length(a),k=c*Math.sqrt(f*f-c*c)/f,m=h.silCircleV1,l=h.silCircleV2;b.vec3d.scale(a,Math.sqrt(c*c-k*k)/f,h.silCircleCenter);b.vec3d.cross(a,d,m);1>b.vec3d.length2(m)&&b.vec3d.cross(a,e,m);b.vec3d.scale(m,k/b.vec3d.length(m));b.vec3d.cross(m,a,l);b.vec3d.scale(l,k/b.vec3d.length(l));return k}function D(a,d,e,c){b.vec3d.add(c.silCircleCenter,c.silCircleV2,N);b.vec3d.scale(N,F,H);b.mat4d.lookAt(d,N,e,K);r.project(N,
K,a.projectionMatrix,a.viewport);r.project(H,K,a.projectionMatrix,a.viewport);return b.vec3d.dist(N,H)/a.height}var C=-a.INNER_ATMOSPHERE_DEPTH,G=(l.earthRadius+C)/l.earthRadius,E=(l.earthRadius+0)/l.earthRadius,F=(l.earthRadius+3E5)/l.earthRadius,I=h.makePiecewiseLinearFunction([[50,.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);n=function(){function k(a){this.needsRender=!1;this.didRender=!0;this.slot=p.POSTPROCESSING_ATMOSPHERE_OPAQUE;this._renderData={texV:b.vec2d.create(),silCircleCenter:b.vec3d.create(),
silCircleV1:b.vec3d.create(),silCircleV2:b.vec3d.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._fadeVaoCount=0;this.view=a}k.prototype.when=function(a){return this._readyPromise.then(a)};k.prototype.initializeRenderContext=function(a){var b=this,h=a.rctx;this._cameraChangeHandle=c.init(this.view,"state.camera",function(){return b.needsRender=!0},!0);this._program=v.createProgram(h,u.colorPass);this._fadeProgram=v.createProgram(h,u.fadePass);this._vao=this._createRibbon(h);this._vaoCount=
z.vertexCount(this._vao,"geometry");this._fadeVao=d.createQuadVAO(h);this._fadeVaoCount=z.vertexCount(this._fadeVao,"geometry");this._readyPromise=e.requestImage(f).then(function(a){b._texture=new A(h,{pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,flipped:!0},a);b.needsRender=!0})};k.prototype.uninitializeRenderContext=function(a){this.destroy()};k.prototype.destroy=function(){this._cameraChangeHandle&&(this._cameraChangeHandle.remove(),this._cameraChangeHandle=null);this._texture&&
(this._texture.dispose(),this._texture=null);this._program&&(this._program.dispose(),this._program=null);this._fadeProgram&&(this._fadeProgram.dispose(),this._fadeProgram=null);this._fadeVao&&(this._fadeVao.dispose(),this._fadeVao=null)};k.prototype.render=function(a){if(a.slot!==this.slot||a.pass!==q.MATERIAL||null==this._texture)return!1;this._update(a.camera);var b=a.rctx,d=this._program;b.setDepthTestEnabled(!0);b.setDepthFunction(515);b.setBlendingEnabled(!0);b.setDepthWriteEnabled(!1);b.setBlendFunctionSeparate(770,
771,1,771);1>this._renderData.undergroundFadeAlpha&&(b.bindProgram(d),d.setUniformMatrix4fv("proj",a.camera.projectionMatrix),d.setUniformMatrix4fv("view",a.camera.viewMatrix),d.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter),d.setUniform3fv("silCircleV1",this._renderData.silCircleV1),d.setUniform3fv("silCircleV2",this._renderData.silCircleV2),d.setUniform2fv("texV",this._renderData.texV),b.bindTexture(this._texture,0),d.setUniform1i("tex",0),d.setUniform3fv("lightDirection",a.lightingData.direction),
d.setUniform1f("altitudeFade",this._renderData.altitudeFade),d.setUniform1f("innerScale",this._renderData.innerScale),b.bindVAO(this._vao),b.drawArrays(4,0,this._vaoCount));0<this._renderData.undergroundFadeAlpha&&(b.bindProgram(this._fadeProgram),this._fadeProgram.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),this._fadeProgram.setUniform3fv("lightDirection",a.lightingData.direction),this._fadeProgram.setUniform3fv("cameraPosition",a.camera.eye),b.bindVAO(this._fadeVao),
b.drawArrays(5,0,this._fadeVaoCount));b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(513);this.needsRender=!1;return!0};k.prototype._update=function(d){var e=b.vec3d.create(),c=l.earthRadius,f=b.vec3d.length(d.eye),k=f-c;this._renderData.undergroundFadeAlpha=0>k?Math.min(-k/5E3,1):0;var m=c+C,p=c+Math.max(50,k);this._renderData.innerScale=p*p/(Math.sqrt(p*p-c*c)*Math.sqrt(p*p-m*m)+c*m)-1;this._renderData.altitudeFade=a.computeInnerAltitudeFade(k);b.vec3d.scale(d.eye,(c+50)/
f,e);B(e,d.center,d.up,c,this._renderData);e=D(d,e,d.up,this._renderData);f=I(k);m=.001953125;p=0+e*f*1;50<k&&(B(d.eye,d.center,d.up,c,this._renderData),d=D(d,d.eye,d.up,this._renderData),d=h.clamp((d-1.5)/(e-1.5),0,1),m=0+.001953125*d,p=0+1*h.lerp(1,e*f,d));b.vec2d.set2(m,p,this._renderData.texV)};k.prototype._createRibbon=function(a){var b=new Float32Array(1155),d=new Uint32Array(1920);b[0]=0;b[1]=0;b[2]=-1;for(var e=0;128>e;e++){var c=9*e+3;b[c+0]=e;b[c+1]=G;b[c+2]=-1;b[c+3]=e;b[c+4]=E;b[c+5]=
0;b[c+6]=e;b[c+7]=F;b[c+8]=1;var c=3*e+1,h=127===e?1:c+3,f=15*e;d[f+0]=c;d[f+1]=c+1;d[f+2]=h+1;d[f+3]=h+1;d[f+4]=h;d[f+5]=c;d[f+6]=c+1;d[f+7]=c+2;d[f+8]=h+2;d[f+9]=h+2;d[f+10]=h+1;d[f+11]=c+1;d[f+12]=c;d[f+13]=h;d[f+14]=0}c=M.createBuffer(d.length);h=c.position;for(e=0;e<d.length;++e)f=3*d[e],h.set(e,0,b[f]),h.set(e,1,b[f+1]),h.set(e,2,b[f+2]);return new x(a,u.colorPass.attributes,{geometry:m.glLayout(M)},{geometry:t.createVertex(a,35044,c.buffer)})};return k}();var K=b.mat4d.create(),N=b.vec3d.create(),
H=b.vec3d.create(),M=k.newLayout().vec3f("position");return n})},"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("require exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});g.createQuadVAO=function(b,h){void 0===h&&(h=a.Pos2);var e=null;switch(h){case a.Pos3Tex:e=new Float32Array([-1,-1,0,0,0,1,-1,0,
1,0,-1,1,0,0,1,1,1,0,1,1]);break;case a.Pos3:e=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);break;case a.Pos2Tex:e=new Float32Array([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);break;default:e=new Float32Array([-1,-1,1,-1,-1,1,1,1])}return new l(b,c.Default3D,{geometry:h},{geometry:f.createVertex(b,35044,e)})};g.createEmptyTexture=function(a,c){void 0===c&&(c=4);return new b(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:c,height:c})};g.createColorTexture=function(a,c,f){void 0===
f&&(f=4);for(var e=new Uint8Array(f*f*4),d=0;d<e.length;d+=4)e[d+0]=255*c[0],e[d+1]=255*c[1],e[d+2]=255*c[2],e[d+3]=255*c[3];return new b(a,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:f,height:f},e)}})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.Pos3=[{name:"position",count:3,type:5126,offset:0,stride:12,normalized:!1}];g.Pos3Tex=[{name:"position",count:3,
type:5126,offset:0,stride:20,normalized:!1},{name:"uv0",count:2,type:5126,offset:12,stride:20,normalized:!1}];g.Pos3Col=[{name:"position",count:3,type:5126,offset:0,stride:16,normalized:!1},{name:"color",count:4,type:5121,offset:12,stride:16,normalized:!1}];g.Pos2=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];g.Pos2Tex=[{name:"position",count:2,type:5126,offset:0,stride:16,normalized:!1},{name:"uv0",count:2,type:5126,offset:8,stride:16,normalized:!1}]})},"esri/views/3d/environment/Stars":function(){define("require exports ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../lib/gl-matrix ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/shaders/StarsPrograms ../../webgl/BufferObject ../../webgl/programUtils ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t){var v=f.getLogger("esri.views.3d.environment.Stars");g=function(){function f(a){this.slot=d.POSTPROCESSING_ATMOSPHERE_OPAQUE;this.numBinaryFloats=2;this.numBinaryUInt8=1;this.bytesPerStar=9;this.needsRender=!1;this.didRender=!0;this._numStars=0;this._modelMatrix=e.mat4d.create();this.view=a;this._loadDataPromise=this._loadBrightStarCatalogue()}f.prototype.destroy=function(){this._loadDataPromise.isFulfilled()||this._loadDataPromise.cancel();this._dateHandle&&
(this._dateHandle.remove(),this._dateHandle=null);this._program&&(this._program.dispose(),this._program=null);this._vao&&(this._vao.dispose(),this._vao=null)};f.prototype.initializeRenderContext=function(a){var b=this,d=a.rctx;this._program=r.createProgram(d,q.program);this._dateHandle=l.init(this.view,"environment.lighting.date",function(a){return b._update(a)});this._loadDataPromise.then(function(){b._numStars=b._starData.byteLength/b.bytesPerStar;var a=new Float32Array(b._starData,0,b._numStars*
b.numBinaryFloats),e=new Uint8Array(b._starData,b._numStars*b.numBinaryFloats*4,b._numStars*b.numBinaryUInt8);b._vao=b._createVertexArrayObject(d,a,e);b.needsRender=!0})};f.prototype.uninitializeRenderContext=function(a){this.destroy()};f.prototype.render=function(a){if(a.slot!==this.slot||a.pass!==k.MATERIAL||null==this._starData)return!1;var b=a.rctx,d=this._program;b.bindProgram(d);d.setUniformMatrix4fv("view",a.camera.viewMatrix);d.setUniformMatrix4fv("proj",a.camera.projectionMatrix);d.setUniform4fv("viewport",
a.camera.fullViewport);d.setUniformMatrix4fv("model",this._modelMatrix);d.setUniform1f("pixelRatio",a.pixelRatio);b.setDepthTestEnabled(!0);b.setDepthFunction(515);b.setBlendingEnabled(!0);b.setBlendFunctionSeparate(770,771,1,771);b.setDepthWriteEnabled(!1);b.bindVAO(this._vao);u.assertCompatibleVertexAttributeLocations(this._vao,d);b.drawArrays(0,0,this._numStars);b.setBlendingEnabled(!1);b.setDepthWriteEnabled(!0);b.setDepthFunction(513);this.needsRender=!1;return!0};f.prototype._computeDayDuration=
function(a){var b=new Date(a.getFullYear(),0,1,11,58,56),d=new Date(a.getFullYear()+1,0,1,11,58,55);return(+a-+b)/(+d-+b)};f.prototype._update=function(a){if(a){var b=a.getHours()/12,d=a.getMinutes()/60*(2/24),c=a.getSeconds()/60*(2/1440),b=(b+d+c-.9972222)%2;a=2*this._computeDayDuration(a);d=this._modelMatrix;e.mat4d.set(x,d);e.mat4d.rotateZ(d,-a*Math.PI);e.mat4d.multiply(z,d,d);e.mat4d.rotateZ(d,-b*Math.PI);this.needsRender=!0}};f.prototype._hexToRGB=function(a){return[parseInt(a.substring(0,2),
16),parseInt(a.substring(2,4),16),parseInt(a.substring(4,6),16)]};f.prototype._unpackUint8Attributes=function(a){return 192<=a?[2.9,a-192]:160<=a?[2.5,a-160]:128<=a?[2,a-128]:96<=a?[1.5,a-96]:64<=a?[1,a-64]:32<=a?[.7,a-32]:[.4,a]};f.prototype._createVertexArrayObject=function(a,b,d){for(var e=B.createBuffer(this._numStars),c=e.position,f=e.color,k=e.size,m=0;m<this._numStars;m++){var l=b[2*m+0],r=b[2*m+1];c.set(m,0,-Math.cos(l)*Math.sin(r));c.set(m,1,-Math.sin(l)*Math.sin(r));c.set(m,2,-Math.cos(r));
l=this._unpackUint8Attributes(d[m]);r=this._hexToRGB(A[l[1]]);f.set(m,0,255*r[0]);f.set(m,1,255*r[1]);f.set(m,2,255*r[2]);f.set(m,3,255);k.set(m,l[0])}return new t(a,q.program.attributes,{geometry:h.glLayout(B)},{geometry:p.createVertex(a,35044,e.buffer)})};f.prototype._verifyStartData=function(b){if(!b)throw new a("stars:no-data-received","Failed to create stars because star catalogue is missing");b=b.byteLength/this.bytesPerStar;if(0!==b%1||5E4<b||5E3>b)throw new a("stars:invalid-data","Failed to create stars because star catalogue data is invalid");
};f.prototype._loadBrightStarCatalogue=function(){var a=this;return D?(this._starData=D,b.resolve()):c(n.toUrl("./resources/stars.wsv"),{responseType:"array-buffer"}).then(function(b){b=b.data;a._verifyStartData(b);D=b;a._starData=b}).catch(function(a){a&&"cancel"!==a.dojoType&&v.error("loadBrightStarCatalogue",a.message);throw a;})};return f}();var A="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),
z=e.mat3d.toMat4(e.mat3d.createFrom(1,0,0,0,.9174771405229186,.39778850739794974,0,-.39778850739794974,.9174771405229186)),x=e.mat3d.toMat4(e.mat3d.createFrom(1,0,0,0,.9174771405229186,-.39778850739794974,0,.39778850739794974,.9174771405229186)),B=m.newLayout().vec3f("position").vec4u8("color").f32("size"),D=null;return g})},"esri/views/3d/webgl-engine/shaders/StarsPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,g,c,a){Object.defineProperty(g,
"__esModule",{value:!0});g.program={name:"stars",shaders:{vertexShader:a.resolveIncludes("environment/stars.vert"),fragmentShader:a.resolveIncludes("environment/stars.frag")},attributes:c.Default3D}})},"esri/views/3d/support/sunUtils":function(){define(["require","exports","../lib/gl-matrix","../lib/SunCalc","./mathUtils"],function(n,g,c,a,f){function b(a,b,d,e){for(var c=[],h=0;h<d.length;h++)c[h]=(e[h]-d[h])*a/b+d[h];return c}Object.defineProperty(g,"__esModule",{value:!0});g.settings={local:{altitude:1500,
ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,diffuseAtNoon:.65,diffuseAtTwilight:.7},global:{altitude:8E5,ambient:.015,diffuse:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}};g.computeColorAndIntensity=function(e,k){var d,m,l,r=k.z,u=h;c.vec3d.set3(1,1,1,u.ambient.color);u.ambient.intensity=g.settings.global.ambient;c.vec3d.set3(1,1,1,u.diffuse.color);u.diffuse.intensity=g.settings.global.diffuse;r=(Math.abs(r)-g.settings.local.altitude)/
(g.settings.global.altitude-g.settings.local.altitude);r=f.clamp(r,0,1);u.globalFactor=r;k=a.getTimes(e,k.y,k.x);if(1>r){m=e.valueOf();var t,v;k.polarException===a.POLAR_EXCEPTION.MIDNIGHT_SUN?(t=m-36E5*(e.getHours()+48)-6E4*e.getMinutes(),v=t+432E6):k.polarException===a.POLAR_EXCEPTION.POLAR_NIGHT?(t=m-2,v=m-1):(t=k.sunrise.valueOf(),v=k.sunset.valueOf());var A=v-t;l=t+A/2;var z=A/4;d=l-z;var z=l+z,x=.06*A,A=t-x/2;t+=x/2;var B=v-x/2,D=v+x/2;v=g.settings.local;var C=[.01,v.ambientAtNight],G=[.8,.8,
1],E=[.01,.01,.01],F=[v.diffuseAtTwilight,v.ambientAtTwilight],n=[1,.75,.75],K=[.8,.8,1],N=[.9*v.diffuseAtNoon,v.ambientAtNoon],H=[1,.98,.98],M=[.98,.98,1],T=[v.diffuseAtNoon,v.ambientAtNoon],V=[1,1,1],U=[1,1,1];v=[0,0];var J=[0,0],x=[0,0];m<A||m>D?(v=C,J=E,x=G):m<t?(x=t-A,v=b(m-A,x,C,F),J=b(m-A,x,E,n),x=b(m-A,x,G,K)):m<d?(x=d-t,v=b(m-t,x,F,N),J=b(m-t,x,n,H),x=b(m-t,x,K,M)):m<l?(x=l-d,v=b(m-d,x,N,T),J=b(m-d,x,H,V),x=b(m-d,x,M,U)):m<z?(x=z-l,v=b(m-l,x,T,N),J=b(m-l,x,V,H),x=b(m-l,x,U,M)):m<B?(x=B-z,
v=b(m-z,x,N,F),J=b(m-z,x,H,n),x=b(m-z,x,M,K)):m<D&&(x=D-B,v=b(m-B,x,F,C),J=b(m-B,x,n,E),x=b(m-B,x,K,G));m=v[0];l=J;d=v[1];c.vec3d.lerp(x,u.ambient.color,r,u.ambient.color);u.ambient.intensity=f.lerp(d,u.ambient.intensity,r);c.vec3d.lerp(l,u.diffuse.color,r,u.diffuse.color);u.diffuse.intensity=f.lerp(m,u.diffuse.intensity,r)}r=e.valueOf();k.polarException===a.POLAR_EXCEPTION.MIDNIGHT_SUN?(e=r-36E5*(e.getHours()+48)-6E4*e.getMinutes(),k=e+432E6):k.polarException===a.POLAR_EXCEPTION.POLAR_NIGHT?(e=r-
2,k=r-1):(e=k.sunrise.valueOf(),k=k.sunset.valueOf());e=1-f.clamp(Math.abs(r-(e+(k-e)/2))/432E5,0,1);u.noonFactor=e;return u};g.computeDirection=function(b,h,d,q){q||(q=c.vec3d.create());var k=e,m=c.mat4d.identity(l);if("global"===d)a.getPosition(b,0,0,k),c.vec3d.set3(0,0,-1,q),c.mat4d.rotateX(m,-k.azimuth),c.mat4d.rotateY(m,-k.altitude);else{var u=g.settings.planarDirection;d=u.globalAngles;u=(Math.abs(h.z)-u.localAltitude)/(u.globalAltitude-u.localAltitude);u=f.clamp(u,0,1);1>u?(a.getPosition(b,
h.y,h.x,k),k.azimuth=(1-u)*k.azimuth+u*d.azimuth,k.altitude=(1-u)*k.altitude+u*d.altitude):(k.azimuth=d.azimuth,k.altitude=d.altitude);c.vec3d.set3(0,-1,0,q);c.mat4d.rotateZ(m,-k.azimuth);c.mat4d.rotateX(m,-k.altitude)}c.mat4d.multiplyVec3(m,q);return q};g.computeShadowsEnabled=function(a,b){return"global"===b?!0:Math.abs(a.z)<g.settings.planarDirection.localAltitude};var l=c.mat4d.identity(),e={azimuth:0,altitude:0},h={ambient:{color:c.vec3d.create(),intensity:0},diffuse:{color:c.vec3d.create(),
intensity:0,direction:c.vec3d.create()},globalFactor:0,noonFactor:0}})},"esri/views/3d/lib/SunCalc":function(){define([],function(){function n(a){return new Date(864E5*(a+.5-2440588))}function g(a,b){return r(k(a)*d(A)-q(b)*k(A),d(a))}function c(a,b){return p(k(b)*d(A)+d(b)*k(A)*k(a))}function a(a,b,e){return r(k(a),d(a)*k(b)-q(e)*d(b))}function f(a,b,e){return p(k(b)*k(e)+d(b)*d(e)*d(a))}function b(a){return t*(1.9148*k(a)+.02*k(2*a)+3E-4*k(3*a))}function l(a,d){a=t*(357.5291+.98560028*a);var e=
b(a);a=a+e+102.9372*t+m;d||(d={dec:0,ra:0});d.dec=c(a,0);d.ra=g(a,0);return d}function e(a,b,d){return 2451545+a+.0053*k(b)-.0069*k(2*d)}function h(a){var b=t*(134.963+13.064993*a),e=t*(93.272+13.22935*a);a=t*(218.316+13.176396*a)+6.289*t*k(b);e=5.128*t*k(e);b=385001-20905*d(b);return{ra:g(a,e),dec:c(a,e),dist:b}}var m=Math.PI,k=Math.sin,d=Math.cos,q=Math.tan,p=Math.asin,r=Math.atan2,u=Math.acos,t=m/180,v={dec:0,ra:0},A=23.4397*t,z={POLAR_EXCEPTION:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(b,
d,e,c){e=t*-e;d*=t;var h=b.valueOf()/864E5-.5+2440588-2451545;b=l(h,v);e=t*(280.16+360.9856235*h)-e-b.ra;c||(c={azimuth:0,altitude:0});c.azimuth=a(e,d,b.dec);c.altitude=f(e,d,b.dec);return c}},x=[[-.83,"sunrise","sunset"]];z.addTime=function(a,b,d){x.push([a,b,d])};z.getTimes=function(a,h,f){function l(a){var b=q,c=B;a=u((k(a)-k(b)*k(c))/(d(b)*d(c)));return e(9E-4+(a+p)/(2*m)+r,g,v)}var p=t*-f,q=t*h,r=Math.round(a.valueOf()/864E5-.5+2440588-2451545-9E-4-p/(2*m));a=9E-4+(0+p)/(2*m)+r;var g=t*(357.5291+
.98560028*a);h=b(g);var v=g+h+102.9372*t+m,B=c(v,0);a=e(a,g,v);h={solarNoon:n(a),nadir:n(a-.5),polarException:z.POLAR_EXCEPTION.NORMAL};var A,D,C,U;f=0;for(A=x.length;f<A;f+=1)D=x[f],C=l(D[0]*t),U=a-(C-a),h[D[1]]=n(U),h[D[2]]=n(C);h.polarException=function(a){a=(k(a)-k(q)*k(B))/(d(q)*d(B));return-1>a?z.POLAR_EXCEPTION.MIDNIGHT_SUN:1<a?z.POLAR_EXCEPTION.POLAR_NIGHT:z.POLAR_EXCEPTION.NORMAL}(x[0][0]*t);return h};z.getMoonPosition=function(b,d,e){e=t*-e;d*=t;var c=b.valueOf()/864E5-.5+2440588-2451545;
b=h(c);e=t*(280.16+360.9856235*c)-e-b.ra;c=f(e,d,b.dec);c+=.017*t/q(c+10.26*t/(c+5.1*t));return{azimuth:a(e,d,b.dec),altitude:c,distance:b.dist}};z.getMoonFraction=function(a){var b=a.valueOf()/864E5-.5+2440588-2451545;a=l(b);b=h(b);a=u(k(a.dec)*k(b.dec)+d(a.dec)*d(b.dec)*d(a.ra-b.ra));a=r(149598E3*k(a),b.dist-149598E3*d(a));return(1+d(a))/2};return z})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["require","exports","../../lib/gl-matrix"],function(n,g,c){Object.defineProperty(g,
"__esModule",{value:!0});n=function(){return function(a,f,b){void 0===a&&(a=c.vec3d.create());void 0===f&&(f=c.vec3d.createFrom(.57735,.57735,.57735));void 0===b&&(b=!0);this.intensity=a;this.direction=f;this.castShadows=b}}();g.MainLight=n;n=function(){return function(a,f){void 0===a&&(a=c.vec3d.create());void 0===f&&(f=c.vec3d.createFrom(.57735,.57735,.57735));this.intensity=c.vec3d.create();this.direction=c.vec3d.create();this.intensity=a;this.direction=f}}();g.FillLight=n;n=function(){return function(a){void 0===
a&&(a=c.vec3d.create());this.intensity=a}}();g.AmbientLight=n;n=function(){return function(){this.sh={r:[0],g:[0],b:[0]}}}();g.SphericalHarmonicsLight=n})},"esri/views/3d/input/SceneInputManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyPan ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/ViewEvents ../../input/handlers/PreventContextMenu".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D){n=function(f){function g(){var a=null!==f&&f.apply(this,arguments)||this;a._handles=new b;return a}c(g,f);g.prototype.initialize=function(){var a=this;this.viewEvents=new B.ViewEvents(this.view);this._handles.add([l.whenNot(this.view,"ready",function(){return a._disconnect()}),l.when(this.view,"ready",function(){return a._connect()})])};g.prototype.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this._disconnect()};
Object.defineProperty(g.prototype,"primaryDragAction",{get:function(){return this._get("primaryDragAction")},set:function(a){"pan"!==a&&"rotate"!==a||a===this._get("primaryDragAction")||(this._set("primaryDragAction",a),this._updateMode())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"mode",{get:function(){return this._get("mode")},set:function(a){"default"!==a&&"pro"!==a||a===this._get("mode")||(this._set("mode",a),this._updateMode())},enumerable:!0,configurable:!0});g.prototype._disconnect=
function(){this.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};g.prototype._connect=function(){var a=this.view;this._source=new z.BrowserEventSource(this.view.surface,a.input);var b=new x.InputManager(this._source);this._inputManager=b;b.installHandlers("prevent-context-menu",[new D.PreventContextMenu]);this._modeDragPan=new r.PinchAndPanNavigation(a,"primary");this._modeDragRotate=new m.DragRotate(a,
"secondary","center");this._modeDragZoom=new k.DragZoom(a,"tertiary");b.installHandlers("navigation",[new u.PointerDownCancelAnimation(a),new h.DoubleClickZoom(a),new d.GamepadNavigation(a),new q.KeyPan(a,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j"}),new p.MouseWheelZoom(a),new v.SingleKeyResetTilt(a,"p"),new t.SingleKeyResetHeading(a,"n"),new m.DragRotate(a,"primary","eye",["b"]),new m.DragRotate(a,"secondary","center",["b"]),new r.PinchAndPanNavigation(a,
"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new A.TwoFingerTilt(a)]);this.viewEvents.connect(b);this._updateMode()};g.prototype._updateMode=function(){var a=this.primaryDragAction,a=C.get(this.mode).get(a);this._modeDragPan&&(this._modeDragPan.pointerAction=a.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=a.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=a.zoom)};a([e.property()],g.prototype,"view",void 0);a([e.property({value:"pan"})],
g.prototype,"primaryDragAction",null);a([e.property({value:"default"})],g.prototype,"mode",null);a([e.property({readOnly:!0,aliasOf:"_inputManager.latestPointerType"})],g.prototype,"latestPointerType",void 0);a([e.property()],g.prototype,"_inputManager",void 0);return g=a([e.subclass("esri.views.3d.input.SceneInputManager")],g)}(e.declared(f));var C=new Map;g=new Map;f=new Map;g.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});g.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});
f.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});f.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});C.set("default",g);C.set("pro",f);return n})},"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,g,c,a,f,b,l){Object.defineProperty(g,
"__esModule",{value:!0});n=function(b){function e(a,e){var d=b.call(this,!0)||this;d.view=a;d.registerIncoming("double-click",e,function(a){return d.handleDoubleClick(a)});return d}c(e,b);e.prototype.handleDoubleClick=function(b){var e=b.data;if(l.eventMatchesPointerAction(e,"primary")){var d=this.view.state.isGlobal?new a.ZoomStepController(this.view,"animation"):new f.ZoomStepController(this.view,"animation");this.view.state.switchCameraController(d);d.zoomStep(Math.log(.5)/Math.log(.6),[e.x,this.view.height-
e.y]);b.stopPropagation()}};return e}(b.InputHandler);g.DoubleClickZoom=n})},"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../PointToPointAnimationController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),function(n,g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function k(a,
c){var d=b.call(this,a.state,a.sceneIntersectionHelper,"interaction"===c?null:void 0)||this;d.view=a;d.mode=c;d.zoomLocation=f.vec3d.create();d.tmpCamera=new e;d.panAxis=f.vec3d.create();d.tmpViewDir=f.vec3d.create();d.targetOnSphere=f.vec3d.create();d.tmpCenter=f.vec3d.create();d.constraintOptions={selection:7,interactionType:1,interactionFactor:null,interactionStartCamera:new e,interactionDirection:null,tiltMode:0};d.sphere={center:f.vec3d.create(),radius:0};return d}c(k,b);Object.defineProperty(k.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});k.prototype.zoomStep=function(a,b){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);e=!1;0<a&&this.intersectionHelper.pickPointInScreen(b,this.zoomLocation)&&(e=!0);this.tmpCamera.copyFrom(d.camera);e?this.intersectionHelper.pickPointFromSegment(this.tmpCamera.eye,this.tmpCamera.center,this.tmpCenter)&&
(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.pickPointFromSegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:f.vec3d.set(this.tmpCamera.center,this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};k.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:h.outExpo}};k.prototype.updateCamera=function(b,e,c,h){this.sphere.radius=f.vec3d.length(c);
f.vec3d.subtract(b.center,b.eye,this.tmpViewDir);var d=f.vec3d.length(this.tmpViewDir),k=d*e;1>=e&&4>k&&(k=4,e=k/d);1E-6>Math.abs(d-k)||(d=f.vec3d.length(b.center),this.sphere.radius!==d&&f.vec3d.scale(b.center,(this.sphere.radius+e*(d-this.sphere.radius))/d),f.vec3d.scale(this.tmpViewDir,-e),f.vec3d.add(b.center,this.tmpViewDir,b.eye),a.applyAll(this.view,b,this.constraintOptions),1E-12<f.vec3d.dist2(c,b.center)&&l.intersectSphereFromScreenPoint(this.sphere,b,h,this.targetOnSphere)&&(e=l.rotationAndAxisFromPoints(c,
this.targetOnSphere,this.panAxis),l.applyRotation(b,this.sphere.center,this.panAxis,e)),a.applySurfaceCollision(this.view,b))};return k}(b.PointToPointAnimationController);g.ZoomStepController=n})},"esri/views/3d/camera/constraintUtils":function(){define("require exports ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../lib/gl-matrix ../../animation/easing ./constraintUtils/tilt ./constraintUtils/altitude ./constraintUtils/distance ./constraintUtils/surfaceCollision".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q){Object.defineProperty(g,"__esModule",{value:!0});g.applyTilt=m.apply;g.tiltError=m.error;g.applyAltitude=k.apply;g.altitudeError=k.error;g.applyDistance=d.apply;g.distanceError=d.error;g.applySurfaceCollision=q.apply;g.applyAll=function(d,e,c,h){void 0===c&&(c=r);void 0===h&&(h=e);var f=!1;h!==e&&h.copyFrom(e);h.markViewDirty();h.computeUp(d.state.mode);for(e=0;e<u;e++){for(var k=0,m=0,l=p;m<l.length;m++){var q=l[m];if(a.hasConstraintType(c.selection,q.type)){var t=
Math.abs(q.error(d,h,c));q.apply(d,h,c)&&(f=!0,k+=t)}}if(0===k)break}e=a.hasConstraintType(c.selection,8);a:switch(c.interactionType){case 4:c=1;break a;case 5:c=d.state.isGlobal?2:1;break a;default:c=0}e&&b.apply(d,h,c)&&(f=!0);f&&h.computeUp(d.state.mode);return f};g.pixelDistanceToInteractionFactor=function(a,b){a="number"===typeof a?a:e.vec2d.dist(a,b);return h.inOutCubic(Math.min(1,a/150))};var p=[{type:1,error:function(a,b,d){return l.error(a,b,d)*b.distance},apply:l.apply},{type:2,error:c.error,
apply:c.apply},{type:4,error:f.error,apply:f.apply}],r={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0},u=5})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("require exports ./common ../../lib/gl-matrix ../../support/intersectionUtils ../../support/mathUtils".split(" "),function(n,g,c,a,f,b){function l(a,d,e){void 0===e&&(e=c.defaultApplyOptions);var f;f=a.state.constraints.altitude;f=a.state.isGlobal&&f?2===
e.interactionType&&c.hasConstraintType(e.selection,1)?!1:!0:!1;if(!f)return 0;var k=a.state.constraints.altitude;f=h;f.min=k.min;f.max=k.max;var m=e.interactionType;if(0!==m){var k=f.min,p=f.max,q=e.interactionStartCamera;e=e.interactionFactor;var m=2===m||1===m,r=l(a,q),q=0===r?0:a.renderCoordsHelper.getAltitude(q.eye);f.min=k;f.max=p;c.adjustRangeForInteraction(r,q,m,e,.05*q,f)}a=a.renderCoordsHelper.getAltitude(d.eye);a=b.clamp(a,f.min,f.max)-a;return 1E-6>=Math.abs(a)?0:a}function e(b,d,e,c){b.renderCoordsHelper.worldUpAtPosition(d.eye,
c);a.vec3d.scale(c,e);return c}Object.defineProperty(g,"__esModule",{value:!0});g.apply=function(h,p,r,u){void 0===r&&(r=c.defaultApplyOptions);void 0===u&&(u=p);u!==p&&u.copyFrom(p);var q=l(h,p,r);if(0===q)return!1;var g=h.renderCoordsHelper,A=g.getAltitude(p.eye)+q;h=c.interactionDirectionTowardsConstraintMinimization(h,p,r.interactionDirection,e(h,p,b.sign(q),k),m);r=a.vec3d.set(p.viewForward,d);g.intersectManifold(p.eye,h,A,u.eye)||g.setAltitude(A,u.eye);f.closestPointOnRay(p.eye,r,p.center,p.center);
u.markViewDirty();return!0};g.error=l;var h={min:0,max:0},m=a.vec3d.create(),k=a.vec3d.create(),d=a.vec3d.create()})},"esri/views/3d/camera/constraintUtils/common":function(){define(["require","exports","../../lib/gl-matrix","../../support/mathUtils"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.hasConstraintType=function(a,b){return 0!==(a&b)};g.adjustRangeForInteraction=function(a,b,c,e,h,m){0!==a&&(c?(m.min=Math.min(m.min,b),m.max=Math.max(m.max,b)):null!=e?(m.min-=Math.max(0,
(b-m.min)*(1-e)),m.max+=Math.max(0,(b-m.max)*(1-e))):h&&(m.min-=Math.max(0,b-m.min-h),m.max+=Math.max(0,b-m.max-h)))};g.defaultApplyOptions={selection:0,interactionType:0,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};g.interactionDirectionTowardsConstraintMinimization=function(f,b,l,e,h){l||(l=b.viewForward);c.vec3d.set(l,h);c.vec3d.scale(h,a.sign(c.vec3d.dot(l,e)));return h}})},"esri/views/3d/support/intersectionUtils":function(){define(["require","exports",
"../lib/gl-matrix"],function(n,g,c){function a(a,b,f,k){var d=l;a?(f&&k&&(d.len=c.vec3d.dist(b,f)),c.vec3d.set(a,d.dir)):k?(d.len=c.vec3d.dist(b,f),c.vec3d.scale(c.vec3d.subtract(f,b,d.dir),1/d.len)):c.vec3d.normalize(c.vec3d.subtract(f,b,d.dir));return d}function f(a,b){return-c.vec3d.dot(b,a)-a[3]}function b(a,b,m,k){k.clip[0]=0;k.clip[1]=m?k.len:Number.MAX_VALUE;for(m=0;m<a.length;m++){var d;var e=a[m],h=b;d=k;var l=c.vec3d.dot(e,d.dir),e=f(e,h);0>e&&0<=l?d=!1:-1E-6<l&&1E-6>l?d=0<e:!(0>e||0>l)||
0>e&&0>l?(e/=l,0<l?e<d.clip[1]&&(d.clip[1]=e):e>d.clip[0]&&(d.clip[0]=e),d=d.clip[0]<=d.clip[1]):d=!0;if(!d)return!1}return!0}Object.defineProperty(g,"__esModule",{value:!0});g.planeSphere=function(a,b,c){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]<c};g.frustumSphere=function(a,b,c){var e=b[0],d=b[1];b=b[2];return a[0][0]*e+a[0][1]*d+a[0][2]*b+a[0][3]>c||a[1][0]*e+a[1][1]*d+a[1][2]*b+a[1][3]>c||a[2][0]*e+a[2][1]*d+a[2][2]*b+a[2][3]>c||a[3][0]*e+a[3][1]*d+a[3][2]*b+a[3][3]>c||a[4][0]*e+a[4][1]*d+a[4][2]*
b+a[4][3]>c||a[5][0]*e+a[5][1]*d+a[5][2]*b+a[5][3]>c?!1:!0};g.frustumRay=function(e,c,f,k){f=a(k,c,f,!1);return b(e,c,null,f)};g.frustumPoint=function(a,b){for(var e=0;6>e;e++)if(0>f(a[e],b))return!1;return!0};g.frustumLineSegment=function(e,c,f,k){k=a(k,c,f,!0);return b(e,c,f,k)};g.closestPointOnRay=function(a,b,f,k){f=c.vec3d.dot(b,c.vec3d.subtract(f,a,k));c.vec3d.add(a,c.vec3d.scale(b,f,k),k);return k};var l={dir:c.vec3d.create(),len:0,clip:c.vec2d.create()}})},"esri/views/3d/camera/constraintUtils/distance":function(){define(["require",
"exports","./common","../../lib/gl-matrix","../../webgl-engine/lib/Util"],function(n,g,c,a,f){function b(d,e,h){void 0===h&&(h=c.defaultApplyOptions);if(!d.state.isLocal)return 0;var f=d.state.constraints.distance;if(!d.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===f)return 0;l.min=0;l.max=f;var f=l,k=h.interactionType;if(0!==k){var m=f.min,p=f.max,q=h.interactionStartCamera;h=h.interactionFactor;var k=1===k||4===k,g=b(d,q),q=0===g?0:a.vec3d.dist(q.eye,d.pointsOfInterest.surfaceOrigin.renderLocation);
f.min=m;f.max=p;c.adjustRangeForInteraction(g,q,k,h,.05*q,f)}d=a.vec3d.dist(e.eye,d.pointsOfInterest.surfaceOrigin.renderLocation);d=l.max-d;return-1E-6<=d?0:d}Object.defineProperty(g,"__esModule",{value:!0});g.error=b;g.apply=function(d,l,p,r){void 0===p&&(p=c.defaultApplyOptions);void 0===r&&(r=l);r!==l&&r.copyFrom(l);var q=b(d,l,p);if(0===q)return!1;var t=d.pointsOfInterest.surfaceOrigin,q=a.vec3d.dist(l.eye,d.pointsOfInterest.surfaceOrigin.renderLocation)+q,g=a.vec3d.set(l.eye,e);p=c.interactionDirectionTowardsConstraintMinimization(d,
l,p.interactionDirection,a.vec3d.direction(d.pointsOfInterest.surfaceOrigin.renderLocation,l.eye,k),m);return f.raySphere(l.eye,p,t.renderLocation,q,r.eye)?(l=a.vec3d.subtract(r.eye,g,h),a.vec3d.add(r.center,l),r.markViewDirty(),l=d.renderCoordsHelper.getAltitude(r.center),d.renderCoordsHelper.intersectManifold(r.eye,r.viewForward,l,r.center),r.markViewDirty(),!0):!1};var l={min:0,max:0},e=a.vec3d.create(),h=a.vec3d.create(),m=a.vec3d.create(),k=a.vec3d.create()})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["require",
"exports","../intersectionUtils","../../lib/gl-matrix"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.apply=function(b,l,e,h){void 0===e&&(e=0);void 0===h&&(h=l);var m=b.state.constraints;l!==h&&h.copyFrom(l);if(!m.collision.enabled)return!1;var k=c.surfaceElevationBelowEye(b,l);l=b.renderCoordsHelper.getAltitude(l.eye);m=k+m.collision.elevationMargin;if(l>=m)return!1;k=a.vec3d.length(h.eye);a.vec3d.subtract(h.center,h.eye,f);b.renderCoordsHelper.setAltitude(m,h.eye);1===e?
a.vec3d.add(h.eye,f,h.center):2===e&&a.vec3d.scale(h.center,(k-l+m)/k);h.markViewDirty();return!0};var f=a.vec3d.create()})},"esri/views/3d/camera/intersectionUtils":function(){define("require exports ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ../support/earthUtils ../webgl-engine/lib/Selector".split(" "),function(n,g,c,a,f,b,l){function e(a,b){return a.renderCoordsHelper.fromRenderCoords(b,p,a.basemapTerrain.spatialReference)?a.basemapTerrain.getElevation(p)||
0:0}function h(a,b,d){if(!a.state.isGlobal)return!1;var c=e(a,b);a=a.stateManager.constraintsManager.nearFarHeuristic.compute(b,d,a.dataExtent,c,u).far;a*=a;return f.vec3d.dist2(b,d)>a}function m(a,d,e,c){void 0===c&&(c=f.vec3d.create());var m=k[a.viewingMode];m||(m=new l(a.viewingMode),m.enableBackfacesTerrain=!a.state.isGlobal,m.enableInvisibleTerrain=!0,k[a.viewingMode]=m);var p=a.state.isGlobal;if(a.sceneIntersectionHelper.pickPointFromSegment(d,e,c,m)&&!h(a,d,c))return c;m=f.vec3d.direction(e,
d,r);if(!a.renderCoordsHelper.intersectManifold(d,m,0,c)||h(a,d,c))p?(a=c,p=f.vec3d.dot(d,d)-b.earthRadius*b.earthRadius,p=0<p?Math.sqrt(p)/3:1,f.vec3d.subtract(e,d,a),f.vec3d.scale(a,p/f.vec3d.length(a),a),f.vec3d.add(a,d)):e!==c&&f.vec3d.set(e,c);return c}Object.defineProperty(g,"__esModule",{value:!0});g.eyeWithinExtent=function(b,e,c,h){return b.renderCoordsHelper.fromRenderCoords(e.eye,d,h)&&a.containsPoint(c,d)};g.surfaceElevationBelowEye=function(a,b){return e(a,b.eye)};g.surfaceElevationBelowRenderPoint=
e;g.cameraOnContentAlongViewDirection=function(a,b,d,e){var c=a.state.camera.copy();b&&(c.eye=b);d&&(c.center=d);e&&(c.up=e);m(a,c.eye,c.center,q);d=a.state.constraints;e=d.minimumPoiDistance;f.vec3d.dist2(c.eye,q)<e&&(b=d.collision.enabled,f.vec3d.set(c.viewForward,r),f.vec3d.scale(r,e),b?f.vec3d.subtract(q,r,c.eye):f.vec3d.add(c.eye,r,q),a=a.renderCoordsHelper,e=a.getAltitude(c.eye),d=d.collision.elevationMargin,b&&e<d&&(f.vec3d.subtract(q,c.eye,r),a.setAltitude(d,c.eye),f.vec3d.add(c.eye,r,q)));
c.center=q;return c};g.contentAlongViewDirection=m;var k={},d=f.vec3d.create(),q=f.vec3d.create(),p=new c,r=f.vec3d.create(),u={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/Selector":function(){define("require exports ../../../../core/has ../../lib/gl-matrix ./Object3D ./PerformanceTimer".split(" "),function(n,g,c,a,f,b){var l=a.vec3d.create(),e=a.vec3d.create(),h=a.vec3d.create();n=function(){function b(b){this.minResult=new m;this.maxResult=new m;this._normalDir=null;this._transform=a.mat4d.create();
this._transformInverse=new k({value:this._transform},a.mat4d.inverse,a.mat4d.create);this._transformInverseTranspose=new k(this._transformInverse,a.mat4d.transpose,a.mat4d.create);this._transformTranspose=new k({value:this._transform},a.mat4d.transpose,a.mat4d.create);this._transformInverseRotation=new k({value:this._transform},a.mat4d.toInverseMat3,a.mat3d.create);this.enableTerrain=this.enableHUDSelection=!0;this.enableInvisibleTerrain=!1;this.enableBackfacesTerrain=!0;this.performanceInfo={queryDuration:0,
numObjectsTested:0};this.viewingMode=b||"global"}b.prototype.init=function(b,d,e,c,f,k,m,l){var p=this;d&&e&&a.vec3d.subtract(e,d,h);this.minResult.init(d,e);this.maxResult.init(d,e);this._numObjectsTested=0;this.point=c;this.camera=f;this.isSelection=m;this.p0=d;this.p1=e;this.hudResults=[];null==k&&(k=1E-5);this.tolerance=k;if(b)for(d=function(a){p.intersectObject(a,l)},e=0;e<b.length;e++)if(c=b[e],f=c.getSpatialQueryAccelerator?c.getSpatialQueryAccelerator():void 0)f.forEachAlongRay(this.p0,h,
d),m&&f.forEachDegenerateObject(d);else for(f=0,c=c.getObjects();f<c.length;f++)d(c[f])};Object.defineProperty(b.prototype,"transformInverse",{get:function(){return this._transformInverse.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformInverseTranspose",{get:function(){return this._transformInverseTranspose.value},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformInverseRotation",{get:function(){return this._transformInverseRotation.value},
enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"transformTranspose",{get:function(){return this._transformTranspose.value},enumerable:!0,configurable:!0});b.prototype.getDirection=function(){this._normalDir||(this._normalDir=a.vec3d.create(),a.vec3d.normalize(h,this._normalDir));return this._normalDir};b.prototype.intersectObject=function(b,d){var c=this;this._numObjectsTested++;for(var h=b.id,f=b.getGeometryRecords(),k=b.objectTransformation,p,q=0;q<f.length;q++){var r=f[q],g=
r.geometry,C=r.materials,G=r.instanceParameters;G.hidden||(p=g.id,a.mat4d.set(k,this._transform),a.mat4d.multiply(this._transform,r.getShaderTransformation()),this._transformInverse.invalidate(),this._transformInverseTranspose.invalidate(),this._transformTranspose.invalidate(),this._transformInverseRotation.invalidate(),a.mat4d.multiplyVec3(this.transformInverse,this.p0,l),a.mat4d.multiplyVec3(this.transformInverse,this.p1,e),C[0].intersect(g,G,this._transform,this,l,e,function(a,e,f,k,l,q){0<=a&&
(null==d||d(c.p0,c.p1,a))&&(l?(l=new m,l.init(c.p0,c.p1),l.set(b,h,a,e,k,q,p,f),c.hudResults.push(l)):((null==c.minResult.priority||k>=c.minResult.priority)&&(null==c.minResult.dist||a<c.minResult.dist)&&c.minResult.set(b,h,a,e,k,null,p,f),(null==c.maxResult.priority||k>=c.maxResult.priority)&&(null==c.maxResult.dist||a>c.maxResult.dist)&&c.maxResult.set(b,h,a,e,k,null,p,f)))},r.customTransformation),this.minResult.geometryId===p&&a.mat4d.set(this._transform,this.minResult.transformation),this.maxResult.geometryId===
p&&a.mat4d.set(this._transform,this.maxResult.transformation))}};b.DEFAULT_TOLERANCE=1E-5;return b}();var m=function(){function b(b,d){this.transformation=a.mat4d.identity();this.normal=a.vec3d.create();this.init(b,d)}b.prototype.getIntersectionPoint=function(b){if(null==this.dist)return!1;a.vec3d.lerp(this.p0,this.p1,this.dist,b);return!0};b.prototype.getTransformedNormal=function(b){a.vec3d.set(this.normal,d);d[3]=0;a.mat4d.multiplyVec4(this.transformation,d);a.vec3d.set(d,b);a.vec3d.normalize(b);
return b};b.prototype.set=function(b,d,e,c,h,k,m,l){b instanceof f&&(b={type:"stage",obj:b});this.dist=e;a.vec3d.set(c,this.normal);this.target=b;this.name=d;this.priority=h;this.center=k?a.vec3d.create(k):null;this.geometryId=m;this.triangleNr=l};b.prototype.copyFrom=function(b){this.p0=b.p0;this.p1=b.p1;this.dist=b.dist;this.target=b.target;this.name=b.name;this.priority=b.priority;this.center=b.center?a.vec3d.create(b.center):null;this.geometryId=b.geometryId;this.triangleNr=b.triangleNr;this.intersector=
b.intersector;a.vec3d.set(b.normal,this.normal)};b.prototype.setIntersector=function(a){this.intersector=a};b.prototype.init=function(a,b){this.priority=this.name=this.target=this.dist=void 0;this.triangleNr=this.geometryId=this.center=null;this.intersector="Stage";this.p0=a;this.p1=b};return b}(),k=function(){function a(a,b,d){this.original=a;this.update=b;this.dirty=!0;this.transform=d()}a.prototype.invalidate=function(){this.dirty=!0};Object.defineProperty(a.prototype,"value",{get:function(){this.dirty&&
(this.update(this.original.value,this.transform),this.dirty=!1);return this.transform},enumerable:!0,configurable:!0});return a}(),d=a.vec4d.create();return n})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("require exports ../../lib/gl-matrix ./ComponentUtils ./GeometryRecord ./HighlightUtils ./IdGen ./ModelContentType ./Util".split(" "),function(n,g,c,a,f,b,l,e,h){var m=h.assert,k=c.mat4d.identity();n=function(){function h(a){void 0===a&&(a={});this._bvObjectSpace=new d;this._bvWorldSpace=
new d;this._bvDirty=!0;this._hasVolatileTransformation=!1;this._allComponentsHiddenDirty=!0;this.id=h._idGen.gen(a.idHint);this.name=a.name;this.castShadow=null!=a.castShadow?a.castShadow:!0;this.metadata=a.metadata;this.objectTransformation=c.mat4d.identity();this._initializeGeometryRecords(a.geometries,a.materials,a.transformations,a.origins)}h.prototype._initializeGeometryRecords=function(a,b,d,e){if(Array.isArray(a)){m(b.length===a.length,"Object3D: materials don't match geometries");m(d.length===
a.length,"Object3D: transformations don't match geometries");this.geometryRecords=Array(a.length);this.geometries=a.slice();for(var h=0;h<a.length;h++)m(Array.isArray(b[h]),"Object3D: materials parameter must be array of array"),this.geometryRecords[h]=new f(a[h],b[h].slice(),c.mat4d.create(d[h]),{},e&&e[h]);this._hasVolatileTransformation=!1}else this.geometryRecords=[],this.geometries=[]};Object.defineProperty(h.prototype,"parentLayer",{get:function(){return this._parentLayer},set:function(a){m(null==
this._parentLayer||null==a,"Object3D can only be added to a single Layer");this._parentLayer=a},enumerable:!0,configurable:!0});h.prototype.getParentLayer=function(){return this.parentLayer};h.prototype.addParentLayer=function(a){this.parentLayer=a};h.prototype.removeParentLayer=function(a){this.parentLayer=null};h.prototype.getNumGeometryRecords=function(){return this.geometryRecords.length};h.prototype.getFirstGeometryIndex=function(a){a=this.geometries.indexOf(a);m(-1<a,"Object3D.getFirstGeometryIndex: geometry not found");
return a};h.prototype.findGeometryRecords=function(a){for(var b=[],d=0;d<this.geometries.length;d++)this.geometries[d]===a&&b.push(this.geometryRecords[d]);return b};h.prototype.getGeometryRecord=function(a){m(0<=a&&a<this.geometryRecords.length,"Object3d.getGeometryDataByIndex: index out of range");return this.geometryRecords[a]};h.prototype.getGeometryRecords=function(){return this.geometryRecords};h.prototype.addGeometry=function(a,b,d,e,h,l){void 0===d&&(d=k);m(Array.isArray(b),"Object3D.addGeometry: materials must be array");
this.geometries.push(a);a=new f(a,b.slice(),c.mat4d.create(d),e||{},h,l);this.geometryRecords.push(a);this._hasVolatileTransformation=this.geometryRecords.some(function(a){return!!a.customTransformation});this._notifyDirty("objGeometryAdded",a);this._invalidateBoundingVolume();this._allComponentsHiddenDirty=!0;return a};h.prototype.hasGeometry=function(a){return-1<this.geometries.indexOf(a)};h.prototype.removeGeometry=function(a){var b=this.geometryRecords.splice(a,1)[0];this._hasVolatileTransformation=
this.geometryRecords.some(function(a){return!!a.customTransformation});this.geometries.splice(a,1);this._notifyDirty("objGeometryRemoved",b);this._invalidateBoundingVolume();this._allComponentsHiddenDirty=!0;return b};h.prototype.removeAllGeometries=function(){for(;0<this.getNumGeometryRecords();)this.removeGeometry(0)};h.prototype.geometryVertexAttrsUpdated=function(a){this._notifyDirty("vertexAttrsUpdated",this.geometryRecords[a]);this._invalidateBoundingVolume()};h.prototype.areAllComponentsHidden=
function(){if(this._allComponentsHiddenDirty){this._allComponentsHiddenDirty=!1;this._allComponentsHidden=!0;for(var b=0,d=this.geometryRecords;b<d.length;b++){var e=d[b];if(!a.isAllHidden(e.instanceParameters.componentVisibilities,e.geometry.data.componentOffsets)){this._allComponentsHidden=!1;break}}}return this._allComponentsHidden};h.prototype.areAllComponentsVisible=function(){for(var b=0,d=this.geometryRecords;b<d.length;b++){var e=d[b];if(!a.isAllVisible(e.instanceParameters.componentVisibilities,
e.geometry.data.componentOffsets))return!1}return!0};h.prototype.hasComponents=function(){for(var b=!1,d=0;d<this.geometries.length&&!(b=a.hasComponents(this.geometries[d].data.componentOffsets));d++);return b};h.prototype.setComponentVisibility=function(b,d,e){d=a.updateVisibility(b.instanceParameters.componentVisibilities,b.geometry.data.componentOffsets,d,e);b.instanceParameters.componentVisibilities=d;this._notifyDirty("visibilityChanged",b);this._allComponentsHiddenDirty=!0};h.prototype.setHidden=
function(a,b){a.instanceParameters.hidden=!!b;this._notifyDirty("visibilityChanged",a)};h.prototype.isHidden=function(a){return!!a.instanceParameters.hidden};h.prototype.getComponentVisibility=function(b,d){return a.getVisibility(b.instanceParameters.componentVisibilities,d)};h.prototype.hideAllComponents=function(){for(var b=0,d=this.geometryRecords;b<d.length;b++){var e=d[b],c=a.hideAllComponents(e.instanceParameters.componentVisibilities);e.instanceParameters.componentVisibilities=c}this._notifyDirty("visibilityChanged");
this._allComponentsHiddenDirty=!0};h.prototype.unhideAllComponents=function(){for(var b=0,d=this.geometryRecords;b<d.length;b++){var e=d[b],c=a.unhideAllComponents(e.instanceParameters.componentVisibilities);e.instanceParameters.componentVisibilities=c}this._notifyDirty("visibilityChanged");this._allComponentsHiddenDirty=!0};h.prototype._setComponentHighlight=function(b,d,e,c){d=a.addHighlight(b.instanceParameters.componentHighlights,d,e,c);b.instanceParameters.componentHighlights=d};h.prototype.setComponentHighlight=
function(a,d,e){var c=b.generateHighlightId();this._setComponentHighlight(a,d,e,c);this._notifyDirty("componentHighlightChanged");return c};h.prototype.highlightAllComponents=function(a){for(var d=b.generateHighlightId(),e=0,c=this.geometryRecords;e<c.length;e++)this._setComponentHighlight(c[e],null,a,d);this._notifyDirty("componentHighlightChanged");return d};h.prototype.removeHighlights=function(b){for(var d=0,e=this.geometryRecords;d<e.length;d++){var c=e[d].instanceParameters,h=a.removeHighlight(c.componentHighlights,
b);c.componentHighlights=h}this._notifyDirty("componentHighlightChanged")};h.prototype.getComponentFromTriangleNr=function(b,d){m(0<=b&&b<this.geometryRecords.length,"Object3d.getComponentFromTriangleNr: index out of range");return a.componentFind(this.geometryRecords[b].geometry.data.componentOffsets,3*d)};h.prototype.setGeometryTransformation=function(a,b){m(0<=a&&a<this.geometryRecords.length,"Object3d.setGeometryTransformation: index out of range");var d=this.geometryRecords[a];b=new f(d.geometry,
d.materials,c.mat4d.create(b),d.instanceParameters);this.geometryRecords[a]=b;this._notifyDirty("objGeometryReplaced",[d,b]);this._invalidateBoundingVolume()};h.prototype.getObjectTransformation=function(){return c.mat4d.create(this.objectTransformation)};h.prototype.setObjectTransformation=function(a){c.mat4d.set(a,this.objectTransformation);this._invalidateBoundingVolume();this._notifyDirty("objTransformation")};h.prototype.getCombinedStaticTransformation=function(a,b){b=b||c.mat4d.create();c.mat4d.multiply(this.objectTransformation,
a.getStaticTransformation(),b);return b};h.prototype.getCombinedShaderTransformation=function(a,b){b=b||c.mat4d.create();c.mat4d.multiply(this.objectTransformation,a.getShaderTransformation(),b);return b};h.prototype.hasVolativeTransformation=function(){return this._hasVolatileTransformation};h.prototype.getCastShadow=function(){return this.castShadow};h.prototype.setCastShadow=function(a){this.castShadow=a};h.prototype.getMetadata=function(){return this.metadata};h.prototype.getName=function(){return this.name};
h.prototype.getBBMin=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMin:this._bvWorldSpace.bbMin};h.prototype.getBBMax=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bbMax:this._bvWorldSpace.bbMax};h.prototype.getCenter=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.center:this._bvWorldSpace.center};h.prototype.getBSRadius=function(a){this._validateBoundingVolume();return a?this._bvObjectSpace.bsRadius:this._bvWorldSpace.bsRadius};
h.prototype._validateBoundingVolume=function(){if(this._bvDirty||this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],d=this.geometryRecords[a],b=b.boundingInfo;this._calculateTransformedBoundingVolume(b,this._bvObjectSpace,d.getShaderTransformation());this._calculateTransformedBoundingVolume(b,this._bvWorldSpace,this.getCombinedShaderTransformation(d))}c.vec3d.lerp(this._bvObjectSpace.bbMin,this._bvObjectSpace.bbMax,
.5,this._bvObjectSpace.center);c.vec3d.lerp(this._bvWorldSpace.bbMin,this._bvWorldSpace.bbMax,.5,this._bvWorldSpace.center);for(var d=c.vec3d.create(),e=c.vec3d.create(),h=c.mat4d.maxScale(this.objectTransformation),a=0;a<this.geometryRecords.length;++a){var b=this.geometries[a],f=this.geometryRecords[a].getShaderTransformation(),k=c.mat4d.maxScale(f),b=b.boundingInfo;c.mat4d.multiplyVec3(f,b.getCenter(),d);f=c.vec3d.dist(d,this._bvObjectSpace.center);b=b.getBSRadius()*k;this._bvObjectSpace.bsRadius=
Math.max(this._bvObjectSpace.bsRadius,f+b);c.mat4d.multiplyVec3(this.objectTransformation,d,e);k=c.vec3d.dist(e,this._bvWorldSpace.center);this._bvWorldSpace.bsRadius=Math.max(this._bvWorldSpace.bsRadius,k+b*h)}this._bvDirty=!1}};h.prototype._calculateTransformedBoundingVolume=function(a,b,d){var e=a.getBBMin();a=a.getBBMax();var h=c.vec3d.create(e),f=c.vec3d.create(a);c.mat4d.multiplyVec3(d,h);c.mat4d.multiplyVec3(d,f);for(var k=0;3>k;++k)b.bbMin[k]=Math.min(b.bbMin[k],h[k],f[k]),b.bbMax[k]=Math.max(b.bbMax[k],
h[k],f[k]);for(k=0;3>k;++k){c.vec3d.set(e,h);c.vec3d.set(a,f);h[k]=a[k];f[k]=e[k];c.mat4d.multiplyVec3(d,h);c.mat4d.multiplyVec3(d,f);for(var m=0;3>m;++m)b.bbMin[m]=Math.min(b.bbMin[m],h[m],f[m]),b.bbMax[m]=Math.max(b.bbMax[m],h[m],f[m])}};h.prototype._invalidateBoundingVolume=function(){this._bvDirty=!0;this._parentLayer&&this._parentLayer.notifyObjectBBChanged(this,{center:this._bvWorldSpace.center,radius:this._bvWorldSpace.bsRadius})};h.prototype._notifyDirty=function(a,b,d,c){this._parentLayer&&
(d=d||e.OBJECT,this._parentLayer.notifyDirty(a,b,d,c||this))};h._idGen=new l;return h}();var d=function(){function a(){this.bbMin=c.vec3d.create();this.bbMax=c.vec3d.create();this.center=c.vec3d.create();this.bsRadius=0}a.prototype.init=function(){c.vec3d.set3(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,this.bbMin);c.vec3d.set3(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE,this.bbMax);c.vec3d.set3(0,0,0,this.center);this.bsRadius=0};a.prototype.getCenter=function(){return this.center};
a.prototype.getBSRadius=function(){return this.bsRadius};return a}();return n})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define(["require","exports","./IdGen"],function(n,g,c){return function(){function a(c,b,l,e,h,m){this.id=a._idGen.gen(c.id);this.geometry=c;this.materials=b;this.transformation=l;this.instanceParameters=e;this.origin=h;this.customTransformation=m}a.prototype.getStaticTransformation=function(){return this.transformation};a.prototype.getShaderTransformation=function(){return this.customTransformation?
this.customTransformation(this.transformation):this.transformation};a._idGen=new c;return a}()})},"esri/views/3d/webgl-engine/lib/IdGen":function(){define(["require","exports"],function(n,g){return function(){function c(){this._count=0}c.prototype.gen=function(a){null==a&&(a="a");return a+"_"+this._count++};return c}()})},"esri/views/3d/webgl-engine/lib/HighlightUtils":function(){define(["require","exports","./IdGen"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});var a=new c;g.generateHighlightId=
function(){return a.gen("highlight")}})},"esri/views/3d/webgl-engine/lib/ModelContentType":function(){define(["require","exports"],function(n,g){return function(){function c(){}c.LAYER="layers";c.OBJECT="objects";c.GEOMETRY="geometries";c.MATERIAL="materials";c.TEXTURE="textures";return c}()})},"esri/views/3d/webgl-engine/lib/PerformanceTimer":function(){define(["require","exports","./Performance"],function(n,g,c){return function(){function a(a){this._filterSampleIndex=0;this._lastTime=NaN;this._numMeasurements=
this._totalTime=0;this._filterSamples=Array(a);this.reset();this._filterSize=a}a.prototype.reset=function(){for(var a=this._filterSampleIndex=0;a<this._filterSize;a++)this._filterSamples[a]=NaN};a.prototype.start=function(){this._tsStart=c.now()};a.prototype.stop=function(){this._lastTime=c.now()-this._tsStart;this._totalTime+=this._lastTime;this._numMeasurements++;this._filterSize&&(this._filterSamples[this._filterSampleIndex]=this._lastTime,this._filterSampleIndex=(this._filterSampleIndex+1)%this._filterSize);
return this._lastTime};a.prototype.getLast=function(){return this._lastTime};a.prototype.getLastFiltered=function(){for(var a=0,b=0;b<this._filterSamples.length;b++)a+=this._filterSamples[b];return a/this._filterSamples.length};a.prototype.getAverage=function(){return this._totalTime/this._numMeasurements};a.prototype.getTotal=function(){return this._totalTime};a.prototype.getNumMeasurements=function(){return this._numMeasurements};return a}()})},"esri/views/3d/webgl-engine/lib/Performance":function(){define(["require",
"exports","../../../../core/now"],function(n,g,c){return{now:c}})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("require exports ./common ../../lib/gl-matrix ../../state/utils/navigationUtils ../../state/utils/viewUtils ../../support/earthUtils ../../support/mathUtils".split(" "),function(n,g,c,a,f,b,l,e){function h(b,d,e,f,k){void 0===e&&(e=c.defaultApplyOptions);void 0===f&&(f=d);void 0===k&&(k=!0);d!==f&&f.copyFrom(d);A.eyeCenterDistance=0;A.requiresTwoSteps=!1;var l=m(b,d,e,void 0,
A);if(0===l)return!1;a.mat4d.identity(p);a.mat4d.rotate(p,-l,d.viewRight);switch(e.tiltMode){case 1:a.mat4d.multiplyVec3(p,d.viewForward,q);a.vec3d.scale(q,A.eyeCenterDistance);a.vec3d.add(d.eye,q,f.center);break;case 0:a.vec3d.subtract(d.center,d.eye,q),a.mat4d.multiplyVec3(p,q),a.vec3d.subtract(d.center,q,f.eye)}a.mat4d.multiplyVec3(p,f.up);f.markViewDirty();return A.requiresTwoSteps&&k?h(b,f,e,f,!1):!0}function m(h,q,p,g,A){void 0===p&&(p=c.defaultApplyOptions);void 0===g&&(g=c.defaultApplyOptions);
if(!h.state.constraints.tilt)return 0;var x=h.state.constraints.tilt(q.distance,t);var B=p;if(0!==B.interactionType){var z=B.interactionStartCamera,D=B.interactionFactor,C=x.min,n=x.max,H=m(h,z,c.defaultApplyOptions,B),M=0===H?0:b.viewAngle(h.renderCoordsHelper,z.center,z.eye);x.min=C;x.max=n;2===B.interactionType?(c.hasConstraintType(B.selection,2)&&d(h,z,x),c.adjustRangeForInteraction(H,M,!0,D,u,x)):c.adjustRangeForInteraction(H,M,!1,D,u,x)}2===g.interactionType&&c.hasConstraintType(g.selection,
2)&&d(h,g.interactionStartCamera,x);if(1===p.tiltMode||1===g.tiltMode){a:{A&&(A.requiresTwoSteps=!1);switch(h.viewingMode){case "global":p=v;B=h.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;g=B+l.earthRadius;B=h.renderCoordsHelper.intersectManifold(q.eye,q.viewForward,B,r);p.eyeCenterDistance=q.distance;B?(p.eyeCenterDistance=a.vec3d.dist(q.eye,r),p.tiltAtCenter=b.viewAngle(h.renderCoordsHelper,r,q.eye)):h.state.isLocal?p.tiltAtCenter=b.viewAngle(h.renderCoordsHelper,q.center,
q.eye):(f.closestPointOnCenteredSphereSilhouette(g,q.eye,q.viewForward,r),p.eyeCenterDistance=a.vec3d.dist(q.eye,r),p.tiltAtCenter=e.acos(-a.vec3d.dot(q.viewForward,a.vec3d.normalize(r))));p.radius=g;p.eyeRadius=a.vec3d.length(q.eye);p.constraints=h.state.constraints;p.centerIsOnSurface=B;q=e.clamp(p.tiltAtCenter,x.min,x.max);if(1E-9<Math.abs(p.tiltAtCenter-q)){if(p.centerIsOnSurface){q=p.constraints;h=g=p.tiltAtCenter;x=q.clampTilt(p.eyeCenterDistance,g);B=k(p,x);if(q.clampTilt(B,g)!==x)for(g=0;10>
g&&1E-9<Math.abs(x-h);)B=(h+x)/2,z=k(p,B),z=q.clampTilt(z,B),1E-9<Math.abs(z-B)?h=B:x=B,g++;q=x;x=q;h=e.asin(p.radius/p.eyeRadius*Math.sin(p.tiltAtCenter));x=e.asin(p.radius/p.eyeRadius*Math.sin(x));h=p.eyeRadius>p.radius?h-x:x-h}else q=p.constraints.clampTilt(p.eyeCenterDistance,p.tiltAtCenter),A&&q<Math.PI/2&&(A.requiresTwoSteps=!0,q=Math.PI/2-1E-5),h=p.tiltAtCenter-Math.PI/2-(q-Math.PI/2);A&&(A.eyeCenterDistance=k(p,q));A=h}else A=0;break a;case "local":g=b.viewAngle(h.renderCoordsHelper,q.center,
q.eye);p=e.clamp(g,x.min,x.max);x=g-p;1E-9<Math.abs(x)?(A&&(g=h.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,h=h.renderCoordsHelper.getAltitude(q.eye)-g,p=Math.cos(p),A.eyeCenterDistance=1E-4<Math.abs(p)?h/p:q.distance),A=x):A=0;break a}A=void 0}return A}A=b.viewAngle(h.renderCoordsHelper,q.center,q.eye);q=e.clamp(A,x.min,x.max);A-=q;A=1E-9<Math.abs(A)?A:0;return A}function k(a,b){if(!a.centerIsOnSurface)return a.eyeCenterDistance;b=Math.PI-e.clamp(b,0,Math.PI);var d=e.asin(a.radius/
a.eyeRadius*Math.sin(b)),c=Math.sin(Math.PI-b-d)/Math.sin(b);return a.eyeRadius<a.radius&&1<c?Math.sin(Math.PI-b-(Math.PI-d))/Math.sin(b)*a.eyeRadius:c*a.eyeRadius}function d(b,d,c){if(!b.state.isLocal){var h=b.state.constraints;if(h.altitude){b=a.vec3d.length2(d.center);var f=Math.sqrt(b);d=d.distance;var k=h.altitude.min+l.earthRadius,h=h.altitude.max+l.earthRadius,k=(k*k-d*d-b)/(-2*f*d);c.min=Math.max(c.min,Math.min(Math.PI-e.acos((h*h-d*d-b)/(-2*f*d)),c.max));c.max=Math.min(c.max,Math.PI-e.acos(k))}}}
Object.defineProperty(g,"__esModule",{value:!0});g.apply=h;g.error=m;var q=a.vec3d.create(),p=a.mat4d.create(),r=a.vec3d.create(),u=e.deg2rad(5),t={min:0,max:0},v={constraints:null,radius:0,eyeRadius:0,centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},A={eyeCenterDistance:0,requiresTwoSteps:!1}})},"esri/views/3d/state/utils/navigationUtils":function(){define("require exports ../../lib/gl-matrix ./primitiveIntersectionUtils ../../support/earthUtils ../../support/mathUtils".split(" "),function(n,
g,c,a,f,b){function l(b,h,f,k,l){void 0===l&&(l=!1);var q=I;a.createRay(h,f,q,l);return a.intersectSphere(b,q,k)?c.vec3d.dist2(b.center,q.origin)<b.radius*b.radius&&(h=e(b,q.origin),q=-m(q.origin,k,C)-h,0<q)?(h=B,c.mat4d.identity(h),c.mat4d.rotate(h,-q,C),c.vec3d.subtract(k,b.center),c.mat4d.multiplyVec3(h,k,k),c.vec3d.add(k,b.center),!1):!0:(d(b,q,k),!1)}function e(a,b){var d=C;c.vec3d.subtract(b,a.center,d);b=Math.abs(c.vec3d.length(d)-a.radius);return Math.acos(a.radius/(b+a.radius))}function h(b,
d,e,c){var h=I;a.createRay(d,e,h,!0);return a.intersectSphere(b,h,c)}function m(a,d,e){c.vec3d.cross(a,d,e);a=c.vec3d.dot(a,d)/(c.vec3d.length(a)*c.vec3d.length(d));return-b.acos(a)}function k(a,b,d,e){var h=B;c.mat4d.identity(h);c.mat4d.rotate(h,e,d);c.vec3d.subtract(a.eye,b);c.mat4d.multiplyVec3(h,a.eye,a.eye);c.vec3d.add(a.eye,b);c.vec3d.subtract(a.center,b);c.mat4d.multiplyVec3(h,a.center,a.center);c.vec3d.add(a.center,b);c.mat4d.multiplyVec3(h,a.up,a.up);a.markViewDirty()}function d(a,d,e){var h=
C,f=G,k=x;c.vec3d.subtract(d.origin,a.center,f);c.vec3d.cross(f,d.direction,h);c.vec3d.cross(h,f,e);c.vec3d.scale(e,1/c.vec3d.length(e)*a.radius);a=-b.asin(a.radius/c.vec3d.length(d.origin));c.mat4d.identity(k);c.mat4d.rotate(k,a,h);c.mat4d.multiplyVec3(k,e)}function q(a,b,e,h){K.radius=a;c.vec3d.set3(0,0,0,K.center);c.vec3d.set(b,I.origin);c.vec3d.set(e,I.direction);return d(K,I,h)}function p(a,b){c.vec3d.set3(0,0,0,b);for(var d=0;d<a.length;d++)c.vec3d.add(b,a[d]);c.vec3d.scale(b,1/a.length)}function r(a,
b,d){return Math.sin(a/c.vec3d.length(b))*(d+f.earthRadius)}Object.defineProperty(g,"__esModule",{value:!0});g.Earth={center:c.vec3d.create(),radius:f.earthRadius};g.normalizeCoordinate=function(a,b,d){d[0]=b[0]/a.fullWidth;d[1]=b[1]/a.fullHeight;return d};g.sphereOrSilhouettePointFromScreenPoint=l;g.computeHorizonSphereCapAngle=e;g.intersectSphereFromScreenPoint=h;g.rotationAndAxisFromPoints=m;g.rotationFromPointsAroundAxis=function(a,b,d){var e=C,h=G,f=E;c.vec3d.set(a,h);c.vec3d.set(b,f);a=c.vec3d.dot(h,
d);b=c.vec3d.dot(f,d);c.vec3d.scale(d,a,e);c.vec3d.subtract(h,e);c.vec3d.normalize(h);c.vec3d.scale(d,b,e);c.vec3d.subtract(f,e);c.vec3d.normalize(f);a=c.vec3d.dot(h,f);c.vec3d.cross(d,h,e);d=c.vec3d.dot(f,e);return Math.atan2(d,a)};g.setPlane=function(a,b,d){c.vec3d.set(b,d.normal);d.d=-c.vec3d.dot(b,a)};g.setPlaneD=function(a,b){b.d=-c.vec3d.dot(b.normal,a)};g.normalizeRotationDelta=function(a){for(;a>Math.PI;)a-=2*Math.PI;for(;a<-Math.PI;)a+=2*Math.PI;return a};g.applyRotation=k;g.closestPointOnSphereSilhouette=
d;g.closestPointOnCenteredSphereSilhouette=q;g.intersectPlaneFromScreenPoint=function(b,d,e,c){var h=I;a.createRay(d,e,h);return a.intersectPlane(b,h,c)};g.centerOnManifoldSilhouetteFallback=function(a,b,d,e,h){a.intersectManifold(b,d,e,h)||"global"!==a.type||(q(e+f.earthRadius,b,d,F),c.vec3d.add(b,c.vec3d.scale(d,c.vec3d.dist(b,F),F),h))};g.applyZoomToPoint=function(a,b,d,e){var h=D;d=1-d;c.vec3d.subtract(b,a.eye,h);var f=c.vec3d.length(h),k=f*(1-d);0<=d&&k<e&&(k=e,d=-(k-f)/f);1E-6>Math.abs(f-k)||
(c.vec3d.scale(h,d),c.vec3d.add(a.eye,h),c.vec3d.lerp(a.center,b,d))};g.applyZoomOnSphere=function(a,b,d){c.vec2d.set2(b.padding[3]+b.width/2,b.padding[2]+b.height/2,u);h(a,b,u,b.center);c.vec3d.subtract(b.center,b.eye,D);a=c.vec3d.length(D);1E-6>Math.abs(a-a*d)||(c.vec3d.scale(D,d),c.vec3d.subtract(b.center,D,b.eye),b.markViewDirty())};var u=c.vec2d.create();g.navPointToScreenPoint=function(a,b,d){c.vec2d.set2(b.x,a.fullHeight-b.y,d)};g.centroidOnSphere=function(a,b,d){p(b,d);c.vec3d.normalize(d);
c.vec3d.scale(d,a)};g.centroid=p;g.onSurfaceTiltToEyeTiltGlobal=r;g.offSurfaceTiltToEyeTiltGlobal=function(a,b,d){return r(Math.PI/2,b,d)+(a-Math.PI/2)};var t;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(t=g.PanMode||(g.PanMode={}));g.VerticalPanTresholds={Elevation:3E4,Angle:8/180*Math.PI};g.pickPointAndInitSphere=function(a,b,d,e){var f=c.vec3d.create(),k={center:c.vec3d.create(),radius:0},m=!0;a.pickPointInScreen(d,f)?k.radius=c.vec3d.length(f):(k.radius=b.aboveGround?
Math.max(c.vec3d.length(b.center),.9*g.Earth.radius):c.vec3d.length(b.eye)-b.relativeElevation,e?l(k,b,d,f):m=h(k,b,d,f));return{sphere:k,scenePickPoint:m?f:null}};g.decidePanMode=function(a,b,d){var e=c.vec3d.length(a.eye);if(Math.abs(e-g.Earth.radius)>g.VerticalPanTresholds.Elevation)return t.Horizontal;if(a.aboveGround===b.radius>e)return t.Vertical;c.vec3d.normalize(c.vec3d.subtract(a.eye,d,v));return Math.abs(.5*Math.PI-Math.acos(c.vec3d.dot(d,v)/c.vec3d.length(d)))<g.VerticalPanTresholds.Angle?
t.Vertical:t.Horizontal};var v=c.vec3d.create();g.applyPanPlanar=function(a,b,d){c.vec3d.subtract(d,b,A);c.vec3d.subtract(a.eye,A);c.vec3d.subtract(a.center,A);a.markViewDirty()};var A=c.vec3d.create();g.applyPanSpherical=function(a,b,d,e){d=m(d,e,z);k(b,a.center,z,d)};var z=c.vec3d.create(),x=c.mat4d.create(),B=c.mat4d.create(),D=c.vec3d.create(),C=c.vec3d.create(),G=c.vec3d.create(),E=c.vec3d.create(),F=c.vec3d.create(),I={origin:c.vec3d.create(),direction:c.vec3d.create()},K={center:c.vec3d.create(),
radius:0}})},"esri/views/3d/state/utils/primitiveIntersectionUtils":function(){define(["require","exports","../../lib/gl-matrix"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.createRay=function(b,f,e,h){void 0===h&&(h=!1);c.vec3d.set3(f[0],f[1],0,a);h?c.vec3d.set(b.eye,e.origin):c.vec3d.unproject(a,b.viewMatrix,b.projectionMatrix,b.fullViewport,e.origin);a[2]=1;c.vec3d.unproject(a,b.viewMatrix,b.projectionMatrix,b.fullViewport,e.direction);c.vec3d.subtract(e.direction,e.origin,
e.direction);c.vec3d.normalize(e.direction)};g.intersectSphere=function(a,l,e){var b=c.vec3d.subtract(l.origin,a.center,f),m=c.vec3d.dot(l.direction,l.direction),k=2*c.vec3d.dot(l.direction,b);a=c.vec3d.dot(b,b)-a.radius*a.radius;a=k*k-4*m*a;if(0>a)return!1;b=Math.sqrt(a);a=(-k-b)/(2*m);m=(-k+b)/(2*m);if(0>a||m<a&&0<m)a=m;return 0<a?(c.vec3d.add(l.origin,c.vec3d.scale(l.direction,a,e),e),!0):!1};g.intersectPlane=function(a,f,e){var b=c.vec3d.dot(a.normal,f.direction);if(0===b)return!1;a=-(c.vec3d.dot(a.normal,
f.origin)+a.d)/b;if(0>a)return!1;c.vec3d.add(f.origin,c.vec3d.scale(f.direction,a,e),e);return!0};var a=c.vec3d.create(),f=c.vec3d.create()})},"esri/views/3d/state/utils/viewUtils":function(){define(["require","exports","../../lib/gl-matrix","../../support/mathUtils"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.viewAngle=function(l,e,h){l.worldUpAtPosition(e,f);c.vec3d.subtract(h,e,b);l=c.vec3d.length(b);return 0===l?0:a.acos(c.vec3d.dot(b,f)/l)};var f=c.vec3d.create(),b=
c.vec3d.create()})},"esri/views/animation/easing":function(){define(["require","exports"],function(n,g){function c(a){return a}function a(a){var b=2*(a-Math.sqrt((a-1)*a)),e=b/2/a;return function(c){return c<e?a*c*c:b*c-b+1}}function f(a,c){return function(b){return b<c?c*a(b/c):1-a((1-b)/(1-c))*(1-c)}}Object.defineProperty(g,"__esModule",{value:!0});g.linear=c;g.inQuad=function(a){return a*a};g.outQuad=function(a){return 1-g.inQuad(1-a)};g.inOutQuad=function(a){return.5>a?g.inQuad(2*a)/2:(g.outQuad(2*
(a-.5))+1)/2};g.inCubic=function(a){return a*a*a};g.outCubic=function(a){return 1-g.inCubic(1-a)};g.inOutCubic=function(a){return.5>a?g.inCubic(2*a)/2:(g.outCubic(2*(a-.5))+1)/2};g.inQuart=function(a){return a*a*a*a};g.outQuart=function(a){return 1-g.inQuart(1-a)};g.inOutQuart=function(a){return.5>a?g.inQuart(2*a)/2:(g.outQuart(2*(a-.5))+1)/2};g.inQuint=function(a){return a*a*a*a*a};g.outQuint=function(a){return 1-g.inQuint(1-a)};g.inOutQuint=function(a){return.5>a?g.inQuint(2*a)/2:(g.outQuint(2*
(a-.5))+1)/2};g.inSine=function(a){return-Math.cos(a*Math.PI/2)+1};g.outSine=function(a){return 1-g.inSine(1-a)};g.inOutSine=function(a){return.5>a?g.inSine(2*a)/2:(g.outSine(2*(a-.5))+1)/2};g.inExpo=function(a){return Math.pow(2,10*(a-1))};g.outExpo=function(a){return 1-g.inExpo(1-a)};g.inOutExpo=function(a){return.5>a?g.inExpo(2*a)/2:(g.outExpo(2*(a-.5))+1)/2};g.inCirc=function(a){return-(Math.sqrt(1-a*a)-1)};g.outCirc=function(a){return 1-g.inCirc(1-a)};g.inOutCirc=function(a){return.5>a?g.inCirc(2*
a)/2:(g.outCirc(2*(a-.5))+1)/2};g.inCoastQuad=f(a(1),1);g.outCoastQuad=f(a(1),0);g.inOutCoastQuad=f(a(1),.5);g.inCoastCubic=f(a(2),1);g.outCoastCubic=f(a(2),0);g.inOutCoastCubic=f(a(2),.5);g.inCoastQuart=f(a(3),1);g.outCoastQuart=f(a(3),0);g.inOutCoastQuart=f(a(3),.5);g.inCoastQuint=f(a(4),1);g.outCoastQuint=f(a(4),0);g.inOutCoastQuint=f(a(4),.5);g.named={linear:c,"in-quad":g.inQuad,"out-quad":g.outQuad,"in-out-quad":g.inOutQuad,"in-coast-quad":g.inCoastQuad,"out-coast-quad":g.outCoastQuad,"in-out-coast-quad":g.inOutCoastQuad,
"in-cubic":g.inCubic,"out-cubic":g.outCubic,"in-out-cubic":g.inOutCubic,"in-coast-cubic":g.inCoastCubic,"out-coast-cubic":g.outCoastCubic,"in-out-coast-cubic":g.inOutCoastCubic,"in-quart":g.inQuart,"out-quart":g.outQuart,"in-out-quart":g.inOutQuart,"in-coast-quart":g.inCoastQuart,"out-coast-quart":g.outCoastQuart,"in-out-coast-quart":g.inOutCoastQuart,"in-quint":g.inQuint,"out-quint":g.outQuint,"in-out-quint":g.inOutQuint,"in-coast-quint":g.inCoastQuint,"out-coast-quint":g.outCoastQuint,"in-out-coast-quint":g.inOutCoastQuint,
"in-sine":g.inSine,"out-sine":g.outSine,"in-out-sine":g.inOutSine,"in-expo":g.inExpo,"out-expo":g.outExpo,"in-out-expo":g.inOutExpo,"in-circ":g.inCirc,"out-circ":g.outCirc,"in-out-circ":g.inOutCirc}})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../animation/pointToPoint/Animation ../../lib/gl-matrix ./AnimationController ../../webgl-engine/lib/Camera".split(" "),function(n,g,c,a,f,b,l){Object.defineProperty(g,
"__esModule",{value:!0});n=function(b){function f(d,e,c){c=b.call(this,c)||this;c.viewState=d;c.intersectionHelper=e;c.hasTarget=!1;c.animation=new a.default(c.viewState.mode);return c}c(f,b);f.prototype.begin=function(a,b){this.hasTarget=!0;b=this.animationSettings(b);e.copyFrom(this.viewState.camera);this.intersectionHelper.pickPointFromSegment(e.eye,e.center,h)&&(e.center=h);this.animation.update(e,a,b);this.animation.finished&&this.finish()};f.prototype.finish=function(){this.animation.currentTime=
this.animation.time;b.prototype.finish.call(this)};Object.defineProperty(f.prototype,"steppingFinished",{get:function(){return this.hasTarget&&this.animation.finished},enumerable:!0,configurable:!0});f.prototype.stepController=function(a,e){b.prototype.stepController.call(this,a,e);this.hasTarget&&this.animation.step(a,e)};f.prototype.onControllerEnd=function(a){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,a),this.animation.currentTime=this.animation.time);
b.prototype.onControllerEnd.call(this,a)};f.prototype.animationSettings=function(a){void 0===a&&(a={});return{apex:{maximumDistance:this.viewState.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},speedFactor:a.speedFactor,duration:a.duration,maxDuration:a.maxDuration,easing:a.easing}};return f}(b.AnimationController);g.PointToPointAnimationController=n;var e=new l,h=f.vec3d.create()})},"esri/views/3d/animation/pointToPoint/Animation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Camera ../../lib/gl-matrix ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),
function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});var e=f.vec3d.create();n=function(){function c(b){this.currentTime=0;this.animation=new l.Animation(function(){return new a.default(b)});this._current=new a.default(b)}Object.defineProperty(c.prototype,"finished",{get:function(){return this.currentTime>=this.animation.time},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"time",{get:function(){return this.animation.time},enumerable:!0,configurable:!0});c.prototype.update=
function(a,b,d){var c=this.animation.definition.source,h=this.animation.definition.target,k=f.vec3d.subtract(b.center,a.center,e),m=f.vec3d.length(k);1E-5<=m?(k[0]/=m,k[1]/=m,k[2]/=m):(k[0]=0,k[1]=1,k[0]=0);f.vec3d.set(k,c.lookAtDirection);f.vec3d.set(k,h.lookAtDirection);c.copyFromRenderCamera(a);h.copyFromRenderCamera(b);this._current.copyFrom(c);this.animation.update(c,h,d);this.currentTime=0;a.almostEquals(b,5E-4,!0)&&(this.currentTime=this.animation.time)};c.prototype.cameraAt=function(a,e){this.animation.cameraAt(a,
this._current);e=e||new b;this._current.copyToRenderCamera(e);return e};c.prototype.step=function(a,b){this.finished||(this.currentTime+=a,this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,b)};return c}();g.Animation=n;g.default=n})},"esri/views/3d/animation/pointToPoint/Camera":function(){define(["require","exports","../../lib/gl-matrix","../../support/mathUtils"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});var f=a.angle,
b=a.lerp,l=a.slerp,e=c.vec3d.create(),h=c.vec3d.create(),m=c.vec3d.create(),k=c.vec3d.create(),d=c.vec3d.create(),q=c.vec3d.create(),p=c.vec3d.createFrom(0,0,1),r=c.vec3d.createFrom(0,1,0),u=c.vec3d.createFrom(1,0,0),t=c.mat3d.create();n=function(){function a(a){void 0===a&&(a="global");this.viewingMode=a;this.center=c.vec3d.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=c.vec3d.create(r)}a.prototype.pixelsPerPanAtZoom=function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.zoomAtPixelsPerPan=
function(a){return this.size/2/(this._zoomToPanScale*a)};a.prototype.pixelsPerRotateAtZoom=function(a){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};a.prototype.compareTo=function(a,b){b||(b={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if("global"===this.viewingMode){var d=c.vec3d.length(this.center),e=c.vec3d.length(a.center),d=(d+e)/2;b.pan=f(this.center,a.center)*d}else b.pan=c.vec3d.dist(this.center,a.center);d=Math.abs(a.yaw-this.yaw);d>=Math.PI&&(d=2*Math.PI-d);b.rotate=Math.max(d,
Math.abs(a.pitch-this.pitch));b.sourceZoom=this.distance;b.targetZoom=a.distance;return b};a.prototype.interpolate=function(a,d,e){"global"===this.viewingMode?l(a.center,d.center,e.pan,this.center):c.vec3d.lerp(a.center,d.center,e.pan,this.center);this.distance=b(a.distance,d.distance,e.zoom);this.pitch=b(a.pitch,d.pitch,e.rotate);a=a.yaw;d=d.yaw;Math.abs(d-a)>=Math.PI&&(a+=2*(a<d?1:-1)*Math.PI);this.yaw=b(a,d,e.rotate)};a.prototype.copyFrom=function(a){c.vec3d.set(a.center,this.center);this.pitch=
a.pitch;this.yaw=a.yaw;this.distance=a.distance;c.vec3d.set(a.lookAtDirection,this.lookAtDirection);this.size=a.size;this.copyFromCommon(a);this.viewingMode=a.viewingMode};a.prototype.copyFromRenderCamera=function(a){var b=this._lookAtOrientation(a.center,t);c.vec3d.set(a.center,this.center);c.mat3d.multiplyVec3(b,c.vec3d.subtract(a.center,a.eye,k));c.mat3d.multiplyVec3(b,a.up,d);this.distance=c.vec3d.length(k);k[0]/=this.distance;k[1]/=this.distance;k[2]/=this.distance;this.pitch=this._eyeUpToPitch(k,
d);this.yaw=this._eyeUpToYaw(k,d);this.size=Math.sqrt(a.width*a.width+a.height*a.height);this.copyFromCommon(a)};a.prototype.copyFromCommon=function(a){this.fov=a.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};a.prototype.copyToRenderCamera=function(a){var b=this._lookAtOrientation(this.center,t);c.mat3d.transpose(b);this._axisAngleVec3(u,this.pitch-Math.PI/2,r,k);this._axisAngleVec3(p,this.yaw,k);this._axisAngleVec3(u,this.pitch-Math.PI/2,p,d);this._axisAngleVec3(p,this.yaw,d);c.vec3d.scale(k,
this.distance);c.mat3d.multiplyVec3(b,k);c.mat3d.multiplyVec3(b,d);a.center=this.center;a.eye=c.vec3d.subtract(this.center,k,k);a.up=d};a.prototype._axisAngleVec3=function(a,b,d,f){void 0===f&&(f=d);var k=Math.cos(b);b=Math.sin(b);c.vec3d.scale(d,k,e);c.vec3d.scale(c.vec3d.cross(a,d,h),b);c.vec3d.scale(a,(1-k)*c.vec3d.dot(a,d),m);return c.vec3d.add(c.vec3d.add(e,h,f),m,f)};a.prototype._lookAtOrientation=function(a,b){this._upAtLookAt(a,m);c.vec3d.normalize(c.vec3d.cross(this.lookAtDirection,m,e));
0===e[0]&&0===e[1]&&0===e[2]&&c.vec3d.set(u,e);c.vec3d.normalize(c.vec3d.cross(m,e,h));b||(b=c.mat3d.create());b[0]=e[0];b[1]=h[0];b[2]=m[0];b[3]=e[1];b[4]=h[1];b[5]=m[1];b[6]=e[2];b[7]=h[2];b[8]=m[2];return b};a.prototype._upAtLookAt=function(a,b){return"local"===this.viewingMode?c.vec3d.set(p,b):c.vec3d.normalize(a,b)};a.prototype._eyeUpToPitch=function(a,b){return Math.PI-f(p,a)};a.prototype._eyeUpToYaw=function(a,b){.5>Math.abs(b[2])?(c.vec3d.set(b,q),0<a[2]&&c.vec3d.scale(q,-1)):c.vec3d.set(a,
q);return f(u,c.vec3d.normalize(c.vec3d.cross(q,p,h)),p)};return a}();g.default=n})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("require exports ../../lib/gl-matrix ../../support/geometryUtils ../../support/mathUtils ./Util".split(" "),function(n,g,c,a,f,b){function l(a,b){var d=b[0]-a[0],e=b[1]-a[1],c=b[2]-a[2];a=b[3]-a[3];return d*d+e*e+c*c+a*a}function e(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function h(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}n=
function(){function p(b,d,e){this._viewUp=c.vec3d.create();this._viewForward=c.vec3d.create();this._viewRight=c.vec3d.create();this._viewport=c.vec4d.create();this._padding=c.vec4d.create();this._fov=55/180*Math.PI;this._near=0;this._far=1E3;this._viewDirty=!0;this._viewMatrix=c.mat4d.create();this._projectionDirty=!0;this._projectionMatrix=c.mat4d.create();this._viewProjectionDirty=!0;this._viewProjectionMatrix=c.mat4d.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=
c.mat4d.create();this._frustumPlanesDirty=!0;this._frustumPlanes=[a.plane.create(),a.plane.create(),a.plane.create(),a.plane.create(),a.plane.create(),a.plane.create()];this._fullViewport=null;this.relativeElevation=0;this._eye=c.vec3d.create(b);this._center=c.vec3d.create(d);this._up=void 0!==e?c.vec3d.create(e):c.vec3d.create([0,0,1]);this._padding=c.vec4d.create()}Object.defineProperty(p.prototype,"eye",{get:function(){return this._eye},set:function(a){this._compareAndSetView(a,this._eye)},enumerable:!0,
configurable:!0});Object.defineProperty(p.prototype,"center",{get:function(){return this._center},set:function(a){this._compareAndSetView(a,this._center)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"up",{get:function(){return this._up},set:function(a){this._compareAndSetView(a,this._up)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewMatrix",{get:function(){this._ensureViewClean();return this._viewMatrix},set:function(a){c.mat4d.set(a,this._viewMatrix);
this._viewDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=this._viewInverseTransposeMatrixDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewForward",{get:function(){this._ensureViewClean();return this._viewForward},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewUp",{get:function(){this._ensureViewClean();return this._viewUp},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewRight",{get:function(){this._ensureViewClean();
return this._viewRight},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"near",{get:function(){return this._near},set:function(a){this._near!==a&&(this._near=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"far",{get:function(){return this._far},set:function(a){this._far!==a&&(this._far=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});
Object.defineProperty(p.prototype,"viewport",{get:function(){return this._viewport},set:function(a){this.x=a[0];this.y=a[1];this.width=a[2];this.height=a[3]},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"x",{get:function(){return this._viewport[0]},set:function(a){a+=this._padding[3];this._viewport[0]!==a&&(this._viewport[0]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"y",{get:function(){return this._viewport[1]},
set:function(a){a+=this._padding[2];this._viewport[1]!==a&&(this._viewport[1]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"width",{get:function(){return this._viewport[2]},set:function(a){this._viewport[2]!==a&&(this._viewport[2]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"height",{get:function(){return this._viewport[3]},
set:function(a){this._viewport[3]!==a&&(this._viewport[3]=a,this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullWidth",{get:function(){return this._viewport[2]+this._padding[1]+this._padding[3]},set:function(a){this.width=a-(this._padding[1]+this._padding[3])},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullHeight",{get:function(){return this._viewport[3]+this._padding[0]+this._padding[2]},
set:function(a){this.height=a-(this._padding[0]+this._padding[2])},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fullViewport",{get:function(){this._fullViewport||(this._fullViewport=c.vec4d.create());this._fullViewport[0]=this._viewport[0]-this._padding[3];this._fullViewport[1]=this._viewport[1]-this._padding[2];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,
"aspect",{get:function(){return this.width/this.height},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"padding",{get:function(){return this._padding},set:function(a){if(this._padding[0]!==a[0]||this._padding[1]!==a[1]||this._padding[2]!==a[2]||this._padding[3]!==a[3])this._viewport[0]+=a[3]-this._padding[3],this._viewport[1]+=a[2]-this._padding[2],this._viewport[2]-=a[1]+a[3]-(this._padding[1]+this._padding[3]),this._viewport[3]-=a[0]+a[2]-(this._padding[0]+this._padding[2]),c.vec4d.set(a,
this._padding),this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewProjectionMatrix",{get:function(){this._viewProjectionDirty&&(c.mat4d.multiply(this.projectionMatrix,this.viewMatrix,this._viewProjectionMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"projectionMatrix",{get:function(){if(this._projectionDirty){var a=
this.width,b=this.height,d=this.near*Math.tan(this.fovY/2),e=d*this.aspect;c.mat4d.frustum(-e*(1+2*this._padding[3]/a),e*(1+2*this._padding[1]/a),-d*(1+2*this._padding[2]/b),d*(1+2*this._padding[0]/b),this.near,this.far,this._projectionMatrix);this._projectionDirty=!1}return this._projectionMatrix},set:function(a){c.mat4d.set(a,this._projectionMatrix);this._projectionDirty=!1;this._frustumPlanesDirty=this._viewProjectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fov",
{get:function(){return this._fov},set:function(a){this._fov=a;this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fovX",{get:function(){return b.fovd2fovx(this._fov,this.width,this.height)},set:function(a){this._fov=b.fovx2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"fovY",{get:function(){return b.fovd2fovy(this._fov,
this.width,this.height)},set:function(a){this._fov=b.fovy2fovd(a,this.width,this.height);this._frustumPlanesDirty=this._viewProjectionDirty=this._projectionDirty=!0},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"distance",{get:function(){return c.vec3d.dist(this._center,this._eye)},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"frustumPoints",{get:function(){return this.computeFrustumPoints()},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,
"frustumPlanes",{get:function(){this._frustumPlanesDirty&&(this._frustumPlanes=this._computeFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);return this._frustumPlanes},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"viewInverseTransposeMatrix",{get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)this._viewInverseTransposeMatrix||(this._viewInverseTransposeMatrix=c.mat4d.create()),c.mat4d.inverse(this.viewMatrix,this._viewInverseTransposeMatrix),
c.mat4d.transpose(this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1;return this._viewInverseTransposeMatrix},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"perPixelRatio",{get:function(){return Math.tan(this.fovX/2)/this.width},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"aboveGround",{get:function(){return 0<=this.relativeElevation},enumerable:!0,configurable:!0});p.prototype.copyFrom=function(a){c.vec3d.set(a._eye,this._eye);c.vec3d.set(a._center,
this._center);c.vec3d.set(a._up,this._up);c.vec4d.set(a._viewport,this._viewport);c.vec4d.set(a._padding,this._padding);this._near=a._near;this._far=a._far;this._fov=a._fov;this.relativeElevation=a.relativeElevation;a._viewDirty?this._viewDirty=!0:(c.mat4d.set(a._viewMatrix,this._viewMatrix),c.vec3d.set(a._viewRight,this._viewRight),c.vec3d.set(a._viewUp,this._viewUp),c.vec3d.set(a._viewForward,this._viewForward),this._viewDirty=!1);a._projectionDirty?this._projectionDirty=!0:(c.mat4d.set(a._projectionMatrix,
this._projectionMatrix),this._projectionDirty=!1);this._viewProjectionDirty=!0;a._frustumPlanesDirty?this._frustumPlanesDirty=!0:(a.copyFrustumPlanes(this._frustumPlanes),this._frustumPlanesDirty=!1);a._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(this._viewInverseTransposeMatrix?c.mat4d.set(a._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix):this._viewInverseTransposeMatrix=c.mat4d.create(a._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=
!1);a._fullViewport?this._fullViewport?c.vec4d.set(a._fullViewport,this._fullViewport):this._fullViewport=c.vec4d.create(a._fullViewport):this._fullViewport=null;return this};p.prototype.copyViewFrom=function(a){this.eye=a.eye;this.center=a.center;this.up=a.up};p.prototype.copy=function(){var a=new p;a.copyFrom(this);return a};p.prototype.equivalent=function(a){return e(this._eye,a._eye)&&e(this._center,a._center)&&e(this._up,a._up)&&h(this._viewport,a._viewport)&&h(this._padding,a._padding)&&this._near===
a._near&&this._far===a._far&&this._fov===a._fov};p.prototype.almostEquals=function(a,b,e){void 0===e&&(e=!1);b=c.vec3d.dist(this._eye,this._center)*(b||5E-4);b*=b;e?(c.vec3d.direction(a._center,a._eye,d),c.vec3d.direction(this._center,this._eye,q),e=1E-10):(c.vec3d.set(a._center,d),c.vec3d.set(this._center,q),e=b);return c.vec3d.dist2(a._eye,this._eye)<b&&c.vec3d.dist2(d,q)<e&&.001>Math.abs(a._fov-this._fov)&&.5>l(a._padding,this._padding)&&.5>l(a._viewport,this._viewport)};p.prototype.markViewDirty=
function(){this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0};p.prototype.computePixelSizeAt=function(a){return this.computePixelSizeAtDist(c.vec3d.dist(a,this._eye))};p.prototype.computePixelSizeAtDist=function(a){return 2*a*Math.tan(this.fovX/2)/this.width};p.prototype.computeDistanceFromRadius=function(a,b){return a/Math.tan(Math.min(this.fovX,this.fovY)/(2*(b||1)))};p.prototype.copyFrustumPlanes=function(a){if(!a){a=Array(6);for(var b=0;6>b;++b)a[b]=c.vec4d.create()}for(var d=
this.frustumPlanes,b=0;6>b;b++)c.vec4d.set(d[b],a[b]);return a};p.prototype.computeFrustumPoints=function(a){if(!a){a=Array(8);for(var d=0;8>d;++d)a[d]=c.vec3d.create()}b.matrixToFrustumPoints(this.viewMatrix,this.projectionMatrix,a);return a};p.prototype.setGLViewport=function(a){var b=this.viewport,d=this.padding;a.setViewport(b[0]-d[3],b[1]-d[2],b[2]+d[1]+d[3],b[3]+d[0]+d[2])};p.prototype.applyProjection=function(a,b,d){void 0===d&&(d=!1);a!==m&&c.vec3d.set(a,m);m[3]=1;d&&(b[2]=-m[2]);c.mat4d.multiplyVec4(this.projectionMatrix,
m);c.vec3d.scale(m,1/Math.abs(m[3]));a=this.fullViewport;b[0]=f.lerp(0,a[0]+a[2],.5+.5*m[0]);b[1]=f.lerp(0,a[1]+a[3],.5+.5*m[1]);d||(b[2]=.5*(m[2]+1));return b};p.prototype.projectPoint=function(a,b){m[0]=a[0];m[1]=a[1];m[2]=a[2];m[3]=1;c.mat4d.multiplyVec4(this.viewProjectionMatrix,m);c.vec3d.scale(m,1/Math.abs(m[3]));a=this.fullViewport;b[0]=f.lerp(0,a[0]+a[2],.5+.5*m[0]);b[1]=f.lerp(0,a[1]+a[3],.5+.5*m[1]);b[2]=.5*(m[2]+1);return b};p.prototype.unprojectPoint=function(a,b,d){void 0===d&&(d=!1);
if(d)return console.error("Camera.unprojectPoint() not yet implemented for linear Z"),null;c.mat4d.multiply(this.projectionMatrix,this.viewMatrix,k);if(!c.mat4d.inverse(k))return null;d=this.fullViewport;m[0]=2*(a[0]-d[0])/d[2]-1;m[1]=2*(a[1]-d[1])/d[3]-1;m[2]=2*a[2]-1;m[3]=1;c.mat4d.multiplyVec4(k,m);if(0===m[3])return null;b[0]=m[0]/m[3];b[1]=m[1]/m[3];b[2]=m[2]/m[3];return b};p.prototype.computeUp=function(a){"global"===a?this.computeUpGlobal():this.computeUpLocal()};p.prototype.computeUpGlobal=
function(){c.vec3d.subtract(this.center,this.eye,d);var a=c.vec3d.length(this.center);1>a?(c.vec3d.set3(0,0,1,this.up),this.markViewDirty()):Math.abs(c.vec3d.dot(d,this.center))>.9999*c.vec3d.length(d)*a||(c.vec3d.cross(d,this.center,this.up),c.vec3d.cross(this.up,d,this.up),c.vec3d.normalize(this.up),this.markViewDirty())};p.prototype.computeUpLocal=function(){c.vec3d.direction(this.center,this.eye,d);.9999>=Math.abs(d[2])&&(c.vec3d.scale(d,d[2]),c.vec3d.set3(-d[0],-d[1],1-d[2],this.up),c.vec3d.normalize(this.up),
this.markViewDirty())};p.prototype._compareAndSetView=function(a,b){e(a,b)||(c.vec3d.set(a,b),this._viewProjectionDirty=this._frustumPlanesDirty=this._viewDirty=!0)};p.prototype._computeFrustumPlanes=function(d){if(!d){d=Array(6);for(var e=0;6>e;++e)d[e]=a.plane.create()}b.matrixToFrustumPlanes(this.viewMatrix,this.projectionMatrix,d);return d};p.prototype._ensureViewClean=function(){this._viewDirty&&(c.mat4d.lookAt(this._eye,this._center,this._up,this._viewMatrix),c.vec3d.set3(-this._viewMatrix[2],
-this._viewMatrix[6],-this._viewMatrix[10],this._viewForward),c.vec3d.set3(this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9],this._viewUp),c.vec3d.set3(this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8],this._viewRight),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};return p}();var m=c.vec4d.create(),k=c.mat4d.create(),d=c.vec3d.create(),q=c.vec3d.create();return n})},"esri/views/animation/pointToPoint/Animation":function(){define("require exports ../easing ./Definition ./Settings ./apex/Path".split(" "),
function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});var l={zoom:0,pan:0,rotate:0};n=function(){function e(e){this.createCamera=e;this.time=0;this.definition=new a.Definition(e);this.path=new b.Path}e.prototype.update=function(a,b,e){this.definition.update(a,b,e);this.path.update(this.definition,e);this.time=this._applyTimeSettings(this.path.time,e);this.settings=e};e.prototype.cameraAt=function(a,b){b=b||this.createCamera();a=Math.min(Math.max(0,a),1);a=this.settings.easing?this.normalizedEasing(this.settings.easing,
a,1E3*this.time):1<=this.time?this.normalizedEasing(c.inOutCoastQuad,a):this.normalizedEasing(c.outExpo,a);a=this.path.interpolateComponentsAt(a,l);b.interpolate(this.definition.source,this.definition.target,a);return b};e.prototype.normalizedEasing=function(a,b,e){e=a(0);var d=a(1);return(a(b)-e)/(d-e)};e.prototype._applyTimeSettings=function(a,b){var e=null!=b.speedFactor?b.speedFactor:1;null!=b.duration?a=b.duration:null!=b.speedFactor&&(a/=e);return a=Math.min(Math.max(null!=b.minDuration?b.minDuration:
f.defaultSettings.minDuration/e,a),null!=b.maxDuration?b.maxDuration:f.defaultSettings.maxDuration/e)};return e}();g.Animation=n;g.default=n})},"esri/views/animation/pointToPoint/Definition":function(){define(["require","exports","./Settings"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a){this.createCamera=a;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:c.defaultSettings.desiredScreenFlow};this.source=a();this.target=
a()}a.prototype.clone=function(){var c=new a(this.createCamera);c.copyFrom(this);return c};a.prototype.copyFrom=function(a){this.update(a.source,a.target,a.settings)};a.prototype.update=function(a,b,l){this.source!==a&&this.source.copyFrom(a);this.target!==b&&this.target.copyFrom(b);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=l.desiredScreenFlow?l.desiredScreenFlow:c.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*
this.target.size;this.halfWindowSize=this.target.size/2};a.prototype.halfWindowPanAtZoom=function(a){a=this.target.pixelsPerPanAtZoom(a);return this.halfWindowSize/a};Object.defineProperty(a.prototype,"hasZoom",{get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasPan",{get:function(){return 1E-9<this.compared.pan},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hasRotate",{get:function(){return 1E-9<
this.compared.rotate},enumerable:!0,configurable:!0});return a}();g.Definition=n;g.default=n})},"esri/views/animation/pointToPoint/Settings":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.defaultSettings={desiredScreenFlow:2,minDuration:.5,maxDuration:8}})},"esri/views/animation/pointToPoint/apex/Path":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../easing ../Path ../Segment ./planning".split(" "),function(n,
g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});n=function(e){function h(a,c){var d=e.call(this)||this;d._preallocSegments=[new b.default,new b.default,new b.default];d.update(a,c);return d}c(h,e);h.prototype.update=function(a,b){if(a){this.definition?this.definition.copyFrom(a):this.definition=a.clone();var d=null;b&&b.apex&&(d=l.optimalDistance(a,b.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==d?this._updateWithoutApex():this._updateWithApex(d,
b.apex)}};h.prototype.segmentInterpolateComponentsAt=function(b,e,d){d=b.interpolateComponentsAt(e,d);b===this._ascensionSegment?d.zoom=a.outQuad(d.zoom):b===this._descensionSegment&&(d.zoom=a.inQuad(d.zoom));return d};h.prototype._updateWithApex=function(a,b){var d=this._preallocSegments,e=d[0],c=d[1],d=d[2],h=null!=b.ascensionFactor?b.ascensionFactor:.5;b=Math.min(1-h,null!=b.ascensionFactor?b.descensionFactor:.5);var f=1-h-b;e.definition?e.definition.copyFrom(this.definition):e.definition=this.definition.clone();
e.definition.compared.targetZoom=a;e.definition.compared.pan=this.definition.compared.pan*h;e.definition.compared.rotate=this.definition.compared.rotate*h;e.update();this._ascensionSegment=e;this.segments.push(e);0<f&&(c.definition?c.definition.copyFrom(this.definition):c.definition=this.definition.clone(),c.definition.copyFrom(this.definition),c.definition.compared.sourceZoom=a,c.definition.compared.targetZoom=a,c.definition.compared.pan=this.definition.compared.pan*f,c.definition.compared.rotate=
this.definition.compared.rotate*f,c.update(),this.segments.push(c));d.definition?d.definition.copyFrom(this.definition):d.definition=this.definition.clone();d.definition.compared.sourceZoom=a;d.definition.compared.pan=this.definition.compared.pan*b;d.definition.compared.rotate=this.definition.compared.rotate*b;d.update();this._descensionSegment=d;this.segments.push(d)};h.prototype._updateWithoutApex=function(){var a=this._preallocSegments[0];a.update(this.definition);this.segments.push(a)};return h}(f.default);
g.Path=n;g.default=n})},"esri/views/animation/pointToPoint/Path":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(){this.segments=[]}Object.defineProperty(c.prototype,"time",{get:function(){return this.segments.reduce(function(a,c){return a+c.time},0)},enumerable:!0,configurable:!0});c.prototype.interpolateComponentsAt=function(a,c){a=Math.min(Math.max(a,0),1);a*=this.time;for(var b=0,f=0,e=this.definition,h=0;h<this.segments.length;h++){var m=
this.segments[h],k=m.definition;if(a<=m.time||h===this.segments.length-1)return c=this.segmentInterpolateComponentsAt(m,a/m.time,c),c.pan=e.hasPan?(b+k.compared.pan*c.pan)/e.compared.pan:1,c.rotate=e.hasRotate?(f+k.compared.rotate*c.rotate)/e.compared.rotate:1,a=c.zoom*(k.compared.targetZoom-k.compared.sourceZoom)+k.compared.sourceZoom,b=this.segments[0].definition.compared.sourceZoom,f=this.segments[this.segments.length-1].definition.compared.targetZoom,c.zoom=e.hasZoom?(a-b)/(f-b):1,c;a-=m.time;
b+=k.compared.pan;f+=k.compared.rotate}};c.prototype.segmentInterpolateComponentsAt=function(a,c,b){return a.interpolateComponentsAt(c,b)};return c}();g.Path=n;g.default=n})},"esri/views/animation/pointToPoint/Segment":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a){a&&this.update(a)}c.prototype.update=function(a){a&&(this.definition?this.definition.copyFrom(a):this.definition=a.clone());this._updatePrecomputedVariables();
this._updatePixelFlow()};c.prototype._updatePrecomputedVariables=function(){var a=this.definition,c=a.compared,b=c.sourceZoom,l=c.targetZoom;this._zoomSign=b>l?1:-1;this._panPixelsAtSource=c.pan*a.source.pixelsPerPanAtZoom(b);a=(a.source.pixelsPerRotateAtZoom(b)+a.target.pixelsPerRotateAtZoom(l))/2;this._rotatePixels=c.rotate*a};c.prototype._updatePixelFlow=function(){var a=this.definition.compared.sourceZoom,c=this.definition.compared.targetZoom,b=this.definition,l=b.hasZoom,e=b.hasPan,b=b.hasRotate,
h=0,m=0;l&&(e&&(h=(c/a-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),b&&(m=Math.log(a/c)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;a=this.definition.desiredPixelFlow;l&&e&&b?(c=h+m+h*m,this._zoomPixelFlow=h*m/c*a,this._panPixelFlow=m/c*a,this._rotatePixelFlow=h/c*a):l&&e?(c=1+h,this._zoomPixelFlow=h/c*a,this._panPixelFlow=1/c*a):l&&b?(c=1+m,this._zoomPixelFlow=
m/c*a,this._rotatePixelFlow=1/c*a):e&&b?(h=this._panPixelsAtSource/this._rotatePixels,c=1+h,this._panPixelFlow=h/c*a,this._rotatePixelFlow=1/c*a):e?this._panPixelFlow=a:l?this._zoomPixelFlow=a:b&&(this._rotatePixelFlow=a);this.time=b?this.rotateTime:l?this.zoomTime:e?this.panTime:0};Object.defineProperty(c.prototype,"zoomTime",{get:function(){return this.definition.hasZoom?Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/
this._zoomPixelFlow:0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"panTime",{get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){var a=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*a+1)/(a*this._zoomPixelFlow)}return this._panPixelsAtSource/this._panPixelFlow}return 0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"rotateTime",{get:function(){return this.definition.hasRotate?
this._rotatePixels/this._rotatePixelFlow:0},enumerable:!0,configurable:!0});c.prototype._interpolateComponentsZoom=function(a){if(this.definition.hasZoom){var c=this.definition.compared.sourceZoom,b=this.definition.compared.targetZoom;return(c*Math.pow(c/b,-a)-c)/(b-c)}return a};c.prototype._interpolateComponentsPan=function(a){if(this.definition.hasPan&&this.definition.hasZoom){var c=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*
(Math.pow(2,c*a*this.time)-1)/(c*Math.LN2)}return a};c.prototype._interpolateComponentsRotate=function(a){return a};c.prototype.interpolateComponentsAt=function(a,c){a=Math.min(Math.max(a,0),1);var b=this._interpolateComponentsZoom(a),f=this._interpolateComponentsPan(a);a=this._interpolateComponentsRotate(a);c?(c.zoom=b,c.pan=f,c.rotate=a):c={zoom:b,pan:f,rotate:a};return c};return c}();g.Segment=n;g.default=n})},"esri/views/animation/pointToPoint/apex/planning":function(){define(["require","exports",
"./functions"],function(n,g,c){function a(a,b){var c=Math.max(a.compared.sourceZoom,a.compared.targetZoom);a=a.source.zoomAtPixelsPerPan(a.desiredPixelFlow/a.compared.pan)/2;return a<c?null!=b.maximumDistance?c+(b.maximumDistance-c)/2:1.5*c:b.maximumDistance?Math.min(b.maximumDistance,a):a}Object.defineProperty(g,"__esModule",{value:!0});g.optimalDistance=function(f,b){var l=a(f,b),e={ascensionFactor:null!=b.ascensionFactor?b.ascensionFactor:.5,descensionFactor:null!=b.descensionFactor?b.descensionFactor:
.5},h=0===e.ascensionFactor,m=0===e.descensionFactor,k=h?c.tAscensionZoomOnly:c.tAscensionZoomPan,d=h?c.dtAscensionZoomOnly:c.dtAscensionZoomPan,q=h?c.ddtAscensionZoomOnly:c.ddtAscensionZoomPan,p=m?c.tDescensionZoomOnly:c.tDescensionZoomPan,r=m?c.dtDescensionZoomOnly:c.dtDescensionZoomPan,u=m?c.ddtDescensionZoomOnly:c.ddtDescensionZoomPan,h=function(a){return k(f,e,a)+c.tPanion(f,e,a)+p(f,e,a)},m=function(a){return d(f,e,a)+c.dtPanion(f,e,a)+r(f,e,a)},t=function(a){return q(f,e,a)+c.ddtPanion(f,e,
a)+u(f,e,a)},g=h(l),A=c.tBaseLine(f),z=b.maximumIterations||20,x=null!=b.maximumDistance?b.maximumDistance:Infinity;for(b=0;b<z;b++){var B=(m(l)+1E-6)/t(l);if(isNaN(B)||l>=x&&0>B){if(!isFinite(x))return null;l=x;g=h(l);break}l-=B;if(l<f.compared.sourceZoom||l<f.compared.targetZoom)return null;B=h(l);if(.005>=Math.abs(B-g)/g)break;g=B}return g>.7*A?null:l<f.compared.sourceZoom||l<f.compared.targetZoom?null:l}})},"esri/views/animation/pointToPoint/apex/functions":function(){define(["require","exports"],
function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.tAscensionZoomPan=function(c,a,f){var b=c.halfWindowPanAtZoom(f-c.compared.sourceZoom);return-c.halfWindowSize*(a.ascensionFactor*Math.LN2*c.compared.pan+b)*Math.log(c.compared.sourceZoom/f)/(c.desiredPixelFlow*Math.LN2*b)};g.dtAscensionZoomPan=function(c,a,f){var b=1/f,l=Math.log(c.compared.sourceZoom*b),e=1/c.desiredPixelFlow,h=1/Math.LN2;f-=c.compared.sourceZoom;var m=1/f;a=(a.ascensionFactor*Math.LN2*c.compared.pan+c.halfWindowPanAtZoom(f))/
c.halfWindowPanAtZoom(1);return c.halfWindowSize*b*e*h*m*a-c.halfWindowSize*l*e*h*m+c.halfWindowSize*l*e*h*a/(f*f)};g.ddtAscensionZoomPan=function(c,a,f){var b=f-c.compared.sourceZoom,l=1/b,e=1/f,h=Math.log(c.compared.sourceZoom*e);a=(a.ascensionFactor*Math.LN2*c.compared.pan+c.halfWindowPanAtZoom(b))/c.halfWindowPanAtZoom(1);return c.halfWindowSize*l*(-2*l*e*a+2*l*h+2*e-2*h*a/(b*b)-a/(f*f))/(c.desiredPixelFlow*Math.LN2)};g.tAscensionZoomOnly=function(c,a,f){return-c.halfWindowSize*Math.log(c.compared.sourceZoom/
f)/(c.desiredPixelFlow*Math.LN2)};g.dtAscensionZoomOnly=function(c,a,f){return c.halfWindowSize/(f*c.desiredPixelFlow*Math.LN2)};g.ddtAscensionZoomOnly=function(c,a,f){return-c.halfWindowSize/(f*f*c.desiredPixelFlow*Math.LN2)};g.tPanion=function(c,a,f){return-c.compared.pan*c.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(c.desiredPixelFlow*c.halfWindowPanAtZoom(f))};g.dtPanion=function(c,a,f){return c.compared.pan*c.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(c.desiredPixelFlow*
c.halfWindowPanAtZoom(f*f))};g.ddtPanion=function(c,a,f){return-2*c.compared.pan*c.halfWindowSize*(a.ascensionFactor+a.descensionFactor-1)/(c.desiredPixelFlow*c.halfWindowPanAtZoom(f*f*f))};g.tDescensionZoomPan=function(c,a,f){return c.halfWindowSize*(-c.halfWindowPanAtZoom(f)-a.descensionFactor*Math.LN2*c.compared.pan+c.halfWindowPanAtZoom(c.compared.targetZoom))*Math.log(f/c.compared.targetZoom)/(c.desiredPixelFlow*Math.LN2*c.halfWindowPanAtZoom(-f+c.compared.targetZoom))};g.dtDescensionZoomPan=
function(c,a,f){var b=Math.log(f/c.compared.targetZoom),l=1/c.desiredPixelFlow,e=1/Math.LN2,h=-f+c.compared.targetZoom,m=1/h;a=(-c.halfWindowPanAtZoom(f)-a.descensionFactor*Math.LN2*c.compared.pan+c.halfWindowPanAtZoom(c.compared.targetZoom))/c.halfWindowPanAtZoom(1);return-c.halfWindowSize*b*l*e*m+c.halfWindowSize*b*l*e*a/(h*h)+c.halfWindowSize*l*e*m*a/f};g.ddtDescensionZoomPan=function(c,a,f){var b=f-c.compared.targetZoom,l=1/b,e=1/f,h=Math.log(f/c.compared.targetZoom);a=(c.halfWindowPanAtZoom(f)+
a.descensionFactor*Math.LN2*c.compared.pan-c.halfWindowPanAtZoom(c.compared.targetZoom))/c.halfWindowPanAtZoom(1);return c.halfWindowSize*l*(-2*l*e*a-2*l*h+2*e+2*h*a/(b*b)-a/(f*f))/(c.desiredPixelFlow*Math.LN2)};g.tDescensionZoomOnly=function(c,a,f){return c.halfWindowSize*Math.log(f/c.compared.targetZoom)/(c.desiredPixelFlow*Math.LN2)};g.dtDescensionZoomOnly=function(c,a,f){return c.halfWindowSize/(f*c.desiredPixelFlow*Math.LN2)};g.ddtDescensionZoomOnly=function(c,a,f){return-c.halfWindowSize/(f*
f*c.desiredPixelFlow*Math.LN2)};g.tBaseLine=function(c){var a=Math.LN2*c.compared.pan,f=c.halfWindowPanAtZoom(c.compared.sourceZoom-c.compared.targetZoom),b=c.halfWindowSize*Math.log(c.compared.sourceZoom/c.compared.targetZoom)/(c.desiredPixelFlow*Math.LN2*f);return c.compared.sourceZoom<=c.compared.targetZoom?b*(a-f):b*(a+f)}})},"esri/views/3d/state/controllers/AnimationController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../ViewAnimation","./CameraController"],
function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function l(e){void 0===e&&(e=new a);var c=b.call(this)||this;c.viewAnimation=e;return c}c(l,b);Object.defineProperty(l.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"asyncResult",{get:function(){return this._asyncResult},set:function(a){this._asyncResult&&this._asyncResult.reject();this._asyncResult=a;if(this.state===f.State.Finished||this.state===f.State.Stopped)this._asyncResult=
null,this.state===f.State.Finished?a.resolve():a.reject()},enumerable:!0,configurable:!0});l.prototype.onControllerStart=function(a){var e=this;b.prototype.onControllerStart.call(this,a);this.viewAnimation&&this.viewAnimation.always(function(){e.updateStateFromViewAnimation()})};l.prototype.updateStateFromViewAnimation=function(){!this.viewAnimation||this.state!==f.State.Ready&&this.state!==f.State.Running||(this.viewAnimation.state===a.State.FINISHED?this.finish():this.viewAnimation.state===a.State.STOPPED&&
(this.state=f.State.Stopped))};l.prototype.onControllerEnd=function(a){this.viewAnimation&&(this.viewAnimation.done||(this.state===f.State.Finished?this.viewAnimation.finish():this.state===f.State.Stopped&&this.viewAnimation.stop()));this._asyncResult&&(this.state===f.State.Finished?this._asyncResult.resolve():this._asyncResult.reject());b.prototype.onControllerEnd.call(this,a)};l.prototype.finish=function(){this.finishController()};return l}(f.CameraController);g.AnimationController=n})},"esri/views/3d/state/controllers/CameraController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});var l;(function(a){a.Ready="ready";a.Rejected="rejected";a.Running="running";a.Stopped="stopped";a.Finished="finished"})(l=g.State||(g.State={}));n=function(e){function h(){var a=null!==e&&e.apply(this,arguments)||this;a.state=l.Ready;return a}c(h,e);Object.defineProperty(h.prototype,"active",{get:function(){return this.state===l.Running},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isInteractive",{get:function(){return!1},
enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"canStop",{get:function(){return!1},enumerable:!0,configurable:!0});h.prototype.stopController=function(){return this.canStop?(this.state=l.Stopped,!0):!1};h.prototype.finishController=function(){this.state=l.Finished};h.prototype.onControllerStart=function(a){this.state=l.Running};h.prototype.onControllerEnd=function(a){};h.prototype.stepController=function(a,b){};Object.defineProperty(h.prototype,"steppingFinished",{get:function(){return!1},
enumerable:!0,configurable:!0});a([b.property({readOnly:!0,dependsOn:["state"]})],h.prototype,"active",null);a([b.property()],h.prototype,"state",void 0);return h=a([b.subclass()],h)}(b.declared(f));g.CameraController=n})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../../animation/easing".split(" "),
function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function h(a,d){var e=b.call(this,a.state,a.sceneIntersectionHelper,"interaction"===d?null:void 0)||this;e.view=a;e.mode=d;e.zoomLocation=f.vec3d.create();e.tmpCamera=new l;e.tmpRayDir=f.vec3d.create();e.tmpCenter=f.vec3d.create();e.constraintOptions={selection:15,interactionType:1,interactionFactor:null,interactionStartCamera:new l,interactionDirection:null,tiltMode:0};return e}c(h,b);Object.defineProperty(h.prototype,
"isInteractive",{get:function(){return"interaction"===this.mode},enumerable:!0,configurable:!0});h.prototype.zoomStep=function(a,b){if(this.active){var d=this.view.state,e=this.constraintOptions.interactionStartCamera;this.animation.finished?e.copyFrom(d.camera):this.animation.cameraAt(1,e);this.tmpCamera.copyFrom(d.camera);0<a?(this.intersectionHelper.pickPointInScreen(b,this.zoomLocation)||this.intersectionHelper.pickFreePointInScreen(b,this.zoomLocation),this.intersectionHelper.pickPointFromSegment(this.tmpCamera.eye,
this.tmpCamera.center,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.pickPointFromSegment(this.tmpCamera.eye,this.tmpCamera.center,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:f.vec3d.set(this.tmpCamera.center,this.zoomLocation);this.updateCamera(this.tmpCamera,Math.pow(.6,a),this.zoomLocation,b);this.begin(this.tmpCamera)}};h.prototype.animationSettings=function(){return{apex:null,duration:.6,easing:e.outExpo}};h.prototype.updateCamera=function(b,d,
e,c){f.vec3d.subtract(e,b.eye,this.tmpRayDir);c=f.vec3d.length(this.tmpRayDir);var h=c*d;1>=d&&4>h&&(h=4,d=h/c);1E-6>Math.abs(c-h)||(f.vec3d.scale(this.tmpRayDir,d),f.vec3d.subtract(e,this.tmpRayDir,b.eye),f.vec3d.lerp(b.center,e,1-d),a.applyAll(this.view,this.tmpCamera,this.constraintOptions))};return h}(b.PointToPointAnimationController);g.ZoomStepController=n})},"esri/views/input/InputHandler":function(){define(["require","exports","../../core/Logger","./EventMatch"],function(n,g,c,a){Object.defineProperty(g,
"__esModule",{value:!0});var f=c.getLogger("esri.views.input.InputHandler");n=function(){function e(a){this._manager=null;this._incoming={};this._outgoing={};this._outgoingEventTypes=this._incomingEventTypes=this._incomingEventMatches=null;this._hasSideEffects=a}Object.defineProperty(e.prototype,"incomingEventMatches",{get:function(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(var a in this._incoming)for(var b=0,e=this._incoming[a];b<e.length;b++)this._incomingEventMatches.push(e[b].match)}return this._incomingEventMatches},
enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"incomingEventTypes",{get:function(){this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(function(a){return a.eventType}));return this._incomingEventTypes},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"outgoingEventTypes",{get:function(){this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing));return this._outgoingEventTypes},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"hasSideEffects",{get:function(){return this._hasSideEffects},enumerable:!0,configurable:!0});e.prototype.onInstall=function(a){var b=this;this._manager?f.error("This InputHandler has already been registered with an InputManager"):(a.setEventCallback(function(a){return b._handleEvent(a)}),a.setUninstallCallback(function(){return b._onUninstall()}),this._manager=a)};e.prototype.onUninstall=function(){};e.prototype.registerIncoming=function(e,c,f){var d=this;"function"===
typeof c?(f=c,c=[]):c=c||[];e="string"===typeof e?new a.EventMatch(e,c):e;var h=function(){d._incomingEventTypes=null;d._incomingEventMatches=null};c=function(a){var b=d._incoming[a.match.eventType];b&&(a=b.indexOf(a),b.splice(a,1),h(),d._manager&&d._manager.updateDependencies())};f=new b(e,f,{onPause:c,onRemove:c,onResume:function(a){var b=d._incoming[a.match.eventType];b&&-1===b.indexOf(a)&&(b.push(a),h(),d._manager&&d._manager.updateDependencies())}});c=this._incoming[e.eventType];c||(c=[],this._incoming[e.eventType]=
c);c.push(f);h();this._manager&&this._manager.updateDependencies();return f};e.prototype.registerOutgoing=function(a){var b=this;if(this._outgoing[a])throw Error("There is already a callback registered for this outgoing InputEvent: "+a);var e=new l(a,{onEmit:function(a,e,c,h){b._manager.emit(a.eventType,e,c,h)},onRemove:function(a){delete b._outgoing[a.eventType];b._manager.updateDependencies()}});this._outgoing[a]=e;this._outgoingEventTypes=null;this._manager&&this._manager.updateDependencies();
return e};e.prototype.startCapturingPointer=function(a){this._manager.setPointerCapture(a,!0)};e.prototype.stopCapturingPointer=function(a){this._manager.setPointerCapture(a,!1)};e.prototype._onUninstall=function(){this._manager?(this.onUninstall(),this._manager=null):f.error("This InputHandler is not registered with an InputManager")};e.prototype._handleEvent=function(a){var b=this._incoming[a.type];if(b)for(var e=0;e<b.length;e++){var d=b[e];if(d.match.matches(a)&&(d.callback(a),a.shouldStopPropagation()))break}};
return e}();g.InputHandler=n;var b=function(){function a(a,b,e){this.match=a;this._callback=b;this._handler=e}a.prototype.pause=function(){this._handler.onPause(this)};a.prototype.resume=function(){this._handler.onResume(this)};a.prototype.remove=function(){this._handler.onRemove(this)};Object.defineProperty(a.prototype,"callback",{get:function(){return this._callback},enumerable:!0,configurable:!0});return a}(),l=function(){function a(a,b){this.eventType=a;this._removed=!1;this._handler=b}a.prototype.emit=
function(a,b,e){if(!this._removed)this._handler.onEmit(this,a,b,e)};a.prototype.remove=function(){this._removed=!0;this._handler.onRemove(this)};return a}()})},"esri/views/input/EventMatch":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a,c){void 0===c&&(c=[]);this.eventType=a;this.keyModifiers=c}c.prototype.matches=function(a){if(a.type!==this.eventType)return!1;if(0===this.keyModifiers.length)return!0;a=a.modifiers;
for(var c=0,b=this.keyModifiers;c<b.length;c++)if(!a.has(b[c]))return!1;return!0};return c}();g.EventMatch=n})},"esri/views/input/handlers/support":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.eventMatchesPointerAction=function(c,a){switch(a){case "primary":return"touch"===c.pointerType||0===c.button;case "secondary":return"touch"!==c.pointerType&&2===c.button;case "tertiary":return"touch"!==c.pointerType&&1===c.button}};g.eventMatchesMousePointerAction=
function(c,a){if("touch"===c.pointerType)return!1;switch(a){case "primary":return 0===c.button;case "secondary":return 2===c.button;case "tertiary":return 1===c.button}}})},"esri/views/3d/input/handlers/DragRotate":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function e(a,
b,e,d){var c=f.call(this,!0)||this;c.view=a;c.pointerAction=b;c.pivotPoint=e;c.registerIncoming("drag",d,function(a){return c.handleDrag(a)});return c}c(e,f);e.prototype.handleDrag=function(e){var c=e.data;if(!(1<c.pointers.size)&&b.eventMatchesMousePointerAction(e.data,this.pointerAction)){var h=[c.center.x,this.view.height-c.center.y];switch(c.action){case "start":this.cameraController=new a.RotateController(this.view,this.view.sceneIntersectionHelper,this.pivotPoint);this.view.state.switchCameraController(this.cameraController);
this.cameraController.begin(h);break;case "update":this.cameraController.update(h);break;case "end":this.cameraController.end(),this.cameraController=null}e.stopPropagation()}};return e}(f.InputHandler);g.DragRotate=n})},"esri/views/3d/state/controllers/RotateController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../camera/constraintUtils ../../lib/gl-matrix ../Constraints ./InteractiveController ../utils/navigationUtils ../../support/mathUtils".split(" "),function(n,
g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});n=function(l){function k(a,b,e){var d=l.call(this)||this;d.view=a;d.intersectionHelper=b;d.pivot=e;d.lastPoint=f.vec2d.create();d.tmpWorldUp=f.vec3d.create();d.tmpViewDir=f.vec3d.create();d.tmpRotCurPoint=f.vec2d.create();d.tmpTransf=f.mat4d.create();d.tmpAxis=f.vec3d.create();d.pivotPos=f.vec3d.create();d.constraintOptions={selection:15,interactionType:2,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:0};
d.rotScale="center"===e?3:1.5;return d}c(k,l);k.prototype.begin=function(a){if(this.active){switch(this.pivot){case "eye":f.vec3d.set(this.beginCamera.eye,this.pivotPos);this.constraintOptions.interactionType=3;this.constraintOptions.tiltMode=1;this.constraintOptions.selection=0;break;case "center":this.intersectionHelper.pickPointFromSegment(this.beginCamera.eye,this.beginCamera.center,this.pivotPos)||(this.view.state.isLocal?this.intersectionHelper.pickFreePointFromSegment(this.beginCamera.eye,
this.beginCamera.center,this.pivotPos):f.vec3d.set(this.beginCamera.center,this.pivotPos)),this.beginCamera.center=this.pivotPos,this.constraintOptions.interactionType=2,this.constraintOptions.tiltMode=0,this.constraintOptions.selection=11}this.constraintOptions.interactionStartCamera=this.beginCamera;e.normalizeCoordinate(this.beginCamera,a,this.lastPoint)}};k.prototype.update=function(b){if(this.active){var d;switch(this.pivot){case "eye":d=this.currentCamera.center;break;case "center":this.currentCamera.center=
this.pivotPos,d=this.currentCamera.eye}this.applyRotation(this.currentCamera,b,d,this.pivotPos);a.applyAll(this.view,this.currentCamera,this.constraintOptions)}};k.prototype.end=function(){this.active&&this.finishController()};k.prototype.applyRotation=function(a,c,k,l){this.view.renderCoordsHelper.worldUpAtPosition(l,this.tmpWorldUp);e.normalizeCoordinate(a,c,this.tmpRotCurPoint);c=(this.tmpRotCurPoint[1]-this.lastPoint[1])*this.rotScale;var d=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;
f.vec3d.subtract(k,l,this.tmpViewDir);var m=f.vec3d.length(this.tmpViewDir),m=h.acos(f.vec3d.dot(this.tmpViewDir,this.tmpWorldUp)/m);if("eye"===this.pivot){var q=.5*Math.PI-m,p=.495*Math.PI;c=q-Math.max(-p,Math.min(p,q+-.5*c))}c=h.clamp(c+m,b.TiltDefault.min,b.TiltDefault.max)-m;f.mat4d.identity(this.tmpTransf);f.vec3d.cross(a.up,this.tmpViewDir,this.tmpAxis);"center"===this.pivot&&(d=-d);f.mat4d.rotate(this.tmpTransf,d,this.tmpWorldUp);f.mat4d.rotate(this.tmpTransf,c,this.tmpAxis);f.mat4d.multiplyVec3(this.tmpTransf,
this.tmpViewDir);f.vec3d.add(l,this.tmpViewDir,k);f.mat4d.multiplyVec3(this.tmpTransf,a.up);f.vec2d.set(this.tmpRotCurPoint,this.lastPoint);a.markViewDirty()};return k}(l.InteractiveController);g.RotateController=n})},"esri/views/3d/state/controllers/InteractiveController":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./CameraController","../../webgl-engine/lib/Camera"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});n=function(a){function b(){var b=
null!==a&&a.apply(this,arguments)||this;b.beginCamera=new f;b.currentCamera=new f;return b}c(b,a);Object.defineProperty(b.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});b.prototype.stepController=function(b,c){a.prototype.stepController.call(this,b,c);c.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(c)};b.prototype.onControllerStart=function(b){a.prototype.onControllerStart.call(this,b);this.beginCamera.copyFrom(b);this.currentCamera.copyFrom(b)};
b.prototype.onControllerEnd=function(b){b.copyViewFrom(this.currentCamera);a.prototype.onControllerEnd.call(this,b)};return b}(a.CameraController);g.InteractiveController=n})},"esri/views/3d/input/handlers/DragZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,g,c,a,f,b,l){Object.defineProperty(g,
"__esModule",{value:!0});n=function(b){function e(a,e,d){var c=b.call(this,!0)||this;c.view=a;c.pointerAction=e;c.registerIncoming("drag",d,function(a){return c.handleDrag(a)});return c}c(e,b);e.prototype.handleDrag=function(b){var e=b.data;if(!(1<e.pointers.size)&&l.eventMatchesMousePointerAction(b.data,this.pointerAction)){var d=[e.center.x,this.view.height-e.center.y];switch(e.action){case "start":this.cameraController=this.view.state.isGlobal?new a.ZoomController(this.view,this.view.sceneIntersectionHelper):
new f.ZoomController(this.view,this.view.sceneIntersectionHelper);this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(d);break;case "update":this.cameraController.update(d);break;case "end":this.cameraController.end(),this.cameraController=null}b.stopPropagation()}};return e}(b.InputHandler);g.DragZoom=n})},"esri/views/3d/state/controllers/global/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../InteractiveController ../../utils/navigationUtils".split(" "),
function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function e(a,e){var d=b.call(this)||this;d.view=a;d.intersectionHelper=e;d.pickPoint=f.vec3d.create();d.tmpP0=f.vec3d.create();d.panAxis=f.vec3d.create();d.tmpRayDir=f.vec3d.create();d.targetOnSphere=f.vec3d.create();d.dragBeginPoint=f.vec2d.create();d.normalizedAnchorPoint=f.vec2d.create();d.constraintOptions={selection:7,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,
tiltMode:0};d.sphere={center:f.vec3d.create(),radius:0};d.hasPickPoint=!1;return d}c(e,b);e.prototype.begin=function(a){this.active&&(f.vec2d.set(a,this.dragBeginPoint),l.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),a=l.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,a,!1),this.hasPickPoint=!!a.scenePickPoint,this.pickPoint=a.scenePickPoint,this.sphere=a.sphere,this.constraintOptions.interactionStartCamera=this.beginCamera)};e.prototype.update=function(b){if(this.active){this.currentCamera.eye=
this.beginCamera.eye;this.currentCamera.center=this.beginCamera.center;this.currentCamera.up=this.beginCamera.up;f.vec3d.subtract(this.currentCamera.center,this.currentCamera.eye,this.tmpRayDir);var e=f.vec3d.length(this.tmpRayDir);l.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var d=12*(this.tmpP0[1]-this.normalizedAnchorPoint[1]),c=e*Math.pow(2,d),h=this.view.state.constraints.minimumPoiDistance;0>d&&c<h&&(c=h);1E-6>Math.abs(e-c)||(this.hasPickPoint&&c<e&&(d=1-(1-c/e)*(1-this.sphere.radius/
f.vec3d.length(this.currentCamera.center)),f.vec3d.scale(this.currentCamera.center,d)),f.vec3d.scale(this.tmpRayDir,-c/e),f.vec3d.add(this.currentCamera.center,this.tmpRayDir,this.currentCamera.eye),this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),a.applyAll(this.view,this.currentCamera,this.constraintOptions),this.hasPickPoint&&(l.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere,!0),b=l.rotationAndAxisFromPoints(this.pickPoint,
this.targetOnSphere,this.panAxis),l.applyRotation(this.currentCamera,this.sphere.center,this.panAxis,b)),a.applySurfaceCollision(this.view,this.currentCamera))}};e.prototype.end=function(){this.active&&this.finishController()};return e}(b.InteractiveController);g.ZoomController=n})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../InteractiveController ../../utils/navigationUtils ../../../support/mathUtils".split(" "),
function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function h(a,d){var e=b.call(this)||this;e.view=a;e.intersectionHelper=d;e.tmpP=f.vec3d.create();e.tmpN=f.vec3d.create();e.tmpP0=f.vec3d.create();e.tmpPoi=f.vec3d.create();e.tmpRayDir=f.vec3d.create();e.dragBeginPoint=f.vec2d.create();e.normalizedAnchorPoint=f.vec2d.create();e.constraintOptions={selection:15,interactionType:1,interactionFactor:0,interactionStartCamera:null,interactionDirection:f.vec3d.create(),
tiltMode:0};e.plane={normal:f.vec3d.create(),d:0};return e}c(h,b);h.prototype.begin=function(a){this.active&&(f.vec2d.set(a,this.dragBeginPoint),l.normalizeCoordinate(this.beginCamera,a,this.normalizedAnchorPoint),this.intersectionHelper.pickPointInScreen(a,this.tmpP)||this.intersectionHelper.pickFreePointInScreen(a,this.tmpP),f.vec3d.normalize(f.vec3d.subtract(this.beginCamera.eye,this.beginCamera.center,this.tmpN)),0>this.tmpN[1]&&f.vec3d.negate(this.tmpN),l.setPlane(this.tmpP,this.tmpN,this.plane),
this.constraintOptions.interactionStartCamera=this.beginCamera)};h.prototype.update=function(b){if(this.active){l.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||f.vec3d.set(this.currentCamera.center,this.tmpPoi);l.normalizeCoordinate(this.currentCamera,b,this.tmpP0);var d=4*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);f.vec2d.set(this.tmpP0,this.normalizedAnchorPoint);f.vec3d.subtract(this.tmpPoi,this.currentCamera.eye,this.tmpRayDir);var c=f.vec3d.length(this.tmpRayDir),
h=c*(1-d);f.vec3d.set(this.tmpRayDir,this.constraintOptions.interactionDirection);f.vec3d.scale(this.constraintOptions.interactionDirection,e.sign(d)/c);var k=this.view.state.constraints.minimumPoiDistance;0<=d&&h<k&&(h=k,d=-(h-c)/c);1E-6>Math.abs(c-h)||(f.vec3d.scale(this.tmpRayDir,d),f.vec3d.add(this.currentCamera.eye,this.tmpRayDir),f.vec3d.lerp(this.currentCamera.center,this.tmpPoi,d),this.currentCamera.center[2]=this.tmpPoi[2]>this.beginCamera.center[2]?Math.max(this.beginCamera.center[2],this.currentCamera.center[2]):
Math.min(this.beginCamera.center[2],this.currentCamera.center[2]),this.currentCamera.markViewDirty(),this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.dragBeginPoint,b),a.applyAll(this.view,this.currentCamera,this.constraintOptions))}};h.prototype.end=function(){this.active&&this.finishController()};return h}(b.InteractiveController);g.ZoomController=n})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/watchUtils ../../state/controllers/GamepadController ../../../input/InputHandler".split(" "),
function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});n=function(e){function h(b){var c=e.call(this,!0)||this;c.view=b;c.watchHandles=new a;c.handle=c.registerIncoming("gamepad",function(a){return c.handleEvent(a)});c.handle.pause();return c}c(h,e);h.prototype.onInstall=function(a){var b=this;e.prototype.onInstall.call(this,a);this.watchHandles.add([f.init(this.view.navigation.gamepad,"enabled",function(a){a?b.handle.resume():(b.handle.pause(),b.cameraController&&(b.cameraController.finishController(),
b.cameraController=null))}),this.view.navigation.gamepad.watch("device",function(a){b.cameraController&&a&&b.cameraController.device!==a&&(b.cameraController.finishController(),b.cameraController=null)})])};h.prototype.onUninstall=function(){this.watchHandles.removeAll();e.prototype.onUninstall.call(this)};h.prototype.handleEvent=function(a){var e=this.view.navigation.gamepad.device;if(!e||a.data.device===e)if((e=this.cameraController&&this.cameraController.active)||b.GamepadController.activatesFor(this.view,
a.data))e||(e=new b.GamepadController(this.view,a.data.device),this.view.state.switchCameraController(e)&&(this.cameraController=e)),this.cameraController&&this.cameraController.active&&this.cameraController.device===a.data.device&&this.cameraController.handleEvent(a.data)};return h}(l.InputHandler);g.GamepadNavigation=n})},"esri/views/3d/state/controllers/GamepadController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/runtimeUtils ../../camera/constraintUtils ../../lib/gl-matrix ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../../3d/support/earthUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../support/mathUtils ../../webgl-engine/lib/Camera ../../../navigation/gamepadUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){Object.defineProperty(g,"__esModule",{value:!0});n=function(e){function q(a,b){var d=e.call(this)||this;d.view=a;d.device=b;d.transformation={translation:[0,0,0],heading:0,tilt:0};d.constraintOptions={selection:15,interactionType:0,interactionStartCamera:new r,interactionFactor:0,interactionDirection:null,tiltMode:1};return d}c(q,e);q.prototype.handleEvent=function(a){var b=u.extractTransformation(a,this.view.navigation.gamepad,this.transformation);("end"===
a.action||u.isZeroTransformation(b))&&this.finishController()};q.prototype.onControllerStart=function(a){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;e.prototype.onControllerStart.call(this,a)};q.prototype.updateFilteredSurfaceElevation=function(a){this.filteredSurfaceElevation+=1*(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*a};q.prototype.stepController=function(a,b){this.updateFilteredSurfaceElevation(a);this.currentCamera.copyViewFrom(b);
this.updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this.calculateControlTransformation(a,this.currentCamera,M);this.applyPan(M.pan);this.applyRotate(M.rotate);this.applyZoom(M.zoom);this.applyAscend(M.ascend);this.constraintOptions.interactionType=0;this.constraintOptions.selection=8;f.applyAll(this.view,this.currentCamera,this.constraintOptions);e.prototype.stepController.call(this,a,b)};q.prototype.applyRotate=function(a){if(a.enabled){var d=this.currentCamera,
e=d.center,c=d.up,h=d.eye;b.vec3d.subtract(e,h);b.mat4d.multiplyVec3(a.matrix,e);b.vec3d.add(e,h);b.mat4d.multiplyVec3(a.matrix,c);d.markViewDirty();this.constraintOptions.interactionType=3;this.constraintOptions.selection=7;f.applyAll(this.view,d,this.constraintOptions)}};q.prototype.applyPan=function(a){if(a.enabled){var d=this.currentCamera,e=d.center,c=d.up;b.mat4d.multiplyVec3(a.matrix,d.eye);b.mat4d.multiplyVec3(a.matrix,e);this.view.state.isGlobal&&b.mat4d.multiplyVec3(a.matrix,c);d.markViewDirty();
this.constraintOptions.interactionType=4;this.constraintOptions.selection=15;f.applyAll(this.view,d,this.constraintOptions)}};q.prototype.applyZoom=function(a){if(a){var d=this.currentCamera,e=d.viewForward;b.vec3d.add(d.eye,b.vec3d.scale(e,a,F));this.currentCamera.markViewDirty();this.constraintOptions.interactionDirection=b.vec3d.negate(b.vec3d.set(e,T));this.constraintOptions.interactionType=1;this.constraintOptions.selection=7;f.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=
null}};q.prototype.applyAscend=function(a){if(a){var d=this.currentCamera,e=d.center,d=d.eye;this.view.renderCoordsHelper.worldUpAtPosition(d,G);this.constraintOptions.interactionDirection=b.vec3d.set(G,T);if(this.view.state.isGlobal){var c=b.vec3d.length(d);a=(c+a)/c;b.vec3d.scale(d,a);b.vec3d.scale(e,a)}else a=b.vec3d.scale(G,a,I),b.vec3d.add(d,a),b.vec3d.add(e,a);this.currentCamera.markViewDirty();this.updateCameraCenter();this.constraintOptions.interactionType=5;this.constraintOptions.selection=
8;f.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this.updateCameraCenter();this.constraintOptions.selection=7;f.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};q.prototype.calculateControlTransformation=function(d,e,c){c.zoom=0;c.ascend=0;c.pan.enabled=!1;b.mat4d.identity(c.pan.matrix);c.rotate.enabled=!1;b.mat4d.identity(c.rotate.matrix);d=this.computeVelocities(d);switch(this.view.viewingMode){case "local":this.calculateControlTransformationLocal(d,
e,c);break;case "global":this.calculateControlTransformationGlobal(d,e,c);break;default:a.neverReached(this.view.viewingMode)}};q.prototype.updateCameraCenter=function(){var a=this.currentCamera;h.centerOnManifoldSilhouetteFallback(this.view.renderCoordsHelper,a.eye,a.viewForward,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,a.center);this.currentCamera.markViewDirty()};q.prototype.calculateControlTransformationLocal=function(d,e,c){var h=e.viewRight,f=e.viewForward,
k=this.transformation,q=this.view.navigation.gamepad;b.vec3d.set3(f[0],f[1],0,C);b.vec3d.normalize(C);f=k.translation[0]*d.pan;0!==f&&(b.vec3d.scale(h,f,E),b.mat4d.translate(c.pan.matrix,E),c.pan.enabled=!0);b.vec3d.set3(0,0,0,F);switch(q.mode){case "pan":q=-k.translation[1]*d.pan;0!==q&&(b.vec3d.scale(C,q,F),b.mat4d.translate(c.pan.matrix,F),c.pan.enabled=!0);break;case "zoom":c.zoom=-k.translation[1]*d.zoom;break;default:a.neverReached(q.mode)}c.ascend=k.translation[2]*d.ascend;q=-k.heading*d.rotate;
0!==q&&(b.mat4d.rotate(c.rotate.matrix,q,this.view.renderCoordsHelper.worldUpAtPosition(e.eye,G)),c.rotate.enabled=!0);d=k.tilt*d.rotate;e=m.viewAngle(this.view.renderCoordsHelper,e.center,e.eye);if(e=p.clamp(e+d,l.TiltDefault.min,l.TiltDefault.max)-e)b.mat4d.rotate(c.rotate.matrix,e,h),c.rotate.enabled=!0};q.prototype.calculateControlTransformationGlobal=function(a,d,e){var c=d.eye,h=d.viewRight,f=this.transformation,k=this.view.navigation.gamepad;b.vec3d.cross(h,c,C);b.vec3d.normalize(C);b.vec3d.negate(C);
var l=f.translation[0]*a.pan;0!==l&&(b.mat4d.rotate(e.pan.matrix,l,C),e.pan.enabled=!0);switch(k.mode){case "pan":k=f.translation[1]*a.pan;0!==k&&(b.mat4d.rotate(e.pan.matrix,k,h),e.pan.enabled=!0);break;case "zoom":e.zoom=-f.translation[1]*a.zoom}k=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;e.ascend=f.translation[2]*a.ascend;l=-f.heading*a.rotate;0!==l&&(b.mat4d.rotate(e.rotate.matrix,l,c),e.rotate.enabled=!0);a=this.clampTiltDeltaGlobalToValidRange(f.tilt*a.rotate,
d.eye,d.viewForward,k);0!==a&&(b.mat4d.rotate(e.rotate.matrix,a,h),e.rotate.enabled=!0)};q.prototype.clampTiltDeltaGlobalToValidRange=function(a,d,e,c){var f=h.onSurfaceTiltToEyeTiltGlobal(l.TiltDefault.min,d,c),q=0,t=0;this.view.renderCoordsHelper.intersectManifold(d,e,c,I)?(e=m.viewAngle(this.view.renderCoordsHelper,I,d),q=h.onSurfaceTiltToEyeTiltGlobal(e,d,c),t=h.onSurfaceTiltToEyeTiltGlobal(l.TiltDefault.max,d,c)):(h.closestPointOnCenteredSphereSilhouette(c+k.earthRadius,d,e,I),e=p.acos(-b.vec3d.dot(e,
b.vec3d.normalize(I))),q=h.offSurfaceTiltToEyeTiltGlobal(e,d,c),t=h.offSurfaceTiltToEyeTiltGlobal(l.TiltDefault.max,d,c));return p.clamp(q+a,f,t)-q};q.prototype.pointEquivalentAboveSurface=function(a,d,e){var c=this.view.renderCoordsHelper,h=c.getAltitude(a);d+=Math.abs(h-d);b.vec3d.set(a,e);c.setAltitude(d,e);return d};q.prototype.clampedDistanceToSurface=function(a,e){var c=this.view.renderCoordsHelper,f=this.view.state.camera,k=d.headingTiltToDirectionUp(this.view,e,0,v,V).direction;h.centerOnManifoldSilhouetteFallback(c,
e,k,a,K);k=b.vec3d.dist(e,K);h.centerOnManifoldSilhouetteFallback(c,e,b.vec3d.direction(f.center,e,K),a,N);a=b.vec3d.dist(e,N);return Math.min(k,a)};q.prototype.computeHeadingRotateRadius=function(a){var d=this.view,e=d.renderCoordsHelper,c=d.state,d=c.camera,c=c.isGlobal;h.centerOnManifoldSilhouetteFallback(e,d.eye,d.viewForward,this.filteredSurfaceElevation,I);if(c)return d=b.vec3d.subtract(a,I,K),e=b.vec3d.length(d),b.vec3d.scale(d,1/e,d),a=b.vec3d.normalize(a,N),a=p.acos(b.vec3d.dot(a,d)),e*Math.sin(Math.min(A,
a));b.vec3d.set(a,K);e.setAltitude(this.filteredSurfaceElevation,K);return b.vec3d.dist(I,K)};q.prototype.minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:x};q.prototype.computeVelocities=function(a){var b=this.filteredSurfaceElevation,d=b+k.earthRadius,e=this.view.state,c=e.camera,h=e.isGlobal,f=this.pointEquivalentAboveSurface(c.eye,b,H),l=this.clampedDistanceToSurface(b,H),m=c.width/2,q=z*c.width,e=z*c.width,c=l*Math.tan(.5*c.fovX)/m,t=c/d,d=c/this.computeHeadingRotateRadius(H),
h=(h?t:c)*q*a,b=f-b,b=Math.max(this.minimumAscendVelocity()*a,Math.pow(2,q*a/m)*b-b),l=Math.pow(2,q*a/m)*l-l;a*=p.clamp(d*e,B,D);return{pan:h,ascend:b,zoom:l,rotate:a}};q.activatesFor=function(a,b){a=u.extractTransformation(b,a.navigation.gamepad,t);return!("end"===b.action||u.isZeroTransformation(a))};return q}(e.InteractiveController);g.GamepadController=n;var t={translation:[0,0,0],heading:0,tilt:0},v=80,A=p.deg2rad(v),z=.75,x=5,B=p.deg2rad(30),D=p.deg2rad(80),C=b.vec3d.create(),G=b.vec3d.create(),
E=b.vec3d.create(),F=b.vec3d.create(),I=b.vec3d.create(),K=b.vec3d.create(),N=b.vec3d.create(),H=b.vec3d.create(),M={zoom:0,ascend:0,pan:{enabled:!1,matrix:b.mat4d.create()},rotate:{enabled:!1,matrix:b.mat4d.create()}},T=b.vec3d.create(),V=q.createDirectionUp()})},"esri/core/runtimeUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.neverReached=function(c){}})},"esri/views/3d/support/cameraUtils":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../Camera ../../../config ../../../core/Logger ../../../core/promiseUtils ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/gl-matrix ./cameraUtilsPlanar ./cameraUtilsSpherical ./earthUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Camera".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A){function z(a){return"global"===a.viewingMode?r:p}function x(b,d,c){var f=b.renderSpatialReference,k=q.vec3d.set(d.viewForward,P),k=G(b,d.eye,k,d.up,R);b=b.spatialReference||h.WGS84;v.vectorToVector(d.eye,f,J,b)||(b=h.WGS84,v.vectorToVector(d.eye,f,J,b));return c?(c.position.x=J[0],c.position.y=J[1],c.position.z=J[2],c.position.spatialReference=b,c.heading=k.heading,c.tilt=k.tilt,c.fov=t.rad2deg(d.fov),c):new a(new e(J,b),k.heading,k.tilt,t.rad2deg(d.fov))}
function B(a,b,d){var e=a.state.camera,c=e.fovX,e=e.width/2;"global"===a.viewingMode&&null!=d&&(b*=Math.cos(t.deg2rad(d)));b/=a.renderCoordsHelper.unitInMeters;return e/(39.37*f.screenDPI/b)/Math.tan(c/2)}function D(a,b,d){var e=a.state.camera;b=39.37*f.screenDPI/(e.width/2/(b*Math.tan(e.fovX/2)));"global"===a.viewingMode&&(b/=Math.cos(t.deg2rad(d)));return b*=a.renderCoordsHelper.unitInMeters}function C(a,b,d,e,c,h){if(V(h)){var f=l.createResolver();N(a,e.heading,e.tilt,b,d,c,f);f.promise.then(function(b){return h.resolve(T(a,
b,e.fov))})}else return f={center:[],eye:[],up:[],tilt:0,heading:0},N(a,e.heading,e.tilt,b,d,c,f),T(a,f,e.fov,h)}function G(a,b,d,e,c){return z(a).directionToHeadingTilt(b,d,e,c)}function E(a,b,d){return a.basemapTerrain&&a.renderCoordsHelper.fromRenderCoords(b,Q,a.spatialReference)&&a.basemapTerrain.getElevation(Q)>Q.z-1}function F(a,b,d){return a.renderCoordsHelper.fromRenderCoords(b,Q,a.spatialReference)?a.elevationProvider.queryElevation(Q).then(function(a){return a>Q.z-10}):l.resolve(!1)}function I(a,
b){var d=q.vec3d.create();if(b&&b instanceof e){if(v.pointToVector(b,d,a.renderSpatialReference),null==b.z&&null!=a.basemapTerrain)return a.elevationProvider.queryElevation(b).then(function(b){null!=b&&a.renderCoordsHelper.setAltitude(b,d);return d})}else b?q.vec3d.set(b,d):q.vec3d.set(a.state.camera.center,d);return l.resolve(d)}function K(a,b){var d=q.vec3d.create();b&&b instanceof e?(v.pointToVector(b,d,a.renderSpatialReference),null==b.z&&null!=a.basemapTerrain&&(b=a.elevationProvider.getElevation(b),
null!=b&&a.renderCoordsHelper.setAltitude(b,d))):b?q.vec3d.set(b,d):q.vec3d.set(a.state.camera.center,d);return d}function N(a,b,d,c,h,f,k){var l=c&&c instanceof e?c:null;if(V(k))I(a,c).then(function(e){H(a,b,d,l,e,h,f,k)});else return c=K(a,c),H(a,b,d,l,c,h,f,k)}function H(a,b,d,e,c,f,k,l){e||(e=v.vectorToPoint(c,a.renderSpatialReference,a.spatialReference||h.WGS84));f=Math.max(f,a.state.constraints.minimumPoiDistance);var m=M(a,b,d,c,f,k),q=z(a).eyeForCenterWithHeadingTilt,p=q(c,f,m.heading,m.tilt);
if(k===S.ADJUST&&"global"===a.viewingMode&&0<d){var t=function(){var h=f,m=f,q=a.state.constraints.tilt(m),m=z(a).eyeTiltToLookAtTilt(c,m,d),m=Math.min(m,.5*Math.PI),q=q.min*(1-aa)+m*aa,h=z(a).lookAtTiltToEyeTilt(c,h,q);k=1>d-h?S.LOCKED:S.ADJUST;return H(a,b,h,e,c,f,k,l)};if(E(a,p.eye,p.tilt))return t();if(V(l)){F(a,p.eye,p.tilt).then(function(a){if(a)return t();l.resolve({eye:p.eye,up:p.up,center:c,heading:p.heading,tilt:p.tilt})});return}}m={center:[],eye:[],up:[],tilt:0,heading:0};l&&!V(l)&&(m=
l);m.eye=p.eye;m.up=p.up;m.center=c;m.heading=p.heading;m.tilt=p.tilt;V(l)&&l.resolve(m);return m}function M(a,b,d,e,c,f){var k=0;if(f=f===S.ADJUST)if(k=a.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(c/k)/Math.LN2)f=!0;else{var l=a.renderSpatialReference,m=a.spatialReference||h.WGS84;f=v.vectorToPoint(e,l,m);l=v.vectorToPoint(a.state.camera.center,l,m);k*=Math.tan(.5*a.state.camera.fov);f=5<l.distance(f)/k}f?(b=0,f=a.state.constraints.tilt(c),f.max=Math.min(f.max,.5*Math.PI),f=f.min*
(1-aa)+f.max*aa,d=z(a).eyeTiltToLookAtTilt(e,c,d),k=Math.min(d,f)):k=z(a).eyeTiltToLookAtTilt(e,c,d);d=k=a.state.constraints.clampTilt(c,k);d=z(a).lookAtTiltToEyeTilt(e,c,d);return{heading:b,tilt:d}}function T(b,d,e,c){b=v.vectorToPoint(d.eye,b.renderSpatialReference,b.spatialReference||h.WGS84);return b?c?(c.position=b,c.heading=d.heading,c.tilt=d.tilt,c.fov=e,c):new a(b,d.heading,d.tilt,e):null}function V(a){return a&&a.resolve&&a.reject}Object.defineProperty(g,"__esModule",{value:!0});var U=b.getLogger("esri.views.3d.support.cameraUtils"),
J=q.vec3d.create(),O=q.vec3d.create(),P=q.vec3d.create(),R={heading:0,tilt:0},Q=new e,L=new t.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),S;(function(a){a[a.LOCKED=0]="LOCKED";a[a.ADJUST=1]="ADJUST"})(S=g.OrientationMode||(g.OrientationMode={}));g.headingTiltToDirectionUp=function(a,b,d,e,c){return z(a).headingTiltToDirectionUp(b,d,e,c)};g.externalToInternal=function(a,b){var e=a.renderSpatialReference,c=z(a).headingTiltToDirectionUp,h=q.vec3d.create();if(!v.pointToVector(b.position,h,e))return null;
e=c(h,b.heading,b.tilt);q.vec3d.add(e.direction,h);a=d.cameraOnContentAlongViewDirection(a,h,e.direction,e.up);a.fov=t.deg2rad(b.fov);return a};g.internalToExternal=x;g.scaleToDistance=B;g.distanceToScale=D;g.fromCenterScale=function(a,b,d,e,c,h){d=B(a,d,b.latitude);return C(a,b,d,e,c,h)};g.fromCenterDistance=C;g.directionToHeadingTilt=G;g.getObserverForPointAtDistance=N;g.fromExtent=function(a,b,d,c,f,m){var q,p=0;null!=b.zmax&&null!=b.zmin&&(q=(b.zmax+b.zmin)/2,p=b.zmax-b.zmin);var t,r;if("global"===
a.viewingMode){t=h.WebMercator;r=b.spatialReference||t;var g=new e(b.xmin,b.ymin,r),x=new e(b.xmax,b.ymax,r),g=k.project(g,t),x=k.project(x,t);if(null===g||null===x){V(m)&&m.reject();return}b=new e(L.center(g.x,x.x),(x.y+g.y)/2,t);null!=q&&(b.z=q);q=u.getGreatCircleSpanAt(b,g,x);t=q.lon;r=q.lat;L.diff(g.x,x.x)>L.range/2&&(t+=u.halfEarthCircumference);t=Math.min(t,u.halfEarthCircumference);r=Math.min(r,u.halfEarthCircumference)}else g=a.spatialReference||h.WGS84,k.canProject(b,g)&&(b=k.project(b,g)),
t=b.xmax-b.xmin,r=b.ymax-b.ymin,b=new e({x:b.xmin+.5*t,y:b.ymin+.5*r,z:q,spatialReference:g});q=a.state.camera;p=Math.max(1/Math.tan(q.fovX/2)*t*.5,1/Math.tan(q.fovY/2)*r*.5,1/Math.tan(q.fov/2)*p*.5)/1;if(V(m))q=l.createResolver(),N(a,d,c,b,p,f,q),q.promise.then(function(b){return m.resolve(T(a,b,a.camera.fov))});else return q={center:[],eye:[],up:[],tilt:0,heading:0},N(a,d,c,b,p,f,q),T(a,q,a.camera.fov,m)};g.toExtent=function(a,b,d,e,c){b||(d||(d=a.state.camera),b=x(a,d,c));c=a.renderSpatialReference;
var f;if(d)c=v.vectorToPoint(d.center,c,a.spatialReference||h.WGS84),f=d.distance;else{c=a.toMap(a.screenCenter);if(!c)return null;f=u.computeCarthesianDistance(b.position,c)}d||(d=a.state.camera);b=2*f*Math.tan(d.fovX/2)*1;d=2*f*Math.tan(d.fovY/2)*1;return"global"===a.viewingMode?r.toExtent(a,c,b,d,e):p.toExtent(a,c,b,d,e)};var aa=.7;g.observerToCamera=T;g.scaleToZoom=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.levelAtScale(b);U.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};
g.zoomToScale=function(a,b){if(a=a.basemapTerrain&&a.basemapTerrain.tilingScheme)return a.scaleAtLevel(b);U.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};g.scaleToResolution=function(a,b){return a.spatialReference?m.getResolutionForScale(b,a.spatialReference):void 0};g.computeScale=function(a,b,d){var e=a.renderSpatialReference;b||(b=a.state.camera);var c;c=h.WGS84;b instanceof A?(v.vectorToVector(b.center,e,O,c),c=O[1],b=b.distance):(c=b.position.latitude,v.pointToVector(b.position,
J,e),v.pointToVector(d,O,e),b=q.vec3d.dist(J,O));return D(a,b,c)}})},"esri/views/3d/support/cameraUtilsPlanar":function(){define("require exports ../../../geometry/Extent ../lib/gl-matrix ./cameraUtilsInternal ./mathUtils ./projectionUtils".split(" "),function(n,g,c,a,f,b,l){function e(d,e,c,l){void 0===l&&(l=f.createDirectionUp());a.mat4d.identity(k);d=l.direction;var q=l.up;a.mat4d.rotateZ(k,-b.deg2rad(e));a.mat4d.rotateX(k,b.deg2rad(c));a.mat4d.multiplyVec3(k,m,d);a.vec3d.scale(d,-1);a.mat4d.multiplyVec3(k,
h,q);return l}Object.defineProperty(g,"__esModule",{value:!0});var h=a.vec3d.createFrom(0,1,0),m=a.vec3d.createFrom(0,0,1),k=a.mat4d.create(),d=a.vec3d.create(),q=a.vec3d.create();g.headingTiltToDirectionUp=e;g.directionToHeadingTilt=function(a,b,d,e){return f.directionToHeadingTilt(b,d,e,m,h)};g.eyeForCenterWithHeadingTilt=function(b,d,c,h){var f=e(b,c,h);b=a.vec3d.add(a.vec3d.scale(f.direction,-d,a.vec3d.create()),b);return{up:f.up,eye:b,heading:c,tilt:h}};g.lookAtTiltToEyeTilt=function(a,d,e){return b.rad2deg(e)};
g.eyeTiltToLookAtTilt=function(a,d,e){return b.deg2rad(e)};g.toExtent=function(a,b,e,h,f){var k=a.renderSpatialReference;a=a.map&&a.spatialReference||b.spatialReference;l.pointToVector(b,d,k);l.pointToVector(b,q,k);d[0]-=e/2;q[0]+=e/2;d[1]-=h/2;q[1]+=h/2;l.vectorToVector(d,k,d,a);l.vectorToVector(q,k,q,a);f?(f.xmin=d[0],f.ymin=d[1],f.xmax=q[0],f.ymax=q[1],f.spatialReference=a):f=new c(d[0],d[1],q[0],q[1],a);return f}})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["require","exports",
"../lib/gl-matrix","./mathUtils"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});var f=c.vec3d.create(),b=c.vec3d.create();g.createDirectionUp=function(){return{direction:c.vec3d.create(),up:c.vec3d.create()}};g.directionToHeadingTilt=function(l,e,h,m,k){var d=f;c.vec3d.normalize(l,d);var q=c.vec3d.dot(d,m),p=0<q,q=Math.abs(q);.99<q&&(q=Math.abs(c.vec3d.dot(e,m)),.99>q?(c.vec3d.set(e,d),p&&c.vec3d.scale(d,-1)):d=null);e=0;d&&(c.vec3d.scale(m,c.vec3d.dot(m,d),b),c.vec3d.subtract(d,
b),e=c.vec3d.dot(d,k)/(c.vec3d.length(d)*c.vec3d.length(k)),c.vec3d.cross(d,k,b),e=(0<c.vec3d.dot(b,m)?1:-1)*a.rad2deg(a.acos(e)));l=a.rad2deg(a.acos(-c.vec3d.dot(m,l)/c.vec3d.length(l)));return h?(h.heading=e,h.tilt=l,h):{heading:e,tilt:l}}})},"esri/views/3d/support/cameraUtilsSpherical":function(){define("require exports ../../../geometry/Extent ../../../geometry/SpatialReference ../../../geometry/support/webMercatorUtils ../lib/gl-matrix ./cameraUtilsInternal ./earthUtils ./mathUtils".split(" "),
function(n,g,c,a,f,b,l,e,h){function m(a,d,e,c){void 0===c&&(c=l.createDirectionUp());b.vec3d.cross(a,q,t);0===b.vec3d.dot(t,t)&&b.vec3d.cross(a,p,t);b.mat4d.identity(u);b.mat4d.rotate(u,-h.deg2rad(d),a);b.mat4d.rotate(u,-h.deg2rad(e),t);d=c.up;e=c.direction;b.vec3d.cross(t,a,d);b.vec3d.normalize(d);b.mat4d.multiplyVec3(u,d);b.vec3d.normalize(a,e);b.mat4d.multiplyVec3(u,b.vec3d.negate(e));return c}function k(a){var b=a[1];a[1]=-a[2];a[2]=b}function d(a,b){b=m(b,a.heading,a.tilt);a.up=b.up;return a}
Object.defineProperty(g,"__esModule",{value:!0});var q=b.vec3d.createFrom(0,0,1),p=b.vec3d.normalize(b.vec3d.createFrom(1,1,1)),r=new h.Cyclical(-180,180),u=b.mat4d.create(),t=b.vec3d.create(),v=b.vec3d.create();g.headingTiltToDirectionUp=m;g.directionToHeadingTilt=function(a,d,e,c){var h=t;b.vec3d.normalize(a,h);b.vec3d.cross(h,q,v);0===b.vec3d.dot(v,v)&&b.vec3d.cross(h,p,v);b.vec3d.cross(v,h,v);return l.directionToHeadingTilt(d,e,c,h,v)};g.eyeForCenterWithHeadingTilt=function(a,e,c,f){var l={eye:b.vec3d.create(),
up:null,tilt:f,heading:c},m=t;m[0]=a[0];m[1]=a[2];m[2]=-a[1];c=h.deg2rad(c);var q=h.deg2rad(f);f=Math.sin(c);c=Math.cos(c);var p=Math.sin(q),u=Math.cos(q),r=b.vec3d.length(m);if(1E-8>Math.abs(q))q=e+r;else var g=r/p,x=h.asin(e/g),q=g*Math.sin(Math.PI-q-x);var g=p*e,u=u*e,x=c*g,B=q-u,v=B*B,z=e*e*p*p,p=c*c*z,z=f*f*z,A=m[1]*B,n=p*(p+v-m[1]*m[1]);if(0>n)return b.vec3d.scale(m,q/r,l.eye),l.tilt=0,l;var J=Math.sqrt(n),n=p+v,A=0<c?-J+A:J+A;if(1E-8>Math.abs(n))return 1E-8>r?(l.eye[0]=0,l.eye[1]=0,l.eye[2]=
e):b.vec3d.scale(m,q/r,l.eye),l.tilt=0,k(l.eye),d(l,a);l.eye[1]=A/n;n=l.eye[1]*l.eye[1];e=1-n;A=Math.sqrt(e);x=p*n+z-2*x*l.eye[1]*A*B+e*v;if(1E-8>Math.abs(x))return b.vec3d.scale(m,q/r,l.eye),l.tilt=0,k(l.eye),d(l,a);l.eye[0]=(e*(q*m[0]-u*m[0])-g*A*(m[0]*l.eye[1]*c+m[2]*f))/x;l.eye[2]=(e*(q*m[2]-u*m[2])-g*A*(m[2]*l.eye[1]*c-m[0]*f))/x;b.vec3d.scale(l.eye,q);k(l.eye);return d(l,a)};g.lookAtTiltToEyeTilt=function(a,d,e){a=b.vec3d.length(a);d=h.asin(d/(Math.sqrt(d*d+a*a-2*d*a*Math.cos(Math.PI-e))/Math.sin(e)));
return h.rad2deg(e-d)};g.eyeTiltToLookAtTilt=function(a,d,e){e=h.deg2rad(e);a=b.vec3d.length(a);return h.asin(d/(a/Math.sin(e)))+e};g.toExtent=function(b,d,k,l,m){function q(a){var b=Math.PI/2;a=h.cyclical2PI.normalize(a,-b);a>b&&(a=Math.PI-a);return a}var p;p=d.latitude;d=d.longitude;var t=e.getLonDeltaForDistance(d,p,k)/2;k=d-t;d+=t;p=h.deg2rad(p);t=e.earthRadius;p=(1+Math.sin(p))/(1-Math.sin(p));var u=(p+1)*Math.tan(l/t/2);p=1.5*Math.PI-2*Math.atan(.5*(u+Math.sqrt(4*p+u*u)));l=p+l/t;p=q(p);l=q(l);
l<p&&(t=l,l=p,p=t);p=Math.max(h.rad2deg(p),-90);l=Math.min(h.rad2deg(l),90);d=r.monotonic(k,d);180<d-k&&(t=(d-k-180)/2,k+=t,d-=t);m?(m.xmin=k,m.ymin=p,m.xmax=d,m.ymax=l,m.spatialReference=a.WGS84):m=new c(k,p,d,l,a.WGS84);b.spatialReference&&b.spatialReference.isWebMercator&&f.geographicToWebMercator(m,!1,m);return m}})},"esri/views/navigation/gamepadUtils":function(){define(["require","exports","../3d/lib/gl-matrix"],function(n,g,c){function a(a){var b=a*a;0>a&&(b*=-1);return b}Object.defineProperty(g,
"__esModule",{value:!0});g.quadraticAccentuation=a;g.resetTransformation=function(a){a.translation[0]=0;a.translation[1]=0;a.translation[2]=0;a.heading=0;a.tilt=0;return a};g.extractTransformation=function(f,b,l){var e=f.state;f=f.device;b="forward-down"===b.tiltDirection?1:-1;"standard"===f.deviceType?(l.translation[0]=a(e.axes[0]),l.translation[1]=a(e.axes[1]),l.translation[2]=a(e.buttons[7])-a(e.buttons[6]),l.heading=a(e.axes[2]),l.tilt=a(e.axes[3])):"spacemouse"===f.deviceType&&(l.translation[0]=
1.2*a(e.axes[0]),l.translation[1]=1.2*a(e.axes[1]),l.translation[2]=2*-a(e.axes[2]),l.heading=1.2*a(e.axes[5]),l.tilt=1.2*a(e.axes[3]));l.tilt*=b;c.vec3d.scale(l.translation,1);return l};g.isZeroTransformation=function(a){return 0===a.translation[0]&&0===a.translation[1]&&0===a.translation[2]&&0===a.heading&&0===a.tilt}})},"esri/views/3d/input/handlers/KeyPan":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/global/PanContinuousController",
"../../../input/InputHandler"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function f(e,c,f){var h,d=b.call(this,!0)||this;d.view=e;d.keyToDirection=(h={},h[c.left]=a.Direction.LEFT,h[c.right]=a.Direction.RIGHT,h[c.forward]=a.Direction.FORWARD,h[c.backward]=a.Direction.BACKWARD,h[c.up]=a.Direction.UP,h[c.down]=a.Direction.DOWN,h);e.state.isGlobal&&(d.registerIncoming("key-down",f,function(a){return d.handleKeyDown(a)}),d.registerIncoming("key-up",f,function(a){return d.handleKeyUp(a)}));
return d}c(f,b);f.prototype.handleKeyDown=function(b){if(!b.data.repeat){var e=this.keyToDirection[b.data.key];null!=e&&(this.cameraController&&this.cameraController.active||(this.cameraController=new a.PanContinuousController(this.view),this.view.state.switchCameraController(this.cameraController)),this.cameraController.active&&this.handleKey(b,e,!0))}};f.prototype.handleKeyUp=function(a){var b=this.keyToDirection[a.data.key];null!=b&&this.cameraController&&this.cameraController.active&&this.handleKey(a,
b,!1)};f.prototype.handleKey=function(a,b,c){c?this.cameraController.addDirection(b):this.cameraController.removeDirection(b);a.stopPropagation()};return f}(f.InputHandler);g.KeyPan=n})},"esri/views/3d/state/controllers/global/PanContinuousController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ../CameraController ../../../support/earthUtils ../../../support/mathUtils".split(" "),function(n,g,c,a,f,b,l,e){Object.defineProperty(g,
"__esModule",{value:!0});g.Direction={LEFT:1,RIGHT:2,FORWARD:4,BACKWARD:8,UP:16,DOWN:32};n=function(b){function h(a){var d=b.call(this)||this;d.view=a;d.directionStatus=0;d.direction=f.vec3d.create();d.tmpAxis=f.vec3d.create();d.radiusChange=0;d.velocity=0;d.tmpP1=f.vec3d.create();d.tmpTransf=f.mat4d.create();return d}c(h,b);Object.defineProperty(h.prototype,"isInteractive",{get:function(){return!0},enumerable:!0,configurable:!0});h.prototype.addDirection=function(a){0===this.directionStatus&&f.vec3d.set3(0,
0,0,this.direction);this.directionStatus&a||(this.directionStatus|=a,a&(g.Direction.LEFT|g.Direction.RIGHT|g.Direction.FORWARD|g.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),f.vec3d.add(this.direction,this.tmpAxis)):(a=this.directionStatus&(g.Direction.UP|g.Direction.DOWN),this.radiusChange=a===g.Direction.UP?1:a===g.Direction.DOWN?-1:0),this.velocity=this.computePanVelocity())};h.prototype.removeDirection=function(a){this.directionStatus&=~a;0===this.directionStatus&&this.active?this.finishController():
a&(g.Direction.LEFT|g.Direction.RIGHT|g.Direction.FORWARD|g.Direction.BACKWARD)?(this.computePanAxis(a,this.tmpAxis),f.vec3d.subtract(this.direction,this.tmpAxis),.01>f.vec3d.length(this.direction)&&f.vec3d.set3(0,0,0,this.direction)):(a=this.directionStatus&(g.Direction.UP|g.Direction.DOWN),this.radiusChange=a===g.Direction.UP?1:a===g.Direction.DOWN?-1:0)};h.prototype.stepController=function(e,d){b.prototype.stepController.call(this,e,d);e*=this.velocity;var c=!1;if(0<Math.abs(this.radiusChange)){var c=
1+e*this.radiusChange,h=d.viewForward,k=f.vec3d.normalize(d.center,this.tmpP1);(-.999<f.vec3d.dot(h,k)||0>this.radiusChange)&&f.vec3d.scale(d.center,c);f.vec3d.scale(d.eye,c);this.velocity=this.computePanVelocity();c=!0}.01<f.vec3d.length2(this.direction)&&(f.mat4d.identity(this.tmpTransf),f.mat4d.rotate(this.tmpTransf,e,this.direction),f.mat4d.multiplyVec3(this.tmpTransf,d.eye),f.mat4d.multiplyVec3(this.tmpTransf,d.center),f.mat4d.multiplyVec3(this.tmpTransf,d.up),c=!0);c&&a.applyAll(this.view,d,
{selection:14,interactionType:4,interactionStartCamera:this.view.state.camera,interactionFactor:null,interactionDirection:null,tiltMode:0})};h.prototype.computePanAxis=function(a,b){var d=this.view.state.camera;f.vec3d.subtract(d.center,d.eye,b);f.vec3d.cross(b,d.up);if(a===g.Direction.LEFT||a===g.Direction.RIGHT)f.vec3d.normalize(b),f.vec3d.cross(b,d.center);a!==g.Direction.RIGHT&&a!==g.Direction.FORWARD||f.vec3d.negate(b);f.vec3d.normalize(b)};h.prototype.computePanVelocity=function(){var a=.5*
Math.abs(f.vec3d.length(this.view.state.camera.eye)-l.earthRadius),a=e.clamp(a,1,2*l.earthRadius);return e.acos(1-a*a/(2*l.earthRadius*l.earthRadius))};return h}(b.CameraController);g.PanContinuousController=n})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,
"__esModule",{value:!0});n=function(b){function e(a,e){var c=b.call(this,!0)||this;c.view=a;c.registerIncoming("mouse-wheel",e,function(a){return c.handleMouseWheel(a)});return c}c(e,b);e.prototype.handleMouseWheel=function(b){var e=b.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new a.ZoomStepController(this.view,"interaction"):new f.ZoomStepController(this.view,"interaction"),this.view.state.switchCameraController(this.cameraController));
this.cameraController.zoomStep(-1/60*e.deltaY,[e.x,this.view.height-e.y]);b.stopPropagation()};return e}(b.InputHandler);g.MouseWheelZoom=n})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",
{value:!0});n=function(b){function e(a,e,d){var c=b.call(this,!0)||this;c.view=a;c.pointerAction=e;c.lastEndTimestamp=0;c.lastTimestamp=0;c.registerIncoming("drag",d,function(a){return c.handleDrag(a)});return c}c(e,b);e.prototype.handleDrag=function(a){if("mouse"!==a.data.pointerType||l.eventMatchesMousePointerAction(a.data,this.pointerAction)){var b=a.timestamp-this.lastEndTimestamp,b=this.momentum&&this.momentum.active&&40>b;switch(a.data.action){case "start":case "update":if(b)break;this.controller&&
this.controller.active?2<a.data.timestamp-this.lastTimestamp&&(this.controller.update(a.data),this.lastTimestamp=a.timestamp):this.startController(a);break;case "end":case "removed":this.endController(a,!0);break;case "added":this.endController(a,!1),this.startController(a)}a.stopPropagation()}};e.prototype.endController=function(a,b){this.controller&&this.controller.active&&(this.lastEndTimestamp=a.timestamp,a=this.controller.end(a.data),b&&a&&(this.momentum=a,this.view.state.switchCameraController(this.momentum)));
this.controller=null};e.prototype.startController=function(a){this.controller=this.createController();this.view.state.switchCameraController(this.controller);this.controller.begin(a.data);this.lastTimestamp=a.timestamp};e.prototype.createController=function(){return this.view.state.isGlobal?new a.PinchAndPanController(this.view,this.view.sceneIntersectionHelper):new f.PinchAndPanController(this.view,this.view.sceneIntersectionHelper)};return e}(b.InputHandler);g.PinchAndPanNavigation=n})},"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/gl-matrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A){Object.defineProperty(g,"__esModule",{value:!0});n=function(l){function g(a,d){var e=l.call(this)||this;e.view=a;e.intersectionHelper=d;e.smoothRotation=new f.ExponentialFalloff(.05);e.rotationAxis=b.vec3d.create();e.panningPlane={normal:b.vec3d.create(),d:0};e.smoothScaling=new f.ExponentialFalloff(.05);e.zoomCenterScreen=b.vec2d.create();e.zoomMomentumEstimator=new A.ZoomMomentumEstimator;e.rotationMomentumEstimator=new v.RotationMomentumEstimator;
e.panSphericalMomentumEstimator=new t.PanSphericalMomentumEstimator;e.panPlanarMomentumEstimator=new u.PanPlanarMomentumEstimator;e.adjustedSphere={center:b.vec3d.create(),radius:0};e.tmp2d=b.vec2d.create();e.tmp3d=b.vec3d.create();e.tmpMat=b.mat4d.create();e.beginScreenPoint=b.vec2d.create();e.beginScenePoint=b.vec3d.create();e.screenPickPoint=b.vec2d.create();e.panMode=p.PanMode.Horizontal;e.tmpInteractionDirection=b.vec3d.create();e.constraintOptions={selection:15,interactionType:0,interactionFactor:0,
interactionStartCamera:new r,interactionDirection:null,tiltMode:0};return e}c(g,l);g.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.smoothRotation.reset();q.navPointToScreenPoint(this.currentCamera,a.center,this.screenPickPoint);b.vec2d.set(this.screenPickPoint,this.beginScreenPoint);var d=q.pickPointAndInitSphere(this.intersectionHelper,this.beginCamera,this.screenPickPoint,!0);this.scenePickPoint=d.scenePickPoint;
this.sphere=d.sphere;b.vec3d.set(this.scenePickPoint,this.beginScenePoint);this.panMode=q.decidePanMode(this.beginCamera,this.sphere,this.scenePickPoint);this.panMode===p.PanMode.Vertical&&(this.beginCamera.aboveGround?this.preparePlanarPanModeOverground(a):this.preparePlanarPanMode(a));this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};g.prototype.preparePlanarPanModeOverground=function(a){b.vec3d.set(this.beginCamera.viewForward,this.panningPlane.normal);b.vec3d.normalize(this.panningPlane.normal);
b.vec3d.negate(this.panningPlane.normal);q.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);var d=b.vec3d.create();b.vec3d.set3(this.screenPickPoint[0],this.currentCamera.fullHeight,0,d);var e=b.vec3d.create(),c=b.vec3d.length(this.beginCamera.eye);this.adjustedSphere.radius=c<this.sphere.radius?c-100:this.sphere.radius;q.sphereOrSilhouettePointFromScreenPoint(this.adjustedSphere,this.beginCamera,d,e);this.beginCamera.projectPoint(e,d);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],
.9*d[1]);this.intersectionHelper.pickPointInScreen(this.screenPickPoint,this.scenePickPoint)&&q.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);q.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);q.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,this.tmp2d,this.beginScenePoint)};g.prototype.preparePlanarPanMode=function(a){b.vec3d.set(this.beginCamera.viewForward,this.panningPlane.normal);b.vec3d.normalize(this.panningPlane.normal);b.vec3d.negate(this.panningPlane.normal);
q.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);var d=q.computeHorizonSphereCapAngle(this.sphere,this.currentCamera.eye),e=this.tmp3d,d=-q.rotationAndAxisFromPoints(this.currentCamera.eye,this.scenePickPoint,e)-(this.currentCamera.aboveGround?.25:.025)*d;if(0<d){var c=b.mat4d.identity(this.tmpMat);b.mat4d.rotate(c,-d,e);b.vec3d.subtract(this.scenePickPoint,this.sphere.center);b.mat4d.multiplyVec3(c,this.scenePickPoint,this.scenePickPoint);b.vec3d.add(this.scenePickPoint,
this.sphere.center);q.setPlane(this.scenePickPoint,this.panningPlane.normal,this.panningPlane);q.navPointToScreenPoint(this.currentCamera,a.center,this.tmp2d);q.intersectPlaneFromScreenPoint(this.panningPlane,this.beginCamera,this.tmp2d,this.beginScenePoint)}};g.prototype.update=function(a){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var b=1<a.pointers.size;this.panMode===p.PanMode.Horizontal?(b&&this.zoomSpherical(a),this.panningSpherical(a),b&&this.rotateSpherical(a)):(b&&this.zoomPlanar(a),
this.panningPlanar(a),b&&this.rotatePlanar(a));this.currentCamera.markViewDirty()}};g.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();if(a=this.zoomMomentumEstimator.evaluateMomentum())return this.panMode===p.PanMode.Horizontal?new d.ZoomSphericalMomentumController(this.view,a,this.zoomCenterScreen,this.beginScenePoint,this.sphere.radius):new k.ZoomPlanarMomentumController(this.view,a,this.beginScenePoint);if(a=this.rotationMomentumEstimator.evaluateMomentum())return new m.RotationMomentumController(this.view,
a,this.sphere.center,this.rotationAxis);if(this.panMode===p.PanMode.Horizontal){if(a=this.panSphericalMomentumEstimator.evaluateMomentum())return new h.PanSphericalMomentumController(this.view,a)}else if(a=this.panPlanarMomentumEstimator.evaluateMomentum())return new e.PanPlanarMomentumController(this.view,a);return null};g.prototype.zoomSpherical=function(b){var d=this.beginRadius/b.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(b.radius,40),120);this.smoothScaling.update(d);q.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);q.navPointToScreenPoint(this.currentCamera,b.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*b.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(b.radius-this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};g.prototype.panningSpherical=function(b){q.navPointToScreenPoint(this.currentCamera,b.center,this.tmp2d);
q.sphereOrSilhouettePointFromScreenPoint(this.sphere,this.currentCamera,this.tmp2d,this.tmp3d);q.applyPanSpherical(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d);this.panSphericalMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*b.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.screenPickPoint,this.tmp2d);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};g.prototype.rotateSpherical=
function(d){b.vec3d.normalize(this.scenePickPoint,this.rotationAxis);var e=this.smoothRotation.value,c=q.normalizeRotationDelta(d.angle-e),e=e+c;this.smoothRotation.gain=.00125*Math.min(Math.max(d.radius,40),120);this.smoothRotation.update(e);c=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(c,.001*d.timestamp);q.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,c);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(d.radius*
e);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};g.prototype.panningPlanar=function(b){q.navPointToScreenPoint(this.currentCamera,b.center,this.tmp2d);q.intersectPlaneFromScreenPoint(this.panningPlane,this.currentCamera,this.tmp2d,this.tmp3d)&&(q.applyPanPlanar(this.currentCamera,this.beginScenePoint,this.tmp3d),this.panPlanarMomentumEstimator.add(this.tmp2d,this.tmp3d,.001*b.timestamp),this.constraintOptions.interactionType=4,this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.beginScreenPoint,
this.tmp2d),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),a.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};g.prototype.zoomPlanar=function(b){var d=this.beginRadius/b.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(b.radius,40),120);this.smoothScaling.update(d);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*b.timestamp);
q.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(b.radius-this.beginRadius);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};g.prototype.rotatePlanar=function(d){b.vec3d.set(this.beginScenePoint,this.rotationAxis);var e=this.smoothRotation.value,c=d.angle-e,c=q.normalizeRotationDelta(c);
this.smoothRotation.gain=.00125*Math.min(Math.max(d.radius,40),120);this.smoothRotation.update(e+c);e=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(e,.001*d.timestamp);q.applyRotation(this.currentCamera,this.sphere.center,this.rotationAxis,e);this.constraintOptions.interactionType=2;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(d.radius*e);a.applyAll(this.view,this.currentCamera,this.constraintOptions)};return g}(l.InteractiveController);
g.PinchAndPanController=n})},"esri/views/3d/input/util":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a){this._gain=a}c.prototype.reset=function(a){this._value=a};Object.defineProperty(c.prototype,"gain",{set:function(a){this._gain=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"value",{get:function(){return void 0===this._value?0:this._value},enumerable:!0,configurable:!0});c.prototype.update=function(a){this._value=
void 0===this._value?a:this._gain*a+(1-this._gain)*this._value};return c}();g.ExponentialFalloff=n})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../lib/gl-matrix","./MomentumController"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function f(e,c){e=b.call(this,e,4)||this;e.momentum=c;e.tmpPan=a.vec3d.create();return e}c(f,b);f.prototype.momentumStep=
function(b,c){b=this.momentum.value(b);a.vec3d.scale(this.momentum.direction,b,this.tmpPan);a.vec3d.subtract(c.eye,this.tmpPan);a.vec3d.subtract(c.center,this.tmpPan);c.markViewDirty();this.constraintOptions.interactionDirection=this.tmpPan};return f}(f.MomentumController);g.PanPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function e(a,e){e=f.call(this)||this;e.view=a;e.beginCamera=new b;e.elapsedTimeSec=0;e.constraintOptions={selection:15,interactionType:4,interactionFactor:0,interactionStartCamera:new b,interactionDirection:null,tiltMode:0};return e}c(e,f);Object.defineProperty(e.prototype,"steppingFinished",{get:function(){return this.momentum.isFinished(this.elapsedTimeSec)},enumerable:!0,configurable:!0});e.prototype.onControllerStart=
function(a){this.beginCamera.copyFrom(a);this.constraintOptions.interactionStartCamera=this.beginCamera;f.prototype.onControllerStart.call(this,a)};e.prototype.stepController=function(b,e){e.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=b;this.momentumStep(this.elapsedTimeSec,e);a.applyAll(this.view,e,this.constraintOptions)};return e}(f.AnimationController);g.MomentumController=n})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define(["require","exports",
"../../../../../core/tsSupport/extendsHelper","./MomentumController","../../utils/navigationUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b=[0,0,0];n=function(a){function e(b,e){b=a.call(this,b,4)||this;b.momentum=e;return b}c(e,a);e.prototype.momentumStep=function(a,e){a=this.momentum.value(a);f.applyRotation(e,b,this.momentum.axis,a)};return e}(a.MomentumController);g.PanSphericalMomentumController=n})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function e(b,e,c,d){b=f.call(this,b,2)||this;b.momentum=e;b.axis=a.vec3d.create();b.center=a.vec3d.create();a.vec3d.set(d,b.axis);a.vec3d.set(c,b.center);return b}c(e,f);e.prototype.momentumStep=function(a,e){a=this.momentum.value(a);b.applyRotation(e,this.center,this.axis,a)};return e}(f.MomentumController);g.RotationMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ./MomentumController ../../utils/navigationUtils".split(" "),
function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function e(b,e,c){b=f.call(this,b,1)||this;b.momentum=e;b.zoomCenter=a.vec3d.create();a.vec3d.set(c,b.zoomCenter);b.constraintOptions.interactionDirection=a.vec3d.create();return b}c(e,f);e.prototype.momentumStep=function(e,c){a.vec3d.set(c.eye,this.constraintOptions.interactionDirection);e=this.momentum.valueDelta(0,e);b.applyZoomToPoint(c,this.zoomCenter,e,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=
a.vec3d.direction(this.constraintOptions.interactionDirection,c.eye)};return e}(f.MomentumController);g.ZoomPlanarMomentumController=n})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../lib/gl-matrix ./MomentumController ../../utils/navigationUtils".split(" "),function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function e(a,
e,d,c,h){a=b.call(this,a,1)||this;a.momentum=e;a.screenCenter=f.vec2d.create();a.sceneCenter=f.vec3d.create();a.tmpSceneCenter=f.vec3d.create();a.tmpZoomAxis=f.vec3d.create();a.sphere={center:f.vec3d.create(),radius:0};f.vec2d.set(d,a.screenCenter);f.vec3d.set(c,a.sceneCenter);a.sphere.radius=h;return a}c(e,b);e.prototype.momentumStep=function(b,e){b=this.momentum.valueDelta(0,b);l.applyZoomOnSphere(this.sphere,e,b);this.constraintOptions.interactionType=1;a.applyAll(this.view,e,this.constraintOptions);
l.sphereOrSilhouettePointFromScreenPoint(this.sphere,e,this.screenCenter,this.tmpSceneCenter);b=l.rotationAndAxisFromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxis);l.applyRotation(e,this.sphere.center,this.tmpZoomAxis,b);this.constraintOptions.interactionType=4};return e}(b.MomentumController);g.ZoomSphericalMomentumController=n})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/gl-matrix ./FilteredFiniteDifference ./Momentum".split(" "),
function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});var l=function(a){function b(b,e,d,c,h){b=a.call(this,b,e,d)||this;b.sceneVelocity=c;b.direction=h;return b}c(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,b)};return b}(b.Momentum);g.PanPlanarMomentum=l;n=function(){function b(b,e,c){void 0===b&&(b=300);void 0===e&&(e=12);void 0===c&&(c=.84);this.minimumInitialVelocity=b;this.stopVelocity=e;this.friction=c;this.time=
new f.FilteredFiniteDifference(.6);this.screen=[new f.FilteredFiniteDifference(.4),new f.FilteredFiniteDifference(.4)];this.scene=[new f.FilteredFiniteDifference(.6),new f.FilteredFiniteDifference(.6),new f.FilteredFiniteDifference(.6)];this.tmpDirection=a.vec3d.create()}b.prototype.add=function(a,b,e){this.time.hasLastValue&&.015>this.time.computeDelta(e)||(this.screen[0].update(a[0]),this.screen[1].update(a[1]),this.scene[0].update(b[0]),this.scene[1].update(b[1]),this.scene[2].update(b[2]),this.time.update(e))};
b.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();this.time.reset()};b.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};b.prototype.createMomentum=function(b,
e,c){a.vec3d.set3(this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta,this.tmpDirection);var d=a.vec3d.length(this.tmpDirection);0<d&&a.vec3d.scale(this.tmpDirection,1/d);return new l(b,e,c,d/this.time.filteredDelta,this.tmpDirection)};return b}();g.PanPlanarMomentumEstimator=n})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a){this.gain=
a}c.prototype.update=function(a){if(this.hasLastValue){var c=this.computeDelta(a);this.updateDelta(c)}this.lastValue=a};c.prototype.reset=function(){this.filteredDelta=this.lastValue=void 0};Object.defineProperty(c.prototype,"hasLastValue",{get:function(){return void 0!==this.lastValue},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"hasFilteredDelta",{get:function(){return void 0!==this.filteredDelta},enumerable:!0,configurable:!0});c.prototype.computeDelta=function(a){return a-
this.lastValue};c.prototype.updateDelta=function(a){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*a:a};return c}();g.FilteredFiniteDifference=n})},"esri/views/navigation/Momentum":function(){define(["require","exports","../../core/tsSupport/extendsHelper"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a,b,c){this._initialVelocity=a;this._stopVelocity=b;this._friction=c;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/
this._stopVelocity)/Math.log(1-this._friction))}Object.defineProperty(a.prototype,"duration",{get:function(){return this._duration},enumerable:!0,configurable:!0});a.prototype.isFinished=function(a){return a>this.duration};Object.defineProperty(a.prototype,"friction",{get:function(){return this._friction},enumerable:!0,configurable:!0});a.prototype.value=function(a){return this.valueFromInitialVelocity(this._initialVelocity,a)};a.prototype.valueDelta=function(a,b){var c=this.value(a);return this.value(a+
b)-c};a.prototype.valueFromInitialVelocity=function(a,b){b=Math.min(b,this.duration);var c=1-this.friction;return a*(Math.pow(c,b)-1)/Math.log(c)};return a}();g.Momentum=n})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/lib/gl-matrix ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});var h=function(a){function b(b,
e,c,h,f){b=a.call(this,b,e,c)||this;b.angularVelocity=h;b.axis=f;return b}c(b,a);b.prototype.value=function(b){return a.prototype.valueFromInitialVelocity.call(this,this.angularVelocity,b)};return b}(e.Momentum);g.PanSphericalMomentum=h;n=function(){function e(e,d,c){void 0===e&&(e=300);void 0===d&&(d=12);void 0===c&&(c=.84);this.minimumInitialVelocity=e;this.stopVelocity=d;this.friction=c;this.tmpAxis=a.vec3d.create();this.time=new b.FilteredFiniteDifference(.3);this.screen=[new b.FilteredFiniteDifference(.4),
new b.FilteredFiniteDifference(.4)];this.angle=new l.FilteredValue(.6);this.axis=a.vec3d.create();this.lastScene=a.vec3d.create()}e.prototype.add=function(b,d,e){if(this.time.hasLastValue){if(.01>this.time.computeDelta(e))return;var c=f.rotationAndAxisFromPoints(this.lastScene,d,this.tmpAxis);1E-5>a.vec3d.length2(this.tmpAxis)?c=0:a.vec3d.normalize(this.tmpAxis,this.axis);this.angle.update(c);a.vec3d.set(d,this.lastScene)}this.screen[0].update(b[0]);this.screen[1].update(b[1]);this.time.update(e)};
e.prototype.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle.reset();this.time.reset()};e.prototype.evaluateMomentum=function(){if(!this.screen[0].hasFilteredDelta)return null;var a=this.screen[0].filteredDelta,b=this.screen[1].filteredDelta,a=Math.sqrt(a*a+b*b)/this.time.filteredDelta;return Math.abs(a)<this.minimumInitialVelocity?null:this.createMomentum(a,this.stopVelocity,this.friction)};e.prototype.createMomentum=function(a,b,e){return new h(a,b,e,this.angle.filteredValue/
this.time.filteredDelta,this.axis)};return e}();g.PanSphericalMomentumEstimator=n})},"esri/views/navigation/FilteredValue":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a){this.gain=a}c.prototype.update=function(a){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*a:a};c.prototype.reset=function(){this.filteredValue=void 0};Object.defineProperty(c.prototype,"hasFilteredValue",{get:function(){return void 0!==
this.filteredValue},enumerable:!0,configurable:!0});return c}();g.FilteredValue=n})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["require","exports","../../core/tsSupport/extendsHelper","./MomentumEstimator"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(a){function b(b,e,c,f){void 0===b&&(b=3);void 0===e&&(e=.01);void 0===c&&(c=.95);void 0===f&&(f=12);return a.call(this,b,e,c,f)||this}c(b,a);b.prototype.add=function(b,e){if(this.value.hasLastValue){var c=
this.value.lastValue;for(b-=c;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=c+b}a.prototype.add.call(this,b,e)};return b}(a.MomentumEstimator);g.RotationMomentumEstimator=n})},"esri/views/navigation/MomentumEstimator":function(){define("require exports ../../core/tsSupport/extendsHelper ../3d/support/mathUtils ./FilteredFiniteDifference ./Momentum".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a,b,c,k){void 0===a&&(a=2.5);void 0===
b&&(b=.01);void 0===c&&(c=.95);void 0===k&&(k=12);this.minimumInitialVelocity=a;this.stopVelocity=b;this.friction=c;this.maxVelocity=k;this.value=new f.FilteredFiniteDifference(.8);this.time=new f.FilteredFiniteDifference(.3)}c.prototype.add=function(a,b){if(this.time.hasLastValue){if(.01>this.time.computeDelta(b))return;if(this.value.hasFilteredDelta){var e=this.value.computeDelta(a);0>this.value.filteredDelta*e&&this.value.reset()}}this.time.update(b);this.value.update(a)};c.prototype.reset=function(){this.value.reset();
this.time.reset()};c.prototype.evaluateMomentum=function(){if(!this.value.hasFilteredDelta)return null;var b=this.value.filteredDelta/this.time.filteredDelta,b=a.clamp(b,-this.maxVelocity,this.maxVelocity);return Math.abs(b)<this.minimumInitialVelocity?null:this.createMomentum(b,this.stopVelocity,this.friction)};c.prototype.createMomentum=function(a,c,f){return new b.Momentum(a,c,f)};return c}();g.MomentumEstimator=n})},"esri/views/navigation/ZoomMomentumEstimator":function(){define(["require","exports",
"../../core/tsSupport/extendsHelper","./Momentum","./MomentumEstimator"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b=function(a){function b(b,e,c){return a.call(this,b,e,c)||this}c(b,a);b.prototype.value=function(b){b=a.prototype.value.call(this,b);return Math.exp(b)};b.prototype.valueDelta=function(b,e){var c=a.prototype.value.call(this,b);b=a.prototype.value.call(this,b+e);return Math.exp(b-c)};return b}(a.Momentum);g.ZoomMomentum=b;n=function(a){function e(b,e,c,
d){void 0===b&&(b=2.5);void 0===e&&(e=.01);void 0===c&&(c=.95);void 0===d&&(d=12);return a.call(this,b,e,c,d)||this}c(e,a);e.prototype.add=function(b,e){a.prototype.add.call(this,Math.log(b),e)};e.prototype.createMomentum=function(a,e,c){return new b(a,e,c)};return e}(f.MomentumEstimator);g.ZoomMomentumEstimator=n})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../camera/constraintUtils ../../../input/util ../../../lib/gl-matrix ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){Object.defineProperty(g,"__esModule",{value:!0});var u;(function(a){a[a.Vertical=0]="Vertical";a[a.Horizontal=1]="Horizontal"})(u=g.PanMode||(g.PanMode={}));var t=b.vec3d.createFrom(0,0,1),v=16/180*Math.PI;n=function(l){function g(a,e){var c=l.call(this)||this;c.view=a;c.intersectionHelper=e;c.rotationValueSmooth=new f.ExponentialFalloff(.05);c.scalingValueSmooth=new f.ExponentialFalloff(.05);c.planeHorizontal={normal:b.vec3d.create(),d:0};c.planeVertical={normal:b.vec3d.create(),
d:0};c.rotationMomentumEstimator=new p.RotationMomentumEstimator;c.panMomentumEstimator=new q.PanPlanarMomentumEstimator(300,12,.9);c.zoomMomentumEstimator=new r.ZoomMomentumEstimator;c.beginCenter=b.vec3d.create();c.tmpPoints=[];c.beginCenterScreen=b.vec2d.create();c.tmpCentroid3d=b.vec3d.create();c.tmpCentroid2d=b.vec2d.create();c.tmp2d=b.vec2d.create();c.constraintOptions={selection:15,interactionType:0,interactionFactor:0,interactionStartCamera:new d,interactionDirection:null,tiltMode:0};return c}
c(g,l);g.prototype.begin=function(a){if(this.active){this.beginRadius=a.radius;this.pointerCount=a.pointers.size;this.beginAngle=a.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();k.navPointToScreenPoint(this.beginCamera,a.center,this.beginCenterScreen);this.planeHorizontal.d=0;b.vec3d.set(t,this.planeHorizontal.normal);var d=b.vec3d.create();this.intersectionHelper.pickPointInScreen(this.beginCenterScreen,d)||this.intersectionHelper.pickFreePointInScreen(this.beginCenterScreen,
d);var e=b.vec3d.create();b.vec3d.negate(this.beginCamera.viewForward,e);var c=b.vec3d.create();b.vec3d.set(t,c);var h=b.vec3d.dot(e,c);this.panMode=Math.asin(0>h?-h:h)>=v?u.Horizontal:u.Vertical;k.setPlaneD(d,this.planeHorizontal);0>b.vec3d.dot(this.planeHorizontal.normal,this.beginCamera.eye)+this.planeHorizontal.d&&(b.vec3d.negate(this.planeHorizontal.normal),this.planeHorizontal.d*=-1);this.panMode===u.Vertical?(b.vec3d.scale(c,h),b.vec3d.subtract(e,c,this.planeVertical.normal),b.vec3d.normalize(this.planeVertical.normal),
k.setPlaneD(d,this.planeVertical),this.computePlanePoints(a.pointers,this.planeVertical,this.beginCamera,this.tmpPoints)):this.computePlanePoints(a.pointers,this.planeHorizontal,this.beginCamera,this.tmpPoints);k.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.beginCamera)}};g.prototype.update=function(b){if(this.active){this.currentCamera.copyFrom(this.beginCamera);var d=1<b.pointers.size,e=this.panMode===u.Horizontal?this.planeHorizontal:this.planeVertical,
c=this.beginCenter;if(d){var h=this.beginRadius/b.radius,f=.001875*Math.min(Math.max(b.radius,40),120);this.scalingValueSmooth.gain=f;this.scalingValueSmooth.update(h);k.applyZoomToPoint(this.currentCamera,c,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*b.timestamp);this.constraintOptions.interactionType=1;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(Math.abs(b.radius-this.beginRadius));
a.applyAll(this.view,this.currentCamera,this.constraintOptions)}this.computePlanePoints(b.pointers,e,this.currentCamera,this.tmpPoints);k.centroid(this.tmpPoints,this.tmpCentroid3d);k.navPointToScreenPoint(this.currentCamera,b.center,this.tmpCentroid2d);k.applyPanPlanar(this.currentCamera,c,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*b.timestamp);this.constraintOptions.interactionType=4;this.constraintOptions.interactionFactor=a.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);a.applyAll(this.view,this.currentCamera,this.constraintOptions);d&&(d=this.planeHorizontal.normal,e=this.rotationValueSmooth.value,h=k.normalizeRotationDelta(b.angle-e),f=.00125*Math.min(Math.max(b.radius,40),120),this.rotationValueSmooth.gain=f,this.rotationValueSmooth.update(e+h),f=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(f,.001*b.timestamp),k.applyRotation(this.currentCamera,c,d,f),this.constraintOptions.interactionType=2,this.constraintOptions.interactionFactor=
a.pixelDistanceToInteractionFactor(Math.abs(b.radius*f)),a.applyAll(this.view,this.currentCamera,this.constraintOptions));this.currentCamera.markViewDirty()}};g.prototype.end=function(a){a.pointers.size===this.pointerCount&&this.update(a);this.finishController();return(a=this.zoomMomentumEstimator.evaluateMomentum())?new m.ZoomPlanarMomentumController(this.view,a,this.beginCenter):(a=this.rotationMomentumEstimator.evaluateMomentum())?new h.RotationMomentumController(this.view,a,this.beginCenter,this.planeHorizontal.normal):
(a=this.panMomentumEstimator.evaluateMomentum())?new e.PanPlanarMomentumController(this.view,a):null};g.prototype.computePlanePoints=function(a,d,e,c){c.length=a.size;var h=this.tmp2d,f=0;a.forEach(function(a){k.navPointToScreenPoint(e,a,h);void 0===c[f]&&(c[f]=b.vec3d.create());k.intersectPlaneFromScreenPoint(d,e,h,c[f]);f+=1});return c};return g}(l.InteractiveController);g.PinchAndPanController=n})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["require","exports",
"../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(a){function b(b,e){var c=a.call(this,!0)||this;c.view=b;c.registerIncoming("pointer-down",e,function(a){return c.view.state.stopActiveCameraController()});return c}c(b,a);return b}(a.InputHandler);g.PointerDownCancelAnimation=n})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper",
"./SingleKey"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(a){function b(b,e,c){c=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetHeading",e,c)||this;c.view=b;c.key=e;return c}c(b,a);b.prototype.activate=function(){this.view.goTo({heading:0})};return b}(a.SingleKey);g.SingleKeyResetHeading=n})},"esri/views/3d/input/handlers/SingleKey":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../../input/InputHandler"],function(n,
g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(a){function b(b,e,c){var h=a.call(this,!0)||this;h.key=e;h.registerIncoming("key-down",c,function(a){return h._handleKeyDown(a)});return h}c(b,a);b.prototype._handleKeyDown=function(a){a.data.key===this.key&&(this.activate(),a.stopPropagation())};return b}(a.InputHandler);g.SingleKey=n})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./SingleKey"],
function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(a){function b(b,e,c){c=a.call(this,"esri.views.3d.input.handlers.SingleKeyResetTilt",e,c)||this;c.view=b;c.key=e;return c}c(b,a);b.prototype.activate=function(){this.view.goTo({tilt:0})};return b}(a.SingleKey);g.SingleKeyResetTilt=n})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../state/controllers/RotateController","../../../input/InputHandler"],
function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function f(a,c){void 0===c&&(c=!1);var e=b.call(this,!0)||this;e.view=a;e.invert=c;e.registerIncoming("vertical-two-finger-drag",function(a){return e.handleTwoFinger(a)});return e}c(f,b);f.prototype.handleTwoFinger=function(b){var c=[0,-b.data.delta*(this.invert?-1:1)];switch(b.data.action){case "begin":this.cameraController=new a.RotateController(this.view,this.view.sceneIntersectionHelper,"center");this.view.state.switchCameraController(this.cameraController);
this.cameraController.begin(c);break;case "update":this.cameraController.update(c);break;case "end":this.cameraController.end(),this.cameraController=null}};return f}(f.InputHandler);g.TwoFingerTilt=n})},"esri/views/input/BrowserEventSource":function(){define("require exports ../../core/has ../../core/libs/pep/pep ./keys ./gamepad/GamepadSource".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});var l=c("trident"),e=c("edge"),h=c("chrome"),m=c("ff"),k=c("safari");n=
function(){function c(d,c){var e=this;this.input=c;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._element=d;a.applyLocal(d);d.getAttribute("tabindex")||d.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,
"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._initialCssTouchAction=d.style.touchAction;d.style.touchAction="none";this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new b.GamepadSource(d,this.input);this._gamepadSource.onEvent=function(a){return e._callback("gamepad",a)}}c.prototype.destroy=function(){var a=this;this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(function(b){a._element.releasePointerCapture(b)});
this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._element.style.touchAction=this._initialCssTouchAction;this._element.removeEventListener("keydown",this._preventAltKeyDefault)};Object.defineProperty(c.prototype,"onEventReceived",{set:function(a){this._callback=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"activeEvents",{set:function(a){var b=this,c;for(c in this._active)a&&a.has(c)||(this._element.removeEventListener(d[c],
this._active[c]),delete this._active[c]);a&&a.forEach(function(a){if(!b._active[a]&&d[a]){var c=(b._eventHandlers[a]||b._handleDefault).bind(b,a);b._element.addEventListener(d[a],c);b._active[a]=c}});this._gamepadSource.pollingEnabled=a&&a.has("gamepad")},enumerable:!0,configurable:!0});c.prototype.setPointerCapture=function(a,b){b?(this._element.setPointerCapture(a.pointerId),this._activePointerCaptures.add(a.pointerId)):("pointerup"!==a.type&&this._element.releasePointerCapture(a.pointerId),this._activePointerCaptures.delete(a.pointerId))};
c.prototype._updateNormalizedPointerLikeEvent=function(a,b){var d=this._element.getBoundingClientRect();b.x=a.clientX-Math.round(d.left);b.y=a.clientY-Math.round(d.top);return b};c.prototype._handleKey=function(a,b){var d=f.eventKey(b);d&&"key-up"===a&&this._keyDownState.delete(d);b={native:b,key:d,repeat:d&&this._keyDownState.has(d)};d&&"key-down"===a&&this._keyDownState.add(b.key);this._callback(a,b)};c.prototype._handlePointer=function(a,b){b=this._updateNormalizedPointerLikeEvent(b,{native:b,
x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons});this._callback(a,b)};c.prototype._handlePointerPreventDefault=function(a,b){var d=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,pointerType:b.pointerType,button:b.button,buttons:b.buttons});b.preventDefault();this._callback(a,d)};c.prototype._handleMouseWheel=function(a,b){b.preventDefault();var d=b.deltaY;switch(b.deltaMode){case 0:if(l||e)d=d/document.documentElement.clientHeight*600;break;case 1:d*=30;break;case 2:d*=
900}l||e?d*=.7:h||k?d*=.6:m&&(d*=1.375);var c=Math.abs(d);100<c&&(d=d/c*200/(1+Math.exp(-.02*(c-100))));b=this._updateNormalizedPointerLikeEvent(b,{native:b,x:0,y:0,deltaY:d});this._callback(a,b)};c.prototype._handlePointerCaptureLost=function(a,b){this._activePointerCaptures.delete(b.pointerId);this._handleDefault(a,b)};c.prototype._handleDefault=function(a,b){var d={native:b};b.preventDefault();this._callback(a,d)};c.prototype._preventAltKeyDefault=function(a){"Alt"===a.key&&a.preventDefault()};
return c}();g.BrowserEventSource=n;var d={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel"}})},"esri/core/libs/pep/pep":function(){define(function(){function n(a,b){b=b||Object.create(null);var d=document.createEvent("Event");
d.initEvent(a,b.bubbles||!1,b.cancelable||!1);a=2;for(var c;a<m.length;a++)c=m[a],d[c]=b[c]||k[a];d.buttons=b.buttons||0;a=0;a=b.pressure?b.pressure:d.buttons?.5:0;d.x=d.clientX;d.y=d.clientY;d.pointerId=b.pointerId||0;d.width=b.width||0;d.height=b.height||0;d.pressure=a;d.tiltX=b.tiltX||0;d.tiltY=b.tiltY||0;d.pointerType=b.pointerType||"";d.hwTimestamp=b.hwTimestamp||0;d.isPrimary=b.isPrimary||!1;return d}function g(){this.array=[];this.size=0}function c(a,b,d,c){this.addCallback=a.bind(c);this.removeCallback=
b.bind(c);this.changedCallback=d.bind(c);D&&(this.observer=new D(this.mutationWatcher.bind(this)))}function a(a){return"body /shadow-deep/ "+f(a)}function f(a){return'[touch-action\x3d"'+a+'"]'}function b(a){return"{ -ms-touch-action: "+a+"; touch-action: "+a+"; touch-action-delay: none; }"}function l(){if(F){G.forEach(function(d){String(d)===d?(E+=f(d)+b(d)+"\n",I&&(E+=a(d)+b(d)+"\n")):(E+=d.selectors.map(f)+b(d.rule)+"\n",I&&(E+=d.selectors.map(a)+b(d.rule)+"\n"))});var d=document.createElement("style");
d.textContent=E;document.head.appendChild(d)}}function e(a){if(!t.pointermap.has(a))throw a=Error("InvalidPointerId"),a.name="InvalidPointerId",a;}function h(a){if(!a.ownerDocument.contains(a))throw a=Error("InvalidStateError"),a.name="InvalidStateError",a;}var m="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget pageX pageY".split(" "),k=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0],d=window.Map&&window.Map.prototype.forEach?Map:
g;g.prototype={set:function(a,b){if(void 0===b)return this.delete(a);this.has(a)||this.size++;this.array[a]=b},has:function(a){return void 0!==this.array[a]},delete:function(a){this.has(a)&&(delete this.array[a],this.size--)},get:function(a){return this.array[a]},clear:function(){this.size=this.array.length=0},forEach:function(a,b){return this.array.forEach(function(d,c){a.call(b,d,c,this)},this)}};var q="bubbles cancelable view detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button relatedTarget buttons pointerId width height pressure tiltX tiltY pointerType hwTimestamp isPrimary type target currentTarget which pageX pageY timeStamp".split(" "),
p=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,"",null,null,0,0,0,0],r={pointerover:1,pointerout:1,pointerenter:1,pointerleave:1},u="undefined"!==typeof SVGElementInstance,t={pointermap:new d,eventMap:Object.create(null),captureInfo:Object.create(null),eventSources:Object.create(null),eventSourceList:[],registerSource:function(a,b){var d=b.events;d&&(d.forEach(function(a){b[a]&&(this.eventMap[a]=b[a].bind(b))},this),this.eventSources[a]=b,this.eventSourceList.push(b))},register:function(a){for(var b=
this.eventSourceList.length,d=0,c;d<b&&(c=this.eventSourceList[d]);d++)c.register.call(c,a)},unregister:function(a){for(var b=this.eventSourceList.length,d=0,c;d<b&&(c=this.eventSourceList[d]);d++)c.unregister.call(c,a)},contains:function(a,b){try{return a.contains(b)}catch(W){return!1}},down:function(a){a.bubbles=!0;this.fireEvent("pointerdown",a)},move:function(a){a.bubbles=!0;this.fireEvent("pointermove",a)},up:function(a){a.bubbles=!0;this.fireEvent("pointerup",a)},enter:function(a){a.bubbles=
!1;this.fireEvent("pointerenter",a)},leave:function(a){a.bubbles=!1;this.fireEvent("pointerleave",a)},over:function(a){a.bubbles=!0;this.fireEvent("pointerover",a)},out:function(a){a.bubbles=!0;this.fireEvent("pointerout",a)},cancel:function(a){a.bubbles=!0;this.fireEvent("pointercancel",a)},leaveOut:function(a){this.out(a);this.propagate(a,this.leave,!1)},enterOver:function(a){this.over(a);this.propagate(a,this.enter,!0)},eventHandler:function(a){if(!a._handledByPE){var b=a.type;(b=this.eventMap&&
this.eventMap[b])&&b(a);a._handledByPE=!0}},listen:function(a,b){b.forEach(function(b){this.addEvent(a,b)},this)},unlisten:function(a,b){b.forEach(function(b){this.removeEvent(a,b)},this)},addEvent:function(a,b){a.addEventListener(b,this.boundHandler)},removeEvent:function(a,b){a.removeEventListener(b,this.boundHandler)},makeEvent:function(a,b){this.captureInfo[b.pointerId]&&(b.relatedTarget=null);a=new n(a,b);b.preventDefault&&(a.preventDefault=b.preventDefault);a._target=a._target||b.target;return a},
fireEvent:function(a,b){a=this.makeEvent(a,b);return this.dispatchEvent(a)},cloneEvent:function(a){for(var b=Object.create(null),d,c=0;c<q.length;c++)d=q[c],b[d]=a[d]||p[c],u&&("target"===d||"relatedTarget"===d)&&b[d]instanceof SVGElementInstance&&(b[d]=b[d].correspondingUseElement);a.preventDefault&&(b.preventDefault=function(){a.preventDefault()});return b},getTarget:function(a){var b=this.captureInfo[a.pointerId];if(!b)return a._target;if(a._target===b||!(a.type in r))return b},propagate:function(a,
b,d){for(var c=a.target,e=[];!c.contains(a.relatedTarget)&&c!==document;)e.push(c),c=c.parentNode;d&&e.reverse();e.forEach(function(d){a.target=d;b.call(this,a)},this)},setCapture:function(a,b){this.captureInfo[a]&&this.releaseCapture(a);this.captureInfo[a]=b;var d=new n("gotpointercapture");d.pointerId=a;this.implicitRelease=this.releaseCapture.bind(this,a);document.addEventListener("pointerup",this.implicitRelease);document.addEventListener("pointercancel",this.implicitRelease);d._target=b;this.asyncDispatchEvent(d)},
releaseCapture:function(a){var b=this.captureInfo[a];if(b){var d=new n("lostpointercapture");d.pointerId=a;this.captureInfo[a]=void 0;document.removeEventListener("pointerup",this.implicitRelease);document.removeEventListener("pointercancel",this.implicitRelease);d._target=b;this.asyncDispatchEvent(d)}},dispatchEvent:function(a){var b=this.getTarget(a);if(b)return b.dispatchEvent(a)},asyncDispatchEvent:function(a){requestAnimationFrame(this.dispatchEvent.bind(this,a))}};t.boundHandler=t.eventHandler.bind(t);
var v={shadow:function(a){if(a)return a.shadowRoot||a.webkitShadowRoot},canTarget:function(a){return a&&!!a.elementFromPoint},targetingShadow:function(a){a=this.shadow(a);if(this.canTarget(a))return a},olderShadow:function(a){var b=a.olderShadowRoot;!b&&(a=a.querySelector("shadow"))&&(b=a.olderShadowRoot);return b},allShadows:function(a){var b=[];for(a=this.shadow(a);a;)b.push(a),a=this.olderShadow(a);return b},searchRoot:function(a,b,d){if(a){var c=a.elementFromPoint(b,d),e;for(e=this.targetingShadow(c);e;){if(a=
e.elementFromPoint(b,d))return c=this.targetingShadow(a),this.searchRoot(c,b,d)||a;e=this.olderShadow(e)}return c}},owner:function(a){for(;a.parentNode;)a=a.parentNode;a.nodeType!==Node.DOCUMENT_NODE&&a.nodeType!==Node.DOCUMENT_FRAGMENT_NODE&&(a=document);return a},findTarget:function(a){var b=a.clientX,d=a.clientY;a=this.owner(a.target);a.elementFromPoint(b,d)||(a=document);return this.searchRoot(a,b,d)}},A=Array.prototype.forEach.call.bind(Array.prototype.forEach),z=Array.prototype.map.call.bind(Array.prototype.map),
x=Array.prototype.slice.call.bind(Array.prototype.slice),B=Array.prototype.filter.call.bind(Array.prototype.filter),D=window.MutationObserver||window.WebKitMutationObserver,C={subtree:!0,childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["touch-action"]};c.prototype={watchSubtree:function(a){this.observer&&v.canTarget(a)&&this.observer.observe(a,C)},enableOnSubtree:function(a){this.watchSubtree(a);a===document&&"complete"!==document.readyState?this.installOnLoad():this.installNewSubtree(a)},
installNewSubtree:function(a){A(this.findElements(a),this.addElement,this)},findElements:function(a){return a.querySelectorAll?a.querySelectorAll("[touch-action]"):[]},removeElement:function(a){this.removeCallback(a)},addElement:function(a){this.addCallback(a)},elementChanged:function(a,b){this.changedCallback(a,b)},concatLists:function(a,b){return a.concat(x(b))},installOnLoad:function(){document.addEventListener("readystatechange",function(){"complete"===document.readyState&&this.installNewSubtree(document)}.bind(this))},
isElement:function(a){return a.nodeType===Node.ELEMENT_NODE},flattenMutationTree:function(a){var b=z(a,this.findElements,this);b.push(B(a,this.isElement));return b.reduce(this.concatLists,[])},mutationWatcher:function(a){a.forEach(this.mutationHandler,this)},mutationHandler:function(a){"childList"===a.type?(this.flattenMutationTree(a.addedNodes).forEach(this.addElement,this),this.flattenMutationTree(a.removedNodes).forEach(this.removeElement,this)):"attributes"===a.type&&this.elementChanged(a.target,
a.oldValue)}};var G=["none","auto","pan-x","pan-y",{rule:"pan-x pan-y",selectors:["pan-x pan-y","pan-y pan-x"]}],E="",F=window.PointerEvent||window.MSPointerEvent,I=!window.ShadowDOMPolyfill&&document.head.createShadowRoot,K=t.pointermap,N=[1,4,2,8,16],H=!1;try{H=1===(new MouseEvent("test",{buttons:1})).buttons}catch(Z){}var M={POINTER_ID:1,POINTER_TYPE:"mouse",events:["mousedown","mousemove","mouseup","mouseover","mouseout"],register:function(a){t.listen(a,this.events)},unregister:function(a){t.unlisten(a,
this.events)},lastTouches:[],isEventSimulatedFromTouch:function(a){var b=this.lastTouches,d=a.clientX;a=a.clientY;for(var c=0,e=b.length,h;c<e&&(h=b[c]);c++){var f=Math.abs(a-h.y);if(25>=Math.abs(d-h.x)&&25>=f)return!0}},prepareEvent:function(a){var b=t.cloneEvent(a),d=b.preventDefault;b.preventDefault=function(){a.preventDefault();d()};b.pointerId=this.POINTER_ID;b.isPrimary=!0;b.pointerType=this.POINTER_TYPE;return b},prepareButtonsForMove:function(a,b){var d=K.get(this.POINTER_ID);a.buttons=0!==
b.which&&d?d.buttons:0;b.buttons=a.buttons},mousedown:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=K.get(this.POINTER_ID),d=this.prepareEvent(a);H||(d.buttons=N[d.button],b&&(d.buttons|=b.buttons),a.buttons=d.buttons);K.set(this.POINTER_ID,a);b&&0!==b.buttons?t.move(d):t.down(d)}},mousemove:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);H||this.prepareButtonsForMove(b,a);b.button=-1;K.set(this.POINTER_ID,a);t.move(b)}},mouseup:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=
K.get(this.POINTER_ID),d=this.prepareEvent(a);if(!H){var c=N[d.button];d.buttons=b?b.buttons&~c:0;a.buttons=d.buttons}K.set(this.POINTER_ID,a);d.buttons&=~N[d.button];0===d.buttons?t.up(d):t.move(d)}},mouseover:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);H||this.prepareButtonsForMove(b,a);b.button=-1;K.set(this.POINTER_ID,a);t.enterOver(b)}},mouseout:function(a){if(!this.isEventSimulatedFromTouch(a)){var b=this.prepareEvent(a);H||this.prepareButtonsForMove(b,a);b.button=
-1;t.leaveOut(b)}},cancel:function(a){a=this.prepareEvent(a);t.cancel(a);this.deactivateMouse()},deactivateMouse:function(){K.delete(this.POINTER_ID)}},T=t.captureInfo,V=v.findTarget.bind(v),U=v.allShadows.bind(v),J=t.pointermap,O,P={events:["touchstart","touchmove","touchend","touchcancel"],register:function(a){O.enableOnSubtree(a)},unregister:function(a){},elementAdded:function(a){var b=a.getAttribute("touch-action"),d=this.touchActionToScrollType(b);d&&(a._scrollType=d,t.listen(a,this.events),
U(a).forEach(function(a){a._scrollType=d;t.listen(a,this.events)},this))},elementRemoved:function(a){a._scrollType=void 0;t.unlisten(a,this.events);U(a).forEach(function(a){a._scrollType=void 0;t.unlisten(a,this.events)},this)},elementChanged:function(a,b){var d=a.getAttribute("touch-action"),c=this.touchActionToScrollType(d);b=this.touchActionToScrollType(b);c&&b?(a._scrollType=c,U(a).forEach(function(a){a._scrollType=c},this)):b?this.elementRemoved(a):c&&this.elementAdded(a)},scrollTypes:{EMITTER:"none",
XSCROLLER:"pan-x",YSCROLLER:"pan-y",SCROLLER:/^(?:pan-x pan-y)|(?:pan-y pan-x)|auto$/},touchActionToScrollType:function(a){var b=this.scrollTypes;if("none"===a)return"none";if(a===b.XSCROLLER)return"X";if(a===b.YSCROLLER)return"Y";if(b.SCROLLER.exec(a))return"XY"},POINTER_TYPE:"touch",firstTouch:null,isPrimaryTouch:function(a){return this.firstTouch===a.identifier},setPrimaryTouch:function(a){if(0===J.size||1===J.size&&J.has(1))this.firstTouch=a.identifier,this.firstXY={X:a.clientX,Y:a.clientY},this.scrolling=
!1,this.cancelResetClickCount()},removePrimaryPointer:function(a){a.isPrimary&&(this.firstXY=this.firstTouch=null,this.resetClickCount())},clickCount:0,resetId:null,resetClickCount:function(){var a=function(){this.clickCount=0;this.resetId=null}.bind(this);this.resetId=setTimeout(a,200)},cancelResetClickCount:function(){this.resetId&&clearTimeout(this.resetId)},typeToButtons:function(a){var b=0;if("touchstart"===a||"touchmove"===a)b=1;return b},touchToPointer:function(a){var b=this.currentTouchEvent,
d=t.cloneEvent(a),c=d.pointerId=a.identifier+2;d.target=T[c]||V(d);d.bubbles=!0;d.cancelable=!0;d.detail=this.clickCount;d.button=0;d.buttons=this.typeToButtons(b.type);d.width=a.radiusX||a.webkitRadiusX||0;d.height=a.radiusY||a.webkitRadiusY||0;d.pressure=a.force||a.webkitForce||.5;d.isPrimary=this.isPrimaryTouch(a);d.pointerType=this.POINTER_TYPE;d.altKey=b.altKey;d.ctrlKey=b.ctrlKey;d.metaKey=b.metaKey;d.shiftKey=b.shiftKey;var e=this;d.preventDefault=function(){e.scrolling=!1;e.firstXY=null;b.preventDefault()};
return d},processTouches:function(a,b){var d=a.changedTouches;this.currentTouchEvent=a;a=0;for(var c;a<d.length;a++)c=d[a],b.call(this,this.touchToPointer(c))},shouldScroll:function(a){if(this.firstXY){var b;b=a.currentTarget._scrollType;if("none"===b)b=!1;else if("XY"===b)b=!0;else{a=a.changedTouches[0];var d="Y"===b?"X":"Y";b=Math.abs(a["client"+b]-this.firstXY[b])>=Math.abs(a["client"+d]-this.firstXY[d])}this.firstXY=null;return b}},findTouch:function(a,b){for(var d=0,c=a.length,e;d<c&&(e=a[d]);d++)if(e.identifier===
b)return!0},vacuumTouches:function(a){var b=a.touches;if(J.size>=b.length){var d=[];J.forEach(function(a,c){1===c||this.findTouch(b,c-2)||d.push(a.out)},this);d.forEach(this.cancelOut,this)}},touchstart:function(a){this.vacuumTouches(a);this.setPrimaryTouch(a.changedTouches[0]);this.dedupSynthMouse(a);this.scrolling||(this.clickCount++,this.processTouches(a,this.overDown))},overDown:function(a){J.set(a.pointerId,{target:a.target,out:a,outTarget:a.target});t.enterOver(a);t.down(a)},touchmove:function(a){this.scrolling||
(this.shouldScroll(a)?(this.scrolling=!0,this.touchcancel(a)):(a.preventDefault(),this.processTouches(a,this.moveOverOut)))},moveOverOut:function(a){var b=J.get(a.pointerId);if(b){var d=b.out,c=b.outTarget;t.move(a);d&&c!==a.target&&(d.relatedTarget=a.target,a.relatedTarget=c,d.target=c,a.target?(t.leaveOut(d),t.enterOver(a)):(a.target=c,a.relatedTarget=null,this.cancelOut(a)));b.out=a;b.outTarget=a.target}},touchend:function(a){this.dedupSynthMouse(a);this.processTouches(a,this.upOut)},upOut:function(a){this.scrolling||
(t.up(a),t.leaveOut(a));this.cleanUpPointer(a)},touchcancel:function(a){this.processTouches(a,this.cancelOut)},cancelOut:function(a){t.cancel(a);t.leaveOut(a);this.cleanUpPointer(a)},cleanUpPointer:function(a){J.delete(a.pointerId);this.removePrimaryPointer(a)},dedupSynthMouse:function(a){var b=M.lastTouches;a=a.changedTouches[0];this.isPrimaryTouch(a)&&(a={x:a.clientX,y:a.clientY},b.push(a),b=function(a,b){b=a.indexOf(b);-1<b&&a.splice(b,1)}.bind(null,b,a),setTimeout(b,2500))}};O=new c(P.elementAdded,
P.elementRemoved,P.elementChanged,P);var R=t.pointermap,Q=window.MSPointerEvent&&"number"===typeof window.MSPointerEvent.MSPOINTER_TYPE_MOUSE,L={events:"MSPointerDown MSPointerMove MSPointerUp MSPointerOut MSPointerOver MSPointerCancel MSGotPointerCapture MSLostPointerCapture".split(" "),register:function(a){t.listen(a,this.events)},unregister:function(a){t.unlisten(a,this.events)},POINTER_TYPES:["","unavailable","touch","pen","mouse"],prepareEvent:function(a){var b=a;Q&&(b=t.cloneEvent(a),b.pointerType=
this.POINTER_TYPES[a.pointerType]);return b},cleanup:function(a){R.delete(a)},MSPointerDown:function(a){R.set(a.pointerId,a);a=this.prepareEvent(a);t.down(a)},MSPointerMove:function(a){a=this.prepareEvent(a);t.move(a)},MSPointerUp:function(a){var b=this.prepareEvent(a);t.up(b);this.cleanup(a.pointerId)},MSPointerOut:function(a){a=this.prepareEvent(a);t.leaveOut(a)},MSPointerOver:function(a){a=this.prepareEvent(a);t.enterOver(a)},MSPointerCancel:function(a){var b=this.prepareEvent(a);t.cancel(b);this.cleanup(a.pointerId)},
MSLostPointerCapture:function(a){a=t.makeEvent("lostpointercapture",a);t.dispatchEvent(a)},MSGotPointerCapture:function(a){a=t.makeEvent("gotpointercapture",a);t.dispatchEvent(a)}},S,aa;window.navigator.msPointerEnabled?(S=function(a){e(a);h(this);0!==t.pointermap.get(a).buttons&&this.msSetPointerCapture(a)},aa=function(a){e(a);this.msReleasePointerCapture(a)}):(S=function(a){e(a);h(this);0!==t.pointermap.get(a).buttons&&t.setCapture(a,this)},aa=function(a){e(a);t.releaseCapture(a,this)});var ea=
window.PointerEvent||window.MSPointerEvent;return{dispatcher:t,Installer:c,PointerEvent:n,PointerMap:d,targetFinding:v,applyGlobal:function(){l();window.PointerEvent||(window.PointerEvent=n,window.navigator.msPointerEnabled?(Object.defineProperty(window.navigator,"maxTouchPoints",{value:window.navigator.msMaxTouchPoints,enumerable:!0}),t.registerSource("ms",L)):(t.registerSource("mouse",M),void 0!==window.ontouchstart&&t.registerSource("touch",P)),t.register(document));window.Element&&!Element.prototype.setPointerCapture&&
Object.defineProperties(Element.prototype,{setPointerCapture:{value:S},releasePointerCapture:{value:aa}})},applyLocal:function(a){ea||(window.PointerEvent||(window.navigator.msPointerEnabled?t.registerSource("ms",L):(t.registerSource("mouse",M),void 0!==window.ontouchstart&&t.registerSource("touch",P)),t.register(document)),window.Element&&!Element.prototype.setPointerCapture&&(a.setPointerCapture=S.bind(a),a.releasePointerCapture=aa.bind(a)),a.getAttribute("touch-action")||a.setAttribute("touch-action",
"none"))}}})},"esri/views/input/keys":function(){define(["require","exports","../../core/has"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.primaryKey=c("mac")?"Meta":"Ctrl";var a={8:"Backspace",9:"Tab",13:"Enter",27:"Escape",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete"};for(n=48;58>n;n++)a[n]=String.fromCharCode(n);for(n=1;25>n;n++)a[111+n]="F"+n;for(n=65;91>n;n++)a[n]=[String.fromCharCode(n+
32),String.fromCharCode(n)];var f={Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Esc:"Escape"};g.eventKey=function(b){if(void 0!==b.key)return f[b.key]||b.key;var c=a[b.keyCode];return Array.isArray(c)?b.shiftKey?c[1]:c[0]:c};g.isSystemModifier=function(a){switch(a){case "Ctrl":case "Alt":case "Shift":case "Meta":case "Primary":return!0}}})},"esri/views/input/gamepad/GamepadSource":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/scheduling ./GamepadInputDevice ./GamepadState".split(" "),
function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a,c){var e=this;this.element=a;this.input=c;this.handleGamepadConnectedEvent=function(a){e.handleGamepadConnected(a.gamepad)};this.handleGamepadDisconnectedEvent=function(a){a=a.gamepad;var d=e.inputDevices[a.index];d&&(e.emitGamepadEvent(a,b.extractState(d),!1),e.inputDevices[a.index]=void 0,e.latestUpdate[a.index]=void 0,e.input.gamepad.devices.remove(d))};this.frameTask=null;this.latestUpdate=[];this.inputDevices=
[];this.callback=null;if(this.supported="getGamepads"in window.navigator)this.forEachGamepad(function(a){return e.handleGamepadConnected(a)}),window.addEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.addEventListener("gamepaddisconnected",this.handleGamepadDisconnectedEvent)}c.prototype.destroy=function(){this.pollingEnabled=!1;this.supported&&(window.removeEventListener("gamepadconnected",this.handleGamepadConnectedEvent),window.removeEventListener("gamepaddisconnected",
this.handleGamepadDisconnectedEvent))};Object.defineProperty(c.prototype,"onEvent",{set:function(a){this.callback=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"pollingEnabled",{set:function(a){this.supported&&(a?this.startPolling():this.stopPolling())},enumerable:!0,configurable:!0});c.prototype.handleGamepadConnected=function(a){var b=new f(a);"unknown"!==b.deviceType&&(this.inputDevices[a.index]=b,this.input.gamepad.devices.add(b))};c.prototype.startPolling=function(){var b=
this;null==this.frameTask&&(this.frameTask=a.addFrameTask({update:function(){return b.readGamepadState()}}))};c.prototype.stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};c.prototype.readGamepadState=function(){var a=this,c=!document.hasFocus||document.hasFocus(),f=this.element.contains(document.activeElement),k="document"===this.input.gamepad.enabledFocusMode&&!c||"view"===this.input.gamepad.enabledFocusMode&&!f;this.forEachGamepad(function(d){var c=
a.inputDevices[d.index];if(c){var e=a.latestUpdate[d.index],c=b.extractState(c),h=k||b.stateIdle(c);e&&(e.timestamp===d.timestamp||!e.active&&h||b.stateEqual(e.state,c))||a.emitGamepadEvent(d,c,!h)}})};c.prototype.forEachGamepad=function(a){for(var b=window.navigator.getGamepads(),c=0;c<b.length;c++){var e=b[c];this.validate(e)&&a(e)}};c.prototype.emitGamepadEvent=function(a,b,c){var e=this.latestUpdate[a.index];if((e=e&&e.active)||c)this.latestUpdate[a.index]={timestamp:a.timestamp,state:b,active:c},
this.callback&&this.callback({device:this.inputDevices[a.index],state:b,action:!e&&c?"start":e&&c?"update":"end"})};c.prototype.validate=function(a){if(!a||!a.connected)return!1;for(var b=0;b<a.axes.length;b++)if(isNaN(a.axes[b]))return!1;return!0};return c}();g.GamepadSource=n})},"esri/views/input/gamepad/GamepadState":function(){define(["require","exports","../../3d/support/mathUtils"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.extractState=function(a){var f=a.native;return{buttons:f.buttons.map(function(a){return a.pressed?
a.value?a.value:1:0}),axes:f.axes.map(function(b){var f=a.axisThreshold,e=Math.abs(b);b=e<f?0:c.sign(b)*(e-f)/(1-f);return b})}};g.stateEqual=function(a,c){if(a.axes.length!==c.axes.length||a.buttons.length!==c.buttons.length)return!1;for(var b=0;b<a.axes.length;b++)if(a.axes[b]!==c.axes[b])return!1;for(b=0;b<a.buttons.length;b++)if(a.buttons[b]!==c.buttons[b])return!1;return!0};g.stateIdle=function(a){for(var c=0;c<a.axes.length;c++)if(0!==a.axes[c])return!1;for(c=0;c<a.buttons.length;c++)if(0!==
a.buttons[c])return!1;return!0}})},"esri/views/input/InputManager":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Logger ../../core/now ../../core/accessorSupport/decorators ./keys ./recognizers ./handlers/LatestPointerType".split(" "),function(n,g,c,a,f,b,l,e,h,m,k){Object.defineProperty(g,"__esModule",{value:!0});var d=b.getLogger("esri.views.input.InputManager");n=function(b){function f(a,d){a=b.call(this)||
this;a._pointerCaptures=new Map;a._nameToGroup={};a._handlers=[];a._currentPropagation=null;a._sourceEvents=new Set;a._keyModifiers=new Set;a._activeKeyModifiers=new Set;a.primaryKey=h.primaryKey;a.latestPointerType="mouse";a._installRecognizers();return a}c(f,b);f.prototype.normalizeCtorArgs=function(a,b){this._browserEvents=a;this._browserEvents.onEventReceived=this._onEventReceived.bind(this);this._recognizers=b;this._recognizers||(this._recognizers=m.defaults.map(function(a){return new a}));return{}};
f.prototype.destroy=function(){for(var a=0,b=Object.keys(this._nameToGroup);a<b.length;a++)this.uninstallHandlers(b[a]);this._browserEvents=null};f.prototype.installHandlers=function(a,b){var c=this;if(this._nameToGroup[a])d.error("There is already an InputHandler group registered under the name `"+a+"`");else if(0===b.length)d.error("Can't register a group of zero handlers");else{var e={name:a,handlers:b.map(function(a,b){return{handler:a,active:!0,removed:!1,priorityIndex:0,eventCallback:null,uninstallCallback:null}})};
this._nameToGroup[a]=e;a=function(a){var b=e.handlers[a];h._handlers.push(b);b.handler.onInstall({updateDependencies:function(){c.updateDependencies()},emit:function(a,d,e,h){c._emitInputEvent(b.priorityIndex,a,d,e,h)},setPointerCapture:function(a,d){c._setPointerCapture(e,b,a,d)},setEventCallback:function(a){b.eventCallback=a},setUninstallCallback:function(a){b.uninstallCallback=a}})};var h=this;for(b=e.handlers.length-1;0<=b;b--)a(b);this.updateDependencies()}};f.prototype.uninstallHandlers=function(a){var b=
this._nameToGroup[a];b?(b.handlers.forEach(function(a){a.removed=!0;a.uninstallCallback()}),delete this._nameToGroup[a],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):d.error("There is no InputHandler group registered under the name `"+a+"`")};f.prototype.hasHandlers=function(a){return void 0!==this._nameToGroup[a]};f.prototype.updateDependencies=function(){var a=new Set,b=new Set;this._handlersPriority=[];for(var d=this._handlers.length-
1;0<=d;d--){var c=this._handlers[d];c.priorityIndex=d;this._handlersPriority.push(c)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(d=this._handlersPriority.length-1;0<=d;d--){c=this._handlersPriority[d];c.priorityIndex=d;var e=c.handler.hasSideEffects;if(!e)for(var f=0,k=c.handler.outgoingEventTypes;f<k.length;f++)if(a.has(k[f])){e=!0;break}if(e)for(f=0,k=c.handler.incomingEventMatches;f<k.length;f++){var l=k[f];a.add(l.eventType);for(var m=0,l=l.keyModifiers;m<l.length;m++){var q=
l[m];h.isSystemModifier(q)||b.add(q)}}c.active=e}this._sourceEvents=a;this._keyModifiers=b;0<this._pointerCaptures.size&&this._sourceEvents.add("pointer-capture-lost");0<this._keyModifiers.size&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up"));this._browserEvents&&(this._browserEvents.activeEvents=this._sourceEvents)};f.prototype._setLatestPointerType=function(a){this._set("latestPointerType",a)};f.prototype._onEventReceived=function(a,b){"pointer-capture-lost"===a&&this._pointerCaptures.delete(b.native.pointerId);
this._updateKeyModifiers(a,b);this._emitInputEventFromSource(a,b,b.native?b.native.timestamp:void 0)};f.prototype._updateKeyModifiers=function(a,b){var d=this;if(b){var c=!1,e=function(){if(!c){var a=new Set;d._activeKeyModifiers.forEach(function(b){a.add(b)});d._activeKeyModifiers=a;c=!0}},h=function(a,b){b&&!d._activeKeyModifiers.has(a)?(e(),d._activeKeyModifiers.add(a)):!b&&d._activeKeyModifiers.has(a)&&(e(),d._activeKeyModifiers.delete(a))};if("key-down"===a||"key-up"===a){var f=b.key;this._keyModifiers.has(f)&&
h(f,"key-down"===a)}a=b.native;h("Alt",!(!a||!a.altKey));h("Ctrl",!(!a||!a.ctrlKey));h("Shift",!(!a||!a.shiftKey));h("Meta",!(!a||!a.metaKey));h("Primary",this._activeKeyModifiers.has(this.primaryKey))}};f.prototype._installRecognizers=function(){var a=this;this._latestPointerTypeHandler=new k.LatestPointerType(function(b){return a._setLatestPointerType(b)});0<this._recognizers.length&&this.installHandlers("default",this._recognizers);this.installHandlers("input-manager-logic",[this._latestPointerTypeHandler])};
f.prototype._setPointerCapture=function(a,b,d,c){a=a.name+"-"+b.priorityIndex;b=this._pointerCaptures.get(d.pointerId)||new Set;this._pointerCaptures.set(d.pointerId,b);c?(b.add(a),1===b.size&&this._browserEvents&&this._browserEvents.setPointerCapture(d,!0)):b.has(a)&&(b.delete(a),0===b.size&&(this._pointerCaptures.delete(d.pointerId),this._browserEvents&&this._browserEvents.setPointerCapture(d,!1)))};f.prototype._garbageCollectRemovedHandlers=function(){this._handlers=this._handlers.filter(function(a){return!a.removed});
this.updateDependencies()};f.prototype._emitInputEventFromSource=function(a,b,d){this._emitInputEvent(0,a,b,d)};f.prototype._emitInputEvent=function(a,b,d,c,e){c=void 0!==c?c:this._currentPropagation?this._currentPropagation.timestamp:l();b=new q(b,d,c,e||this._activeKeyModifiers);this._currentPropagation?this._currentPropagation.addedEvents.push(b):this._doNewPropagation(a,b)};f.prototype._doNewPropagation=function(a,b){for(a=this._currentPropagation={events:[b],addedEvents:[],currentHandler:this._handlersPriority[a],
needsHandlerGarbageCollect:!1,timestamp:b.timestamp};a.currentHandler;){if(a.currentHandler.removed)a.needsHandlerGarbageCollect=!0;else{b=a.events;var d=[];a.addedEvents=[];for(var c=0;c<b.length;c++){var e=b[c];a.currentHandler.active&&a.currentHandler.eventCallback(e);e.shouldStopPropagation()||d.push(e)}a.events=d.concat(a.addedEvents)}a.currentHandler=this._handlersPriority[a.currentHandler.priorityIndex+1]}a.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers();this._currentPropagation=
null};f.prototype._compareHandlerPriority=function(a,b){if(a.handler.hasSideEffects!==b.handler.hasSideEffects)return a.handler.hasSideEffects?1:-1;for(var d=0,c=a.handler.incomingEventMatches;d<c.length;d++)for(var e=c[d],h=function(a){if(e.eventType!==a.eventType)return"continue";var b=e.keyModifiers.filter(function(b){return-1!==a.keyModifiers.indexOf(b)});if(b.length===e.keyModifiers.length!==(b.length===a.keyModifiers.length))return{value:e.keyModifiers.length>a.keyModifiers.length?-1:1}},f=
0,k=b.handler.incomingEventMatches;f<k.length;f++){var l=h(k[f]);if("object"===typeof l)return l.value}return a.priorityIndex>b.priorityIndex?-1:1};f.prototype._sortHandlersPriority=function(a){for(var b=[],d=0;d<a.length;d++){for(var c=a[d],e=0;e<b.length&&0<=this._compareHandlerPriority(c,b[e]);)e++;b.splice(e,0,c)}return b};a([e.property({readOnly:!0})],f.prototype,"latestPointerType",void 0);return f=a([e.subclass("esri.views.input.InputManager")],f)}(e.declared(f));g.InputManager=n;var q=function(){function a(a,
b,d,c){this.type=a;this.data=b;this.timestamp=d;this.modifiers=c;this._stopPropagation=!1}a.prototype.stopPropagation=function(){this._stopPropagation=!0};a.prototype.shouldStopPropagation=function(){return this._stopPropagation};return a}()})},"esri/views/input/recognizers":function(){define("require exports ./recognizers/Drag ./recognizers/PointerClickHoldAndDrag ./recognizers/SingleAndDoubleClick ./recognizers/VerticalTwoFingerDrag".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",
{value:!0});g.defaults=[a.PointerClickHoldAndDrag,f.SingleAndDoubleClick,c.Drag,b.VerticalTwoFingerDrag]})},"esri/views/input/recognizers/Drag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler","./support"],function(n,g,c,a,f){function b(a){var b=[];a.forEach(function(a){b.push(a.event)});return f.fitCircleLSQ(b)}function l(a){var c=b(a),d=0;a.forEach(function(a){for(var b=h(a,c),b=b-a.lastAngle;b>Math.PI;)b-=2*Math.PI;for(;b<-Math.PI;)b+=2*Math.PI;b=
a.lastAngle+b;a.lastAngle=b;d+=b-a.initialAngle});d/=a.size||1;return{angle:d,radius:c.radius,center:c.center}}function e(a){var b=new Map;a.forEach(function(a,c){return b.set(c,a.event)});return b}function h(a,b){a=a.event;return Math.atan2(a.y-b.center.y,a.x-b.center.x)}Object.defineProperty(g,"__esModule",{value:!0});n=function(a){function f(){var b=a.call(this,!1)||this;b.startStateModifiers=new Set;b.activePointerMap=new Map;b.isDragging=!1;b.drag=b.registerOutgoing("drag");b.registerIncoming("pointer-drag",
b.handlePointerDrag.bind(b));b.registerIncoming("pointer-up",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-capture-lost",b.handlePointerUpAndPointerLost.bind(b));b.registerIncoming("pointer-cancel",b.handlePointerUpAndPointerLost.bind(b));return b}c(f,a);f.prototype.createPayload=function(a,b,c,h){return{action:a,pointerType:this.pointerType,button:this.mouseButton,buttons:b.buttons,timestamp:h,pointers:e(this.activePointerMap),pointer:b,angle:c.angle,radius:c.radius,center:c.center}};
f.prototype.addPointer=function(a){var d=a.native.pointerId,c=l(this.activePointerMap).angle;a={event:a,initialAngle:0,lastAngle:0};this.activePointerMap.set(d,a);d=h(a,b(this.activePointerMap));a.initialAngle=d;a.lastAngle=d;this.updatePointerAngles(c)};f.prototype.updatePointer=function(a){if(!a||null!=a.x||null!=a.y){var b=this.activePointerMap.get(a.native.pointerId);b?b.event=a:this.addPointer(a)}};f.prototype.removePointer=function(a){var b=l(this.activePointerMap).angle;this.activePointerMap.delete(a);
this.updatePointerAngles(b)};f.prototype.updatePointerAngles=function(a){var b=l(this.activePointerMap);this.activePointerMap.forEach(function(d){d.initialAngle=h(d,b)-a;d.lastAngle=h(d,b)-a})};f.prototype.emitEvent=function(a,b,c){var d=l(this.activePointerMap);this.drag.emit(this.createPayload(a,b,d,c),void 0,this.startStateModifiers)};f.prototype.handlePointerUpAndPointerLost=function(a){var b=a.data.native.pointerId,d=a.timestamp;this.activePointerMap.get(b)&&(1===this.activePointerMap.size?(this.updatePointer(a.data),
this.emitEvent("end",a.data,d),this.isDragging=!1,this.removePointer(b)):(this.removePointer(b),this.emitEvent("removed",a.data,a.timestamp)))};f.prototype.handlePointerDrag=function(a){var b=a.data,d=b.currentEvent,c=a.timestamp;switch(b.action){case "start":case "update":this.isDragging?this.activePointerMap.has(d.native.pointerId)?(this.updatePointer(d),this.emitEvent("update",d,c)):(this.addPointer(d),this.emitEvent("added",d,c)):(this.updatePointer(d),this.pointerType=a.data.startEvent.pointerType,
this.mouseButton=a.data.startEvent.button,this.startStateModifiers=a.modifiers,this.isDragging=!0,this.emitEvent("start",d,c))}};return f}(a.InputHandler);g.Drag=n;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right";a[a.Back=3]="Back";a[a.Forward=4]="Forward";a[a.Undefined=-1]="Undefined"})(g.Button||(g.Button={}))})},"esri/views/input/recognizers/support":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.manhattanDistance=
function(c,a){return Math.abs(a.x-c.x)+Math.abs(a.y-c.y)};g.euclideanDistance=function(c,a){var f=a.x-c.x;c=a.y-c.y;return Math.sqrt(f*f+c*c)};g.fitCircleLSQ=function(c,a){a?(a.radius=0,a.center.x=0,a.center.y=0):a={radius:0,center:{x:0,y:0}};if(0===c.length)return a;if(1===c.length)return a.center.x=c[0].x,a.center.y=c[0].y,a;if(2===c.length){var f=c[0];c=c[1];var b=[c.x-f.x,c.y-f.y],l=b[0],b=b[1];a.radius=Math.sqrt(l*l+b*b)/2;a.center.x=(f.x+c.x)/2;a.center.y=(f.y+c.y)/2;return a}for(var e=0,h=
0,m=0;m<c.length;m++)e+=c[m].x,h+=c[m].y;for(var e=e/c.length,h=h/c.length,k=c.map(function(a){return a.x-e}),d=c.map(function(a){return a.y-h}),q=f=a=0,p=0,g=l=0,m=b=0;m<k.length;m++){var u=k[m],t=d[m],v=u*u,A=t*t;a+=v;f+=A;q+=u*t;p+=v*u;l+=A*t;g+=u*A;b+=t*v}m=a;k=q;d=f;p=.5*(p+g);l=.5*(l+b);b=m*d-q*k;g=(p*d-l*k)/b;l=(m*l-q*p)/b;return{radius:Math.sqrt(g*g+l*l+(a+f)/c.length),center:{x:g+e,y:l+h}}}})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../InputHandler","./support"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});g.DefaultParameters={maximumClickDelay:300,movementUntilMouseDrag:1.5,movementUntilTouchDrag:6,holdDelay:500};n=function(a){function b(b,c,f,k){void 0===b&&(b=g.DefaultParameters.maximumClickDelay);void 0===c&&(c=g.DefaultParameters.movementUntilMouseDrag);void 0===f&&(f=g.DefaultParameters.movementUntilTouchDrag);void 0===k&&(k=g.DefaultParameters.holdDelay);var d=a.call(this,!1)||this;d.maximumClickDelay=
b;d.movementUntilMouseDrag=c;d.movementUntilTouchDrag=f;d.holdDelay=k;d._pointerState=new Map;d._pointerDrag=d.registerOutgoing("pointer-drag");d._immediateClick=d.registerOutgoing("immediate-click");d._pointerHold=d.registerOutgoing("hold");d.registerIncoming("pointer-down",d._handlePointerDown.bind(d));d.registerIncoming("pointer-up",function(a){d._handlePointerLoss(a,"pointer-up")});d.registerIncoming("pointer-capture-lost",function(a){d._handlePointerLoss(a,"pointer-capture-lost")});d.registerIncoming("pointer-cancel",
function(a){d._handlePointerLoss(a,"pointer-cancel")});d._moveHandle=d.registerIncoming("pointer-move",d._handlePointerMove.bind(d));d._moveHandle.pause();return d}c(b,a);b.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.holdTimeout&&(clearTimeout(a.holdTimeout),a.holdTimeout=0)});a.prototype.onUninstall.call(this)};b.prototype._handlePointerDown=function(a){var b=this,c=a.data,e=c.native.pointerId,d=0;0===this._pointerState.size&&(d=setTimeout(function(){var d=b._pointerState.get(e);
d&&(d.isDragging||(b._pointerHold.emit(d.previousEvent,void 0,a.modifiers),d.holdEmitted=!0),d.holdTimeout=0)},this.holdDelay));d={startEvent:c,previousEvent:c,startTimestamp:a.timestamp,isDragging:!1,downButton:c.native.button,holdTimeout:d,modifiers:new Set};this._pointerState.set(e,d);this.startCapturingPointer(c.native);this._moveHandle.resume();1<this._pointerState.size&&this.startDragging(a)};b.prototype._createPointerDragData=function(a,b,c){return{action:a,startEvent:b.startEvent,previousEvent:b.previousEvent,
currentEvent:c}};b.prototype._handlePointerMove=function(a){var b=a.data,c=this._pointerState.get(b.native.pointerId);c&&(c.isDragging?this._pointerDrag.emit(this._createPointerDragData("update",c,b),void 0,c.modifiers):f.euclideanDistance(b,c.startEvent)>("touch"===b.native.pointerType?this.movementUntilTouchDrag:this.movementUntilMouseDrag)&&this.startDragging(a),c.previousEvent=b)};b.prototype.startDragging=function(a){var b=this,c=a.data,e=c.native.pointerId;this._pointerState.forEach(function(d){0!==
d.holdTimeout&&(clearTimeout(d.holdTimeout),d.holdTimeout=0);d.isDragging||(d.modifiers=a.modifiers,d.isDragging=!0,e===d.startEvent.native.pointerId?b._pointerDrag.emit(b._createPointerDragData("start",d,c)):b._pointerDrag.emit(b._createPointerDragData("start",d,d.previousEvent),a.timestamp))})};b.prototype._handlePointerLoss=function(a,b){var c=a.data,e=c.native.pointerId,d=this._pointerState.get(e);d&&(0!==d.holdTimeout&&clearTimeout(d.holdTimeout),d.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",
d,"pointer-up"===b?c:d.previousEvent),void 0,d.modifiers):"pointer-up"===b&&d.downButton===c.native.button&&a.timestamp-d.startTimestamp<=this.maximumClickDelay&&!d.holdEmitted&&this._immediateClick.emit(c),this._pointerState.delete(e),this.stopCapturingPointer(c.native),0===this._pointerState.size&&this._moveHandle.pause())};return b}(a.InputHandler);g.PointerClickHoldAndDrag=n})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define(["require","exports","../../../core/tsSupport/extendsHelper",
"../InputHandler","./support"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});g.DefaultParameters={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};n=function(a){function b(b,c,f,k){void 0===b&&(b=g.DefaultParameters.maximumDoubleClickDelay);void 0===c&&(c=g.DefaultParameters.maximumDoubleClickDistance);void 0===f&&(f=g.DefaultParameters.maximumDoubleTouchDelay);void 0===k&&(k=g.DefaultParameters.maximumDoubleTouchDistance);
var d=a.call(this,!1)||this;d.maximumDoubleClickDelay=b;d.maximumDoubleClickDistance=c;d.maximumDoubleTouchDelay=f;d.maximumDoubleTouchDistance=k;d._pointerState=new Map;d._click=d.registerOutgoing("click");d._doubleClick=d.registerOutgoing("double-click");d.registerIncoming("immediate-click",d._handleImmediateClick.bind(d));return d}c(b,a);b.prototype.onUninstall=function(){this._pointerState.forEach(function(a){0!==a.doubleClickTimeout&&(clearTimeout(a.doubleClickTimeout),a.doubleClickTimeout=0)})};
b.prototype._pointerId=function(a){a=a.native;return"mouse"===a.pointerType?a.pointerId+":"+a.button:""+a.pointerType};b.prototype._handleImmediateClick=function(a){var b=a.data,c=this._pointerId(b),e=this._pointerState.get(c);if(e){clearTimeout(e.doubleClickTimeout);e.doubleClickTimeout=0;var d="touch"===b.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;f.manhattanDistance(e.event.data,b)>d?(this._doubleClickTimeoutExceeded(c),this._startClick(a)):(this._doubleClick.emit(b,
void 0,e.event.modifiers),this._pointerState.delete(c))}else this._startClick(a)};b.prototype._startClick=function(a){var b=this,c=this._pointerId(a.data);this._pointerState.set(c,{event:a,doubleClickTimeout:setTimeout(function(){return b._doubleClickTimeoutExceeded(c)},"touch"===a.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)})};b.prototype._doubleClickTimeoutExceeded=function(a){var b=this._pointerState.get(a);this._click.emit(b.event.data,void 0,b.event.modifiers);
b.doubleClickTimeout=0;this._pointerState.delete(a)};return b}(a.InputHandler);g.SingleAndDoubleClick=n})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../DragEventSeparator","../InputHandler"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function f(c,h){void 0===c&&(c=20);void 0===h&&(h=40);var e=b.call(this,!1)||this;e._threshold=c;e._maxDelta=h;e.state="ready";e.emittedArtificalEnd2=
!1;e._vertical=e.registerOutgoing("vertical-two-finger-drag");e._artificalDrag=e.registerOutgoing("drag");e.dragEventSeparator=new a.DragEventSeparator({start:function(a,b){return e.observeStart(a,b)},update:function(a,b,c){return e.observeUpdate(a,b,c)},end:function(a,b){return e.observeEnd(a,b)}});e.registerIncoming("drag",function(a){return e.dragEventSeparator.handle(a)});return e}c(f,b);Object.defineProperty(f.prototype,"failed",{get:function(){return"failed"===this.state},enumerable:!0,configurable:!0});
f.prototype.observeStart=function(a,b){1===a&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),b.stopPropagation());this.state=2===a?"ready":"failed"};f.prototype.observeUpdate=function(a,b,c){"failed"!==this.state&&2===a&&("active"===
this.state?(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"update"}),b.stopPropagation()):this.checkMovementWithinLimits(b.data,c.data)?this.checkVerticalThresholdReached(b.data,c.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=b.data.center,this._artificalDrag.emit({action:"end",button:b.data.button,buttons:b.data.buttons,pointerType:b.data.pointerType,timestamp:b.data.timestamp,pointers:b.data.pointers,pointer:b.data.pointer,
angle:b.data.angle,radius:b.data.radius,center:b.data.center,artifical:!0}),this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),b.stopPropagation()):this.state="failed")};f.prototype.observeEnd=function(a,b){"active"===this.state&&(this._vertical.emit({delta:b.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",b.stopPropagation())};f.prototype.checkMovementWithinLimits=function(a,b){var c=-Infinity,e=Infinity,d=-Infinity,h=Infinity;
b.pointers.forEach(function(a){c=Math.max(c,a.x);e=Math.min(e,a.x);d=Math.max(d,a.y);h=Math.min(h,a.y)});var f=-Infinity,l=Infinity,g=-Infinity,t=Infinity;a.pointers.forEach(function(a){f=Math.max(f,a.x);l=Math.min(l,a.x);g=Math.max(g,a.y);t=Math.min(t,a.y)});return Math.abs(a.center.x-b.center.x)<this._threshold&&Math.abs(f-l-(c-e))<=this._maxDelta&&Math.abs(g-t-(d-h))<=this._maxDelta};f.prototype.checkVerticalThresholdReached=function(a,b){var c=Math.abs(a.center.y-b.center.y);a.pointers.forEach(function(a,
d){d=b.pointers.get(d);c=Math.min(c,Math.abs(a.y-d.y))});return c>=this._threshold};return f}(f.InputHandler);g.VerticalTwoFingerDrag=n})},"esri/views/input/DragEventSeparator":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a){this.callbacks=a;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=function(){return!0})}c.prototype.handle=function(a){var c=a.data,b=c.pointers.size;switch(c.action){case "start":this.currentCount=
b;this.emitStart(a);break;case "added":this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(a);break;case "update":this.emitUpdate(a);break;case "removed":this.startEvent&&this.emitEnd(this.previousEvent);this.currentCount=b;this.emitStart(a);break;case "end":this.emitEnd(a),this.currentCount=0}this.previousEvent=a};c.prototype.emitStart=function(a){this.startEvent=a;this.callbacks.condition(this.currentCount,a)&&this.callbacks.start(this.currentCount,a,this.startEvent)};c.prototype.emitUpdate=
function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.update(this.currentCount,a,this.startEvent)};c.prototype.emitEnd=function(a){this.callbacks.condition(this.currentCount,a)&&this.callbacks.end(this.currentCount,a,this.startEvent);this.startEvent=null};return c}();g.DragEventSeparator=n})},"esri/views/input/handlers/LatestPointerType":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(n,g,c,a){Object.defineProperty(g,"__esModule",
{value:!0});n=function(a){function b(b){var c=a.call(this,!0)||this;c._onChange=b;c._value="mouse";c.registerIncoming("pointer-down",function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler=c.registerIncoming("pointer-move",function(a){c._setValue("touch"===a.data.native.pointerType?"touch":"mouse")});c._moveHandler.pause();return c}c(b,a);b.prototype._setValue=function(a){a!==this._value&&("touch"===a?this._moveHandler.resume():this._moveHandler.pause(),this._value=
a,this._onChange(a))};return b}(a.InputHandler);g.LatestPointerType=n})},"esri/views/input/ViewEvents":function(){define("require exports ../../core/tsSupport/extendsHelper ../../geometry/ScreenPoint ../3d/support/mathUtils ./InputHandler".split(" "),function(n,g,c,a,f,b){function l(a){return!!h[a]}function e(a){for(var b=0;b<a.length;b++)if(!l(a[b]))return!1;return!0}Object.defineProperty(g,"__esModule",{value:!0});var h={click:!0,"double-click":!0,"immediate-click":!0,hold:!0,drag:!0,"key-down":!0,
"key-up":!0,"pointer-down":!0,"pointer-move":!0,"pointer-up":!0,"pointer-drag":!0,"mouse-wheel":!0,"pointer-enter":!0,"pointer-leave":!0,gamepad:!0},m;(function(a){a[a.Left=0]="Left";a[a.Middle=1]="Middle";a[a.Right=2]="Right"})(m||(m={}));n=function(){function a(a){this.handlers=new Map;this.counter=0;this.handlerCounts=new Map;this.view=a;this.inputManager=null}a.prototype.connect=function(a){var b=this;a&&this.disconnect();this.inputManager=a;this.handlers.forEach(function(a,c){return b.inputManager.installHandlers(c,
[a])})};a.prototype.disconnect=function(){var a=this;this.inputManager&&this.handlers.forEach(function(b,c){return a.inputManager.uninstallHandlers(c)});this.inputManager=null};a.prototype.destroy=function(){this.disconnect();this.handlers.clear();this.view=null};a.prototype.register=function(a,b,c){var d=this,h=Array.isArray(a)?a:a.split(",");if(!e(h))return h.some(l)&&console.error("Error: registering input events and other events on the view at the same time is not supported."),null;a=Array.isArray(b)?
b:[];c=Array.isArray(b)?c:b;var f=this.createUniqueGroupName();b=new k(this.view,h,a,c);this.handlers.set(f,b);for(c=0;c<h.length;c++){a=h[c];var m=this.handlerCounts.get(a)||0;this.handlerCounts.set(a,m+1)}this.inputManager&&this.inputManager.installHandlers(f,[b]);return{remove:function(){return d.removeHandler(f,h)}}};a.prototype.hasHandler=function(a){return!!this.handlerCounts.get(a)};a.prototype.removeHandler=function(a,b){if(this.handlers.has(a)){this.handlers.delete(a);for(var c=0;c<b.length;c++){var d=
b[c],e=this.handlerCounts.get(d);void 0===e?console.error("Trying to remove handler for event that has no handlers registered: ",d):1===e?this.handlerCounts.delete(d):this.handlerCounts.set(d,e-1)}}this.inputManager&&this.inputManager.uninstallHandlers(a)};a.prototype.createUniqueGroupName=function(){this.counter+=1;return"viewEvents_"+this.counter};return a}();g.ViewEvents=n;var k=function(b){function d(a,c,d,e){var h=b.call(this,!0)||this;h.view=a;for(a=0;a<c.length;a++)switch(c[a]){case "click":h.registerIncoming("click",
d,function(a){return e(h.wrapClick(a))});break;case "double-click":h.registerIncoming("double-click",d,function(a){return e(h.wrapDoubleClick(a))});break;case "immediate-click":h.registerIncoming("immediate-click",d,function(a){return e(h.wrapImmediateClick(a))});break;case "hold":h.registerIncoming("hold",d,function(a){return e(h.wrapHold(a))});break;case "drag":h.registerIncoming("drag",d,function(a){(a=h.wrapDrag(a))&&e(a)});break;case "key-down":h.registerIncoming("key-down",d,function(a){return e(h.wrapKeyDown(a))});
break;case "key-up":h.registerIncoming("key-up",d,function(a){return e(h.wrapKeyUp(a))});break;case "pointer-down":h.registerIncoming("pointer-down",d,function(a){return e(h.wrapPointer(a,"pointer-down"))});break;case "pointer-move":h.registerIncoming("pointer-move",d,function(a){return e(h.wrapPointer(a,"pointer-move"))});break;case "pointer-up":h.registerIncoming("pointer-up",d,function(a){return e(h.wrapPointer(a,"pointer-up"))});break;case "pointer-drag":h.registerIncoming("pointer-drag",d,function(a){return e(h.wrapPointerDrag(a))});
break;case "mouse-wheel":h.registerIncoming("mouse-wheel",d,function(a){return e(h.wrapMouseWheel(a))});break;case "pointer-enter":h.registerIncoming("pointer-enter",d,function(a){return e(h.wrapPointer(a,"pointer-enter"))});break;case "pointer-leave":h.registerIncoming("pointer-leave",d,function(a){return e(h.wrapPointer(a,"pointer-leave"))});break;case "gamepad":h.registerIncoming("gamepad",d,function(a){e(h.wrapGamepad(a))})}return h}c(d,b);d.prototype.wrapClick=function(b){var c=b.data,d=c.x,
e=c.y;return{type:"click",pointerType:c.pointerType,button:c.button,buttons:c.buttons,x:d,y:e,native:c.native,timestamp:b.timestamp,screenPoint:new a(d,e),mapPoint:this.view.toMap(d,e),stopPropagation:function(){return b.stopPropagation()}}};d.prototype.wrapDoubleClick=function(a){var b=a.data,c=b.x,d=b.y;return{type:"double-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};
d.prototype.wrapImmediateClick=function(a){var b=a.data,c=b.x,d=b.y;return{type:"immediate-click",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,d),stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapHold=function(a){var b=a.data,c=b.x,d=b.y;return{type:"hold",pointerType:b.pointerType,button:b.button,buttons:b.buttons,x:c,y:d,native:b.native,timestamp:a.timestamp,mapPoint:this.view.toMap(c,
d),stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapDrag=function(a){var b=a.data,c=b.center,d=c.x,c=c.y,e=b.action,h=b.pointerType,k=b.button;"start"===e&&(this.latestDragStart=b);if(this.latestDragStart){var l=b.pointer.native,m=b.buttons,q=a.timestamp,p={x:this.latestDragStart.center.x,y:this.latestDragStart.center.y};"end"===e&&(this.latestDragStart=void 0);return{type:"drag",action:e,x:d,y:c,origin:p,pointerType:h,button:k,buttons:m,radius:b.radius,angle:f.rad2deg(b.angle),
native:l,timestamp:q,stopPropagation:function(){return a.stopPropagation()}}}};d.prototype.wrapKeyDown=function(a){var b=a.data;return{type:"key-down",key:b.key,repeat:b.repeat,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapKeyUp=function(a){var b=a.data;return{type:"key-up",key:b.key,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapPointer=function(a,b){var c=a.data,d=c.native;
return{type:b,x:c.x,y:c.y,pointerId:d.pointerId,pointerType:d.pointerType,button:c.button,buttons:c.buttons,native:d,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapPointerDrag=function(a){var b=a.data.currentEvent;return{type:"pointer-drag",x:b.x,y:b.y,pointerId:a.data.startEvent.native.pointerId,pointerType:a.data.startEvent.native.pointerType,button:a.data.startEvent.button,buttons:b.buttons,action:a.data.action,origin:{x:a.data.startEvent.x,y:a.data.startEvent.y},
native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapMouseWheel=function(a){var b=a.data;return{type:"mouse-wheel",x:b.x,y:b.y,deltaY:b.deltaY,native:b.native,timestamp:a.timestamp,stopPropagation:function(){return a.stopPropagation()}}};d.prototype.wrapGamepad=function(a){var b=a.data,c=b.state;return{type:"gamepad",device:b.device,timestamp:a.timestamp,action:b.action,buttons:c.buttons,axes:c.axes,stopPropagation:function(){return a.stopPropagation()}}};
return d}(b.InputHandler)})},"esri/views/input/handlers/PreventContextMenu":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../InputHandler"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(a){function b(){var b=a.call(this,!0)||this;b.registerIncoming("context-menu",function(a){a.data.native.preventDefault()});return b}c(b,a);return b}(a.InputHandler);g.PreventContextMenu=n;g.default=n})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../../../core/Logger ../../../../core/now ../../../../core/PooledArray ../../../../geometry/support/aaBoundingRect ./deconflictorDebug ../../lib/gl-matrix ../../support/mathUtils ../../support/ResourceController ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/Util ../../webgl-engine/materials/HUDMaterial ../../webgl-engine/materials/internal/MaterialUtil".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){function t(a){return!!a&&"selection"===a.type}var v=f.getLogger("esri.views.3d.graphics.Deconflictor"),A=m.vec4d.create(),z=m.vec4d.create(),x=m.vec4d.create(),B=m.vec4d.create(),D=e.create(),C=e.create(),G=new Set,E=function(){function a(a,b){this.creator=a;this.disposer=b;this.list=[];this.currentIndex=0}a.prototype.alloc=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];this.currentIndex>=this.list.length&&this.list.push(new this.creator(a));
return this.list[this.currentIndex++]};a.prototype.freeAll=function(){for(var a=this.currentIndex,b=this.disposer,c=this.list;0<=--a;)b(c[a]);this.currentIndex=0};return a}(),F=function(){function a(){this.graphics3DGraphic=null;this.posView=this.yMax=this.yMin=this.xMax=this.xMin=0;this.graphicsOwner=null;this.id=0}a.release=function(a){a.graphics3DGraphic=null;a.graphicsOwner=null};a.copyMetadata=function(a,b){b.graphics3DGraphic=a.graphics3DGraphic;b.graphicsOwner=a.graphicsOwner;b.iconDeconflictionEnabled=
a.iconDeconflictionEnabled;b.labelDeconflictionEnabled=a.labelDeconflictionEnabled;return b};return a}(),I;(function(a){a[a.Idle=0]="Idle";a[a.Collect=1]="Collect";a[a.Process=2]="Process";a[a.SortIcons=3]="SortIcons";a[a.SortLabels=4]="SortLabels";a[a.Deconflict=5]="Deconflict"})(I||(I={}));n=function(){function c(b){var c=this;this.graphicsOwners=[];this.lastRunTimestamp=0;this.nextRunTimestamp=Number.POSITIVE_INFINITY;this.syncBudget=null;this.state=I.Idle;this.collectIndex=0;this.collectGraphics=
null;this.collectGraphicsIndex=0;this.handles=new a;this.graphicInfosToProcess=new l;this.graphicInfoPool=new E(F,F.release);this.nextGraphicInfoId=0;this.visibleObjects={icons:new l,labels:new l};this.accBinsNumX=15;this.accBinsNumY=20;this.accBinsSizeY=this.accBinsSizeX=0;this.accBins=null;this.accNumTests=0;this.iconMarginFactor=-.1;this.view=b;this.handles.add([b.watch("state.camera",function(){c.setDirty({async:!0,forceMaxIntervalRun:!0})})]);this.frameWorker=b.resourceController.registerFrameWorker(function(a){return c.run(a)})}
c.prototype.destroy=function(){this.handles.destroy();this.handles=null;this.graphicInfoPool.freeAll();this.graphicInfoPool=null;this.frameWorker&&(this.frameWorker.remove(),this.frameWorker=null);this.view=null};c.prototype.addGraphicsOwner=function(a){var b=this,c=null;a.layer&&"function"===typeof a.layer.watch&&(c=a.layer.watch("featureReduction",function(c,d){t(c)?(b._setIconVisibilityFlags(a,!1),b.setDirty()):t(d)&&(b._setIconVisibilityFlags(a,void 0),b.setDirty())}));this.graphicsOwners.push({handle:c,
owner:a});this.setDirty()};c.prototype.removeGraphicsOwner=function(a){for(var b=-1,c=0;c<this.graphicsOwners.length;c++)if(this.graphicsOwners[c].owner===a){b=c;break}0<=b&&((a=this.graphicsOwners[b].handle)&&a.remove(),this.graphicsOwners.splice(b,1),this.setDirty())};Object.defineProperty(c.prototype,"isDirty",{get:function(){return this.nextRunTimestamp!==Number.POSITIVE_INFINITY},enumerable:!0,configurable:!0});c.prototype.setDirty=function(a){var c=a?a.async:!0;a=a?a.forceMaxIntervalRun:!1;
this.state!==I.Idle&&(this.state=I.Idle);var e=b();this.nextRunTimestamp=a&&1E3<e-this.lastRunTimestamp?this.lastRunTimestamp=e:e+200;c||this.syncBudget||(this.syncBudget=new d.Budget(b),this.syncBudget.enabled=!1)};c.prototype.setClean=function(){this.graphicInfoPool.freeAll();this.graphicInfosToProcess.clear();this.nextGraphicInfoId=0;this.state=I.Idle;this.lastRunTimestamp=b();this.nextRunTimestamp=Number.POSITIVE_INFINITY;this.syncBudget=null};c.prototype.setInitialIconVisibilityFlag=function(a,
b){a=!t(a?a.featureReduction:null);b.setVisibilityFlag(2,a)};c.prototype.doesIntersectExistingPoly=function(a){var b=a.graphics3DGraphic.graphic.uid;G.clear();for(var c=Math.floor(a.xMin/this.accBinsSizeX);c<=Math.floor(a.xMax/this.accBinsSizeX);c++)if(!(0>c||c>=this.accBinsNumX))for(var d=Math.floor(a.yMin/this.accBinsSizeY);d<=Math.floor(a.yMax/this.accBinsSizeY);d++)if(!(0>d||d>=this.accBinsNumY))for(var e=this.accBins[c][d],h=0;h<e.length;h++){var f=e.data[h];if(f.graphics3DGraphic.graphic.uid!==
b&&(this.accNumTests++,!(f.xMin>a.xMax||f.xMax<a.xMin||f.yMin>a.yMax||f.yMax<a.yMin)))return!0}return!1};c.prototype.initBins=function(a,b){if(null==this.accBins){this.accBins=[];for(var c=0;c<this.accBinsNumX;c++){this.accBins.push([]);for(var d=this.accBins[this.accBins.length-1],e=0;e<this.accBinsNumY;e++)d.push(new l({initialSize:10}))}}for(c=0;c<this.accBinsNumX;c++)for(e=0;e<this.accBinsNumY;e++)this.accBins[c][e].clear();this.accBinsSizeX=a/this.accBinsNumX;this.accBinsSizeY=b/this.accBinsNumY;
this.accNumTests=0};c.prototype.addToBins=function(a){for(var b=Math.floor(a.xMin/this.accBinsSizeX);b<=Math.floor(a.xMax/this.accBinsSizeX);b++)if(!(0>b||b>=this.accBinsNumX))for(var c=Math.floor(a.yMin/this.accBinsSizeY);c<=Math.floor(a.yMax/this.accBinsSizeY);c++)0>c||c>=this.accBinsNumY||this.accBins[b][c].push(a)};c.prototype.run=function(a){if(this.view.ready&&!(a.now()<this.nextRunTimestamp))switch(h.prepare(this.view),this.syncBudget&&(a=this.syncBudget),this.state){case I.Idle:this.collectIndex=
0,this.collectGraphics=null,this.visibleObjects.icons.clear(),this.visibleObjects.labels.clear(),this.graphicInfosToProcess.clear();case I.Collect:this.state=I.Collect;if(!this._collectVisibleObjects(a))break;if(0===this.graphicInfosToProcess.length){this.setClean();break}case I.Process:this.state=I.Process;if(a.done())break;for(;this.graphicInfosToProcess.length&&!a.done();)this._processVisibleObject(this.graphicInfosToProcess.pop());if(0<this.graphicInfosToProcess.length)break;case I.SortIcons:this.state=
I.SortIcons;if(a.done())break;this.visibleObjects.icons.sort(function(a,b){return a.posView-b.posView});case I.SortLabels:this.state=I.SortLabels;if(a.done())break;this.visibleObjects.labels.sort(function(a,b){return a.posView-b.posView});case I.Deconflict:this.state=I.Deconflict,a.done()||(this._deconflictVisibleObjects(this.visibleObjects.icons,!1,a),this.visibleObjects.labels.length&&this._deconflictVisibleObjects(this.visibleObjects.labels,!0,a),h.drawAccelerationStruct(this,this.visibleObjects.icons),
h.drawAccelerationStruct(this,this.visibleObjects.labels),0===this.visibleObjects.icons.length&&0===this.visibleObjects.labels.length&&this.setClean())}};c.prototype._collectVisibleObjects=function(a){for(var b=this.view.state.camera,c=b.fullWidth,b=b.fullHeight;this.collectIndex<this.graphicsOwners.length;++this.collectIndex){var d=this.graphicsOwners[this.collectIndex].owner,e=d.graphics3DGraphics;if(e){var h=d.labelsEnabled,f=t(d.layer?d.layer.featureReduction:null);if(h||f)if(this.collectGraphics||
(this.collectGraphics=d.graphics3DGraphicsKeys,this.collectGraphicsIndex=0),this.collectGraphics){if(this.collectGraphics!==d.graphics3DGraphicsKeys)return this.collectIndex=0,this.collectGraphics=null,!1;for(;this.collectGraphicsIndex<this.collectGraphics.length&&!a.done();++this.collectGraphicsIndex){var k=e[this.collectGraphics[this.collectGraphicsIndex]];if(k&&k.areVisibilityFlagsSet(void 0,2)){var l=this.graphicInfoPool.alloc();l.id=this.nextGraphicInfoId++;l.graphicsOwner=d;l.graphics3DGraphic=
k;l.iconDeconflictionEnabled=f;l.labelDeconflictionEnabled=h;this.graphicInfosToProcess.push(l)}}this.collectGraphicsIndex>=this.collectGraphics.length&&(this.collectGraphics=null)}}}if(this.collectIndex===this.graphicsOwners.length&&!this.collectGraphics){this.collectIndex=0;if(0===this.graphicInfosToProcess.length)return!0;this.initBins(c,b);return!0}this.collectGraphics&&--this.collectIndex;return!1};c.prototype._processVisibleObject=function(a){var b=this.view.state.camera;a.iconDeconflictionEnabled&&
this._collectGraphics(a,b,0);a.labelDeconflictionEnabled&&(a=a.iconDeconflictionEnabled?F.copyMetadata(a,this.graphicInfoPool.alloc()):a,a.id=this.nextGraphicInfoId++,this._collectGraphics(a,b,1))};c.prototype._collectGraphics=function(a,b,c){var d=a.graphics3DGraphic,h=a.graphicsOwner,f=1===c,l=f?this.visibleObjects.labels:this.visibleObjects.icons,m=f?d._labelGraphics:d._graphics,f=f?0:this.iconMarginFactor;if(m.length){for(var t=e.empty(D),g,n,G=0;G<m.length;G++){var F=m[G];if(F&&"object3d"===
F.type){var E=F.stageObject,I=E?E.getNumGeometryRecords():0;if(!(1>I)){var H=E.getGeometryRecord(0),M=H.materials[0];if(M instanceof r)if(1<I)v.warn("Graphic objects with more than 1 geometry record are not supported");else{I=H.geometry.data.getVertexAttr();if(!n){n=E.getCenter();H=H.origin.vec3;u.transformToWorld(n,H,A);u.transformToView(A,H,b.viewMatrix,z);M.applyVerticalOffsetTransformation(z,I[p.VertexAttrConstants.NORMAL].data,E.objectTransformation,b,K);E=I[p.VertexAttrConstants.AUXPOS1].data;
H="screen"!==M.getParams().centerOffsetUnits;u.transformToProjection(z,b.projectionMatrix,H?E:[0,0,0],x);n=u.transformToNDC(x,B);H||(n[0]+=E[0]/b.fullWidth*2,n[1]+=E[1]/b.fullHeight*2);if(-1>n[0]||-1>n[1]||-1>n[2]||1<=n[0]||1<=n[1])break;g=z[2];d.areVisibilityFlagsSet(2,void 0,c)&&(g*=.7)}F=F.getScreenSize(N);q.applyPrecomputedScaleFactorVec2(F,K.factor,F);M=e.offset(M.calculateRelativeScreenBounds(F,K.scaleAlignment,C),k.lerp(0,b.fullWidth,.5+.5*n[0]),k.lerp(0,b.fullHeight,.5+.5*n[1]));0!==f&&(F=
f*Math.min(e.width(M),e.height(M)),M[0]-=F,M[1]-=F,M[2]+=F,M[3]+=F);e.expand(t,M)}}}}null!=g&&(a.xMin=t[0],a.yMin=t[1],a.xMax=t[2],a.yMax=t[3],a.graphics3DGraphic=d,a.posView=g,a.graphicsOwner=h,l.push(a))}};c.prototype._deconflictVisibleObjects=function(a,b,c){for(var d=b?1:0;0<a.length&&!c.done();){var e=a.pop(),f=e.graphics3DGraphic,k=!(b&&!1===f.areVisibilityFlagsSet(2))&&!this.doesIntersectExistingPoly(e);k&&this.addToBins(e);f.setVisibilityFlag(2,k,d);b&&this.view.labeler.setLabelGraphicVisibility(f,
k);h.drawPoly(e,k?"green":"red")}};c.prototype._setIconVisibilityFlags=function(a,b){var c=a.graphics3DGraphics;a=a.graphics3DGraphicsKeys;if(null!=c&&null!=a)for(var d=0;d<a.length;d++)c[a[d]].setVisibilityFlag(2,b)};return c}();var K={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},N=m.vec2d.create();return n})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/debugFlags"],
function(n,g,c,a){function f(a,b,c,f,l){var d=e.height,k=h;k.beginPath();k.lineWidth=1;k.strokeStyle=l;k.moveTo(a,d-c);k.lineTo(b,d-c);k.stroke();k.lineTo(b,d-f);k.stroke();k.lineTo(b,d-c);k.stroke();k.lineTo(a,d-c);k.stroke();k.lineTo(a,d-c);k.stroke();k.closePath()}Object.defineProperty(g,"__esModule",{value:!0});var b=!1,l=!1,e,h;g.drawAccelerationStruct=function(a,b){if(l&&h){for(var c=h,e=0,k=0;k<a.accBinsNumX;k++)for(var m=0;m<a.accBinsNumY;m++){var g=a.accBins[k][m],e=e+g.length,t=k*a.accBinsSizeX,
v=(k+1)*a.accBinsSizeX,A=m*a.accBinsSizeY,z=(m+1)*a.accBinsSizeY;c.fillText(g.length.toFixed(),t+5,A+15);f(t,v,A,z,"blue")}c.fillText("total totalShownLabels: "+e,70,40);c.fillText("total visible labels: "+b.length,70,50);c.fillText("total numTests: "+a.accNumTests,70,30)}};g.prepare=function(c){b=a.DECONFLICTOR_SHOW_OUTLINES;l=a.DECONFLICTOR_SHOW_GRID;if(b||l)null==e&&(e=document.createElement("canvas"),e.setAttribute("id","canvas2d"),c.surface.parentElement.style.position="relative",c.surface.parentElement.appendChild(e)),
e.setAttribute("width",c.width+"px"),e.setAttribute("height",c.height+"px"),e.setAttribute("style","position:absolute;left:0px;top:0px;display:block;pointer-events:none;"),h=e.getContext("2d"),h.clearRect(0,0,c.width,c.height),h.font="8px Arial"};g.drawPoly=function(a,c){b&&f(a.xMin,a.xMax,a.yMin,a.yMax,c)}})},"esri/views/3d/support/debugFlags":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b){return new (function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a.SCENEVIEW_HITTEST_RETURN_SELECTOR=!1;a.SCENEVIEW_LOCKING_LOG=!1;a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED=!1;a.HIGHLIGHTS_VISUALIZE_BLOCKS=!1;a.HIGHLIGHTS_PROFILE_TO_CONSOLE=!1;a.DECONFLICTOR_SHOW_OUTLINES=!1;a.DECONFLICTOR_SHOW_GRID=!1;a.LABELS_SHOW_BORDER=!1;a.OVERLAY_DRAW_TEST_TEXTURE=!1;a.OVERLAY_SHOW_CENTER=!1;a.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS=!1;a.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES=
!1;a.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES=!1;a.DRAW_MESH_GEOMETRY_NORMALS=!1;a.FEATURE_TILE_FETCH_SHOW_TILES=!1;a.FEATURE_TILE_TREE_SHOW_TILES=!1;a.ENABLE_PROFILE_DEPTH_RANGE=!1;return a}c(e,f);a([b.property()],e.prototype,"SCENEVIEW_HITTEST_RETURN_SELECTOR",void 0);a([b.property()],e.prototype,"SCENEVIEW_LOCKING_LOG",void 0);a([b.property()],e.prototype,"HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED",void 0);a([b.property()],e.prototype,"HIGHLIGHTS_VISUALIZE_BLOCKS",void 0);a([b.property()],e.prototype,
"HIGHLIGHTS_PROFILE_TO_CONSOLE",void 0);a([b.property()],e.prototype,"DECONFLICTOR_SHOW_OUTLINES",void 0);a([b.property()],e.prototype,"DECONFLICTOR_SHOW_GRID",void 0);a([b.property()],e.prototype,"LABELS_SHOW_BORDER",void 0);a([b.property()],e.prototype,"OVERLAY_DRAW_TEST_TEXTURE",void 0);a([b.property()],e.prototype,"OVERLAY_SHOW_CENTER",void 0);a([b.property()],e.prototype,"TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS",void 0);a([b.property()],e.prototype,"DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES",
void 0);a([b.property()],e.prototype,"DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES",void 0);a([b.property()],e.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);a([b.property()],e.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);a([b.property()],e.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);a([b.property()],e.prototype,"ENABLE_PROFILE_DEPTH_RANGE",void 0);return e=a([b.subclass()],e)}(b.declared(f)))})},"esri/views/3d/support/ResourceController":function(){define("require exports ../../../core/Handles ../../../core/now ../../../core/scheduling ./MemoryController ./StreamDataLoader ./StreamDataSupplier ../webgl-engine/lib/Util".split(" "),
function(n,g,c,a,f,b,l,e,h){function m(){var a={},b;for(b in k.ClientType)a[k.ClientType[b]]=0;a[k.ClientType.TERRAIN]=15;a[k.ClientType.SCENE]=20;a[k.ClientType.SYMBOLOGY]=5;return new l(a)}var k=function(){function d(e,h,k){void 0===h&&(h=f);void 0===k&&(k=a);var l=this;this._view=e;this._memoryController=this._budget=null;this._streamDataLoader=m();this._frameWorkers=[];this._nextFrameWorker=0;this._idleWorkers=[];this._nextIdleWorker=0;this._idleUpdatesStartFired=!1;this._lastTargetChangeTime=
0;this._handles=new c;this._frameTask=null;this.idleTimeout=300;this.idleBudget=100;this._budget=new d.Budget(k);this._lastTargetChangeTime=k();this._memoryController=new b(this._view);this._handles.add(this._view.watch("state.camera",function(){return l.cameraChangedHandler()},!0));this._frameTask=h.addFrameTask({update:function(a){return l.frameUpdate(a)}})}d.prototype.destroy=function(){this._frameTask&&(this._frameTask.remove(),this._frameTask=null);this._handles.remove();this._streamDataLoader&&
(this._streamDataLoader.destroy(),this._streamDataLoader=null)};Object.defineProperty(d.prototype,"enableBudget",{set:function(a){this._budget.enabled=a},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"updating",{get:function(){return this._memoryController.updating},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"maxGpuMemory",{set:function(a){this._memoryController.setMaxGpuMemory(a)},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"additionalCacheMemory",
{set:function(a){this._memoryController.setAdditionalCacheMemory(a)},enumerable:!0,configurable:!0});d.prototype.setMemoryDirty=function(){this._memoryController.setDirty()};Object.defineProperty(d.prototype,"memoryFactor",{get:function(){return this._memoryController.getMemoryFactor()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"usedMemory",{get:function(){return this._memoryController.getUsedMemory()},enumerable:!0,configurable:!0});Object.defineProperty(d.prototype,"memoryEvents",
{get:function(){return this._memoryController.events},enumerable:!0,configurable:!0});d.prototype.getMemCache=function(a,b){return this._memoryController.getMemCache(a,b)};d.prototype.getStreamDataSupplier=function(a,b){return new e(a,this._streamDataLoader,b)};d.prototype.registerIdleFrameWorker=function(a){var b=this;h.assert(!a.idleFrame||a.needsUpdate,"needsUpdate has to be specified if idleFrame is specified");var c={callbacks:a};this.addIdleFrameWorker(c);return{remove:function(){b.removeIdleFrameWorker(c)}}};
d.prototype.registerFrameWorker=function(a){var b=this,c={callback:a};this.addFrameWorker(c);return{remove:function(){b.removeFrameWorker(c)}}};d.prototype.addIdleFrameWorker=function(a){this._idleWorkers.push(a);this.isIdle()&&this._idleUpdatesStartFired&&a.callbacks.idleBegin&&a.callbacks.idleBegin()};d.prototype.removeIdleFrameWorker=function(a){var b=this._idleWorkers,c=b.indexOf(a);h.assert(0<=c,"worker not registered");this._idleUpdatesStartFired&&a.callbacks.idleEnd&&a.callbacks.idleEnd();
b.splice(c,1);this._nextIdleWorker>=b.length&&(this._nextIdleWorker=0)};d.prototype.addFrameWorker=function(a){this._frameWorkers.push(a)};d.prototype.removeFrameWorker=function(a){var b=this._frameWorkers;a=b.indexOf(a);h.assert(0<=a,"worker not registerted");b.splice(a,1);this._nextFrameWorker>=this._frameWorkers.length&&(this._nextFrameWorker=0)};d.prototype.cameraChangedHandler=function(){this._lastTargetChangeTime=this._budget.now();this.setMemoryDirty();this._idleUpdatesStartFired&&(this._idleUpdatesStartFired=
!1,this.callIdleFrameWorkersEnd())};d.prototype.frameUpdate=function(a){var b=this.isIdle()?0:5,c=a.frameDuration-a.elapsedFrameTime-b,d=this.idleBudget-a.elapsedFrameTime;this._view._stage&&!this._view._stage.getIdleSuspend()&&(d=c);c=Math.max(this.isIdle()?d:c,5);this._budget.reset(c);this._view.stateManager&&this._view.stateManager.step(a.deltaTime/1E3);this._memoryController.update();for(a=0;a<this._frameWorkers.length;++a)if(c=(this._nextFrameWorker+a)%this._frameWorkers.length,this._frameWorkers[c].callback(this._budget),
this._budget.remaining()<b){this._nextFrameWorker=(c+1)%this._frameWorkers.length;break}this.isIdle()&&!this._budget.done()&&(this._idleUpdatesStartFired||(this._idleUpdatesStartFired=!0,this.callIdleFrameWorkersBegin()),this.callIdleFrameWorkers())};d.prototype.isIdle=function(){return this._budget.now()-this._lastTargetChangeTime>this.idleTimeout};d.prototype.callIdleFrameWorkersBegin=function(){this._idleWorkers.forEach(function(a){a.callbacks.idleBegin&&a.callbacks.idleBegin()})};d.prototype.callIdleFrameWorkersEnd=
function(){this._idleWorkers.forEach(function(a){a.callbacks.idleEnd&&a.callbacks.idleEnd()})};d.prototype.callIdleFrameWorkers=function(){for(var a=0;a<this._idleWorkers.length;++a){var b=(this._nextIdleWorker+a)%this._idleWorkers.length;if(this._budget.done()){this._nextIdleWorker=b;break}b=this._idleWorkers[b];b.callbacks.needsUpdate&&b.callbacks.needsUpdate()&&b.callbacks.idleFrame(this._budget)}};return d}();(function(a){(function(a){a.TERRAIN="terrain";a.SCENE="scene";a.SYMBOLOGY="symbology"})(a.ClientType||
(a.ClientType={}));var b=function(){function a(a){this._nowFunc=a;this.enabled=!0;this.budget=this.begin=0}a.prototype.now=function(){return this._nowFunc()};a.prototype.reset=function(a){this.begin=this.now();this.budget=this.enabled?a:Number.MAX_VALUE};a.prototype.done=function(){return this.enabled&&this.elapsed()>=this.budget};a.prototype.remaining=function(){return this.enabled?Math.max(this.budget-this.elapsed(),0):Number.POSITIVE_INFINITY};a.prototype.elapsed=function(){return this.now()-this.begin};
return a}();a.Budget=b})(k||(k={}));return k})},"esri/views/3d/support/MemoryController":function(){define("require exports ../../../core/Logger ../layers/support/MemoryManagedLayerView ./Evented ./MemCache".split(" "),function(n,g,c,a,f,b){var l=c.getLogger("esri.views.3d.support.MemoryController");return function(){function c(a){this._view=a;this._minQuality=.1;this._memoryHWM=this._maxQuality=1;this._memoryLWM=.75;this._divideRate=1.3;this._throttle=5;this.events=new f.Evented;this._maxMemory=
500;this._additionalCacheMemory=100;this._quality=1;this._memoryCommitted=this._memoryUsed=this._throttled=this._stableQuality=0;this._cacheStorage=new b.Storage;this.updating=!1}c.prototype.getMemCache=function(a,c){return new b(a,this._cacheStorage,c)};c.prototype.setMaxGpuMemory=function(a){null!=a&&0<a&&(this._maxMemory=a,this.setDirty())};c.prototype.setAdditionalCacheMemory=function(a){null!=a&&0<=a&&(this._additionalCacheMemory=a,this.setDirty())};c.prototype.disableMemCache=function(){this._additionalCacheMemory=
-4096};c.prototype.getMemoryFactor=function(){return this._quality};c.prototype._updateQuality=function(a){a=Math.min(Math.max(a,this._minQuality),this._maxQuality);if(a===this._quality)return!1;this._quality=a;this.events.emit("quality-changed",this._quality);return!0};c.prototype.getUsedMemory=function(){return this._memoryUsed};c.prototype.setDirty=function(){this._stableQuality=0};c.prototype.update=function(){this._updateMemory();if(!(0>=this._memoryCommitted)){this._throttled=Math.max(0,this._throttled-
1);var a=this._layersUpdating();if(a){if(this._quality<=this._minQuality)return;if(this._memoryCommitted>1.1*this._memoryHWM||this._memoryUsed>this._memoryHWM)if(0<this._stableQuality)this._updateQuality(this._stableQuality);else if(0===this._throttled||1.05<this._memoryUsed)this._updateQuality(this._quality/this._divideRate),this._throttled=this._throttle}else this._memoryUsed>this._memoryHWM&&(this._stableQuality=0,a=this._updateQuality(this._quality/this._divideRate)),this._memoryCommitted<this._memoryLWM&&
this._quality<this._maxQuality&&this._stableQuality!==this._quality&&(this._stableQuality=this._quality,a=this._updateQuality(this._quality+.1*(this._memoryLWM-this._memoryCommitted+.1)));this.updating!==a&&(this.updating=a,this.events.emit("updating-changed",this.updating))}};c.prototype._layersUpdating=function(){var a=!1;this._view.allLayerViews.forEach(function(b){a=a||b.updating});return a};c.prototype._updateMemory=function(){var b=0,c=0;this._view.basemapTerrain&&this._view.basemapTerrain.getUsedMemory&&
(b+=this._view.basemapTerrain.getUsedMemory());var e=this._view._stage&&this._view._stage.view&&this._view._stage.view.getEdgeView();e&&(b+=e.getGpuMemoryUsage());this._view.allLayerViews&&this._view.allLayerViews.forEach(function(d){a.isMemoryManagedLayerView(d)&&(b+=d.getUsedMemory(),c+=d.getUnloadedMemory())});var d=null==this._warnMemoryUsage||Math.round(10*b)!==Math.round(10*this._warnMemoryUsage),e=1048576*this._maxMemory;if(b>e&&d){this._warnMemoryUsage=b;var d=function(a){return(a/1048576).toLocaleString(void 0,
{maximumFractionDigits:1})+" MB"},f=Math.round(100*this._quality);l.warn("GPU Memory Limit exceeded! Limit: "+d(e)+" Current: "+d(b)+" Projected: "+d(b+c)+" Quality: "+f+"%")}this._memoryUsed=b/e;this._memoryCommitted=(b+c)/e;this._cacheStorage.maxSize=Math.max(0,e-b+1048576*this._additionalCacheMemory);this.events.emit("memory-used",this._memoryUsed)};return c}()})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,
"__esModule",{value:!0});g.isMemoryManagedLayerView=function(c){return"function"===typeof c.getUsedMemory}})},"esri/views/3d/support/Evented":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(){this._listeners={}}c.prototype.hasEventListener=function(a){return null!=this._listeners[a]&&0<this._listeners[a].size};c.prototype.on=function(a,c){var b=this;null==this._listeners[a]&&(this._listeners[a]=new Map);var f={};this._listeners[a].set(f,
c);return{remove:function(){return b._listeners[a].delete(f)}}};c.prototype.emit=function(a,c){null!=this._listeners[a]&&this._listeners[a].forEach(function(a){return a(c)})};return c}();g.Evented=n})},"esri/views/3d/support/MemCache":function(){define(["require","exports","../../../core/lang","../../../core/PooledArray"],function(n,g,c,a){var f=new a;n=function(){function a(a,b,c){this._namespace=a;this._storage=b;this._priority=0;this._removeFunc=!1;this._miss=this._hit=0;f.push(this);this._namespace+=
":";c&&(this._storage.registerRemoveFunc(this._namespace,c),this._removeFunc=!0)}Object.defineProperty(a.prototype,"priority",{get:function(){return this._priority},set:function(a){isNaN(a)||(this._priority=Math.max(0,a))},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"namespace",{get:function(){return this._namespace.slice(0,-1)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"hitRate",{get:function(){return this._hit/(this._hit+this._miss)},enumerable:!0,configurable:!0});
a.prototype.resetHitRate=function(){this._hit=this._miss=0};a.prototype.destroy=function(){this._storage.clear(this._namespace);this._removeFunc&&this._storage.deregisterRemoveFunc(this._namespace);f.removeUnordered(this)};a.prototype.put=function(a,b,c){this._storage.put(this._namespace+a,b,c,this._priority)};a.prototype.pop=function(a){a=this._storage.pop(this._namespace+a);void 0===a?++this._miss:++this._hit;return a};a.prototype.clear=function(){this._storage.clear(this._namespace)};a.prototype.clearAll=
function(){this._storage.clearAll()};a.prototype.getSize=function(){return this._storage.getSize()};a.prototype.getMaxSize=function(){return this._storage.maxSize};a.prototype.getStats=function(){return this._storage.getStats()};a.prototype.resetStats=function(){this._storage.resetStats()};return a}();(function(a){var b=function(){function a(){this._db=new Map;this._miss=this._hit=this._age=this._size=0;this._maxSize=10485760;this._removeFuncs=[]}a.prototype.registerRemoveFunc=function(a,b){this._removeFuncs.push([a,
b])};a.prototype.deregisterRemoveFunc=function(a){this._removeFuncs=this._removeFuncs.filter(function(b){return b[0]!==a})};Object.defineProperty(a.prototype,"maxSize",{get:function(){return this._maxSize},set:function(a){this._maxSize=Math.max(a,0);this._size>this._maxSize&&this._removeEntries()},enumerable:!0,configurable:!0});a.prototype.put=function(a,b,c,d){if(c>this._maxSize){if(this._db.has(a)){var e=this._db.get(a);this._size-=e.size;this._db.delete(a)}this._notifyRemoved(a,b)}else!c||0>c?
console.warn("Refusing to cache entry with invalid size "+c):(this._db.has(a)?(e=this._db.get(a),this._notifyRemoved(a,e.entry),this._size+=c-e.size,e.entry=b,e.lastUsed=this._age+d,e.size=c):(this._db.set(a,{entry:b,size:c,lastUsed:this._age+d}),this._size+=c),++this._age,this._size>this._maxSize&&this._removeEntries())};a.prototype.pop=function(a){if(this._db.has(a)){var b=this._db.get(a);this._size-=b.size;this._db.delete(a);++this._hit;return b.entry}++this._miss};a.prototype.getSize=function(){return this._size};
a.prototype.getStats=function(){var a=this,b={Size:Math.round(this._size/1048576)+"/"+Math.round(this._maxSize/1048576)+"MB","Hit rate":Math.round(100*this._getHitRate())+"%",Entries:this._db.size.toString()},e={},d=this._age,l=this._age;this._db.forEach(function(a,b){d=Math.min(d,a.lastUsed);l=Math.max(l,a.lastUsed);f.forEach(function(d){d=d.namespace;if(c.startsWith(b,d))return e[d]=(e[d]||0)+a.size,!1})});b.Entries+=" / "+d+" - "+l;var p={};f.forEach(function(a){var b=a.namespace;!isNaN(a.hitRate)&&
0<a.hitRate?(e[b]=e[b]||0,p[b]=Math.round(100*a.hitRate)+"%"):p[b]="0%"});var g=Object.keys(e);g.forEach(function(b){return e[b]=e[b]/a._size*100});g.sort(function(a,b){return e[b]-e[a]});g.forEach(function(a){return b[a]=Math.round(e[a])+"% / "+p[a]});return b};a.prototype.resetStats=function(){this._hit=this._miss=0;f.forEach(function(a){return a.resetHitRate()})};a.prototype.clear=function(a){var b=this;this._db.forEach(function(e,d){c.startsWith(d,a)&&(b._size-=e.size,b._db.delete(d),b._notifyRemoved(d,
e.entry))})};a.prototype.clearAll=function(){var a=this;this._db.forEach(function(b,c){a._notifyRemoved(c,b.entry)});this._size=0;this._db.clear()};a.prototype._getHitRate=function(){return this._hit/(this._hit+this._miss)};a.prototype._notifyRemoved=function(a,b){this._removeFuncs.forEach(function(e){if(c.startsWith(a,e[0]))e[1](b)})};a.prototype._removeEntries=function(){var a=[];this._db.forEach(function(b,c){a.push([b.lastUsed,c])});a.sort(function(a,b){return a[0]-b[0]});for(var b=0;b<a.length;b++){var c=
a[b][1],d=this._db.get(c);this._size-=d.size;this._db.delete(c);this._notifyRemoved(c,d.entry);if(this._size<=.9*this.maxSize)break}};return a}();a.Storage=b})(n||(n={}));return n})},"esri/views/3d/support/StreamDataLoader":function(){define("require exports ../../../request ../../../core/arrayUtils ../../../core/lang ./AsyncQuotaRoundRobinQueue ./PromiseLightweight ../webgl-engine/lib/Performance ../webgl-engine/lib/Util".split(" "),function(n,g,c,a,f,b,l,e,h){var m;(function(a){a[a.QUEUED=1]="QUEUED";
a[a.DOWNLOADING=2]="DOWNLOADING";a[a.CANCELLED=4]="CANCELLED"})(m||(m={}));return function(){function k(a){this.tasks=new Map;this.clientPromiseToTask=new Map;this.loadQueue=new b(this.startLoading.bind(this),this.doneLoadingCallback,this,a)}k.prototype.destroy=function(){var a=this;this.tasks.forEach(function(b){for(var c=0,d=b.clientPromises;c<d.length;c++){var e=d[c];e.isRejected()||e.reject(b.url,null);a.cancelTask(e)}});this.loadQueue.clear();this.clientPromiseToTask=this.tasks=this.loadQueue=
null};k.prototype.request=function(a,b,c){var d=this,e=new l.Promise(function(){d.cancel(e)});this.createOrUpdateTask(a,b,c,e);return e};k.prototype.createTask=function(a,b,c,e,f){a={url:a,docType:b,clientType:c,key:e,result:null,status:m.QUEUED,clientPromises:[],downloadObj:null,_cancelledInQueue:!1,startTime:0,duration:0,size:0};this.updateTask(a,f);this.tasks.set(e,a);this.loadQueue.push(a)};k.prototype.cancel=function(a){this.cancelTask(a)};k.prototype.hasPendingDownloads=function(){return 0<
this.tasks.size};Object.defineProperty(k.prototype,"tests",{get:function(){return{loadQueue:this.loadQueue}},enumerable:!0,configurable:!0});k.prototype.taskKey=function(a,b,c){return a+":"+b+":"+c};k.prototype.updateTask=function(a,b){this.clientPromiseToTask.set(b,a);a.clientPromises.push(b)};k.prototype.createOrUpdateTask=function(a,b,c,e){var d=this.taskKey(a,b,c),f=this.tasks.get(d);f?this.updateTask(f,e):this.createTask(a,b,c,d,e)};k.prototype.cancelTask=function(b){var c=this.clientPromiseToTask.get(b);
c&&(a.removeUnordered(c.clientPromises,b),this.clientPromiseToTask.delete(b),0===c.clientPromises.length&&(c.status===m.DOWNLOADING&&(this.loadQueue.workerCancelled(c),c.status=m.CANCELLED,c.downloadObj.cancel(),c.downloadObj=null),c.status=m.CANCELLED,this.tasks.delete(c.key)))};k.prototype.doneLoadingCallback=function(a,b){h.assert(a.status===m.DOWNLOADING);for(var c=a.result,d=0,e=a.clientPromises;d<e.length;d++){var k=e[d];this.clientPromiseToTask.delete(k);b?k.isRejected()||k.reject(a.url,b):
(c||(c=f.clone(a.result)),k.done(a.url,c),c instanceof HTMLImageElement||(c=null))}this.tasks.delete(a.key)};k.prototype.startLoading=function(a,b){if(a.status===m.CANCELLED)return!1;a.status=m.DOWNLOADING;var d,f;switch(a.docType){case "binary":f="array-buffer";d=0;break;case "image":f="image";break;default:f="json"}a.startTime=e.now();a.downloadObj=c(a.url,{responseType:f,timeout:d});a.downloadObj.then(function(c){a.duration=e.now()-a.startTime;a.size="binary"===a.docType?c.data.byteLength:0;a.result=
c.data;b(a)},function(c){a.downloadObj.isCanceled()||b(a,c)});return!0};return k}()})},"esri/views/3d/support/AsyncQuotaRoundRobinQueue":function(){define(["require","exports","../../../core/arrayUtils","../webgl-engine/lib/Util"],function(n,g,c,a){return function(){function f(a,c,e,f){this.workerFunc=a;this.robin=0;this.type2id={};this.tasks=[];this.typeNumWorkers=[];this.typeWorkerQuota=[];this.typeStatistics=[];this.numTypes=this.maxTotalNumWorkers=this.totalNumWorkers=0;for(var b in f)this.tasks[this.robin]=
[],this.typeNumWorkers[this.robin]=0,this.typeStatistics[this.robin]={requests:0,size:0,duration:0,speed:0},this.typeWorkerQuota[this.robin]=f[b],this.type2id[b]=this.robin++,this.maxTotalNumWorkers+=f[b];this.numTypes=this.tasks.length;this.robin=0;var h=this;this.taskCallback=function(a){a._cancelledInQueue||(c.apply(e,arguments),h.taskFinished(a))}}f.prototype.setWorkerQuota=function(b){a.assert(c.equals(Object.keys(this.typeWorkerAllication),Object.keys(b)));this.typeWorkerAllication=b;this.maxTotalNumWorkers=
0;for(var f in b)this.typeWorkerQuota[this.type2id[f]]=b[f],this.maxTotalNumWorkers+=b[f]};f.prototype.setWorkerFunc=function(a){this.workerFunc=a};f.prototype.push=function(a){var b=this.type2id[a.clientType];this.totalNumWorkers<this.maxTotalNumWorkers?(this.typeNumWorkers[b]++,this.totalNumWorkers++,this.workerFunc(a,this.taskCallback)):this.tasks[b].push(a)};f.prototype._getStatsForType=function(a){a=this.type2id[a];return{quota:this.typeWorkerQuota[a],workers:this.typeNumWorkers[a],queueSize:this.tasks[a].length,
requestStats:this.typeStatistics[a]}};f.prototype.removeTasks=function(a,c){for(var b=[],f=0,l=this.tasks[this.type2id[c]];f<l.length;f++){var k=l[f];-1===a.indexOf(k)&&b.push(k)}this.tasks[this.type2id[c]]=b};f.prototype.workerCancelled=function(a){this.taskFinished(a);a._cancelledInQueue=!0};f.prototype.clear=function(){for(var a=0;a<this.tasks.length;a++)this.tasks[a]=[]};f.prototype.taskFinished=function(b){var c=this.type2id[b.clientType];this.typeNumWorkers[c]--;this.totalNumWorkers--;this.typeStatistics[c].requests++;
this.typeStatistics[c].size+=b.size||0;this.typeStatistics[c].duration+=b.duration||0;this.typeStatistics[c].speed=0<this.typeStatistics[c].duration?this.typeStatistics[c].size/this.typeStatistics[c].duration:0;a.assert(0<=this.typeNumWorkers[c]);this.next()};f.prototype.next=function(){var a=this.robin,c=!1;do this.typeNumWorkers[a]<this.typeWorkerQuota[a]&&this.processQueue(a)&&(c=!0),a=(a+1)%this.numTypes;while(!c&&a!==this.robin);if(!c){do this.processQueue(a)&&(c=!0),a=(a+1)%this.numTypes;while(!c&&
a!==this.robin)}this.robin=a};f.prototype.processQueue=function(a){for(;0<this.tasks[a].length;)if(this.workerFunc(this.tasks[a].shift(),this.taskCallback))return this.typeNumWorkers[a]++,this.totalNumWorkers++,!0;return!1};return f}()})},"esri/views/3d/support/PromiseLightweight":function(){(function(n){function g(a){this._callbacks=[];this._errbacks=[];this._cancelCallback=a;this._iserr=this._isdone=this._iscancelled=!1}function c(a,b){var f=new g;0===a.length?f.done.apply(f,b):a[0].apply(null,
b).then(function(){a.splice(0,1);c(a,arguments).then(function(){f.done.apply(f,arguments)})});return f}g.prototype.cancel=function(a){this._callbacks=[];this._errbacks=[];this._iscancelled=!0;this._cancelCallback&&this._cancelCallback(a)};g.prototype.then=function(a,b,c){var e;if(!this._iscancelled)return this._isdone?e=a.apply(c,this.result):this._iserr&&b?e=b.apply(c,this.result):(this._callbacks.push(function(){return a.apply(c,arguments)}),b&&this._errbacks.push(function(){return b.apply(c,arguments)})),
e};g.prototype.done=function(){this.result=arguments;this._isdone=!0;for(var a=0;a<this._callbacks.length;a++)this._callbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=[]};g.prototype.resolve=g.prototype.done;g.prototype.reject=function(){if(!this._iscancelled){this.result=arguments;this._iserr=!0;for(var a=0;a<this._errbacks.length;a++)this._errbacks[a].apply(null,arguments);this._callbacks=[];this._errbacks=[]}};g.prototype.isRejected=function(){return this._iserr};g.prototype.isFulfilled=
function(){return this._isdone||this._iserr};g.prototype.isResolved=function(){return this._isdone};g.prototype.isCancelled=function(){return this._iscancelled};var a={Promise:g,join:function(a){function b(a,b){return function(){b&&(k=!0);f+=1;m[a]=Array.prototype.slice.call(arguments);f===e&&(k?c.reject():c.done(m))}}for(var c=new g,e=a.length,f=0,m=[],k=!1,d=0;d<e;d++)a[d].then(b(d,!1),b(d,!0));0===a.length&&c.done();return c},chain:c};"function"===typeof define&&define.amd?define(function(){return a}):
n.promise=a})(this)},"esri/views/3d/support/StreamDataSupplier":function(){define(["require","exports"],function(n,g){return function(){function c(a,c,b){this._clientType=a;this._loader=c;this._activeRequests=null;b&&b.trackRequests&&(this._activeRequests=new Map)}c.prototype.request=function(a,c){var b=this;c=this._loader.request(a,c,this._clientType);if(this._activeRequests){this._activeRequests.set(a,c);var f=function(){b._activeRequests.delete(a)};c.then(f,f)}return c};c.prototype.cancelRequest=
function(a){this._loader.cancel(a)};c.prototype.cancelAll=function(){var a=this;this._activeRequests&&(this._activeRequests.forEach(function(c){a._loader.cancel(c)}),this._activeRequests.clear())};c.prototype.hasPendingDownloads=function(){return this._loader.hasPendingDownloads()};return c}()})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["require","exports","../../support/earthUtils","../../support/mathUtils"],function(n,g,c,a){function f(a){return Math.abs(a*
a*a)}function b(a,b,c,e){void 0===e&&(e=d);var h=c.parameters;c=c.paddingPixelsOverride;e.scale=Math.min(h.divisor/(b-h.offset),1);e.factor=f(a);e.minPixelSize=h.minPixelSize;e.paddingPixels=c;return e}function l(a,b){return 0===a?b.minPixelSize:b.minPixelSize*(1+2*b.paddingPixels/a)}function e(b,c){return Math.max(a.lerp(b*c.scale,b,c.factor),l(b,c))}function h(a,c,d){a=b(a,c,d);a.minPixelSize=0;a.paddingPixels=0;return e(1,a)}Object.defineProperty(g,"__esModule",{value:!0});g.getSettings=function(a){return new m(a,
g.defaultDescription)};g.getLabelSettings=function(a){var b=g.defaultDescription.curvatureDependent;return new m(a,{curvatureDependent:{min:{curvature:b.min.curvature,tiltAngle:b.min.tiltAngle,scaleFallOffFactor:k.curvatureDependent.min.scaleFallOffFactor},max:{curvature:b.max.curvature,tiltAngle:b.max.tiltAngle,scaleFallOffFactor:k.curvatureDependent.max.scaleFallOffFactor}},scaleStart:g.defaultDescription.scaleStart,scaleFallOffRange:g.defaultDescription.scaleFallOffRange,minPixelSize:k.minPixelSize})};
g.perspectiveFactor=f;g.scaleFactor=b;g.applyScaleFactor=e;g.applyScaleFactorVec2=function(b,c,d){void 0===d&&(d=[0,0]);var e=Math.min(Math.max(c.scale,l(b[1],c)/b[1]),1);d[0]=a.lerp(b[0]*e,b[0],c.factor);d[1]=a.lerp(b[1]*e,b[1],c.factor);return d};g.precomputeScale=h;g.precomputeScaleFactor=function(a,b,c,d){d.scale=h(a,b,c);d.factor=0;d.minPixelSize=c.parameters.minPixelSize;d.paddingPixels=c.paddingPixelsOverride;return d};g.applyPrecomputedScaleFactorVec2=function(a,b,c){void 0===c&&(c=[0,0]);
b=Math.min(Math.max(b.scale,l(a[1],b)/a[1]),1);c[0]=a[0]*b;c[1]=a[1]*b;return c};g.scale=function(a,c,d,f){return e(a,b(c,d,f))};var m=function(){function b(a,b,c,d){void 0===c&&(c={camera:{distance:0,fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0});this.viewingMode=a;this.description=b;this.parameters=c;this._paddingPixelsOverride=d;"local"===this.viewingMode?(this.coverageCompensation=this.surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersLocal):
(this.coverageCompensation=this.surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this.calculateCurvatureDependentParametersGlobal)}Object.defineProperty(b.prototype,"paddingPixelsOverride",{get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels},enumerable:!0,configurable:!0});b.prototype.update=function(a){if(this.parameters&&this.parameters.camera.fovY===a.fovY&&this.parameters.camera.distance===a.distance)return!1;this.calculateParameters(a,
this.parameters);return!0};b.prototype.overridePadding=function(a){return a!==this.paddingPixelsOverride?new b(this.viewingMode,this.description,this.parameters,a):this};b.prototype.calculateParameters=function(a,b){var c=this.description,d=c.scaleStart,e=c.scaleFallOffRange,c=c.minPixelSize,f=a.fovY,h=a.distance,k=this.calculateCurvatureDependentParameters(a),l=this.coverageCompensation(a,k),m=k.tiltAngle,k=k.scaleFallOffFactor,h=Math.sin(m)*h,m=.5*Math.PI-m-f*(.5-d*l),d=h/Math.cos(m),e=(d-h/Math.cos(m+
f*e*l)*k)/(1-k);b.camera.fovY=a.fovY;b.camera.distance=a.distance;b.offset=e;b.divisor=d-e;b.minPixelSize=c;return b};b.prototype.calculateCurvatureDependentParametersLocal=function(a,b){void 0===b&&(b=q);b.tiltAngle=this.description.curvatureDependent.min.tiltAngle;b.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;return b};b.prototype.calculateCurvatureDependentParametersGlobal=function(b,d){void 0===d&&(d=q);var e=this.description.curvatureDependent;b=1+b.distance/
c.earthRadius;var f=[e.min.curvature,e.max.curvature],h=f[0];b=a.clamp((Math.sqrt(b*b-1)-h)/(f[1]-h),0,1);f=[e.min,e.max];e=f[0];f=f[1];d.tiltAngle=a.lerp(e.tiltAngle,f.tiltAngle,b);d.scaleFallOffFactor=a.lerp(e.scaleFallOffFactor,f.scaleFallOffFactor,b);return d};b.prototype.surfaceCoverageCompensationLocal=function(a,b){return(a.fovY-b.tiltAngle)/a.fovY};b.prototype.surfaceCoverageCompensationGlobal=function(a,b){var d=c.earthRadius*c.earthRadius;b=b.tiltAngle+.5*Math.PI;var e=a.fovY;a=a.distance;
a=a*a+d-2*Math.cos(b)*a*c.earthRadius;var f=Math.sqrt(a);return(Math.acos(Math.sqrt(a-d)/f)-Math.asin(c.earthRadius/(f/Math.sin(b)))+.5*e)/e};return b}();g.defaultDescription={curvatureDependent:{min:{curvature:a.deg2rad(10),tiltAngle:a.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:a.deg2rad(70),tiltAngle:a.deg2rad(40),scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0};var k={curvatureDependent:{min:{scaleFallOffFactor:.7},max:{scaleFallOffFactor:.95}},minPixelSize:14};
g.copyParameters=function(a,b){b.camera.distance=a.camera.distance;b.camera.fovY=a.camera.fovY;b.divisor=a.divisor;b.offset=a.offset;b.minPixelSize=a.minPixelSize;return b};var d={scale:0,factor:0,minPixelSize:0,paddingPixels:0},q={tiltAngle:0,scaleFallOffFactor:0}})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../geometry/support/aaBoundingRect ../../lib/gl-matrix ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterialTexture ../lib/Material ../lib/RenderPass ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/HUDPrograms".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){function t(a,b){void 0===b&&(b=B);if(a.textureIsSignedDistanceField){var c=a.anchorPos;a=a.distanceFieldBoundingBox;var d=b;d[0]=c[0]*(a[2]-a[0])+a[0];d[1]=c[1]*(a[3]-a[1])+a[1]}else f.vec2d.set(a.anchorPos,b);return b}var v={"bottom-left":[0,0],bottom:[.5,0],"bottom-right":[1,0],left:[0,.5],center:[.5,.5],right:[1,.5],"top-left":[0,1],top:[.5,1],"top-right":[1,1]};n=function(b){function e(a,c){c=b.call(this,c)||this;c._textureDirty=!1;c.params=r.copyParameters(a,
U);"string"===typeof c.params.anchorPos&&(c.params.anchorPos=v[c.params.anchorPos]);c.bufferWriter=new O(c);return c}c(e,b);e.prototype.dispose=function(){};e.prototype.getParameterValues=function(){return r.copyParameters(this.params)};e.prototype.setParameterValues=function(a){for(var b in a)"textureId"===b&&q.assert(!!this.params.textureId,"Can only change texture of material that already has a texture"),this.params[b]=a[b];this.notifyDirty("matChanged")};e.prototype.getParams=function(){return this.params};
e.prototype.intersect=function(a,b,c,e,h,k,m,p){if(e.isSelection&&e.enableHUDSelection&&!l.isAllHidden(b.componentVisibilities,a.data.componentOffsets)){var g=a.data;a=this.params;h=b=1;f.mat4d.toMat3(c,I);if(p){h=p(H);b=h[0];h=h[5];p=I;k=p[0];var u=p[1],r=p[2],B=p[3],v=p[4],z=p[5],A=p[6],L=p[7],Q=p[8],n=1/Math.sqrt(k*k+u*u+r*r),E=1/Math.sqrt(B*B+v*v+z*z),S=1/Math.sqrt(A*A+L*L+Q*Q);p[0]=k*n;p[1]=u*n;p[2]=r*n;p[3]=B*E;p[4]=v*E;p[5]=z*E;p[6]=A*S;p[7]=L*S;p[8]=Q*S}p=g.getVertexAttr()[q.VertexAttrConstants.POSITION];
k=g.getVertexAttr()[q.VertexAttrConstants.SIZE];g=g.getVertexAttr()[q.VertexAttrConstants.NORMAL];q.assert(3<=p.size);u=e.point;r=e.camera;B=t(a);for(v=0;v<p.data.length/p.size;v++)z=v*p.size,f.vec3d.set3(p.data[z],p.data[z+1],p.data[z+2],D),f.mat4d.multiplyVec3(c,D,D),z=v*k.size,T[0]=k.data[z]*b,T[1]=k.data[z+1]*h,f.mat4d.multiplyVec3(r.viewMatrix,D),z=v*g.size,f.vec3d.set3(g.data[z],g.data[z+1],g.data[z+2],C),this.applyVerticalOffsetTransformation(D,C,I,r,x),r.applyProjection(D,G),-1<G[0]&&(z=Math.floor(G[0]),
L=Math.floor(G[1]),d.applyPrecomputedScaleFactorVec2(T,x.factor,T),z=z-M-(0<B[0]?T[0]*B[0]:0),A=z+T[0]+2*M,L=L-M-(0<B[1]?T[1]*B[1]:0),Q=L+T[1]+2*M,a.textureIsSignedDistanceField&&(n=a.outlineSize/2,E=a.distanceFieldBoundingBox,z+=T[0]*E[0],L+=T[1]*E[1],A-=T[0]*(1-E[2]),Q-=T[1]*(1-E[3]),z-=n,A+=n,L-=n,Q+=n),u[0]>z&&u[0]<A&&u[1]>L&&u[1]<Q&&(A=e.p0,L=e.p1,f.mat4d.multiplyVec3(f.mat4d.inverse(r.viewMatrix,K),D,F),G[0]=u[0],G[1]=u[1],r.unprojectPoint(G,D),z=f.vec3d.negate(e.getDirection(),f.vec3d.create()),
A=f.vec3d.dist(A,D)/f.vec3d.dist(A,L),m(A,z,-1,1,!0,F)))}};e.prototype.normalAndViewAngle=function(a,b,c,d){void 0===d&&(d=N);f.mat3d.multiplyVec3(b,a,d.normal);f.mat4d.multiplyVec3(c.viewInverseTransposeMatrix,d.normal);d.cosAngle=f.vec3d.dot(E,V);return d};e.prototype.updateScaleInfo=function(a,b,c){b=this.params;b.screenSizePerspective?a.factor=d.precomputeScaleFactor(N.cosAngle,c,b.screenSizePerspective,a.factor):(a.factor.scale=1,a.factor.factor=0,a.factor.minPixelSize=0,a.factor.paddingPixels=
0);b.screenSizePerspectiveAlignment?(a.scaleAlignment=d.precomputeScale(N.cosAngle,c,b.screenSizePerspectiveAlignment),a.minPixelSizeAlignment=b.screenSizePerspectiveAlignment.parameters.minPixelSize):(a.scaleAlignment=a.factor.scale,a.minPixelSizeAlignment=a.factor.minPixelSize)};e.prototype.applyVerticalOffsetTransformation=function(a,b,c,d,e,h){var k=this.params;16===c.length&&(c=f.mat4d.toMat3(c,I));if(!k.verticalOffset||!k.verticalOffset.screenLength)return e&&(k.screenSizePerspective||k.screenSizePerspectiveAlignment)?
(d=this.normalAndViewAngle(b,c,d),k=f.vec3d.length(a),this.updateScaleInfo(e,d.cosAngle,k)):e&&(e.factor.scale=1,e.scaleAlignment=1),h?f.vec3d.set(a,h):a;b=this.normalAndViewAngle(b,c,d);c=f.vec3d.length(a);d=r.verticalOffsetAtDistance(d,c,k.verticalOffset,b.cosAngle,k.screenSizePerspectiveAlignment||k.screenSizePerspective);e&&this.updateScaleInfo(e,b.cosAngle,c);return f.vec3d.add(a,f.vec3d.scale(b.normal,d),h)};e.prototype.getGLMaterials=function(){return{color:A,depthShadowMap:void 0,normal:void 0,
depth:void 0,highlight:z}};e.prototype.getAllTextureIds=function(){return[this.params.textureId]};e.prototype.setTextureDirty=function(){this._textureDirty=!0};e.prototype.calculateRelativeScreenBounds=function(b,c,d){void 0===d&&(d=a.create());var e=this.params,h=d;void 0===h&&(h=B);f.vec2d.set(e.anchorPos,h);h[0]*=-b[0];h[1]*=-b[1];h[0]+=e.screenOffset[0]*c;h[1]+=e.screenOffset[1]*c;d[2]=d[0]+b[0];d[3]=d[1]+b[1];return d};e.prototype.calculateAnchorPosForRendering=function(a){return t(this.params,
a)};e.shouldRenderVisibilityDuringRenderPass=function(a){return a===m.MATERIAL||m.MATERIAL_HIGHLIGHT};return e}(h);e=function(a){function b(b,c,d){c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=r.copyParameters(b.getParams());c.selectProgram();c.selectSlot();return c}c(b,a);b.prototype.selectSlot=function(){this.mainSlot=this.params.drawInSecondSlot?k.HUDMATERIAL2:k.HUDMATERIAL1};b.prototype.beginSlot=function(a){return a===this.mainSlot};b.prototype.getProgram=function(){return this.program};
b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.updateTexture(this.params.textureId);this.selectProgram();this.selectSlot()};b.prototype.bindRender=function(a,b){var c=this.params,d=this.getProgram();this.bindTexture(a,d);d.setUniform1i("hudVisibilityTexture",1);a.bindTexture(b.hudVisibilityTexture,1);a.setActiveTexture(0);d.setUniform1f("uRenderTransparentlyOccludedHUD","occluded"===b.renderTransparentlyOccludedHUD?1:"notOccluded"===b.renderTransparentlyOccludedHUD?
0:.75);b=b.pixelRatio||1;d.setUniform4fv("overrideColor",c.color);d.setUniform1f("pixelRatio",b);c.textureIsSignedDistanceField&&(d.setUniform4fv("outlineColor",c.outlineColor),d.setUniform1f("outlineSize",c.outlineSize*b));c.vvSizeEnabled&&(d.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),d.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),d.setUniform3fv("vvSizeOffset",c.vvSizeOffset),d.setUniform3fv("vvSizeFactor",c.vvSizeFactor));c.vvColorEnabled&&(d.setUniform1fv("vvColorValues",c.vvColorValues),
d.setUniform4fv("vvColorColors",c.vvColorColors));d.setUniform2fv("texScale",c.texCoordScale);d.setUniform2f("screenOffset",2*c.screenOffset[0]*b,2*c.screenOffset[1]*b);d.setUniform2fv("anchorPos",t(c));c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setBlendingEnabled(!0);a.setBlendFunction(1,771)};b.prototype.bindProjection=function(a,b){this.material._textureDirty&&(this.renderTexture(a),this.material._textureDirty=!1);var c=b.cameraAboveGround?1:-1,d=this.getProgram(),
e=this.params;a.bindProgram(d);d.setUniform1f("cameraGroundRelative",c);d.setUniform1f("polygonOffset",e.shaderPolygonOffset);d.setUniform4fv("viewport",b.viewport);r.bindVerticalOffset(e.verticalOffset,b,d);d.setUniformMatrix4fv("viewNormal",b.viewInvTransp);e.screenSizePerspective&&(r.bindScreenSizePerspective(e.screenSizePerspective,b,d,"screenSizePerspective"),r.bindScreenSizePerspective(e.screenSizePerspectiveAlignment||e.screenSizePerspective,b,d,"screenSizePerspectiveAlignment"))};b.prototype.releaseRender=
function(a){a.setPolygonOffsetFillEnabled(!1);a.setBlendFunction(770,771);a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=b.origin;var c=this.getProgram();r.bindView(a,b.view,c);r.bindCamPos(a,b.viewInvTransp,c)};b.prototype.bindInstance=function(a,b){a=this.getProgram();a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return 4};return b}(e);var A=function(a){function b(b,c,d){b=a.call(this,
b,c,d)||this;b.isOcclusionSlot=!1;return b}c(b,a);b.prototype.selectProgram=function(){var a=this.params;this.programOcclusionTestPixel=this.programRep.getProgram(u.occlusionPass,{verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.program=this.programRep.getProgram(u.colorPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,vvColor:!!a.vvColorEnabled,
verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,debugDrawBorder:!!a.debugDrawBorder})};b.prototype.getDrawMode=function(a){return this.isOcclusionSlot?0:4};b.prototype.release=function(a){a.setDepthFunction(513);this.isOcclusionSlot||this.releaseRender(a)};b.prototype.bind=function(a,b){this.bindProjection(a,b);var c=this.getProgram();a.setDepthTestEnabled(!0);a.setDepthFunction(515);this.isOcclusionSlot?(c.setUniform4f("color",
1,1,1,1),c.setUniform1f("pixelRatio",b.pixelRatio||1)):(this.bindRender(a,b),this.bindTexture(a,c))};b.prototype.bindView=function(b,c){a.prototype.bindView.call(this,b,c);b=this.getProgram();var d=this.params;this.isOcclusionSlot&&d.slicePlaneEnabled&&r.bindSlicePlane(c.origin,c.slicePlane,b)};b.prototype.getProgram=function(){return this.isOcclusionSlot?this.programOcclusionTestPixel:this.program};b.prototype.getPrograms=function(){return[this.programOcclusionTestPixel,this.program]};b.prototype.beginSlot=
function(a){if(this.params.occlusionTest)return this.isOcclusionSlot=a===k.OCCLUSION_PIXELS,a===k.OCCLUSION_PIXELS||a===this.mainSlot;this.isOcclusionSlot=!1;return a===this.mainSlot};return b}(e),z=function(a){function b(){return null!==a&&a.apply(this,arguments)||this}c(b,a);b.prototype.selectProgram=function(){var a=this.params;this.program=this.programRep.getProgram(u.highlightPass,{occlTest:a.occlusionTest,sdf:a.textureIsSignedDistanceField,vvSize:!!a.vvSizeEnabled,vvColor:!!a.vvColorEnabled,
verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,binaryHighlightOcclusion:a.binaryHighlightOcclusion})};b.prototype.bind=function(a,b){this.bindProjection(a,b);this.bindRender(a,b)};b.prototype.release=function(a){this.releaseRender(a)};return b}(e),x={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},scaleAlignment:0,minPixelSizeAlignment:0},B=[0,0],D=f.vec3d.create(),C=f.vec3d.create(),G=f.vec3d.create(),
E=f.vec3d.create(),F=f.vec3d.create(),I=f.mat3d.create(),K=f.mat4d.create(),N={normal:E,cosAngle:0},H=f.mat4d.create();f.mat4d.identity(H);var M=1,T=[0,0],V=[0,0,1],U={texCoordScale:[1,1],occlusionTest:!0,binaryHighlightOcclusion:!0,drawInSecondSlot:!1,color:[1,1,1,1],outlineColor:[1,1,1,1],outlineSize:0,textureIsSignedDistanceField:!1,distanceFieldBoundingBox:null,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,
0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],screenOffset:[0,0],verticalOffset:null,screenSizePerspective:null,screenSizePerspectiveAlignment:null,slicePlaneEnabled:!1,anchorPos:v.center,shaderPolygonOffset:1E-5,polygonOffset:!1,textureId:null,centerOffsetUnits:"world",debugDrawBorder:!1},J=b.newLayout().vec3f(q.VertexAttrConstants.POSITION).vec3f(q.VertexAttrConstants.NORMAL).vec2f(q.VertexAttrConstants.UV0).vec4u8(q.VertexAttrConstants.COLOR).vec2f(q.VertexAttrConstants.SIZE).vec4f(q.VertexAttrConstants.AUXPOS1).vec4f(q.VertexAttrConstants.AUXPOS2),
O=function(){function a(a){this.material=a;this.vertexBufferLayout=J}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return 6*a.indices[q.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d,e){c=this.material.getParameterValues();p.writePosition(b.indices[q.VertexAttrConstants.POSITION],b.vertexAttr[q.VertexAttrConstants.POSITION].data,a.transformation,d.position,e,6);p.writeNormal(b.indices[q.VertexAttrConstants.NORMAL],
b.vertexAttr[q.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,d.normal,e,6);a=b.vertexAttr[q.VertexAttrConstants.UV0].data;var h=void 0,f=void 0,k=void 0,l=void 0;null==a||4>a.length?(f=h=0,k=c.texCoordScale[0],l=c.texCoordScale[1]):(h=a[0],f=a[1],k=a[2],l=a[3]);var k=Math.min(1.99999,k+1),l=Math.min(1.99999,l+1),m=b.indices[q.VertexAttrConstants.POSITION].length,g=d.uv0;c=e;for(a=0;a<m;++a)g.set(c,0,h),g.set(c,1,f),c+=1,g.set(c,0,k),g.set(c,1,f),c+=1,g.set(c,0,k),g.set(c,1,l),c+=1,g.set(c,
0,k),g.set(c,1,l),c+=1,g.set(c,0,h),g.set(c,1,l),c+=1,g.set(c,0,h),g.set(c,1,f),c+=1;p.writeColor(b.indices[q.VertexAttrConstants.COLOR],b.vertexAttr[q.VertexAttrConstants.COLOR].data,4,d.color,e,6);h=b.indices[q.VertexAttrConstants.SIZE];f=b.vertexAttr[q.VertexAttrConstants.SIZE].data;k=h.length;l=d.size;c=e;for(a=0;a<k;++a)for(var m=f[2*h[a]],g=f[2*h[a]+1],t=0;6>t;++t)l.set(c,0,m),l.set(c,1,g),c+=1;b.indices[q.VertexAttrConstants.AUXPOS1]&&b.vertexAttr[q.VertexAttrConstants.AUXPOS1]&&p.writeBufferVec4(b.indices[q.VertexAttrConstants.AUXPOS1],
b.vertexAttr[q.VertexAttrConstants.AUXPOS1].data,d.auxpos1,e,6);b.indices[q.VertexAttrConstants.AUXPOS2]&&b.vertexAttr[q.VertexAttrConstants.AUXPOS2]&&p.writeBufferVec4(b.indices[q.VertexAttrConstants.AUXPOS2],b.vertexAttr[q.VertexAttrConstants.AUXPOS2].data,d.auxpos2,e,6)};return a}();return n})},"esri/views/3d/webgl-engine/lib/GLMaterialTexture":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./GLMaterial","../materials/internal/MaterialUtil"],function(n,g,c,a,
f){return function(a){function b(b,c,l,k,d){void 0===d&&(d=!1);b=a.call(this,b,c)||this;b.textureRep=l;b.textureId=k;b.initTransparent=d;b.glTextureRef=f.aquireIfNotUndefined(b.textureId,l,b.initTransparent);return b}c(b,a);b.prototype.dispose=function(){f.releaseIfNotUndefined(this.textureId,this.textureRep)};b.prototype.updateTexture=function(a){a!==this.textureId&&(f.releaseIfNotUndefined(this.textureId,this.textureRep),this.textureId=a,this.glTextureRef=f.aquireIfNotUndefined(this.textureId,this.textureRep,
this.initTransparent))};b.prototype.renderTexture=function(a){(a=this.textureRep.getTexture(this.textureId))&&a.dirty&&a.redraw&&a.redraw()};b.prototype.bindTexture=function(a,b){null!=this.glTextureRef&&(b.setUniform1i("tex",0),a.bindTexture(this.glTextureRef.getGLTexture()))};b.prototype.bindTextureSize=function(a,b){null!=this.glTextureRef&&(a=this.glTextureRef.getGLTexture(),b.setUniform2f("texSize",a.descriptor.width,a.descriptor.height))};return b}(a)})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["require",
"exports"],function(n,g){return function(){function c(a,c){this.material=a;this.programRep=c}c.prototype.dispose=function(){};Object.defineProperty(c.prototype,"materialId",{get:function(){return this.material.id},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderOccluded",{get:function(){return this.material.renderOccluded},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderPriority",{get:function(){return this.material.renderPriority},enumerable:!0,configurable:!0});
c.prototype.isVisible=function(){return this.material.isVisible()};c.prototype.getPrograms=function(){return[this.getProgram()]};return c}()})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("require exports ../../../../../geometry/support/aaBoundingBox ../../../lib/gl-matrix ../../../support/mathUtils ../../lib/ComponentUtils ../../lib/doublePrecisionUtils ../../lib/screenSizePerspectiveUtils ../../lib/Util".split(" "),function(n,g,c,a,f,b,l,e,h){function m(a,b,d,
e,f){var h=q(b,d,z);c.setMin(v,a.getBBMin());c.setMax(v,a.getBBMax());if(p(v,b,h,e)){var h=a.getPrimitiveIndices(),l=a.getIndices(),g=a.getPosition(),t=h?h.length:l.length/3;if(t>K&&(a=a.getChildren(),void 0!==a)){for(h=0;8>h;++h)void 0!==a[h]&&m(a[h],b,d,e,f);return}k(b,d,0,t,l,g,h,f)}}function k(a,b,c,e,h,f,k,l){var m=f.data,q=f.offsetIdx;f=f.strideIdx;var p=a[0],g=a[1];a=a[2];var t=b[0]-p,u=b[1]-g;for(b=b[2]-a;c<e;c++){var r=k?k[c]:c,z=q+f*h[3*r],v=q+f*h[3*r+1],A=q+f*h[3*r+2],D=m[z],C=m[z+1],n=
m[z+2],z=m[v]-D,F=m[v+1]-C,v=m[v+2]-n,E=m[A]-D,G=m[A+1]-C,A=m[A+2]-n,N=u*A-G*b,I=b*E-A*t,K=t*G-E*u,w=z*N+F*I+v*K,D=p-D,H=g-C,P=a-n,C=H*v-F*P,n=P*z-v*D,M=D*F-z*H;if(w>x){N=D*N+H*I+P*K;if(0>N||N>w)continue;I=t*C+u*n+b*M;if(0>I||N+I>w)continue}else if(w<-x){N=D*N+H*I+P*K;if(0<N||N<w)continue;I=t*C+u*n+b*M;if(0<I||N+I<w)continue}else continue;w=(E*C+G*n+A*M)/w;0<=w&&(z=d(z,F,v,E,G,A,B),l(w,z,r))}}function d(b,c,d,e,h,f,k){a.vec3d.set3(b,c,d,D);a.vec3d.set3(e,h,f,C);return a.vec3d.normalize(a.vec3d.cross(D,
C,k))}function q(b,c,d){return a.vec3d.set3(1/(c[0]-b[0]),1/(c[1]-b[1]),1/(c[2]-b[2]),d)}function p(a,b,c,d){var e=(a[0]-d-b[0])*c[0],h=(a[3]+d-b[0])*c[0],f=Math.min(e,h),e=Math.max(e,h),h=(a[1]-d-b[1])*c[1],k=(a[4]+d-b[1])*c[1],f=Math.max(f,Math.min(h,k)),e=Math.min(e,Math.max(h,k));if(f>e)return!1;h=(a[2]-d-b[2])*c[2];a=(a[5]+d-b[2])*c[2];f=Math.max(f,Math.min(h,a));e=Math.min(e,Math.max(h,a));return f<=e}function r(a,b){b=b?r(b):{};for(var c in a){var d=a[c];d&&d.forEach&&(d=u(d));null==d&&c in
b||(b[c]=d)}return b}function u(a){var b=[];a.forEach(function(a){return b.push(a)});return b}Object.defineProperty(g,"__esModule",{value:!0});var t=a.mat4d.create(),v=c.create(),A=h.VertexAttrConstants;g.IDENTITY=a.mat4d.identity();g.intersectTriangleGeometry=function(a,d,e,f,l,g,t){h.assert("triangle"===a.data.primitiveType);d=d&&d.componentVisibilities;f=f.tolerance;if(1<a.componentCount){e=q(l,g,z);var u=a.boundingInfo;c.setMin(v,u.getBBMin());c.setMax(v,u.getBBMax());if(p(v,l,e,f))for(var r=
a.data,u=a.componentCount,x=r.getIndices(A.POSITION),B=r.getAttribute(A.POSITION),r=r.componentOffsets,D=0;D<u;D++)if(!d||b.getVisibility(d,D)){var C=a.getComponentAABB(D,v);p(C,l,e,f)&&k(l,g,r[D]/3,r[D+1]/3,x,B,void 0,t)}}else d&&!b.getVisibility(d,0)||m(a.boundingInfo,l,g,f,t)};var z=a.vec3d.create(),x=Math.pow(2,-52),B=a.vec3d.create();g.intersectTriangles=k;var D=a.vec3d.create(),C=a.vec3d.create();g.computeNormal=d;g.intersectAabbInvDir=p;g.transformToWorld=function(b,c,d){return a.vec4d.set4(b[0]-
c[0],b[1]-c[1],b[2]-c[2],1,d)};g.transformToView=function(b,c,d,e){a.mat4d.translate(d,c,t);d=t;return a.mat4d.multiplyVec4(d,b,e)};g.transformToProjection=function(b,c,d,e){e[0]=b[0]+d[0];e[1]=b[1]+d[1];e[2]=b[2]+d[2];e[3]=b[3];return a.mat4d.multiplyVec4(c,e)};g.transformToNDC=function(b,c){return a.vec4d.scale(b,1/Math.abs(b[3]),c)};g.applyScreenSizePerspectiveScale=function(a,b,c,d,f){return e.scale(a,d,c,f)};g.verticalOffsetAtDistance=function(a,b,c,d,h){var k=c.screenLength||0;h&&(k=e.scale(k,
d,b,h));return f.clamp(k*Math.tan(.5*a.fovY)/(.5*a.fullHeight)*b,c.minWorldLength||0,null!=c.maxWorldLength?c.maxWorldLength:Infinity)};g.aquireIfNotUndefined=function(a,b,c){if(void 0!==a)return b.aquire(a,c)};g.releaseIfNotUndefined=function(a,b){void 0!==a&&b.release(a)};var G=a.mat4.create();g.bindView=function(b,c,d){a.mat4d.translate(c,b,G);d.setUniform3fv("localOrigin",b);d.setUniformMatrix4fv("view",G)};g.bindCamPos=function(a,b,c){c.setUniform3f("camPos",b[3]-a[0],b[7]-a[1],b[11]-a[2])};
var E=a.vec3d.create(),F=a.vec3d.create();g.bindViewOriginDouble=function(a,b){l.encodeDoubleArraySplit(a,E,F,3);b.setUniform3fv("viewOriginHi",E);b.setUniform3fv("viewOriginLo",F)};var I=a.vec3d.create();g.bindSlicePlane=function(b,c,d){a.vec3d.subtract(c.origin,b,I);d.setUniform3fv("slicePlaneOrigin",I);d.setUniform3fv("slicePlaneBasis1",c.basis1);d.setUniform3fv("slicePlaneBasis2",c.basis2)};g.bindVerticalOffset=function(a,b,c){if(a){var d=b.fovY,e=b.viewport[3],f=void 0;void 0===f&&(f=N);f.screenLength=
a.screenLength;f.perDistance=Math.tan(.5*d)/(.5*e);f.minWorldLength=a.minWorldLength;f.maxWorldLength=a.maxWorldLength;a=f;c.setUniform4f("verticalOffset",a.screenLength*(b.pixelRatio||1),a.perDistance,a.minWorldLength,a.maxWorldLength)}};g.bindScreenSizePerspective=function(a,b,c,d){void 0===d&&(d="screenSizePerspectiveAlignment");if(a){var e=a.parameters;c.setUniform4f(d,e.divisor,e.offset,e.minPixelSize*(b.pixelRatio||1),a.paddingPixelsOverride)}};g.copyParameters=r;g.updateParameters=function(a,
b){var c=!1,d;for(d in b){var e=b[d];void 0!==e&&(c=!0,Array.isArray(e)?a[d]=e.slice():a[d]=e)}return c};(function(a){function b(a){return(a.shadowMappingEnabled?1:0)|(a.ssaoEnabled?2:0)}a.create=function(a,c){for(var d=[],e=0;2>e;e++)for(var f=0;2>f;f++){var h=b({shadowMappingEnabled:1===e,ssaoEnabled:1===f}),k=b({shadowMappingEnabled:1===e,ssaoEnabled:1===f&&a.receiveSSAO});d[h]=d[k]||c({receiveShadows:1===e,receiveSSAO:1===f&&a.receiveSSAO})}return{programs:d.filter(function(a){return null!=a}),
byParameter:d}};a.lookup=function(a,c){return a.byParameter[b(c)]};a.programs=function(a){return a.programs}})(g.BindParametersMap||(g.BindParametersMap={}));g.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};var K=1E3,N={screenLength:0,perDistance:0,minWorldLength:0,maxWorldLength:0}})},"esri/views/3d/webgl-engine/lib/doublePrecisionUtils":function(){define(["require","exports"],function(n,g){function c(a,c,e){for(var b=0;b<e;++b)c[2*b]=a[b],c[2*b+1]=a[b]-c[2*b]}Object.defineProperty(g,"__esModule",
{value:!0});g.encodeDouble=function(a,c){f[0]=a;f[1]=a-f[0];c[0]=f[0];c[1]=f[1]};g.encodeDoubleArray=c;g.decodeDoubleArray=function(a,c,e){for(var b=0;b<e;++b)c[b]=a[2*b]+a[2*b+1]};g.encodeDoubleArraySplit=function(b,l,e,h){for(var m=0;m<h;++m)a[0]=b[m],c(a,f,1),l[m]=f[0],e[m]=f[1]};var a=new Float64Array(1),f=new Float32Array(2)})},"esri/views/3d/webgl-engine/lib/Material":function(){define(["require","exports","./IdGen","./ModelContentType"],function(n,g,c,a){return function(){function f(a){this.supportsEdges=
!1;this._parentStage=null;this._visible=!0;this._renderOccluded=!1;this._renderPriority=0;this.id=f._idGen.gen(a)}Object.defineProperty(f.prototype,"parentStage",{get:function(){return this._parentStage},enumerable:!0,configurable:!0});f.prototype.addParentStage=function(a){this._parentStage=a};f.prototype.removeParentStage=function(a){this._parentStage=null};Object.defineProperty(f.prototype,"visible",{get:function(){return this._visible},set:function(a){a!==this._visible&&(this._visible=a,this.notifyDirty("matChanged"))},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderOccluded",{get:function(){return this._renderOccluded},set:function(a){a!==this._renderOccluded&&(this._renderOccluded=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"renderPriority",{get:function(){return this._renderPriority},set:function(a){a!==this._renderPriority&&(this._renderPriority=a,this.notifyDirty("matChanged"))},enumerable:!0,configurable:!0});f.prototype.isVisible=
function(){return this._visible};f.prototype.notifyDirty=function(b){this.parentStage&&this.parentStage.notifyDirty(a.MATERIAL,this,b)};f._idGen=new c;return f}()})},"esri/views/3d/webgl-engine/materials/internal/bufferWriters":function(){define(["require","exports","../../../support/buffer/BufferView","../../lib/Util"],function(n,g,c,a){function f(a,b,c,e,f){var d=c.typedBuffer;c=c.typedBufferStride;var h=a.length;e*=c;if(null==f||1===f)for(var k=0;k<h;++k){var l=2*a[k];d[e]=b[l];d[e+1]=b[l+1];e+=
c}else for(k=0;k<h;++k)for(var l=2*a[k],m=0;m<f;++m)d[e]=b[l],d[e+1]=b[l+1],e+=c}function b(a,b,c,e,f){var d=c.typedBuffer;c=c.typedBufferStride;var h=a.length;e*=c;if(null==f||1===f)for(var k=0;k<h;++k){var l=3*a[k];d[e]=b[l];d[e+1]=b[l+1];d[e+2]=b[l+2];e+=c}else for(k=0;k<h;++k)for(var l=3*a[k],m=0;m<f;++m)d[e]=b[l],d[e+1]=b[l+1],d[e+2]=b[l+2],e+=c}function l(a,b,c,e,f){var d=c.typedBuffer;c=c.typedBufferStride;var h=a.length;e*=c;if(null==f||1===f)for(var k=0;k<h;++k){var l=4*a[k];d[e]=b[l];d[e+
1]=b[l+1];d[e+2]=b[l+2];d[e+3]=b[l+3];e+=c}else for(k=0;k<h;++k)for(var l=4*a[k],m=0;m<f;++m)d[e]=b[l],d[e+1]=b[l+1],d[e+2]=b[l+2],d[e+3]=b[l+3],e+=c}function e(a,c,e,f,h,k){if(e){var d=f.typedBuffer;f=f.typedBufferStride;var l=a.length;h*=f;if(null==k||1===k)for(var m=0;m<l;++m){var q=3*a[m],p=c[q],g=c[q+1],t=c[q+2];d[h]=e[0]*p+e[4]*g+e[8]*t+e[12];d[h+1]=e[1]*p+e[5]*g+e[9]*t+e[13];d[h+2]=e[2]*p+e[6]*g+e[10]*t+e[14];h+=f}else for(m=0;m<l;++m)for(var q=3*a[m],p=c[q],g=c[q+1],t=c[q+2],q=e[0]*p+e[4]*
g+e[8]*t+e[12],u=e[1]*p+e[5]*g+e[9]*t+e[13],p=e[2]*p+e[6]*g+e[10]*t+e[14],g=0;g<k;++g)d[h]=q,d[h+1]=u,d[h+2]=p,h+=f}else b(a,c,f,h,k)}function h(a,c,e,f,h,k){if(e){var d=f.typedBuffer;f=f.typedBufferStride;var l=a.length;h*=f;if(null==k||1===k)for(var m=0;m<l;++m){var q=3*a[m],p=c[q],g=c[q+1],t=c[q+2];d[h]=e[0]*p+e[4]*g+e[8]*t;d[h+1]=e[1]*p+e[5]*g+e[9]*t;d[h+2]=e[2]*p+e[6]*g+e[10]*t;h+=f}else for(m=0;m<l;++m)for(var q=3*a[m],p=c[q],g=c[q+1],t=c[q+2],q=e[0]*p+e[4]*g+e[8]*t,u=e[1]*p+e[5]*g+e[9]*t,p=
e[2]*p+e[6]*g+e[10]*t,g=0;g<k;++g)d[h]=q,d[h+1]=u,d[h+2]=p,h+=f}else b(a,c,f,h,k)}function m(a,b,c,e,f,h){var d=e.typedBuffer;e=e.typedBufferStride;var k=a.length;f*=e;if(null==h||1===h)if(4===c)for(c=0;c<k;++c){var l=4*a[c];d[f]=b[l];d[f+1]=b[l+1];d[f+2]=b[l+2];d[f+3]=b[l+3];f+=e}else{if(3===c)for(c=0;c<k;++c)l=3*a[c],d[f]=b[l],d[f+1]=b[l+1],d[f+2]=b[l+2],d[f+3]=255,f+=e}else if(4===c)for(c=0;c<k;++c)for(var l=4*a[c],m=0;m<h;++m)d[f]=b[l],d[f+1]=b[l+1],d[f+2]=b[l+2],d[f+3]=b[l+3],f+=e;else if(3===
c)for(c=0;c<k;++c)for(l=3*a[c],m=0;m<h;++m)d[f]=b[l],d[f+1]=b[l+1],d[f+2]=b[l+2],d[f+3]=255,f+=e}function k(a,b,c,e,f,h,k){var d=f.typedBuffer;f=f.typedBufferStride;var l=a.length;h*=f;if(null==k||1===k)if(4===c)for(c=0;c<l;++c){var m=4*a[c];d[h]=b[m]*e[0];d[h+1]=b[m+1]*e[1];d[h+2]=b[m+2]*e[2];d[h+3]=b[m+3]*e[3];h+=f}else{if(3===c){var q=255*e[3];for(c=0;c<l;++c)m=3*a[c],d[h]=b[m]*e[0],d[h+1]=b[m+1]*e[1],d[h+2]=b[m+2]*e[2],d[h+3]=q,h+=f}}else if(4===c)for(c=0;c<l;++c)for(var m=4*a[c],p=0;p<k;++p)d[h]=
b[m]*e[0],d[h+1]=b[m+1]*e[1],d[h+2]=b[m+2]*e[2],d[h+3]=b[m+3]*e[3],h+=f;else if(3===c)for(q=255*e[3],c=0;c<l;++c)for(m=3*a[c],p=0;p<k;++p)d[h]=b[m]*e[0],d[h+1]=b[m+1]*e[1],d[h+2]=b[m+2]*e[2],d[h+3]=q,h+=f}Object.defineProperty(g,"__esModule",{value:!0});g.writeBufferVec2=f;g.writeBufferVec3=b;g.writeBufferVec4=l;g.writePosition=e;g.writeNormal=h;g.writeColor=m;g.writeMultipliedColor=k;g.writeDefaultAttributes=function(b,q,p,g,u,t,v){var d=0;for(p=p.fieldNames;d<p.length;d++){var r=p[d],x=b.vertexAttr[r],
B=b.indices[r];if(x&&B)switch(r){case a.VertexAttrConstants.POSITION:a.assert(3===x.size);(r=t.getField(r,c.BufferViewVec3f))&&e(B,x.data,g,r,v);break;case a.VertexAttrConstants.NORMAL:a.assert(3===x.size);(r=t.getField(r,c.BufferViewVec3f))&&h(B,x.data,u,r,v);break;case a.VertexAttrConstants.UV0:a.assert(2===x.size);(r=t.getField(r,c.BufferViewVec2f))&&f(B,x.data,r,v);break;case a.VertexAttrConstants.REGION:a.assert(4===x.size);(r=t.getField(r,c.BufferViewVec4u16))&&l(B,x.data,r,v);break;case a.VertexAttrConstants.COLOR:a.assert(3===
x.size||4===x.size);(r=t.getField(r,c.BufferViewVec4u8))&&(q&&q.color?k(B,x.data,x.size,q.color,r,v):m(B,x.data,x.size,r,v));break;case a.VertexAttrConstants.SYMBOLCOLOR:a.assert(3===x.size||4===x.size),(r=t.getField(r,c.BufferViewVec4u8))&&m(B,x.data,x.size,r,v)}}}})},"esri/views/3d/webgl-engine/shaders/HUDPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",
{value:!0});var b=function(a){return f.glslifyDefineMap({OCCL_TEST:a.occlTest,SIGNED_DISTANCE_FIELD:a.sdf,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,DEBUG_DRAW_BORDER:a.debugDrawBorder,BINARY_HIGHLIGHT_OCCLUSION:a.binaryHighlightOcclusion})};g.colorPass={name:"hud-color",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/hud/hud.vert"),fragmentShader:b(c)+
a.resolveIncludes("materials/hud/colorPass.frag")}},attributes:c.Default3D};g.highlightPass={name:"hud-highlight",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/hud/hud.vert"),fragmentShader:b(c)+a.resolveIncludes("materials/hud/highlightPass.frag")}},attributes:c.Default3D};g.occlusionPass={name:"hud-occlusion",shaders:function(b){return{vertexShader:f.glslifyDefineMap({VERTICAL_OFFSET:b.verticalOffset,SCREEN_SIZE_PERSPECTIVE:b.screenSizePerspective,CENTER_OFFSET_UNITS_SCREEN:b.centerOffsetUnitsScreen,
SLICE:b.slice})+a.resolveIncludes("materials/hud/occlusionTest.vert"),fragmentShader:a.resolveIncludes("materials/hud/occlusionTest.frag")}},attributes:c.Default3D}})},"esri/views/3d/layers/graphics/Labeler":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper dojo/promise/all ../../../../Color ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators ../../../../layers/support/LabelClass ../../../../symbols/callouts/calloutUtils ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DWebStyleSymbol ./labelPlacement ../../support/debugFlags ../../webgl-engine/Stage ../../webgl-engine/lib/Layer ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextTexture ../../webgl-engine/lib/TextTextureAtlas".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B){Object.defineProperty(g,"__esModule",{value:!0});n=function(l){function g(a){a=l.call(this)||this;a.labelStageLayer=null;a.labels={};a.labelsToAdd={};a.labelsToRemove={};a.labelingContexts=[];a.idHint="__labeler";a.dirty=!1;return a}c(g,l);C=g;g.prototype.setup=function(){var a=this;this.handles||(this.handles=new e,this.handles.add([this.view.watch("state.camera",function(){return a.setDirty()})]));this.labelStageLayer||(this.labelStageLayer=
new A(this.idHint,{isPickable:!1},this.idHint+"_labels"),this.view._stage.add(v.ModelContentType.LAYER,this.labelStageLayer),this.view._stage.addToViewContent([this.labelStageLayer.id]),this.textTextureAtlas=new B(this.idHint+"_atlas",this.view),this.hudMaterialCollection=new z(this.view._stage),this.calloutMaterialCollection=new z(this.view._stage));this.handles.add(this.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a.needsIdleUpdate()},idleFrame:function(b){return a.idleUpdate(b)}}))};
g.prototype.dispose=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.labelStageLayer&&(this.view._stage.removeFromViewContent([this.labelStageLayer.id]),this.view._stage.remove(v.ModelContentType.LAYER,this.labelStageLayer.id),this.labelStageLayer=null,this.textTextureAtlas.dispose(),this.textTextureAtlas=null,this.hudMaterialCollection.dispose(),this.hudMaterialCollection=null,this.calloutMaterialCollection.dispose(),this.calloutMaterialCollection=null);this.labelingContexts=
[];this.labels={};this.labelsToAdd={};this.labelsToRemove={}};g.prototype.isActiveLabelingContext=function(a){return a.active&&this.labelsEnabled(a)};g.prototype.activateLabelingContext=function(a){for(var b in a.labels){var c=a.labels[b];this.labels[b]=c;c.graphics3DGraphic.setVisibilityFlag(0,!0,1)}a.active=!0};g.prototype.deactivateLabelingContext=function(a){for(var b in a.labels){var c=a.labels[b];c.graphics3DGraphic.setVisibilityFlag(0,!1,1);c.rendered&&(this.labelsToRemove[b]=a.labels[b]);
delete this.labels[b];delete this.labelsToAdd[b]}a.active=!1};g.prototype.addLabelTextureToAtlas=function(a){for(var b=0,c=0;c<a.graphics3DGraphic._labelGraphics.length;c++){var d=a.graphics3DGraphic._labelGraphics[c];if(d._labelClass){var e=a.textTextures[b];b++;e&&this.textTextureAtlas.addTextTexture(e,d.stageObject)}}a.rendered=!0};g.prototype.removeLabelTextureFromAtlas=function(a){for(var b=0;b<a.graphics3DGraphic._labelGraphics.length;b++)a.textTextures[b]&&this.textTextureAtlas.removeTextTexture(a.textTextures[b],
a.graphics3DGraphic._labelGraphics[b].stageObject);a.rendered=!1};g.prototype.needsIdleUpdate=function(){return this.isDirty};g.prototype.idleUpdate=function(a){if(this.view.ready){for(var b=!!a,c=!1,d=0,e=this.labelingContexts;d<e.length;d++){var f=e[d];if(this.isActiveLabelingContext(f)){if(!this.hasValidLabelClassContext(f)){if(this.hasInvalidLabelClassContext(f)){this.deactivateLabelingContext(f);continue}this.createLabelClassContext(f);if(this.hasPendingLabelClassContext(f)){c=!0;continue}if(!this.hasValidLabelClassContext(f))continue}for(var h in f.labelsToInitialize){if(b&&
a.done())return;var k=f.labelsToInitialize[h];!k.hasGraphics3DResources&&this.createGraphics3DResources(k)&&(this.labels[h]=k,b&&this.view.deconflictor.setDirty());k.hasGraphics3DResources&&!k.hasTextTextureResources&&k.visible&&this.createTextTextureResources(k);(k.visible&&k.hasTextTextureResources||!k.visible&&k.hasGraphics3DResources)&&delete f.labelsToInitialize[h]}}}for(h in this.labelsToRemove)this.removeLabelTextureFromAtlas(this.labelsToRemove[h]),delete this.labelsToRemove[h];for(h in this.labelsToAdd)this.addLabelTextureToAtlas(this.labelsToAdd[h]),
delete this.labelsToAdd[h];c||(this.dirty=!1)}};g.prototype.hasPendingLabelClassContext=function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()};g.prototype.hasValidLabelClassContext=function(a){return a.labelClassContexts&&a.labelClassContexts.length};g.prototype.hasInvalidLabelClassContext=function(a){return null===a.labelClassContexts};g.prototype.createLabelClassContext=function(a){if(a.labelClassPromise)return a.labelClassPromise;a.labelClassPromise=a.layer.when(function(){a.scaleVisibility&&
a.scaleVisibility.updateScaleRangeActive();var b=a.graphics3DCore,c=b.layer.labelingInfo&&b.layer.labelingInfo.filter(function(a){return!!a.symbol});if(!c||0===c.length)return null;var d=Array(c.length),c=c.map(function(a,c){var e=a.symbol,f;f=b.getOrCreateGraphics3DSymbol(e);f=f instanceof r?f.graphics3DSymbol:f;var h=null;q.isCalloutSupport(e)&&e.hasVisibleCallout()&&(h=p.make(e,b.symbolCreationContext));d[c]={labelClass:a,graphics3DSymbol:f,graphics3DCalloutSymbolLayer:h,options:a.getOptions()};
return f});return f(c).then(function(){return d})}).then(function(b){b&&(a.labelClassContexts=b)}).catch(function(){a.labelClassContexts=null});return a.labelClassPromise};g.prototype.destroyLabelClassContext=function(a){a.labelClassContexts=[];a.labelClassPromise=null};g.prototype.createLabelText=function(a,b,c,e){if(!d.evaluateWhere(b.where,a.attributes))return null;b=b.getLabelExpression();return b.expression?d.buildLabelText(b.expression,a,e.fields,c):null};g.prototype.createTextSymbolGraphic=
function(a,b,c,d,e){a={text:a,centerOffset:c.centerOffset,translation:c.translation,elevationOffset:c.elevationOffset,screenOffset:c.screenOffset,anchor:c.anchor,needsOffsetAdjustment:c.needsOffsetAdjustment,centerOffsetUnits:c.centerOffsetUnits,verticalOffset:c.verticalOffset,debugDrawBorder:t.LABELS_SHOW_BORDER};C.tmpGraphicCreationContext.graphic=b;C.tmpGraphicCreationContext.renderingInfo=null;C.tmpGraphicCreationContext.layer=d;return e.createGraphics3DGraphic(C.tmpGraphicCreationContext,a,this.hudMaterialCollection,
this.textTextureAtlas)};g.prototype.createLineCalloutGraphic=function(a,b,c,d,e){C.tmpGraphicCreationContext.graphic=a;C.tmpGraphicCreationContext.renderingInfo={symbol:b,needsOffsetAdjustment:d.needsOffsetAdjustment,translation:d.translation,elevationOffset:d.elevationOffset,screenOffset:d.screenOffset,centerOffset:d.centerOffset,centerOffsetUnits:d.centerOffsetUnits,materialCollection:this.calloutMaterialCollection};C.tmpGraphicCreationContext.layer=e;return c.createGraphics3DGraphic(C.tmpGraphicCreationContext)};
g.prototype.createGraphics3DResources=function(a){var b=a.labelingContext,c=!1,d=a.graphics3DGraphic,e=d.graphic,f=b.labelClassContexts,h=b.layer,k=this.labelsEnabled(b);if(f&&0!==f.length&&d._graphics[0]){for(var l=0;l<f.length;l++){var m=f[l],q=m.labelClass,p=this.createLabelText(e,q,m.options,h);if(p){var g=null;m.graphics3DSymbol&&m.graphics3DSymbol.symbol&&"label-3d"===m.graphics3DSymbol.symbol.type&&(g=m.graphics3DSymbol.symbol);var t=m.graphics3DSymbol.childGraphics3DSymbols[0],r=u.get({graphics3DGraphic:d,
labelSymbol:g,labelClass:m.labelClass});if(t&&r.isValid){if(c=this.createTextSymbolGraphic(p,e,r,h,t)){if(c._labelClass=q,d.addLabelGraphic(c,this.labelStageLayer,this.view._stage),b.spatialIndex&&b.spatialIndex.add(d),d.setVisibilityFlag(0,k,1),d.setVisibilityFlag(1,void 0,1),d.setVisibilityFlag(2,!1,1),c=!0,m.graphics3DCalloutSymbolLayer&&r.hasLabelVerticalOffset&&(e=this.createLineCalloutGraphic(e,g,m.graphics3DCalloutSymbolLayer,r,h)))m.calloutSymbolLayerIndex=d._labelGraphics.length,d.addLabelGraphic(e,
this.labelStageLayer,this.view._stage)}else return!1;break}}}b.scaleVisibility&&c&&b.scaleVisibility.updateGraphicLabelScaleVisibility(d);return a.hasGraphics3DResources=!0}};g.prototype.destroyGraphics3DResources=function(a){a.graphics3DGraphic.clearLabelGraphics();a.hasGraphics3DResources=!1};g.prototype.createTextTextureResources=function(a){var c=a.labelingContext,d=a.graphics3DGraphic,e=c.labelClassContexts,c=c.layer,f=d.graphic;if(e&&0!==e.length&&d._graphics[0]){for(d=0;d<e.length;d++){var h=
e[d],k=this.createLabelText(f,h.labelClass,h.options,c)||f.symbol&&f.symbol.text;if(k&&!(1>k.length)){var h=h.graphics3DSymbol.childGraphics3DSymbols[0].symbol,l=h.material?b.toUnitRGBA(h.material.color):D,q=h.halo&&h.halo.color&&0<h.halo.size,p=q?b.toUnitRGBA(h.halo.color):D,q=q?m.pt2px(h.halo.size):0,g=m.pt2px(h.size)||12,k=new x(k,{size:g,color:l,font:{family:h.font&&h.font.family?h.font.family:"sans-serif",weight:h.font&&h.font.weight?h.font.weight:"normal",style:h.font&&h.font.style?h.font.style:
"normal"},halo:{size:q,color:p}},c.id+"_label_"+f.uid);a.textTextures.push(k)}}a.hasTextTextureResources=!0}};g.prototype.destroyTextTextureResources=function(a){a.textTextures=[];a.hasTextTextureResources=!1};g.prototype.addGraphic=function(a,b){var c={hasGraphics3DResources:!1,hasTextTextureResources:!1,visible:!1,rendered:!1,labelingContext:a,graphics3DGraphic:b,textTextures:[]};b=b.graphic.uid;a.labels[b]=c;this.isActiveLabelingContext(a)&&this.hasValidLabelClassContext(a)&&this.createGraphics3DResources(c)?
this.labels[b]=c:a.labelsToInitialize[b]=c;a=a.graphics3DCore.asyncUpdates;this.setDirty(a);this.view.deconflictor.setDirty({async:a})};g.prototype.removeGraphic=function(a,b){b=b.graphic.uid;var c=a.labels[b];c&&(this.labels[b]&&(this.removeLabelTextureFromAtlas(c),delete this.labels[b],delete this.labelsToAdd[b],delete this.labelsToRemove[b]),c.hasTextTextureResources&&this.destroyTextTextureResources(c),c.hasGraphics3DResources&&this.destroyGraphics3DResources(c),delete a.labels[b],delete a.labelsToInitialize[b],
a=a.graphics3DCore.asyncUpdates,this.setDirty(a),this.view.deconflictor.setDirty({async:a}))};g.prototype.labelsEnabled=function(a){return!0===a.layer.labelsVisible&&null!=a.layer.labelingInfo&&0<a.layer.labelingInfo.length};g.prototype.elevationInfoChange=function(a){for(var b=function(b){b.graphics3DSymbol.layerPropertyChanged("elevationInfo",{});if(b.graphics3DCalloutSymbolLayer){var c={},d;for(d in a.labels){var e=a.labels[d].graphics3DGraphic;c[e.graphic.uid]=e}b.graphics3DCalloutSymbolLayer.layerPropertyChanged("elevationInfo",
c,function(a){return a._labelGraphics[b.calloutSymbolLayerIndex]})}},c=0,d=a.labelClassContexts;c<d.length;c++)b(d[c])};g.prototype.visibilityInfoChange=function(a){var b=a.layer.labelsVisible;b&&!a.active&&this.activateLabelingContext(a);!b&&a.active&&this.deactivateLabelingContext(a);a=a.graphics3DCore.asyncUpdates;this.setDirty(a);this.view.deconflictor.setDirty({async:a})};g.prototype.resetLabels=function(a){for(var b in a.labels){var c=a.labels[b];this.labels[b]&&(this.removeLabelTextureFromAtlas(c),
delete this.labels[b],delete this.labelsToAdd[b],delete this.labelsToRemove[b]);c.hasTextTextureResources&&this.destroyTextTextureResources(c);c.hasGraphics3DResources&&this.destroyGraphics3DResources(c);c.visible=!1;c.rendered=!1;a.labelsToInitialize[b]=c}this.destroyLabelClassContext(a);this.labelStageLayer.invalidateSpatialQueryAccelerator();a=a.graphics3DCore.asyncUpdates;this.setDirty(a);this.view.deconflictor.setDirty({async:a})};g.prototype.findLabelingContext=function(a){for(var b=0;b<this.labelingContexts.length;b++)if(this.labelingContexts[b].graphics3DCore===
a)return this.labelingContexts[b];return null};g.prototype.addGraphicsOwner=function(a,b,c){var d=this;if(!this.findLabelingContext(a)){var e={graphics3DCore:a,layer:a.layer,scaleVisibility:b,spatialIndex:c,active:a.layer.labelsVisible,labelClassPromise:null,labelClassContexts:[],labels:{},labelsToInitialize:{}};this.labelingContexts.push(e);this.setDirty();return{addGraphic:function(a){return d.addGraphic(e,a)},removeGraphic:function(a){return d.removeGraphic(e,a)},layerLabelsEnabled:function(){return d.labelsEnabled(e)},
labelingInfoChange:function(a){if(a){for(var b=0;b<a.length;b++){var c=e.labels[a[b]];c&&(d.removeGraphic(e,c.graphics3DGraphic),d.addGraphic(e,c.graphics3DGraphic))}return h.create(function(a){return!0})}d.visibilityInfoChange(e);d.resetLabels(e);return d.createLabelClassContext(e)},elevationInfoChange:function(){d.elevationInfoChange(e)},visibilityInfoChange:function(){d.visibilityInfoChange(e)},clear:function(){d.resetLabels(e)}}}};g.prototype.removeGraphicsOwner=function(a){if(a=this.findLabelingContext(a)){var b=
this.labelingContexts.indexOf(a);this.labelingContexts.splice(b,1);for(var c in a.labels)this.removeGraphic(a,a.labels[c].graphics3DGraphic);this.setDirty()}};g.prototype.setLabelGraphicVisibility=function(a,b){a=a.graphic.uid;var c=this.labels[a];c&&(b&&!c.rendered?(this.labelsToAdd[a]=c,c.hasTextTextureResources||(c.labelingContext.labelsToInitialize[a]=c)):!b&&c.rendered&&(this.labelsToRemove[a]=c),c.visible=b,this.setDirty(c.labelingContext.graphics3DCore.asyncUpdates))};Object.defineProperty(g.prototype,
"labelStageLayerId",{get:function(){return this.labelStageLayer.id},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isDirty",{get:function(){return this.dirty||this.textTextureAtlas&&this.textTextureAtlas.isDirty},enumerable:!0,configurable:!0});g.prototype.setDirty=function(a){void 0===a&&(a=!0);this.dirty=!0;a||this.idleUpdate()};Object.defineProperty(g.prototype,"updating",{get:function(){return this.labelingContexts.some(function(a){return a.labelClassPromise&&!a.labelClassPromise.isResolved()})},
enumerable:!0,configurable:!0});var C;g.tmpGraphicCreationContext={graphic:null,renderingInfo:null,layer:null};a([k.property({constructOnly:!0})],g.prototype,"view",void 0);a([k.property({type:Boolean,readOnly:!0})],g.prototype,"updating",null);return g=C=a([k.subclass()],g)}(k.declared(l));g.Labeler=n;var D=[0,0,0,1]})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["require","exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],
function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b=c.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory");g.make=function(c,f){if(!a.isCalloutSupport(c))return b.error("Graphics3DCalloutSymbolLayerFactory#make","symbol of type '"+c.type+"' does not support callouts"),null;if(!c.callout)return null;var e=l[c.callout.type];return e?new e(c,f):(b.error("Graphics3DCalloutSymbolLayerFactory#make","unknown or unsupported callout type "+c.callout.type),null)};
var l={line:f}})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){var u,t,v=p.VertexAttrConstants;n=function(h){function p(a,b){a=h.call(this,a,null,b,!0)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}c(p,h);p.prototype.destroy=function(){h.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(k.ModelContentType.MATERIAL,this._material.id),this._material=null)};p.prototype._prepareResources=function(){var a=this._getStageIdHint();
this._createMaterialsAndAddToStage(this._context.stage,a);this.resolve()};p.prototype.perInstanceMaterialParameters=function(a){var b=this.materialParameters;b.screenOffset=a.screenOffset||[0,0];b.centerOffsetUnits=a.centerOffsetUnits||"world";return b};Object.defineProperty(p.prototype,"materialParameters",{get:function(){var b=this.symbolContainer,c=b.callout,d=a.toUnitRGBA(c.color);d[3]*=this._getLayerOpacity();var e=f.pt2px(c.size||0),h=null;if(b.verticalOffset)var h=b.verticalOffset,k=h.minWorldLength,
l=h.maxWorldLength,h={screenLength:f.pt2px(h.screenLength),minWorldLength:k||0,maxWorldLength:null!=l?l:Infinity};c=c.border&&c.border.color?a.toUnitRGBA(c.border.color):null;k="object"===b.symbolLayers.getItemAt(0).type;return{color:d,size:e,verticalOffset:h,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:c,occlusionTest:!k,shaderPolygonOffset:k?0:void 0,depthHUDAlignStart:"label-3d"===
b.type,slicePlaneEnabled:this._context.slicePlaneEnabled}},enumerable:!0,configurable:!0});p.prototype._createMaterialsAndAddToStage=function(a,b){this._material=new r(this.materialParameters,b+"_lineCallout_common");a.add(k.ModelContentType.MATERIAL,this._material)};p.prototype._defaultElevationInfoNoZ=function(){return x};p.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);
var c=this.getGraphicElevationContext(a,b.elevationOffset||0),d=b.symbol,e="on-the-ground"===this._elevationContext.mode&&!d.symbolLayers.some(function(a){return"object"===a.type||"text"===a.type});if("label-3d"!==d.type&&e)return null;d=m.computeCentroid(a.geometry);return null==d?null:this._createAs3DShape(a,d,c,b,"graphic"+a.uid,a.uid)};p.prototype.layerPropertyChanged=function(a,b,c){switch(a){case "opacity":return this.layerOpacityChanged(b,c);case "elevationInfo":return this.layerElevationInfoChanged(b,
c)}return!1};p.prototype.layerOpacityChanged=function(a,b){this._material.setParameterValues(this.materialParameters);return!0};p.prototype.layerElevationInfoChanged=function(a,b){var c=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(c!==d&&("on-the-ground"===c||"on-the-ground"===d))return!1;for(var e in a)c=a[e],(d=b(c))&&this.updateGraphicElevationContext(c.graphic,d);return!0};p.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);
a=h.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(b);return a};p.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=e.needsElevationUpdates2D(a.mode)};Object.defineProperty(p.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0});p.prototype.createVertexData=function(a){var b,c=a.translation;a=a.centerOffset;if(!c&&!a)return A;
c=c?{size:3,data:[c[0],c[1],c[2]]}:A[v.POSITION];a=a?{size:4,data:[a[0],a[1],a[2],a[3]]}:A[v.AUXPOS1];return b={},b[v.POSITION]=c,b[v.NORMAL]=A[v.NORMAL],b[v.AUXPOS1]=a,b};p.prototype.getOrCreateMaterial=function(a,b){var c=this.perInstanceMaterialParameters(a),d=r.uniqueMaterialIdentifier(c);if(d===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};if(a.materialCollection){var e=a.materialCollection.getMaterial(d);e||(e=new r(c,b+"_lineCallout_shared"),a.materialCollection.addMaterial(d,
e));return{material:e,isUnique:!1}}e=new r(c,b+"_lineCallout_unique");return{material:e,isUnique:!0}};p.prototype._createAs3DShape=function(a,c,f,h,k,m){a=new q(this.createVertexData(h),z,q.DefaultOffsets,"point");a=[new d(a,k)];var p=this.getOrCreateMaterial(h,k);k=e.createStageObjectForPoint.call(this,c,a,[[p.material]],null,null,f,k,this._context.layer.uid,m,!0);if(null===k)return null;m=new l(this,k.object,a,p.isUnique?[p.material]:null,null,b.perObjectElevationAligner,f);m.metadata={elevationOffset:h.elevationOffset||
0};m.alignedTerrainElevation=k.terrainElevation;m.needsElevationUpdates=e.needsElevationUpdates2D(f.mode);e.extendPointGraphicElevationContext(m,c,this._context.elevationProvider);return m};return p}(h);var A=(u={},u[v.POSITION]={size:3,data:[0,0,0]},u[v.NORMAL]={size:3,data:[0,0,1]},u[v.AUXPOS1]={size:4,data:[0,0,0,1]},u);u=new Uint32Array([0]);var z=(t={},t[v.POSITION]=u,t[v.NORMAL]=u,t[v.AUXPOS1]=u,t),x={mode:"relative-to-ground",offset:0};return n})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("require exports ../../../../geometry/Point ./Graphics3DSymbolCommonCode ./graphicUtils ../../lib/gl-matrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),
function(n,g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});var m=h.VertexAttrConstants,k=new c,d=b.vec3d.create(),q=b.vec3d.create(),p=b.vec3d.create(),r=b.vec3d.create(),u=b.mat4d.create(),t={verticalDistanceToGround:0,terrainElevation:0};g.perVertexElevationAligner=function(b,c,e,f){b=b.stageObject;k.spatialReference=e.spatialReference;for(var h=b.getGeometryRecords(),u=h.length,r="absolute-height"!==c.mode,x=0,v=0;v<u;v++){var z=h[v].geometry,A=h[v].getShaderTransformation();
q[0]=A[12];q[1]=A[13];q[2]=A[14];z.invalidateBoundingInfo();for(var A=z.data.getVertexAttr(),n=A[m.POSITION],z=n.data,A=A.mapPos.data,n=n.size,N=z.length/n,H=0,M=0,T=!1,V=0,U=0;U<N;U++){k.x=A[M++];k.y=A[M++];k.z=A[M++];p[0]=z[H];p[1]=z[H+1];p[2]=z[H+2];var J=a.computeElevation(e,k,c,f,r?t:null);r&&(V+=t.terrainElevation);d[0]=z[H]+q[0];d[1]=z[H+1]+q[1];d[2]=z[H+2]+q[2];f.setAltitude(J,d);z[H]=d[0]-q[0];z[H+1]=d[1]-q[1];z[H+2]=d[2]-q[2];if(l.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS)T=!0;else if(J=
g.updateThresholdInMeters/f.unitInMeters,Math.abs(p[0]-z[H])>=J||Math.abs(p[1]-z[H+1])>=J||Math.abs(p[2]-z[H+2])>=J)T=!0;H+=n}x+=V/N;T&&b.geometryVertexAttrsUpdated(v)}return x/u};g.perObjectElevationAligner=function(b,c,h,k,m){b=b.stageObject;var q=c.centerPointInElevationSR,p=0;m=0;if(b.metadata.usesVerticalDistanceToGround)p=a.computeElevation(h,q,c,k,t),f.updateVertexAttributeAuxpos1w(b,t.verticalDistanceToGround),m=t.terrainElevation;else{var u="absolute-height"!==c.mode,p=a.computeElevation(h,
q,c,k,u?t:null);u&&(m=t.terrainElevation)}c=b.getObjectTransformation();h=[c[12],c[13],c[14]];l.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(d[0]=q.x,d[1]=q.y,d[2]=p,e.computeLinearTransformation(q.spatialReference,d,c,k.spatialReference)&&b.setObjectTransformation(c)):k.setAltitudeOfTransformation(p,c);k=g.updateThresholdInMeters/k.unitInMeters;(Math.abs(c[12]-h[0])>=k||Math.abs(c[13]-h[1])>=k||Math.abs(c[14]-h[2])>=k)&&b.setObjectTransformation(c);return m};g.perLodInstanceElevationAligner=function(b,
c,f,h,k){k=c.centerPointInElevationSR;var m=0,q=0,p="absolute-height"!==c.mode,m=a.computeElevation(f,k,c,h,p?t:null);p&&(q=t.terrainElevation);c=b.graphics3DSymbolLayer.lodRenderer.instanceData;c.getTranslation(b.instanceIndex,r);l.DISABLE_ELEVATION_ALIGNERS_ITERATIVE_UPDATES?(d[0]=k.x,d[1]=k.y,d[2]=m,e.computeLinearTransformation(k.spatialReference,d,u,h.spatialReference)&&c.setTransform(b.instanceIndex,u)):h.setAltitude(m,r);c.setTranslation(b.instanceIndex,r);return q};g.updateThresholdInMeters=
.01;g.iterativeUpdatesEnabled=!0})},"esri/views/3d/layers/graphics/Graphics3DSymbolCommonCode":function(){define("require exports ../../../../geometry/support/coordsUtils ../../../../geometry/support/triangulationUtils ../../../../layers/graphics/dehydratedFeatures ../../../../symbols/callouts/calloutUtils ./graphicUtils ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/lib/Object3D".split(" "),function(n,g,c,a,f,b,l,e,h,m){function k(a,b,c,d,e){var f=b.z||0,h=c.featureExpressionInfoContext;
switch(c.mode){case "on-the-ground":return c=a.getElevation(b,"ground")||0,e&&(e.verticalDistanceToGround=0,e.terrainElevation=c),c;case "relative-to-ground":return a=a.getElevation(b,"ground")||0,c=c.calculateOffsetRenderUnits(d),null==h&&(c+=f),e&&(e.verticalDistanceToGround=c,e.terrainElevation=a),c+a;case "relative-to-scene":return a=a.getElevation(b,"scene")||0,c=c.calculateOffsetRenderUnits(d),e&&(e.verticalDistanceToGround=c,e.terrainElevation=a),c+a;case "absolute-height":return c=c.calculateOffsetRenderUnits(d),
null==h&&(c+=f),e&&(a=a.getElevation(b,"ground")||0,e.verticalDistanceToGround=c-a,e.terrainElevation=a),c}return 0}function d(b,c){b=a.pathsToTriangulationInfo(b,c);return{vertexData:b.position,polygons:b.polygons,outlines:b.outlines}}function q(a,b,c,d,e){b*=3;d*=3;for(var f=0;f<e;++f)c[d++]=a[b++],c[d++]=a[b++],c[d++]=a[b++]}function p(a,b,c,d,e,f,k){return h.bufferToBuffer(a,c,b,d,f,e,k)}function r(a,b,c){h.pointToVector(a,b,c)}function u(a,b){return!(a[0]>b[3]||a[0]<b[0]||a[1]>b[4]||a[1]<b[1])}
function t(a,b){return!(b[0]>a[3]||b[3]<a[0]||b[1]>a[4]||b[4]<a[1])}Object.defineProperty(g,"__esModule",{value:!0});var v=e.vec3d.create(),A=e.mat4d.identity(),z=f.makeDehydratedPoint(0,0,0,null);g.createStageObjectForPoint=function(a,b,c,d,e,f,q,p,g,t,z){var B=b?b.length:0,D=this._context.clippingExtent;r(a,v,this._context.elevationProvider.spatialReference);if(D&&!u(v,D))return null;r(a,v,this._context.renderSpatialReference);D=this._context.localOriginFactory.getOrigin(v);q=new m({castShadow:!1,
metadata:{layerUid:p,graphicUid:g,usesVerticalDistanceToGround:!!t},idHint:q});for(p=0;p<B;p++)q.addGeometry(b[p],c[p],d?d[p]:A,e,D,z);b=this._context.renderSpatialReference;d=this._context.elevationProvider;e=this._context.renderCoordsHelper;c=0;var C;q.metadata.usesVerticalDistanceToGround?(c=k(d,a,f,e,x),l.updateVertexAttributeAuxpos1w(q,x.verticalDistanceToGround),C=x.terrainElevation):(z="absolute-height"!==f.mode,c=k(d,a,f,e,z?x:null),z&&(C=x.terrainElevation));f=q.getObjectTransformation();
v[0]=a.x;v[1]=a.y;v[2]=c;h.computeLinearTransformation(a.spatialReference,v,f,b)?q.setObjectTransformation(f):console.warn("Could not locate symbol object properly, it might be misplaced");return{object:q,terrainElevation:C}};g.extendPointGraphicElevationContext=function(a,b,c){a=a.elevationContext;c=c.spatialReference;r(b,v,c);a.centerPointInElevationSR=f.makeDehydratedPoint(v[0],v[1],b.hasZ?v[2]:0,c)};g.placePointOnGeometry=function(a){switch(a.type){case "point":return a;case "polygon":case "extent":return l.computeCentroid(a);
case "polyline":var b=a.paths[0];if(!b||0===b.length)break;b=c.getPointOnPath(b,c.getPathLength(b)/2);return f.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference);case "mesh":return a.extent.center}return null};g.computeElevation=k;g.getSingleSizeDriver=function(a,b){void 0===b&&(b=0);return isFinite(a[b])?a[b]:null};g.copyPathData=d;g.copyVertices=q;g.chooseOrigin=function(a,b,c,d){b=Math.floor(b+(c-1)/2);d[0]=a[3*b+0];d[1]=a[3*b+1];d[2]=a[3*b+2]};g.subtractCoordinates=function(a,b,c,d){b*=3;
for(var e=0;e<c;++e)a[b++]-=d[0],a[b++]-=d[1],a[b++]-=d[2]};g.setZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]=d,b+=3};g.offsetZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]+=d,b+=3};g.scaleZ=function(a,b,c,d){b*=3;for(var e=0;e<c;++e)a[b+2]*=d,b+=3};g.flatArrayToArrayOfArrays=function(a,b,c){var d=[];b*=3;for(var e=0;e<c;++e)d.push([a[b++],a[b++],a[b++]]);return d};g.reproject=p;g.reprojectPoint=r;g.getGeometryVertexData3D=function(a,b,c,e,f,h,k){var l=f.spatialReference;a=d(a,b);b=a.vertexData;
var m=b.length/3,g=new Float64Array(b.length),t=!0;c.equals(l)?q(b,0,g,0,b.length):t=p(b,0,c,g,0,l,m);var u=c=0,r=k.mode,x=0,v=0,B=0;h=k.calculateOffsetRenderUnits(h);k=k.featureExpressionInfoContext;z.spatialReference=f.spatialReference;c*=3;for(var u=3*u,A=0;A<m;++A){z.x=g[c+0];z.y=g[c+1];z.z=g[c+2];switch(r){case "on-the-ground":v=x=f.getElevation(z)||0;B+=x;break;case "relative-to-ground":x=f.getElevation(z)||0;v=x+h;null==k&&(v+=z.z);B+=x;break;case "relative-to-scene":x=f.getElevation(z,"scene")||
0;v=x+h;B+=x;break;case "absolute-height":v=h,null==k&&(v+=z.z)}b[u+0]=g[c+0];b[u+1]=g[c+1];b[u+2]=v;c+=3;u+=3}f=B/m;l.equals(e)||p(b,0,l,b,0,e,m);return{geometryData:a,vertexData:b,eleVertexData:g,terrainElevation:f,projectionSuccess:t}};g.getGeometryVertexDataDraped=function(a,b,c){a=d(a,!1);var e=a.vertexData,f=e.length/3,k=!0;b.equals(c)||(k=h.bufferToBuffer(e,b,0,e,c,0,f));return{geometryData:a,vertexData:e,projectionSuccess:k}};g.computeBoundingBox=function(a,b,c,d){d[0]=Number.MAX_VALUE;d[1]=
Number.MAX_VALUE;d[2]=Number.MAX_VALUE;d[3]=-Number.MAX_VALUE;d[4]=-Number.MAX_VALUE;d[5]=-Number.MAX_VALUE;b*=3;for(var e=0;e<c;++e){var f=a[b++],h=a[b++],k=a[b++];f<d[0]&&(d[0]=f);h<d[1]&&(d[1]=h);k<d[2]&&(d[2]=k);f>d[3]&&(d[3]=f);h>d[4]&&(d[4]=h);k>d[5]&&(d[5]=k)}return d};g.pointInBox2D=u;g.boxesIntersect2D=t;g.boundingBoxClipped=function(a,b){return b?!t(a,b):!1};g.needsElevationUpdates2D=function(a){return"relative-to-ground"===a||"relative-to-scene"===a};g.needsElevationUpdates3D=function(a){return"absolute-height"!==
a};g.needsOffsetAdjustment=function(a,c,d,e){if(!1===c.needsOffsetAdjustment||!1===c.supportsOffsetAdjustment||"on-the-ground"===a.mode)return!1;if(0===a.meterUnitOffset){if(!0===c.needsOffsetAdjustment)return!0;if(b.isCalloutSupport(e)&&e.hasVisibleVerticalOffset())return!1;if("relative-to-ground"===a.mode&&(!d.hasZ||a.featureExpressionInfoContext)||"relative-to-scene"===a.mode)return!0}return!1};var x={verticalDistanceToGround:0,terrainElevation:0}})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("require exports ../../../../geometry ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../geometry/support/webMercatorUtils ../../../../layers/graphics/dehydratedFeatures ../../lib/gl-matrix ../../support/mathUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k){function d(a){var b=a.paths[0];if(!b||0===b.length)return null;b=l.getPointOnPath(b,l.getPathLength(b)/2);return h.makeDehydratedPoint(b[0],b[1],b[2],a.spatialReference)}function q(a){if(Array.isArray(a)){for(var b=0;b<a.length;b++)if(!q(a[b]))return!1;return!0}return null==a||0<=a}Object.defineProperty(g,"__esModule",{value:!0});var p=[1,1,1];g.computeCentroid=function(a){if("point"===a.type)return a;if(h.isHydratedGeometry(a))switch(a.type){case "extent":return a.center;
case "polygon":return a.centroid;case "polyline":return d(a);case "mesh":return a.extent.center}else switch(a.type){case "extent":var c=k.isFinite(a.zmin);return h.makeDehydratedPoint(.5*(a.xmax+a.xmin),.5*(a.ymax+a.ymin),c?.5*(a.zmax+a.zmin):void 0,a.spatialReference);case "polygon":return(c=a.rings[0])&&0!==c.length?(c=b.ringsCentroid(a.rings,a.hasZ),a=h.makeDehydratedPoint(c[0],c[1],c[2],a.spatialReference)):a=null,a;case "polyline":return d(a)}};g.convertPointSR=function(a,b){var d=a.spatialReference;
d.isWebMercator&&b.isWGS84?(e.xyToLngLat(a.x,a.y,r),a.x=r[0],a.y=r[1],a.spatialReference=c.SpatialReference.WGS84):b.isWebMercator&&d.isWGS84&&(e.lngLatToXY(a.x,a.y,r),a.x=r[0],a.y=r[1],a.spatialReference=c.SpatialReference.WebMercator)};g.enlargeExtent=function(a,b,c){if(a){b||(b=f.create());var d=.5*a.width*(c-1);c=.5*a.height*(c-1);a.width<1E-7*a.height?d+=c/20:a.height<1E-7*a.width&&(c+=d/20);m.vec4d.set4(a.xmin-d,a.ymin-c,a.xmax+d,a.ymax+c,b);return b}return null};g.updateVertexAttributeAuxpos1w=
function(a,b){for(var c=0;c<a.geometries.length;++c){var d=a.geometries[c].data.vertexAttributes.auxpos1;d&&d.data[3]!==b&&(d.data[3]=b,a.geometryVertexAttrsUpdated(c))}};g.mixinColorAndOpacity=function(a,b){var c=[1,1,1,1];null!=a&&(c[0]=a[0],c[1]=a[1],c[2]=a[2]);null!==b&&void 0!==b?c[3]=b:null!=a&&3<a.length&&(c[3]=a[3]);return c};g.overrideColor=function(a,b,c,d,e,f){void 0===f&&(f=[0,0,0,0]);for(var h=0;3>h;++h)f[h]=a&&null!=a[h]?a[h]:c&&null!=c[h]?c[h]:e[h];f[3]=null!=b?b:null!=d?d:e[3];return f};
g.computeObjectScale=function(a,b,c,d){void 0===a&&(a=p);void 0===d&&(d=1);var e=Array(3);if(null==b||null==c)e[0]=1,e[1]=1,e[2]=1;else{for(var f=void 0,h=0,k=2;0<=k;k--){var l=a[k],m=void 0,q=null!=l,g=0===k&&!f&&!q,t=c[k];"symbolValue"===l||g?m=0!==t?b[k]/t:1:q&&"proportional"!==l&&isFinite(l)&&(m=0!==t?l/t:1);null!=m&&(f=e[k]=m,h=Math.max(h,Math.abs(m)))}for(k=2;0<=k;k--)null==e[k]?e[k]=f:0===e[k]&&(e[k]=.001*h)}for(k=2;0<=k;k--)e[k]/=d;return e};g.computeSizeWithResourceSize=function(a,b){var c=
b.width,d=b.depth,e=b.height;b=b.isPrimitive?10:1;if(null==c&&null==e&&null==d)return[b*a[0],b*a[1],b*a[2]];for(var c=[c,d,e],f,d=0;3>d;d++)if(e=c[d],null!=e){f=e/a[d];break}for(d=0;3>d;d++)null==c[d]&&(c[d]=a[d]*f);return c};g.validateSymbolLayerSize=function(a){null!=a.isPrimitive&&(a=[a.width,a.depth,a.height]);return q(a)?null:"Symbol sizes may not be negative values"};g.computeObjectRotation=function(a,b,c,d){void 0===d&&(d=m.mat4d.identity());a=a||0;b=b||0;c=c||0;0!==a&&m.mat4d.rotateZ(d,-a/
180*Math.PI,d);0!==b&&m.mat4d.rotateX(d,b/180*Math.PI,d);0!==c&&m.mat4d.rotateY(d,c/180*Math.PI,d);return d};g.demResolutionForBoundingBox=function(b,c){return null!=c.minDemResolution?c.minDemResolution:a.isPoint(b)?c.minDemResolutionForPoints:.01*a.maximumDimension(b)};var r=[0,0]})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../lib/gl-matrix ../../webgl-engine/Stage".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k){n=function(){function c(a,b,d,f,h,k,l,m){this.type="object3d";this._addedToStage=!1;this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.uniqueMaterials=f;this.uniqueGeometries=d;this.uniqueTextures=h;this.stageObject=b;this.elevationAligner=k;this.elevationContext=new e(l);this.stageLayer=this.stage=null;this._visible=!1;this.visibilityMode=null!=m?m:c.VisibilityModes.HIDE_FACERANGE}c.prototype.initialize=function(a,b){this.stageLayer=
a;this.stage=b;if(this.uniqueMaterials)for(a=0;a<this.uniqueMaterials.length;a++)b.add(k.ModelContentType.MATERIAL,this.uniqueMaterials[a]);if(this.uniqueGeometries)for(a=0;a<this.uniqueGeometries.length;a++)b.add(k.ModelContentType.GEOMETRY,this.uniqueGeometries[a]);if(this.uniqueTextures)for(a=0;a<this.uniqueTextures.length;a++)b.add(k.ModelContentType.TEXTURE,this.uniqueTextures[a]);b.add(k.ModelContentType.OBJECT,this.stageObject)};c.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==
a?((this._visible=a)?this._addedToStage?this.stageObject.unhideAllComponents():(this.stageLayer.addObject(this.stageObject),this._addedToStage=!0):this.visibilityMode===c.VisibilityModes.HIDE_FACERANGE?this.stageObject.hideAllComponents():(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1),(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.updateObjectVisibility(this.stageObject,this._visible),!0):!1};Object.defineProperty(c.prototype,"visible",{get:function(){return this._visible},
enumerable:!0,configurable:!0});c.prototype.destroy=function(){var a=this.stage;if(this.stageLayer){if(this.uniqueMaterials)for(var b=0;b<this.uniqueMaterials.length;b++)a.remove(k.ModelContentType.MATERIAL,this.uniqueMaterials[b].id);if(this.uniqueGeometries)for(b=0;b<this.uniqueGeometries.length;b++)a.remove(k.ModelContentType.GEOMETRY,this.uniqueGeometries[b].id);if(this.uniqueTextures)for(b=0;b<this.uniqueTextures.length;b++)a.remove(k.ModelContentType.TEXTURE,this.uniqueTextures[b].id)}a.remove(k.ModelContentType.OBJECT,
this.stageObject.id);this._addedToStage&&(this.stageLayer.removeObject(this.stageObject),this._addedToStage=!1);(a=this.stage.view.getEdgeView())&&a.hasObject(this.stageObject)&&a.removeObject(this.stageObject);this._visible=!1;this.stage=this.stageLayer=null};c.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(l.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=
a))};c.prototype.getBSRadius=function(){return this.stageObject.getBSRadius()};c.prototype.getCenterObjectSpace=function(){return this.stageObject.getCenter(!0)};c.prototype.getBoundingBoxObjectSpace=function(a){var c=this.stageObject;a||(a=b.create());b.setMin(a,c.getBBMin(!0));b.setMax(a,c.getBBMax(!0));return a};c.prototype.getProjectedBoundingBox=function(c,e,k,l){return f(this,void 0,void 0,function(){var f,g,t,u,z,v,A,n,K,N;return a(this,function(a){switch(a.label){case 0:f=this.getBoundingBoxObjectSpace(k);
g=r;t=b.isPoint(f)?1:g.length;for(u=0;u<t;u++)z=g[u],q[0]=f[z[0]],q[1]=f[z[1]],q[2]=f[z[2]],m.mat4d.multiplyVec3(this.stageObject.objectTransformation,q),d[3*u+0]=q[0],d[3*u+1]=q[1],d[3*u+2]=q[2];if(!c(d,0,t))return[2,null];b.empty(f);v=null;this.calculateRelativeScreenBounds&&(v=this.calculateRelativeScreenBounds());for(u=0;u<3*t;u+=3){for(A=0;3>A;A++)f[A]=Math.min(f[A],d[u+A]),f[A+3]=Math.max(f[A+3],d[u+A]);v&&l.push({location:d.slice(u,u+3),screenSpaceBoundingRect:v})}if(!e||!e.service||"absolute-height"===
this.elevationContext.mode)return[3,5];b.center(f,p);n="relative-to-scene"===this.elevationContext.mode?"scene":"ground";K=void 0;if(!e.useViewElevation)return[3,1];K=e.service.getElevation(p[0],p[1],n);return[3,4];case 1:return a.trys.push([1,3,,4]),N=h.demResolutionForBoundingBox(f,e),[4,e.service.queryElevation(p[0],p[1],N,n)];case 2:return K=a.sent(),[3,4];case 3:return a.sent(),K=null,[3,4];case 4:b.offset(f,0,0,-this.alignedTerrainElevation+K),a.label=5;case 5:return[2,f]}})})};c.prototype.addHighlight=
function(a,b){b=this.stageObject.highlightAllComponents(b);a.addObject(this.stageObject,b)};c.prototype.removeHighlight=function(a){a.removeObject(this.stageObject)};return c}();(function(a){a=a.VisibilityModes||(a.VisibilityModes={});a[a.REMOVE_OBJECT=0]="REMOVE_OBJECT";a[a.HIDE_FACERANGE=1]="HIDE_FACERANGE"})(n||(n={}));var d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=m.vec3d.create(),p=m.vec3d.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];return n})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["require",
"exports","../../../../support/arcadeUtils"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.createContext=function(a,f,b){var l=null;a=a&&a.expression;"string"===typeof a&&(l="0"===a?0:null,null!=l?l={cachedResult:l}:(l=c.createSyntaxTree(a),c.dependsOnView(l)?(null!=b&&b.error("Expressions containing '$view' are not supported on ElevationInfo"),l={cachedResult:0}):l={arcade:{func:c.createFunction(l),context:c.createExecContext(null,{sr:f})}}));return l};g.createFeature=function(a,
f){return c.createFeature(a.attributes,a.geometry,f)};g.setContextFeature=function(a,f){null!=a&&null==a.cachedResult&&c.updateExecContext(a.arcade.context,f)};g.execute=function(a){if(null!=a){if(null!=a.cachedResult)return a.cachedResult;var f=a.arcade,f=c.executeFunction(f.func,f.context);"number"!==typeof f&&(f=a.cachedResult=0);return f}return 0};g.extractExpressionInfo=function(a,c){void 0===c&&(c=!1);var b=(a=a&&a.featureExpressionInfo)&&a.expression;c||"0"===b||(a=null);return a};g.zeroContext=
{cachedResult:0}})},"esri/views/3d/layers/graphics/Graphics3DGraphicElevationContext":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./ElevationContext"],function(n,g,c,a){return function(a){function b(b){b=a.call(this,b)||this;b.centerPointInElevationSR=null;return b}c(b,a);return b}(a)})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["require","exports","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(n,
g,c,a){return function(){function f(a){a?this.set(a):this.setDefaults()}Object.defineProperty(f.prototype,"meterUnitOffset",{get:function(){return this._meterUnitOffset},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"unit",{get:function(){return this._unit},enumerable:!0,configurable:!0});f.prototype.setUnit=function(a){this._unit=a;this._metersPerElevationInfoUnit=c.getMetersPerUnit(a)};f.prototype.setDefaults=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=
0;this.featureExpressionInfoContext=null;this.hasOffsetAdjustment=!1;this.setUnit("meters")};f.prototype.set=function(a){this.mode=a.mode;this._meterUnitOffset=a._meterUnitOffset||0;this._renderUnitOffset=a._renderUnitOffset||0;this.featureExpressionInfoContext=a.featureExpressionInfoContext;this.hasOffsetAdjustment=a.hasOffsetAdjustment;this.setUnit(a.unit)};f.prototype.setOffsetMeters=function(a){this._meterUnitOffset=a;this._renderUnitOffset=0};f.prototype.setOffsetElevationInfoUnits=function(a){this._meterUnitOffset=
a*this._metersPerElevationInfoUnit;this._renderUnitOffset=0};f.prototype.setOffsetRenderUnits=function(a){this._meterUnitOffset=0;this._renderUnitOffset=a};f.prototype.addOffsetRenderUnits=function(a){this._renderUnitOffset+=a};f.prototype.mixinApi=function(a){null!=a.mode&&(this.mode=a.mode);null!=a.unit&&this.setUnit(a.unit);null!=a.offset&&this.setOffsetElevationInfoUnits(a.offset)};f.prototype.calculateOffsetRenderUnits=function(b){var c=this._meterUnitOffset,e=this.featureExpressionInfoContext;
null!=e&&(c+=a.execute(e)*this._metersPerElevationInfoUnit);return c/b.unitInMeters+this._renderUnitOffset};return f}()})},"esri/views/3d/webgl-engine/Stage":function(){define("require exports ../lib/gl-matrix ./lib/ModelContentType ./lighting/Lightsources ./parts/Model ./parts/View".split(" "),function(n,g,c,a,f,b,l){return function(){function e(a,e,k,d){this.sceneIntersectionHelper=d;this._viewContent=[];this.container=e;this.viewingMode=a;this.model=new b;this.view=new l(e,this,this.model.getDirtySet(),
k);this.view.setLighting({lights:[new f.MainLight(c.vec3d.createFrom(.7,.7,.7)),new f.AmbientLight(c.vec3d.createFrom(.3,.3,.3))],groundLightingFactor:.5,globalFactor:.5})}e.prototype.setNeedsRender=function(){this.view.setNeedsRender()};e.prototype.dispose=function(){this.view.dispose();this.model=this.view=null};e.prototype.add=function(a,b){this.model.add(a,b);"function"===typeof b.addParentStage&&b.addParentStage(this)};e.prototype.remove=function(a,b){a=this.model.remove(a,b);"function"===typeof a.removeParentStage&&
a.removeParentStage(this);return a};e.prototype.notifyDirty=function(a,b,c,d){this.model.notifyDirty(a,b,c,d)};e.prototype.processDirty=function(){var a=this.model.getDirtySet(),b=a.getDirtyMaterials();if(a.hasDirtyGeometryRecords()||b){e.DebugSettings.endFrameContentValidation&&this.model.validateContent();e.DebugSettings.logDirtySet&&console.log("Dirty set: "+this.model.getDirtySet().formatDebugInfo(!1));var c=a.commitLayers(this._viewContent);(0<c[0].length+c[1].length+c[2].length||b)&&this.view.modify(c[0],
c[1],c[2],b);e.DebugSettings.logDirtySet&&(console.log("RGs add: "+c[0].map(function(a){return a.uniqueName})),console.log("RGs remove: "+c[1].map(function(a){return a.uniqueName})));a.commit();a.clearDirtyMaterials();this.view.setNeedsRender()}};e.prototype.processDirtyLayer=function(a){var b=this.model.getDirtySet(),c=b.getDirtyMaterials();a=b.commitLayers([a]);(0<a[0].length+a[1].length+a[2].length||c)&&this.view.modify(a[0],a[1],a[2],c);b.clearDirtyMaterials();this.view.setNeedsRender()};e.prototype.get=
function(a,b){return this.model.get(a,b)};e.prototype.getAll=function(a){return this.model.getAll(a)};e.prototype.getCamera=function(){return this.view.getCamera()};e.prototype.setCamera=function(a){this.view.setCamera(a)};e.prototype.getViewParams=function(a){return this.view.getViewParams(a)};e.prototype.setViewParams=function(a){this.view.setViewParams(a)};e.prototype.getLayers=function(){return this.model.getAll(a.LAYER)};e.prototype.setLighting=function(a){this.view.setLighting(a)};e.prototype.getCanvas=
function(){return this.view.getCanvas()};e.prototype.setRenderParams=function(a){this.view.setRenderParams(a)};e.prototype.getRenderParams=function(){return this.view.getRenderParams()};e.prototype.getIdleSuspend=function(){return this.view.getIdleSuspend()};e.prototype.has=function(a){return this.view.has(a)};e.prototype.getViewContent=function(){return this._viewContent.slice(0)};e.prototype.addToViewContent=function(a){for(var b=[],c=0;c<a.length;c++)-1===this._viewContent.indexOf(a[c])&&b.push(a[c]);
0<a.length&&(this.processDirty(),a=this.model.getDirtySet().getResidentRenderGeometriesFilteredByLayers(b),this.view.modify(a,[],[]),this._viewContent.push.apply(this._viewContent,b))};e.prototype.removeFromViewContent=function(a){this.processDirty();for(var b=this.model.getDirtySet(),c=this._viewContent,d=[],e=0;e<a.length;e++){var f=c.indexOf(a[e]);-1<f&&(c[f]=c[c.length-1],c.pop(),d.push(a[e]))}a=b.getResidentRenderGeometriesFilteredByLayers(d);this.view.modify([],a,[])};e.prototype.getFrameTask=
function(){return this.view.getFrameTask()};e.prototype.takeScreenshot=function(a){return this.view.takeScreenshot(a)};e.prototype.addRenderPlugin=function(a,b){"function"===typeof b.intersect&&this.sceneIntersectionHelper.addIntersectionHandler(b);return this.view.renderPlugins.add(a,b)};e.prototype.removeRenderPlugin=function(a){this.sceneIntersectionHelper.removeIntersectionHandler(a);return this.view.renderPlugins.remove(a)};e.prototype.getContentDebugStrings=function(a){return this.model.formatDebugInfo(a)};
e.prototype.getRenderStats=function(){return this.view.getCombinedStats()};e.prototype.getRenderStatString=function(a){var b=this.getRenderStats(),c="";if(a){var c=c+"\x3ctable\x3e",d;for(d in b)c+="\x3ctr\x3e\x3ctd\x3e"+d+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Math.round(b[d])+"\x3c/td\x3e\x3c/tr\x3e";c+="\x3c/table\x3e"}else for(d in b)c+=d+": "+b[d]+"\n";return c};e.prototype.getFramebufferTexture=function(a){void 0===a&&(a="color");return this.view.getFramebufferTexture(a)};e.prototype.getDrapedTextureRenderer=
function(){return this.view.getDrapedTextureRenderer()};e.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};e.ModelContentType=a;return e}()})},"esri/views/3d/webgl-engine/parts/Model":function(){define("require exports dojo/string ../../lib/gl-matrix ../lib/ModelContentType ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util".split(" "),function(n,g,c,a,f,b,l,e){var h=e.assert,m=e.logWithBase;return function(){function e(){this.dirtySet=new b(this);this._uniqueIdx=0;this._id2origin=
{};this.content={};for(var a in f)this.content[f[a]]={}}e.prototype.getAll=function(a){a=this.content[a];h(void 0!==a);return a};e.prototype.get=function(a,b){return this.getAll(a)[b]};e.prototype.add=function(a,b){var c=this.content[a];h(void 0!==c);var d=b.id;h(null==c[d],"Model/Stage already contains object to be added");c[d]=b;a===f.LAYER&&this.notifyDirty(a,b,"layerAdded")};e.prototype.remove=function(a,b){var c=this.content[a];h(void 0!==c);var d=c[b];h(void 0!==d,"Model/Stage doesn't contain object to be removed");
delete c[b];a===f.TEXTURE&&d.unload();a===f.LAYER&&this.notifyDirty(a,d,"layerRemoved");return d};e.prototype.getDirtySet=function(){return this.dirtySet};e.prototype.notifyDirty=function(a,b,c,e){this.dirtySet.handleUpdate(b,c,e)};e.prototype.getOrigin=function(b,c,e){void 0===e&&(e=10);var d=0;c=c*e/1E4;1<c&&(d=Math.ceil(m(c,2)));c=1E4*Math.pow(2,d);e=Math.round(b[0]/c);var f=Math.round(b[1]/c);b=Math.round(b[2]/c);var d=d+"_"+e+"_"+f+"_"+b,h=this._id2origin[d];null==h&&(h={vec3:a.vec3d.createFrom(e*
c,f*c,b*c),id:d},this._id2origin[d]=h);return h};e.prototype.getGeometryRenderGeometries=function(b,c,e){var d=b.id,f=c.geometry,h=b.getCombinedStaticTransformation(c),k=a.mat4d.maxScale(h),m=c.origin,q=c.id,p=this._uniqueIdx++;b=new l(f.data,f.boundingInfo,c.materials[0],h,c.customTransformation,k,b.getCastShadow(),!!f.singleUse,d,q,p);b.origin=m||this.getOrigin(b.center,b.bsRadius);b.instanceParameters=c.instanceParameters;e.push(b)};e.prototype.updateRenderGeometryTransformation=function(a,b,c){a.getCombinedStaticTransformation(b,
c.transformation);c.updateTransformation(c.transformation)};e.prototype.formatDebugInfo=function(a){var b=[];if(a){b[0]="\x3ctable\x3e";for(var d in f)a=f[d],b[0]+="\x3ctr\x3e\x3ctd\x3e"+a+'\x3c/td\x3e\x3ctd style\x3d"text-align: right"\x3e'+Object.keys(this.getAll(a)).length+"\x3c/td\x3e\x3c/tr\x3e";b[0]+="\x3c/table\x3e";b[1]=this.dirtySet.formatDebugInfo(!0)}else{b[0]="";for(d in f)a=f[d],b[0]+=c.pad(String(Object.keys(this.getAll(a)).length),6," ")+" "+a+", ";b[1]=this.dirtySet.formatDebugInfo(!1)}return b};
e.prototype.validateContent=function(){var a=this.getAll(f.OBJECT),b;for(b in a)this.validateObject(a[b]);var a=this.getAll(f.LAYER),c;for(c in a)this.validateLayer(a[c]);c=this.getAll(f.MATERIAL);for(var e in c)this.validateMaterial(c[e])};e.prototype.validateObject=function(a){a=a.geometryRecords;for(var b=0;b<a.length;++b){var c=a[b];h(null!=this.get(f.GEOMETRY,c.geometry.id));h(1===c.materials.length,"object materials do not match geometry groups");h(null!=this.get(f.MATERIAL,c.materials[0].id))}};
e.prototype.validateLayer=function(a){a=a.getObjects();for(var b=0;b<a.length;++b){var c=this.get(f.OBJECT,a[b].id);h(null!=c)}};e.prototype.validateMaterial=function(a){a=a.getAllTextureIds();for(var b=0;b<a.length;++b){var c=this.get(f.TEXTURE,a[b]);h(null!=c)}};e.ContentType=f;return e}()})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("require exports ../../../../core/arrayUtils ../../../../core/iteratorUtils ./ModelContentType ./Util".split(" "),function(n,g,c,a,f,b){return function(){function l(a){this._residentGeomRecords=
new Map;this._dirtyGeomRecords=new Map;this._dirtyMaterials=new Set;this._model=a}Object.defineProperty(l.prototype,"residentLayerCount",{get:function(){return this._residentGeomRecords.size},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"residentObjectCount",{get:function(){var a=0;this._residentGeomRecords.forEach(function(b){a+=b.size});return a},enumerable:!0,configurable:!0});l.prototype.getDirtyMaterials=function(){return 0<this._dirtyMaterials.size?this._dirtyMaterials:
null};l.prototype.clearDirtyMaterials=function(){this._dirtyMaterials.clear()};l.prototype.hasDirtyGeometryRecords=function(){var b=!1;a.everyMap(this._dirtyGeomRecords,function(c){if(b)return!1;a.everyMap(c,function(a){if(!b&&a&&0<a.size)return b=!0,!1})});return b};l.prototype.handleUpdate=function(a,c,f){b.assert(this[c],"ModelDirtySet doesn't know how to process "+c);return this[c](a,f)};l.prototype.shaderTransformationChanged=function(a){var b=this;(a=this._residentGeomRecords.get(a.id))&&a.forEach(function(a,
c){(c=b._model.content[f.OBJECT][c])&&c.hasVolativeTransformation()&&a.forEach(function(a){var b=0;for(a=a[1];b<a.length;b++)a[b].shaderTransformationChanged()})})};l.prototype.commit=function(){return this.commitLayers(c.keysOfMap(this._dirtyGeomRecords))};l.prototype.commitLayers=function(a){for(var c=this,e=[],k=[],d=[],l=function(h){var l=a[h];h=p._dirtyGeomRecords.get(l);if(!h)return"continue";h.forEach(function(a,h){var m=c._ensureGeomRecord(l,h);a.forEach(function(a,l){var q=a[0],p=a[1];a=
a[2];var g=p&2&&a&1;if(p&4||g){var t=m.get(l);t?k.push.apply(k,t[1]):4===p&&b.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");t&&m.delete(l)}if(p&1||g){var r=[q,[]],t=c._model.get(f.OBJECT,h);c._model.getGeometryRenderGeometries(t,q,r[1]);e.push.apply(e,r[1]);m.set(l,r)}if(p&2&&!g)if(t=m.get(l)){l=t[1];p=l.length;if(a&16)for(t=c._model.get(f.OBJECT,h),g=0;g<p;g++)r=l[g],c._model.updateRenderGeometryTransformation(t,q,r);for(g=0;g<p;g++)r=l[g],d.push({renderGeometry:r,updateType:a})}else b.assert(!1,
"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")});0===m.size&&c._residentGeomRecords.get(l).delete(h)});0===p._residentGeomRecords.get(l).size&&p._residentGeomRecords.delete(l);p._dirtyGeomRecords.delete(l)},p=this,g=0;g<a.length;g++)l(g);return[e,k,d]};l.prototype.getResidentRenderGeometries=function(){return this.getResidentRenderGeometriesFilteredByLayers(c.keysOfMap(this._residentGeomRecords))};l.prototype.getResidentRenderGeometriesFilteredByLayers=function(a){for(var b=[],
c=0;c<a.length;c++){var e=this._residentGeomRecords.get(a[c]);e&&e.forEach(function(a){a.forEach(function(a){b.push.apply(b,a[1])})})}return b};l.prototype.visibilityChanged=function(a,b,c){if(null!=b)this._componentPropertyChanged(a,b,c,2);else{b=0;for(var e=a.getGeometryRecords();b<e.length;b++)this._componentPropertyChanged(a,e[b],c,2)}};l.prototype.componentHighlightChanged=function(a,b,c){if(null!=b)this._componentPropertyChanged(a,b,c,32);else{b=0;for(var e=a.getGeometryRecords();b<e.length;b++)this._componentPropertyChanged(a,
e[b],c,32)}};l.prototype.vertexAttrsUpdated=function(a,b,c){this._updateOrCreateDirtyRecord(a,b,c,2,0,0,2,5,4)};l.prototype.matChanged=function(a){this._dirtyMaterials.add(a.id);if(this.onMaterialChanged)this.onMaterialChanged(a)};l.prototype.layerAdded=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectAdded(a,b[c])};l.prototype.layerRemoved=function(a){for(var b=a.getObjects(),c=0;c<b.length;c++)this.layObjectRemoved(a,b[c])};l.prototype.layObjectAdded=function(a,b){a=a.id;for(var c=
b.getGeometryRecords(),e=0;e<c.length;e++)this.objGeometryAdded(b,c[e],a)};l.prototype.layObjectRemoved=function(a,b){a=a.id;for(var c=b.getGeometryRecords(),e=0;e<c.length;e++)this.objGeometryRemoved(b,c[e],a)};l.prototype.layObjectReplaced=function(a,b){this.layObjectRemoved(a,b[0]);this.layObjectAdded(a,b[1])};l.prototype.objDirty=function(a,b){var c=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,a.id).forEach(function(e){c._updateOrCreateDirtyRecord(a,e[0],b,2,0,2,0,5,1)})};l.prototype.objTransformation=
function(a,b){var c=this;b=b||this._getParentLayerId(a);this._ensureGeomRecord(b,a.id).forEach(function(e){c._updateOrCreateDirtyRecord(a,e[0],b,2,0,0,2,5,16)})};l.prototype.objGeometryAdded=function(a,b,c){this._updateOrCreateDirtyRecord(a,b,c,1,4,0,0,0)};l.prototype.objGeometryRemoved=function(a,b,c){this._updateOrCreateDirtyRecord(a,b,c,4,1,2,0,0)};l.prototype.objGeometryReplaced=function(a,b){this.objGeometryRemoved(a,b[0]);this.objGeometryAdded(a,b[1])};l.prototype.objGeometryTransformation=
function(a,b){this.objGeometryReplaced(a,b)};l.prototype._componentPropertyChanged=function(a,b,c,f){this._updateOrCreateDirtyRecord(a,b,c,2,0,0,2,5,f)};l.prototype._updateOrCreateDirtyRecord=function(a,c,f,k,d,l,p,g,u){f=f||this._getParentLayerId(a);var e=c.id;a=this._ensureDirtyRecord(f,a.id);(f=a.get(e))?(c=f[1],c&d?a.delete(e):c&l?(f[1]=k,f[2]=u):c&p?f[2]|=u:c&g||b.assert(!1,"ModelDirtySet.objGeometryAdded: inconsistent state")):a.set(e,[c,k,u])};l.prototype._ensureGeomRecord=function(a,b){var c=
this._residentGeomRecords.get(a);c||(c=new Map,this._residentGeomRecords.set(a,c));a=c.get(b);a||(a=new Map,c.set(b,a));return a};l.prototype._ensureDirtyRecord=function(a,b){var c=this._dirtyGeomRecords.get(a);c||(c=new Map,this._dirtyGeomRecords.set(a,c));a=c.get(b);a||(a=new Map,c.set(b,a));return a};l.prototype._getParentLayerId=function(a){return a.parentLayer.id};l.prototype.formatDebugInfo=function(a){if(a)return"";var b=["ADD","UPD",void 0,"REM"],c="";this._dirtyGeomRecords.forEach(function(a,
d){a.forEach(function(a,e){0<c.length&&(c+="\n");c+=d+"."+e;var f=[];a.forEach(function(a){var b=a[1];f[b]||(f[b]=[]);f[b].push(a[0].geometry.id)});for(a=0;a<f.length;a++)if(f[a])for(c+=" "+b[a-1]+": ",e=0;e<f[a].length;e++)c+=f[a][e]+", "})});return c};return l}()})},"esri/core/iteratorUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.everyMap=Map.prototype.entries?function(c,a){for(c=c.entries();;){var f=c.next();if(f.done)break;if(!1===
a(f.value[1],f.value[0]))return!1}return!0}:function(c,a){var f=!0;c.forEach(function(b,c){f&&(f=!1!==a(b,c))});return f}})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define(["require","exports","../../lib/gl-matrix"],function(n,g,c){return function(){function a(a,b,l,e,h,m,k,d,q,p,g){this.shaderTransformationDirty=!0;this.data=a.toRenderData();this.componentOffsets=a.componentOffsets;this.boundingInfo=b;this.material=l;this.origin=null;this.center=c.vec3d.create();this.bsRadius=
0;this.transformation=null;this.calculateShaderTransformation=h;e&&this.updateTransformation(e,m);this.castShadow=k;this.singleUse=d;this.name=q;this.uniqueName=p;this.idx=g;this.canBeMerged=!0;this.instanceParameters={}}a.prototype.updateTransformation=function(a,b){this.transformation=a;this.shaderTransformationDirty=!0;this.bsRadius=this.getBoundingSphere(a,b,this.center)};a.prototype.shaderTransformationChanged=function(){this.shaderTransformationDirty=!0};a.prototype.getBoundingSphere=function(a,
b,l){b=b||c.mat4d.maxScale(a);c.mat4d.multiplyVec3(a,this.boundingInfo.getCenter(),l);return this.boundingInfo.getBSRadius()*b};Object.defineProperty(a.prototype,"hasShaderTransformation",{get:function(){return!!this.calculateShaderTransformation},enumerable:!0,configurable:!0});a.prototype.getShaderTransformation=function(){return this.calculateShaderTransformation?(this.shaderTransformationDirty&&(this.shaderTransformation||(this.shaderTransformation=c.mat4d.create()),c.mat4d.set(this.calculateShaderTransformation(this.transformation),
this.shaderTransformation),this.shaderTransformationDirty=!1),this.shaderTransformation):this.transformation};return a}()})},"esri/views/3d/webgl-engine/parts/View":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/has ../../../../core/Logger ../../../../core/promiseUtils ../../lib/gl-matrix ../lib/DrapedRenderer ../lib/GLMaterialRep ../lib/GLTextureRep ../lib/ProgramRepository ../lib/tracer ../lighting/Lightsources ./Model ./Viewport ../../../support/screenshotUtils ../../../webgl/context-util ../../../webgl/FramebufferObject ../../../webgl/RenderingContext".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A){var z=f.getLogger("esri.views.3d.webgl-engine.parts.View");n=function(){function f(a,b,c,d){var f=this;this._backgroundColor=l.vec4d.createFrom(1,1,1,1);this._lightDirection=l.vec3d.createFrom(0,1,0);this._didRender=!1;this._idleSuspend=this._needsRender=!0;this._shouldRender=!1;this._supersampleScreenshots=!0;this._screenshotQueue=[];this._container=a;this._stage=b;this._initializeContext(d);this._programRepository=new k(this._rctx);this._programRepository.globalOptions.viewingMode=
d.viewingMode;this._textureRep=new m(b.getAll(p.ContentType.TEXTURE),this._programRepository,function(){return f._viewport.getCamera().viewport},this._rctx);this._materialRep=new h(this._textureRep,this._programRepository);this._viewport=new r(this._stage,this._programRepository,this._materialRep,this._textureRep,this._rctx);this._initializeViewportCamera();this._drapedRenderer=new e(this._rctx,this._canvas,this._programRepository,this._materialRep,this._textureRep,c);this._initializeFrameTask()}
Object.defineProperty(f.prototype,"isLoadingResources",{get:function(){return this._viewport.isLoadingResources},enumerable:!0,configurable:!0});f.prototype._initializeFrameTask=function(){var a=this;this._frameTask={preRender:function(){d.begin();a._stage.processDirty();a.needsRender()?(a._shouldRender=!0,a._viewport.getCamera().setGLViewport(a._rctx),a._rctx.setClearColor.apply(a._rctx,a._backgroundColor),a._rctx.clear(16640)):a._shouldRender=!1},render:function(){a._shouldRender&&(a._didRender=
!0,x.lightDirection=a._lightDirection,a._viewport.render(x))},postRender:function(){d.end()},update:function(){a.resetNeedsRender();a._performScreenshots()}}};f.prototype._initializeViewportCamera=function(){var a=this._container.getBoundingClientRect(),b=this._viewport.getCamera();b.viewport[2]=a.width;b.viewport[3]=a.height;this._viewport.setCamera(b)};f.prototype._initializeContext=function(b){this._canvas=b.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style",
"width: 100%; height:100%; display:block;");var c=t.createContextOrErrorHTML(this._canvas,{alpha:b.alpha||!1,premultipliedAlpha:!0,antialias:!1,depth:!0,stencil:null==b.stencil?!0:b.stencil},b.renderContext);this._gl=d.instrumentContext(c);this._rctx=new A(this._gl,{disabledExtensions:b.deactivatedWebGLExtensions||{}});!b.alpha&&this._rctx.contextAttributes.alpha&&z.error("WebGL context has alpha channel even though no alpha channel was requested");!this._rctx.contextAttributes.alpha&&11<=a("safari")&&
(this._container.style.backgroundColor="black");this._container.appendChild(this._canvas);null!=b.supersampleScreenshots&&(this._supersampleScreenshots=b.supersampleScreenshots)};f.prototype.dispose=function(){this._viewport.dispose();this._viewport=null;this._drapedRenderer.dispose();this._drapedRenderer=null;this._programRepository.dispose();this._programRepository=null;this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=this._gl=this._canvas=this._container=
null};f.prototype.getCombinedStats=function(){return this._viewport.getCombinedStats()};f.prototype.setNeedsRender=function(){this._didRender=!1;this._needsRender=!0};f.prototype.resetNeedsRender=function(){this._didRender&&(this._didRender=this._needsRender=!1);this._viewport.resetNeedsRender();this._textureRep.resetNeedsRender()};f.prototype.needsRender=function(){return this._needsRender||!this._idleSuspend||this._viewport.needsRender()||this._textureRep.needsRender()};f.prototype.getFrameTask=
function(){return this._frameTask};f.prototype.setLighting=function(a){l.vec3d.set3(0,0,0,this._lightDirection);for(var b=0,c=a.lights;b<c.length;b++){var d=c[b];if(d instanceof q.MainLight){l.vec3d.negate(d.direction,this._lightDirection);break}}this._viewport.setLighting(a);this._needsRender=!0};f.prototype.getEdgeView=function(){return this._viewport.getEdgeView()};f.prototype.getMainLightDirection=function(){return this._lightDirection};f.prototype.getViewParams=function(a){var b={};if(!a||a.backgroundColor)b.backgroundColor=
this._backgroundColor;return b};f.prototype.setViewParams=function(a){this._needsRender=!0;a.backgroundColor&&(this._backgroundColor=a.backgroundColor)};f.prototype.setRenderParams=function(a){this._needsRender=!0;void 0!==a.idleSuspend&&(this._idleSuspend=!!a.idleSuspend);this._viewport.setRenderParams(a)};f.prototype.getRenderParams=function(){var a=this._viewport.getRenderParams();a.anisotropicFiltering=this._textureRep.getMaxAnisotropy();a.idleSuspend=this._idleSuspend;return a};f.prototype.getIdleSuspend=
function(){return this._idleSuspend};Object.defineProperty(f.prototype,"renderingContext",{get:function(){return this._rctx},enumerable:!0,configurable:!0});f.prototype.has=function(a){return"s3tc"===a?!!this._rctx.capabilities.compressedTextureS3TC:"shaderTextureLOD"===a?!!this._rctx.capabilities.shaderTextureLOD:!1};f.prototype.modify=function(a,b,c,d){this._viewport.modify(a,b,c,d)};f.prototype.setCamera=function(a){this._viewport.setCamera(a)};f.prototype.getCamera=function(){return this._viewport.getCamera()};
f.prototype.getCanvas=function(){return this._canvas};f.prototype.getDrapedTextureRenderer=function(){return this._drapedRenderer};f.prototype.takeScreenshot=function(a){var c=this,d=b.createResolver(function(){c._screenshotQueue=c._screenshotQueue.filter(function(a){return a.resolver!==d})});this._screenshotQueue.push({settings:a,resolver:d});this._needsRender=!0;return d.promise};f.prototype.getFramebufferTexture=function(a){return this._viewport.getFramebufferTexture(a)};Object.defineProperty(f.prototype,
"renderPlugins",{get:function(){return this._viewport.renderPlugins},enumerable:!0,configurable:!0});f.prototype._screenshotSuperSampleSettings=function(a){if(!this._supersampleScreenshots)return a;var b=a.framebufferWidth,d=a.framebufferHeight,e=a.region,f=Math.min(C,B/Math.max(b,d));return f<D?a:c({},a,{framebufferWidth:Math.round(b*f),framebufferHeight:Math.round(d*f),pixelRatio:a.pixelRatio*f,resample:{region:{x:Math.round(e.x*f),y:Math.round(e.y*f),width:Math.round(e.width*f),height:Math.round(e.height*
f)},width:b,height:d}})};f.prototype._readbackScreenshot=function(a){var b=a.framebufferWidth,c=a.framebufferHeight,d=a.region;if(a=a.resample){var e=u.createEmptyImageData(b,c,this._ensureScreenshotEncodeCanvas());this._gl.readPixels(0,0,b,c,6408,5121,new Uint8Array(e.data.buffer));b=u.createEmptyImageData(d.width,d.height,this._ensureScreenshotEncodeCanvas());return u.resampleHermite(e,b,!0,a.region.x,c-(a.region.y+a.region.height),a.region.width,a.region.height)}e=u.createEmptyImageData(d.width,
d.height,this._ensureScreenshotEncodeCanvas());this._gl.readPixels(d.x,c-(d.y+d.height),d.width,d.height,6408,5121,new Uint8Array(e.data.buffer));return e};f.prototype._renderScreenshot=function(a){var b=null,c=this._viewport.getCamera();a=this._screenshotSuperSampleSettings(a);var d=a.framebufferWidth,e=a.framebufferHeight,f=!1;if(d!==c.fullWidth||e!==c.fullHeight){var h=c.copy();h.fullWidth=d;h.fullHeight=e;b=c.fovX-h.fovX;f=c.fovY-h.fovY;0>b&&b<f?h.fovX=c.fovX:0>f&&f<b&&(h.fovY=c.fovY);this._drapedRenderer.forceUpdate&&
this._drapedRenderer.forceUpdate(h);f=!0;b=new v(this._rctx,{width:h.fullWidth,height:h.fullHeight,colorTarget:0,depthStencilTarget:3});this._rctx.bindFramebuffer(b);h.setGLViewport(this._rctx);this._rctx.setClearColor.apply(this._rctx,this._backgroundColor);this._rctx.clear(16640);this._viewport.render({lightDirection:this._lightDirection,fbo:b,camera:h,pixelRatio:a.pixelRatio})}a=this._readbackScreenshot(a);b&&b.dispose();this._rctx.bindFramebuffer(null);f&&this._drapedRenderer.forceUpdate&&this._drapedRenderer.forceUpdate(c);
return a};f.prototype._performScreenshots=function(){if(0!==this._screenshotQueue.length){for(var a=0,b=this._screenshotQueue;a<b.length;a++){var c=b[a],d=c.settings;if(this._gl){var e=this._ensureScreenshotEncodeCanvas(),f=this._renderScreenshot(d),d=u.encodeResult(f,d,e,{flipY:!0,premultipliedAlpha:!0});c.resolver(d)}else c.resolver.reject()}this._screenshotQueue=[]}};f.prototype._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||(this._screenshotEncodeCanvas=document.createElement("canvas"));
return this._screenshotEncodeCanvas};return f}();var x={lightDirection:l.vec3d.create(),camera:null,fbo:null,pixelRatio:1},B=2048,D=1.5,C=8;return n})},"esri/views/3d/webgl-engine/lib/DrapedRenderer":function(){define("require exports ../../lib/gl-matrix ../../support/debugFlags ./Camera ./ComponentUtils ./DefaultVertexBufferLayouts ./glUtil3D ./HighlightUtils ./Renderer ./RenderPass ./SliceHelper ./Util ../lighting/Lightsources ../materials/internal/TexOnlyGLMaterial ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v){n=function(){function f(a,b,e,f,h,k){var l=this;this._renderTargets={};this._clearColor=c.vec4d.createFrom(0,0,0,0);this._id2origin={};this._uniqueIdx=0;this._rctx=a;this._canvas=b;this._programRep=e;this._modelDirtySet=k;this._modelDirtySet.onMaterialChanged=function(a){return l.materialChanged(a)};this._renderer=new m(e,f,h,this._rctx,!0);this._sliceHelper=new d;this._renderer.onHasHighlightsChanged=function(a){if(l.onHasHighlightsChanged)l.onHasHighlightsChanged(a)};
this._renderer.setLighting({lights:[new p.AmbientLight(c.vec3d.createFrom(1,1,1))],groundLightingFactor:1,globalFactor:0})}f.prototype.dispose=function(){for(var a in this._renderTargets)this._renderTargets[a].dispose();this._renderTargets=null;this._renderer.dispose();this._renderer=null};f.prototype.createRenderTarget=function(a){return this.createRenderTargetInternal(a,!0)};f.prototype.createHighlightRenderTarget=function(a){return this.createRenderTargetInternal(a,!1)};f.prototype.disposeRenderTarget=
function(a){var b=this._renderTargets[a];b&&b.dispose();delete this._renderTargets[a]};f.prototype.getRenderTargetTexture=function(a){return(a=this._renderTargets[a])?a.colorTexture:null};f.prototype.addRenderGeometries=function(a){var b=this;a.forEach(function(a){null==a.origin&&(a.origin=b.getOrigin(a.center,a.bsRadius));a.idx=b._uniqueIdx++});this._renderer.modify(a,[]);if(this.onContentChanged)this.onContentChanged()};f.prototype.removeRenderGeometries=function(a){this._renderer.modify([],a);
if(this.onContentChanged)this.onContentChanged()};f.prototype.updateRenderGeometries=function(a,b){a=a.map(function(a){return{renderGeometry:a,updateType:b}});this._renderer.modify([],[],a);if(this.onContentChanged)this.onContentChanged()};f.prototype.updateRenderOrder=function(a){if(0<a.size&&(this._renderer.modifyRenderOrder(a),this.onContentChanged))this.onContentChanged()};f.prototype.setBackgroundColor=function(a){this._clearColor=a;if(this.onContentChanged)this.onContentChanged()};f.prototype.addRenderGeometryHighlight=
function(a,c){var d=a.instanceParameters,e=h.generateHighlightId();d.componentHighlights=b.addHighlight(d.componentHighlights,null,c,e);this.updateRenderGeometries([a],32);return e};f.prototype.removeRenderGeometryHighlight=function(a,c){var d=a.instanceParameters;d.componentHighlights=b.removeHighlight(d.componentHighlights,c);this.updateRenderGeometries([a],32)};f.prototype.isEmpty=function(){return this._renderer.isEmpty()&&!a.OVERLAY_DRAW_TEST_TEXTURE};f.prototype.processDirtyMaterials=function(){var a=
this._modelDirtySet.getDirtyMaterials();a&&this._renderer.modify([],[],[],a);this._modelDirtySet.clearDirtyMaterials()};Object.defineProperty(f.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});f.prototype.draw=function(a,b){return this.drawPass(k.MATERIAL,a,b)};f.prototype.drawHighlights=function(a,b){return this.drawPass(k.MATERIAL_HIGHLIGHT,a,b)};f.prototype.drawPass=function(b,d,e){if(this.isEmpty()||b===k.MATERIAL_HIGHLIGHT&&!this.hasHighlights)return!1;
this.processDirtyMaterials();if(!e.views.some(function(a){return a.extent[0]!==a.extent[2]&&a.extent[1]!==a.extent[3]}))return!1;d=this._renderTargets[d];if(!d)return!1;var f=this._rctx,h=f.gl,l=e.width,m=e.height;if(d.width!==l||d.height!==m)d.resize(l,m),d.colorTexture.setSamplingMode(9729);var q=z.camera;z.fbo=d;z.pixelRatio=e.pixelRatio||1;q.near=1;q.far=1E4;f.bindFramebuffer(d);f.setDepthTestEnabled(!1);f.setBlendFunctionSeparate(770,771,1,771);f.setClearColor.apply(f,this._clearColor);f.clear(h.COLOR_BUFFER_BIT);
for(h=0;h<e.views.length;h++){var p=e.views[h];q.viewport=p.viewport;c.mat4d.ortho(0,p.extent[2]-p.extent[0],0,p.extent[3]-p.extent[1],q.near,q.far,q.projectionMatrix);c.mat4d.identity(q.viewMatrix);c.mat4d.translate(q.viewMatrix,[-p.extent[0],-p.extent[1],0]);q.setGLViewport(this._rctx);a.OVERLAY_DRAW_TEST_TEXTURE&&this._drawTestTexture(l,m,A[e.index%A.length]);this._renderer.renderGeometryPass(b,z,null,null,this._sliceHelper)}f.setDepthTestEnabled(!0);f.setBlendFunctionSeparate(770,771,1,771);f.bindFramebuffer(null);
f.setViewport(0,0,this._canvas.width,this._canvas.height);d.colorTexture.descriptor.hasMipmap&&d.colorTexture.generateMipmap();return!0};f.prototype._drawTestTexture=function(a,b,d){var f=this._rctx,h=f.gl;if(!this._testPatternMat){for(var k=new Uint8Array(a*b*4),m=0,q=0;q<b;q++)for(var p=0;p<a;p++){var g=Math.floor(p/10),u=Math.floor(q/10);2>g||2>u||10*g>a-20||10*u>b-20?(k[m++]=255,k[m++]=255,k[m++]=255,k[m++]=255):(k[m++]=255,k[m++]=255,k[m++]=255,g&1&&u&1?k[m++]=p&1^q&1?0:255:k[m++]=g&1^u&1?0:
128)}a=new t(f,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:a,height:b},k);this._testPatternMat=new r(this._programRep,a,[1,1,1,1],!0,h.ALWAYS);this._testPatternBindParams={proj:c.mat4d.identity(),view:c.mat4d.identity(),nearFar:[-1,1],origin:[0,0,0],viewInvTransp:null,viewport:null,lightingData:null,fovY:0};this._quadVAO=e.createQuadVAO(f,l.Pos3Tex)}this._testPatternMat.setColor([d[0],d[1],d[2],1]);this._testPatternMat.bind(f,this._testPatternBindParams);this._testPatternMat.bindView(f,
this._testPatternBindParams);f.bindVAO(this._quadVAO);f.drawArrays(5,0,v.vertexCount(this._quadVAO,"geometry"));this._testPatternMat.release(f)};f.prototype.getOrigin=function(a,b){var d=0;b=10*b/1E4;1<b&&(d=Math.ceil(q.logWithBase(b,2)));b=1E4*Math.pow(2,d);var e=Math.round(a[0]/b),f=Math.round(a[1]/b);a=Math.round(a[2]/b);var d=d+"_"+e+"_"+f+"_"+a,h=this._id2origin[d];null==h&&(h={vec3:c.vec3d.createFrom(e*b,f*b,a*b),id:d},this._id2origin[d]=h);return h};f.prototype.materialChanged=function(a){if(this.onContentChanged)this.onContentChanged()};
f.prototype.createRenderTargetInternal=function(a,b){for(var c=a,d=0;this._renderTargets[c];)c=a+"_"+ ++d;this._renderTargets[c]=u.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9987,hasMipmap:b,maxAnisotropy:8,width:0,height:0},{colorTarget:0,depthStencilTarget:0});return c};return f}();var A=[[1,.5,.5],[.5,.5,1],[.5,1,.5]],z={fbo:null,camera:new f,pixelRatio:1};return n})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("require exports ../../../../core/iteratorUtils ../../lib/gl-matrix ../../support/buffer/glUtil ./ComponentUtils ./DefaultVertexAttributeLocations ./Float32ArrayList ./FxaaRenderPass ./HighlightTextureHelper ./InstanceBufferData ./IntervalUtilities ./LinearDepthTextureHelper ./NormalTextureHelper ./RenderContext ./RenderPass ./RenderPluginManager ./RenderSlot ./SmaaRenderPass ./StencilRenderingHelper ./Util ./edgeRendering/EdgeView ../lighting/SceneLighting ../materials/HUDMaterial ../../../webgl/BufferObject ../../../webgl/Profiling ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K){function N(a){return a.instanceParameters.hidden?[]:b.generateVisibleIndexRanges(a.instanceParameters.componentVisibilities,a.componentOffsets)}function H(b,c,d){var e=b.origin.vec3;x.setMatrixTranslation3(Q,-e[0],-e[1],-e[2]);a.mat4d.multiply(Q,b.transformation,c);a.mat4d.inverse(c,d);a.mat4d.transpose(d)}function M(a,b,c){for(var d in a){var e=a[d];b(d,e);e.origin2data.forEach(function(a,b){c(b,a)})}}function T(a){return!1===a.preinterleaved?
x.getFirstObjectValue(a.indices).length:a.indexCount}var V=a.mat4d.identity();n=function(){function g(a,b,c,d,e){this._lighting=new D.SceneLighting;this._mat2DataMerged={};this._mat2DataInstanced={};this._mat2DataPreinterleaved={};this._renderOrder=[];this._renderContext=new r;this._isRendering=!1;this._highlights=[];this._threshold=1535;this._needsRender=!0;this._fallbackDepthStencilTexture=null;this._stats=new U;this._edgeView=null;this.ssaoEnabled=this._edgeViewLoaded=!1;this.renderOptions={antialiasing:"smaa",
earlyOcclusionPixelDraw:!1};this._programRep=a;this._materialRep=b;this._orderedRendering=e;this._rctx=d;this._fxaaPass=new h(d);this._smaaPass=new A(d);this._renderContext.rctx=d;this._renderContext.lightingData=this._lighting.getOld();d.setDepthTestEnabled(!0);d.setFaceCullingEnabled(!0);d.setBlendingEnabled(!1);d.setBlendFunctionSeparate(770,771,1,771);this._bindParameters={view:null,proj:null,viewInvTransp:null,fovY:0,nearFar:null,lightingData:null,viewport:null,framebufferTex:null,shadowMappingEnabled:!1,
ssaoEnabled:!1,origin:null,pixelRatio:null,slicePlane:null};this._linearDepthTextureHelper=new q(d);this._normalTextureHelper=new p(d);this._highlightTextureHelper=new m(d);this._stencilRenderingHelper=new z(d);this._renderPlugins=new t.RenderPluginManager({rctx:d,gl:d.gl,programRep:a,textureRep:c,materialRep:b});this._initializeFramebufferTexture()}g.prototype._initializeFramebufferTexture=function(){var a=this._rctx.gl,a=this._rctx.contextAttributes.alpha?a.RGBA:a.RGB,b=new F(this._rctx,{target:3553,
pixelFormat:a,dataType:5121,samplingMode:9728,wrapMode:33071,width:4,height:4});this._framebuffer={format:a,texture:b}};g.prototype.dispose=function(){var a=this,b=function(b){a._releaseMaterials(b)},c=function(a,b){if(b.type===O.Preinterleaved)for(var c in b.instances)b.instances[c].vao.dispose(!0);else b.vao.dispose(!0)};M(this._mat2DataMerged,b,c);M(this._mat2DataInstanced,b,c);M(this._mat2DataPreinterleaved,b,c);this._mat2DataPreinterleaved=this._mat2DataInstanced=this._mat2DataMerged=null;this._framebuffer.texture.dispose();
this._framebuffer.texture=null;this._linearDepthTextureHelper.enabled=!1;this._normalTextureHelper.enabled=!1;this._stencilRenderingHelper.enabled=!1;this._fallbackDepthStencilTexture&&(this._fallbackDepthStencilTexture.dispose(),this._fallbackDepthStencilTexture=null);this._highlightTextureHelper&&(this._highlightTextureHelper.dispose(),this._highlightTextureHelper=null)};Object.defineProperty(g.prototype,"isLoadingResources",{get:function(){return"smaa"===this.renderOptions.antialiasing&&this._smaaPass.isLoadingResources},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"edgeView",{get:function(){var a=this;this._edgeViewLoaded||(this._edgeViewLoaded=!0,this._edgeView=new B.EdgeView(this._rctx,this._programRep,{setNeedsRender:function(){a._needsRender=!0}}),this._edgeView.initialize());return this._edgeView},enumerable:!0,configurable:!0});g.prototype.setLighting=function(a){this._lighting.set(a)};Object.defineProperty(g.prototype,"renderPlugins",{get:function(){return this._renderPlugins},enumerable:!0,
configurable:!0});g.prototype.resetNeedsRender=function(){this._needsRender=!1;this._renderPlugins.resetNeedsRender()};g.prototype.needsRender=function(){return this._needsRender||this._renderPlugins.needsRender()};g.prototype.getCombinedStats=function(){var a=this;this._stats.VBOallocatedSize=0;this._stats.VBOoptimalSize=0;this._stats.VBOusedSize=0;var b=function(){},c=function(b,c){if(c.type===O.Preinterleaved)for(var d in c.instances)b=c.instances[d].vao.size,a._stats.VBOallocatedSize+=b/4,a._stats.VBOusedSize+=
b/4,a._stats.VBOoptimalSize+=b/4;else a._stats.VBOallocatedSize+=c.buffer.getArray().length,a._stats.VBOusedSize+=c.buffer.getSize(),a._stats.VBOoptimalSize+=c.optimalCount};M(this._mat2DataMerged,b,c);M(this._mat2DataInstanced,b,c);M(this._mat2DataPreinterleaved,b,c);this._stats.VBOallocatedSize*=.00390625;this._stats.VBOusedSize*=.00390625;this._stats.VBOoptimalSize*=.00390625;return this._stats};g.prototype.getFramebufferTexture=function(a){switch(a){case "linearDepth":return this._linearDepthTextureHelper.framebuffer.colorTexture;
case "normals":return this._normalTextureHelper.framebuffer.colorTexture}return null};g.prototype._addHighlight=function(a){var b=this._getInstance(a);if(null===b)console.error("No instance found for RenderGeometry {name: '"+a.name+"', uniqueName: '"+a.uniqueName+"'}");else if(this._highlights.push(b),this._orderedRendering&&this._sortHighlightsByRenderOrder(),this._needsRender=!0,this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights)};g.prototype._removeHighlight=function(a){var b=
this._highlights.length;this._highlights=this._highlights.filter(function(b){return b.uniqueName!==a.uniqueName});if(b!==this._highlights.length){if(this.onHasHighlightsChanged)this.onHasHighlightsChanged(this.hasHighlights);this._needsRender=!0}};Object.defineProperty(g.prototype,"hasHighlights",{get:function(){return 0<this._highlights.length},enumerable:!0,configurable:!0});g.prototype._renderHUDVisibility=function(a){var b=this,c=C.shouldRenderVisibilityDuringRenderPass(a.pass),d=a.offscreenRenderingHelper&&
a.offscreenRenderingHelper.enabled,e=!1;c&&d&&a.offscreenRenderingHelper.renderHUDVisibility(function(){e=b._renderInternalSlot(v.OCCLUSION_PIXELS,a)});return e};g.prototype.renderGeometrySlotsPt1=function(a){this._renderPlugins.render(v.INTERNAL_MATERIAL,a);this._renderInternalSlot(v.STENCIL_MATERIAL,a);this._renderPlugins.render(v.OPAQUE_TERRAIN,a);this._renderInternalSlot(v.OPAQUE_MATERIAL,a);this._renderPlugins.render(v.OPAQUE_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep);this._renderPlugins.render(v.POSTPROCESSING_ATMOSPHERE_OPAQUE,
this._renderContext);this._renderInternalSlot(v.TRANSPARENT_MATERIAL,a);this.renderOptions.earlyOcclusionPixelDraw&&(this._renderHUDVisibility(a),this._renderInternalSlot(v.LINE_CALLOUTS,this._renderContext));this._renderPlugins.render(v.TRANSPARENT_EXTERNAL,a);a.ssaoHelper&&a.ssaoHelper.bindAll(this._programRep)};g.prototype.renderTransparentTerrain=function(a){return this._renderPlugins.render(v.TRANSPARENT_TERRAIN,a)};g.prototype.renderGeometrySlots=function(a){this.renderGeometrySlotsPt1(a);this.renderTransparentTerrain(a)};
g.prototype.renderHUD=function(a){this._bindParameters.renderTransparentlyOccludedHUD=a;this._renderInternalSlot(v.LINE_CALLOUTS_HUD_DEPTH,this._renderContext);this._renderInternalSlot(v.HUDMATERIAL1,this._renderContext);this._renderInternalSlot(v.HUDMATERIAL2,this._renderContext)};g.prototype._renderHighlights=function(a,b){if(b&&b.enabled&&(this.hasHighlights||this._renderPlugins.needsHighlight())){var c=null;b.profilingCallback&&(c=E.startMeasurement(this._renderContext.rctx));var d=a.fbo;this._highlightTextureHelper.prepareHighlightPass(a.camera);
this.renderGeometryPass(u.MATERIAL_HIGHLIGHT,a,null,null,this._renderContext.sliceHelper);this._rctx.clear(this._rctx.gl.DEPTH_BUFFER_BIT);this.renderHUD("both");this._highlightTextureHelper.finish(d);b.render(a,this._highlightTextureHelper.framebuffer);null!==c&&b.profilingCallback&&c.stop(function(a){b.profilingCallback&&b.profilingCallback(a)})}};g.prototype._needsRenderOccluded=function(a){for(var b in this._mat2DataInstanced){var c=this._mat2DataInstanced[b][0];if(c&&c.renderOccluded&&c.beginSlot(a)&&
c.isVisible())return!0}return!1};g.prototype._renderOccluded=function(a,b,c){if(b&&c&&c.enabled){var d=this._needsRenderOccluded(v.OPAQUE_MATERIAL)||this._needsRenderOccluded(v.TRANSPARENT_MATERIAL);if(b.enabled=d)d=this._renderContext,b.setupFBOs(a),b.prepareColorPass(),d.pass=u.MATERIAL,d.renderOccludedOnly=!0,this._renderInternalSlot(v.OPAQUE_MATERIAL,d),this._renderInternalSlot(v.TRANSPARENT_MATERIAL,d),d.renderOccludedOnly=!1,b.finish(c.framebuffer),b.apply()}};g.prototype._renderUnordered=function(a,
b,c){var d=this,e=this._rctx;this._isRendering=!0;this._stats.reset();var f=a.camera,h=a.fbo,k=a.pixelRatio;this._updateGlobalUniforms(f.projectionMatrix);this._renderContext.pass=u.MATERIAL;this._renderContext.camera=f;this._renderContext.pixelRatio=k;this._renderContext.shadowMap=b;this._renderContext.sliceHelper=c.slice;this._renderContext.ssaoHelper=c.ssao;this._renderContext.offscreenRenderingHelper=c.offscreenRendering;this._renderContext.stencilRenderingHelper=this._stencilRenderingHelper;
this._renderContext.depth=this._linearDepthTextureHelper.framebuffer;this._renderContext.normals=this._normalTextureHelper.framebuffer;this._renderContext.highlight=this._highlightTextureHelper.framebuffer;this._renderContext.options=this.renderOptions;c.offscreenRendering.enabled=!0;c.offscreenRendering.initializeFrame(f,h);this._renderPlugins.render(v.BACKGROUND,this._renderContext);this.renderGeometrySlotsPt1(this._renderContext);this._edgeView&&this.edgeView.shouldRender()&&c.offscreenRendering.renderSeparateAndComposite(function(){d._edgeView.render(d._bindParameters)},
void 0,"alpha");k=b=!1;this.renderOptions.earlyOcclusionPixelDraw||(b=this._renderHUDVisibility(this._renderContext),this._renderInternalSlot(v.LINE_CALLOUTS,this._renderContext));(k=this.renderTransparentTerrain(this._renderContext))&&b&&(c.offscreenRendering.compositeTransparentTerrainOntoHUDVisibility(),c.offscreenRendering.renderToTargets(function(){return d.renderHUD("occluded")},c.offscreenRendering.mainColor,c.offscreenRendering.tmpDepth,void 0,!0));k&&c.offscreenRendering.compositeTransparentTerrainOntoMain();
c.offscreenRendering.renderToTargets(function(){d._renderPlugins.render(v.POSTPROCESSING_ATMOSPHERE_TRANSPARENT,d._renderContext);d._renderPlugins.render(v.POSTPROCESSING_EXTERNAL,d._renderContext);d._renderOccluded(f,c.renderOccluded,c.offscreenRendering)},c.offscreenRendering.mainColor,c.offscreenRendering.mainDepth);b=this.renderOptions.antialiasing;"smaa"===b&&this._smaaPass.loadResources(function(){d._needsRender=!0});"smaa"===b&&this._smaaPass.enable()?(this._fxaaPass.disable(),this._smaaPass.render({colorTexture:c.offscreenRendering.colorTexture},
h)):"fxaa"===b&&this._fxaaPass.enable()?(this._smaaPass.disable(),this._fxaaPass.render({colorTexture:c.offscreenRendering.colorTexture},h)):(c.offscreenRendering.composite(),this._fxaaPass.disable(),this._smaaPass.disable());e.bindFramebuffer(h);this._renderContext.framebufferTex=c.offscreenRendering.colorTexture;this.renderHUD("notOccluded");this._renderHighlights(a,c.highlight);this._isRendering=!1};g.prototype._renderGeometryPassOrderedHighlight=function(a){this._renderInternalHighlights()};g.prototype._renderGeometryPassOrderedMaterial=
function(a){for(var b=null,c=0;c<this._renderOrder.length;c++){var d=this._renderOrder[c][1];if(d.instanced){var e=d.instanced||d.merged,f=e[a.pass];f&&f.isVisible()&&(this._renderInternalInstanced(e,f,this._bindParameters,Infinity),b=null)}d.merged&&(e=d.merged,(f=e[a.pass])&&f.isVisible()&&(d=f.getProgram(),d!==b&&(d.setUniformMatrix4fv("model",V),d.hasUniform("modelNormal")&&d.setUniformMatrix4fv("modelNormal",V)),b=d,this._renderInternalMerged(e,f,this._bindParameters,Infinity)))}};g.prototype._renderGeometryPassOrdered=
function(a){var b=a.camera;this._bindParameters.view=b.viewMatrix;this._bindParameters.proj=b.projectionMatrix;this._bindParameters.viewInvTransp=b.viewInverseTransposeMatrix;R[0]=b.near;R[1]=b.far;this._bindParameters.nearFar=R;this._bindParameters.lightingData=a.lightingData;this._bindParameters.viewport=b.fullViewport;this._bindParameters.framebufferTex=this._framebuffer.texture;this._bindParameters.pixelRatio=a.pixelRatio;this._bindParameters.slicePlane=a.sliceHelper&&a.sliceHelper.plane;a.isHighlightPass?
this._renderGeometryPassOrderedHighlight(a):this._renderGeometryPassOrderedMaterial(a)};g.prototype._renderOrdered=function(a,b){this._stats.reset();this.renderGeometryPass(a,b)};g.prototype.prepareRender=function(a){this._renderPlugins.prepareRender(a);this._renderContext.rctx.setDepthFunction(513)};g.prototype.render=function(a,b){this._orderedRendering?this._renderOrdered(u.MATERIAL,a):this._renderUnordered(a,b.shadowMap,b)};g.prototype.renderAuxiliaryBuffers=function(a,b){var c=b.ssao,d=b.slice;
b=b.shadowMap;var e=this.ssaoEnabled||this._renderPlugins.needsLinearDepth(),f=a.camera,h=a.fbo;if(this._linearDepthTextureHelper.enabled=e)this._linearDepthTextureHelper.setupFBOs(f),this._linearDepthTextureHelper.prepareDepthPass(),this.renderGeometryPass(u.MATERIAL_DEPTH,a,b,c,d),this._linearDepthTextureHelper.finish(h);if(this._normalTextureHelper.enabled=this.ssaoEnabled)this._normalTextureHelper.setupFBOs(f),this._normalTextureHelper.prepareNormalPass(),this.renderGeometryPass(u.MATERIAL_NORMAL,
a,b,c,d),this._normalTextureHelper.finish(h),c.computeSSAO(f,h,this._linearDepthTextureHelper.framebuffer,this._normalTextureHelper.framebuffer);c.bindAll(this._programRep)};g.prototype.renderGeometryPass=function(a,b,c,d,e){this._isRendering=!0;var f=b.camera;b=b.pixelRatio;this._updateGlobalUniforms(f.projectionMatrix);this._renderContext.pass=a;this._renderContext.camera=f;this._renderContext.pixelRatio=b;this._renderContext.shadowMap=c;this._renderContext.ssaoHelper=d;this._renderContext.depth=
this._linearDepthTextureHelper.framebuffer;this._renderContext.normals=this._normalTextureHelper.framebuffer;this._renderContext.sliceHelper=e;this._orderedRendering?this._renderGeometryPassOrdered(this._renderContext):this._renderGeometryPassUnordered(this._renderContext);this._isRendering=!1};g.prototype._renderGeometryPassUnordered=function(a){this.renderGeometrySlots(a)};g.prototype._renderInternalHighlights=function(a){void 0===a&&(a=null);for(var b=!1,c=0;c<this._highlights.length;++c){var d=
this._highlights[c],e=d.matData[u.MATERIAL_HIGHLIGHT];e&&(null===a||e.beginSlot(a))&&e.isVisible()&&(b=this._renderInternalHighlight(d,this._bindParameters,u.MATERIAL_HIGHLIGHT)||b)}return b};g.prototype._renderInternalSlotOccluded=function(a,b){var c=!1,d;for(d in this._mat2DataInstanced){var e=this._mat2DataInstanced[d],f=e[b.pass];f&&f.renderOccluded&&f.beginSlot(a)&&f.isVisible()&&(c=this._renderInternalInstanced(e,f,this._bindParameters,a)||c)}return c};g.prototype._renderInternalSlotMaterial=
function(a,b){var c=!1,d;for(d in this._mat2DataInstanced){var e=this._mat2DataInstanced[d],f=e[b.pass];f&&f.beginSlot(a)&&f.isVisible()&&(c=this._renderInternalInstanced(e,f,this._bindParameters,a)||c)}for(var e=this._programRep.getProgramsUsingUniform("model"),f=this._programRep.getProgramsUsingUniform("modelNormal"),h=0;h<e.length;h++){var k=e[h];k.setUniformMatrix4fv("model",V);-1<f.indexOf(k)&&k.setUniformMatrix4fv("modelNormal",V)}for(d in this._mat2DataMerged)e=this._mat2DataMerged[d],(f=e[b.pass])&&
f.beginSlot(a)&&f.isVisible()&&(c=this._renderInternalMerged(e,f,this._bindParameters,a)||c);for(d in this._mat2DataPreinterleaved)e=this._mat2DataPreinterleaved[d],(f=e[b.pass])&&f.beginSlot(a)&&f.isVisible()&&(c=this._renderInternalPreinterleaved(e,f,this._bindParameters,a)||c);a===v.STENCIL_MATERIAL&&this._stencilRenderingHelper.finish();return c};g.prototype._renderInternalSlotHighlights=function(a,b){return this._renderInternalHighlights(a)};g.prototype._renderInternalSlot=function(a,b){this._bindParameters.view=
b.camera.viewMatrix;this._bindParameters.proj=b.camera.projectionMatrix;this._bindParameters.viewInvTransp=b.camera.viewInverseTransposeMatrix;this._bindParameters.cameraAboveGround=b.camera.aboveGround;this._bindParameters.fovY=b.camera.fovY;R[0]=b.camera.near;R[1]=b.camera.far;var c=this._renderContext.offscreenRenderingHelper;this._bindParameters.nearFar=R;this._bindParameters.lightingData=b.lightingData;this._bindParameters.viewport=b.camera.fullViewport;this._bindParameters.framebufferTex=c?
c.colorTexture:null;this._bindParameters.shadowMap=b.shadowMap;this._bindParameters.shadowMappingEnabled=!!b.shadowMap&&b.shadowMap.enabled;this._bindParameters.ssaoEnabled=!!b.ssaoHelper&&b.ssaoHelper.enabled;this._bindParameters.pixelRatio=b.pixelRatio;this._bindParameters.slicePlane=b.sliceHelper&&b.sliceHelper.plane;this._bindParameters.hudVisibilityTexture=c?c.hudVisibilityTexture:null;return b.isHighlightPass?this._renderInternalSlotHighlights(a,b):b.renderOccludedOnly?this._renderInternalSlotOccluded(a,
b):this._renderInternalSlotMaterial(a,b)};g.prototype._renderInternalInstanced=function(a,b,c,d){var e=this,f=this._rctx,h=f.gl,k=!1,l=b.getDrawMode(f),m=f.capabilities.instancing,q=!1;a.origin2data.forEach(function(a){c.origin=a.origin;d===v.STENCIL_MATERIAL&&(e._stencilRenderingHelper.enabled=!0,e._stencilRenderingHelper.prepareStencilWritePass());var g=!1;if(b.instanced)for(var p in a.perGeometryDataInfo){var t=a.perGeometryDataInfo[p];k||(b.bind(f,c),k=!0);f.bindVAO(t.vao);var r=b.getProgram();
I.assertCompatibleVertexAttributeLocations(t.vao,r);g||(b.bindView(f,c),g=!0);var r=t.to-t.from,u=t.refCount;l===h.TRIANGLES&&(e._stats.trianglesRendered+=u*r/3);m.drawArraysInstanced(l,t.from,r,u);q=!0;e._stats.drawCallsAngleInstanced++;e._stats.instancesDrawnAngle+=u}else for(t in p=a.instances,p)r=p[t],u=r.displayedIndexRange,u&&0===u.length||(k||(b.bind(f,c),k=!0),g||(f.bindVAO(a.vao),b.bindView(f,c),g=!0),b.bindInstance(f,r),e._stats.drawCallsInstanced++,l===h.TRIANGLES&&(e._stats.trianglesRendered+=
(r.to-r.from)/3),u?e._drawArraysFaceRange(u,r.from,l):f.drawArrays(l,r.from,r.to-r.from),q=!0)});f.bindVAO(null);k&&b.release(f,c);return q};g.prototype._renderInternalHighlight=function(a,b,c){var d=this._rctx,e=d.gl;c=a.matData[c];var f=c.getDrawMode(d),h=a.instance,k=h.highlightedIndexRange,l=this._renderContext.offscreenRenderingHelper,l=(l?l.depthTexture:null)||this._getFallbackDepthTexture(),m=c.getProgram(),q=d.capabilities.instancing;b.origin=a.originData.origin;var g=!1;if(c.instanced&&a.type===
O.Instanced)for(a=a.instancedVAO,c.bind(d,b),d.bindVAO(a),I.assertCompatibleVertexAttributeLocations(a,m),c.bindView(d,b),a=0;a<k.length;a++){var p=k[a],g=p.range?p.range[0]+h.from:h.from,p=p.range?p.range[1]-p.range[0]+1:h.to-h.from;d.bindTexture(l,5);m.setUniform1i("depthTex",5);m.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);q.drawArraysInstanced(f,g,p,1);f===e.TRIANGLES&&(this._stats.trianglesRendered+=1*p/3);this._stats.drawCallsHighlight++;
g=!0}else if(a.type===O.Instanced&&c.instanced)console.error("_renderInternalHighlight: incompatible instance type");else{c.bind(d,b);c.bindView(d,b);q=null;switch(a.type){case O.Merged:p=a.originData;d.bindVAO(p.vao);m.setUniformMatrix4fv("model",V);break;case O.Instanced:p=a.originData;d.bindVAO(p.vao);c.bindInstance(d,h);break;case O.Preinterleaved:p=a.originData,a=p.instances[a.uniqueName].vao,d.bindVAO(a),c.bindInstance(d,h),q=a.indexBuffer&&a.indexBuffer.indexType}for(a=0;a<k.length;a++){p=
k[a];g=p.range?p.range[0]+h.from:h.from;p=p.range?p.range[1]-p.range[0]+1:h.to-h.from;d.bindTexture(l,5);c.getProgram().setUniform1i("depthTex",5);m.setUniform4f("highlightViewportPixelSz",0,0,1/this._bindParameters.viewport[2],1/this._bindParameters.viewport[3]);if(q){var t=I.getBytesPerElement(q);d.drawElements(f,p,q,g*t)}else d.drawArrays(f,g,p);f===e.TRIANGLES&&(this._stats.trianglesRendered+=p/3);this._stats.drawCallsHighlight++;g=!0}}d.bindVAO(null);c.release(d,b);return g};g.prototype._drawArraysFaceRange=
function(a,b,c){for(var d=this._rctx,e=0;e<a.length;e++){var f=a[e];d.drawArrays(c,f[0]+b,f[1]-f[0]+1)}this._stats.drawCallsFragmented+=a.length-1};g.prototype._drawElementsFaceRange=function(a,b,c,d){for(var e=this._rctx,f=I.getBytesPerElement(d),h=0;h<a.length;h++){var k=a[h];e.drawElements(c,k[1]-k[0]+1,d,(k[0]+b)*f)}this._stats.drawCallsFragmented+=a.length-1};g.prototype._renderInternalMerged=function(a,b,c,d){var e=this,f=this._rctx,h=f.gl,k=!1,l=!1;a.origin2data.forEach(function(a){c.origin=
a.origin;d===v.STENCIL_MATERIAL&&(e._stencilRenderingHelper.enabled=!0,e._stencilRenderingHelper.prepareStencilWritePass());if(!a.displayedIndexRange||0!==a.displayedIndexRange.length){l||(b.bind(f,c),l=!0);var m=b.getProgram();f.bindVAO(a.vao);I.assertCompatibleVertexAttributeLocations(a.vao,m);b.bindView(f,c);e._stats.drawCallsMerged++;m=b.getDrawMode(f);m===h.TRIANGLES&&(e._stats.trianglesRendered+=a.vao.vertexBuffers.geometry.size/3);a.displayedIndexRange?e._drawArraysFaceRange(a.displayedIndexRange,
0,m):f.drawArrays(m,0,I.vertexCount(a.vao,"geometry"));k=!0}});l&&b.release(f,c);return k};g.prototype._renderInternalPreinterleaved=function(a,b,c,d){var e=this,f=this._rctx,h=f.gl,k=!1,l=!1,m=b.getDrawMode(f);a.origin2data.forEach(function(a){c.origin=a.origin;var q=!1;d===v.STENCIL_MATERIAL&&(e._stencilRenderingHelper.enabled=!0,e._stencilRenderingHelper.prepareStencilWritePass());for(var p in a.instances){var g=a.instances[p],t=g.instance,r=g.vao,g=t.displayedIndexRange;if(!g||0!==g.length){l||
(b.bind(f,c),l=!0);var u=b.getProgram();I.assertCompatibleVertexAttributeLocations(r,u);f.bindVAO(r);q||(b.bindView(f,c),q=!0);b.bindInstance(f,t);e._stats.drawCallsPreinterleaved++;m===h.TRIANGLES&&(e._stats.trianglesRendered+=(t.to-t.from)/3);r=r.indexBuffer&&r.indexBuffer.indexType;g?r?e._drawElementsFaceRange(g,t.from,m,r):e._drawArraysFaceRange(g,t.from,m):r?(g=I.getBytesPerElement(r),f.drawElements(m,t.to-t.from,r,t.from*g)):f.drawArrays(m,t.from,t.to-t.from);k=!0}}});f.bindVAO(null);l&&b.release(f,
c);return k};g.prototype._updateGlobalUniforms=function(a){for(var b=this._programRep.getProgramsUsingUniform("proj"),c=0;c<b.length;c++)b[c].setUniformMatrix4fv("proj",a);if(this._lighting){b=this._programRep.getProgramsUsingUniform("lightingMainDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c]);b=this._programRep.getProgramsUsingUniform("lightDirection");for(c=0;c<b.length;c++)this._lighting.setUniforms(b[c])}};g.prototype.print=function(){var a=Object.keys(this._mat2DataMerged).length,
b=Object.keys(this._mat2DataInstanced).length,c=Object.keys(this._mat2DataPreinterleaved).length;console.log("number of materials (merged/instanced/preinterleaved): "+a+"/"+b+"/"+c);var d=0;M(this._mat2DataMerged,function(){},function(a,b){d+=Object.keys(b.instances).length});var e=0;M(this._mat2DataInstanced,function(){},function(a,b){e+=Object.keys(b.instances).length});var f=0;M(this._mat2DataPreinterleaved,function(){},function(a,b){f+=Object.keys(b.instances).length});console.log("number of instances (merged/instanced/preinterleaved): "+
d+"/"+e+"/"+f)};g.prototype.isEmpty=function(){for(var a in this._mat2DataInstanced){var b=this._mat2DataInstanced[a];if(!c.everyMap(b.origin2data,function(a){return x.objectEmpty(a.instances)}))return!1}for(a in this._mat2DataMerged)if(b=this._mat2DataMerged[a],!c.everyMap(b.origin2data,function(a){return x.objectEmpty(a.instances)}))return!1;for(a in this._mat2DataPreinterleaved)if(b=this._mat2DataPreinterleaved[a],!c.everyMap(b.origin2data,function(a){return x.objectEmpty(a.instances)}))return!1;
return!0};g.prototype.modify=function(a,b,c,d){this._isRendering&&console.warn("Renderer.modify called while rendering");var e=[],f=[],h=[];this._classifyRenderGeometry(a,e,f,h);a=[];var k=[],l=[];this._classifyRenderGeometry(b,a,k,l);var m={};c&&this._performUpdates(c,m);c=[];this._modifyMerged(e,a,c,m);this._modifyInstanced(f,k,c);this._modifyPreinterleaved(h,l,c);this._updateMergedFaceranges(m);this._releaseMaterials(c);e=this._highlights.length;if(b&&0<b.length&&0<e&&(this._highlights=this._highlights.filter(function(a){return!b.some(function(b){return b.uniqueName===
a.uniqueName})}),e!==this._highlights.length&&this.onHasHighlightsChanged))this.onHasHighlightsChanged(this.hasHighlights);this._updateHighlightVAOs();d&&this._modifyMaterials(d);this._needsRender=!0};g.prototype._classifyRenderGeometry=function(a,b,c,d){for(var e=0;e<a.length;e++){var f=a[e];if(1<=T(f.data))switch(this._getType(f)){case O.Merged:b.push(f);break;case O.Instanced:c.push(f);break;case O.Preinterleaved:d.push(f)}}};g.prototype._performUpdates=function(a,b){for(var c=0;c<a.length;c++){var d=
a[c],e=d.updateType,d=d.renderGeometry,f=this._getType(d)===O.Merged;if(1<=T(d.data)){e&2&&this._updateFaceranges(d,b);if(e&32){var h=this._getInstance(d);h&&this._updateHighlightFaceranges(d,h.instance)}e&4||f&&e&16?this._updateVertexAttributes(d,!f):!f&&e&16&&this._updateInstanceTransformation(d)}}};g.prototype._updateFaceranges=function(a,b){var c=a.material.id,d=a.origin.id,e=this._getType(a),f;if(e===O.Preinterleaved){var h=this._getOriginData(e,c,d);f=h.instances[a.uniqueName].instance}else h=
this._getOriginData(e,c,d),(f=h.instances[a.uniqueName])&&e===O.Merged&&(b[this._modifiedMergedFacerangesKey(c,d)]=h);f&&(f.displayedIndexRange=N(a),this._updateHighlightFaceranges(a,f))};g.prototype._updateHighlightFaceranges=function(a,c){if(c){var d=c.highlightedIndexRange,e;e=a.instanceParameters.hidden?null:b.generateHighlightedIndexRanges(a.instanceParameters.componentVisibilities,a.instanceParameters.componentHighlights,a.componentOffsets);(c.highlightedIndexRange=e)&&!d?this._addHighlight(a):
!e&&d&&this._removeHighlight(a)}};g.prototype._updateMergedFaceranges=function(a){for(var b in a){var c=a[b];c.displayedIndexRange=[];var e=c.instances,f=!0,h;for(h in e){var k=e[h];k.displayedIndexRange?(c.displayedIndexRange.push.apply(c.displayedIndexRange,d.offsetIntervals(k.displayedIndexRange,k.from)),f=!1):c.displayedIndexRange.push([k.from,k.to-1])}c.displayedIndexRange=f?null:d.mergeIntervals(c.displayedIndexRange)}};g.prototype._updateVertexAttributes=function(a,b){var c=a.material,d=c.bufferWriter,
e=c.id,f=a.origin.id,c=d.vertexBufferLayout.stride/4,h=this._getType(a);if(h===O.Preinterleaved)console.error("Updating Preinterleaved geometry not supported");else{var h=this._getOriginData(h,e,f),e=h.instances[a.uniqueName],f=h.buffer.getArray(),h=h.vao,k,l;b||(H(a,L,S),k=L,l=S);d.write({transformation:k,invTranspTransformation:l},a.data,a.instanceParameters,d.vertexBufferLayout.createView(f.buffer),e.from);x.assert(e.from+d.elementCount(a.data)===e.to,"material VBO layout has changed");h.vertexBuffers.geometry.setSubData(f,
e.from*c*4,e.from*c*4,e.to*c*4)}};g.prototype._updateInstanceTransformation=function(a){var b=this._getType(a),c=a.material.id,d=a.origin.id;b===O.Preinterleaved?(b=this._getOriginData(b,c,d),d=b.instances[a.uniqueName].instance,H(a,d.transformation,d.transformationNormal)):(b=this._getOriginData(b,c,d),d=b.instances[a.uniqueName],b=b.perGeometryDataInfo[a.data.id],c=b.instanceBufferData,H(a,d.transformation,d.transformationNormal),c&&(a=c.getSlot(a.idx),c.fill(a,0,d.transformation),c.fill(a,16,d.transformationNormal),
a=4*c.getOffset(a),d=I.getStride(b.vao.layout.instance),b.vao.vertexBuffers.instance.setSubData(c.getArray(),a,a,a+d)))};g.prototype._modifyMerged=function(a,b,c,d){a=this._compMatToDelta(a,b,O.Merged);b=this._mat2DataMerged;for(var e in a){var f=a[e],h;for(h in f){var k=f[h],l=k.optimalCount,m=k.sparseCount,q=k.material,p=q.bufferWriter.vertexBufferLayout,g=p.stride/4,t=b[e];null==t&&(x.assert(0<l),t=this._initializeMatData(q),b[e]=t,this._orderedRendering&&this._insertIntoRenderOrder(t,q.renderPriority,
"merged"));var r=t.origin2data.get(h);null==r&&(x.assert(0<l),r=this._createMergedData(p,l,k.origin),t.origin2data.set(h,r));if(0===l)r.vao.dispose(!0),r.vao=null,t.origin2data.delete(h),0===t.origin2data.size&&(c.push(e),delete b[e],this._orderedRendering&&this._removeFromRenderOrder(t,"merged"));else{var u=(p=l<k.sparseCount/2)?l:m,l=P,m=r.buffer.getSize(),t=r.buffer.getArray(),u=r.buffer.resize(u);p||u?this._rebuildMerged(r,k.toRemove,g,t,l):0<k.toRemove.length?(this._removeMergedByErasing(r,k.toRemove,
g,l),0<k.toAdd.length&&(l.end=m)):(l.begin=m,l.end=m);p=Q;x.setMatrixTranslation3(p,-k.origin[0],-k.origin[1],-k.origin[2]);this._appendMerged(r,q,k.toAdd,g,p,l);k=r.vao.vertexBuffers.geometry;k.byteSize!==r.buffer.getArray().buffer.byteLength?k.setData(r.buffer.getArray()):(p=l.begin,q=l.end,p<q&&(g=r.buffer.getArray(),p*=4,k.setSubData(g,p,p,4*q)));if(l.updatedDisplayedIndexRange||r.displayedIndexRange)d[this._modifiedMergedFacerangesKey(e,h)]=r}}}};g.prototype._createMergedData=function(a,b,c){return{type:O.Merged,
instances:{},vao:new K(this._rctx,l.Default3D,{geometry:f.glLayout(a)},{geometry:G.createVertex(this._rctx,35044)}),buffer:new e(b),optimalCount:0,origin:c}};g.prototype._rebuildMerged=function(a,b,c,d,e){for(var f=0;f<b.length;++f){var h=a.instances[b[f].uniqueName];a.optimalCount-=(h.to-h.from)*c;delete a.instances[b[f].uniqueName]}b=0;f=a.buffer.getArray();e.begin=0;e.end=0;var k=-1,l=-1,m=0,q;for(q in a.instances){var h=a.instances[q],p=h.from*c,g=h.to*c,t=g-p;k!==l&&l!==p?(f.set(d.subarray(k,
l),m),m+=l-k,k=p):-1===k&&(k=p);l=g;h.from=b/c;b+=t;h.to=b/c}k!==l&&f.set(d.subarray(k,l),m);e.end=b};g.prototype._removeMergedByErasing=function(a,b,c,d){if(0!==b.length){d.begin=Infinity;d.end=-Infinity;for(var e=-1,f=-1,h=0;h<b.length;h++){var k=b[h].uniqueName,l=a.instances[k].from*c,m=a.instances[k].to*c;e!==f&&f!==l?(a.buffer.erase(e,f),e=l):-1===e&&(e=l);f=m;delete a.instances[k];a.optimalCount-=m-l;l<d.begin&&(d.begin=l);m>d.end&&(d.end=m)}e!==f&&a.buffer.erase(e,f)}};g.prototype._appendMerged=
function(b,c,d,e,f,h){h.updatedDisplayedIndexRange=!1;c=c.bufferWriter;for(var k=0;k<d.length;k++){var l=d[k],m=l.data;a.mat4d.multiply(f,l.transformation,L);a.mat4d.inverse(L,S);a.mat4d.transpose(S);var q=h.end;c.write({transformation:L,invTranspTransformation:S},m,l.instanceParameters,c.vertexBufferLayout.createView(b.buffer.getArray().buffer),h.end/e);var m=c.elementCount(m)*e,p=q+m;x.assert(null==b.instances[l.uniqueName]);var g=N(l),q=new J(l.name,q/e,p/e,g,void 0,void 0,l.idx);b.instances[l.uniqueName]=
q;this._updateHighlightFaceranges(l,q);g&&(h.updatedDisplayedIndexRange=!0);b.optimalCount+=m;h.end+=m}};g.prototype._modifyInstanced=function(b,c,d){var h=this._rctx,m=O.Instanced;b=this._compMatToDelta(b,c,m);c=this._mat2DataInstanced;for(var q in b){var p=b[q],g;for(g in p){var t=p[g];if(0===t.optimalCount)t=c[q],t.origin2data.get(g).vao.dispose(!0),t.origin2data.delete(g),0===t.origin2data.size&&(d.push(q),delete c[q],this._orderedRendering&&this._removeFromRenderOrder(t,"instanced"));else{var r=
t.material,z=r.bufferWriter,v=c[q];if(null==v){var B=r.renderPriority,v=this._initializeMatData(r);c[q]=v;this._orderedRendering&&this._insertIntoRenderOrder(v,B,"instanced")}var B=z.vertexBufferLayout,A=v[u.MATERIAL].instanced?z.instanceBufferLayout:void 0,L=A&&A.fields.get("instanceColor"),D=A&&A.fields.get("instanceFeatureAttribute"),n=B.stride/4,r=v.origin2data.get(g);null==r&&(r={type:m,instances:{},vao:new K(h,l.Default3D,{geometry:f.glLayout(B)},{geometry:G.createVertex(h,35044)}),buffer:new e(t.optimalCount),
optimalCount:0,perGeometryDataInfo:{},origin:t.origin},v.origin2data.set(g,r));var v=r.buffer.getSize(),C=r.buffer.getArray(),S=t.optimalCount<t.sparseCount/2,E=r.buffer.resize(S?t.optimalCount:t.sparseCount),F;for(F in t.perGeometryDelta){var R=r.perGeometryDataInfo[F];if(R&&R.instanceBufferData){var P=t.perGeometryDelta[F].removeCount;0<P&&R.instanceBufferData.prepareFree(P)}}var H=t.toRemove;if(S||E){for(S=0;S<H.length;++S){E=H[S];delete r.instances[E.uniqueName];F=E.data.id;var I=R=r.perGeometryDataInfo[F];
0===--I.refCount&&null==t.dataId2refCount[F]?(r.optimalCount-=(I.to-I.from)*n,delete r.perGeometryDataInfo[F]):R.instanceBufferData&&R.instanceBufferData.free(E.idx)}var v=0,S=r.buffer.getArray(),E={},ea;for(ea in r.perGeometryDataInfo)I=r.perGeometryDataInfo[ea],x.assert(null==E[I.from]),E[I.from]=I;for(var aa in E)I=E[aa],P=I.from*n,R=I.to*n,S.set(C.subarray(P,R),v),I.from=v/n,v+=R-P,I.to=v/n;for(var U in r.instances)P=r.instances[U],P.from=r.perGeometryDataInfo[P.dataId].from,P.to=r.perGeometryDataInfo[P.dataId].to}else for(S=
0;S<H.length;++S)E=H[S],delete r.instances[E.uniqueName],F=E.data.id,R=r.perGeometryDataInfo[F],0===--R.refCount&&null==t.dataId2refCount[F]?(P=R.from*n,R=R.to*n,r.buffer.erase(P,R),r.optimalCount-=R-P,delete r.perGeometryDataInfo[F]):R.instanceBufferData&&R.instanceBufferData.free(E.idx);x.setMatrixTranslation3(Q,-t.origin[0],-t.origin[1],-t.origin[2]);for(F in t.perGeometryDelta)(R=r.perGeometryDataInfo[F])&&R.instanceBufferData&&(S=t.perGeometryDelta[F].addCount,0<S&&R.instanceBufferData.prepareAllocate(S));
C=t.toAdd;for(S=0;S<C.length;++S)if(E=C[S],P=E.data,F=P.id,R=r.perGeometryDataInfo[F],null==R?(z.write({},P,void 0,z.vertexBufferLayout.createView(r.buffer.getArray().buffer),v/n),H=z.elementCount(P)*n,P=v/n,v+=H,R=v/n,r.optimalCount+=H,R={refCount:1,from:P,to:R,vao:null,instanceBufferData:null},A&&(P=A.stride/4,R.vao=new K(h,l.Default3D,{geometry:f.glLayout(B),instance:f.glLayout(A,{divisor:1})},{geometry:r.vao.vertexBuffers.geometry,instance:G.createVertex(h,35044)}),R.instanceBufferData=new k(P,
t.perGeometryDelta[F].addCount)),r.perGeometryDataInfo[F]=R):++R.refCount,x.assert(R.from*n<=r.buffer.getSize()&&R.to*n<=r.buffer.getSize()),P=a.mat4d.create(),a.mat4d.multiply(Q,E.transformation,P),H=N(E),P=new J(E.name,R.from,R.to,H,P,E.instanceParameters,E.idx,F),r.instances[E.uniqueName]=P,this._updateHighlightFaceranges(E,P),R=R.instanceBufferData)H=R.allocate(E.idx),R.fill(H,0,P.transformation),R.fill(H,16,P.transformationNormal),L&&R.fill(H,L.offset/4,E.instanceParameters.color),D&&R.fill(H,
D.offset/4,E.instanceParameters.featureAttribute);x.assert(r.optimalCount===t.optimalCount);z=new Float32Array(r.buffer.getArray().buffer,0,r.buffer.getSize());r.vao.vertexBuffers.geometry.setData(z);for(F in r.perGeometryDataInfo)if(B=r.perGeometryDataInfo[F],B.vao&&(z=B.vao.vertexBuffers.instance))A=t.perGeometryDelta[F],0<A.addCount+A.removeCount&&(B=B.instanceBufferData.compact(),z.setData(B))}}}};g.prototype._modifyPreinterleaved=function(b,c,d){for(var e=this._rctx,h=O.Preinterleaved,k=this._mat2DataPreinterleaved,
m=0;m<b.length;m++){var q=b[m],p=q.material,g=p.bufferWriter,t=p.id,r=q.origin.id,u=q.origin.vec3,z=k[t];null==z&&(z=this._initializeMatData(p),k[t]=z);t=z.origin2data.get(r);null==t&&(t={type:h,origin:u,count:0,instances:{}},z.origin2data.set(r,t));x.setMatrixTranslation3(Q,-u[0],-u[1],-u[2]);z=a.mat4d.create();a.mat4d.multiply(Q,q.transformation,z);u=N(q);r=q.data;r.preinterleaved?null==r.vertexData?x.assert(!1,"Trying to re-add preinterleaved geometry data which is no longer available."):(z=new J(q.name,
0,r.indexCount,u,z,q.instanceParameters,q.idx,r.id),u=r.indexData?G.createIndex(e,35044,r.indexData):null,g=new K(e,l.Default3D,{geometry:f.glLayout(g.vertexBufferLayout)},{geometry:G.createVertex(e,35044)},u),g.vertexBuffers.geometry.setData(r.vertexData),r.indexData=null,r.vertexData=null,t.count+=1,t.instances[q.uniqueName]={instance:z,vao:g},this._updateHighlightFaceranges(q,z)):x.assert(!1,"Non-interleaved render geometry processed as pre-interleaved")}for(b=0;b<c.length;b++)q=c[b],u=q.origin,
p=q.material,t=p.id,r=u.id,q=q.uniqueName,z=k[t],e=z.origin2data.get(r),e.instances[q].vao.dispose(),delete e.instances[q],--e.count,0===e.count&&z.origin2data.delete(r),0===z.origin2data.size&&(d.push(t),delete k[t])};g.prototype._compMatToDelta=function(a,b,c){var d={};this._updateMatToDelta(a,!0,c,d);this._updateMatToDelta(b,!1,c,d);return d};g.prototype._updateMatToDelta=function(a,b,c,d){c=c===O.Instanced;for(var e=0;e<a.length;e++){var f=a[e],h=f.origin,k=f.material,l=k.bufferWriter,m=k.id,
q=c?this._mat2DataInstanced[m]:this._mat2DataMerged[m],q=q&&q.origin2data.get(h.id),p=d[m];null==p&&(p={},d[m]=p);m=p[h.id];if(null==m){m={optimalCount:null==q?0:q.optimalCount,sparseCount:null==q?0:q.buffer.getSize(),material:k,toAdd:[],toRemove:[],perGeometryDelta:null,origin:h.vec3};if(c){k={};if(void 0!==q)for(var g in q.perGeometryDataInfo)k[g]=q.perGeometryDataInfo[g].refCount;m.dataId2refCount=k;m.perGeometryDelta={}}p[h.id]=m}h=l.vertexBufferLayout.stride/4;l=l.elementCount(f.data)*h;c?(h=
f.data.id,k=m.perGeometryDelta[h],k||(k={addCount:0,removeCount:0},m.perGeometryDelta[h]=k),b?(k.addCount++,null==m.dataId2refCount[h]&&(m.dataId2refCount[h]=0),1===++m.dataId2refCount[h]&&(m.optimalCount+=l,m.sparseCount+=l),m.toAdd.push(f)):(k.removeCount++,0===--m.dataId2refCount[h]&&(delete m.dataId2refCount[h],m.optimalCount-=l),m.toRemove.push(f))):b?(m.optimalCount+=l,m.sparseCount+=l,m.toAdd.push(f)):(m.optimalCount-=l,m.toRemove.push(f))}};g.prototype._getType=function(a){if(a.data.preinterleaved)return O.Preinterleaved;
var b=!1,c=T(a.data),b=(b=(b=b||!1===a.material.canBeMerged)||a.material.instanced)||!0===a.material.renderOccluded;a.singleUse||(b=b||c>this._threshold);return b?O.Instanced:O.Merged};g.prototype._getTargetMat2Data=function(a){switch(a){case O.Merged:return this._mat2DataMerged;case O.Instanced:return this._mat2DataInstanced;case O.Preinterleaved:return this._mat2DataPreinterleaved}};g.prototype._getOriginData=function(a,b,c){return this._getTargetMat2Data(a)[b].origin2data.get(c)};g.prototype._modifiedMergedFacerangesKey=
function(a,b){return a+"_"+b};g.prototype._insertIntoRenderOrder=function(a,b,c){for(var d=a[u.MATERIAL].materialId,e=this._renderOrder.length,f=0;f<e&&this._renderOrder[f][0]>=b;){var h=this._renderOrder[f][1];if(h.id===d){x.assert(!h[c],"matData for type already exists");h[c]=a;return}f++}d={id:d,instanced:null,merged:null};d[c]=a;this._renderOrder.splice(f,0,[b,d])};g.prototype._removeFromRenderOrder=function(a,b){var c=a[u.MATERIAL].materialId;for(a=0;this._renderOrder[a][1].id!==c;)a++;c=this._renderOrder[a][1];
c[b]=null;c.instanced||c.merged||this._renderOrder.splice(a,1)};g.prototype._sortHighlightsByRenderOrder=function(){this._highlights.sort(function(a,b){a=a.matData[u.MATERIAL].renderPriority;b=b.matData[u.MATERIAL].renderPriority;return a>b?-1:b>a?1:0})};g.prototype._updateRenderOrder=function(a,b){for(var c=b.length,d=0;d<c&&b[d][1].id!==a;)d++;if(d<c){a=b[d][1];a=(a.merged||a.instanced)[u.MATERIAL].renderPriority;var e=b[d][0];if(a!==b[d][0])for(b[d][0]=a,e=a>e?-1:1,d+=e;-1<d&&d<c&&e*b[d][0]>e*
a;){var f=b[d];b[d]=b[d-e];b[d-e]=f;d+=e}}};g.prototype._modifyMaterials=function(a){var b=this;a.forEach(function(a){b._materialRep.updateMaterialParameters(a)})};g.prototype.modifyRenderOrder=function(a){var b=this;this._orderedRendering&&(a.forEach(function(a){b._updateRenderOrder(a,b._renderOrder)}),this._sortHighlightsByRenderOrder(),this._needsRender=!0)};g.prototype._initializeMatData=function(a){var b={origin2data:new Map};b[u.MATERIAL]=this._materialRep.aquire(a);b[u.MATERIAL_DEPTH_SHADOWMAP]=
this._materialRep.aquireDepthShadowMap(a);b[u.MATERIAL_NORMAL]=this._materialRep.aquireNormal(a);b[u.MATERIAL_DEPTH]=this._materialRep.aquireDepth(a);b[u.MATERIAL_HIGHLIGHT]=this._materialRep.aquireHighlight(a);return b};g.prototype._releaseMaterials=function(a){if(Array.isArray(a))for(var b=0;b<a.length;b++)this._materialRep.release(a[b]),this._materialRep.releaseDepthShadowMap(a[b]),this._materialRep.releaseNormal(a[b]),this._materialRep.releaseDepth(a[b]),this._materialRep.releaseHighlight(a[b]);
else this._materialRep.release(a),this._materialRep.releaseDepthShadowMap(a),this._materialRep.releaseNormal(a),this._materialRep.releaseDepth(a),this._materialRep.releaseHighlight(a)};g.prototype._getInstance=function(a){var b=a.uniqueName,c=a.material.id,d=this._getType(a),c=this._getTargetMat2Data(d)[c];if(!c)return null;a=c.origin2data.get(a.origin.id);if(!a)return null;var e;return(e=a.type===O.Preinterleaved?a.instances[b].instance:a.instances[b])?{type:d,uniqueName:b,instance:e,matData:c,originData:a,
instancedVAO:null,instancedVAOBaseInstance:null}:null};g.prototype._createBaseInstanceVAO=function(a){var b=this._rctx,c=a.instance,d=a.originData;if(a.type===O.Instanced&&d.perGeometryDataInfo){var d=d.perGeometryDataInfo[c.dataId],e=d.instanceBufferData;e&&(d=d.vao,c=e.getSlot(c.idx),a.instancedVAOBaseInstance!==c&&(e=I.setBaseInstanceOffset(d.layout,c),a.instancedVAO=new K(b,d.locations,e,d.vertexBuffers,d.indexBuffer),a.instancedVAOBaseInstance=c))}};g.prototype._updateHighlightVAOs=function(){for(var a=
0;a<this._highlights.length;++a)this._createBaseInstanceVAO(this._highlights[a])};g.prototype._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=new F(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:1,height:1},new Uint8Array([255,255,255,255])));return this._fallbackDepthStencilTexture};return g}();var U=function(){function a(){this.reset()}a.prototype.reset=function(){this.VBOusedSize=this.VBOoptimalSize=this.VBOallocatedSize=
this.instancesDrawnAngle=this.drawCallsHighlight=this.drawCallsFragmented=this.drawCallsPreinterleaved=this.drawCallsMerged=this.drawCallsAngleInstanced=this.drawCallsInstanced=this.trianglesRendered=0};return a}(),J=function(){return function(b,c,d,e,f,h,k,l){this.name=b;this.from=c;this.to=d;this.displayedIndexRange=e;this.transformation=f;this.instanceParameters=h;this.idx=k;this.dataId=l;null!=f&&(this.transformationNormal=a.mat4d.create(),a.mat4d.set(f,this.transformationNormal),a.mat4d.inverse(this.transformationNormal,
this.transformationNormal),a.mat4d.transpose(this.transformationNormal,this.transformationNormal))}}(),O;(function(a){a[a.Merged=0]="Merged";a[a.Instanced=1]="Instanced";a[a.Preinterleaved=2]="Preinterleaved"})(O||(O={}));var P={updatedDisplayedIndexRange:!1,begin:0,end:0},R=a.vec2d.create(),Q=a.mat4d.identity(),L=a.mat4d.create(),S=a.mat4d.create();return n})},"esri/views/3d/webgl-engine/lib/Float32ArrayList":function(){define(["require","exports","../../support/mathUtils"],function(n,g,c){return function(){function a(a){null==
a?a=16:65536>a&&(a=c.nextHighestPowerOfTwo(a));this.array=new Float32Array(a);this.size=0}a.prototype.resize=function(a,b){void 0===b&&(b=!1);this.size=a;var c;if(this.size>this.array.length){for(a=this.array.length||1;a<this.size;)a*=2;c=new Float32Array(a);b&&c.set(this.array);this.array=c;return!0}if(this.size<=this.array.length/2){a=this.array.length;for(c=2*this.size;a>=c;)a=Math.floor(a/2);c=new Float32Array(a);b&&c.set(this.array.subarray(0,a));this.array=c;return!0}return!1};a.prototype.append=
function(a){var b=this.size;this.resize(this.size+a.length,!0);this.array.set(a,b)};a.prototype.erase=function(a,b){for(;a<b;++a)this.array[a]=0};a.prototype.getArray=function(){return this.array};a.prototype.getSize=function(){return this.size};return a}()})},"esri/views/3d/webgl-engine/lib/FxaaRenderPass":function(){define(["require","exports","../../../webgl/BufferObject","../../../webgl/Program","../../../webgl/VertexArrayObject"],function(n,g,c,a,f){return function(){function b(a){this.isEnabled=
!1;this.vertexAttributeLocations={position:0};this.vertexBufferLayout=[{name:"position",count:2,type:5126,offset:0,stride:8,normalized:!1}];this.rctx=a}b.prototype.enable=function(){if(!this.isEnabled){var b=this.rctx;this.program=new a(b,"\n      #version 100\n      precision highp float;\n\n      attribute vec2 position;\n\n      varying   vec2 fCoordinate;\n\n      void main() {\n        fCoordinate \x3d (position + 1.0 ) * 0.5;\n        gl_Position \x3d vec4(position, -1, 1);\n      }","\n      #version 100\n      #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp float;\n      #else\n      precision mediump float;\n      #endif\n\n      /**\n       * @license\n       * Copyright (c) 2011 NVIDIA Corporation. All rights reserved.\n       *\n       * TO  THE MAXIMUM  EXTENT PERMITTED  BY APPLICABLE  LAW, THIS SOFTWARE  IS PROVIDED\n       * *AS IS*  AND NVIDIA AND  ITS SUPPLIERS DISCLAIM  ALL WARRANTIES,  EITHER  EXPRESS\n       * OR IMPLIED, INCLUDING, BUT NOT LIMITED  TO, NONINFRINGEMENT,IMPLIED WARRANTIES OF\n       * MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.  IN NO EVENT SHALL  NVIDIA\n       * OR ITS SUPPLIERS BE  LIABLE  FOR  ANY  DIRECT, SPECIAL,  INCIDENTAL,  INDIRECT,  OR\n       * CONSEQUENTIAL DAMAGES WHATSOEVER (INCLUDING, WITHOUT LIMITATION,  DAMAGES FOR LOSS\n       * OF BUSINESS PROFITS, BUSINESS INTERRUPTION, LOSS OF BUSINESS INFORMATION, OR ANY\n       * OTHER PECUNIARY LOSS) ARISING OUT OF THE  USE OF OR INABILITY  TO USE THIS SOFTWARE,\n       * EVEN IF NVIDIA HAS BEEN ADVISED OF THE POSSIBILITY OF SUCH DAMAGES.\n       */\n\n      #define FXAA_EDGE_THRESHOLD      (1.0/8.0)\n      #define FXAA_EDGE_THRESHOLD_MIN  (1.0/24.0)\n      #define FXAA_SEARCH_STEPS        16\n      #define FXAA_SEARCH_THRESHOLD    (1.0/4.0)\n      #define FXAA_SUBPIX_CAP          (3.0/4.0)\n      #define FXAA_SUBPIX_TRIM         (1.0/4.0)\n      #define FXAA_SUBPIX_TRIM_SCALE (1.0/(1.0 - FXAA_SUBPIX_TRIM))\n\n      uniform vec2 uRcpFrameDimension;\n      uniform sampler2D uColorTexture;\n      varying vec2 fCoordinate;\n\n      // Return the luma, the estimation of luminance from rgb inputs.\n      // This approximates luma using one FMA instruction,\n      // skipping normalization and tossing out blue.\n      // FxaaLuma() will range 0.0 to 2.963210702.\n      float FxaaLuma(vec3 rgb) {\n        return rgb.y * (0.587 / 0.299) + rgb.x;\n      }\n      vec3 FxaaLerp3(vec3 a, vec3 b, float amountOfA) {\n        return (vec3(-amountOfA) * b) + ((a * vec3(amountOfA)) + b);\n      }\n      vec4 FxaaTexOff(sampler2D tex, vec2 pos, ivec2 off, vec2 rcpFrame) {\n        float x \x3d pos.x + float(off.x) * rcpFrame.x;\n        float y \x3d pos.y + float(off.y) * rcpFrame.y;\n        return texture2D(tex, vec2(x, y));\n      }\n\n      // pos is the output of FxaaVertexShader interpolated across screen.\n      // xy -\x3e actual texture position {0.0 to 1.0}\n      // rcpFrame should be a uniform equal to  {1.0/frameWidth, 1.0/frameHeight}\n      vec3 FxaaPixelShader(vec2 pos, sampler2D tex, vec2 rcpFrame) {\n        vec3 rgbN \x3d FxaaTexOff(tex, pos.xy, ivec2( 0,-1), rcpFrame).xyz;\n        vec3 rgbW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 0), rcpFrame).xyz;\n        vec3 rgbM \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 0), rcpFrame).xyz;\n        vec3 rgbE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 0), rcpFrame).xyz;\n        vec3 rgbS \x3d FxaaTexOff(tex, pos.xy, ivec2( 0, 1), rcpFrame).xyz;\n        float lumaN \x3d FxaaLuma(rgbN);\n        float lumaW \x3d FxaaLuma(rgbW);\n        float lumaM \x3d FxaaLuma(rgbM);\n        float lumaE \x3d FxaaLuma(rgbE);\n        float lumaS \x3d FxaaLuma(rgbS);\n        float rangeMin \x3d min(lumaM, min(min(lumaN, lumaW), min(lumaS, lumaE)));\n        float rangeMax \x3d max(lumaM, max(max(lumaN, lumaW), max(lumaS, lumaE)));\n        float range \x3d rangeMax - rangeMin;\n        if (range \x3c max(FXAA_EDGE_THRESHOLD_MIN, rangeMax * FXAA_EDGE_THRESHOLD)) {\n          return rgbM;\n        }\n        vec3 rgbL \x3d rgbN + rgbW + rgbM + rgbE + rgbS;\n        float lumaL \x3d (lumaN + lumaW + lumaE + lumaS) * 0.25;\n        float rangeL \x3d abs(lumaL - lumaM);\n        float blendL \x3d max(0.0, (rangeL / range) - FXAA_SUBPIX_TRIM) * FXAA_SUBPIX_TRIM_SCALE;\n        blendL \x3d min(FXAA_SUBPIX_CAP, blendL);\n        vec3 rgbNW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1,-1), rcpFrame).xyz;\n        vec3 rgbNE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1,-1), rcpFrame).xyz;\n        vec3 rgbSW \x3d FxaaTexOff(tex, pos.xy, ivec2(-1, 1), rcpFrame).xyz;\n        vec3 rgbSE \x3d FxaaTexOff(tex, pos.xy, ivec2( 1, 1), rcpFrame).xyz;\n        rgbL +\x3d (rgbNW + rgbNE + rgbSW + rgbSE);\n        rgbL *\x3d vec3(1.0/9.0);\n        float lumaNW \x3d FxaaLuma(rgbNW);\n        float lumaNE \x3d FxaaLuma(rgbNE);\n        float lumaSW \x3d FxaaLuma(rgbSW);\n        float lumaSE \x3d FxaaLuma(rgbSE);\n        float edgeVert \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaN) + (0.25 * lumaNE)) +\n          abs((0.50 * lumaW ) + (-1.0 * lumaM) + (0.50 * lumaE )) +\n          abs((0.25 * lumaSW) + (-0.5 * lumaS) + (0.25 * lumaSE));\n        float edgeHorz \x3d\n          abs((0.25 * lumaNW) + (-0.5 * lumaW) + (0.25 * lumaSW)) +\n          abs((0.50 * lumaN ) + (-1.0 * lumaM) + (0.50 * lumaS )) +\n          abs((0.25 * lumaNE) + (-0.5 * lumaE) + (0.25 * lumaSE));\n        bool horzSpan \x3d edgeHorz \x3e\x3d edgeVert;\n        float lengthSign \x3d horzSpan ? -rcpFrame.y : -rcpFrame.x;\n        if(!horzSpan) {\n          lumaN \x3d lumaW;\n          lumaS \x3d lumaE;\n        }\n        float gradientN \x3d abs(lumaN - lumaM);\n        float gradientS \x3d abs(lumaS - lumaM);\n        lumaN \x3d (lumaN + lumaM) * 0.5;\n        lumaS \x3d (lumaS + lumaM) * 0.5;\n        if (gradientN \x3c gradientS)\n        {\n          lumaN \x3d lumaS;\n          lumaN \x3d lumaS;\n          gradientN \x3d gradientS;\n          lengthSign *\x3d -1.0;\n        }\n        vec2 posN;\n        posN.x \x3d pos.x + (horzSpan ? 0.0 : lengthSign * 0.5);\n        posN.y \x3d pos.y + (horzSpan ? lengthSign * 0.5 : 0.0);\n        gradientN *\x3d FXAA_SEARCH_THRESHOLD;\n        vec2 posP \x3d posN;\n        vec2 offNP \x3d horzSpan ? vec2(rcpFrame.x, 0.0) : vec2(0.0, rcpFrame.y);\n        float lumaEndN \x3d lumaN;\n        float lumaEndP \x3d lumaN;\n        bool doneN \x3d false;\n        bool doneP \x3d false;\n        posN +\x3d offNP * vec2(-1.0, -1.0);\n        posP +\x3d offNP * vec2( 1.0,  1.0);\n        for(int i \x3d 0; i \x3c FXAA_SEARCH_STEPS; i++) {\n          if(!doneN) {\n            lumaEndN \x3d FxaaLuma(texture2D(tex, posN.xy).xyz);\n          }\n          if(!doneP) {\n            lumaEndP \x3d FxaaLuma(texture2D(tex, posP.xy).xyz);\n          }\n          doneN \x3d doneN || (abs(lumaEndN - lumaN) \x3e\x3d gradientN);\n          doneP \x3d doneP || (abs(lumaEndP - lumaN) \x3e\x3d gradientN);\n          if(doneN \x26\x26 doneP) { break; }\n          if(!doneN) {\n            posN -\x3d offNP;\n          }\n          if(!doneP) {\n            posP +\x3d offNP;\n          }\n        }\n        float dstN \x3d horzSpan ? pos.x - posN.x : pos.y - posN.y;\n        float dstP \x3d horzSpan ? posP.x - pos.x : posP.y - pos.y;\n        bool directionN \x3d dstN \x3c dstP;\n        lumaEndN \x3d directionN ? lumaEndN : lumaEndP;\n        if(((lumaM - lumaN) \x3c 0.0) \x3d\x3d ((lumaEndN - lumaN) \x3c 0.0)) {\n          lengthSign \x3d 0.0;\n        }\n        float spanLength \x3d (dstP + dstN);\n        dstN \x3d directionN ? dstN : dstP;\n        float subPixelOffset \x3d (0.5 + (dstN * (-1.0/spanLength))) * lengthSign;\n        vec3 rgbF \x3d texture2D(tex, vec2(\n          pos.x + (horzSpan ? 0.0 : subPixelOffset),\n          pos.y + (horzSpan ? subPixelOffset : 0.0))).xyz;\n        return FxaaLerp3(rgbL, rgbF, blendL);\n      }\n\n      void main() {\n        vec4 color;\n        vec2 screenCoord \x3d fCoordinate;\n        // if (screenCoord.x \x3c 0.5) {\n          color.rgb \x3d FxaaPixelShader(screenCoord, uColorTexture, uRcpFrameDimension);\n        // } else if (screenCoord.x \x3c 0.501 \x26\x26 screenCoord.x \x3e 0.499) {\n        //   color.rgb \x3d vec3(1,0,0);\n        // } else {\n        //   color \x3d texture2D(uColorTexture, fCoordinate);\n        // }\n        color.a \x3d 1.0;\n        gl_FragColor \x3d color;\n      }",
this.vertexAttributeLocations);var e=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new f(b,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new c(b,34962,35044,e)});this.isEnabled=!0}};b.prototype.disable=function(){this.isEnabled&&(this.program.dispose(),this.program=null,this.vao.dispose(),this.vao=null,this.isEnabled=!1)};b.prototype.render=function(a,b){this.enable();var c=this.rctx;c.bindVAO(this.vao);c.bindFramebuffer(b);var e=0,f=0;null!=b?(e=b.descriptor.width,f=b.descriptor.height):
(e=c.gl.canvas.width,f=c.gl.canvas.height);c.bindProgram(this.program);c.bindTexture(a.colorTexture,0);this.program.setUniform1i("uColorTexture",0);this.program.setUniform2f("uRcpFrameDimension",1/e,1/f);c.setFaceCullingEnabled(!1);c.drawArrays(4,0,3)};return b}()})},"esri/views/3d/webgl-engine/lib/HighlightTextureHelper":function(){define(["require","exports","../../../webgl/FramebufferObject"],function(n,g,c){return function(){function a(a){this._rctx=a;this.viewportToRestore=this.fbo=null}a.prototype.dispose=
function(){this.fbo&&(this.fbo.dispose(),this.fbo=null)};Object.defineProperty(a.prototype,"framebuffer",{get:function(){return this.fbo},enumerable:!0,configurable:!0});a.prototype.prepareHighlightPass=function(a){var b=this._rctx,c=b.gl;a=a.fullViewport;var e=a[2],f=a[3];this.updateFBO(e,f);this.viewportToRestore=a;this._rctx.setViewport(0,0,e,f);b.bindFramebuffer(this.fbo);b.setClearColor(0,0,0,0);b.clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT)};a.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);
b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};a.prototype.updateFBO=function(a,b){this.fbo?this.fbo.resize(a,b):this.fbo=c.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:32819,samplingMode:9729,wrapMode:33071,width:a,height:b},{colorTarget:0,depthStencilTarget:1})};return a}()})},"esri/views/webgl/FramebufferObject":function(){define(["require","exports","../../core/has","./Renderbuffer","./Texture"],
function(n,g,c,a,f){return function(){function b(c,e,h,m){this._colorAttachment=this._stencilAttachment=this._depthAttachment=this._glName=this._context=null;this._initialized=!1;this._context=c;this._desc={colorTarget:e.colorTarget,depthStencilTarget:e.depthStencilTarget,width:e.width,height:e.height,multisampled:e.multisampled};this._id=b._nextId++;h&&(c=void 0,h instanceof f?(this._colorAttachment=h,c=h.descriptor):(c=h,this._colorAttachment=new f(this._context,c)),0!==this._desc.colorTarget&&
console.error("Framebuffer is initialized with a texture however the descriptor indicates using a renderbuffer color attachment!"),b._validateTextureDimensions(c,this._desc));m instanceof a?(2===e.depthStencilTarget?this._stencilAttachment=m:1===e.depthStencilTarget||3===e.depthStencilTarget?this._depthAttachment=m:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER'),b._validateBufferDimensions(m.descriptor,
this._desc)):m&&(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),e=void 0,m instanceof f?(this._depthStencilTexture=m,e=this._depthStencilTexture.descriptor):(e=m,this._depthStencilTexture=new f(this._context,e)),b._validateTextureDimensions(e,this._desc))}b.create=function(a,c){return new b(a,c)};b.createWithAttachments=function(a,c,f,m){return new b(a,f,c,m)};Object.defineProperty(b.prototype,
"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"colorTexture",{get:function(){return this._colorAttachment instanceof f?this._colorAttachment:null},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"depthStencilTexture",
{get:function(){return this._depthStencilTexture},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"width",{get:function(){return this._desc.width},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"height",{get:function(){return this._desc.height},enumerable:!0,configurable:!0});b.prototype.dispose=function(){this._context&&(this._disposeColorAttachment(),this._disposeDepthStencilAttachments(),this._glName&&(this._context.gl.deleteFramebuffer(this._glName),this._glName=
null),this._context=null)};b.prototype.attachColorTexture=function(a){if(a){b._validateTextureDimensions(a.descriptor,this._desc);this._disposeColorAttachment();if(this._initialized){this._context.bindFramebuffer(this);var c=this._context.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,a.glName,0)}this._colorAttachment=a}};b.prototype.detachColorTexture=function(){var a=void 0;if(this._colorAttachment instanceof f){a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);
var b=this._context.gl;this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}this._colorAttachment=null}return a};b.prototype.attachDepthStencilTexture=function(a){if(a){var c=a.descriptor;34041!==c.pixelFormat&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");34042!==c.dataType&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8_WEBGL!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");
b._validateTextureDimensions(c,this._desc);4!==this._desc.depthStencilTarget&&(this._desc.depthStencilTarget=4);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),c=this._context.gl,c.framebufferTexture2D(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.TEXTURE_2D,a.glName,0));this._depthStencilTexture=a}};b.prototype.detachDepthStencilTexture=function(){var a=this._depthStencilTexture;if(a&&this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;
this._context.gl.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,null,0)}this._depthStencilTexture=null;return a};b.prototype.attachDepthStencilBuffer=function(a){if(a){var c=a.descriptor;34041!==c.internalFormat&&33189!==c.internalFormat&&console.error("Depth/Stencil buffer must have correct internalFormat");b._validateBufferDimensions(c,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=34041===c.internalFormat?3:1;this._initialized&&(this._context.bindFramebuffer(this),
c=this._context.gl,c.framebufferRenderbuffer(c.FRAMEBUFFER,1===this._desc.depthStencilTarget?c.DEPTH_ATTACHMENT:c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,a.glName));this._depthAttachment=a}};b.prototype.detachDepthStencilBuffer=function(){var a=this._context.gl,b=this._depthAttachment;b&&this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null));this._depthAttachment=
null;return b};b.prototype.copyToTexture=function(a,b,c,f,k,d,q){(0>a||0>b||0>k||0>d)&&console.error("Offsets cannot be negative!");(0>=c||0>=f)&&console.error("Copy width and height must be greater than zero!");var e=this._desc,h=q.descriptor;3553!==q.descriptor.target&&console.error("Texture target must be TEXTURE_2D!");(a+c>e.width||b+f>e.height||k+c>h.width||d+f>h.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");e=this._context;e.bindTexture(q);
e.bindFramebuffer(this);e.gl.copyTexSubImage2D(3553,0,k,d,a,b,c,f)};b.prototype.readPixels=function(a,b,c,f,k,d,q){(0>=c||0>=f)&&console.error("Copy width and height must be greater than zero!");q||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(a,b,c,f,k,d,q)};b.prototype.resize=function(a,c){var e=this._desc;if(e.width!==a||e.height!==c)if(this._initialized)e.width=a,e.height=c,this._colorAttachment instanceof f?(l=this._colorAttachment,
e=l.descriptor,e.width=a,e.height=c,this._colorAttachment.dispose(),this._colorAttachment=new f(this._context,e),b._validateTextureDimensions(l.descriptor,this._desc)):this._colorAttachment&&this._disposeColorAttachment(),null!=this._depthStencilTexture?(e=this._depthStencilTexture.descriptor,e.width=a,e.height=c,this._depthStencilTexture.dispose(),this._depthStencilTexture=new f(this._context,e)):(this._depthAttachment||this._stencilAttachment)&&this._disposeDepthStencilAttachments(),this._context.getBoundFramebufferObject()===
this&&this._context.bindFramebuffer(null),this._initialized=!1;else{e.width=a;e.height=c;if(this._colorAttachment instanceof f){var l=this._colorAttachment;l.resize(a,c)}this._depthStencilTexture&&this._depthStencilTexture.resize(a,c)}};b.prototype.initialize=function(){if(this._initialized)return!1;var b=this._context.gl;this._glName&&b.deleteFramebuffer(this._glName);var c=b.createFramebuffer(),h=this._desc;b.bindFramebuffer(b.FRAMEBUFFER,c);if(!this._colorAttachment)if(0===h.colorTarget)this._colorAttachment=
new f(this._context,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:h.width,height:h.height});else{var m=new a(this._context,{internalFormat:32854,width:h.width,height:h.height});b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,m.glName);this._colorAttachment=m}this._colorAttachment instanceof f&&b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,this._colorAttachment.glName,0);switch(h.depthStencilTarget){case 1:case 3:this._depthAttachment||
(this._depthAttachment=new a(this._context,{internalFormat:1===h.depthStencilTarget?33189:34041,width:h.width,height:h.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,1===h.depthStencilTarget?b.DEPTH_ATTACHMENT:b.DEPTH_STENCIL_ATTACHMENT,b.RENDERBUFFER,this._depthAttachment.glName);break;case 2:this._stencilAttachment||(this._stencilAttachment=new a(this._context,{internalFormat:36168,width:h.width,height:h.height}));b.framebufferRenderbuffer(b.FRAMEBUFFER,b.STENCIL_ATTACHMENT,b.RENDERBUFFER,this._stencilAttachment.glName);
break;case 4:this._depthStencilTexture||(this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new f(this._context,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:h.width,height:h.height})),b.framebufferTexture2D(b.FRAMEBUFFER,b.DEPTH_STENCIL_ATTACHMENT,b.TEXTURE_2D,this._depthStencilTexture.glName,0)}b.checkFramebufferStatus(b.FRAMEBUFFER)!==
b.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=c;return this._initialized=!0};b.prototype._disposeColorAttachment=function(){if(this._colorAttachment instanceof f){var a=this._colorAttachment;if(this._initialized){this._context.bindFramebuffer(this);var b=this._context.gl;b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.TEXTURE_2D,null,0)}a.dispose()}else this._colorAttachment instanceof WebGLRenderbuffer&&(a=this._colorAttachment,b=this._context.gl,this._initialized&&
(this._context.bindFramebuffer(this),b.framebufferRenderbuffer(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0,b.RENDERBUFFER,null)),this._context.gl.deleteRenderbuffer(a));this._colorAttachment=null};b.prototype._disposeDepthStencilAttachments=function(){var a=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,1===this._desc.depthStencilTarget?a.DEPTH_ATTACHMENT:a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),a.framebufferTexture2D(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.TEXTURE_2D,null,0)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};b._validateBufferDimensions=
function(a,b){console.assert(0<=a.width&&0<=a.height);void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===a.height||console.error("Renderbuffer dimensions must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};b._validateTextureDimensions=function(a,b){console.assert(0<=a.width&&0<=a.height);3553!==a.target&&console.error("Texture type must be TEXTURE_2D!");void 0!==b.width&&0<=b.width&&void 0!==b.height&&0<=b.height?b.width===a.width&&b.height===
a.height||console.error("Color attachment texture must match the framebuffer's!"):(b.width=a.width,b.height=a.height)};b._nextId=0;return b}()})},"esri/views/webgl/Renderbuffer":function(){define(["require","exports","../../core/has"],function(n,g,c){return function(){function a(c,b){this._context=c;this._desc=b;this._glName=null;this._id=-1;c=this._context.gl;this._id=++a._nextId;this._glName=c.createRenderbuffer();this._context.bindRenderbuffer(this);c.renderbufferStorage(c.RENDERBUFFER,b.internalFormat,
b.width,b.height)}Object.defineProperty(a.prototype,"descriptor",{get:function(){return this._desc},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"glName",{get:function(){return this._glName},enumerable:!0,configurable:!0});a.prototype.resize=function(a,b){var c=this._context.gl,e=this._desc;if(e.width!==a||e.height!==b)e.width=a,e.height=b,this._context.bindRenderbuffer(this),
c.renderbufferStorage(c.RENDERBUFFER,e.internalFormat,e.width,e.height)};a.prototype.dispose=function(){this._glName&&(this._context.gl.deleteRenderbuffer(this._glName),this._glName=null);this._context=null};a._nextId=0;return a}()})},"esri/views/3d/webgl-engine/lib/InstanceBufferData":function(){define(["require","exports","../../support/mathUtils"],function(n,g,c){return function(){function a(a,b){null==b&&(b=4);var f=c.nextHighestPowerOfTwo(b*a);this.array=new Float32Array(f);this.zeroItem=new Float32Array(a);
this.endSlot=0;this.perInstanceDataSize=a;this.emptySlots=[];this.emptySlotsIdx=0;this.id2slot={};this.slot2id=Array(b)}a.prototype.prepareFree=function(a){this.emptySlots.length+=a};a.prototype.free=function(a){a=this.id2slot[a];null!=a&&(this.emptySlots[this.emptySlotsIdx++]=a,this.slot2id[a]=void 0)};a.prototype.prepareAllocate=function(a){a-=this.emptySlotsIdx;0<a&&this._resizeArray((this.endSlot+a)*this.perInstanceDataSize)};a.prototype.allocate=function(a){var b;b=0<this.emptySlotsIdx?this.emptySlots[--this.emptySlotsIdx]:
this.endSlot++;this.id2slot[a]=b;this.slot2id[b]=a;return b};a.prototype.getSlot=function(a){return this.id2slot[a]};a.prototype.getOffset=function(a){return a*this.perInstanceDataSize};a.prototype.getArray=function(){return this.array};a.prototype.fill=function(a,b,c){this.array.set(c,a*this.perInstanceDataSize+b)};a.prototype.compact=function(){if(0<this.emptySlotsIdx){this.emptySlots.length=this.emptySlotsIdx;for(this.emptySlots.sort(function(a,b){return a-b});0<this.emptySlotsIdx&&this.emptySlots[this.emptySlotsIdx-
1]===this.endSlot;)this.emptySlotsIdx--,this.endSlot--;for(;0<this.emptySlotsIdx;){this.emptySlotsIdx--;var a=this.endSlot-1,b=this.emptySlots[this.emptySlotsIdx],c=a*this.perInstanceDataSize,e=b*this.perInstanceDataSize;this.array.set(this.array.subarray(c,c+this.perInstanceDataSize),e);this.array.set(this.zeroItem,c);c=this.slot2id[a];this.slot2id[a]=void 0;this.slot2id[b]=c;this.id2slot[c]=b;this.endSlot--}}this._resizeArray(this.endSlot*this.perInstanceDataSize);this.emptySlots.length=0;return this.array};
a.prototype._resizeArray=function(a){var b;if(a>this.array.length){for(b=this.array.length||1;b<a;)b*=2;a=new Float32Array(b);a.set(this.array);this.array=a}else if(a<=this.array.length/2){b=this.array.length;for(a*=2;b>=a;)b/=2;a=new Float32Array(b);a.set(this.array.subarray(0,b));this.array=a}};return a}()})},"esri/views/3d/webgl-engine/lib/IntervalUtilities":function(){define(["require","exports"],function(n,g){return function(){function c(){}c.copyIntervals=function(a){for(var c=[],b=0;b<a.length;b++){var l=
a[b];c.push([l[0],l[1]])}return c};c.convertFaceToIndexRange=function(a,c){for(var b=0;b<a.length;b++){var f=a[b];f[0]*=c;f[1]=f[1]*c+(c-1)}};c.sortIntervals=function(a){return a.sort(function(a,b){return a[0]===b[0]?a[1]>b[1]?1:a[1]<b[1]?-1:0:a[0]>b[0]?1:a[0]<b[0]?-1:0})};c.intersectIntervals=function(a,c){if(0>=a.length)return[];for(var b=[],f=0;f<a.length;f++){var e=a[f];e[1]<c[0]||e[0]>c[1]||(e=[e[0],e[1]],e[0]<c[0]&&(e[0]=c[0]),e[1]>c[1]&&(e[1]=c[1]),b.push(e))}return b};c.mergeIntervals=function(a){if(0>=
a.length)return[];var c=[];a=this.sortIntervals(a);c.push(a[0]);for(var b=1;b<a.length;b++){var l=c[c.length-1];l[1]+1<a[b][0]?c.push(a[b]):l[1]<a[b][1]&&(l[1]=a[b][1],c.pop(),c.push(l))}return c};c.invertIntervals=function(a,c){for(var b=[],f=0,e=0;e<a.length;e++){var h=a[e];h[0]>f&&b.push([f,h[0]-1]);f=h[1]+1}f<=c&&b.push([f,c]);return b};c.offsetIntervals=function(a,c){for(var b=[],f=0;f<a.length;f++){var e=a[f];b.push([e[0]+c,e[1]+c])}return b};return c}()})},"esri/views/3d/webgl-engine/lib/LinearDepthTextureHelper":function(){define(["require",
"exports","./Util","../../../webgl/FramebufferObject"],function(n,g,c,a){return function(){function f(a){this._rctx=a;this._depthFBO=void 0;this.height=this.width=this.viewportToRestore=null}Object.defineProperty(f.prototype,"enabled",{get:function(){return void 0!==this._depthFBO},set:function(a){a!==this.enabled&&(a?this.enable():this.disable())},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"framebuffer",{get:function(){return this._depthFBO},enumerable:!0,configurable:!0});
f.prototype.setupFBOs=function(a){c.assert(this.enabled);this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this._rctx.setViewport(0,0,this.width,this.height)};f.prototype.prepareDepthPass=function(){c.assert(this.enabled);var a=this._rctx,f=a.gl;this._depthFBO.resize(this.width,this.height);a.bindFramebuffer(this._depthFBO);a.setClearStencil(0);a.setClearColor(0,0,0,0);a.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT|f.STENCIL_BUFFER_BIT);a.setBlendingEnabled(!1)};f.prototype.finish=
function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};f.prototype.enable=function(){c.assert(!this.enabled);this._depthFBO=a.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:3})};f.prototype.disable=function(){c.assert(this.enabled);this._depthFBO.dispose();this._depthFBO=
void 0};return f}()})},"esri/views/3d/webgl-engine/lib/NormalTextureHelper":function(){define(["require","exports","./Util","../../../webgl/FramebufferObject"],function(n,g,c,a){return function(){function f(a){this.rctx=a;this.normalFBO=void 0;this.height=this.width=this.viewportToRestore=null}Object.defineProperty(f.prototype,"enabled",{get:function(){return void 0!==this.normalFBO},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,
"framebuffer",{get:function(){return this.normalFBO},enumerable:!0,configurable:!0});f.prototype.setupFBOs=function(a){c.assert(this.enabled);this.viewportToRestore=a=a.fullViewport;this.width=a[2];this.height=a[3];this.rctx.setViewport(0,0,this.width,this.height)};f.prototype.prepareNormalPass=function(){c.assert(this.enabled);var a=this.rctx,f=a.gl;this.normalFBO.resize(this.width,this.height);a.bindFramebuffer(this.normalFBO);a.setClearColor(0,0,0,0);a.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT)};
f.prototype.finish=function(a){var b=this.rctx;b.bindFramebuffer(a);b.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3])};f.prototype.enable=function(){this.enabled||(this.normalFBO=a.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))};f.prototype.disable=function(){this.enabled&&(this.normalFBO.dispose(),this.normalFBO=
void 0)};return f}()})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define(["require","exports","./RenderPass","./RenderSlot"],function(n,g,c,a){return function(){function f(){this.camera=null;this.pixelRatio=1;this.normals=this.lightingData=this.highlight=this.depth=null;this.pass=c.MATERIAL;this.shadowMap=null;this.slot=a.BACKGROUND;this.options=this.rctx=this.framebufferTex=this.stencilRenderingHelper=this.sliceHelper=this.offscreenRenderingHelper=this.ssaoHelper=null;this.renderOccludedOnly=
!1}Object.defineProperty(f.prototype,"isHighlightPass",{get:function(){return this.pass===c.MATERIAL_HIGHLIGHT},enumerable:!0,configurable:!0});return f}()})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define(["require","exports","./depthRange","./RenderSlot"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function b(b){this.pluginContext=b;this.pluginsChanged=!1;this.renderPlugins=[];this.slots=[];for(b=0;b<a.MAX_SLOTS;++b)this.slots[b]=[]}b.prototype.add=
function(a,b){this.renderPlugins.push(b);for(var c=0;c<a.length;++c)this.slots[a[c]].push(b);b.initializeRenderContext(this.pluginContext);this.pluginsChanged=!0};b.prototype.remove=function(a){this.renderPlugins=this.renderPlugins.filter(function(b){return b!==a});for(var b=0;b<this.slots.length;++b)this.slots[b]=this.slots[b].filter(function(b){return b!==a});a.uninitializeRenderContext(this.pluginContext);this.pluginsChanged=!0};b.prototype.prepareRender=function(a){for(var b=0,c=this.renderPlugins;b<
c.length;b++){var f=c[b];f.prepareRender&&f.prepareRender(a)}};b.prototype.render=function(a,b){b.slot=a;var c=!1,e=0;for(a=this.slots[a];e<a.length;e++){var f=a[e];f.render(b)&&(c=f.didRender=!0)}return c};b.prototype.queryDepthRange=function(a){var b=f;b.near=Infinity;b.far=-Infinity;for(var h=0,l=this.renderPlugins;h<l.length;h++){var k=l[h];k.queryDepthRange&&(k=k.queryDepthRange(a))&&c.union(b,k,b)}return b};b.prototype.needsRender=function(){if(this.pluginsChanged)return!0;for(var a=0,b=this.renderPlugins;a<
b.length;a++)if(b[a].needsRender)return!0;return!1};b.prototype.needsHighlight=function(){for(var a=0,b=this.renderPlugins;a<b.length;a++)if(b[a].needsHighlight)return!0;return!1};b.prototype.needsLinearDepth=function(){for(var a=0,b=this.renderPlugins;a<b.length;a++)if(b[a].needsLinearDepth)return!0;return!1};b.prototype.resetNeedsRender=function(){this.pluginsChanged=!1;for(var a=0,b=this.renderPlugins;a<b.length;a++){var c=b[a];c.resetNeedsRender?c.resetNeedsRender():c.didRender&&(c.needsRender=
!1,c.didRender=!1)}};return b}();g.RenderPluginManager=n;var f={near:0,far:0}})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["require","exports"],function(n,g){function c(a,b){return{near:a,far:b}}function a(a,b,c){a.near=b;a.far=c;return a}Object.defineProperty(g,"__esModule",{value:!0});g.create=c;g.empty=function(f){return f?a(f,Infinity,-Infinity):c(Infinity,-Infinity)};g.set=a;g.union=function(a,b,c){void 0===c&&(c=a);c.near=Math.min(a.near,b.near);c.far=Math.max(a.far,b.far);
return c}})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../support/imageUtils ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Program ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(n,g,c,a,f,b,l,e){return function(){function h(a){this.isEnabled=this._isLoadingResources=!1;this.vertexAttributeLocations={vPosition:0};this.vertexBufferLayout=[{name:"vPosition",count:2,type:5126,offset:0,stride:8,normalized:!1}];
this.rctx=a}h.prototype.loadResources=function(a){var b=this;return this.data?!0:(this._isLoadingResources=!0,n(["./SmaaRenderPassData"],function(c){b.data=c;b._isLoadingResources=!1;a&&a()}),!1)};Object.defineProperty(h.prototype,"isLoadingResources",{get:function(){return this._isLoadingResources},enumerable:!0,configurable:!0});h.prototype.enable=function(){if(this.isEnabled)return!0;if(!this.loadResources())return!1;var c=this.rctx;this.programEdgeDetect=new b(c,this.data.edgeDetectShader.vertex,
this.data.edgeDetectShader.fragment,this.vertexAttributeLocations);this.programBlendWeights=new b(c,this.data.blendWeightShader.vertex,this.data.blendWeightShader.fragment,this.vertexAttributeLocations);this.programBlur=new b(c,this.data.blurShader.vertex,this.data.blurShader.fragment,this.vertexAttributeLocations);var h=new Float32Array([-1,-1,3,-1,-1,3]);this.vao=new e(c,this.vertexAttributeLocations,{geometry:this.vertexBufferLayout},{geometry:new a(c,34962,35044,h)});this.tmpFramebufferEdges=
f.createWithAttachments(this.rctx,{target:3553,pixelFormat:6407,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.tmpFramebufferBlend=f.createWithAttachments(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:4,height:4},{colorTarget:0,depthStencilTarget:0});this.textureArea=this.loadTextureFromBase64(this.data.areaTexture,9729,6407);this.textureSearch=this.loadTextureFromBase64(this.data.searchTexure,
9728,6409);return this.isEnabled=!0};h.prototype.disable=function(){this.isEnabled&&(this.programEdgeDetect.dispose(),this.programEdgeDetect=null,this.programBlendWeights.dispose(),this.programBlendWeights=null,this.programBlur.dispose(),this.programBlur=null,this.vao.dispose(),this.vao=null,this.textureArea.dispose(),this.textureArea=null,this.textureSearch.dispose(),this.textureSearch=null,this.tmpFramebufferBlend.dispose(),this.tmpFramebufferBlend=null,this.tmpFramebufferEdges.dispose(),this.tmpFramebufferEdges=
null,this.isEnabled=!1)};h.prototype.render=function(a,b){this.enable();var c=this.rctx,e=0,f=0;null!=b?(e=b.descriptor.width,f=b.descriptor.height):(e=c.gl.canvas.width,f=c.gl.canvas.height);c.bindVAO(this.vao);c.setFaceCullingEnabled(!0);c.setCullFace(1029);c.setFrontFace(2305);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!1);c.setViewport(0,0,e,f);this.tmpFramebufferEdges.resize(e,f);c.bindFramebuffer(this.tmpFramebufferEdges);c.setClearColor(0,0,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programEdgeDetect);
c.bindTexture(a.colorTexture,0);this.programEdgeDetect.setUniform1i("tColor",0);this.programEdgeDetect.setUniform4f("uResolution",1/e,1/f,e,f);c.drawArrays(4,0,3);this.tmpFramebufferBlend.resize(e,f);c.bindFramebuffer(this.tmpFramebufferBlend);c.setClearColor(0,0,1,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlendWeights);this.programBlendWeights.setUniform4f("uResolution",1/e,1/f,e,f);c.bindTexture(this.textureSearch,1);this.programBlendWeights.setUniform1i("tSearch",1);c.bindTexture(this.textureArea,
2);this.programBlendWeights.setUniform1i("tArea",2);c.bindTexture(this.tmpFramebufferEdges.colorTexture,3);this.programBlendWeights.setUniform1i("tEdges",3);c.drawArrays(4,0,3);c.bindFramebuffer(b);c.setClearColor(0,1,0,1);c.clear(c.gl.COLOR_BUFFER_BIT);c.bindProgram(this.programBlur);this.programBlur.setUniform4f("uResolution",1/e,1/f,e,f);c.bindTexture(a.colorTexture,0);this.programBlur.setUniform1i("tColor",0);c.bindTexture(this.tmpFramebufferBlend.colorTexture,1);this.programBlur.setUniform1i("tBlendWeights",
1);c.drawArrays(4,0,3);c.setDepthTestEnabled(!0)};h.prototype.loadTextureFromBase64=function(a,b,d){var e=new l(this.rctx,{pixelFormat:d,dataType:5121,wrapMode:33071,samplingMode:b},null);c.requestImage(a).then(function(a){e.resize(a.width,a.height);e.setData(a)});return e};return h}()})},"esri/views/3d/webgl-engine/lib/StencilRenderingHelper":function(){define(["require","exports","./Util"],function(n,g,c){return function(){function a(a){this._enabled=!1;this._rctx=a}Object.defineProperty(a.prototype,
"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});a.prototype.prepareStencilWritePass=function(){c.assert(this.enabled);var a=this._rctx;a.setStencilFunction(519,1,255);a.setStencilOp(7680,7680,7681);a.setStencilWriteMask(255)};a.prototype.finish=function(){if(this.enabled){var a=this._rctx;a.setStencilFunction(519,0,0);a.setStencilOp(7680,7680,7680)}};a.prototype.enableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(517,
1,255)};a.prototype.disableStencilRead=function(){this.enabled&&this._rctx.setStencilFunction(519,0,0)};a.prototype.enable=function(){this._enabled=!0;this._rctx.setStencilTestEnabled(!0)};a.prototype.disable=function(){this._enabled=!1;this._rctx.setStencilTestEnabled(!1)};return a}()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../../../core/arrayUtils ../../../../../core/promiseUtils ../../../../../core/requireUtils ../../../../../core/workers ../../../lib/gl-matrix ../../../support/mathUtils ../../../support/buffer/BufferView ../../../support/buffer/bufferViewUtil ../../../support/buffer/typedArrayUtil ../localOriginHelper ../LocalOriginManager ../PreinterleavedGeometryData ../RegularGridLocalOriginFactory ../TextureBackedBuffer/BufferManager ./bufferLayouts ./edgeBufferWriters ./EdgeProcessingWorker ./EdgeRenderer ./strokes ./util ../../../../webgl/BufferObject ../../../../webgl/VertexArrayObject module".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I){Object.defineProperty(g,"__esModule",{value:!0});var K=function(){function g(a,b,c){this.rctx=a;this.programRepository=b;this.callbacks=c;this.profilingCallback=null;this.perObjectData=new Map;this.renderers=new Map;this.localOrigins=new u.LocalOriginManager(new v(1E4));this.gpuMemoryUsage=this.numberOfRenderedEdges=0;this.worker=new B;this.workerThread=null;this.destroyed=!1;this.tmpModelPosition=m.vec3d.create();this.tmpCameraPosition=
m.vec3d.create();this.componentColorManager=new A.BufferManager(this.rctx,2)}g.prototype.initialize=function(){var a=this;h.open(e.getAbsMid("./EdgeProcessingWorker",n,I),{client:this}).then(function(b){a.destroyed?b.close():a.workerThread=b});for(var b=z.VertexLayout.createBuffer(4),c=0;4>c;c++)b.sideness.set(c,0,0===c||3===c?0:1),b.sideness.set(c,1,0===c||1===c?0:1);this.verticesBufferObject=E.createVertex(this.rctx,35044,b.buffer)};g.prototype.destroy=function(){this.destroyed||(this.workerThread&&
(this.workerThread.close(),this.workerThread=null),this.verticesBufferObject&&(this.verticesBufferObject.dispose(),this.verticesBufferObject=null),this.destroyed=!0)};g.prototype.getGpuMemoryUsage=function(){return this.gpuMemoryUsage};Object.defineProperty(g.prototype,"numberOfRenderedPrimitives",{get:function(){return this.numberOfRenderedEdges},enumerable:!0,configurable:!0});g.prototype.shouldRender=function(){return 0<this.renderers.size};g.prototype.addObject=function(b,c,d){return a(this,void 0,
void 0,function(){var a,e,h,k,m,q,g;return f(this,function(f){switch(f.label){case 0:if(this.hasObject(b))return[2];a=[];h={loaded:l.create(function(a){return e=a}),renderables:[]};this.perObjectData.set(b,h);if(d&&d.mergeGeometries&&1<b.geometries.length&&this.canMergeGeometries(b))a.push(this.addObjectMergedGeometries(b,h,c));else for(k=0;k<b.geometries.length;k++)m=b.geometries[k],q=b.geometryRecords[k],g=q.materials[0],g.supportsEdges&&(m.data instanceof t?a.push(this.addGeometryPreinterleaved(b,
h,m,m.data,q,c)):a.push(this.addGeometryNonPreinterleaved(b,h,m,m.data,q,c[0])));return[4,l.all(a)];case 1:return f.sent(),this.callbacks.setNeedsRender(),e(),[2]}})})};g.prototype.hasObject=function(a){return this.perObjectData.has(a)};g.prototype.updateAllComponentOpacities=function(b,c){return a(this,void 0,void 0,function(){var a,d;return f(this,function(e){switch(e.label){case 0:return(a=this.perObjectData.get(b))?[4,a.loaded]:[2];case 1:return e.sent(),d=c instanceof Array?function(a){return c[a]}:
function(a){return c},a.renderables.forEach(function(a){for(var b=a.components.meta.length,c=0;c<b;c++){var e=d(c),f=a.components.meta[c],h=f.index;f.material.opacity=e;a.components.buffer.textureBuffer.setDataElement(h,1,3,255*e)}a.allTransparent=G.determineAllTransparent(a.components.meta)}),this.callbacks.setNeedsRender(),[2]}})})};g.prototype.updateAllComponentMaterials=function(b,c){return a(this,void 0,void 0,function(){var a,d=this;return f(this,function(e){switch(e.label){case 0:return(a=
this.perObjectData.get(b))?[4,a.loaded]:[2];case 1:return e.sent(),a.renderables.forEach(function(a){var b=c[0],e=G.determineRequiresUberRenderer(c),f=D.EdgeRenderer.getKey(e,b.type,b.slicePlaneEnabled);if(f!==a.rendererKey){var h=d.renderers.get(a.rendererKey),b=d.aquireRenderer(e,b);h.removeRenderable(a);h.refCount.decrement();a.rendererKey=f;b.addRenderable(a)}for(f=0;f<c.length;f++)a.components.meta[f].material=c[f];d.updateComponentBuffer(a.components);a.allTransparent=G.determineAllTransparent(a.components.meta)}),
this.callbacks.setNeedsRender(),[2]}})})};g.prototype.updateObjectVisibility=function(b,c){return a(this,void 0,void 0,function(){var a;return f(this,function(d){switch(d.label){case 0:return(a=this.perObjectData.get(b))?[4,a.loaded]:[2];case 1:return d.sent(),a.renderables.forEach(function(a){a.visible=c}),this.callbacks.setNeedsRender(),[2]}})})};g.prototype.removeObject=function(a){var b=this,c=this.perObjectData.get(a);c&&(this.perObjectData.delete(a),c.loaded.then(function(){c.renderables.forEach(function(a){b.removeRenderable(a)});
b.callbacks.setNeedsRender()}))};g.prototype.removeAll=function(){var a=this;this.perObjectData.forEach(function(b,c){a.removeObject(c)})};g.prototype.createSolidEdgeMaterial=function(a){return c({},N,a,{type:"solid"})};g.prototype.createSketchEdgeMaterial=function(a){return c({},H,a,{type:"sketch"})};g.prototype.render=function(a){var b=this;this.localOrigins.updateViewMatrices(a.view);this.renderers.forEach(function(a){0===a.refCount.value&&(b.renderers.delete(a.key),a.dispose())});this.componentColorManager.garbageCollect();
this.componentColorManager.updateTextures();var c=a.view,d=0,e=0;this.renderers.forEach(function(a){a.forEachRenderable(function(a){d+=a.statistics.averageEdgeLength;e++})});var f={distanceFalloffFactor:d/e*40,minimumEdgeLength:G.estimateLengthAtDistance(a.viewport[3],a.fovY,1,3.5)},h=this.rctx.capabilities.blendMinMax;h?(this.rctx.setDepthWriteEnabled(!1),this.rctx.setBlendingEnabled(!0),this.rctx.setBlendEquationSeparate(32774,h.MAX),this.rctx.setBlendFunctionSeparate(1,0,1,1)):(this.rctx.setDepthWriteEnabled(!0),
this.rctx.setBlendingEnabled(!1));this.rctx.setDepthTestEnabled(!0);this.rctx.setDepthFunction(515);this.updateObjectCameraDistances(a);this.numberOfRenderedEdges=0;this.renderers.forEach(function(c){b.renderRegularEdges(c,a,f);b.renderSilhouetteEdges(c,a,f)});this.rctx.setDepthWriteEnabled(!0);this.rctx.setDepthFunction(513);this.rctx.setBlendEquationSeparate(32774,32774);this.rctx.setBlendFunctionSeparate(1,0,1,1);a.view=c};g.prototype.computeModelTransformWithLocalOrigin=function(a,b,c){a.getCombinedStaticTransformation(b,
c);b.origin?this.localOrigins.register(b.origin):(a=m.vec3d.set3(c[12],c[13],c[14],this.tmpModelPosition),b.origin=this.localOrigins.aquire(a));r.applyToModelMatrix(b.origin.vec3,c);return c};g.prototype.updateComponentBuffer=function(a){var b=a.meta;a=a.buffer;for(var c=0;c<b.length;c++){var d=b[c].material,e=b[c].index,f=k.clamp(Math.round(d.size*D.LINE_WIDTH_FRACTION_FACTOR),0,255),h=k.clamp(d.extensionLength,-D.EXTENSION_LENGTH_OFFSET,255-D.EXTENSION_LENGTH_OFFSET)+D.EXTENSION_LENGTH_OFFSET,l=
"solid"===d.type?0:1,m=255*d.opacity,d=d.color;a.textureBuffer.setData(e,0,255*d[0],255*d[1],255*d[2],255*d[3]);a.textureBuffer.setData(e,1,f,h,l,m)}};g.prototype.createComponentBuffers=function(a){for(var b=[],c=this.componentColorManager.getBuffer(a.length),d=0;d<a.length;d++){var e=a[d],f=c.aquireIndex();b.push({index:f,material:e})}a={meta:b,buffer:c};this.updateComponentBuffer(a);return a};g.prototype.extractEdges=function(a,b,c,d){return this.worker.process({data:b,originalIndices:d,writerSettings:a,
skipDeduplicate:c},this.workerThread)};g.prototype.createEdgeResources=function(a){var b={};if(0<a.regular.lodInfo.lengths.length){var c=new F(this.rctx,z.EdgeShaderAttributeLocations,{vertices:z.glVertexLayout,instances:x.RegularEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:E.createVertex(this.rctx,35044,a.regular.instancesData.buffer)});b.regular={vao:c,lod:a.regular.lodInfo}}0<a.silhouette.lodInfo.lengths.length&&(c=new F(this.rctx,z.EdgeShaderAttributeLocations,{vertices:z.glVertexLayout,
instances:x.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:E.createVertex(this.rctx,35044,a.silhouette.instancesData.buffer)}),b.silhouette={vao:c,lod:a.silhouette.lodInfo});return b};g.prototype.disposeEdgeResources=function(a){a.regular&&(a.regular.vao.vertexBuffers.instances.dispose(),a.regular.vao.dispose(!1),a.regular.vao=null);a.silhouette&&(a.silhouette.vao.vertexBuffers.instances.dispose(),a.silhouette.vao.dispose(!1),a.silhouette.vao=null)};g.prototype.addGeometryNonPreinterleaved=
function(b,c,d,e,h,k){return a(this,void 0,void 0,function(){var a,d,l,q;return f(this,function(f){switch(f.label){case 0:return a=e.getAttribute("position"),d=this.computeModelTransformWithLocalOrigin(b,h,m.mat4d.create()),l=h.origin,q={position:a,indices:e.getIndices("position"),modelTransform:d,origin:l},[4,this.addNonPreinterleaved(b,c,q,k)];case 1:return f.sent(),[2]}})})};g.prototype.addNonPreinterleaved=function(b,c,d,e){return a(this,void 0,void 0,function(){var a,b,h,k,l,m,q,g,p,t,r,u,x,
v,B;return f(this,function(f){switch(f.label){case 0:a=this.aquireRenderer(!1,e);b=d.modelTransform;h=d.origin;k=d.indices;l=d.position;m=l.data.length/l.strideIdx;q=z.EdgeInputBufferLayout.createBuffer(m);for(g=0;g<m;g++)q.position.set(g,0,l.data[l.offsetIdx+g*l.strideIdx+0]),q.position.set(g,1,l.data[l.offsetIdx+g*l.strideIdx+1]),q.position.set(g,2,l.data[l.offsetIdx+g*l.strideIdx+2]);p=this.createComponentBuffers([e]);G.fillComponenBufferIndices(p.meta,[0,q.componentIndex.count],q.componentIndex);
return[4,this.extractEdges(a.writerSettings,q,!1,k)];case 1:return t=f.sent(),r=this.createEdgeResources(t),u=r.regular,x=r.silhouette,v=(u?u.vao.size:0)+(x?x.vao.size:0),B={regular:u,silhouette:x,transform:{modelMatrix:b,origin:h},statistics:{gpuMemoryUsage:v,averageEdgeLength:t.averageEdgeLength},components:p,visible:!0,allTransparent:G.determineAllTransparent(p.meta),distanceToCamera:0,rendererKey:a.key},c.renderables.push(B),a.addRenderable(B),this.gpuMemoryUsage+=v,[2]}})})};g.prototype.addGeometryPreinterleaved=
function(b,c,e,h,k,l){return a(this,void 0,void 0,function(){var a,e,g,t,r,u,x,v,B,A,D,n,C,E,N,F,P;return f(this,function(f){switch(f.label){case 0:a=h.getAttribute("position");if(!a||!p.isFloat32Array(a.data))return console.warn("Geometry has no float32 `position` attribute, skipping it."),[2];e=l[0];g=G.determineRequiresUberRenderer(l);t=this.aquireRenderer(g,e);r=this.computeModelTransformWithLocalOrigin(b,k,m.mat4d.create());u=k.origin;x=h.getIndices("position");v=new d.BufferViewVec3f(a.data.buffer,
4*a.offsetIdx,4*a.strideIdx);B=z.EdgeInputBufferLayout.createBuffer(v.count);q.unrolledCopyVec3(B.position,v);A=this.createComponentBuffers(l);G.fillComponenBufferIndices(A.meta,h.componentOffsets,B.componentIndex,x);D=h.hasPositionData;return[4,this.extractEdges(t.writerSettings,B,D,x)];case 1:return n=f.sent(),C=this.createEdgeResources(n),E=C.regular,N=C.silhouette,F=(E?E.vao.size:0)+(N?N.vao.size:0),P={regular:E,silhouette:N,transform:{modelMatrix:r,origin:u},statistics:{gpuMemoryUsage:F,averageEdgeLength:n.averageEdgeLength},
components:A,visible:!b.isHidden(k),allTransparent:G.determineAllTransparent(A.meta),distanceToCamera:0,rendererKey:t.key},c.renderables.push(P),t.addRenderable(P),this.gpuMemoryUsage+=F,[2]}})})};g.prototype.canMergeGeometries=function(a){for(var c=null,d=null,e=0;e<a.geometries.length;e++){var f=a.geometryRecords[e];if(f.materials[0].supportsEdges){if(a.geometries[e].data instanceof t)return!1;if(!c)c=f.transformation;else if(!b.equals(c,f.transformation))return!1;if(!d&&f.origin)d=f;else if(d&&
f.origin&&d.origin.id!==f.origin.id)return!1}}return!0};g.prototype.addObjectMergedGeometries=function(b,c,d){return a(this,void 0,void 0,function(){var a,e,h,k,l,q,g,t,r,u,x,z,v,B,A,D,n,C,E,N,G;return f(this,function(f){switch(f.label){case 0:a=new Map;e=0;k=h=null;for(l=0;l<b.geometries.length;l++)if(q=b.geometries[l],g=b.geometryRecords[l],t=g.materials[0],t.supportsEdges&&(!k&&g.origin&&(k=g),r=q.data.getIndices("position"),e+=r?r.length:0,r&&null==h||h===Uint16Array))h=p.isUint16Array(r)?Uint16Array:
Uint32Array;u=e?new h(e):null;x=[];for(l=z=0;l<b.geometries.length;l++)if(q=b.geometries[l],v=b.geometryRecords[l],t=v.materials[0],t.supportsEdges){B=q.data.getAttribute("position");r=q.data.getIndices("position");A=a.get(B.data);if(null==A){A=x.length/3;for(D=B.offsetIdx;D<B.data.length;D+=B.strideIdx)x.push(B.data[D+0]),x.push(B.data[D+1]),x.push(B.data[D+2]);a.set(B.data,A)}if(r)for(n=0;n<r.length;n++)u[z++]=A+r[n]}C=k||b.geometryRecords[0];E=this.computeModelTransformWithLocalOrigin(b,C,m.mat4d.create());
N=C.origin;for(l=0;l<b.geometryRecords.length;l++)b.geometryRecords[l].origin=N;G={position:{data:x,offsetIdx:0,strideIdx:3},indices:u,modelTransform:E,origin:N};return[4,this.addNonPreinterleaved(b,c,G,d[0])];case 1:return f.sent(),[2]}})})};g.prototype.aquireRenderer=function(a,b){var c=D.EdgeRenderer.getKey(a,b.type,b.slicePlaneEnabled),d=this.renderers.get(c);this.strokesTexture||(this.strokesTexture=C.generateStrokesTexture(this.rctx));d||(d=new D.EdgeRenderer(this.rctx,this.programRepository,
{type:b.type,slicePlaneEnabled:b.slicePlaneEnabled,strokesTexture:this.strokesTexture,uber:a}),this.renderers.set(c,d));d.refCount.increment();return d};g.prototype.removeRenderable=function(a){var b=this.renderers.get(a.rendererKey);b.removeRenderable(a);b.refCount.decrement();this.disposeEdgeResources(a);this.localOrigins.release(a.transform.origin);this.gpuMemoryUsage-=a.statistics.gpuMemoryUsage;for(var b=0,c=a.components.meta;b<c.length;b++)a.components.buffer.releaseIndex(c[b].index)};g.prototype.updateObjectCameraDistances=
function(a){var b=this;a=a.viewInvTransp;m.vec3d.set3(a[3],a[7],a[11],this.tmpCameraPosition);this.perObjectData.forEach(function(a,c){var d=m.vec3d.dist(c.getCenter(),b.tmpCameraPosition);a.renderables.forEach(function(a){return a.distanceToCamera=d})})};g.prototype.renderRegularEdges=function(a,b,c){var d=this;a.bindRegularEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.regular&&!e.allTransparent){var f=G.computeEdgeCount(e.regular.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);
a.renderRegularEdges(e,b,f);d.numberOfRenderedEdges+=f}})};g.prototype.renderSilhouetteEdges=function(a,b,c){var d=this;a.bindSilhouetteEdges(b,c);a.forEachRenderable(function(e){if(e.visible&&e.silhouette&&!e.allTransparent){var f=G.computeEdgeCount(e.silhouette.lod.lengths,e.distanceToCamera,c);b.view=d.localOrigins.getViewMatrix(e.transform.origin);a.renderSilhouetteEdges(e,b,f);d.numberOfRenderedEdges+=f}})};return g}();g.EdgeView=K;var N={color:m.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,
opacity:1,slicePlaneEnabled:!1},H={color:m.vec4d.createFrom(0,0,0,.2),size:1,extensionLength:0,opacity:1,slicePlaneEnabled:!1}})},"esri/views/3d/support/buffer/bufferViewUtil":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.unrolledCopyVec4=function(c,a){var f=c.typedBuffer;c=c.typedBufferStride;var b=a.typedBuffer,l=a.typedBufferStride;a=a.count;for(var e=0;e<a;e++){var h=e*c,m=e*l;f[h]=b[m];f[h+1]=b[m+1];f[h+2]=b[m+2];f[h+3]=b[m+3]}};g.unrolledCopyVec3=
function(c,a){var f=c.typedBuffer;c=c.typedBufferStride;var b=a.typedBuffer,l=a.typedBufferStride;a=a.count;for(var e=0;e<a;e++){var h=e*c,m=e*l;f[h]=b[m];f[h+1]=b[m+1];f[h+2]=b[m+2]}};g.unrolledCopyVec2=function(c,a){var f=c.typedBuffer;c=c.typedBufferStride;var b=a.typedBuffer,l=a.typedBufferStride;a=a.count;for(var e=0;e<a;e++){var h=e*c,m=e*l;f[h]=b[m];f[h+1]=b[m+1]}};g.makeDenseSingle=function(c,a){var f=c.count;a||(a=new c.TypedArrayConstructor(f));for(var b=0;b<f;b++)a[b]=c.get(b);return a}})},
"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.applyToModelMatrix=function(c,a){var f=-c[0],b=-c[1];c=-c[2];var l=a[3],e=a[7],h=a[11],m=a[15];a[0]+=l*f;a[1]+=l*b;a[2]+=l*c;a[4]+=e*f;a[5]+=e*b;a[6]+=e*c;a[8]+=h*f;a[9]+=h*b;a[10]+=h*c;a[12]+=m*f;a[13]+=m*b;a[14]+=m*c};g.applyToViewMatrix=function(c,a){var f=c[0],b=c[1];c=c[2];a[12]+=f*a[0]+b*a[4]+c*a[8];a[13]+=f*a[1]+b*a[5]+c*a[9];a[14]+=f*a[2]+
b*a[6]+c*a[10];a[14]+=f*a[3]+b*a[7]+c*a[11]}})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["require","exports","../../lib/gl-matrix","./localOriginHelper"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function f(a){this.factory=a;this.originData=new Map}f.prototype.aquire=function(a){return this.register(this.factory.getOrigin(a))};f.prototype.register=function(a){var b=this.originData.get(a.id);if(b)return b.refCount++,b.origin;this.originData.set(a.id,
{refCount:1,viewMatrix:c.mat4d.identity(),origin:a});return a};f.prototype.release=function(a){var b=this.originData.get(a.id);b&&(b.refCount--,0===b.refCount&&this.originData.delete(a.id))};f.prototype.updateViewMatrices=function(b){this.originData.forEach(function(f){c.mat4d.set(b,f.viewMatrix);a.applyToViewMatrix(f.origin.vec3,f.viewMatrix)})};f.prototype.getViewMatrix=function(a){return this.originData.get(a.id).viewMatrix};return f}();g.LocalOriginManager=n})},"esri/views/3d/webgl-engine/lib/PreinterleavedGeometryData":function(){define(["require",
"exports","./ComponentUtils","./geometryDataUtils","../../../webgl/Util"],function(n,g,c,a,f){function b(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}return function(){function l(e,h,m,k,d,q){void 0===m&&(m=null);void 0===k&&(k=l.DefaultOffsets);void 0===d&&(d=l.DefaultIndices);void 0===q&&(q=
!1);this._freeDataAfterUse=q;this.preinterleaved=!0;this.primitiveType="triangle";this._positionData=null;q=f.getStride(h)/4;q=e.length/q;(this._hasDefaultIndices=d===l.DefaultIndices)&&(d=a.generateDefaultIndexArray(q));q={};for(var g=0;g<h.length;g++){var r=h[g],u=new (b(r.type))(e.buffer),t=f.getBytesPerElement(r.type);q[r.name]={data:u,size:r.count,offsetIdx:r.offset/t,strideIdx:r.stride/t}}m&&(this._positionData=m,q.position={data:m.data,size:3,offsetIdx:0,strideIdx:3});this._id=a.getNewId();
this._vertexData=e;this._vertexAttributes=q;this._layout=h;this._indexData=d;this._componentOffsets=c.createOffsets(k);this._gpuMemoryUsage=e.byteLength+(this._hasDefaultIndices?0:d.byteLength)}Object.defineProperty(l.prototype,"id",{get:function(){return this._id},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"layout",{get:function(){return this._layout},enumerable:!0,configurable:!0});Object.defineProperty(l.prototype,"componentOffsets",{get:function(){return this._componentOffsets},
enumerable:!0,configurable:!0});l.prototype.toRenderData=function(){var a={id:this._id.toString(),preinterleaved:!0,indexData:this._hasDefaultIndices?null:this._indexData,indexCount:this._indexData.length,vertexData:this._vertexData,layout:this._layout};this._freeDataAfterUse&&(this._indexData=this._vertexData=null,this._vertexAttributes={position:this._vertexAttributes.position});return a};l.prototype.getIndices=function(a){return"position"===a&&this._positionData?this._positionData.indices:this._indexData};
l.prototype.getAttribute=function(a){return this._vertexAttributes[a]};l.prototype.estimateGpuMemoryUsage=function(){return this._gpuMemoryUsage};Object.defineProperty(l.prototype,"hasPositionData",{get:function(){return!!this._positionData},enumerable:!0,configurable:!0});l.DefaultOffsets=new Uint32Array(0);l.DefaultIndices=new Uint32Array(0);return l}()})},"esri/views/3d/webgl-engine/lib/RegularGridLocalOriginFactory":function(){define(["require","exports"],function(n,g){return function(){function c(a){this._gridSize=
a;this._origins={}}c.prototype.getOrigin=function(a){var f=this._gridSize,b=Math.round(a[0]/f),l=Math.round(a[1]/f);a=Math.round(a[2]/f);var f=""+c.ORIGIN_PREFIX+b+"/"+l+"/"+a,e=this._origins[f];if(!e){var e=this._gridSize,h=c.OFFSET,e={id:f,vec3:[b*e+h,l*e+h,a*e+h]};this._origins[f]=e}return e};c.ORIGIN_PREFIX="rg_";c.OFFSET=1.11;return c}()})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["require","exports","./ManagedTextureBackedBuffer"],function(n,g,c){Object.defineProperty(g,
"__esModule",{value:!0});n=function(){function a(a,b){void 0===b&&(b=1);this.rctx=a;this.fieldCount=b;this.buffers=[]}a.prototype.garbageCollect=function(){this.buffers=this.buffers.filter(function(a){return 0===a.activeCount?(a.dispose(),!1):!0})};a.prototype.getBuffer=function(a){for(var b=0,f=this.buffers;b<f.length;b++){var e=f[b];if(e.availableCount>=a)return e}if(a>c.MAX_INDEX_COUNT)return null;a=new c.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(a);return a};a.prototype.updateTextures=
function(){for(var a=0,b=this.buffers;a<b.length;a++)b[a].textureBuffer.updateTexture()};return a}();g.BufferManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["require","exports","./SimpleIndexManager","./TextureBackedBuffer"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.MAX_INDEX_COUNT=65536;n=function(){function f(b,f){void 0===f&&(f=1);this.textureBuffer=new a.TextureBackedBuffer(b,f);this.indexManager=new c.SimpleIndexManager(g.MAX_INDEX_COUNT)}
f.prototype.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};Object.defineProperty(f.prototype,"availableCount",{get:function(){return this.indexManager.availableCount},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"activeCount",{get:function(){return this.indexManager.activeCount},enumerable:!0,configurable:!0});f.prototype.aquireIndex=function(){var a=this.indexManager.aquire();this.textureBuffer.resizeToFit(a);return a};f.prototype.releaseIndex=function(a){this.indexManager.release(a)};
return f}();g.ManagedTextureBackedBuffer=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a){this.maxCount=a;this._nextIndex=0;this.recycledIndices=[]}Object.defineProperty(c.prototype,"activeCount",{get:function(){return this._nextIndex-this.recycledIndices.length},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"availableCount",
{get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex},enumerable:!0,configurable:!0});c.prototype.aquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};c.prototype.release=function(a){this.recycledIndices.push(a)};return c}();g.SimpleIndexManager=n})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["require","exports","../../../support/buffer/BufferView",
"../../../../webgl/Texture"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function f(b,f){void 0===f&&(f=1);this.rctx=b;this.fieldCount=f;this.textureWidth=4096;this.dirty=!0;this.texture=new a(this.rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:this.textureWidth,height:1,flipped:!1});this.data=new c.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}f.prototype.dispose=function(){this.texture.dispose();this.data=this.texture=
void 0};f.prototype.setData=function(a,c,e,f,m,k){a=a*this.fieldCount+c;this.dirty=!0;this.data.set(a,0,e);this.data.set(a,1,f);this.data.set(a,2,m);this.data.set(a,3,k)};f.prototype.setDataElement=function(a,c,e,f){a=a*this.fieldCount+c;this.dirty=!0;this.data.set(a,e,f)};f.prototype.resizeToFit=function(a){a*=this.fieldCount;a>=this.data.count&&(a=new c.BufferViewVec4u8(new ArrayBuffer(Math.ceil((a+1)/this.textureWidth)*this.textureWidth*4)),a.typedBuffer.set(this.data.typedBuffer),this.data=a)};
f.prototype.updateTexture=function(){if(this.dirty){var a=this.texture.descriptor.width;this.data.count>a*this.texture.descriptor.height&&this.texture.resize(a,this.data.count/a);this.texture.setData(this.data.typedBuffer);this.dirty=!1}};f.prototype.bind=function(a,c){this.rctx.bindTexture(this.texture,c.unit);a.setUniform1i(c.texName,c.unit);a.setUniform2f(c.invDimName,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return f}();g.TextureBackedBuffer=n})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["require",
"exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.EdgeInputBufferLayout=a.newLayout().vec3f("position").u16("componentIndex").u16("_padding");g.VertexLayout=a.newLayout().vec2u8("sideness");g.glVertexLayout=c.glLayout(g.VertexLayout,{prefixA:!0});g.CommonInstancesLayout=a.newLayout().vec3f("position0").vec3f("position1").u16("componentIndex").vec2u8("packedAttributes").u8("variantOffset",{glNormalized:!0}).u8("variantStroke").u8("variantExtension",
{glNormalized:!0}).u8("_padding",{glPadding:!0});g.RegularEdgeInstancesLayout=g.CommonInstancesLayout.clone().vec3f("normal");g.SilhouetteEdgeInstancesLayout=g.CommonInstancesLayout.clone().vec3f("normalA").vec3f("normalB");g.EdgeShaderAttributeLocations={aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ../../../support/buffer/glUtil ./bufferLayouts".split(" "),
function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});var e=function(){function a(){}a.prototype.updateSettings=function(a){this.settings=a};a.prototype.write=function(a,b,c){var e=h;e[0]=c.position0[0];e[1]=c.position0[1];e[2]=c.position0[2];e[3]=c.position1[0];e[4]=c.position1[1];e[5]=c.position1[2];k[0]=5381;for(e=0;e<m.length;e++)k[0]=31*k[0]+m[e];d.reseed(k[0]);var e=d.randomRangeInt(0,255),f=d.randomRangeInt(0,this.settings.variants-1),l=d.randomFloat(),l=-(1-Math.min(l/.7,
1))+Math.max(0,l-.7)/(1-.7),l=255*(Math.pow(Math.abs(l),1.2)*(0>l?-1:1)*.5+.5);a.position0.setVec(b,c.position0);a.position1.setVec(b,c.position1);a.componentIndex.set(b,c.componentIndex);a.variantOffset.set(b,e);a.variantStroke.set(b,f);a.variantExtension.set(b,l)};a.prototype.trim=function(a,b){return a.slice(0,b)};return a}();g.CommonBufferWriter=e;var h=new Float32Array(6),m=new Uint32Array(h.buffer),k=new Uint32Array(1),d=new (function(){function a(a){void 0===a&&(a=1);this.seed=a}a.prototype.randomFloat=
function(){return this.step()/a.LARGE_PRIME};a.prototype.randomRangeInt=function(a,b){b-=a;return Math.round(a+this.randomFloat()*b)};a.prototype.reseed=function(a){this.seed=a};a.prototype.step=function(){return this.seed=this.seed*a.SMALL_PRIME%a.LARGE_PRIME};a.LARGE_PRIME=2147483647;a.SMALL_PRIME=16807;return a}());n=function(){function a(){this.commonWriter=new e}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=function(a){return l.RegularEdgeInstancesLayout.createBuffer(a)};
a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);c=f.vec3d.normalize(f.vec3d.add(c.faceNormal0,c.faceNormal1,q));a.normal.setVec(b,c)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=l.RegularEdgeInstancesLayout;a.glLayout=b.glLayout(l.RegularEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();g.RegularEdgeBufferWriter=n;n=function(){function a(){this.commonWriter=new e}a.prototype.updateSettings=function(a){this.commonWriter.updateSettings(a)};a.prototype.allocate=
function(a){return l.SilhouetteEdgeInstancesLayout.createBuffer(a)};a.prototype.write=function(a,b,c){this.commonWriter.write(a,b,c);a.normalA.setVec(b,c.faceNormal0);a.normalB.setVec(b,c.faceNormal1)};a.prototype.trim=function(a,b){return this.commonWriter.trim(a,b)};a.Layout=l.SilhouetteEdgeInstancesLayout;a.glLayout=b.glLayout(l.SilhouetteEdgeInstancesLayout,{prefixA:!0,divisor:1});return a}();g.SilhouetteEdgeBufferWriter=n;var q=f.vec3d.create()})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("require exports ../../../../../core/tsSupport/awaiterHelper ../../../../../core/tsSupport/generatorHelper ../../../support/meshProcessing ../../../support/buffer/typedArrayUtil ../../../support/buffer/workerHelper ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(n,g,c,a,f,b,l,e,h,m){return function(){function k(){this.regularWriter=new h.RegularEdgeBufferWriter;this.silhouetteWriter=new h.SilhouetteEdgeBufferWriter}k.prototype.process=function(b,e){return c(this,void 0,void 0,function(){var c,d,f;return a(this,function(a){switch(a.label){case 0:if(!e)return[3,2];c=[];d=this.packInput(b,c);this.wrappedWork;return[4,e.invoke("wrappedWork",d,c)];case 1:return f=a.sent(),[2,this.unpackOutput(f)];case 2:return[2,this.work(b)]}})})};k.prototype.wrappedWork=
function(b){return c(this,void 0,void 0,function(){var c,d,e,f;return a(this,function(a){c=this.unpackInput(b);d=this.work(c);e=[];this.packInputTransferables(c,e);f=this.packOutput(d,e);return[2,{result:f,transferList:e}]})})};k.prototype.work=function(a){var b=this.extractEdgeInformation(a.data,a.skipDeduplicate,a.originalIndices);this.regularWriter.updateSettings(a.writerSettings);this.silhouetteWriter.updateSettings(a.writerSettings);return m.extractEdges(b,this.regularWriter,this.silhouetteWriter)};
k.prototype.packInputTransferables=function(a,b){b.push(a.data.buffer)};k.prototype.packInput=function(a,c){this.packInputTransferables(a,c);c={dataBuffer:a.data.buffer,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate};a.originalIndices&&(c.originalIndicesBuffer=a.originalIndices.buffer,c.originalIndicesType=b.isUint32Array(a.originalIndices)?"Uint32Array":"Uint16Array");return c};k.prototype.unpackInput=function(a){return{data:e.EdgeInputBufferLayout.createView(a.dataBuffer),originalIndices:"Uint32Array"===
a.originalIndicesType?new Uint32Array(a.originalIndicesBuffer):"Uint16Array"===a.originalIndicesType?new Uint16Array(a.originalIndicesBuffer):void 0,writerSettings:a.writerSettings,skipDeduplicate:a.skipDeduplicate}};k.prototype.packOutput=function(a,b){b.push(a.regular.lodInfo.lengths.buffer);b.push(a.silhouette.lodInfo.lengths.buffer);return{regular:{instancesData:l.packInterleavedBuffer(a.regular.instancesData,b),lodInfo:{lengths:a.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:l.packInterleavedBuffer(a.silhouette.instancesData,
b),lodInfo:{lengths:a.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:a.averageEdgeLength}};k.prototype.unpackOutput=function(a){return{regular:{instancesData:l.unpackInterleavedBuffer(a.regular.instancesData),lodInfo:{lengths:new Float32Array(a.regular.lodInfo.lengths)}},silhouette:{instancesData:l.unpackInterleavedBuffer(a.silhouette.instancesData),lodInfo:{lengths:new Float32Array(a.silhouette.lodInfo.lengths)}},averageEdgeLength:a.averageEdgeLength}};k.prototype.extractEdgeInformation=function(a,
b,c){if(b&&c)return b=f.computeNeighbors(c,a.count),{faces:c,neighbors:b,vertices:a};a=f.deduplicate(a.buffer,a.stride/4);c=this.selectIndexData(a.indices,c);b=f.computeNeighbors(c,a.uniqueCount);return{faces:c,neighbors:b,vertices:e.EdgeInputBufferLayout.createView(a.buffer)}};k.prototype.selectIndexData=function(a,c){if(c){c=b.slice(c);for(var d=0;d<c.length;d++)c[d]=a[c[d]];return c}return a};return k}()})},"esri/views/3d/support/meshProcessing":function(){define(["require","exports","./mathUtils"],
function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.computeNeighbors=function(a,b){for(var c=a.length/3,e=new Uint32Array(b+1),f=new Uint32Array(b+1),m=function(a,b){a<b?e[a+1]++:f[b+1]++},k=0;k<c;k++){var d=a[3*k],g=a[3*k+1],p=a[3*k+2];m(d,g);m(g,p);m(p,d)}for(k=g=d=0;k<b;k++)p=e[k+1],m=f[k+1],e[k+1]=d,f[k+1]=g,d+=p,g+=m;for(var r=new Uint32Array(6*c),u=e[b],m=function(a,b,c){if(a<b){var d=e[a+1]++;r[2*d]=b;r[2*d+1]=c}else d=f[b+1]++,r[2*u+2*d]=a,r[2*u+2*d+1]=c},k=0;k<c;k++)d=a[3*
k],g=a[3*k+1],p=a[3*k+2],m(d,g,k),m(g,p,k),m(p,d,k);d=function(a,b){var c=2*a;a=b-a;for(b=1;b<a;b++){var d=r[c+2*b],e=r[c+2*b+1],f=b-1;for(f;0<=f&&r[c+2*f]>d;f--)r[c+2*f+2]=r[c+2*f],r[c+2*f+3]=r[c+2*f+1];r[c+2*f+2]=d;r[c+2*f+3]=e}};for(k=0;k<b;k++)d(e[k],e[k+1]),d(u+f[k],u+f[k+1]);for(var t=new Int32Array(3*c),v=function(b,c){return b===a[3*c]?0:b===a[3*c+1]?1:b===a[3*c+2]?2:-1},c=function(a,b){a=v(a,b);t[3*b+a]=-1},d=function(a,b,c,d){a=v(a,b);t[3*b+a]=d;c=v(c,d);t[3*d+c]=b},k=0;k<b;k++){for(var g=
e[k],p=e[k+1],m=f[k],A=f[k+1];g<p&&m<A;){var z=r[2*g],x=r[2*u+2*m];z===x?(d(k,r[2*g+1],x,r[2*u+2*m+1]),g++,m++):z<x?(c(k,r[2*g+1]),g++):(c(x,r[2*u+2*m+1]),m++)}for(;g<p;)c(k,r[2*g+1]),g++;for(;m<A;)x=r[2*u+2*m],c(x,r[2*u+2*m+1]),m++}return t};var a=null;g.deduplicate=function(f,b,l,e,h){void 0===l&&(l=0);void 0===e&&(e=0);void 0===h&&(h=f.byteLength/(4*b));f=new Uint32Array(f,e,h*b);e=new Uint32Array(h);var m=Math.floor(1.1*h)+1;if(null==a||a.length<2*m)a=new Uint32Array(c.nextHighestPowerOfTwo(2*
m));for(var k=0;k<2*m;k++)a[k]=0;for(var d=0,g=0!==l?Math.ceil(7.84*1.96/(l*l)*l*(1-l)):h,k=0;k<h;k++){if(k===g){var p=1-d/k;if(p+1.96*Math.sqrt(p*(1-p)/k)<l)return null;g*=2}for(var p=k*b,r,u=r=0;u<b;u++)r=f[p+u]+r|0,r=r+(r<<11)+(r>>>2)|0;r>>>=0;for(var u=r%m,t=d;0!==a[2*u+1];){if(a[2*u]===r){var v=a[2*u+1]-1,A=v*b;a:{for(var z=0;z<b;z++)if(f[p+z]!==f[A+z]){A=!1;break a}A=!0}if(A){t=e[v];break}}u++;u>=m&&(u-=m)}t===d&&(a[2*u]=r,a[2*u+1]=k+1,d++);e[k]=t}if(0!==l&&1-d/h<l)return null;l=new Uint32Array(b*
d);for(k=d=0;k<h;k++)if(e[k]===d){m=f;g=k*b;p=l;r=d*b;u=b;for(t=0;t<u;t++)p[r+t]=m[g+t];d++}return{buffer:l.buffer,indices:e,uniqueCount:d}}})},"esri/views/3d/support/buffer/workerHelper":function(){define(["require","exports","../../../../core/tsSupport/assignHelper","./BufferView","./InterleavedLayout"],function(n,g,c,a,f){function b(a){var b=[];a.fields.forEach(function(a,d){var e=a.constructor;a=c({},a,{constructor:e.ElementType+"_"+e.ElementCount});b.push([d,a])});return{stride:a.stride,fields:b,
fieldNames:a.fieldNames}}function l(a){var b=f.newLayout();b.stride=a.stride;b.fieldNames=a.fieldNames;a.fields.forEach(function(a){return b.fields.set(a[0],c({},a[1],{constructor:e.get(a[1].constructor)}))});return b}Object.defineProperty(g,"__esModule",{value:!0});g.packInterleavedBuffer=function(a,c){c.push(a.buffer);return{buffer:a.buffer,layout:b(a.layout)}};g.unpackInterleavedBuffer=function(a){return l(a.layout).createView(a.buffer)};g.packLayout=b;g.unpackLayout=l;n=[a.BufferViewFloat,a.BufferViewVec2f,
a.BufferViewVec3f,a.BufferViewVec4f,a.BufferViewMat4f,a.BufferViewFloat64,a.BufferViewVec2f64,a.BufferViewVec3f64,a.BufferViewVec4f64,a.BufferViewUint8,a.BufferViewVec2u8,a.BufferViewVec3u8,a.BufferViewVec4u8,a.BufferViewUint16,a.BufferViewVec2u16,a.BufferViewVec3u16,a.BufferViewVec4u16,a.BufferViewUint32,a.BufferViewVec2u32,a.BufferViewVec3u32,a.BufferViewVec4u32,a.BufferViewInt8,a.BufferViewVec2i8,a.BufferViewVec3i8,a.BufferViewVec4i8,a.BufferViewInt16,a.BufferViewVec2i16,a.BufferViewVec3i16,a.BufferViewVec4i16,
a.BufferViewInt32,a.BufferViewVec2i32,a.BufferViewVec3i32,a.BufferViewVec4i32];var e=new Map;n.forEach(function(a){return e.set(a.ElementType+"_"+a.ElementCount,a)})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("require exports ../../../../../core/arrayUtils ../../../lib/gl-matrix ../../../support/mathUtils ../../../support/buffer/typedArrayUtil".split(" "),function(n,g,c,a,f,b){function l(b,c){var d=Math.acos(b.cosAngle),e=m.fwd,f=m.ortho;a.vec3d.normalize(a.vec3d.direction(b.position0,
b.position1,e));b=0<a.vec3d.dot(a.vec3d.cross(b.faceNormal0,b.faceNormal1,f),e)?-1:1;return d*b>c}function e(a){var b=a.faces.length/3,c=a.faces;a=a.neighbors;for(var d=0,e=0;e<b;e++)var f=a[3*e+0],h=a[3*e+1],k=a[3*e+2],l=c[3*e+0],m=c[3*e+1],g=c[3*e+2],d=d+(-1===f||l<m?1:0),d=d+(-1===h||m<g?1:0),d=d+(-1===k||g<l?1:0);for(var d=new Int32Array(4*d),q=0,e=0;e<b;e++){f=a[3*e+0];h=a[3*e+1];k=a[3*e+2];l=c[3*e+0];m=c[3*e+1];g=c[3*e+2];if(-1===f||l<m)d[q++]=l,d[q++]=m,d[q++]=e,d[q++]=f;if(-1===h||m<g)d[q++]=
m,d[q++]=g,d[q++]=e,d[q++]=h;if(-1===k||g<l)d[q++]=g,d[q++]=l,d[q++]=e,d[q++]=k}return d}function h(b){var c=b.faces.length/3,d=b.vertices.position;b=b.faces;for(var e=k.v0,f=k.v1,h=k.v2,l=new Float32Array(3*c),m=0;m<c;m++){var g=b[3*m+1],q=b[3*m+2];d.getVec(b[3*m+0],e);d.getVec(g,f);d.getVec(q,h);a.vec3d.subtract(f,e);a.vec3d.subtract(h,e);a.vec3d.normalize(a.vec3d.cross(f,h,e));l[3*m+0]=e[0];l[3*m+1]=e[1];l[3*m+2]=e[2]}return l}Object.defineProperty(g,"__esModule",{value:!0});g.extractEdges=function(k,
g,r,u){void 0===u&&(u=d);var q=k.vertices.position,p=k.vertices.componentIndex,A=f.deg2rad(u.anglePlanar);u=f.deg2rad(u.angleSignificantEdge);var z=Math.cos(u),x=Math.cos(A),B=m.edge,D=B.position0,n=B.position1,G=B.faceNormal0,E=B.faceNormal1,F=h(k),I=e(k),K=I.length/4;k=g.allocate(K);u=0;var N=r.allocate(K),H=0,M=0,T=0,V=c.range(0,K),U=new Float32Array(K);b.forEach(U,function(b,c,d){q.getVec(I[4*c+0],D);q.getVec(I[4*c+1],n);d[c]=a.vec3d.dist(D,n)});V.sort(function(a,b){return U[b]-U[a]});for(var J=
[],O=[],P=0;P<K;P++){var R=V[P],Q=U[R],L=I[4*R+0],S=I[4*R+1],aa=I[4*R+2],R=I[4*R+3],ea=-1===R;q.getVec(L,D);q.getVec(S,n);if(ea)a.vec3d.set3(F[3*aa+0],F[3*aa+1],F[3*aa+2],G),a.vec3d.set(G,E),B.componentIndex=p.get(L),B.cosAngle=a.vec3d.dot(G,E);else if(a.vec3d.set3(F[3*aa+0],F[3*aa+1],F[3*aa+2],G),a.vec3d.set3(F[3*R+0],F[3*R+1],F[3*R+2],E),B.componentIndex=p.get(L),B.cosAngle=a.vec3d.dot(G,E),B.cosAngle>x)continue;M+=Q;T++;ea||B.cosAngle<z?(g.write(k,u++,B),J.push(Q)):l(B,A)&&(r.write(N,H++,B),O.push(Q))}p=
new Float32Array(J.reverse());A=new Float32Array(O.reverse());return{regular:{instancesData:g.trim(k,u),lodInfo:{lengths:p}},silhouette:{instancesData:r.trim(N,H),lodInfo:{lengths:A}},averageEdgeLength:M/T}};var m={edge:{position0:a.vec3d.create(),position1:a.vec3d.create(),faceNormal0:a.vec3d.create(),faceNormal1:a.vec3d.create(),componentIndex:0,cosAngle:0},ortho:a.vec3d.create(),fwd:a.vec3d.create()},k={v0:a.vec3d.create(),v1:a.vec3d.create(),v2:a.vec3d.create()},d={anglePlanar:4,angleSignificantEdge:35}})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ../../../support/mathUtils ../../materials/internal/MaterialUtil ../../shaders/EdgeRendererPrograms".split(" "),function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});g.LINE_WIDTH_FRACTION_FACTOR=8;g.EXTENSION_LENGTH_OFFSET=128;var h={type:"solid",slicePlaneEnabled:!1,uber:!0,
strokesTexture:null},m=function(){function a(){this._value=0}Object.defineProperty(a.prototype,"value",{get:function(){return this._value},enumerable:!0,configurable:!0});a.prototype.increment=function(){this._value++};a.prototype.decrement=function(){this._value--};return a}();n=function(){function a(b,e,k){this.rctx=b;this.programRepository=e;this.refCount=new m;this.renderables=new Set;this.depthBiasZ=-4E-4;this.depthBiasXY=.5;this.tmpViewToWorldNormalMatrix=f.mat3d.create();this.settings=c({},
h,k);this.key=a.getKey(this.settings.uber,this.settings.type,this.settings.slicePlaneEnabled);this.writerSettings={variants:this.settings.strokesTexture.variants};this.createPrograms()}a.prototype.dispose=function(){for(var a in this.programs){var b=this.programs[a];b&&(this.programRepository.decreaseRefCount(b),this.programs[a]=null)}};a.prototype.addRenderable=function(a){this.renderables.add(a)};a.prototype.removeRenderable=function(a){this.renderables.delete(a)};a.prototype.forEachRenderable=
function(a){this.renderables.forEach(a)};a.prototype.bindRegularEdges=function(a,b){this.bind(this.programs.regular,a,b)};a.prototype.bindSilhouetteEdges=function(a,b){this.bind(this.programs.silhouette,a,b)};a.prototype.bind=function(a,b,c){this.rctx.bindProgram(a);a.setUniformMatrix4fv("uProj",b.proj);a.setUniform2f("uDepthBias",this.depthBiasXY,this.depthBiasZ);a.setUniform2f("uPixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform2f("uNDCToPixel",b.viewport[2]/2,b.viewport[3]/2);a.setUniform1f("uDistanceFalloffFactor",
c.distanceFalloffFactor);a.setUniform2f("uViewportDimInv",1/b.viewport[2],1/b.viewport[3]);a.setUniform1f("uPixelRatio",b.pixelRatio||1)};a.prototype.renderRegularEdges=function(a,b,c){this.render(this.programs.regular,a,a.regular.vao,b,c)};a.prototype.renderSilhouetteEdges=function(a,b,c){this.render(this.programs.silhouette,a,a.silhouette.vao,b,c)};a.prototype.render=function(a,b,c,e,f){this.setUniforms(a,b,e);a=this.rctx;a.bindVAO(c);a.capabilities.instancing.drawArraysInstanced(6,0,4,f)};a.prototype.setUniforms=
function(a,b,c){b.components.buffer.textureBuffer.bind(a,g.componentDataBindParameters);a.setUniformMatrix4fv("uView",c.view);a.setUniformMatrix4fv("uModel",b.transform.modelMatrix);var d=c.viewInvTransp,e=f.mat4d.toMat3(d,this.tmpViewToWorldNormalMatrix);a.setUniform3f("uCameraPosition",d[3],d[7],d[11]);a.setUniformMatrix3fv("uViewToWorldNormalMatrix",e);(this.settings.uber||"sketch"===this.settings.type)&&this.setSketchUniforms(a);a.setUniform1f("uWorldLineRadiusPerDistance",Math.tan(c.fovY/2)/
(c.viewport[3]/2));a.setUniform3fv("uLocalOrigin",b.transform.origin.vec3);this.settings.slicePlaneEnabled&&l.bindSlicePlane(b.transform.origin.vec3,c.slicePlane,a)};a.prototype.setSketchUniforms=function(a){var c=this.settings.strokesTexture,d=c.texture;this.rctx.bindTexture(d,0);a.setUniform1i("uStrokesTexture",0);a.setUniform2f("uStrokesTextureScale",1/d.descriptor.width,1/d.descriptor.height);a.setUniform1f("uStrokesLog2Resolution",b.log2(c.resolution));a.setUniform1f("uStrokesNormalizationScale",
c.normalizationScale);a.setUniform1f("uStrokesAmplitude",c.amplitude);a.setUniform1f("uStrokeVariants",c.variants)};a.prototype.getOptions=function(a){return c({},a,{antialiasing:!!this.rctx.capabilities.blendMinMax,mode:this.settings.uber?"uber":this.settings.type,slice:this.settings.slicePlaneEnabled})};a.prototype.createPrograms=function(){var a=this.programRepository.getProgram(e.program,this.getOptions({silhouette:!1})),b=this.programRepository.getProgram(e.program,this.getOptions({silhouette:!0}));
this.programRepository.increaseRefCount(a);this.programRepository.increaseRefCount(b);this.programs={regular:a,silhouette:b}};a.getKey=function(a,b,c){return a?"edges-uber":"edges-t:"+b+":"+c};return a}();g.EdgeRenderer=n;g.componentDataBindParameters={texName:"uComponentDataTex",invDimName:"uComponentDataTexInvDim",unit:2}})},"esri/views/3d/webgl-engine/shaders/EdgeRendererPrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a){Object.defineProperty(g,
"__esModule",{value:!0});var f=function(b){return a.glslifyDefineMap({MODE:{value:b.mode,options:{solid:"MODE_SOLID",sketch:"MODE_SKETCH",uber:"MODE_UBER"}},SILHOUETTE:b.silhouette,ANTIALIASING:b.antialiasing,SLICE:b.slice})};g.program={name:"edges",shaders:function(a){return{vertexShader:f(a)+c.resolveIncludes("edgeRenderer/edgeRenderer.vert"),fragmentShader:f(a)+c.resolveIncludes("edgeRenderer/edgeRenderer.frag")}},attributes:{aPosition0:0,aPosition1:1,aComponentIndex:2,aPackedAttributes:3,aVariantOffset:4,
aVariantStroke:5,aVariantExtension:6,aNormal:7,aNormalA:7,aNormalB:8,aSideness:9}}})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("require exports ../../../../../core/tsSupport/assignHelper ../../../support/mathUtils ../Util ../../../../webgl/Texture".split(" "),function(n,g,c,a,f,b){function l(a,b){if(!a)return null;var c=a.length/2,f=e*c,c=Array(c),k=0;b=1===b;for(var l=0;l<a.length;l+=2){var m=(a[l]+a[l+1])/2;b?c[k++]=Math.min(f,1-(1-m)*h):c[k++]=Math.min(f,m*h)}return c}
Object.defineProperty(g,"__esModule",{value:!0});g.generateStrokesTexture=function(c){for(var e=g.strokesDefinition.resolution,d=e/2,h=new Uint8Array(4*e*e),m=4*e*d,d=g.strokesDefinition.amplitude,r=2*d,u=4*e,t=a.log2(e)+1,v=g.strokesDefinition.strokes.length,A=(t-1)*v*u,z=0,x=g.strokesDefinition.strokes;z<x.length;z++){for(var B=x[z],D=B.distance,B=B.pressure,n=A,G=0;G<t;G++){0!==G&&(D=l(D,0),B=l(B,1));for(var E=0;E<g.strokesDefinition.resolution;E++){var F=B?B[E%B.length]:1;f.packFloatRGBA((D?D[E%
D.length]/r:0)+.5,h,n);f.packFloatRGBA(F,h,n+m);n+=4}n-=u*(v+1)}A+=u}c=new b(c,{pixelFormat:6408,dataType:5121,hasMipmap:!1,samplingMode:9729,width:e,height:e,wrapMode:10497},h);return{resolution:e,texture:c,normalizationScale:r,amplitude:d,variants:v}};var e=.1,h=.5;g.strokesDefinition={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,
-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,
.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,
.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,
-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,
.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,
.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,
.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,
-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,
-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,
1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,
0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,
-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,
.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,
.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,
.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,
1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,
4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,
2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,
.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,
.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,
.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,
.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,
.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,
.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,
-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,
.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,
.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,
.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,
.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,
.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,
-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,
1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,
.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,
-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,
.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,
.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,
.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,
5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,
4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,
-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,
.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,
.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,
.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,
.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,
.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]}})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["require","exports","../../../../../core/arrayUtils","../../../support/buffer/typedArrayUtil"],function(n,g,c,a){function f(a,f){var b=c.binaryIndexOf(a,f,!0);return-1===b?f<a[0]?0:a.length:b}Object.defineProperty(g,"__esModule",
{value:!0});g.determineRequiresUberRenderer=function(a){if(0===a.length)return!1;for(var b=a[0].type,c=0;c<a.length;c++)if(b!==a[c].type)return!0;return!1};g.determineAllTransparent=function(a){if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b].material;if(0<c.size*c.color[3]*c.opacity)return!1}return!0};g.cloneIndices=function(b){if(Uint16Array.from)return a.isUint16Array(b)?Uint16Array.from(b):Uint32Array.from(b);for(var c=a.isUint16Array(b)?new Uint16Array(b.length):new Uint32Array(b.length),
e=0;e<b.length;e++)c[e]=b[e];return c};g.estimateLengthAtDistance=function(a,c,e,f){return f/a*e*2*Math.tan(.5*c)};g.findLowerBoundIndex=f;g.computeEdgeCount=function(a,c,e){return a.length-f(a,c*e.minimumEdgeLength)};g.fillComponenBufferIndices=function(a,c,e,f){for(var b=0;b<a.length;b++){var h=a[b].index,d=c[b],l=c[b+1];if(f)for(;d<l;d++)e.set(f[d],h);else for(;d<l;d++)e.set(d,h)}}})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define(["require","exports","../../lib/gl-matrix",
"./SphericalHarmonics"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});var f=c.vec3d.create();n=function(){function b(){this._renderLighting={main:{intensity:c.vec3d.create(),direction:c.vec3d.createFrom(1,0,0),castShadows:!1},sphericalHarmonics:{sh:{r:[0],g:[0],b:[0]}}};this._shOrder=2;this._oldDirection=c.vec3d.create();this._oldSpecular=c.vec4d.create();this._oldDiffuse=c.vec4d.create();this._oldAmbient=c.vec4d.create()}b.prototype.setUniforms=function(a,b){void 0===b&&(b=!1);
b||a.getDefine("GROUND_NORMAL_SHADING")?a.setUniform1f("lightingFixedFactor",(1-this._info.groundLightingFactor)*(1-this._info.globalFactor)):a.setUniform1f("lightingFixedFactor",0);a.setUniform1f("lightingGlobalFactor",this._info.globalFactor);a.setUniform3fv("lightingMainDirection",this._renderLighting.main.direction);a.setUniform3fv("lightingMainIntensity",this._renderLighting.main.intensity);a.setUniform1f("ambientBoostFactor",.4);b=this._renderLighting.sphericalHarmonics.sh;0===this._shOrder?
a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]):1===this._shOrder?(a.setUniform4f("lightingAmbientSH_R",b.r[0],b.r[1],b.r[2],b.r[3]),a.setUniform4f("lightingAmbientSH_G",b.g[0],b.g[1],b.g[2],b.g[3]),a.setUniform4f("lightingAmbientSH_B",b.b[0],b.b[1],b.b[2],b.b[3])):2===this._shOrder&&(a.setUniform3f("lightingAmbientSH0",b.r[0],b.g[0],b.b[0]),a.setUniform4f("lightingAmbientSH_R1",b.r[1],b.r[2],b.r[3],b.r[4]),a.setUniform4f("lightingAmbientSH_G1",b.g[1],b.g[2],b.g[3],b.g[4]),a.setUniform4f("lightingAmbientSH_B1",
b.b[1],b.b[2],b.b[3],b.b[4]),a.setUniform4f("lightingAmbientSH_R2",b.r[5],b.r[6],b.r[7],b.r[8]),a.setUniform4f("lightingAmbientSH_G2",b.g[5],b.g[6],b.g[7],b.g[8]),a.setUniform4f("lightingAmbientSH_B2",b.b[5],b.b[6],b.b[7],b.b[8]));a.setUniform3fv("lightDirection",this._oldDirection)};b.prototype.set=function(b){this._info=b;a.combineLights(b.lights,this._shOrder,this._renderLighting.main,this._renderLighting.sphericalHarmonics);c.vec3d.negate(this._renderLighting.main.direction,this._oldDirection);
b=1/Math.PI;this._oldAmbient[0]=.282095*this._renderLighting.sphericalHarmonics.sh.r[0]*b;this._oldAmbient[1]=.282095*this._renderLighting.sphericalHarmonics.sh.g[0]*b;this._oldAmbient[2]=.282095*this._renderLighting.sphericalHarmonics.sh.b[0]*b;this._oldAmbient[3]=1;this._oldDiffuse[0]=this._renderLighting.main.intensity[0]*b;this._oldDiffuse[1]=this._renderLighting.main.intensity[1]*b;this._oldDiffuse[2]=this._renderLighting.main.intensity[2]*b;this._oldDiffuse[3]=1;b=c.vec3d.set(this._oldDiffuse,
f);c.vec3d.scale(b,.4*this._info.globalFactor);c.vec3d.add(this._oldAmbient,b)};Object.defineProperty(b.prototype,"globalFactor",{get:function(){return this._info.globalFactor},enumerable:!0,configurable:!0});b.prototype.getOld=function(){return{ambient:this._oldAmbient,diffuse:this._oldDiffuse,specular:this._oldSpecular,direction:this._oldDirection,helper:this}};return b}();g.SceneLighting=n})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("require exports ../../lib/gl-matrix ../../support/mathUtils ../lib/LongVectorMath ./Lightsources".split(" "),
function(n,g,c,a,f,b){function l(a){return(a+1)*(a+1)}function e(b){return a.clamp(Math.floor(Math.sqrt(b)-1),0,2)}function h(a,b,c){var d=a[0],e=a[1];a=a[2];c=c||[];c.length=l(b);0<=b&&(c[0]=.28209479177);1<=b&&(c[1]=.4886025119*d,c[2]=.4886025119*a,c[3]=.4886025119*e);2<=b&&(c[4]=1.09254843059*d*e,c[5]=1.09254843059*e*a,c[6]=.31539156525*(3*a*a-1),c[7]=1.09254843059*d*a,c[8]=.54627421529*(d*d-e*e));return c}function m(a,b){a=l(a);b=b||{r:[],g:[],b:[]};b.r.length=b.g.length=b.b.length=a;for(var c=
0;c<a;c++)b.r[c]=b.g[c]=b.b[c]=0;return b}function k(a,b){for(var d=e(b.r.length),k=0;k<a.length;k++){var l=a[k];c.vec3d.negate(l.direction,v);h(v,d,u);f.elementwiseProduct(u,A);f.scalarProduct(u,l.intensity[0],t);f.add(b.r,t);f.scalarProduct(u,l.intensity[1],t);f.add(b.g,t);f.scalarProduct(u,l.intensity[2],t);f.add(b.b,t)}return b}function d(a,b){h(v,0,u);for(var c=0;c<a.length;c++){var d=a[c];b.r[0]+=u[0]*A[0]*d.intensity[0]*4*Math.PI;b.g[0]+=u[0]*A[0]*d.intensity[1]*4*Math.PI;b.b[0]+=u[0]*A[0]*
d.intensity[2]*4*Math.PI}return b}Object.defineProperty(g,"__esModule",{value:!0});g.numberOfCoefficients=l;g.numberOfCoefficientsInBand=function(a){return 2*a+1};g.orderFromNumberOfCoefficients=e;g.computeCoefficients=h;g.initSHCoefficients=m;g.projectFillLights=k;g.projectAmbientLights=d;g.combineLights=function(a,e,h,l){m(e,l.sh);c.vec3d.set3(0,0,0,h.intensity);var g=!1,t=q,u=p;e=r;t.length=0;u.length=0;for(var x=e.length=0;x<a.length;x++){var z=a[x];z instanceof b.MainLight&&!g?(c.vec3d.set(z.direction,
h.direction),h.intensity[0]=z.intensity[0],h.intensity[1]=z.intensity[1],h.intensity[2]=z.intensity[2],h.castShadows=z.castShadows,g=!0):z instanceof b.MainLight||z instanceof b.FillLight?t.push(z):z instanceof b.AmbientLight?u.push(z):z instanceof b.SphericalHarmonicsLight&&e.push(z)}k(t,l.sh);d(u,l.sh);for(a=0;a<e.length;a++)z=e[a],f.add(l.sh.r,z.sh.r),f.add(l.sh.g,z.sh.g),f.add(l.sh.b,z.sh.b)};var q=[],p=[],r=[],u=[0],t=[0],v=c.vec3d.create(),A=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,
.785398,.785398,.785398]})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.dotProduct=function(c,a){for(var f=0,b=0;b<c.length;b++)f+=c[b]*a[b];return f};g.elementwiseProduct=function(c,a,f){f=f||c;f.length=c.length;for(var b=0;b<c.length;b++)f[b]=c[b]*a[b];return f};g.scalarProduct=function(c,a,f){f=f||c;f.length=c.length;for(var b=0;b<c.length;b++)f[b]=c[b]*a;return f};g.add=function(c,a,f){f=
f||c;f.length=c.length;for(var b=0;b<c.length;b++)f[b]=c[b]+a[b];return f}})},"esri/views/webgl/Profiling":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.startMeasurement=function(a){return(a=a.capabilities.disjointTimerQuery)?new c(a):null};g.getTimestamp=function(a,c,b){void 0===b&&(b=50);var f=a.capabilities.disjointTimerQuery;if(!f||0>=f.timestampBits())return null;var e=f.createQuery();f.createTimestamp(e);var h=function(){var a=f.resultAvailable(e),
k=f.disjoint();a&&!k?(a=f.getResult(e),c(a/1E6)):k?c():setTimeout(h,b)};h()};g.supportsTimestamps=function(a){a=a.capabilities.disjointTimerQuery;if(!a)return!1;a=a.timestampBits();console.log({bits:a});return 0<a};var c=function(){function a(a){this.timer=a;this.query=a.createQuery();this.timer.beginTimeElapsed(this.query)}a.prototype.stop=function(a,b){void 0===b&&(b=50);this.cb=a;this.checkInterval=b;this.timer.endTimeElapsed();this.checkQueryResult()};a.prototype.checkQueryResult=function(){var a=
this.timer.resultAvailable(this.query),b=this.timer.disjoint();a&&!b?(a=this.timer.getResult(this.query),this.cb(a/1E6)):b?this.cb():setTimeout(this.checkQueryResult.bind(this),this.checkInterval)};return a}()})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["require","exports"],function(n,g){var c={origin:[0,0,0],basis1:[0,0,0],basis2:[0,0,0]};return function(){function a(){this._worldPlane=c}Object.defineProperty(a.prototype,"plane",{get:function(){return this._worldPlane},set:function(a){this._worldPlane=
a?a:c},enumerable:!0,configurable:!0});return a}()})},"esri/views/3d/webgl-engine/materials/internal/TexOnlyGLMaterial":function(){define("require exports ../../../lib/gl-matrix ../../lib/RenderSlot ./MaterialUtil ../../shaders/MiscPrograms".split(" "),function(n,g,c,a,f,b){var l=c.vec4d.createFrom(1,1,1,1);return function(){function c(a,c,e,d,f){this.program=a.getProgram(b.texOnly);this.color=e;this.depthFunc=f;this.blend=d;this.texGLName=c}c.prototype.beginSlot=function(b){return b===a.INTERNAL_MATERIAL};
c.prototype.getProgram=function(){return this.program};c.prototype.setColor=function(a){this.color=a};c.prototype.bind=function(a,b){a.bindProgram(this.program);this.program.setUniformMatrix4fv("model",f.IDENTITY);this.program.setUniformMatrix4fv("proj",b.proj);this.program.setUniform4fv("color",void 0!==this.color?this.color:l);this.program.setUniform1i("tex",0);a.bindTexture(this.texGLName,0);this.blend&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(a.gl.SRC_ALPHA,a.gl.ONE_MINUS_SRC_ALPHA,
a.gl.ONE,a.gl.ONE_MINUS_SRC_ALPHA));a.setDepthTestEnabled(!0);void 0!==this.depthFunc&&a.setDepthFunction(this.depthFunc)};c.prototype.release=function(a){void 0!==this.depthFunc&&a.setDepthFunction(513);this.blend&&a.setBlendingEnabled(!1)};c.prototype.bindView=function(a,b){f.bindView(b.origin,b.view,this.program)};c.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};c.prototype.getDrawMode=function(a){return a.gl.TRIANGLES};return c}()})},"esri/views/3d/webgl-engine/shaders/MiscPrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.blendLayers={name:"blend-layers",shaders:{vertexShader:a.resolveIncludes("misc/blendLayers.vert"),fragmentShader:a.resolveIncludes("misc/blendLayers.frag")},attributes:c.Default3D};g.simple={name:"simple",shaders:{vertexShader:a.resolveIncludes("misc/simple.vert"),fragmentShader:a.resolveIncludes("misc/simple.frag")},attributes:c.Default3D};g.texOnly={name:"tex-only",
shaders:{vertexShader:a.resolveIncludes("misc/texOnly.vert"),fragmentShader:a.resolveIncludes("misc/texOnly.frag")},attributes:c.Default3D};g.showDepth={name:"show-depth",shaders:{vertexShader:a.resolveIncludes("misc/showDepth.vert"),fragmentShader:a.resolveIncludes("misc/showDepth.frag")},attributes:c.Default3D}})},"esri/views/3d/webgl-engine/lib/GLMaterialRep":function(){define(["require","exports","./Util"],function(n,g,c){var a=function(){function a(a){this.refCnt=0;this.glMaterial=a}a.prototype.incRefCnt=
function(){++this.refCnt};a.prototype.decRefCnt=function(){--this.refCnt;c.assert(0<=this.refCnt)};a.prototype.getRefCnt=function(){return this.refCnt};a.prototype.getGLMaterial=function(){return this.glMaterial};return a}();return function(){function c(a,c){this.textureRep=a;this.programRep=c;this.id2glMaterialRef={}}c.prototype.aquire=function(a){return this.aquireExt(a,"color")};c.prototype.aquireDepthShadowMap=function(a){return this.aquireExt(a,"depthShadowMap")};c.prototype.aquireDepth=function(a){return this.aquireExt(a,
"depth")};c.prototype.aquireNormal=function(a){return this.aquireExt(a,"normal")};c.prototype.aquireHighlight=function(a){return this.aquireExt(a,"highlight")};c.prototype.aquireExt=function(b,c){var e=b.id+"_"+c,f=this.id2glMaterialRef[e];null==f?(b=(f=b.getGLMaterials()[c])?new f(b,this.programRep,this.textureRep):void 0,f=new a(b),this.id2glMaterialRef[e]=f):b=f.getGLMaterial();f.incRefCnt();b&&this.increaseProgramReferences(b);return b};c.prototype.release=function(a){this.releaseExt(a,"color")};
c.prototype.releaseDepth=function(a){this.releaseExt(a,"depth")};c.prototype.releaseNormal=function(a){this.releaseExt(a,"normal")};c.prototype.releaseDepthShadowMap=function(a){this.releaseExt(a,"depthShadowMap")};c.prototype.releaseHighlight=function(a){this.releaseExt(a,"highlight")};c.prototype.releaseExt=function(a,c){a=a+"_"+c;c=this.id2glMaterialRef[a];c.decRefCnt();if(0===c.getRefCnt()){if(c=c.getGLMaterial())this.decreaseProgramReferences(c),c.dispose();delete this.id2glMaterialRef[a]}};
c.prototype.updateMaterialParameters=function(a){var b=this.id2glMaterialRef[a+"_color"];b&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depth"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_depthShadowMap"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(b=this.id2glMaterialRef[a+"_normal"])&&b.getGLMaterial()&&this.updateParamsForMat(b.getGLMaterial());(a=this.id2glMaterialRef[a+"_highlight"])&&
a.getGLMaterial()&&this.updateParamsForMat(a.getGLMaterial())};c.prototype.updateParamsForMat=function(a){a.updateParameters&&(this.decreaseProgramReferences(a),a.updateParameters(),this.increaseProgramReferences(a))};c.prototype.increaseProgramReferences=function(a){a=a.getPrograms();for(var b=this.programRep,c=0;c<a.length;c++)b.increaseRefCount(a[c])};c.prototype.decreaseProgramReferences=function(a){a=a.getPrograms();for(var b=this.programRep,c=0;c<a.length;c++)b.decreaseRefCount(a[c])};return c}()})},
"esri/views/3d/webgl-engine/lib/GLTextureRep":function(){define(["require","exports","../../../../core/Logger","./Util","../../../webgl/Texture"],function(n,g,c,a,f){var b=c.getLogger("esri.views.3d.webgl-engine.lib.GLTextureRep"),l=function(){function b(a){this._glTexture=null;this._refCount=0;this._glTexture=a}b.prototype.incRefCnt=function(){++this._refCount};b.prototype.decRefCnt=function(){--this._refCount;a.assert(0<=this._refCount)};b.prototype.getRefCnt=function(){return this._refCount};b.prototype.setGLTexture=
function(a){this._glTexture=a};b.prototype.getGLTexture=function(){return this._glTexture};return b}();return function(){function c(a,b,c,d){this.NUM_PARALLEL=8;this.textures=a;this._programRepository=b;this.getViewportToRestore=c;this._rctx=d;this.NUM_PARALLEL=8;this.id2textureRef={};this.loading={};this._queue=[];this.listeners=[];this.maxMaxAnisotropy=(this.afExt=d.capabilities.textureFilterAnisotropic)?d.parameters.maxMaxAnisotropy:1;this.maxAnisotropy=Math.min(8,this.maxMaxAnisotropy);this._needsRender=
!0;this._fallbackTextureData=new Uint8Array(256);this._fallbackTextureTransparentData=new Uint8Array(256);for(a=0;a<this._fallbackTextureData.length;++a)this._fallbackTextureData[a]=255,this._fallbackTextureTransparentData[a]=0!==(a+1)%4?255:0;this._fallbackTextureDesc={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,width:8,height:8,maxAnisotropy:8}}c.prototype.resetNeedsRender=function(){this._needsRender=!1};c.prototype.needsRender=function(){return this._needsRender};c.prototype.aquire=
function(c,e,k){var d=this,h=this.id2textureRef[c];if(null==h){var m=this.textures[c];a.assert(void 0!==m);m.setUnloadFunc(this._unload.bind(this));e=!0===e;var g=this._createGLTextureDescription(m),h=new l(null);a.assert(null==this.id2textureRef[c]);this.id2textureRef[c]=h;if(m.initializeThroughRender)c=m.initializeThroughRender(this._rctx,g),h.setGLTexture(c),k&&k(h);else if(m.deferredLoading())this.getLoadingCount()<this.NUM_PARALLEL?this._loadImage(c,g,k):this._queue.push([c,g,k]);else try{m.initializeThroughUpload(this._rctx,
g,this._programRepository,this.getViewportToRestore(),function(a){h.setGLTexture(a);d._needsRender=!0;k&&k(h)})}catch(u){b.error("#aquire","Error loading texture: "+u.toString())}null==h.getGLTexture()&&h.setGLTexture(e?new f(this._rctx,this._fallbackTextureDesc,this._fallbackTextureTransparentData):new f(this._rctx,this._fallbackTextureDesc,this._fallbackTextureData));this._needsRender=!0}h.incRefCnt();return h};c.prototype.release=function(b){b=this.id2textureRef[b];void 0!==b&&(b.decRefCnt(),a.assert(0<=
b.getRefCnt()))};c.prototype.getLoadingCount=function(){return Object.keys(this.loading).length};c.prototype.getTexture=function(a){return this.textures[a]};c.prototype.getMaxAnisotropy=function(){return this.maxAnisotropy};c.prototype._unload=function(a){var b=this.id2textureRef[a];void 0!==b&&((b=b.getGLTexture())&&b.dispose(),delete this.id2textureRef[a]);this.next(a)};c.prototype._createGLTextureDescription=function(a){return{target:3553,pixelFormat:6408,dataType:5121,maxAnisotropy:this.afExt&&
a.params&&a.params.mipmap&&!a.params.disableAnisotropy?this.maxAnisotropy:void 0,wrapMode:a.params&&a.params.wrapClamp?33071:void 0}};c.prototype.next=function(a){if(a in this.loading){delete this.loading[a];var b=Object.keys(this.id2textureRef),c=Object.keys(this.loading);this.listeners.forEach(function(d){d(a,b,c)});this.processQueue()}};c.prototype._loadImage=function(b,c,e){var d=this;a.assert(null==this.loading[b]);this.loading[b]=!0;var f=this.textures[b];a.assert(void 0!==f);setTimeout(function(){var a=
d.id2textureRef[b];a&&a.getRefCnt()&&f.initializeThroughUpload(d._rctx,c,d._programRepository,d.getViewportToRestore(),function(c){d.next(b);d._needsRender=!0;a&&a.getRefCnt()&&(a.setGLTexture(c),e&&e(a))})},0)};c.prototype.processQueue=function(){for(var a=[],b=0;b<this._queue.length;++b){var c=this._queue[b][0],d=this.id2textureRef[c];void 0!==d&&(0===d.getRefCnt()?(d.getGLTexture().dispose(),delete this.id2textureRef[c]):a.push(this._queue[b]))}this._queue=a;a=Math.min(this.NUM_PARALLEL-Object.keys(this.loading).length,
this._queue.length);for(b=0;b<a;++b)this._loadImage(this._queue[b][0],this._queue[b][1],this._queue[b][2]);this._queue.splice(0,a)};return c}()})},"esri/views/3d/webgl-engine/lib/ProgramRepository":function(){define(["require","exports","./Util","../../../webgl/programUtils"],function(n,g,c,a){return function(){function f(a){this._programCacheByTemplate=new Map;this._globalOptions={viewingMode:"global"};this._rctx=a;this._programRefCount=[];this._commonUniforms={model:[],modelNormal:[],lightDirection:[],
proj:[],shadowMapDistance:[],viewportPixelSz:[],lightingMainDirection:[]}}Object.defineProperty(f.prototype,"globalOptions",{get:function(){return this._globalOptions},enumerable:!0,configurable:!0});f.prototype.dispose=function(){this._programCacheByTemplate.forEach(function(a){a.programs.forEach(function(a){a.dispose()})});this._programRefCount=this._programCacheByTemplate=null};f.prototype.getProgram=function(b,c){var e=this;this._programCacheByTemplate.has(b)||this.addProgramTemplate(b,function(c){return a.createProgram(e._rctx,
b,c)});return this.getProgramTemplateInstance(b,c)};f.prototype.addProgramTemplate=function(a,c){this._programCacheByTemplate.set(a,{constructor:c,programs:new Map})};f.prototype.getProgramTemplateInstance=function(a,c){if(a=this._programCacheByTemplate.get(a)){var b=c?JSON.stringify(c):"default";a.programs.has(b)||(c=a.constructor(c),a.programs.set(b,c));return a.programs.get(b)}return null};f.prototype.getProgramsUsingUniform=function(a){return this._commonUniforms[a]||[]};f.prototype.increaseRefCount=
function(a){var b=a.id;this._programRefCount[b]?this._programRefCount[b]++:(this._programRefCount[b]=1,this._findCommonUniforms(a))};f.prototype.decreaseRefCount=function(a){var b=a.id;1<this._programRefCount[b]?this._programRefCount[b]--:(this._forgetCommonUniforms(a),this._programRefCount[b]=0)};f.prototype._findCommonUniforms=function(a){for(var b in this._commonUniforms)a.hasUniform(b)&&(c.assert(-1===this._commonUniforms[b].indexOf(a),"common uniforms of program have already been determined"),
this._commonUniforms[b].push(a))};f.prototype._forgetCommonUniforms=function(a){for(var b in this._commonUniforms){var c=this._commonUniforms[b],f=c.indexOf(a);-1<f&&(c[f]=c[c.length-1],c.pop())}};return f}()})},"esri/views/3d/webgl-engine/lib/tracer":function(){define(["require","exports","./webgl-debug","../../../webgl/capabilities/isWebGL2Context"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});var f=null,b=[];g.enabled=!1;g.begin=function(){g.enabled&&(f=[])};g.trace=function(a){g.enabled&&
null!=f&&f.push(a)};g.end=function(){if(g.enabled){var a=f;f=null;a&&(b.forEach(function(b){return b(a)}),b.length=0);return a}};g.instrumentContext=function(b){return g.enabled?a.default(b)?(console.warn("WebGL tracer is not supported on a WebGL2 Context"),b):c.makeDebugContext(b,void 0,function(a,b){g.enabled&&f&&f.push("gl."+a+"("+c.glFunctionArgsToString(a,b)+")")}):b};g.request=function(a){b.push(a)}})},"esri/views/3d/webgl-engine/lib/webgl-debug":function(){define([],function(){function n(a){if(null==
h){h={};m={};for(var b in a)"number"==typeof a[b]&&(h[a[b]]=b,m[b]=a[b])}}function g(){if(null==h)throw"WebGLDebugUtils.init(ctx) not called";}function c(a){g();var b=h[a];return void 0!==b?"gl."+b:"/*UNKNOWN WebGL ENUM*/ 0x"+a.toString(16)+""}function a(a,b,f,h){a=e[a];if(void 0!==a&&(a=a[b],void 0!==a&&a[f])){if("object"===typeof a[f]&&void 0!==a[f].enumBitwiseOr){b=a[f].enumBitwiseOr;f=0;a=[];for(var d=0;d<b.length;++d){var k=m[b[d]];0!==(h&k)&&(f|=k,a.push(c(k)))}return f===h?a.join(" | "):c(h)}return c(h)}return null===
h?"null":void 0===h?"undefined":h.toString()}function f(a,b,c){a.__defineGetter__(c,function(){return b[c]});a.__defineSetter__(c,function(a){b[c]=a})}function b(e,d,h,l){function k(a,b){return function(){h&&h(b,arguments);var c=a[b].apply(a,arguments),e=l.getError();0!=e&&(m[e]=!0,d(e,b,arguments));return c}}l=l||e;n(e);d=d||function(b,d,e){for(var f="",h=e.length,k=0;k<h;++k)f+=(0==k?"":", ")+a(d,h,k,e[k]);b="WebGL error "+c(b)+" in "+d+"("+f+")";window.console&&window.console.error?window.console.error(b):
window.console&&window.console.log&&window.console.log(b)};var m={},g={},q;for(q in e)if("function"==typeof e[q])if("getExtension"!=q)g[q]=k(e,q);else{var p=k(e,q);g[q]=function(){var a=p.apply(e,arguments);return b(a,d,h,l)}}else f(g,e,q);g.getError=function(){for(var a in m)if(m.hasOwnProperty(a)&&m[a])return m[a]=!1,a;return e.NO_ERROR};return g}function l(a){var b=a.getParameter(a.MAX_VERTEX_ATTRIBS),c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c);for(var e=0;e<b;++e)a.disableVertexAttribArray(e),
a.vertexAttribPointer(e,4,a.FLOAT,!1,0,0),a.vertexAttrib1f(e,0);a.deleteBuffer(c);b=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS);for(e=0;e<b;++e)a.activeTexture(a.TEXTURE0+e),a.bindTexture(a.TEXTURE_CUBE_MAP,null),a.bindTexture(a.TEXTURE_2D,null);a.activeTexture(a.TEXTURE0);a.useProgram(null);a.bindBuffer(a.ARRAY_BUFFER,null);a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,null);a.bindFramebuffer(a.FRAMEBUFFER,null);a.bindRenderbuffer(a.RENDERBUFFER,null);a.disable(a.BLEND);a.disable(a.CULL_FACE);a.disable(a.DEPTH_TEST);
a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.blendColor(0,0,0,0);a.blendEquation(a.FUNC_ADD);a.blendFunc(a.ONE,a.ZERO);a.clearColor(0,0,0,0);a.clearDepth(1);a.clearStencil(-1);a.colorMask(!0,!0,!0,!0);a.cullFace(a.BACK);a.depthFunc(a.LESS);a.depthMask(!0);a.depthRange(0,1);a.frontFace(a.CCW);a.hint(a.GENERATE_MIPMAP_HINT,a.DONT_CARE);a.lineWidth(1);a.pixelStorei(a.PACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_ALIGNMENT,4);a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,!1);a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,
!1);a.UNPACK_COLORSPACE_CONVERSION_WEBGL&&a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,a.BROWSER_DEFAULT_WEBGL);a.polygonOffset(0,0);a.sampleCoverage(1,!1);a.scissor(0,0,a.canvas.width,a.canvas.height);a.stencilFunc(a.ALWAYS,0,4294967295);a.stencilMask(4294967295);a.stencilOp(a.KEEP,a.KEEP,a.KEEP);a.viewport(0,0,a.canvas.width,a.canvas.height);for(a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT|a.STENCIL_BUFFER_BIT);a.getError(););}var e={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},
drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,
2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,
1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},
frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},h=null,m=null;return{init:n,mightBeEnum:function(a){g();return void 0!==h[a]},glEnumToString:c,glFunctionArgToString:a,glFunctionArgsToString:function(b,c){for(var d="",e=c.length,f=0;f<e;++f)d+=(0==f?"":", ")+a(b,e,f,c[f]);return d},makeDebugContext:b,makeLostContextSimulatingCanvas:function(a){function b(a){return"function"==typeof a?a:function(b){a.handleEvent(b)}}function c(){for(var a=
Object.keys(K),b=0;b<a.length;++b)delete K[a]}function e(){++E;D||G==E&&a.loseContext()}function h(a,b){var c=a[b];return function(){e();if(!D)return c.apply(a,arguments)}}function k(a){return{statusMessage:a,preventDefault:function(){F=!0}}}function m(a){for(var b in a)"function"==typeof a[b]?A[b]=h(a,b):f(A,a,b);A.getError=function(){e();if(!D)for(var a;a=g.getError();)K[a]=!0;for(a in K)if(K[a])return delete K[a],a;return A.NO_ERROR};var c="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");
for(b=0;b<c.length;++b){var d=c[b];A[d]=function(b){return function(){e();if(D)return null;var c=b.apply(a,arguments);c.__webglDebugContextLostId__=B;n.push(c);return c}}(a[d])}c="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(b=0;b<c.length;++b)d=c[b],A[d]=function(b){return function(){e();return D?null:b.apply(a,arguments)}}(A[d]);c="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(b=0;b<c.length;++b)d=c[b],A[d]=function(b){return function(){e();return D?!1:b.apply(a,arguments)}}(A[d]);A.checkFramebufferStatus=function(b){return function(){e();return D?A.FRAMEBUFFER_UNSUPPORTED:b.apply(a,arguments)}}(A.checkFramebufferStatus);A.getAttribLocation=function(b){return function(){e();
return D?-1:b.apply(a,arguments)}}(A.getAttribLocation);A.getVertexAttribOffset=function(b){return function(){e();return D?0:b.apply(a,arguments)}}(A.getVertexAttribOffset);A.isContextLost=function(){return D};return A}var g,A,z=[],x=[];A={};var B=1,D=!1,n=[],G=0,E=0,F=!1,I=0,K={};a.getContext=function(b){return function(){var c=b.apply(a,arguments);if(c instanceof WebGLRenderingContext){if(c!=g){if(g)throw"got different context";g=c;A=m(g)}return A}return c}}(a.getContext);(function(a){var c=a.addEventListener;
a.addEventListener=function(d,e,f){switch(d){case "webglcontextlost":z.push(b(e));break;case "webglcontextrestored":x.push(b(e));break;default:c.apply(a,arguments)}}})(a);a.loseContext=function(){if(!D){D=!0;G=0;for(++B;g.getError(););c();K[g.CONTEXT_LOST_WEBGL]=!0;var b=k("context lost"),d=z.slice();setTimeout(function(){for(var c=0;c<d.length;++c)d[c](b);0<=I&&setTimeout(function(){a.restoreContext()},I)},0)}};a.restoreContext=function(){D&&x.length&&setTimeout(function(){if(!F)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var a=0;a<n.length;++a){var b=n[a];b instanceof WebGLBuffer?g.deleteBuffer(b):b instanceof WebGLFramebuffer?g.deleteFramebuffer(b):b instanceof WebGLProgram?g.deleteProgram(b):b instanceof WebGLRenderbuffer?g.deleteRenderbuffer(b):b instanceof WebGLShader?g.deleteShader(b):b instanceof WebGLTexture&&g.deleteTexture(b)}l(g);D=!1;E=0;F=!1;for(var a=x.slice(),b=k("context restored"),c=0;c<a.length;++c)a[c](b)},0)};a.loseContextInNCalls=function(a){if(D)throw"You can not ask a lost contet to be lost";
G=E+a};a.getNumCalls=function(){return E};a.setRestoreTimeout=function(a){I=a};return a},resetToInitialState:l}})},"esri/views/webgl/capabilities/isWebGL2Context":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.default=function(c){return window.WebGL2RenderingContext&&c instanceof window.WebGL2RenderingContext}})},"esri/views/3d/webgl-engine/parts/Viewport":function(){define("require exports ../../../../core/has ../../lib/gl-matrix ../lib/Camera ../lib/PerformanceTimer ./Visualizer".split(" "),
function(n,g,c,a,f,b,l){var e={fbo:null,lightDirection:null,camera:null,pixelRatio:1};return function(){function b(b,c,d,e,h){this._content=new Map;this._stats={renderGeometriesTotal:0,renderGeometriesVisible:0,visualizerRenderTimer:null,viewportRenderTimer:null};this._needsRender=!0;this._rctx=h;this._gl=h.gl;this._visualizer=new l(b,c,d,e,this._rctx);this._camera=new f(a.vec3.createFrom(0,100,-100),a.vec3.createFrom(0,0,0))}Object.defineProperty(b.prototype,"isLoadingResources",{get:function(){return this._visualizer.isLoadingResources},
enumerable:!0,configurable:!0});b.prototype.getCombinedStats=function(){var a={},b=this._visualizer.getCombinedStats(),c;for(c in b)a[c]=b[c];a.renderGeometriesTotal=this._stats.renderGeometriesTotal;a.renderGeometriesVisible=this._stats.renderGeometriesVisible;void 0!==this._gl.getUsedTextureMemory&&(a.textureMemory=this._gl.getUsedTextureMemory());void 0!==this._gl.getUsedRenderbufferMemory&&(a.renderbufferMemory=this._gl.getUsedRenderbufferMemory());void 0!==this._gl.getUsedVBOMemory&&(a.VBOMemory=
this._gl.getUsedVBOMemory());if(void 0!==this._gl.getUsedTextureMemoryStats){var b=this._gl.getUsedTextureMemoryStats(),e;for(e in b)a["texMem type: "+e]=b[e]}return a};b.prototype.dispose=function(){this._visualizer.dispose();this._visualizer=null};b.prototype.setLighting=function(a){this._visualizer.setLighting(a)};b.prototype.setRenderParams=function(a){this._visualizer.setRenderParams(a)};b.prototype.getRenderParams=function(){return this._visualizer.getRenderParams()};b.prototype.getEdgeView=
function(){return this._visualizer.getEdgeView()};b.prototype.modify=function(a,b,c,e){this._visualizer.modify(a,b,c,e);this._content=this._visualizer.getContent()};b.prototype.getContent=function(){return this._content};b.prototype.setCamera=function(a){this._camera.copyFrom(a);this._needsRender=!0};b.prototype.getCamera=function(){return this._camera};Object.defineProperty(b.prototype,"renderPlugins",{get:function(){return this._visualizer.renderPlugins},enumerable:!0,configurable:!0});b.prototype.getFramebufferTexture=
function(a){return this._visualizer.getFramebufferTexture(a)};b.prototype.render=function(a){e.camera=a.camera||this._camera;e.fbo=a.fbo;e.lightDirection=a.lightDirection;e.pixelRatio=a.pixelRatio||1;this._visualizer.render(e)};b.prototype.resetNeedsRender=function(){this._needsRender=!1;this._visualizer.resetNeedsRender()};b.prototype.needsRender=function(){return this._needsRender||this._visualizer.needsRender()};return b}()})},"esri/views/3d/webgl-engine/parts/Visualizer":function(){define("require exports ../../../../core/TimeProfiler ../../lib/gl-matrix ../../support/debugFlags ../lib/depthRange ../lib/depthRangeUtils ../lib/HighlightHelper ../lib/OffscreenRenderingHelper ../lib/Renderer ../lib/RenderOccludedHelper ../lib/RenderPass ../lib/ShadowMap ../lib/SliceHelper ../lib/SSAOHelper ../lib/Util".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){var t=u.assert;return function(){function g(a,b,c,d,f){this._drawSSAOMapDebugQuad=this._drawShadowMapDebugQuad=!1;this._needsRender=!0;this._content=new Map;this._stage=a;this._rctx=f;this._renderer=new m(b,c,d,this._rctx,!1);this._programRep=b;this._helpers={shadowMap:new q(b,this._rctx),ssao:new r(b,this._rctx,this.setNeedsRender.bind(this)),highlight:new e(b,this._rctx),renderOccluded:new k(b,this._rctx),slice:new p,offscreenRendering:new h(b,this._rctx)}}
Object.defineProperty(g.prototype,"isLoadingResources",{get:function(){return this._renderer.isLoadingResources},enumerable:!0,configurable:!0});g.prototype.getCombinedStats=function(){return this._renderer.getCombinedStats()};g.prototype.dispose=function(){this._renderer.dispose();this._helpers.shadowMap.enabled=!1;this._helpers.shadowMap.dispose();this._helpers.ssao.enabled=!1;this._helpers.ssao.dispose();this._helpers.highlight.enabled=!1;this._helpers.renderOccluded.enabled=!1;this._helpers.offscreenRendering.enabled=
!1};g.prototype.setLighting=function(a){this._renderer.setLighting(a)};g.prototype.setRenderParams=function(a){void 0!==a.shadowMapResolution&&!1===this._helpers.shadowMap.enabled&&(this._helpers.shadowMap.textureResolution=a.shadowMapResolution);void 0!==a.shadowMap&&(this._helpers.shadowMap.enabled=a.shadowMap);void 0!==a.shadowMapMaxCascades&&(this._helpers.shadowMap.maxCascades=a.shadowMapMaxCascades);this._helpers.highlight.enabled=!0;void 0!==a.ssao&&(this._helpers.ssao.enabled=a.ssao);void 0!==
a.ssaoAttenuation&&(this._helpers.ssao.attenuation=a.ssaoAttenuation);void 0!==a.ssaoRadius&&(this._helpers.ssao.radius=a.ssaoRadius);void 0!==a.ssaoFilterRadius&&console.error("The property ssaoFilterRadius is no longer supported as a render parameter.");void 0!==a.ssaoSamples&&(this._helpers.ssao.samples=a.ssaoSamples);void 0!==a.drawShadowMapDebugQuad&&(this._drawShadowMapDebugQuad=a.drawShadowMapDebugQuad);void 0!==a.drawSSAODebugQuad&&(this._drawSSAOMapDebugQuad=a.drawSSAODebugQuad);this._renderer.ssaoEnabled=
this._helpers.ssao.enabled;void 0!==a.offscreenRendering&&(this._helpers.offscreenRendering.enabled=a.offscreenRendering);a.background&&(this._helpers.offscreenRendering.background=a.background);void 0!==a.antialiasingEnabled&&(this._renderer.renderOptions.antialiasing=a.antialiasingEnabled?"smaa":"none");void 0!==a.earlyOcclusionPixelDraw&&(this._renderer.renderOptions.earlyOcclusionPixelDraw=a.earlyOcclusionPixelDraw);void 0!==a.defaultHighlightOptions&&this._helpers.highlight.setDefaultOptions(a.defaultHighlightOptions);
void 0!==a.slicePlane&&(this._helpers.slice.plane=a.slicePlane);this._needsRender=!0};g.prototype.getRenderParams=function(){var a={};a.shadowMap=this._helpers.shadowMap.enabled;a.shadowMapResolution=this._helpers.shadowMap.textureResolution;a.shadowMapMaxCascades=this._helpers.shadowMap.maxCascades;this._helpers.ssao.isSupported&&(a.ssao=this._helpers.ssao.enabled,a.ssaoAttenuation=this._helpers.ssao.attenuation,a.ssaoRadius=this._helpers.ssao.radius,a.ssaoFilterRadius=this._helpers.ssao.filterRadius,
a.ssaoSamples=this._helpers.ssao.samples);return a};g.prototype.getFramebufferTexture=function(a){switch(a){case "color":return this._helpers.offscreenRendering.colorTexture;case "hudVisibility":return this._helpers.offscreenRendering.hudVisibilityTexture;case "shadowMap":return this._helpers.shadowMap.getDepthTexture()}return this._renderer.getFramebufferTexture(a)};g.prototype.modify=function(a,b,c,d){this._renderer.modify(a,b,c,d);for(d=0;d<b.length;++d)this._content.delete(b[d].uniqueName);for(d=
0;d<a.length;++d)this._content.set(a[d].uniqueName,a[d]);for(d=0;d<c.length;++d)t(this._content.get(c[d].renderGeometry.uniqueName)===c[d].renderGeometry)};g.prototype.getContent=function(){return this._content};g.prototype.getProjectionMatrix=function(b,c,d,e,f){c=u.fovx2fovy(c,b[2],b[3]);a.mat4d.perspective(180*c/Math.PI,b[2]/b[3],d,e,f)};Object.defineProperty(g.prototype,"renderPlugins",{get:function(){return this._renderer.renderPlugins},enumerable:!0,configurable:!0});g.prototype.resetNeedsRender=
function(){this._needsRender=!1;this._renderer.resetNeedsRender()};g.prototype.needsRender=function(){return this._needsRender||this._renderer.needsRender()};g.prototype.setNeedsRender=function(){this._needsRender=!0};g.prototype.render=function(b){var e=b.camera,h=b.fbo,k=b.lightDirection,l=e.viewport;this._renderer.prepareRender(e);if(this._helpers.shadowMap.enabled){f.ENABLE_PROFILE_DEPTH_RANGE&&c.begin("depthRange");var m=this.computeDepthRange(e);f.ENABLE_PROFILE_DEPTH_RANGE&&c.end("depthRange");
this._helpers.shadowMap.prepare(e,k,this._content,m);k=this._helpers.shadowMap.getCascades();for(m=0;m<k.length;++m){var g=k[m];g.camera.setGLViewport(this._rctx);b.camera=g.camera;this._renderer.renderGeometryPass(d.MATERIAL_DEPTH_SHADOWMAP,b,null,null,this._helpers.slice)}b.camera=e;this._helpers.shadowMap.finish(h);e.setGLViewport(this._rctx)}this._helpers.shadowMap.bindAll(this._programRep);this._renderer.renderAuxiliaryBuffers(b,this._helpers);this._renderer.render(b,this._helpers);this._drawShadowMapDebugQuad&&
this._helpers.shadowMap.enabled&&(b=a.mat4d.ortho(l[0],l[2],l[1],l[3],-1,1),this._helpers.shadowMap.drawDebugQuad(b));this._drawSSAOMapDebugQuad&&this._helpers.ssao.enabled&&(b=a.mat4d.ortho(l[0],l[2],l[1],l[3],-1,1),this._helpers.ssao.drawQuad(b))};g.prototype.getEdgeView=function(){return this._renderer.edgeView};g.prototype.computeDepthRange=function(a){var c=l.depthRangeFromScene(a,this._content,this._stage.getLayers());b.union(c,this.renderPlugins.queryDepthRange(a));c.near=Math.max(a.near,c.near);
c.far=Math.min(a.far,c.far);return c};return g}()})},"esri/core/TimeProfiler":function(){define(["require","exports"],function(n,g){n=function(){function c(a,c){void 0===c&&(c=.9);this._alpha=.9;this._name=a;this._alpha=c;this.reset()}c.prototype.reset=function(){this._smooth=this._sum=this._count=0;this._min=Infinity;this._max=0};Object.defineProperty(c.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"count",{get:function(){return this._count},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"average",{get:function(){return 0<this._count?this._sum/this._count:0},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"smooth",{get:function(){return this._smooth},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"min",{get:function(){return this._min},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"max",{get:function(){return this._max},enumerable:!0,configurable:!0});c.prototype.begin=
function(){this._startTime=performance.now()};c.prototype.end=function(){var a=performance.now()-this._startTime;this._count+=1;this._sum+=a;this._smooth=this._alpha*a+(1-this._alpha)*this._smooth;this._min=Math.min(this._min,a);this._max=Math.max(this._max,a)};c.prototype.toJSON=function(){return{name:this.name,count:this.count,average:this.average,smooth:this.smooth,min:this.min,max:this.max}};return c}();(function(c){function a(a){a in b||(b[a]=new c(a));return b[a]}function f(b){console.log(a(b).toJSON())}
var b={},l={};c.get=a;c.begin=function(b){a(b).begin()};c.end=function(b,c){void 0===c&&(c=!0);a(b).end();var e=performance.now();!c||b in l&&!(e>=l[b]+1E3)||(f(b),l[b]=e)};c.log=f;c.logAll=function(){for(var a in b)f(a)}})(n||(n={}));return n})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("require exports ../../../../core/PooledArray ../../lib/gl-matrix ../../support/intersectionUtils ./ComponentUtils ./depthRange ./Util".split(" "),function(n,g,c,a,f,b,l,e){function h(a,b){var c=
l.empty(),d=b.getObjects();b.getSpatialQueryAccelerator()?m(c,a,b.getSpatialQueryAccelerator()):k(c,a,d);return c}function m(a,b,c){var e=b.eye,f=b.viewForward,h=b.frustumPlanes,k=function(a){return!a.areAllComponentsHidden()},m=c.objectCount;500>m?(l.set(A,b.near,Math.min(a.near,b.far)),c.forEachInDepthRange(e,f,"front-to-back",A,function(c,e){d(a,b,c);A.far=a.near;e.setRange(A)},h,k),l.set(A,Math.max(a.far,b.near),b.far),c.forEachInDepthRange(e,f,"back-to-front",A,function(c,e){d(a,b,c);A.near=
a.far;e.setRange(A)},h,k)):(m=Math.max(Math.min(m,500),Math.ceil(.1*m)),e=c.findClosest(f,"front-to-back",h,k,m),c=c.findClosest(f,"back-to-front",h,k,m),e&&c&&(p(a,b,e.getCenter(),e.getBSRadius()),p(a,b,c.getCenter(),c.getBSRadius())))}function k(a,b,c){z.clear();c.forEach(function(a){a.areAllComponentsHidden()||z.add(a)});z.empty||(z.sort(b),l.set(A,b.near,Math.min(a.near,b.far)),z.forEachInDepthRange(A,"front-to-back",function(c,e,f){e<a.near&&d(a,b,c)}),l.set(A,Math.max(a.far,b.near),b.far),z.forEachInDepthRange(A,
"back-to-front",function(b,c,d){a.far=Math.max(a.far,d)}))}function d(b,c,d){if(!d.areAllComponentsHidden()&&f.frustumSphere(c.frustumPlanes,d.getCenter(),d.getBSRadius())){var e=d.objectTransformation,h=v;d.geometryRecords.forEach(function(d){a.mat4d.multiply(e,d.getShaderTransformation(),h);var f=a.mat4d.maxScale(h);q(b,c,d.geometry.boundingInfo,h,f)})}}function q(b,c,d,e,h){var k=c.eye,l=c.viewForward;a.mat4d.multiplyVec3(e,d.center,t);k=l[0]*(t[0]-k[0])+l[1]*(t[1]-k[1])+l[2]*(t[2]-k[2]);l=d.bsRadius*
h;if(!(k-l>b.near&&k+l<b.far)&&f.frustumSphere(c.frustumPlanes,t,l))if(100<d.bsRadius&&d.getChildren())for(d=d.getChildren(),k=0;8>k;++k)d[k]&&q(b,c,d[k],e,h);else B.unionDepthRangeWithAABB(b,c.viewProjectionMatrix,e,d.bbMin,d.bbMax)}function p(a,b,c,d){var e=b.eye;b=b.viewForward;c=(c[0]-e[0])*b[0]+(c[1]-e[1])*b[1]+(c[2]-e[2])*b[2];a.near=Math.min(a.near,c-d);a.far=Math.max(a.far,c+d)}Object.defineProperty(g,"__esModule",{value:!0});g.depthRangeFromScene=function(a,b,c){if(1E4>b.size)return x.compute(a,
b);b=l.empty();for(var d in c)l.union(b,h(a,c[d]));return b};g.depthRangeFromLayer=h;n=function(){function a(){this._items=new c({allocator:function(){return{obj:null,distance:0,near:0,far:0}}})}Object.defineProperty(a.prototype,"length",{get:function(){return this._items.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"empty",{get:function(){return 0===this._items.length},enumerable:!0,configurable:!0});a.prototype.clear=function(){this._items.clear()};a.prototype.add=function(a){this._items.pushNew().obj=
a};a.prototype.sort=function(a){var b=a.eye,c=a.viewForward;this._items.forEach(function(a){var d=a.obj,e=d.getCenter(),d=d.getBSRadius(),e=(e[0]-b[0])*c[0]+(e[1]-b[1])*c[1]+(e[2]-b[2])*c[2];a.distance=e;a.near=e-d;a.far=e+d});this._items.sort(function(a,b){return a.distance-b.distance})};a.prototype.forEachInDepthRange=function(a,b,c){if("front-to-back"===b)for(b=0;b<this._items.length;++b){var d=this._items.data[b];d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)}else for(b=this._items.length-
1;0<=b;--b)d=this._items.data[b],d.far<a.near||d.near>a.far||c(d.obj,d.near,d.far)};return a}();var r=function(){function c(){this.view=a.mat4d.create();this.viewProj=a.mat4d.create();this.planes=[a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create()];this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}c.prototype.compute=function(c,d){var e=this;this.reset();
a.mat4d.set(c.viewMatrix,this.view);a.mat4d.multiply(c.projectionMatrix,this.view,this.viewProj);c.copyFrustumPlanes(this.planes);c=this.view;var f=c[2],h=c[6],k=c[10],l=c[14];c=this.range;var m=0;d.forEach(function(a){if(!b.isAllHidden(a.instanceParameters.componentVisibilities,a.componentOffsets)&&a.castShadow){var c,d;a.hasShaderTransformation?(c=a.getBoundingSphere(a.getShaderTransformation(),1,t),d=t):(c=a.bsRadius,d=a.center);d=f*d[0]+h*d[1]+k*d[2]+l;e.geometries[m]=a;e.near[m]=-(d+c);e.far[m]=
-(d-c);++m}});if(0===this.geometries.length)return c;for(d=0;d<this.geometries.length;++d)this.near[d]>c.far&&(c.far=this.near[d]),2<this.near[d]&&this.far[d]<c.near&&(c.near=this.far[d]);var g=this.looseRange;g.near=Math.max(.5*c.near,2);g.far=2*c.far;var q=0,p=0;for(d=0;d<this.geometries.length;++d)this.near[d]<c.near&&(this.near[d]>=g.near?c.near=this.near[d]:this.nearCandidates[q++]=d),this.far[d]>c.far&&(this.far[d]<=g.far?c.far=this.far[d]:this.farCandidates[p++]=d);if(0===this.nearCandidates.length&&
0===this.farCandidates.length)return c;this.nearCandidates.sort(function(a,b){return e.near[a]<e.near[b]?-1:e.near[a]>e.near[b]?1:0});this.farCandidates.sort(function(a,b){return e.far[a]<e.far[b]?1:e.far[a]>e.far[b]?-1:0});for(d=0;d<this.nearCandidates.length;++d)g=this.nearCandidates[d],this.near[g]<c.near&&(g=this.geometries[g],q=g.boundingInfo,this.includeNearBoundingInfoRec(q,g.getShaderTransformation()));for(d=0;d<this.farCandidates.length;++d)g=this.farCandidates[d],this.far[g]>c.far&&(g=this.geometries[g],
q=g.boundingInfo,this.includeFarBoundingInfoRec(q,g.getShaderTransformation()));return c};c.prototype.reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};c.prototype.includeNearBoundingInfoRec=function(b,c){var d=b.getBSRadius(),e=b.getCenter();a.mat4d.multiplyVec3(c,e,t);var e=a.mat4d.maxScale(c),f=t[0],h=t[1],k=t[2],d=d*e;if(!(this.planes[0][0]*f+
this.planes[0][1]*h+this.planes[0][2]*k+this.planes[0][3]>d||this.planes[1][0]*f+this.planes[1][1]*h+this.planes[1][2]*k+this.planes[1][3]>d||this.planes[2][0]*f+this.planes[2][1]*h+this.planes[2][2]*k+this.planes[2][3]>d||this.planes[3][0]*f+this.planes[3][1]*h+this.planes[3][2]*k+this.planes[3][3]>d||(e=this.view[2]*f+this.view[6]*h+this.view[10]*k+this.view[14],f=e+d,2>-(e-d)||-f>=this.range.near)))if(-f>this.looseRange.near)this.range.near=-f;else{if(100<d&&(d=b.getChildren(),void 0!==d)){for(b=
0;8>b;++b)void 0!==d[b]&&this.includeNearBoundingInfoRec(d[b],c);return}B.unionDepthRangeWithAABB(this.range,this.viewProj,c,b.getBBMin(),b.getBBMax())}};c.prototype.includeFarBoundingInfoRec=function(b,c){var d=b.getBSRadius(),e=b.getCenter();a.mat4d.multiplyVec3(c,e,t);var e=a.mat4d.maxScale(c),f=t[0],h=t[1],k=t[2],d=d*e;if(!(this.planes[0][0]*f+this.planes[0][1]*h+this.planes[0][2]*k+this.planes[0][3]>d||this.planes[1][0]*f+this.planes[1][1]*h+this.planes[1][2]*k+this.planes[1][3]>d||this.planes[2][0]*
f+this.planes[2][1]*h+this.planes[2][2]*k+this.planes[2][3]>d||this.planes[3][0]*f+this.planes[3][1]*h+this.planes[3][2]*k+this.planes[3][3]>d||(e=this.view[2]*f+this.view[6]*h+this.view[10]*k+this.view[14]-d,-e<=this.range.far)))if(-e<this.looseRange.far)this.range.far=-e;else{if(100<d&&(d=b.getChildren(),void 0!==d)){for(b=0;8>b;++b)void 0!==d[b]&&this.includeFarBoundingInfoRec(d[b],c);return}B.unionDepthRangeWithAABB(this.range,this.viewProj,c,b.getBBMin(),b.getBBMax())}};return c}();g.DepthRangeFromRenderGeometries=
r;g=function(){function b(){this.modelViewProj=a.mat4d.create();this.clipPosition=[a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create(),a.vec4d.create()]}b.prototype.unionDepthRangeWithAABB=function(b,c,d,e,f){var h=this.modelViewProj;a.mat4d.multiply(c,d,h);c=!1;for(d=0;8>d;++d){var k=this.clipPosition[d],l=0===d||3===d||4===d||7===d?e[0]:f[0],m=0===d||1===d||4===d||5===d?e[1]:f[1],g=4>d?e[2]:f[2];k[0]=h[0]*l+h[4]*m+h[8]*g+h[12];k[1]=
h[1]*l+h[5]*m+h[9]*g+h[13];k[2]=h[2]*l+h[6]*m+h[10]*g+h[14];k[3]=h[3]*l+h[7]*m+h[11]*g+h[15]}for(d=0;12>d;++d){e=this.clipTriangle(this.clipPosition[u[d][0]],this.clipPosition[u[d][1]],this.clipPosition[u[d][2]]);f=!0;for(h=0;h<e.length;++h)if(k=e[h][3],2<=k){f=!1;break}if(!f)for(c=!0,h=0;h<e.length;++h)k=e[h][3],k<b.near&&(b.near=k),k>b.far&&(b.far=k)}return c};b.prototype.inside=function(a,b){if(0===b)return a[0]>=-a[3];if(1===b)return a[1]>=-a[3];if(2===b)return a[0]<=a[3];if(3===b)return a[1]<=
a[3];e.assert(!1)};b.prototype.intersect=function(b,c,d){var e=0;0===d?e=(-b[3]-b[0])/(c[0]-b[0]+c[3]-b[3]):1===d?e=(-b[3]-b[1])/(c[1]-b[1]+c[3]-b[3]):2===d?e=(b[3]-b[0])/(c[0]-b[0]-c[3]+b[3]):3===d&&(e=(b[3]-b[1])/(c[1]-b[1]-c[3]+b[3]));return a.vec4d.lerp(b,c,e,a.vec4d.create())};b.prototype.clipTriangle=function(a,b,c){a=[a,b,c];for(b=0;4>b;++b){c=a;a=[];for(var d=0;d<c.length;++d){var e=c[d],f=c[(d+1)%c.length];this.inside(f,b)?(this.inside(e,b)||a.push(this.intersect(e,f,b)),a.push(f)):this.inside(e,
b)&&a.push(this.intersect(e,f,b))}}return a};return b}();var u=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],t=a.vec3d.create(),v=a.mat4d.create(),A=l.empty(),z=new n,x=new r,B=new g})},"esri/views/3d/webgl-engine/lib/HighlightHelper":function(){define("require exports ../../lib/gl-matrix ../../support/debugFlags ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/HighlightPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q){return function(){function g(a,b){this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0};this.blur1Fbo=this.blur0Fbo=this.quadVAO=null;this._rctx=b;this.viewportToRestore=c.vec4d.create();this.defaultOptions={color:new Float32Array([1,0,1,1]),haloOpacity:1,fillOpacity:.2,haloOpacityOccluded:.25,fillOpacityOccluded:.05};this.blurProgram=a.getProgram(h.blurPass,{gaussianSamples:5});
this.blurGridProgram=a.getProgram(h.blurPass,{gaussianSamples:5,gridOptimization:!0});this.applyProgram=a.getProgram(h.applyPass);this.applyGridProgram=a.getProgram(h.applyPass,{gridOptimization:!0});this.applyGridDebugProgram=a.getProgram(h.applyPass,{gridOptimization:!0,gridDebug:!0});this.downsampleProgram=a.getProgram(h.downsamplePass)}Object.defineProperty(g.prototype,"enabled",{get:function(){return null!==this.blur0Fbo},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"profilingCallback",{get:function(){return a.HIGHLIGHTS_PROFILE_TO_CONSOLE?function(a){return console.log(a)}:null},enumerable:!0,configurable:!0});g.prototype.setDefaultOptions=function(a){this.defaultOptions=a};g.prototype.render=function(b,f){var h=!a.HIGHLIGHTS_GRID_OPTIMIZATION_DISABLED,k=a.HIGHLIGHTS_VISUALIZE_BLOCKS,l=b.camera,m=b.fbo,g=this._rctx;e.assert(this.enabled);c.vec4d.set(l.fullViewport,this.viewportToRestore);var q=Math.ceil(f.width/1),p=Math.ceil(f.height/
1);this.blur0Fbo.resize(q,p);this.blur1Fbo.resize(q,p);g.bindVAO(this.quadVAO);g.setDepthWriteEnabled(!1);g.setDepthTestEnabled(!1);g.setBlendingEnabled(!1);var r=null,u=l=r=null;if(h){var n=this._grid;this._gridUpdateResources(f,32);this._gridComputeMipmap();l=n.vao;u=4;r=this.blurGridProgram;g.bindProgram(r);g.bindTexture(n.coverageMipmap[n.mipmapLevels].colorTexture,1);r.setUniform1i("coverageTex",1)}else l=this.quadVAO,u=5,r=this.blurProgram,g.bindProgram(r);g.bindVAO(l);g.bindFramebuffer(this.blur0Fbo);
g.setViewport(0,0,q,p);g.setClearColor(0,0,0,0);g.clear(g.gl.COLOR_BUFFER_BIT);r.setUniform1i("tex",0);g.bindTexture(f.colorTexture,0);r.setUniform2f("blurSize",1/q,0);g.drawArrays(u,0,d.vertexCount(l,"geometry"));g.bindFramebuffer(this.blur1Fbo);g.clear(g.gl.COLOR_BUFFER_BIT);g.bindTexture(this.blur0Fbo.colorTexture,0);r.setUniform2f("blurSize",0,1/p);g.drawArrays(u,0,d.vertexCount(l,"geometry"));g.bindFramebuffer(m);g.setBlendingEnabled(!0);g.setBlendFunctionSeparate(770,771,1,771);g.setViewport(this.viewportToRestore[0],
this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);h?(r=k?this.applyGridDebugProgram:this.applyGridProgram,g.bindProgram(r),r.setUniform1i("coverageTex",2),g.bindTexture(this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture,2)):(r=this.applyProgram,g.bindProgram(r));r.setUniform1i("tex",0);g.bindTexture(this.blur1Fbo.colorTexture,0);r.setUniform1i("origin",1);g.bindTexture(f.colorTexture,1);b=b.pixelRatio||1;r.setUniform4fv("color",this.defaultOptions.color);
r.setUniform1f("outlineSize",8.6*b);r.setUniform1f("blurSize",.4*b);r.setUniform4f("opacities",this.defaultOptions.haloOpacity,this.defaultOptions.haloOpacityOccluded,this.defaultOptions.fillOpacity,this.defaultOptions.fillOpacityOccluded);g.drawArrays(u,0,d.vertexCount(l,"geometry"));g.bindVAO(null);g.setDepthWriteEnabled(!0);g.setDepthTestEnabled(!0);g.setBlendingEnabled(!1)};g.prototype.enable=function(){if(!this.enabled){this.quadVAO=l.createQuadVAO(this._rctx);var a={colorTarget:0,depthStencilTarget:0,
width:0,height:0},b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,height:0};this.blur0Fbo=k.createWithAttachments(this._rctx,b,a);this.blur1Fbo=k.createWithAttachments(this._rctx,b,a)}};g.prototype.disable=function(){this.enabled&&(this.quadVAO.dispose(!0),this.blur1Fbo.dispose(),this.blur0Fbo.dispose(),this.blur1Fbo=this.blur0Fbo=this.quadVAO=null)};g.prototype._gridUpdateResources=function(a,c){var d=this._rctx,e=this._grid,h=!1;null===e.coverageMipmap&&(e.coverageMipmap=
[a],h=!0);if(e.viewportWidth!==a.width||e.viewportHeight!==a.height)h=!0,e.viewportWidth=a.width,e.viewportHeight=a.height;e.coverageMipmap[0]=a;e.cellPixelSize!==c&&(e.cellPixelSize=c,h=!0);if(h){for(c=1;c<e.coverageMipmap.length;c++)e.coverageMipmap[c].dispose();e.mipmapLevels=Math.ceil(Math.log(e.cellPixelSize)*Math.LOG2E);e.coverageMipmap.length=e.mipmapLevels+1;for(c=0;c<e.mipmapLevels;c++)h=e.coverageMipmap[c],h=k.createWithAttachments(d,{target:3553,pixelFormat:6407,dataType:33635,samplingMode:9729,
wrapMode:33071,width:Math.ceil(h.width/2),height:Math.ceil(h.height/2)},{colorTarget:0,depthStencilTarget:0,width:Math.ceil(h.width/2),height:Math.ceil(h.height/2)}),e.coverageMipmap[c+1]=h}var h=Math.ceil(a.height/e.cellPixelSize),l=Math.ceil(a.width/e.cellPixelSize);if(!e.vao||e.verticalCellCount!==h||e.horizontalCellCount!==l){e.verticalCellCount=h;e.horizontalCellCount=l;a=h+1;c=l+1;for(var h=1/h,l=1/l,g=new Float32Array(24*a*c),p=0,r=0;r<a;r++)for(var u=0;u<c;u++)g[p+0]=(u-.5)*l*2-1,g[p+1]=(r-
.5)*h*2-1,g[p+2]=u*l,g[p+3]=r*h,g[p+4]=(u+.5)*l*2-1,g[p+5]=(r-.5)*h*2-1,g[p+6]=u*l,g[p+7]=r*h,g[p+8]=(u-.5)*l*2-1,g[p+9]=(r+.5)*h*2-1,g[p+10]=u*l,g[p+11]=r*h,g[p+12]=(u-.5)*l*2-1,g[p+13]=(r+.5)*h*2-1,g[p+14]=u*l,g[p+15]=r*h,g[p+16]=(u+.5)*l*2-1,g[p+17]=(r-.5)*h*2-1,g[p+18]=u*l,g[p+19]=r*h,g[p+20]=(u+.5)*l*2-1,g[p+21]=(r+.5)*h*2-1,g[p+22]=u*l,g[p+23]=r*h,p+=24;e.vao&&e.vao.dispose(!0);e.vao=new q(d,f.Default3D,{geometry:b.Pos2Tex},{geometry:m.createVertex(d,35044,g)})}};g.prototype._gridComputeMipmap=
function(){var a=this._rctx,b=this._grid,c=this.downsampleProgram;a.bindVAO(this.quadVAO);for(var e=0;e<b.mipmapLevels;e++){a.bindFramebuffer(b.coverageMipmap[e+1]);a.bindTexture(b.coverageMipmap[e].colorTexture,0);var f=b.coverageMipmap[e+1].width,h=b.coverageMipmap[e+1].height;a.bindProgram(c);c.setUniform1i("tex",0);c.setUniform2f("invFramebufferDim",1/f,1/h);a.setViewport(0,0,f,h);a.drawArrays(5,0,d.vertexCount(this.quadVAO,"geometry"))}};return g}()})},"esri/views/3d/webgl-engine/shaders/HighlightPrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b=function(a){return f.glslifyDefineMap({GRID_OPTIMIZATION:a.gridOptimization,GAUSSIAN_SAMPLES:a.gaussianSamples})},l=function(a){return f.glslifyDefineMap({GRID_OPTIMIZATION:a.gridOptimization,GRID_DEBUG:a.gridDebug})};g.downsamplePass={name:"highlight-downsample",shaders:{vertexShader:a.resolveIncludes("renderer/highlight/downsample.vert"),
fragmentShader:a.resolveIncludes("renderer/highlight/downsample.frag")},attributes:c.Default3D};g.blurPass={name:"highlight-blur",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("renderer/highlight/blur.vert"),fragmentShader:b(c)+a.resolveIncludes("renderer/highlight/blur.frag")}},attributes:c.Default3D};g.applyPass={name:"highlight-apply",shaders:function(b){return{vertexShader:l(b)+a.resolveIncludes("renderer/highlight/apply.vert"),fragmentShader:l(b)+a.resolveIncludes("renderer/highlight/apply.frag")}},
attributes:c.Default3D}})},"esri/views/3d/webgl-engine/lib/OffscreenRenderingHelper":function(){define("require exports ./glUtil3D ./RenderTargetHelper ./Util ../shaders/OffscreenPrograms ../../../webgl/Util".split(" "),function(n,g,c,a,f,b,l){var e=[0,0,0,0],h=[0,1,0,1];return function(){function m(c,d){this.dimensions={width:4,height:4};this._enabled=!1;this._background={type:"color",color:[0,0,0,1]};this._rctx=d;d=this.renderTargetHelper=new a.RenderTargetHelper(d);this.mainColor=d.registerColorTarget({name:"mainColor"});
this.mainDepth=d.registerDepthTarget({name:"mainDepth"});this.hudVisibility=d.registerColorTarget({name:"hudVisibility",dataType:32819});this.tmpColor=d.registerColorTarget({name:"tmpColor"});this.tmpDepth=d.registerDepthTarget({name:"tmpDepth"});this._compositeProgram=c.getProgram(b.compositePass);this._compositeTransparentToHUDVisibilityProgram=c.getProgram(b.compositeTransparentToHUDVisibilityPass)}Object.defineProperty(m.prototype,"width",{get:function(){return this.dimensions.width},enumerable:!0,
configurable:!0});Object.defineProperty(m.prototype,"height",{get:function(){return this.dimensions.height},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"background",{get:function(){return this._background},set:function(a){this._background=a},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"framebuffer",
{get:function(){return this.renderTargetHelper.getFramebuffer(this.dimensions,this.mainColor,this.mainDepth)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"colorTexture",{get:function(){return this.framebuffer.colorTexture},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"depthTexture",{get:function(){return this.renderTargetHelper.getDepthTexture(this.mainDepth,this.dimensions)},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"hudVisibilityTexture",
{get:function(){return this.getColorTexture(this.hudVisibility)},enumerable:!0,configurable:!0});m.prototype.initializeFrame=function(a,b){f.assert(this.enabled);var c=this._rctx,d=c.gl;a=a.fullViewport;this.dimensions.width=a[2];this.dimensions.height=a[3];this.mainFbo=b;this.bindTarget(this.mainColor,this.mainDepth);c.setClearStencil(0);b=this._background.color;c.setClearColor(b[0]*b[3],b[1]*b[3],b[2]*b[3],b[3]);c.clear(d.COLOR_BUFFER_BIT|d.DEPTH_BUFFER_BIT|d.STENCIL_BUFFER_BIT)};m.prototype.renderSeparateAndComposite=
function(a,b,c){void 0===b&&(b=e);void 0===c&&(c="none");this.renderToTargets(a,this.tmpColor,this.mainDepth,b);this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,c)};m.prototype.renderHUDVisibility=function(a){this.renderToTargets(a,this.hudVisibility,this.mainDepth,h)};m.prototype.compositeTransparentTerrainOntoHUDVisibility=function(){var a=this,b=this._rctx;this.renderToTargets(function(){var c=a._compositeTransparentToHUDVisibilityProgram;b.bindProgram(c);c.setUniform1i("tex",
1);b.bindTexture(a.getColorTexture(a.tmpColor),1);b.setDepthTestEnabled(!1);b.setBlendingEnabled(!1);b.setColorMask(!1,!0,!1,!1);b.bindVAO(a.quadVAO);b.drawArrays(5,0,l.vertexCount(a.quadVAO,"geometry"));b.setColorMask(!0,!0,!0,!0);b.setDepthTestEnabled(!0)},this.hudVisibility,this.mainDepth)};m.prototype.compositeTransparentTerrainOntoMain=function(){this.composite(this.getColorTexture(this.tmpColor),this.framebuffer,"premultiplied-alpha")};m.prototype.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};
m.prototype.renderDepthDetached=function(a){this.bindTarget(this.mainColor);a();this.bindTarget(this.mainColor,this.mainDepth)};m.prototype.composite=function(a,b,c){void 0===a&&(a=this.framebuffer.colorTexture);void 0===b&&(b=this.mainFbo);void 0===c&&(c="none");var d=this._rctx,e=this._compositeProgram;d.bindFramebuffer(b);d.setDepthTestEnabled(!1);d.bindProgram(e);e.setUniform1i("tex",1);d.bindTexture(a,1);switch(c){case "none":d.setBlendingEnabled(!1);break;case "alpha":d.setBlendFunctionSeparate(770,
771,1,771);d.setBlendingEnabled(!0);break;case "premultiplied-alpha":d.setBlendFunction(1,771),d.setBlendingEnabled(!0)}d.bindVAO(this.quadVAO);d.drawArrays(5,0,l.vertexCount(this.quadVAO,"geometry"));d.setDepthTestEnabled(!0);d.setBlendingEnabled(!1)};m.prototype.enable=function(){this.enabled||(this._enabled=!0,this.quadVAO=c.createQuadVAO(this._rctx))};m.prototype.disable=function(){this.enabled&&(this._enabled=!1,this.renderTargetHelper.disposeAllResource(),this.quadVAO.dispose(!0),this.quadVAO=
null)};m.prototype.renderToTargets=function(a,b,c,e,f){var d=this._rctx,h=d.gl;this.bindTarget(b,c);b=0;e&&(d.setClearColor(e[0],e[1],e[2],Math.max(1E-13,e[3])),b|=h.COLOR_BUFFER_BIT);f&&(b|=h.DEPTH_BUFFER_BIT);d.clear(b);a();h.flush();this.bindTarget(this.mainColor,this.mainDepth)};m.prototype.bindTarget=function(a,b){a=this.renderTargetHelper.getFramebuffer(this.dimensions,a,b);this._rctx.bindFramebuffer(a)};m.prototype.getColorTexture=function(a){return this.renderTargetHelper.getColorTexture(a,
this.dimensions)};return m}()})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});var l={dataType:5121},e={};n=function(){function h(a){this.rctx=a;this.framebuffers=new Map;this.depthTextures=new Map;this.depthBuffers=new Map;this.colorTextures=new Map;this.nextId=
1;this.depthTextureSupported=a.capabilities.depthTexture}h.prototype.disposeAllResource=function(){this.depthBuffers.forEach(function(a){return a.dispose()});this.depthBuffers.clear();this.depthTextures.forEach(function(a){return a.dispose()});this.depthTextures.clear();this.colorTextures.forEach(function(a){return a.dispose()});this.colorTextures.clear()};h.prototype.getDepthTexture=function(a,c){if(this.depthTextureSupported){var d=this.depthTextures.get(a.id);!d||d.descriptor.width===c.width&&
d.descriptor.height===c.height||(d.dispose(),d=void 0);d||(d=new b(this.rctx,{target:3553,pixelFormat:34041,dataType:34042,samplingMode:9728,wrapMode:33071,width:c.width,height:c.height}),this.depthTextures.set(a.id,d));return d}};h.prototype.getDepthBuffer=function(a,b){if(!this.depthTextureSupported){var d=this.depthBuffers.get(a.id);d?d.descriptor.width===b.width&&d.descriptor.height===b.height||d.resize(b.width,b.height):(d=new f(this.rctx,c({internalFormat:34041},b)),this.depthBuffers.set(a.id,
d));return d}};h.prototype.getColorTexture=function(a,c){var d=this.colorTextures.get(a.id);!d||d.descriptor.width===c.width&&d.descriptor.height===c.height||(d.dispose(),d=void 0);d||(d=new b(this.rctx,{target:3553,pixelFormat:6408,dataType:a.dataType,samplingMode:9729,wrapMode:33071,width:c.width,height:c.height}),this.colorTextures.set(a.id,d));return d};h.prototype.registerDepthTarget=function(a){void 0===a&&(a={});var b=this.nextId++;return c({id:b},e,a)};h.prototype.registerColorTarget=function(a){void 0===
a&&(a={});var b=this.nextId++;return c({id:b},l,a)};h.prototype.getFramebuffer=function(b,c,d){var e=this.getKey(c,d),f=this.framebuffers.get(e);c=this.getColorTexture(c,b);if(this.depthTextureSupported){var h=d?this.getDepthTexture(d,b):void 0;if(!f)return f=d?a.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:4},h):a.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:0}),this.framebuffers.set(e,f),f;if(d=f.width!==b.width||f.height!==b.height||f.colorTexture!==
c||f.depthStencilTexture!==h)f.detachColorTexture(),f.detachDepthStencilTexture(),f.resize(b.width,b.height),f.attachColorTexture(c),f.attachDepthStencilTexture(h)}else{h=d?this.getDepthBuffer(d,b):void 0;if(!f)return f=a.createWithAttachments(this.rctx,c,{colorTarget:0,depthStencilTarget:d?3:0},h),this.framebuffers.set(e,f),f;if(d=f.width!==b.width||f.height!==b.height||f.colorTexture!==c)f.detachColorTexture(),f.detachDepthStencilBuffer(),f.resize(b.width,b.height),f.attachColorTexture(c),f.attachDepthStencilBuffer(h)}return f};
h.prototype.getKey=function(a,b){return a.id+"_"+(b?b.id:"X")+"_"+a.name+(b?"_"+b.name:"")};return h}();g.RenderTargetHelper=n})},"esri/views/3d/webgl-engine/shaders/OffscreenPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.compositePass={name:"offscreen-composite",shaders:{vertexShader:a.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:a.resolveIncludes("renderer/offscreen/offscreen.frag")},
attributes:c.Default3D};g.compositeTransparentToHUDVisibilityPass={name:"offscreen-composite-transparent-to-hud-visibility",shaders:{vertexShader:a.resolveIncludes("renderer/offscreen/offscreen.vert"),fragmentShader:a.resolveIncludes("renderer/offscreen/transparentToHUDVisibility.frag")},attributes:c.Default3D}})},"esri/views/3d/webgl-engine/lib/RenderOccludedHelper":function(){define("require exports ../../lib/gl-matrix ./glUtil3D ./Util ../shaders/OccludedPrograms ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(n,g,c,a,f,b,l,e){return function(){function h(a,e){this._quadVAO=null;this._rctx=e;this._colorFBO=void 0;this._viewportToRestore=c.vec4d.create();this._combineProgram=a.getProgram(b.combinePass)}Object.defineProperty(h.prototype,"enabled",{get:function(){return void 0!==this._colorFBO},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});h.prototype.setupFBOs=function(a){f.assert(this.enabled);this._viewportToRestore=a=a.fullViewport;this._width=a[2];this._height=
a[3];this._rctx.setViewport(0,0,this._width,this._height)};h.prototype.prepareColorPass=function(){f.assert(this.enabled);var a=this._rctx,b=a.gl;this._colorFBO.resize(this._width,this._height);a.bindFramebuffer(this._colorFBO);a.setClearColor(0,0,0,0);a.clear(b.COLOR_BUFFER_BIT|b.DEPTH_BUFFER_BIT)};h.prototype.finish=function(a){var b=this._rctx;b.bindFramebuffer(a);b.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])};h.prototype.apply=
function(){var a=this._rctx,b=this._combineProgram;a.bindProgram(b);a.bindVAO(this._quadVAO);a.bindTexture(this._colorFBO.colorTexture,0);b.setUniform1i("occludedColorMap",0);a.setDepthWriteEnabled(!1);a.setDepthTestEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunction(770,771);a.drawArrays(5,0,e.vertexCount(this._quadVAO,"geometry"));a.bindVAO(null);a.setDepthWriteEnabled(!0);a.setDepthTestEnabled(!0);a.setBlendingEnabled(!1)};h.prototype.enable=function(){this.enabled||(this._quadVAO=a.createQuadVAO(this._rctx),
this._colorFBO=l.createWithAttachments(this._rctx,{target:3553,pixelFormat:6408,dataType:5121,samplingMode:9728,wrapMode:33071,width:0,height:0},{colorTarget:0,depthStencilTarget:1}))};h.prototype.disable=function(){this.enabled&&(this._quadVAO.dispose(!0),this._quadVAO=void 0,this._colorFBO.dispose(),this._colorFBO=void 0)};return h}()})},"esri/views/3d/webgl-engine/shaders/OccludedPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,
g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.combinePass={name:"occluded-combine",shaders:{vertexShader:a.resolveIncludes("util/quad.vert"),fragmentShader:a.resolveIncludes("renderer/occluded/combine.frag")},attributes:c.Default3D}})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("require exports ../../lib/gl-matrix ../../support/mathUtils ./Camera ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/MiscPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){function u(a,b){c.vec3d.set3(a[b],a[b+3],a[b+6],Z);return Z}var t=function(){return function(){this.camera=new f;this.lightMat=c.mat4d.create()}}();n=function(){function f(a,b){this.doShadowMapMipmapsWork=!1;this.textureRes=4096;this.numCascades=1;this.maxNumCascades=2;this.cascadeDistances=[0,0,0,0,0];this.cascades=[];this.programRep=a;this.rctx=b;this.emptyTexture=e.createEmptyTexture(b);for(a=0;4>a;++a)this.cascades.push(new t)}f.prototype.dispose=function(){this.emptyTexture.dispose();
this.emptyTexture=null};Object.defineProperty(f.prototype,"textureResolution",{get:function(){return this.textureRes},set:function(a){this.textureRes=a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"maxCascades",{get:function(){return this.maxNumCascades},set:function(b){this.maxNumCascades=a.clamp(Math.floor(b),1,4)},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"enabled",{get:function(){return!!this.depthTexture},set:function(a){a?this.enable():this.disable()},
enumerable:!0,configurable:!0});f.prototype.getDepthTexture=function(){return this.depthTexture};f.prototype.getCascades=function(){for(var a=0;a<this.numCascades;++a)M[a]=this.cascades[a];M.length=this.numCascades;return M};f.prototype.prepare=function(a,b,d,e){h.assert(this.enabled);c.mat4d.multiply(a.projectionMatrix,a.viewMatrix,A);var f=e.near,k=e.far;2>f&&(f=2);2>k&&(k=2);f>=k&&(f=2,k=4);this.numCascades=Math.min(1+Math.floor(h.logWithBase(k/f,4)),this.maxNumCascades);d=Math.pow(k/f,1/this.numCascades);
for(e=0;e<this.numCascades+1;++e)this.cascadeDistances[e]=f*Math.pow(d,e);c.mat4d.inverse(A,z);c.mat4d.lookAt([0,0,0],[-b[0],-b[1],-b[2]],[0,1,0],N);d=a.viewMatrix;a=a.projectionMatrix;for(e=0;e<this.numCascades;++e){var l=this.cascades[e],k=-this.cascadeDistances[e],f=-this.cascadeDistances[e+1],k=(a[10]*k+a[14])/Math.abs(a[11]*k+a[15]),f=(a[10]*f+a[14])/Math.abs(a[11]*f+a[15]);h.assert(k<f);for(var m=0;8>m;++m){c.vec4d.set4(0===m%4||3===m%4?-1:1,0===m%4||1===m%4?-1:1,4>m?k:f,1,x);c.mat4d.multiplyVec4(z,
x,B[m]);for(var g=0;3>g;++g)B[m][g]/=B[m][3]}c.vec3d.negate(B[0],H);c.mat4d.translate(N,H,v);l.camera.viewMatrix=v;for(m=0;8>m;++m)c.mat4d.multiplyVec3(l.camera.viewMatrix,B[m]);c.vec3d.set(B[0],D);c.vec3d.set(B[0],C);for(m=1;8>m;++m)for(g=0;3>g;++g)D[g]=Math.min(D[g],B[m][g]),C[g]=Math.max(C[g],B[m][g]);D[2]-=200;C[2]+=200;l.camera.near=-C[2];l.camera.far=-D[2];f=1/B[0][3];k=1/B[4][3];h.assert(f<k);var g=f+Math.sqrt(f*k),m=Math.sin(Math.acos(d[2]*b[0]+d[6]*b[1]+d[10]*b[2])),g=g/m,f=B,q=g,p=m,m=G,
t=E,r=F,n=I,g=K;c.vec2d.set2(0,0,U);for(var fa=0;4>fa;++fa)c.vec2d.add(U,f[fa],U);c.vec2d.scale(U,.25);c.vec2d.set2(0,0,J);for(fa=4;8>fa;++fa)c.vec2d.add(J,f[fa],J);c.vec2d.scale(J,.25);c.vec2d.lerp(f[4],f[5],.5,O[0]);c.vec2d.lerp(f[5],f[6],.5,O[1]);c.vec2d.lerp(f[6],f[7],.5,O[2]);c.vec2d.lerp(f[7],f[4],.5,O[3]);for(var Z=0,ba=c.vec2d.dist2(O[0],U),fa=1;4>fa;++fa){var M=c.vec2d.dist2(O[fa],U);M<ba&&(ba=M,Z=fa)}c.vec2d.subtract(O[Z],f[Z+4],P);fa=P[0];P[0]=-P[1];P[1]=fa;c.vec2d.subtract(J,U,R);c.vec2d.lerp(P,
R,p);c.vec2d.normalize(P);Z=p=void 0;p=Z=c.vec2d.dot(c.vec2d.subtract(f[0],U,Q),P);for(fa=1;8>fa;++fa)ba=c.vec2d.dot(c.vec2d.subtract(f[fa],U,Q),P),ba<p?p=ba:ba>Z&&(Z=ba);c.vec2d.set(U,m);c.vec2d.scale(P,p-q,Q);c.vec2d.add(m,Q,m);for(var M=-1,V=1,fa=q=ba=0;8>fa;++fa){c.vec2d.subtract(f[fa],m,L);c.vec2d.normalize(L);var T=P[0]*L[1]-P[1]*L[0];0<T?T>M&&(M=T,ba=fa):T<V&&(V=T,q=fa)}h.verify(0<M,"leftArea");h.verify(0>V,"rightArea");c.vec2d.scale(P,p,S);c.vec2d.add(S,U,S);c.vec2d.scale(P,Z,aa);c.vec2d.add(aa,
U,aa);ea[0]=-P[1];ea[1]=P[0];t=h.rayRay2D(m,f[q],aa,c.vec2d.add(aa,ea,Q),1,t);r=h.rayRay2D(m,f[ba],aa,Q,1,r);n=h.rayRay2D(m,f[ba],S,c.vec2d.add(S,ea,Q),1,n);f=h.rayRay2D(m,f[q],S,Q,1,g);h.verify(t,"rayRay");h.verify(r,"rayRay");h.verify(n,"rayRay");h.verify(f,"rayRay");r=G;f=E;m=I;n=K;g=l.camera.projectionMatrix;c.vec2d.scale(c.vec2d.subtract(m,n,da),.5);W[0]=da[0];W[1]=da[1];W[2]=0;W[3]=da[1];W[4]=-da[0];W[5]=0;W[6]=da[0]*da[0]+da[1]*da[1];W[7]=da[0]*da[1]-da[1]*da[0];W[8]=1;W[6]=-c.vec2d.dot(u(W,
0),r);W[7]=-c.vec2d.dot(u(W,1),r);r=c.vec2d.dot(u(W,0),m)+W[6];t=c.vec2d.dot(u(W,1),m)+W[7];fa=c.vec2d.dot(u(W,0),n)+W[6];n=c.vec2d.dot(u(W,1),n)+W[7];r=-(r+fa)/(t+n);W[0]+=W[1]*r;W[3]+=W[4]*r;W[6]+=W[7]*r;r=1/(c.vec2d.dot(u(W,0),m)+W[6]);t=1/(c.vec2d.dot(u(W,1),m)+W[7]);W[0]*=r;W[3]*=r;W[6]*=r;W[1]*=t;W[4]*=t;W[7]*=t;W[2]=W[1];W[5]=W[4];W[8]=W[7];W[7]+=1;r=c.vec2d.dot(u(W,1),f)+W[7];t=c.vec2d.dot(u(W,2),f)+W[8];fa=c.vec2d.dot(u(W,1),m)+W[7];n=c.vec2d.dot(u(W,2),m)+W[8];r=-.5*(r/t+fa/n);W[1]+=W[2]*
r;W[4]+=W[5]*r;W[7]+=W[8]*r;r=c.vec2d.dot(u(W,1),f)+W[7];t=c.vec2d.dot(u(W,2),f)+W[8];fa=-t/r;W[1]*=fa;W[4]*=fa;W[7]*=fa;g[0]=W[0];g[1]=W[1];g[2]=0;g[3]=W[2];g[4]=W[3];g[5]=W[4];g[6]=0;g[7]=W[5];g[8]=0;g[9]=0;g[10]=1;g[11]=0;g[12]=W[6];g[13]=W[7];g[14]=0;g[15]=W[8];l.camera.projectionMatrix[10]=2/(D[2]-C[2]);l.camera.projectionMatrix[14]=-(D[2]+C[2])/(D[2]-C[2]);c.mat4d.multiply(l.camera.projectionMatrix,l.camera.viewMatrix,l.lightMat);f=this.textureRes/2;l.camera.viewport[0]=0===e%2?0:f;l.camera.viewport[1]=
0===Math.floor(e/2)?0:f;l.camera.viewport[2]=f;l.camera.viewport[3]=f}this.lastOrigin=null;this.cascadeDistances[this.numCascades]=100*k;b=this.rctx;e=b.gl;b.bindFramebuffer(this.fbo);b.bindTexture(null,7);b.setClearColor(1,1,1,1);b.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);b.setBlendingEnabled(!1)};f.prototype.finish=function(a){h.assert(this.enabled);this.rctx.bindFramebuffer(a);this.doShadowMapMipmapsWork&&this.depthTexture.generateMipmap()};f.prototype.bind=function(a){var b=this.rctx,c=this.enabled;
b.bindTexture(c?this.depthTexture:this.emptyTexture,7);b.bindProgram(a);a.setUniform1i("depthTex",7);a.setUniform1f("depthHalfPixelSz",c?.5/this.textureRes:-1);a.setUniform1i("shadowMapNum",this.numCascades);a.setUniform4f("shadowMapDistance",this.cascadeDistances[0],this.cascadeDistances[1],this.cascadeDistances[2],this.cascadeDistances[3])};f.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("shadowMapDistance");for(var b=0;b<a.length;b++)this.bind(a[b])};f.prototype.bindView=function(a,
b){if(this.enabled){var d=this.lastOrigin;if(!d||d[0]!==b[0]||d[1]!==b[1]||d[2]!==b[2])for(this.lastOrigin=this.lastOrigin||c.vec3d.create(),c.vec3d.set(b,this.lastOrigin),d=0;d<this.numCascades;++d){c.mat4d.translate(this.cascades[d].lightMat,b,T);for(var e=0;16>e;++e)V[16*d+e]=T[e]}a.setUniformMatrix4fv("shadowMapMatrix",V)}};f.prototype.drawDebugQuad=function(a){h.assert(this.enabled);var c=this.rctx,d=c.gl;if(!this.debugQuadVAO){var e=new Float32Array([0,0,0,0,256,0,1,0,0,256,0,1,256,256,1,1]);
this.debugQuadVAO=new r(c,b.Default3D,{geometry:l.Pos2Tex},{geometry:k.createVertex(c,d.STATIC_DRAW,e)})}var e=this.programRep.getProgram(m.showDepth),f=this.debugQuadVAO;c.setDepthTestEnabled(!1);c.bindProgram(e);e.setUniformMatrix4fv("proj",a);e.setUniform1i("depthTex",0);c.bindTexture(this.depthTexture,0);c.bindVAO(f);p.assertCompatibleVertexAttributeLocations(f,e);c.drawArrays(d.TRIANGLE_STRIP,0,p.vertexCount(f,"geometry"));c.setDepthTestEnabled(!0)};f.prototype.enable=function(){if(!this.enabled){var a=
this.rctx.gl;this.depthTexture=new q(this.rctx,{target:a.TEXTURE_2D,pixelFormat:a.RGBA,dataType:a.UNSIGNED_BYTE,wrapMode:a.CLAMP_TO_EDGE,samplingMode:a.NEAREST,flipped:!0,width:this.textureRes,height:this.textureRes});this.fbo=d.createWithAttachments(this.rctx,this.depthTexture,{colorTarget:0,depthStencilTarget:1,width:this.textureRes,height:this.textureRes})}};f.prototype.disable=function(){this.enabled&&this.fbo&&(this.fbo.dispose(),this.depthTexture=this.fbo=null)};return f}();var v=c.mat4d.create(),
A=c.mat4d.create(),z=c.mat4d.create(),x=c.vec4d.create(),B=[];for(g=0;8>g;++g)B.push(c.vec4d.create());var D=c.vec3d.create(),C=c.vec3d.create(),G=c.vec2d.create(),E=c.vec2d.create(),F=c.vec2d.create(),I=c.vec2d.create(),K=c.vec2d.create(),N=c.mat4d.create(),H=c.vec3d.create(),M=[],T=c.mat4d.create(),V=new Float32Array(64),U=c.vec2d.create(),J=c.vec2d.create(),O=[c.vec2d.create(),c.vec2d.create(),c.vec2d.create(),c.vec2d.create()],P=c.vec2d.create(),R=c.vec2d.create(),Q=c.vec2d.create(),L=c.vec2d.create(),
S=c.vec2d.create(),aa=c.vec2d.create(),ea=c.vec2d.create(),Z=c.vec3d.create(),da=c.vec2d.create(),W=c.mat3d.create();return n})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../core/Logger ../../lib/gl-matrix ../../support/imageUtils ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ./Util ../shaders/MiscPrograms ../shaders/SSAOPrograms ../../../webgl/BufferObject ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){var t=c.getLogger("esri.views.3d.webgl-engine.lib.SSAOHelper");g=function(){function c(b,c,d){this._enabled=!1;this._BLUR_F=2;this._attenuation=.5;this._radius=3;this._samples=16;this._viewportToRestore=a.vec4d.create();this._rctx=c;this._programRep=b;this._requestRender=d;this._emptyTexture=e.createEmptyTexture(c)}c.prototype.dispose=function(){this._emptyTexture.dispose();this._emptyTexture=null};Object.defineProperty(c.prototype,"isSupported",{get:function(){var a=
this._rctx,b=-1!==a.parameters.versionString.indexOf("WebGL 0.93"),a=-1!==a.parameters.versionString.indexOf("WebGL 0.94");return!(b||a)},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"enabled",{get:function(){return this._enabled},set:function(a){a?this.enable():this.disable()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"attenuation",{get:function(){return this._attenuation},set:function(a){this._attenuation=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"radius",{get:function(){return this._radius},set:function(a){this._radius=a},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"filterRadius",{get:function(){return 4},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"samples",{get:function(){return this._samples},set:function(a){this._samples=a;this._enabled&&this.selectPrograms()},enumerable:!0,configurable:!0});c.prototype.computeSSAO=function(b,c,d,f){if(this._noiseTexture){h.assert(this.enabled);var k=this._rctx,
l=d.width,m=d.height,g=l/this._BLUR_F,q=m/this._BLUR_F;this._ssaoFBO.resize(l,m);this._blur0FBO.resize(g,q);this._blur1FBO.resize(g,q);g=1*l;q=1*m;k.bindFramebuffer(this._ssaoFBO);a.vec4d.set(b.fullViewport,this._viewportToRestore);k.setViewport(0,0,l,m);var p=this._ssaoProgram,t=this._blurProgram;p.setUniform2f("rnmScale",l/this._noiseTexture.descriptor.width,m/this._noiseTexture.descriptor.height);p.setUniform3fv("pSphere",8>=this._samples?this._data.random8:16>=this._samples?this._data.random16:
32>=this._samples?this._data.random32:this._data.random64);k.bindProgram(p);l=this._data.minDiscrepancy;p.setUniform1f("numSpiralTurns",this._samples<l.length?l[this._samples]:5779);l=A;m=v;h.inverseProjectionInfo(b.projectionMatrix,b.fullWidth,b.fullHeight,l,m);p.setUniform4fv("projInfo",l);p.setUniform2fv("zScale",m);p.setUniform2f("nearFar",b.near,b.far);l=1/b.computePixelSizeAtDist(1);p.setUniform1f("projScale",1*l);p.setUniform2f("screenDimensions",g,q);var u=2*this._radius,m=a.vec3d.dist(b.eye,
b.center),u=20*b.computePixelSizeAtDist(m),u=Math.max(.1,u);p.setUniform1f("radius",u);p.setUniform1f("intensity",4*this._attenuation/Math.pow(u,6));p.setUniform1i("rnm",0);p.setUniform1i("normalMap",1);p.setUniform1i("depthMap",2);k.bindTexture(this._noiseTexture,0);k.bindTexture(f.colorTexture,1);k.bindTexture(d.colorTexture,2);d=e.createQuadVAO(this._rctx);k.bindVAO(d);k.drawArrays(5,0,r.vertexCount(d,"geometry"));k.bindTexture(this._ssaoFBO.colorTexture,0);k.setViewport(0,0,g/this._BLUR_F,q/this._BLUR_F);
k.bindFramebuffer(this._blur0FBO);t.setUniform2f("screenDimensions",g,q);t.setUniform1i("tex",0);t.setUniform1i("normalMap",1);t.setUniform1i("depthMap",2);t.setUniform2f("blurSize",0,1*this._BLUR_F/q);t.setUniform1i("radius",4);t.setUniform1f("g_BlurFalloff",.08);t.setUniform2f("nearFar",b.near,b.far);5E4<m&&(l=Math.max(0,l-(m-5E4)));t.setUniform1f("projScale",l);t.setUniform2f("zScale",1,0);k.drawArrays(5,0,r.vertexCount(d,"geometry"));t.setUniform2f("blurSize",1*this._BLUR_F/g,0);k.bindFramebuffer(this._blur1FBO);
k.bindTexture(this._blur0FBO.colorTexture,0);k.drawArrays(5,0,r.vertexCount(d,"geometry"));k.bindFramebuffer(c);k.setViewport(this._viewportToRestore[0],this._viewportToRestore[1],this._viewportToRestore[2],this._viewportToRestore[3])}};c.prototype.setUniforms=function(a){var b=this.enabled&&this._noiseTexture,c=this._rctx;c.bindTexture(b?this._blur1FBO.colorTexture:this._emptyTexture,6);c.setActiveTexture(0);a.setUniform1i("ssaoTex",6);b?a.setUniform4f("viewportPixelSz",this._viewportToRestore[0],
this._viewportToRestore[1],1/this._ssaoFBO.width,1/this._ssaoFBO.height):a.setUniform4f("viewportPixelSz",-1,-1,-1,-1)};c.prototype.bindAll=function(a){a=a.getProgramsUsingUniform("viewportPixelSz");for(var b=0;b<a.length;b++)this.setUniforms(a[b])};c.prototype.drawQuad=function(a){h.assert(this.enabled);var c=this._showDepthProgram;this._debugQuadVAO||(this._debugQuadVAO=new u(this._rctx,b.Default3D,{geometry:l.Pos2Tex},{geometry:d.createVertex(this._rctx,35044,z)}));var e=this._rctx;e.setDepthTestEnabled(!1);
c.setUniformMatrix4fv("proj",new Float32Array(a));c.setUniform1i("depthTex",0);e.bindTexture(this._ssaoFBO.colorTexture,0);e.bindVAO(this._debugQuadVAO);e.drawArrays(5,0,r.vertexCount(this._debugQuadVAO,"geometry"));e.setDepthTestEnabled(!0)};c.prototype.selectPrograms=function(){this._ssaoProgram=this._programRep.getProgram(k.ssaoPass,{samples:8>=this._samples?8:16>=this._samples?16:32>=this._samples?32:64});this._blurProgram=this._programRep.getProgram(k.blurPass,{radius:4});this._showDepthProgram=
this._programRep.getProgram(m.showDepth)};c.prototype.enable=function(){var a=this;this.enabled||(this.isSupported?(this._enabled=!0,this.loadResources(function(){a._enabled&&a.initialize()})):t.warn("SSAO is not supported for this browser or hardware"))};c.prototype.loadResources=function(a){var b=this;this._data?a():n(["./SSAOHelperData"],function(c){b._data=c;a()})};c.prototype.initialize=function(){var a=this,b={target:3553,pixelFormat:6408,dataType:5121,samplingMode:9729,wrapMode:33071,width:0,
height:0},c={colorTarget:0,depthStencilTarget:0};this._ssaoFBO=q.createWithAttachments(this._rctx,b,c);this._blur0FBO=q.createWithAttachments(this._rctx,b,c);this._blur1FBO=q.createWithAttachments(this._rctx,b,c);f.requestImage(this._data.noiseTexture).then(function(b){a._enabled&&(a._noiseTexture=new p(a._rctx,{target:3553,pixelFormat:6408,dataType:5121,hasMipmap:!0,width:b.width,height:b.height},b),a._requestRender())});this.selectPrograms()};c.prototype.disable=function(){this.enabled&&(this._enabled=
!1,this._quadVAO&&(this._quadVAO.dispose(!0),this._quadVAO=null),this._noiseTexture&&(this._noiseTexture.dispose(),this._noiseTexture=null),this._blur1FBO&&(this._blur1FBO.dispose(),this._blur1FBO=null),this._blur0FBO&&(this._blur0FBO.dispose(),this._blur0FBO=null),this._ssaoFBO&&(this._ssaoFBO.dispose(),this._ssaoFBO=null))};return c}();var v=a.vec2d.create(),A=a.vec4d.create(),z=new Float32Array([0,0,0,0,512,0,1,0,0,512,0,1,512,512,1,1]);return g})},"esri/views/3d/webgl-engine/shaders/SSAOPrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.ssaoPass={name:"ssao",shaders:function(c){return{vertexShader:a.resolveIncludes("util/quad.vert"),fragmentShader:"#define SAMPLES "+c.samples+"\n"+a.resolveIncludes("renderer/ssao/ssao.frag")}},attributes:c.Default3D};g.blurPass={name:"ssao-blur",shaders:function(c){return{vertexShader:a.resolveIncludes("util/quad.vert"),fragmentShader:"#define RADIUS "+c.radius+
"\n"+a.resolveIncludes("renderer/ssao/blur.frag")}},attributes:c.Default3D}})},"esri/views/webgl/RenderingContext":function(){define("require exports ../../core/has ./enums ./InstanceCounter ./capabilities/isWebGL2Context ./capabilities/load".split(" "),function(n,g,c,a,f,b,l){return function(){function c(a,c){this.gl=null;this._blendEnabled=!1;this._blendColorState={r:0,g:0,b:0,a:0};this._blendFunctionState={srcRGB:1,dstRGB:0,srcAlpha:1,dstAlpha:0};this._blendEquationState={mode:32774,modeAlpha:32774};
this._colorMaskState={r:!0,g:!0,b:!0,a:!0};this._polygonCullingEnabled=!1;this._cullFace=1029;this._frontFace=2305;this._scissorTestEnabled=!1;this._scissorRect={x:0,y:0,width:0,height:0};this._depthTestEnabled=!1;this._depthFunction=513;this._clearDepth=1;this._depthWriteEnabled=!0;this._depthRange={zNear:0,zFar:1};this._viewport=null;this._polygonOffsetFillEnabled=this._stencilTestEnabled=!1;this._polygonOffset=[0,0];this._stencilFunction={face:1032,func:519,ref:0,mask:1};this._clearStencil=0;this._stencilWriteMask=
1;this._stencilOperation={face:1032,fail:7680,zFail:7680,zPass:7680};this._lineWidth=1;this._clearColor={r:0,g:0,b:0,a:0};this._activeRenderbuffer=this._activeFramebuffer=this._activeIndexBuffer=this._activeVertexBuffer=this._activeShaderProgram=null;this._activeTextureUnit=0;this._textureUnitMap={};this._numOfTriangles=this._numOfDrawCalls=0;this.contextVersion=b.default(a)?"webgl2":"webgl";this.gl=a;a instanceof WebGLRenderingContext&&this.gl.getExtension("OES_element_index_uint");this._capabilities=
l.loadCapabilities(a,c);a=this.gl.getParameter(this.gl.VIEWPORT);this._viewport={x:a[0],y:a[1],width:a[2],height:a[3]};a=this.capabilities.textureFilterAnisotropic;this._parameters={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:a?this.gl.getParameter(a.MAX_TEXTURE_MAX_ANISOTROPY):void 0,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS)};
this.enforceState()}Object.defineProperty(c.prototype,"contextAttributes",{get:function(){return this.gl.getContextAttributes()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"parameters",{get:function(){return this._parameters},enumerable:!0,configurable:!0});c.prototype.dispose=function(){this.bindVAO(null);this.unbindBuffer(34962);this.unbindBuffer(34963);this._textureUnitMap={};this.gl=null};c.prototype.setBlendingEnabled=function(a){this._blendEnabled!==a&&(!0===a?this.gl.enable(this.gl.BLEND):
this.gl.disable(this.gl.BLEND),this._blendEnabled=a)};c.prototype.setBlendColor=function(a,b,c,d){if(a!==this._blendColorState.r||b!==this._blendColorState.g||c!==this._blendColorState.b||d!==this._blendColorState.a)this.gl.blendColor(a,b,c,d),this._blendColorState.r=a,this._blendColorState.g=b,this._blendColorState.b=c,this._blendColorState.a=d};c.prototype.setBlendFunction=function(a,b){if(a!==this._blendFunctionState.srcRGB||b!==this._blendFunctionState.dstRGB)this.gl.blendFunc(a,b),this._blendFunctionState.srcRGB=
a,this._blendFunctionState.srcAlpha=a,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=b};c.prototype.setBlendFunctionSeparate=function(a,b,c,d){if(this._blendFunctionState.srcRGB!==a||this._blendFunctionState.srcAlpha!==c||this._blendFunctionState.dstRGB!==b||this._blendFunctionState.dstAlpha!==d)this.gl.blendFuncSeparate(a,b,c,d),this._blendFunctionState.srcRGB=a,this._blendFunctionState.srcAlpha=c,this._blendFunctionState.dstRGB=b,this._blendFunctionState.dstAlpha=d};c.prototype.setBlendEquation=
function(a){this._blendEquationState.mode!==a&&(this.gl.blendEquation(a),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=a)};c.prototype.setBlendEquationSeparate=function(a,b){if(this._blendEquationState.mode!==a||this._blendEquationState.modeAlpha!==b)this.gl.blendEquationSeparate(a,b),this._blendEquationState.mode=a,this._blendEquationState.modeAlpha=b};c.prototype.setColorMask=function(a,b,c,d){if(this._colorMaskState.r!==a||this._colorMaskState.g!==b||this._colorMaskState.b!==
c||this._colorMaskState.a!==d)this.gl.colorMask(a,b,c,d),this._colorMaskState.r=a,this._colorMaskState.g=b,this._colorMaskState.b=c,this._colorMaskState.a=d};c.prototype.setClearColor=function(a,b,c,d){if(this._clearColor.r!==a||this._clearColor.g!==b||this._clearColor.b!==c||this._clearColor.a!==d)this.gl.clearColor(a,b,c,d),this._clearColor.r=a,this._clearColor.g=b,this._clearColor.b=c,this._clearColor.a=d};c.prototype.setFaceCullingEnabled=function(a){this._polygonCullingEnabled!==a&&(!0===a?this.gl.enable(this.gl.CULL_FACE):
this.gl.disable(this.gl.CULL_FACE),this._polygonCullingEnabled=a)};c.prototype.setPolygonOffsetFillEnabled=function(a){this._polygonOffsetFillEnabled!==a&&(!0===a?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._polygonOffsetFillEnabled=a)};c.prototype.setPolygonOffset=function(a,b){if(this._polygonOffset[0]!==a||this._polygonOffset[1]!==b)this._polygonOffset[0]=a,this._polygonOffset[1]=b,this.gl.polygonOffset(a,b)};c.prototype.setCullFace=function(a){this._cullFace!==
a&&(this.gl.cullFace(a),this._cullFace=a)};c.prototype.setFrontFace=function(a){this._frontFace!==a&&(this.gl.frontFace(a),this._frontFace=a)};c.prototype.setScissorTestEnabled=function(a){this._scissorTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._scissorTestEnabled=a)};c.prototype.setScissorRect=function(a,b,c,d){if(this._scissorRect.x!==a||this._scissorRect.y!==b||this._scissorRect.width!==c||this._scissorRect.height!==d)this.gl.scissor(a,
b,c,d),this._scissorRect.x=a,this._scissorRect.y=b,this._scissorRect.width=c,this._scissorRect.height=d};c.prototype.setDepthTestEnabled=function(a){this._depthTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._depthTestEnabled=a)};c.prototype.setClearDepth=function(a){this._clearDepth!==a&&(this.gl.clearDepth(a),this._clearDepth=a)};c.prototype.setDepthFunction=function(a){this._depthFunction!==a&&(this.gl.depthFunc(a),this._depthFunction=a)};c.prototype.setDepthWriteEnabled=
function(a){this._depthWriteEnabled!==a&&(this.gl.depthMask(a),this._depthWriteEnabled=a)};c.prototype.setDepthRange=function(a,b){if(this._depthRange.zNear!==a||this._depthRange.zFar!==b)this.gl.depthRange(a,b),this._depthRange.zNear=a,this._depthRange.zFar=b};c.prototype.setStencilTestEnabled=function(a){this._stencilTestEnabled!==a&&(!0===a?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._stencilTestEnabled=a)};c.prototype.setClearStencil=function(a){a!==this._clearStencil&&
(this.gl.clearStencil(a),this._clearStencil=a)};c.prototype.setStencilFunction=function(a,b,c){if(this._stencilFunction.func!==a||this._stencilFunction.ref!==b||this._stencilFunction.mask!==c)this.gl.stencilFunc(a,b,c),this._stencilFunction.face=1032,this._stencilFunction.func=a,this._stencilFunction.ref=b,this._stencilFunction.mask=c};c.prototype.setStencilFunctionSeparate=function(a,b,c,d){if(this._stencilFunction.face!==a||this._stencilFunction.func!==b||this._stencilFunction.ref!==c||this._stencilFunction.mask!==
d)this.gl.stencilFuncSeparate(a,b,c,d),this._stencilFunction.face=a,this._stencilFunction.func=b,this._stencilFunction.ref=c,this._stencilFunction.mask=d};c.prototype.setStencilWriteMask=function(a){this._stencilWriteMask!==a&&(this.gl.stencilMask(a),this._stencilWriteMask=a)};c.prototype.setStencilOp=function(a,b,c){if(this._stencilOperation.fail!==a||this._stencilOperation.zFail!==b||this._stencilOperation.zPass!==c)this.gl.stencilOp(a,b,c),this._stencilOperation.face=1032,this._stencilOperation.fail=
a,this._stencilOperation.zFail=b,this._stencilOperation.zPass=c};c.prototype.setStencilOpSeparate=function(a,b,c,d){if(this._stencilOperation.face!==a||this._stencilOperation.fail!==b||this._stencilOperation.zFail!==c||this._stencilOperation.zPass!==d)this.gl.stencilOpSeparate(a,b,c,d),this._stencilOperation.face=a,this._stencilOperation.face=a,this._stencilOperation.fail=b,this._stencilOperation.zFail=c,this._stencilOperation.zPass=d};c.prototype.setLineWidth=function(a){var b=this._lineWidth;this._lineWidth!==
a&&(this.gl.lineWidth(a),this._lineWidth=a);return b};c.prototype.setActiveTexture=function(b){var c=this._activeTextureUnit;0<=b&&b!==this._activeTextureUnit&&(this.gl.activeTexture(a.BASE_TEXTURE_UNIT+b),this._activeTextureUnit=b);return c};c.prototype.clear=function(a){a&&this.gl.clear(a)};c.prototype.drawArrays=function(a,b,c){this.gl.drawArrays(a,b,c)};c.prototype.drawElements=function(a,b,c,d){5123===c?this.gl.drawElements(a,b,c,d):5125===c&&this.gl.drawElements(a,b,c,d)};c.prototype.logIno=
function(){};Object.defineProperty(c.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!0,configurable:!0});c.prototype.setViewport=function(a,b,c,d){var e=this._viewport;if(e.x!==a||e.y!==b||e.width!==c||e.height!==d)e.x=a,e.y=b,e.width=c,e.height=d,this.gl.viewport(a,b,c,d)};c.prototype.getViewport=function(){return{x:this._viewport.x,y:this._viewport.y,width:this._viewport.width,height:this._viewport.height}};c.prototype.bindProgram=function(a){a?this._activeShaderProgram!==
a&&(a.initialize(),this.gl.useProgram(a.glName),this._activeShaderProgram=a):(this.gl.useProgram(null),this._activeShaderProgram=null)};c.prototype.bindTexture=function(a,b){void 0===b&&(b=0);-1===c._MAX_TEXTURE_IMAGE_UNITS&&(c._MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS));(b>=c._MAX_TEXTURE_IMAGE_UNITS||0>b)&&console.error("Input texture unit is out of range of available units!");var e=this._textureUnitMap[b];this.setActiveTexture(b);null==a||null==a.glName?(null!=
e&&(this.gl.bindTexture(e.descriptor.target,null),e.setBoundToUnit(b,!1)),this._textureUnitMap[b]=null):e&&e.id===a.id?a.applyChanges():(this.gl.bindTexture(a.descriptor.target,a.glName),a.setBoundToUnit(b,!0),a.applyChanges(),this._textureUnitMap[b]=a)};c.prototype.bindFramebuffer=function(a){a?this._activeFramebuffer!==a&&(a.initialize()||this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,a.glName),this._activeFramebuffer=a):(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null),this._activeFramebuffer=null)};
c.prototype.bindBuffer=function(a){a&&(34962===a.bufferType?this._activeVertexBuffer=c._bindBuffer(this.gl,a,a.bufferType,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,a,a.bufferType,this._activeIndexBuffer))};c.prototype.bindRenderbuffer=function(a){var b=this.gl;a||(b.bindRenderbuffer(b.RENDERBUFFER,null),this._activeRenderbuffer=null);this._activeRenderbuffer!==a&&(b.bindRenderbuffer(b.RENDERBUFFER,a.glName),this._activeRenderbuffer=a)};c.prototype.unbindBuffer=function(a){34962===
a?this._activeVertexBuffer=c._bindBuffer(this.gl,null,a,this._activeVertexBuffer):this._activeIndexBuffer=c._bindBuffer(this.gl,null,a,this._activeIndexBuffer)};c.prototype.bindVAO=function(a){a?this._activeVertexArrayObject&&this._activeVertexArrayObject.id===a.id||(a.bind(),this._activeVertexArrayObject=a):this._activeVertexArrayObject&&(this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null)};c.prototype.getBoundTexture=function(a){return this._textureUnitMap[a]};c.prototype.getBoundFramebufferObject=
function(){return this._activeFramebuffer};c.prototype.getBoundVAO=function(){return this._activeVertexArrayObject};c.prototype.resetState=function(){this.bindProgram(null);this.bindVAO(null);this.bindFramebuffer(null);this.unbindBuffer(34962);this.unbindBuffer(34963);for(var a=0;a<this.parameters.maxTextureImageUnits;a++)this.bindTexture(null,a);this.setBlendingEnabled(!1);this.setBlendFunction(1,0);this.setBlendEquation(32774);this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(1029);
this.setFrontFace(2305);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(513);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(519,0,0);this.setStencilOp(7680,7680,7680);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);
this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};c.prototype.enforceState=function(){var b=this.gl,c=this._capabilities.vao;c&&c.bindVertexArray(null);for(var e=0;e<this.parameters.maxVertexAttributes;e++)b.disableVertexAttribArray(e);this._activeVertexBuffer?b.bindBuffer(this._activeVertexBuffer.bufferType,this._activeVertexBuffer.glName):b.bindBuffer(34962,null);this._activeIndexBuffer?b.bindBuffer(this._activeIndexBuffer.bufferType,this._activeIndexBuffer.glName):
b.bindBuffer(34963,null);if(c&&this._activeVertexArrayObject){if(c=this._activeVertexArrayObject)this._activeVertexArrayObject.unbind(),this._activeVertexArrayObject=null;this.bindVAO(c)}b.bindFramebuffer(b.FRAMEBUFFER,this._activeFramebuffer?this._activeFramebuffer.glName:null);b.useProgram(this._activeShaderProgram?this._activeShaderProgram.glName:null);b.blendColor(this._blendColorState.r,this._blendColorState.g,this._blendColorState.b,this._blendColorState.a);b.bindRenderbuffer(b.RENDERBUFFER,
this._activeRenderbuffer?this._activeRenderbuffer.glName:null);!0===this._blendEnabled?b.enable(this.gl.BLEND):b.disable(this.gl.BLEND);b.blendEquationSeparate(this._blendEquationState.mode,this._blendEquationState.modeAlpha);b.blendFuncSeparate(this._blendFunctionState.srcRGB,this._blendFunctionState.dstRGB,this._blendFunctionState.srcAlpha,this._blendFunctionState.dstAlpha);b.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a);b.clearDepth(this._clearDepth);b.clearStencil(this._clearStencil);
b.colorMask(this._colorMaskState.r,this._colorMaskState.g,this._colorMaskState.b,this._colorMaskState.a);b.cullFace(this._cullFace);b.depthFunc(this._depthFunction);b.depthRange(this._depthRange.zNear,this._depthRange.zFar);!0===this._depthTestEnabled?b.enable(b.DEPTH_TEST):b.disable(b.DEPTH_TEST);b.depthMask(this._depthWriteEnabled);b.frontFace(this._frontFace);b.lineWidth(this._lineWidth);!0===this._polygonCullingEnabled?b.enable(b.CULL_FACE):b.disable(b.CULL_FACE);b.polygonOffset(this._polygonOffset[0],
this._polygonOffset[1]);!0===this._polygonOffsetFillEnabled?b.enable(b.POLYGON_OFFSET_FILL):b.disable(b.POLYGON_OFFSET_FILL);b.scissor(this._scissorRect.x,this._scissorRect.y,this._scissorRect.width,this._scissorRect.height);!0===this._scissorTestEnabled?b.enable(b.SCISSOR_TEST):b.disable(b.SCISSOR_TEST);b.stencilFunc(this._stencilFunction.func,this._stencilFunction.ref,this._stencilFunction.mask);b.stencilOpSeparate(this._stencilOperation.face,this._stencilOperation.fail,this._stencilOperation.zFail,
this._stencilOperation.zPass);!0===this._stencilTestEnabled?b.enable(b.STENCIL_TEST):b.disable(b.STENCIL_TEST);b.stencilMask(this._stencilWriteMask);for(c=0;c<this.parameters.maxTextureImageUnits;c++)b.activeTexture(a.BASE_TEXTURE_UNIT+c),b.bindTexture(3553,null),(e=this._textureUnitMap[c])&&b.bindTexture(e.descriptor.target,e.glName);b.activeTexture(a.BASE_TEXTURE_UNIT+this._activeTextureUnit);b.viewport(this._viewport.x,this._viewport.y,this._viewport.width,this._viewport.height)};c._bindBuffer=
function(a,b,c,d){if(!b)return a.bindBuffer(c,null),null;if(d===b)return d;a.bindBuffer(c,b.glName);return b};c._MAX_TEXTURE_IMAGE_UNITS=-1;return c}()})},"esri/views/webgl/enums":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.BASE_TEXTURE_UNIT=33984})},"esri/views/webgl/InstanceCounter":function(){define(["require","exports"],function(n,g){return function(){function c(){this._instanceCount={textureCount:0,bufferCount:0,vaoCount:0,programCount:0,
framebufferCount:0,renderBufferCount:0}}c.prototype.incrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount++;break;case 1:this._instanceCount.bufferCount++;break;case 2:this._instanceCount.vaoCount++;break;case 3:this._instanceCount.programCount++;break;case 4:this._instanceCount.framebufferCount++;break;case 5:this._instanceCount.renderBufferCount++}};c.prototype.decrementCount=function(a){switch(a){case 0:this._instanceCount.textureCount--;break;case 1:this._instanceCount.bufferCount--;
break;case 2:this._instanceCount.vaoCount--;break;case 3:this._instanceCount.programCount--;break;case 4:this._instanceCount.framebufferCount--;break;case 5:this._instanceCount.renderBufferCount--}};c.prototype.printResourceCount=function(){console.log("Live objects:");console.log("Textures: "+this._instanceCount.textureCount);console.log("Buffers: "+this._instanceCount.bufferCount);console.log("VAOs: "+this._instanceCount.vaoCount);console.log("Programs: "+this._instanceCount.programCount);console.log("Framebuffers: "+
this._instanceCount.framebufferCount);console.log("Renderbuffers: "+this._instanceCount.renderBufferCount)};return c}()})},"esri/views/webgl/capabilities/load":function(){define("require exports ./DisjointTimerQuery ./Instancing ./isWebGL2Context ./VertexArrayObjects".split(" "),function(n,g,c,a,f,b){function l(a,b,c,k,d){if(k&&f.default(a))return!0;if(b[c])return!1;for(b=0;b<d.length;b++)if(a.getExtension(d[b]))return!0;return!1}Object.defineProperty(g,"__esModule",{value:!0});g.loadCapabilities=
function(e,h){h=h&&h.disabledExtensions||{};l(e,h,"standardDerivatives",!0,["OES_standard_derivatives"]);var g=a.load(e),k=b.load(e,h),d;d=h.compressedTextureS3TC?null:(d=e.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:d.COMPRESSED_RGB_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT1:d.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:d.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:d.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null;var q;q=h.textureFilterAnisotropic?null:(q=e.getExtension("EXT_texture_filter_anisotropic")||
e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:q.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:q.TEXTURE_MAX_ANISOTROPY_EXT}:null;var p=c.load(e,h),r;if(f.default(e))r=h.colorBufferFloat||!e.getExtension("EXT_color_buffer_float")?null:{R16F:e.R16F,RG16F:e.RG16F,RGBA16F:e.RGBA16F,R32F:e.R32F,RG32F:e.RG32F,RGBA32F:e.RGBA32F,R11F_G11F_B10F:e.R11F_G11F_B10F};else if(e instanceof WebGLRenderingContext){r=
!h.colorBufferFloat&&e.getExtension("EXT_color_buffer_half_float");var u=!h.colorBufferFloat&&e.getExtension("WEBGL_color_buffer_float");r=r||u?{RGBA16F:r?r.RGBA16F_EXT:void 0,RGBA32F:u?u.RGBA32F_EXT:void 0}:null}else r=void 0;u=f.default(e)?{MIN:e.MIN,MAX:e.MAX}:h.blendMinMax?null:(u=e.getExtension("EXT_blend_minmax"))?{MIN:u.MIN_EXT,MAX:u.MAX_EXT}:null;return{instancing:g,vao:k,compressedTextureS3TC:d,textureFilterAnisotropic:q,disjointTimerQuery:p,colorBufferFloat:r,blendMinMax:u,depthTexture:l(e,
h,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]),standardDerivatives:!0,shaderTextureLOD:l(e,h,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]),textureFloatLinear:l(e,h,"textureFloatLinear",!1,["OES_texture_float_linear"]),fragDepth:l(e,h,"fragDepth",!0,["EXT_frag_depth"])}}})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["require","exports","./isWebGL2Context"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});
g.load=function(a,f){if(f.disjointTimerQuery)return null;var b=a.getExtension("EXT_disjoint_timer_query")||a.getExtension("EXT_disjoint_timer_query_webgl2");return b?c.default(a)?{createQuery:function(){return a.createQuery()},resultAvailable:function(b){return a.getQueryParameter(b,a.QUERY_RESULT_AVAILABLE)},getResult:function(b){return a.getQueryParameter(b,a.QUERY_RESULT)},disjoint:function(){return a.getParameter(b.GPU_DISJOINT_EXT)},beginTimeElapsed:function(c){return a.beginQuery(b.TIME_ELAPSED_EXT,
c)},endTimeElapsed:function(){return a.endQuery(b.TIME_ELAPSED_EXT)},createTimestamp:function(a){return b.queryCounterEXT(a,b.TIMESTAMP_EXT)},timestampBits:function(){return a.getQuery(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:{createQuery:function(){return b.createQueryEXT()},resultAvailable:function(a){return b.getQueryObjectEXT(a,b.QUERY_RESULT_AVAILABLE_EXT)},getResult:function(a){return b.getQueryObjectEXT(a,b.QUERY_RESULT_EXT)},disjoint:function(){return a.getParameter(b.GPU_DISJOINT_EXT)},
beginTimeElapsed:function(a){return b.beginQueryEXT(b.TIME_ELAPSED_EXT,a)},endTimeElapsed:function(){return b.endQueryEXT(b.TIME_ELAPSED_EXT)},createTimestamp:function(a){return b.queryCounterEXT(a,b.TIMESTAMP_EXT)},timestampBits:function(){return b.getQueryEXT(b.TIMESTAMP_EXT,b.QUERY_COUNTER_BITS_EXT)}}:null}})},"esri/views/webgl/capabilities/Instancing":function(){define(["require","exports","./isWebGL2Context"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.load=function(a){return c.default(a)?
{drawArraysInstanced:a.drawArraysInstanced.bind(a),drawElementsInstanced:a.drawElementsInstanced.bind(a),vertexAttribDivisor:a.vertexAttribDivisor.bind(a)}:(a=a.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:a.drawArraysInstancedANGLE.bind(a),drawElementsInstanced:a.drawElementsInstancedANGLE.bind(a),vertexAttribDivisor:a.vertexAttribDivisorANGLE.bind(a)}:null}})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["require","exports","./isWebGL2Context"],function(n,
g,c){Object.defineProperty(g,"__esModule",{value:!0});g.load=function(a,f){return c.default(a)?{createVertexArray:a.createVertexArray.bind(a),deleteVertexArray:a.deleteVertexArray.bind(a),bindVertexArray:a.bindVertexArray.bind(a)}:f.vao?null:(a=a.getExtension("OES_vertex_array_object")||a.getExtension("MOZ_OES_vertex_array_object")||a.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:a.createVertexArrayOES.bind(a),deleteVertexArray:a.deleteVertexArrayOES.bind(a),bindVertexArray:a.bindVertexArrayOES.bind(a)}:
null}})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/Logger ../../../../core/scheduling ./constants ./ElevationContext ./featureExpressionInfoUtils ./Graphics3DSymbolCommonCode ./graphicUtils ../../support/mathUtils ../../support/PromiseLightweight".split(" "),function(n,g,c,a,f,b,l,e,h,m,k,d,q){function p(a,b){a=null!=a?b.attributes[a]:0;return null!=a&&isFinite(a)?a:0}var r=new e,
u=f.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer"),t={mode:"on-the-ground",offset:0,unit:"meters"},v={mode:"absolute-height",offset:0,unit:"meters"};return function(f){function g(a,b,c,d){var h=f.call(this)||this;h._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};h.symbolContainer=a;h.symbol=b;h._context=c;h._symbolLayerOrder=c.layerOrder;h._symbolLayerOrderDelta=c.layerOrderDelta;h._elevationContext=new e;h._material=null;h._geometryCreationWarningHandle=null;
h._updateDrivenProperties(d);h._updateElevationContext();h._prepareResources();return h}c(g,f);g.prototype._logWarning=function(a){u.warn(a)};g.prototype._logGeometryCreationWarnings=function(a,c,d,e){var f=this;if(null==this._geometryCreationWarningHandle){var h=a.geometryData&&a.geometryData.polygons;e+=" geometry failed to be created";var k=null;a.projectionSuccess?!c.length||1===c.length&&!c[0].length?k=e+" (no "+d+" were defined)":Array.isArray(c)&&Array.isArray(c[0])?c.some(function(a){return 1===
a.length})?k=e+" ("+d+" should contain at least 2 vertices)":h&&0===h.length&&"rings"===d&&(k=e+" (filled "+d+" should use clockwise winding - try reversing the order of vertices)"):k=e+" ("+d+" should be defined as a 2D array)":k=e+" (failed to project geometry to view spatial reference)";k&&(this._geometryCreationWarningHandle=b.schedule(function(){return f._onNextTick()}),this._logWarning(k))}};g.prototype._onNextTick=function(){this._geometryCreationWarningHandle=null};g.prototype._validateGeometry=
function(a){return"point"!==a.type||d.isFinite(a.x)&&d.isFinite(a.y)?!0:(this._logWarning("point coordinate is not a valid number, graphic skipped"),!1)};g.prototype._prepareResources=function(a){throw Error("This is an abstract base class");};g.prototype._defaultElevationInfoNoZ=function(){return t};g.prototype._defaultElevationInfoZ=function(){return v};g.prototype._updateElevationContext=function(){this._elevationContext.setDefaults();var a=this._context.layer.elevationInfo;a&&this._elevationContext.mixinApi(a);
(a=this.symbol&&this.symbol.elevationInfo)&&this._elevationContext.mixinApi(a);this._elevationContext.featureExpressionInfoContext=this._context.featureExpressionInfoContext};g.prototype.getGraphicElevationContext=function(a){var b=a.geometry.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ();r.setUnit(null!=this._elevationContext.unit?this._elevationContext.unit:b.unit);r.mode=this._elevationContext.mode||b.mode;r.setOffsetMeters(null!=this._elevationContext.meterUnitOffset?this._elevationContext.meterUnitOffset:
b.offset);r.featureExpressionInfoContext=this._elevationContext.featureExpressionInfoContext;r.hasOffsetAdjustment=!1;this._elevationOptions.supportsOnTheGround||"on-the-ground"!==r.mode||(r.mode="relative-to-ground",r.setOffsetMeters(0),r.featureExpressionInfoContext=h.zeroContext);b=h.createFeature(a,this._context.layer);h.setContextFeature(r.featureExpressionInfoContext,b);m.needsOffsetAdjustment(r,this._elevationOptions,a.geometry,this.symbolContainer)&&(r.setOffsetRenderUnits(l.defaultIconElevationOffset),
r.hasOffsetAdjustment=!0);return r};g.prototype._getDrapedZ=function(){return-2};g.prototype._updateDrivenProperties=function(a){var b={color:!1,opacity:!1,size:!1};!a&&(a=this._context.renderer)&&(b.color=!!a.colorInfo,b.size=!!a.sizeInfo,a.visualVariables&&a.visualVariables.forEach(function(a){switch(a.type){case "color":b.color=!0;if(a.colors)for(var c=0;c<a.colors.length;c++){var d=a.colors[c];d&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0)}if(a.stops)for(c=
0;c<a.stops.length;c++)(d=a.stops[c].color)&&(Array.isArray(d)&&3<d.length&&255!==d[3]||void 0!==d.a&&255!==d.a)&&(b.opacity=!0);break;case "opacity":b.opacity=!0;break;case "size":b.size=!0}}));this._drivenProperties=b};g.prototype._isPropertyDriven=function(a){return this._drivenProperties[a]};g.prototype._getLayerOpacity=function(){if(this._context.layerView&&"fullOpacity"in this._context.layerView)return this._context.layerView.fullOpacity;var a=this._context.layer.opacity;return null==a?1:a};
g.prototype._getMaterialOpacity=function(){var a;a=1*this._getLayerOpacity();var b=this.symbol&&this.symbol.material;b&&!this._isPropertyDriven("opacity")&&b.color&&(a*=b.color.a);return a};g.prototype._getMaterialOpacityAndColor=function(){var b=this.symbol&&this.symbol.material,c=this._getMaterialOpacity(),b=!this._isPropertyDriven("color")&&b&&b.color?a.toUnitRGB(b.color):null;return k.mixinColorAndOpacity(b,c)};g.prototype._getVertexOpacityAndColor=function(a,b,c){var d=this._isPropertyDriven("color")?
a.color:null;a=this._isPropertyDriven("opacity")?a.opacity:null;d=k.mixinColorAndOpacity(d,a);c&&(d[0]*=c,d[1]*=c,d[2]*=c,d[3]*=c);return b?new b(d):d};g.prototype._getStageIdHint=function(){return this._context.layer.id+"_symbol"};g.prototype.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};g.prototype.updateSymbolLayerOrder=function(a,b){this._symbolLayerOrder=a;this._symbolLayerOrderDelta=b};g.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,
b);this._material&&(this._material.renderPriority=a,c.add(this._material.id))};g.prototype.createGraphics3DGraphic=function(a){for(var b=1;b<arguments.length;b++);throw Error("This is an abstract base class");};g.prototype.destroy=function(){this._geometryCreationWarningHandle&&(this._geometryCreationWarningHandle.remove(),this._geometryCreationWarningHandle=null)};g.prototype.layerPropertyChanged=function(a,b,c){return!1};g.prototype.applyRendererDiff=function(a,b,c,d){return!1};g.prototype.getFastUpdateAttrValues=
function(a){if(!this._fastUpdates.enabled)return null;var b=this._fastUpdates.visualVariables,c=b.size?p(b.size.field,a):0;a=b.color?p(b.color.field,a):0;return[c,a,0,0]};return g}(q.Promise)})},"esri/views/3d/layers/graphics/constants":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.defaultIconElevationOffset=1;g.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("require exports ./BoundingInfo ./ComponentUtils ./geometryDataUtils ./IdGen ./Util ./Util".split(" "),
function(n,g,c,a,f,b,l,e){return function(){function h(a,b,c){this.singleUse=!1;this._componentAABB=this._boundingInfo=null;this.id=h.__idGen.gen(b);this._data=a;this._boundingInfo=c}Object.defineProperty(h.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"componentCount",{get:function(){return a.componentCount(this.data.componentOffsets)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"boundingInfo",{get:function(){null==
this._boundingInfo&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo},enumerable:!0,configurable:!0});h.prototype.invalidateBoundingInfo=function(){this._boundingInfo=null};h.prototype.getComponentAABB=function(a,b){null==this._componentAABB&&(this._componentAABB=this._computeComponentAABB());for(var c=0;6>c;c++)b[c]=this._componentAABB[6*a+c];return b};h.prototype._computeComponentAABB=function(){for(var a=this.componentCount,b=new Float32Array(6*a),c=0;c<a;c++)this._calculateAABB(c,
b,6*c);return b};h.prototype._calculateAABB=function(a,b,c){void 0===c&&(c=0);var d=this.data.getIndices(e.VertexAttrConstants.POSITION),f=this.data.getAttribute(e.VertexAttrConstants.POSITION),h=this.data.componentOffsets,k=h.length?h[a+1]:d.length,l=Infinity,g=Infinity,m=Infinity,z=-Infinity,x=-Infinity,B=-Infinity,n=f.offsetIdx,C=f.strideIdx;for(a=h.length?h[a]:0;a<k;a++)var G=n+C*d[a],h=f.data[G],E=f.data[G+1],G=f.data[G+2],l=Math.min(l,h),g=Math.min(g,E),m=Math.min(m,G),z=Math.max(z,h),x=Math.max(x,
E),B=Math.max(B,G);b?(b[c]=l,b[c+1]=g,b[c+2]=m,b[c+3]=z,b[c+4]=x,b[c+5]=B):b=[l,g,m,z,x,B];return b};h.prototype._calculateBoundingInfo=function(){var a=this.data.getIndices(e.VertexAttrConstants.POSITION),b=this.data.getAttribute(e.VertexAttrConstants.POSITION),d="triangle"===this.data.primitiveType?3:1;if(0===a.length)for(var a=new Uint32Array(d),h=0;h<d;++h)a[h]=h;h=a.length;l.assert(0===h%d);h=f.generateDefaultIndexArray(h/d);return new c(h,d,a,b)};h.__idGen=new b;return h}()})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["require",
"exports","../../../../core/PooledArray","../../lib/gl-matrix","./Util"],function(n,g,c,a,f){n=function(){function c(c,h,l,k){f.assert(1<=c.length);f.assert(0===l.length%h);f.assert(l.length>=c.length*h);f.assert(3===k.size||4===k.size);this.primitiveIndices=c;this.indices=l;this._position=k;this._numIndexPerPrimitive=h;var d=k.data,e=k.offsetIdx,g=k.strideIdx;k=0;var m=c.length,u=e+g*l[h*c[k]];b.clear();b.push(u);this.bbMin=a.vec3d.createFrom(d[u],d[u+1],d[u+2]);for(this.bbMax=a.vec3d.create(this.bbMin);k<
m;++k)for(var t=h*c[k],v=0;v<h;++v){u=e+g*l[t+v];b.push(u);var A=d[u];this.bbMin[0]=Math.min(A,this.bbMin[0]);this.bbMax[0]=Math.max(A,this.bbMax[0]);A=d[u+1];this.bbMin[1]=Math.min(A,this.bbMin[1]);this.bbMax[1]=Math.max(A,this.bbMax[1]);A=d[u+2];this.bbMin[2]=Math.min(A,this.bbMin[2]);this.bbMax[2]=Math.max(A,this.bbMax[2])}this.center=a.vec3d.create();a.vec3d.lerp(this.bbMin,this.bbMax,.5,this.center);this.bsRadius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),this.bbMax[2]-
this.bbMin[2]);c=this.bsRadius*this.bsRadius;for(k=0;k<b.length;++k)u=b.data[k],h=d[u]-this.center[0],l=d[u+1]-this.center[1],u=d[u+2]-this.center[2],e=h*h+l*l+u*u,e<=c||(e=Math.sqrt(e),g=.5*(e-this.bsRadius),this.bsRadius+=g,c=this.bsRadius*this.bsRadius,e=g/e,this.center[0]+=h*e,this.center[1]+=l*e,this.center[2]+=u*e);b.clear()}c.prototype.getCenter=function(){return this.center};c.prototype.getBSRadius=function(){return this.bsRadius};c.prototype.getBBMin=function(){return this.bbMin};c.prototype.getBBMax=
function(){return this.bbMax};c.prototype.getPrimitiveIndices=function(){return this.primitiveIndices};c.prototype.getIndices=function(){return this.indices};c.prototype.getPosition=function(){return this._position};c.prototype.getChildren=function(){if(this.children)return this.children;if(1<a.vec3d.dist2(this.bbMin,this.bbMax)){for(var b=a.vec3d.lerp(this.bbMin,this.bbMax,.5,a.vec3d.create()),f=this.primitiveIndices.length,l=new Uint8Array(f),k=Array(8),d=0;8>d;++d)k[d]=0;for(var d=this._position,
g=d.data,p=d.offsetIdx,r=d.strideIdx,d=0;d<f;++d){for(var u=0,t=this._numIndexPerPrimitive*this.primitiveIndices[d],v=p+r*this.indices[t],A=g[v],z=g[v+1],x=g[v+2],B=1;B<this._numIndexPerPrimitive;++B){var v=p+r*this.indices[t+B],n=g[v],C=g[v+1],v=g[v+2];n<A&&(A=n);C<z&&(z=C);v<x&&(x=v)}A<b[0]&&(u|=1);z<b[1]&&(u|=2);x<b[2]&&(u|=4);l[d]=u;++k[u]}for(d=b=0;8>d;++d)0<k[d]&&++b;if(2>b)return;b=Array(8);for(d=0;8>d;++d)b[d]=0<k[d]?new Uint32Array(k[d]):void 0;for(d=0;8>d;++d)k[d]=0;for(d=0;d<f;++d)u=l[d],
b[u][k[u]++]=this.primitiveIndices[d];this.children=Array(8);for(d=0;8>d;++d)void 0!==b[d]&&(this.children[d]=new c(b[d],this._numIndexPerPrimitive,this.indices,this._position))}return this.children};return c}();var b=new c;return n})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/LineCalloutPrograms".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k){function d(a,b,c){3===c.length?a.setUniform4f(b,c[0],c[1],c[2],1):a.setUniform4fv(b,c)}n=function(a){function b(c,d){d=a.call(this,d)||this;d.bufferWriter=new t;d.params=m.copyParameters(c,p);d._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(d.params);return d}c(b,a);Object.defineProperty(b.prototype,"uniqueMaterialIdentifier",{get:function(){return this._uniqueMaterialIdentifier},enumerable:!0,configurable:!0});b.prototype.dispose=function(){};b.prototype.getGLMaterials=
function(){return{color:q,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:void 0}};b.prototype.getAllTextureIds=function(){return[]};b.prototype.intersect=function(a,b,c,d,e,f,h,k){};b.prototype.getParameterValues=function(){return m.copyParameters(this.params)};b.prototype.setParameterValues=function(a){m.updateParameters(this.params,a)&&(this._uniqueMaterialIdentifier=b.uniqueMaterialIdentifier(this.params),this.notifyDirty("matChanged"))};b.uniqueMaterialIdentifier=function(a){return JSON.stringify({screenOffset:a.screenOffset||
[0,0],centerOffsetUnits:a.centerOffsetUnits||"world"})};return b}(b);var q=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.isRenderSlot=!0;b.updateParameters();return b}c(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){var a=this.params;this.renderProgram=this.programRep.getProgram(k.program,{occlTest:!!a.occlusionTest,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,
depthHud:!1,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled});this.depthProgram=this.programRep.getProgram(k.program,{occlTest:!!a.occlusionTest,verticalOffset:!!a.verticalOffset,screenSizePerspective:!!a.screenSizePerspective,depthHud:!0,depthHudAlignStart:!!a.depthHUDAlignStart,centerOffsetUnitsScreen:"screen"===a.centerOffsetUnits,slice:a.slicePlaneEnabled})};b.prototype.beginSlot=function(a){switch(a){case l.LINE_CALLOUTS:return this.isRenderSlot=
!0;case l.LINE_CALLOUTS_HUD_DEPTH:return this.isRenderSlot=!1,!0}return!1};Object.defineProperty(b.prototype,"program",{get:function(){return this.isRenderSlot?this.renderProgram:this.depthProgram},enumerable:!0,configurable:!0});b.prototype.getProgram=function(){return this.program};b.prototype.getPrograms=function(){return[this.renderProgram,this.depthProgram]};b.prototype.getDrawMode=function(a){return 4};b.prototype.bind=function(a,b){var c=b.cameraAboveGround?1:-1,e=this.program,f=this.params;
a.bindProgram(e);e.setUniform1f("cameraGroundRelative",c);e.setUniform1f("polygonOffset",f.shaderPolygonOffset);e.setUniform4fv("viewport",b.viewport);e.setUniformMatrix4fv("viewNormal",b.viewInvTransp);e.setUniform1i("hudVisibilityTexture",0);a.bindTexture(b.hudVisibilityTexture,0);d(e,"color",f.color);c=b.pixelRatio||1;e.setUniform1f("pixelRatio",c);e.setUniform2f("screenOffset",f.screenOffset[0]*c,f.screenOffset[1]*c);this.bindBorder(a,b);m.bindVerticalOffset(f.verticalOffset,b,e);this.bindSizing(a,
b);m.bindScreenSizePerspective(f.screenSizePerspective,b,e);this.isRenderSlot?this.bindRender(a,b):this.bindHUDDepth(a,b)};b.prototype.bindRender=function(a,b){a.setBlendFunctionSeparate(1,771,770,771);a.setBlendingEnabled(!0);a.setDepthWriteEnabled(!1)};b.prototype.bindHUDDepth=function(a,b){a.setColorMask(!1,!1,!1,!1);a.setDepthWriteEnabled(!0);a.setBlendingEnabled(!1);a.setDepthTestEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;m.bindView(b.origin,b.view,a);m.bindCamPos(b.origin,
b.viewInvTransp,a);c.slicePlaneEnabled&&m.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.release=function(a,b){this.isRenderSlot?this.releaseRender(a,b):this.releaseHUDDepth(a,b)};b.prototype.releaseRender=function(a,b){a.setBlendingEnabled(!1);a.setBlendFunction(770,771);a.setDepthWriteEnabled(!0)};b.prototype.releaseHUDDepth=function(a,
b){a.setColorMask(!0,!0,!0,!0)};b.prototype.bindSizing=function(a,b){a=this.program;var c=this.params;a.setUniform2f("pixelToNDC",2/b.viewport[2],2/b.viewport[3]);a.setUniform1f("lineSize",Math.ceil(c.size)*(b.pixelRatio||1))};b.prototype.bindBorder=function(a,b){a=this.program;var c=this.params;b=b.pixelRatio||1;null!==c.borderColor?(d(a,"borderColor",c.borderColor),a.setUniform1f("borderSize",b)):(a.setUniform4f("borderColor",0,0,0,0),a.setUniform1f("borderSize",0))};return b}(f),p={verticalOffset:null,
screenSizePerspective:null,screenOffset:[0,0],color:[0,0,0,1],size:1,borderColor:null,occlusionTest:!1,shaderPolygonOffset:1E-5,depthHUDAlignStart:!1,centerOffsetUnits:"world",slicePlaneEnabled:!1},r=a.newLayout().vec3f(e.VertexAttrConstants.POSITION).vec3f(e.VertexAttrConstants.NORMAL).vec2f(e.VertexAttrConstants.UV0).vec4f(e.VertexAttrConstants.AUXPOS1),u=[[0,0],[1,0],[0,1],[1,0],[1,1],[0,1]],t=function(){function a(){this.vertexBufferLayout=r}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};
a.prototype.elementCount=function(a){return 6*a.indices[e.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d,f){h.writePosition(b.indices[e.VertexAttrConstants.POSITION],b.vertexAttr[e.VertexAttrConstants.POSITION].data,a.transformation,d.position,f,6);h.writeNormal(b.indices[e.VertexAttrConstants.NORMAL],b.vertexAttr[e.VertexAttrConstants.NORMAL].data,a.invTranspTransformation,d.normal,f,6);h.writeBufferVec4(b.indices[e.VertexAttrConstants.AUXPOS1],b.vertexAttr[e.VertexAttrConstants.AUXPOS1].data,
d.auxpos1,f,6);for(a=0;a<u.length;++a)d.uv0.setVec(f+a,u[a])};return a}();return n})},"esri/views/3d/webgl-engine/shaders/LineCalloutPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b=function(a){return f.glslifyDefineMap({OCCL_TEST:a.occlTest,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,DEPTH_HUD:a.depthHud,
DEPTH_HUD_ALIGN_START:a.depthHudAlignStart,CENTER_OFFSET_UNITS_SCREEN:a.centerOffsetUnitsScreen,SLICE:a.slice})};g.program={name:"line-callout",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/lineCallout/lineCallout.vert"),fragmentShader:b(c)+a.resolveIncludes("materials/lineCallout/lineCallout.frag")}},attributes:c.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","../../support/PromiseLightweight"],
function(n,g,c,a){return function(a){function b(b,c){var e=a.call(this)||this;e.symbol=b;e.graphics3DSymbol=null;b.fetchSymbol().then(function(a){if(e.isRejected())throw Error();a.id=e.symbol.id;e.graphics3DSymbol=c(a)}).then(function(){if(e.isRejected())throw Error();e.graphics3DSymbol.then(function(){e.isRejected()||e.resolve()},function(a){e.isRejected()||e.reject(a)})}).catch(function(a){e.isRejected()||e.reject(a)});return e}c(b,a);b.prototype.createGraphics3DGraphic=function(a){return this.graphics3DSymbol.createGraphics3DGraphic(a,
this)};Object.defineProperty(b.prototype,"numberOfVertices",{get:function(){return this.graphics3DSymbol?this.graphics3DSymbol.numberOfVertices:0},enumerable:!0,configurable:!0});b.prototype.layerPropertyChanged=function(a,b){return this.graphics3DSymbol.layerPropertyChanged(a,b)};b.prototype.applyRendererDiff=function(a,b,c){return this.graphics3DSymbol.applyRendererDiff(a,b,c)};b.prototype.getFastUpdateStatus=function(){return this.graphics3DSymbol?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,
fast:0,slow:0}};b.prototype.setDrawOrder=function(a,b){if(this.graphics3DSymbol)return this.graphics3DSymbol.setDrawOrder(a,b)};b.prototype.destroy=function(){this.isFulfilled()||this.reject();this.graphics3DSymbol&&this.graphics3DSymbol.destroy()};return b}(a.Promise)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("require exports ../../../../core/Logger ../../../../core/scheduling ./Graphics3DWebStyleSymbol ../../lib/gl-matrix ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,g,c,a,f,b,l){function e(a,c){switch(c.graphics3DGraphic.graphic.geometry.type){case "polyline":case "polygon":case "extent":case "multipoint":a.anchor="center";break;case "point":var d=c.graphics3DGraphic,e=m(d.graphics3DSymbol).symbol.symbolLayers.getItemAt(0),d=d.getCenterObjectSpace();b.vec3d.set(d,a.translation);switch(e.type){case "icon":case "text":d=c.graphics3DGraphic;e=d._graphics[0].getScreenSize();d.isDraped()?a.hasLabelVerticalOffset||(a.anchor="center"):(d=void 0,void 0===
d&&(d=A),c=c.graphics3DGraphic._graphics[0].stageObject.getGeometryRecords()[0].materials[0],c instanceof l?(c=c.getParams().anchorPos,d[0]=2*(c[0]-.5),d[1]=2*(c[1]-.5)):(d[0]=0,d[1]=0),c=d,v[0]=e[0]/2*(a.normalizedOffset[0]-c[0]),v[1]=e[1]/2*(a.normalizedOffset[1]-c[1]),a.screenOffset[0]=v[0],a.hasLabelVerticalOffset?(a.centerOffset[1]=v[1],a.centerOffsetUnits="screen"):a.screenOffset[1]=v[1]);break;case "object":h(a,c)}break;case "mesh":h(a,c)}}function h(a,c){c=c.graphics3DGraphic._graphics[0].getBoundingBoxObjectSpace();
c=[c[3]-c[0],c[4]-c[1],c[5]-c[2]];a.centerOffset[0]=1.1*Math.max(c[0],c[1])/2*a.normalizedOffset[0];var d=c[2]/2*a.normalizedOffset[1]+a.translation[2];a.translation[2]=d*(1.1-1);a.elevationOffset=d;c=b.vec3d.length(c);a.centerOffset[2]=1.1*c/2*a.normalizedOffset[2]}function m(a){return a instanceof f?a.graphics3DSymbol:a}function k(a,b){var c=b.labelSymbol;b=b.graphics3DGraphic;var e=m(b.graphics3DSymbol).symbol;if("point-3d"===e.type&&e.supportsCallout()&&e.hasVisibleVerticalOffset()&&!b.isDraped())a.verticalOffset=
d(e.verticalOffset);else if(c&&c.hasVisibleVerticalOffset()&&("point-3d"!==e.type||!e.supportsCallout()||!e.verticalOffset||b.isDraped())){a:switch(a.placement){case "above-center":b=!0;break a;default:b=!1}b?(a.verticalOffset=d(c.verticalOffset),a.anchor="bottom",a.normalizedOffset=[0,a.normalizedOffset[1],0],a.hasLabelVerticalOffset=!0):(q.error("verticalOffset","Callouts and vertical offset on labels are currently only supported with above-center label placement (not with "+a.placement+" placement)"),
a.isValid=!1)}}function d(a){return{screenLength:a.screenLength,minWorldLength:a.minWorldLength,maxWorldLength:a.maxWorldLength}}Object.defineProperty(g,"__esModule",{value:!0});var q=c.getLogger("esri.views.3d.layers.graphics.labelPlacement"),p=null;g.get=function(b){var c=b.labelClass.labelPlacement,d=r[c];d||(null!=c&&null==p&&(q.warn("labelPlacement","'"+c+"' is not a valid label placement"),p=a.schedule(function(){p.remove();p=null})),d=r["default"]);var c=b.graphics3DGraphic._graphics[0],f=
c.graphics3DSymbolLayer.getGraphicElevationContext(b.graphics3DGraphic.graphic),d={placement:d.placement,anchor:d.anchor,normalizedOffset:d.normalizedOffset,needsOffsetAdjustment:"draped"===c.type?void 0:f.hasOffsetAdjustment,verticalOffset:null,screenOffset:[0,0],centerOffset:[0,0,0,-1],centerOffsetUnits:"world",translation:[0,0,0],elevationOffset:0,hasLabelVerticalOffset:!1,isValid:!0};k(d,b);e(d,b);return d};var r={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},
"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},
"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}},u={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],
"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};n=function(a){var b=r[a];u[a].forEach(function(a){r[a]=b})};for(var t in u)n(t);Object.freeze&&(Object.freeze(r),Object.keys(r).forEach(function(a){Object.freeze(r[a]);Object.freeze(r[a].normalizedOffset)}));var v=[0,0],A=[0,0]})},"esri/views/3d/webgl-engine/lib/Layer":function(){define("require exports ../../../../core/arrayUtils ../../lib/gl-matrix ./IdGen ./ModelContentType ./Octree".split(" "),
function(n,g,c,a,f,b,l){return function(){function e(b,c,f){this._parentStages=[];this._children=new Set;this.id=e._idGen.gen(f);this.name=b;c=c||{};this.group=c.group||"";this.isPickable=null!=c.isPickable?c.isPickable:!0;this.translation=a.vec3d.create(c.translation);this._extent=[a.vec3d.createFrom(0,0,0),a.vec3d.createFrom(1E3,1E3,1E3)];this._extentDirty=!0}e.prototype.getParentStages=function(){return this._parentStages};e.prototype.addParentStage=function(a){-1===this._parentStages.indexOf(a)&&
this._parentStages.push(a)};e.prototype.removeParentStage=function(a){a=this._parentStages.indexOf(a);-1<a&&this._parentStages.splice(a,1)};e.prototype.getName=function(){return this.name};e.prototype.getGroup=function(){return this.group};e.prototype.getTranslation=function(){return this.translation};e.prototype.getObjectIds=function(){return c.keysOfSet(this._children,function(a){return a.id})};e.prototype.getObjects=function(){return c.keysOfSet(this._children)};e.prototype.getExtent=function(){this._updateExtent();
return this._extent};e.prototype.addObject=function(a){this._children.add(a);a.addParentLayer(this);this.notifyDirty("layObjectAdded",a);this._invalidateExtent();this._octree&&this._octree.add(a)};e.prototype.hasObject=function(a){return this._children.has(a)};e.prototype.removeObject=function(a){return this._children.delete(a)?(a.removeParentLayer(this),this.notifyDirty("layObjectRemoved",a),this._invalidateExtent(),this._octree&&this._octree.remove(a),!0):!1};e.prototype.notifyObjectBBChanged=function(a,
b){this._octree&&this._octree.update(a,b)};e.prototype.getCenter=function(){this._updateExtent();var b=a.vec3d.create();return a.vec3d.lerp(this._extent[0],this._extent[1],.5,b)};e.prototype.getBSRadius=function(){this._updateExtent();return.5*a.vec3d.dist(this._extent[0],this._extent[1])};e.prototype.getSpatialQueryAccelerator=function(){!this._octree&&50<this._children.size&&this._createOctree();return this._octree};e.prototype.shaderTransformationChanged=function(){this.notifyDirty("shaderTransformationChanged",
null)};e.prototype.invalidateSpatialQueryAccelerator=function(){this._octree=null};e.prototype.notifyDirty=function(a,c,e,d){e=e||b.LAYER;d=d||this;for(var f=0;f<this._parentStages.length;f++)this._parentStages[f].notifyDirty(e,d,a,c)};e.prototype._createOctree=function(){for(var b=this.getExtent(),e=0,f=0;3>f;f++)e=Math.max(e,b[1][f]-b[0][f]);f=a.vec3d.create();a.vec3d.lerp(b[0],b[1],.5,f);this._octree=new l(f,1.2*e,{getRadius:function(a){return a.getBSRadius()},getCenter:function(a){return a.getCenter()}});
this._octree.add(c.keysOfSet(this._children))};e.prototype._invalidateExtent=function(){this._extentDirty=!0};e.prototype._updateExtent=function(){var b=this;if(this._extentDirty)if(this._extentDirty=!1,0===this._children.size)this._extent=[[0,0,0],[0,0,0]];else{var c=null;this._children.forEach(function(e){var d=e.getBBMin();e=e.getBBMax();if(c)for(var f=0;3>f;++f)b._extent[0][f]=Math.min(b._extent[0][f],d[f]),b._extent[1][f]=Math.max(b._extent[1][f],e[f]);else c=[a.vec3d.create(d),a.vec3d.create(e)]});
this._extent=c}};e._idGen=new f;return e}()})},"esri/views/3d/webgl-engine/lib/Octree":function(){define(["require","exports","../../../../core/PooledArray","../../lib/gl-matrix","./Util"],function(n,g,c,a,f){function b(a,b,c){c=c||a;c[0]=a[0]+b;c[1]=a[1]+b;c[2]=a[2]+b;return c}function l(a,b,c){var d=a[0],e=a[1];a=a[2];return c[0][0]*d+c[0][1]*e+c[0][2]*a+c[0][3]>b||c[1][0]*d+c[1][1]*e+c[1][2]*a+c[1][3]>b||c[2][0]*d+c[2][1]*e+c[2][2]*a+c[2][3]>b||c[3][0]*d+c[3][1]*e+c[3][2]*a+c[3][3]>b||c[4][0]*
d+c[4][1]*e+c[4][2]*a+c[4][3]>b||c[5][0]*d+c[5][1]*e+c[5][2]*a+c[5][3]>b}function e(a,b,c){if(!F.length)for(var d=0;8>d;++d)F[d]={index:0,distance:0};for(d=0;8>d;++d){var e=q[d];F[d].index=d;F[d].distance=m(a,b,e)}F.sort(function(a,b){return a.distance-b.distance});for(d=0;8>d;++d)c[d]=F[d].index;return c}function h(a,b){for(var c=Infinity,d=null,e=0;8>e;++e){var f=m(a,b,p[e]);f<c&&(c=f,d=p[e])}return d}function m(a,b,c){return b*(a[0]*c[0]+a[1]*c[1]+a[2]*c[2])}n=function(){function g(b,c,d,e){this._maximumObjectsPerNode=
10;this._maximumDepth=20;this._degenerateObjects=new Set;this._objectCount=0;this._objectToBoundingSphere=d;e&&(void 0!==e.maximumObjectsPerNode&&(this._maximumObjectsPerNode=e.maximumObjectsPerNode),void 0!==e.maximumDepth&&(this._maximumDepth=e.maximumDepth));isNaN(b[0])||isNaN(b[1])||isNaN(b[2])||isNaN(c)?this._root=new k(null,a.vec3d.createFrom(0,0,0),.5):this._root=new k(null,b,c/2)}Object.defineProperty(g.prototype,"center",{get:function(){return this._root.center},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"size",{get:function(){return 2*this._root.halfSize},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"root",{get:function(){return this._root.node},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maximumObjectsPerNode",{get:function(){return this._maximumObjectsPerNode},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"maximumDepth",{get:function(){return this._maximumDepth},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"objectCount",{get:function(){return this._objectCount},enumerable:!0,configurable:!0});g.prototype.add=function(a,b){a=this._objectOrObjectsArray(a);b=null==b?a.length:b;this._objectCount+=b;this._grow(a);for(var c=k.acquire(),d=0;d<b;d++){var e=a[d];c.init(this._root);this._isDegenerate(e)?this._degenerateObjects.add(e):this._add(e,c)}k.release(c)};g.prototype.remove=function(a,b){a=this._objectOrObjectsArray(a);this._objectCount-=a.length;for(var c=k.acquire(),d=0;d<a.length;d++){var e=a[d],f=
b||this._boundingSphereFromObject(e,B);this._isValidRadius(f.radius)?(c.init(this._root),this._remove(e,f,c)):this._degenerateObjects.delete(e)}k.release(c);this._shrink()};g.prototype.update=function(a,b){if(this._isValidRadius(b.radius)||!this._isDegenerate(a))this.remove(a,b),this.add(a)};g.prototype.forEachAlongRay=function(a,b,c){var d=this;this._forEachNode(this._root,function(e){if(!d._intersectsNode(a,b,e))return!1;e=e.node;e.terminals.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});
null!==e.residents&&e.residents.forEach(function(e){d._intersectsObject(a,b,e)&&c(e)});return!0})};g.prototype.forEachDegenerateObject=function(a){this._degenerateObjects.forEach(a)};g.prototype.findClosest=function(a,b,c,e,f){return this._findClosest(a,"front-to-back"===b?d.FRONT_TO_BACK:d.BACK_TO_FRONT,c,e,f)};g.prototype.forEachInDepthRange=function(a,b,c,e,f,h,k,l){this._forEachInDepthRange(a,b,"front-to-back"===c?d.FRONT_TO_BACK:d.BACK_TO_FRONT,e,f,h,k,l)};g.prototype.forEachNode=function(a){this._forEachNode(this._root,
function(b){return a(b.node,b.center,2*b.halfSize)})};g.prototype._intersectsNode=function(a,c,d){b(d.center,2*-d.halfSize,A);b(d.center,2*d.halfSize,z);return f.rayBoxTest(a,c,A,z)};g.prototype._intersectsObject=function(a,b,c){var d=this._objectToBoundingSphere.getRadius(c);return 0<d?f.raySphere(a,b,this._objectToBoundingSphere.getCenter(c),d):!0};g.prototype._forEachNode=function(a,b){a=k.acquire().init(a);for(var c=[a];0!==c.length;){a=c.pop();if(b(a)&&!a.isLeaf())for(var d=0;d<a.node.children.length;d++)a.node.children[d]&&
c.push(k.acquire().init(a).advance(d));k.release(a)}};g.prototype._forEachNodeDepthOrdered=function(a,b,c,f){void 0===f&&(f=d.FRONT_TO_BACK);a=k.acquire().init(a);var h=[a];for(c=e(c,f,I);0!==h.length;){a=h.pop();if(b(a)&&!a.isLeaf())for(f=7;0<=f;--f){var l=c[f];l>=a.node.children.length||a.node.children[l]&&h.push(k.acquire().init(a).advance(l))}k.release(a)}};g.prototype._findClosest=function(b,c,d,e,f){var k=this,g=Infinity,q=Infinity,p=null,t=h(b,c),u=0,x=function(a){++u;if(!e||e(a)){var f=k._objectToBoundingSphere.getCenter(a),
h=k._objectToBoundingSphere.getRadius(a);if(!d||!l(f,h,d)){var f=m(b,c,f),t=f-h;t<g&&(g=t,q=f+h,p=a)}}};this._forEachNodeDepthOrdered(this._root,function(e){if(null!=f&&u>=f||d&&l(e.center,e.halfSize*r,d))return!1;a.vec3d.scale(t,e.halfSize,v);a.vec3d.add(v,e.center);if(m(b,c,v)>q)return!1;e=e.node;e.terminals.forEach(function(a){x(a)});null!==e.residents&&e.residents.forEach(function(a){x(a)});return!0},b,c);return p};g.prototype._forEachInDepthRange=function(b,c,e,f,k,g,q,p){var t=this,u=-Infinity,
x=Infinity,z={setRange:function(a){e===d.FRONT_TO_BACK?(u=Math.max(u,a.near),x=Math.min(x,a.far)):(u=Math.max(u,-a.far),x=Math.min(x,-a.near))}};z.setRange(f);var B=m(c,e,b),A=h(c,e),n=h(c,-1*e),D=0,C=function(a){++D;if(!q||q(a)){var b=t._objectToBoundingSphere.getCenter(a),d=t._objectToBoundingSphere.getRadius(a),f=m(c,e,b)-B;f-d>x||f+d<u||g&&l(b,d,g)||k(a,z)}};this._forEachNodeDepthOrdered(this._root,function(b){if(null!=p&&D>=p||g&&l(b.center,b.halfSize*r,g))return!1;a.vec3d.scale(A,b.halfSize,
v);a.vec3d.add(v,b.center);if(m(c,e,v)-B>x)return!1;a.vec3d.scale(n,b.halfSize,v);a.vec3d.add(v,b.center);if(m(c,e,v)-B<u)return!1;b=b.node;b.terminals.forEach(function(a){C(a)});null!==b.residents&&b.residents.forEach(function(a){C(a)});return!0},c,e)};g.prototype._objectOrObjectsArray=function(a){if(Array.isArray(a))return a;u[0]=a;return u};g.prototype._remove=function(a,b,c){x.length=0;b=c.advanceTo(b,function(a,b){x.push(a.node,b)})?c.node.terminals:c.node.residents;b.removeUnordered(a);if(0===
b.length)for(a=x.length-2;0<=a&&this._purge(x[a],x[a+1]);a-=2);};g.prototype._nodeIsEmpty=function(a){if(0!==a.terminals.length)return!1;if(null!==a.residents)return 0===a.residents.length;for(var b=0;b<a.children.length;b++)if(a.children[b])return!1;return!0};g.prototype._purge=function(a,b){0<=b&&(a.children[b]=null);return this._nodeIsEmpty(a)?(null===a.residents&&(a.residents=new c({shrink:!0})),!0):!1};g.prototype._add=function(a,b){b.advanceTo(this._boundingSphereFromObject(a,B))?b.node.terminals.push(a):
(b.node.residents.push(a),b.node.residents.length>this._maximumObjectsPerNode&&b.depth<this._maximumDepth&&this._split(b))};g.prototype._split=function(a){var b=a.node.residents;a.node.residents=null;for(var c=0;c<b.length;c++){var d=k.acquire().init(a);this._add(b.data[c],d);k.release(d)}};g.prototype._grow=function(b){var c=this;if(0!==b.length&&(b=this._boundingSphereFromObjects(b,function(a,b){return c._boundingSphereFromObject(a,b)},D),this._isValidRadius(b.radius)&&!this._fitsInsideTree(b)))if(this._nodeIsEmpty(this._root.node))a.vec3d.set(b.center,
this._root.center),this._root.halfSize=1.25*b.radius;else{var d=k.acquire();this._rootBoundsForRootAsSubNode(b,d);this._placingRootViolatesMaxDepth(d)?this._rebuildTree(b,d):this._growRootAsSubNode(d);k.release(d)}};g.prototype._rebuildTree=function(b,c){var d=this;a.vec3d.set(c.center,C.center);C.radius=c.halfSize;b=this._boundingSphereFromObjects([b,C],function(a){return a},G);c=k.acquire().init(this._root);this._root.initFrom(null,b.center,1.25*b.radius);this._forEachNode(c,function(a){d.add(a.node.terminals.data,
a.node.terminals.length);null!==a.node.residents&&d.add(a.node.residents.data,a.node.residents.length);return!0});k.release(c)};g.prototype._placingRootViolatesMaxDepth=function(a){var b=0;this._forEachNode(this._root,function(a){b=Math.max(b,a.depth);return!0});return b+Math.log(a.halfSize/this._root.halfSize)*Math.LOG2E>this._maximumDepth};g.prototype._rootBoundsForRootAsSubNode=function(a,b){var c=a.radius,d=a.center;a=-Infinity;for(var e=this._root.center,f=this._root.halfSize,h=0;3>h;h++){var k=
Math.max(0,Math.ceil((e[h]-f-(d[h]-c))/(2*f))),l=Math.max(0,Math.ceil((d[h]+c-(e[h]+f))/(2*f)))+1;a=Math.max(a,Math.pow(2,Math.ceil(Math.log(k+l)*Math.LOG2E)));E[h].min=k;E[h].max=l}for(h=0;3>h;h++)k=E[h].min,l=E[h].max,c=(a-(k+l))/2,k+=Math.ceil(c),l+=Math.floor(c),t[h]=e[h]-f-k*f*2+(l+k)*f;return b.initFrom(null,t,a*f,0)};g.prototype._growRootAsSubNode=function(b){var c=this._root.node;a.vec3d.set(this._root.center,D.center);D.radius=this._root.halfSize;this._root.init(b);b.advanceTo(D,null,!0);
b.node.children=c.children;b.node.residents=c.residents;b.node.terminals=c.terminals};g.prototype._shrink=function(){for(;;){var a=this._findShrinkIndex();if(-1===a)break;this._root.advance(a);this._root.depth=0}};g.prototype._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;for(var a=null,b=this._root.node.children,c=0,d=0;d<b.length&&null==a;)c=d++,a=b[c];for(;d<b.length;)if(b[d++])return-1;return c};g.prototype._isDegenerate=function(a){a=this._objectToBoundingSphere.getRadius(a);
return!this._isValidRadius(a)};g.prototype._isValidRadius=function(a){return!isNaN(a)&&-Infinity!==a&&Infinity!==a&&0<a};g.prototype._fitsInsideTree=function(a){var b=this._root.center,c=this._root.halfSize,d=a.center;return a.radius<=c&&d[0]>=b[0]-c&&d[0]<=b[0]+c&&d[1]>=b[1]-c&&d[1]<=b[1]+c&&d[2]>=b[2]-c&&d[2]<=b[2]+c};g.prototype._boundingSphereFromObject=function(b,c){a.vec3d.set(this._objectToBoundingSphere.getCenter(b),c.center);c.radius=this._objectToBoundingSphere.getRadius(b);return c};g.prototype._boundingSphereFromObjects=
function(b,c,d){if(1===b.length){var e=c(b[0],D);a.vec3d.set(e.center,d.center);d.radius=e.radius}else{A[0]=Infinity;A[1]=Infinity;A[2]=Infinity;z[0]=-Infinity;z[1]=-Infinity;z[2]=-Infinity;for(var f=0;f<b.length;f++)if(e=c(b[f],D),this._isValidRadius(e.radius)){var h=A,k=e.center,l=e.radius;h[0]=Math.min(h[0],k[0]-l);h[1]=Math.min(h[1],k[1]-l);h[2]=Math.min(h[2],k[2]-l);h=z;k=e.center;e=e.radius;h[0]=Math.max(h[0],k[0]+e);h[1]=Math.max(h[1],k[1]+e);h[2]=Math.max(h[2],k[2]+e)}a.vec3d.scale(a.vec3d.add(A,
z,d.center),.5);d.radius=Math.max(z[0]-A[0],z[1]-A[1],z[2]-A[2])/2}return d};return g}();var k=function(){function b(b,c,d,e){void 0===d&&(d=0);void 0===e&&(e=0);this.center=a.vec3d.create();this.initFrom(b,c,d,0)}b.prototype.init=function(a){return this.initFrom(a.node,a.center,a.halfSize,a.depth)};b.prototype.initFrom=function(c,d,e,f){void 0===c&&(c=null);void 0===e&&(e=this.halfSize);void 0===f&&(f=this.depth);this.node=c||b.createEmptyNode();d&&a.vec3d.set(d,this.center);this.halfSize=e;this.depth=
f;return this};b.prototype.advance=function(a){var c=this.node.children[a];c||(c=b.createEmptyNode(),this.node.children[a]=c);this.node=c;this.halfSize/=2;this.depth++;a=q[a];this.center[0]+=a[0]*this.halfSize;this.center[1]+=a[1]*this.halfSize;this.center[2]+=a[2]*this.halfSize;return this};b.prototype.advanceTo=function(a,b,c){for(void 0===c&&(c=!1);;){if(this.isTerminalFor(a))return b&&b(this,-1),!0;if(this.isLeaf()&&!c)return b&&b(this,-1),!1;this.isLeaf()&&(this.node.residents=null);var d=this._childIndex(a);
b&&b(this,d);this.advance(d)}};b.prototype.isLeaf=function(){return null!=this.node.residents};b.prototype.isTerminalFor=function(a){return a.radius>this.halfSize/2};b.prototype._childIndex=function(a){a=a.center;for(var b=this.center,c=0,d=0;3>d;d++)b[d]<a[d]&&(c|=1<<d);return c};b.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new c({shrink:!0}),residents:new c({shrink:!0})}};b.acquire=function(){if(0===this._pool.length)return new b;var a=this._pool[this._pool.length-
1];this._pool.length--;return a};b.release=function(a){this._pool.push(a)};b._pool=[];return b}(),d;(function(a){a[a.FRONT_TO_BACK=1]="FRONT_TO_BACK";a[a.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(d||(d={}));var q=[[-1,-1,-1],[1,-1,-1],[-1,1,-1],[1,1,-1],[-1,-1,1],[1,-1,1],[-1,1,1],[1,1,1]],p=[[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,-1,-1],[1,-1,1],[1,1,-1],[1,1,1]],r=Math.sqrt(3),u=[null],t=a.vec3d.create(),v=a.vec3d.create(),A=a.vec3d.create(),z=a.vec3d.create(),x=[],B={center:a.vec3d.create(),radius:0},
D={center:a.vec3d.create(),radius:0},C={center:a.vec3d.create(),radius:0},G={center:a.vec3d.create(),radius:0},E=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],F=[],I=[];return n})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["require","exports","./ModelContentType"],function(n,g,c){return function(){function a(a){this.materials={};this.stage=a}a.prototype.getMaterial=function(a){return this.materials[a]};a.prototype.addMaterial=function(a,b){this.materials[a]=b;this.stage.add(c.MATERIAL,
b)};a.prototype.dispose=function(){for(var a in this.materials)this.stage.remove(c.MATERIAL,this.materials[a].id);this.materials={}};return a}()})},"esri/views/3d/webgl-engine/lib/TextTexture":function(){define("require exports ../../support/mathUtils ./Texture ./Util ../../../webgl/Texture".split(" "),function(n,g,c,a,f,b){function l(){var a=document.createElement("canvas");a.width=512;a.height=512;return a}function e(a){return"rgb("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+
")"}function h(a){return"rgba("+a.slice(0,3).map(function(a){return Math.floor(255*a)}).toString()+","+a[3]+")"}n=function(){function k(a,b,c,e){void 0===e&&(e=!0);this._idHint=c;this._text=a;this._textLines=a.split(/\r?\n/);this._params=b;this._haloSize=Math.round(this._params.halo.size);this._autoScale=e}Object.defineProperty(k.prototype,"id",{get:function(){null==this._id&&(this._id=a.idGen.gen(this._idHint));return this._id},enumerable:!0,configurable:!0});k.prototype.getParams=function(){return this._params};
k.prototype.getText=function(){return this._text};k.prototype.deferredLoading=function(){return!1};Object.defineProperty(k.prototype,"width",{get:function(){this._width||(this._width=c.nextHighestPowerOfTwo(this.renderedWidth));return this._width},enumerable:!0,configurable:!0});k.prototype.getWidth=function(){return this.width};Object.defineProperty(k.prototype,"height",{get:function(){this._height||(this._height=c.nextHighestPowerOfTwo(this.renderedHeight));return this._height},enumerable:!0,configurable:!0});
k.prototype.getHeight=function(){return this.height};Object.defineProperty(k.prototype,"lineHeight",{get:function(){this._lineHeight||(this._lineHeight=this._computeLineHeight());return this._lineHeight},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"textWidth",{get:function(){this._textWidth||(this._textWidth=this._computeTextWidth());return this._textWidth},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"textHeight",{get:function(){this._textHeight||(this._textHeight=
this._computeTextHeight());return this._textHeight},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderedWidth",{get:function(){this._renderedWidth||(this._renderedWidth=Math.round(this.textWidth*this.scaleFactor));return this._renderedWidth},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"renderedHeight",{get:function(){this._renderedHeight||(this._renderedHeight=Math.round(this.textHeight*this.scaleFactor));return this._renderedHeight},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"scaleFactor",{get:function(){this._scaleFactor||(this._scaleFactor=this._autoScale?Math.min(1,Math.min(2048/this.textWidth,2048/this.textHeight)):1,this._autoScale&&f.assert(2048>=this.renderedWidth&&2048>=this.renderedHeight));return this._scaleFactor},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"texcoordScale",{get:function(){return[this.renderedWidth/this.width,this.renderedHeight/this.height]},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,
"fillStyle",{get:function(){this._fillStyle||(this._fillStyle=h(this._params.color));return this._fillStyle},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"haloStyle",{get:function(){this._haloStyle||(this._haloStyle=e(this._params.halo.color));return this._haloStyle},enumerable:!0,configurable:!0});k.prototype.initializeThroughRender=function(a,c){var d=this._getTextCanvas();d.width=this._width;d.height=this._height;var e=d.getContext("2d");e.save();c.samplingMode=9987;c.wrapMode=
33071;c.flipped=!0;c.preMultiplyAlpha=!0;c.hasMipmap=!0;this.renderText(this._renderedWidth,this._renderedHeight,e,0,this._height-this._renderedHeight);a=new b(a,c,d);e.restore();return a};k.prototype.setUnloadFunc=function(a){this._unloadFunc=a};k.prototype.unload=function(){this._unloadFunc&&(this._unloadFunc(this._id),this._unloadFunc=null)};k.prototype.renderText=function(a,b,c,e,f){void 0===e&&(e=0);void 0===f&&(f=0);b=this.lineHeight*this.scaleFactor;var d=this._haloSize,h=c.textAlign;a=("center"===
h?.5*a:"right"===h?a:0)+d;c.save();var k=3>d;if(0<d){var h=d,l=this._getHaloCanvas();l.width=Math.max(512,this.renderedWidth);l.height=Math.max(512,this.renderedHeight);var g=l.getContext("2d");g.clearRect(0,0,l.width,l.height);this._setFontProperties(g,this._params.size*this.scaleFactor);g.fillStyle=this.haloStyle;g.strokeStyle=this.haloStyle;g.lineJoin=k?"miter":"round";if(k)for(var q=0,p=this._textLines;q<p.length;q++){for(var k=p[q],r=0,u=m;r<u.length;r++){var n=u[r];g.fillText(k,a+d*n[0],d+d*
n[1])}h+=b}else for(q=0,p=this._textLines;q<p.length;q++){k=p[q];r=2*d;for(u=0;5>u;u++)g.lineWidth=(.6+.1*u)*r,g.strokeText(k,a,h);h+=b}c.globalAlpha=this._params.halo.color[3];c.drawImage(l,e,f);l.width=512;l.height=512;c.globalAlpha=1}this._setFontProperties(c,this._params.size*this._scaleFactor);h=f+d;f=0;for(d=this._textLines;f<d.length;f++)k=d[f],c.globalCompositeOperation="destination-out",c.fillStyle="rgb(0, 0, 0)",c.fillText(k,e+a,h),c.globalCompositeOperation="source-over",c.fillStyle=this.fillStyle,
c.fillText(k,e+a,h),h+=b;c.restore()};k.preferredAtlasSize=function(){return 512};k.prototype._getTextCanvas=function(){null==k._textCanvas2D&&(k._textCanvas2D=l());return k._textCanvas2D};k.prototype._getHaloCanvas=function(){null==k._haloCanvas2D&&(k._haloCanvas2D=l());return k._haloCanvas2D};k.prototype._setFontProperties=function(a,b){var c=this._params.font;a.font=c.style+" "+c.weight+" "+b+"px "+c.family;a.textAlign="left";a.textBaseline="top"};k.prototype._computeTextWidth=function(){var a=
this._getTextCanvas().getContext("2d");this._setFontProperties(a,this._params.size);for(var b=0,c=0,e=this._textLines;c<e.length;c++){var f=a.measureText(e[c]).width;f>b&&(b=f)}c=this._params.font;if("italic"===c.style||"oblique"===c.style||"string"===typeof c.weight&&("bold"===c.weight||"bolder"===c.weight)||"number"===typeof c.weight&&600<c.weight)b+=.3*a.measureText("A").width;b+=2*this._haloSize;return b=Math.round(b)};k.prototype._computeLineHeight=function(){return Math.floor(1.275*this._params.size+
2*this._haloSize)};k.prototype._computeTextHeight=function(){return this._computeLineHeight()*this._textLines.length};return k}();var m=[];for(g=0;360>g;g+=22.5)m.push([Math.cos(Math.PI*g/180),Math.sin(Math.PI*g/180)]);return n})},"esri/views/3d/webgl-engine/lib/Texture":function(){define("require exports ../../../../core/Logger ../../lib/gl-matrix ../../support/imageUtils ../../support/mathUtils ../../support/buffer/typedArrayUtil ./DDSUtil ./DefaultVertexBufferLayouts ./glUtil3D ./IdGen ./Util ../shaders/MiscPrograms ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){function t(a,c,e,h,k,l,g){g=!1!==g;f.requestImage(c).then(function(c){d.assert(1<=c.width&&1<=c.height);e.samplingMode=g?9987:9729;e.hasMipmap=g;!g&&33071===e.wrapMode||b.isPowerOfTwo(c.width)&&b.isPowerOfTwo(c.height)?(e.width=c.width,e.height=c.height,c=new r(a,e,c)):c=v(a,c,e,h,k);a.bindTexture(c);l(c)}).catch(function(a){var b=200<c.length?c.slice(0,100)+"..."+c.slice(c.length-100):c;A.error("Failed to load image from uri",b,a);l(null)})}function v(c,
e,f,k,l){var g=b.nextHighestPowerOfTwo(e.width),t=b.nextHighestPowerOfTwo(e.height);d.assert(g!==e.width||t!==e.height);f.width=g;f.height=t;var v=new r(c,f),x=p.createWithAttachments(c,v,{colorTarget:0,depthStencilTarget:0});e=new r(c,{target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9728,flipped:!!f.flipped,maxAnisotropy:8,preMultiplyAlpha:f.preMultiplyAlpha},e);c.bindFramebuffer(x);void 0===l&&(l=c.getViewport(),l=[l.x,l.y,l.width,l.height]);c.setViewport(0,0,g,t);k=k.getProgram(q.texOnly);
g=a.mat4d.identity();c.bindProgram(k);k.setUniformMatrix4fv("model",g);k.setUniformMatrix4fv("view",g);k.setUniformMatrix4fv("proj",g);k.setUniform4f("color",1,1,1,1);k.setUniform1i("tex",0);k=m.createQuadVAO(c,h.Pos3Tex);c.bindTexture(e,0);c.bindVAO(k);c.setDepthTestEnabled(!1);c.setBlendingEnabled(!1);c.drawArrays(5,0,u.vertexCount(k,"geometry"));c.setDepthTestEnabled(!0);c.bindFramebuffer(null);c.setViewport(l[0],l[1],l[2],l[3]);k.dispose(!0);e.dispose();c.bindFramebuffer(null);x.detachColorTexture();
x.dispose();f.hasMipmap&&v.generateMipmap();return v}var A=c.getLogger("esri.views.3d.webgl-engine.lib.Texture");return function(){function a(b,c,d){this.data=b;this.id=a.idGen.gen(c);this.unloadFunc=void 0;this.params=d||{};this.params.wrapClamp=this.params.wrapClamp||!1;this.params.mipmap=!1!==this.params.mipmap;this.params.noUnpackFlip=this.params.noUnpackFlip||!1;this.params.preMultiplyAlpha=this.params.preMultiplyAlpha||!1;this.estimatedTexMemRequired=a.estimateTexMemRequired(this.data,this.params)}
a.estimateTexMemRequired=function(a,b){return null==a?0:l.isArrayBuffer(a)||l.isUint8Array(a)?a.byteLength:a instanceof Image||a instanceof ImageData||a instanceof HTMLCanvasElement?(b.mipmap?4/3:1)*a.width*a.height*4:(b.mipmap?4/3:1)*b.width*b.height*4||0};a.prototype.getEstimatedTexMemRequired=function(){return this.estimatedTexMemRequired};a.prototype.dispose=function(){this.data=void 0};a.prototype.deferredLoading=function(){return"string"===typeof this.data};a.prototype.getWidth=function(){return this.params.width};
a.prototype.getHeight=function(){return this.params.height};a.prototype.initializeThroughUpload=function(c,f,h,k,g){var m=this.data;f.flipped=!this.params.noUnpackFlip;f.samplingMode=this.params.mipmap?9987:9729;f.hasMipmap=this.params.mipmap;f.wrapMode=this.params.wrapClamp?33071:10497;f.preMultiplyAlpha=this.params.preMultiplyAlpha;if("string"===typeof m)t(c,m,f,h,k,g,this.params.mipmap);else{if(m instanceof Image||m instanceof ImageData||m instanceof HTMLCanvasElement)this.params.width=m.width,
this.params.height=m.height,!this.params.mipmap&&this.params.wrapClamp||b.isPowerOfTwo(m.width)&&b.isPowerOfTwo(m.height)?(f.width=m.width,f.height=m.height,f=new r(c,f,m)):f=v(c,m,f,h,k);else if(l.isArrayBuffer(m)&&this.params.encoding===a.DDS_ENCODING)f=e.createDDSTexture(c,f,m,this.params.mipmap);else if(l.isUint8Array(m)&&this.params.encoding===a.DDS_ENCODING)f=e.createDDSTexture(c,f,m.buffer,this.params.mipmap);else if(l.isUint8Array(m))d.assert(0<this.params.width&&0<this.params.height),f.pixelFormat=
1===this.params.components?6409:6408,f.width=this.params.width,f.height=this.params.height,f=new r(c,f,m);else{if(null!==m)throw console.warn("Unsupported image data"),Error("Unsupported image data");f=new r(c,f,null)}c.bindTexture(f);g(f)}this.data=void 0};a.prototype.setUnloadFunc=function(a){this.unloadFunc=a};a.prototype.unload=function(){void 0!==this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=void 0)};a.createEmpty=function(b){void 0===b&&(b="emptyTexture");return new a(new Uint8Array([0,
0,0,0]),b,{width:1,height:1,wrapClamp:!0})};a.idGen=new k;a.DDS_ENCODING="image/vnd-ms.dds";return a}()})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["require","exports","../../../webgl/Texture"],function(n,g,c){function a(a){return a.charCodeAt(0)+(a.charCodeAt(1)<<8)+(a.charCodeAt(2)<<16)+(a.charCodeAt(3)<<24)}Object.defineProperty(g,"__esModule",{value:!0});var f=a("DXT1"),b=a("DXT3"),l=a("DXT5");g.createDDSTexture=function(a,h,g,k){var d=new Int32Array(g,0,31);if(542327876!==
d[0])return console.error("Invalid magic number in DDS header"),null;if(!(d[20]&4))return console.error("Unsupported format, must contain a FourCC code"),null;var e=d[21],m;switch(e){case f:e=8;m=33776;break;case b:e=16;m=33778;break;case l:e=16;m=33779;break;default:return console.error("Unsupported FourCC code:",String.fromCharCode(e&255,e>>8&255,e>>16&255,e>>24&255)),null}var r=1;d[2]&131072&&!1!==k&&(r=Math.max(1,d[7]));k=d[4];for(var u=d[3],t=d[1]+4,v,A,z=[],x=0;x<r;++x)A=Math.floor((k+3)/4)*
Math.floor((u+3)/4)*e,v=new Uint8Array(g,t,A),z.push(v),t+=A,k=Math.max(1,k>>1),u=Math.max(1,u>>1);h.samplingMode=1<r?9987:9729;h.hasMipmap=1<r;h.width=d[4];h.height=d[3];h.internalFormat=m;h=new c(a,h,{type:"compressed",levels:z});a.bindTexture(h);return h}})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("require exports ../../../../core/arrayUtils ../../support/mathUtils ./ModelContentType ./Texture ../../../webgl/Texture".split(" "),function(n,g,c,a,f,b,l){var e={budget:null,
repackingEnabled:!0};return function(){function h(a,c){this.dirty=!1;this.elementsToAdd={};this.elementsToRemove={};this.elementsToRender={};this.elements={};this.stageObjects={};this.id=b.idGen.gen(a);this.stage=c._stage;this.controller=c.resourceController;this.canvas=this.create2DCanvas();this.ctx=this.canvas.getContext("2d");this.stage.add(f.TEXTURE,this);a=this.computeAtlasResolution(c.width,c.height);this.createAtlasRegion(a);this.update2DCanvasSize()}h.prototype.setUnloadFunc=function(a){this.unloadFunc=
a};h.prototype.unload=function(){null!=this.unloadFunc&&(this.unloadFunc(this.id),this.unloadFunc=null)};h.prototype.deferredLoading=function(){return!1};h.prototype.getWidth=function(){return this.atlas.size.width};h.prototype.getHeight=function(){return this.atlas.size.height};h.prototype.initializeThroughRender=function(a,b){b.wrapMode=33071;b.samplingMode=9987;b.flipped=!0;b.preMultiplyAlpha=!0;b.hasMipmap=!0;return this.glTexture=new l(a,b,this.canvas)};h.prototype.dispose=function(){this.elementsToRender=
this.elementsToRemove=this.elementsToAdd=this.elements=null;this.glTexture&&(this.glTexture=null,this.stage.remove(f.TEXTURE,this.id))};h.prototype.create2DCanvas=function(){var a=document.createElement("canvas");a.setAttribute("id","canvas2d");a.setAttribute("style","display:none");a.setAttribute("width",(512).toString());a.setAttribute("height",(512).toString());return a};h.prototype.update2DCanvasSize=function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",
this.atlas.size.height.toString())};h.prototype.generateTextId=function(a){return JSON.stringify(a.getParams())+"_"+a.getText()};h.prototype.createAtlasRegion=function(a){void 0===a&&(a=512);this.atlas={size:{width:a,height:a},cursor:{x:0,y:0},lineHeight:0}};h.prototype.computeAtlasResolution=function(b,c){b=Math.max(b,c);b=a.nextHighestPowerOfTwo(b+256);return b=Math.min(b,4096)};h.prototype.resizeAtlas=function(a,b){b=b||a;var c=this.atlas;c.size.width=a;c.size.height=b;this.glTexture&&this.glTexture.resize(a,
b);this.update2DCanvasSize()};h.prototype.resetAtlasCursor=function(){var a=this.atlas;a.cursor.x=0;a.cursor.y=0;a.lineHeight=0};h.prototype.getAtlasUsage=function(){var a=this.atlas;return(a.cursor.x+a.cursor.y*a.size.width)/(a.size.width*a.size.height)};h.prototype.getExpectedAtlasUsage=function(){var a=Object.keys(this.elementsToRemove).length,b=Object.keys(this.elementsToAdd).length,c=Object.keys(this.elements).length;return this.getAtlasUsage()/c*(c+b-a)};h.prototype.addAtlasElement=function(a,
b,c,e,f){var d=this.atlas;a.placement.offset.x=d.cursor.x;a.placement.offset.y=d.cursor.y;a.placement.size.width=b;a.placement.size.height=c;a.placement.uvMinMax=[a.placement.offset.x/d.size.width,1-(a.placement.offset.y+c)/d.size.height,(a.placement.offset.x+b)/d.size.width,1-a.placement.offset.y/d.size.height];d.cursor.x+=e;d.lineHeight=Math.max(d.lineHeight,f)};h.prototype.removeAtlasElement=function(a){if(a&&this.elements[a.textId]){var b=a.placement.offset,c=a.placement.size;this.ctx.clearRect(b.x,
b.y,c.width,c.height);delete this.elements[a.textId]}};h.prototype.addStageObject=function(a,b){this.stageObjects[a]||(this.stageObjects[a]=[]);-1===this.stageObjects[a].indexOf(b)&&this.stageObjects[a].push(b)};h.prototype.removeStageObject=function(a,b){this.stageObjects[a]&&c.removeUnordered(this.stageObjects[a],b)&&(b.geometries[0].data.vertexAttributes.size.data=new Float32Array([0,0]),b.geometryVertexAttrsUpdated(0))};h.prototype.processAdditionRequest=function(a,b){var c=this.atlas,e=a.textId,
f=a.textTexture.renderedWidth,h=a.textTexture.renderedHeight,k=f+2,l=h+2+2;b=b.repackingEnabled;if(c.cursor.x+k<c.size.width&&c.cursor.y+l<c.size.height)this.addAtlasElement(a,f,h,k,l),this.elements[e]=a,this.elementsToRender[e]=a,delete this.elementsToAdd[e];else if(c.cursor.y+l+c.lineHeight<c.size.height)c.cursor.x=2,c.cursor.y+=c.lineHeight,c.lineHeight=0,this.addAtlasElement(a,f,h,k,l),this.elements[e]=a,this.elementsToRender[e]=a,delete this.elementsToAdd[e];else{a=this.getExpectedAtlasUsage();
(e=.85<a&&4096>c.size.width)&&this.resizeAtlas(2*c.size.width,2*c.size.height);for(var g in this.elementsToRemove)0===this.stageObjects[g].length&&this.removeAtlasElement(this.elementsToRemove[g]),delete this.elementsToRemove[g];if(!b||!e&&.95<a&&4096===c.size.width)return 0;for(var m in this.elements)c=this.elements[m],c.rendered=!1,this.elementsToAdd[m]=c,delete this.elements[m];this.resetAtlasCursor();this.elementsToRender={};return 1}return 0};h.prototype.processRenderingRequest=function(a){var b=
a.textId;this.ctx.clearRect(a.placement.offset.x,a.placement.offset.y,a.placement.size.width,a.placement.size.height);a.textTexture.renderText(a.placement.size.width,a.placement.size.height,this.ctx,a.placement.offset.x,a.placement.offset.y);for(var c=0,b=this.stageObjects[b];c<b.length;c++){var e=b[c];e.geometries[0].data.vertexAttributes.uv0.data=new Float32Array(a.placement.uvMinMax);e.geometries[0].data.vertexAttributes.size.data=new Float32Array([a.placement.size.width,a.placement.size.height]);
e.geometryVertexAttrsUpdated(0)}a.rendered=!0};h.prototype.run=function(a){if(this.dirty&&this.glTexture){var b=a.budget,c;for(c in this.elementsToAdd)if(this.elements[c]&&this.elements[c].rendered){for(var e=0,f=this.stageObjects[c];e<f.length;e++){var h=f[e],l=h.geometries[0].data.vertexAttributes;l.uv0.data=new Float32Array(this.elements[c].placement.uvMinMax);l.size.data=new Float32Array([this.elements[c].placement.size.width,this.elements[c].placement.size.height]);h.geometryVertexAttrsUpdated(0)}delete this.elementsToAdd[c]}else if(1===
this.processAdditionRequest(this.elementsToAdd[c],a)){a.budget=null;a.repackingEnabled=!1;this.run(a);return}a=!1;for(c in this.elementsToRender){if(b&&!b.remaining()){a&&this.glTexture.setData(this.canvas);return}this.processRenderingRequest(this.elementsToRender[c]);delete this.elementsToRender[c];a=!0}a&&this.glTexture.setData(this.canvas);this.dirty=!1;this.frameWorker.remove();this.frameWorker=null}};h.prototype.makeRunContext=function(a){void 0===a&&(a=null);e.budget=a;e.repackingEnabled=!0;
return e};h.prototype.addTextTexture=function(a,b){var c=this.generateTextId(a);this.elementsToAdd[c]||(this.elementsToAdd[c]={textId:c,placement:{offset:{x:0,y:0},size:{width:0,height:0},uvMinMax:[]},textTexture:a,rendered:!1});this.addStageObject(c,b);delete this.elementsToRemove[c];this.setDirty()};h.prototype.removeTextTexture=function(a,b){a=this.generateTextId(a);this.elementsToRemove[a]=this.elements[a];this.removeStageObject(a,b);delete this.elementsToAdd[a]};Object.defineProperty(h.prototype,
"textureId",{get:function(){return this.id},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"isDirty",{get:function(){return this.dirty},enumerable:!0,configurable:!0});h.prototype.setDirty=function(){var a=this;this.dirty||(this.dirty=!0,this.frameWorker=this.controller.registerFrameWorker(function(b){return a.run(a.makeRunContext(b))}))};return h}()})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/projectionUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){Object.defineProperty(g,"__esModule",{value:!0});var u=e.getLogger("esri.views.3d.layers.support.FeatureTileFetcher3D");n=function(e){function f(a){a=e.call(this,a)||this;a.tiles=new b;a.tileSize=512;a.disableThrottling=!1;a.idToTile=new Map;a.handles=new l;a.clients=new Set;a.geometryEnginePromise=null;a._dirty=!1;return a}c(f,e);Object.defineProperty(f.prototype,"tilingScheme",{get:function(){var a=this.tilingSchemeOwner.tilingScheme;return a?a.clone():null},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"filterExtent",{set:function(a){if(a&&!a.spatialReference.equals(this.viewState.spatialReference))u.error("#extent","extent spatial reference needs to be in the same spatial reference as the view");else{var b=this._get("filterExtent");b===a||b&&a&&b.equals(a)||(a=a?a.clone():null,this._set("filterExtent",a),this.setDirty())}},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"filterExtentRect",{get:function(){if(!this.filterExtent||
!this.tilingScheme)return null;var a=d.create();r.extentToBoundingRect(this.filterExtent,a,this.tilingScheme.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"rootTileIds",{get:function(){return this.filterExtentRect?this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"suspended",{set:function(a){a!==this._get("suspended")&&(this._set("suspended",a),a||this.setDirty())},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updating",{get:function(){return this.throttledUpdate.hasPendingUpdates()||null!=this.geometryEnginePromise||this._dirty},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"changeId",{get:function(){var a=this._get("changeId")||0;return!this.hasClients||this.suspended?a:a+1},enumerable:!0,configurable:!0});f.prototype.initialize=function(){var a=this;this.throttledUpdate=h.throttle(this.setDirty,function(){return a.notifyChange("updating")},
1E3,this);var b=this.disableThrottling?function(){return a.setDirty}:this.throttledUpdate;this.handles.add(this.watch(["tilingScheme","tileSize"],function(){return a.tileMeasurements=null},!0));this.handles.add(m.init(this,"changeId",b));this.resourceController&&(this._frameWorker=this.resourceController.registerFrameWorker(function(){return a.update()}))};f.prototype.destroy=function(){this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this.handles&&(this.handles.destroy(),this.handles=
null)};f.prototype.addClient=function(){var a=this,b=t++;this.clients.add(b);1===this.clients.size&&this.setDirty();return{remove:function(){return a.removeClient(b)}}};f.prototype.removeClient=function(a){this.clients.delete(a);this.hasClients||this.setDirty()};Object.defineProperty(f.prototype,"hasClients",{get:function(){return 0<this.clients.size},enumerable:!0,configurable:!0});f.prototype.setDirty=function(){this.suspended?this.notifyChange("updating"):(this._dirty=!0,this._frameWorker||this.update())};
f.prototype.update=function(){if(this._dirty&&!this.suspended){this._dirty=!1;if(this.tilingScheme&&this.hasClients){this.tileMeasurements||(this.tileMeasurements=new p.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize,maxVerticalScreenSize:A}));var a=this.cameraOnSurface.location;this.tileMeasurements.begin(this.viewState.camera,this.focus?this.focus.locationOnSurface:a,a.z);this.updateTiles(this.subdivideTilesForView(this.getRootTiles()));
this.tileMeasurements.end()}else this.tiles.removeAll(),this.idToTile.clear();this.notifyChange("updating")}};f.prototype.getRootTiles=function(){var a=this;return this.rootTileIds.map(function(b){return new q.FeatureTileDescriptor3D(b[0],b[1],b[2],a.tilingScheme)})};f.prototype.purgeHorizonTiles=function(a){a.sort(function(a,b){return b.measures.screen.rect[1]-a.measures.screen.rect[1]});d.empty(v);for(var b=0;b<a.length;b++)if(d.expand(v,a[b].measures.screen.rect),d.height(v)>A)return a.slice(b);
return[]};f.prototype.subdivideTilesForView=function(a){a=a.slice();for(var b=[];0<a.length;){var c=a.pop();if(!this.filterExtentRect||d.intersects(this.filterExtentRect,c.extent))this.tileMeasurements.updateTile(c),0!==c.measures.visibility&&(c.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(c.lij[0]+1),a.push.apply(a,c.getChildren())):b.push(c))}return this.purgeHorizonTiles(b)};f.prototype.updateTiles=function(a){for(var b=this,c=0,d=this.tiles.items;c<d.length;c++)d[c].used=!1;a=a.filter(function(a){var c=
b.idToTile.get(a.id);c?(c.copyMeasurementsFrom(a),c.used=!0):b.idToTile.set(a.id,a);return!c});c=this.tiles.items.filter(function(a){if(a.used)return!1;b.idToTile.delete(a.id);return!0});this.tiles.removeMany(c);this.tiles.addMany(a);this.sortTiles()};f.prototype.sortTiles=function(){this.tiles.sort(function(a,b){return a.measures.visibility!==b.measures.visibility?2===a.measures.visibility?-1:1:a.measures.distance-b.measures.distance});this.tiles.forEach(function(a,b){return a.loadPriority=b})};
a([k.property({constructOnly:!0})],f.prototype,"resourceController",void 0);a([k.property({constructOnly:!0})],f.prototype,"renderCoordsHelper",void 0);a([k.property({constructOnly:!0})],f.prototype,"tilingSchemeOwner",void 0);a([k.property({constructOnly:!0})],f.prototype,"cameraOnSurface",void 0);a([k.property({constructOnly:!0})],f.prototype,"focus",void 0);a([k.property({constructOnly:!0})],f.prototype,"viewState",void 0);a([k.property()],f.prototype,"tiles",void 0);a([k.property()],f.prototype,
"tileSize",void 0);a([k.property({readOnly:!0,dependsOn:["tilingSchemeOwner.tilingScheme"]})],f.prototype,"tilingScheme",null);a([k.property()],f.prototype,"filterExtent",null);a([k.property({readOnly:!0,dependsOn:["filterExtent","tilingScheme"]})],f.prototype,"filterExtentRect",null);a([k.property({readOnly:!0,dependsOn:["filterExtentRect"]})],f.prototype,"rootTileIds",null);a([k.property({value:!1})],f.prototype,"suspended",null);a([k.property()],f.prototype,"updating",null);a([k.property({readOnly:!0,
dependsOn:["tileSize","cameraOnSurface.location","tilingScheme","viewState.camera","focus.locationOnSurface"]})],f.prototype,"changeId",null);a([k.property({constructOnly:!0})],f.prototype,"disableThrottling",void 0);return f=a([k.subclass()],f)}(k.declared(f));g.FeatureTileTree3D=n;var t=0,v=d.create(),A=10;g.default=n})},"esri/core/throttle":function(){define(["require","exports"],function(n,g){function c(a,c,b,l){var e=null,f=1E3;"number"===typeof c?(f=c,l=b):(e=c,f=b);var g=0,k,d=function(){g=
0;a.apply(l,k)};c=function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];e&&e.apply(l,a);k=a;f?g||(g=setTimeout(d,f)):d()};c.remove=function(){g&&(clearTimeout(g),g=0)};c.forceUpdate=function(){g&&(clearTimeout(g),d())};c.hasPendingUpdates=function(){return!!g};return c}Object.defineProperty(g,"__esModule",{value:!0});g.throttle=c;g.default=c})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["require","exports","../../../../geometry/support/aaBoundingRect"],
function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a,b,l,e){void 0===e&&(e=null);this.lij=[0,0,0];this.extent=c.create();this.loadPriority=this.resolution=0;this.measures={visibility:2,screen:{rect:c.create()},distance:0,shouldSplit:!1};this.used=!1;e&&this.acquire(a,b,l,e)}a.prototype.acquire=function(c,b,l,e){this.tilingScheme=e;this.id=a.id(c,b,l);this.lij[0]=c;this.lij[1]=b;this.lij[2]=l;e.getExtent(c,b,l,this.extent);this.resolution=e.resolutionAtLevel(c)};
a.prototype.release=function(){this.tilingScheme=null};a.prototype.getChildren=function(c){var b=this.lij[0]+1,f=2*this.lij[1],e=2*this.lij[2];return c?(c[0].acquire(b,f,e,this.tilingScheme),c[1].acquire(b,f+1,e,this.tilingScheme),c[2].acquire(b,f,e+1,this.tilingScheme),c[3].acquire(b,f+1,e+1,this.tilingScheme),c):[new a(b,f,e,this.tilingScheme),new a(b,f+1,e,this.tilingScheme),new a(b,f,e+1,this.tilingScheme),new a(b,f+1,e+1,this.tilingScheme)]};a.prototype.copyMeasurementsFrom=function(a){this.measures.visibility=
a.measures.visibility;this.measures.shouldSplit=a.measures.shouldSplit;this.measures.distance=a.measures.distance;c.set(a.measures.screen.rect,this.measures.screen.rect)};a.id=function(a,b,c){return a+"/"+b+"/"+c};return a}();g.FeatureTileDescriptor3D=n;g.default=n})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("require exports ../../../../geometry/support/aaBoundingRect ./FeatureTileVisibility3D ../../lib/gl-matrix ../../support/geometryUtils".split(" "),function(n,
g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function g(b){this.pointOfInterestInMap=[0,0];this.screenRect=c.create();this.tileSize=b.tileSize;this.maxVerticalScreenSize=b.maxVerticalScreenSize;this.renderCoordsHelper=b.renderCoordsHelper;this.tilingScheme=b.tilingScheme;this.visibility=new a.FeatureTileVisibility3D({renderCoordsHelper:b.renderCoordsHelper})}g.prototype.begin=function(a,b,d){this.camera=a;this.z=d;this.pointOfInterestInMap[0]=b.x;this.pointOfInterestInMap[1]=
b.y;c.fromValues(0,0,a.fullWidth,a.fullHeight,this.screenRect);this.visibility.begin(a,d)};g.prototype.end=function(){this.visibility.end()};g.prototype.updateTile=function(a){a.measures.visibility=this.visibility.calculate(a);0!==a.measures.visibility&&this.updateScreenMeasure(a);this.updateDistanceMeasure(a)};g.prototype.updateDistanceMeasure=function(a){a.measures.distance=c.distance(a.extent,this.pointOfInterestInMap)};g.prototype.updateScreenMeasure=function(a){var b=h,d=1<<b,e=a.measures.screen.rect;
c.empty(e);for(var f=0,k=a.lij[0]+b,l=a.lij[1]<<b,b=a.lij[2]<<b,g=this.tileSizeWithBias(a),g=g*g,m=!1,q=0;q<d;q++){for(var p=0;p<d&&!(m=this.computeScreenArea(a,k,l+q,b+p,e),f+=m.area,m=f>g&&c.height(e)>this.maxVerticalScreenSize);p++);if(m)break}a.measures.shouldSplit=f>g};g.prototype.tileSizeWithBias=function(a){return 1===a.measures.visibility?this.tileSize*m:this.tileSize};g.prototype.computeScreenArea=function(a,d,f,h,g){var m=k.points;this.projectToScreen(d,f,h,1===a.measures.visibility,m);
c.empty(l);for(a=0;4>a;a++)c.expandPointInPlace(l,m[a]);c.expand(g,l);c.intersection(l,this.screenRect,e);k.screenOverlap=c.area(e)/c.area(l);k.area=b.triangle.areaPoints2d(m[0],m[1],m[2])+b.triangle.areaPoints2d(m[0],m[2],m[3]);return k};g.prototype.projectToScreen=function(a,b,c,e,f){this.tilingScheme.ensureMaxLod(a);this.tilingScheme.getExtent(a,b,c,d);this.toRenderCoords(d,0,3,p[0]);this.toRenderCoords(d,2,3,p[1]);this.toRenderCoords(d,2,1,p[2]);this.toRenderCoords(d,0,1,p[3]);e&&(this.projectToPlane(p,
this.camera.frustumPlanes[4]),this.projectToPlane(p,this.camera.frustumPlanes[3]),this.projectToPlane(p,this.camera.frustumPlanes[2]));for(a=0;4>a;a++)this.camera.projectPoint(p[a],f[a])};g.prototype.projectToPlane=function(a,c){for(var d=0;4>d;d++)r[d]=b.plane.distance(c,a[d]);d=Math.max(r[0],r[1],r[2],r[3]);if(0<d)for(c=f.vec3d.scale(c,-d,q),d=0;4>d;d++)f.vec3d.add(a[d],c)};g.prototype.toRenderCoords=function(a,b,c,d){q[0]=a[b];q[1]=a[c];q[2]=this.z;this.renderCoordsHelper.toRenderCoords(q,this.tilingScheme.spatialReference,
d);return d};return g}();g.FeatureTileMeasurements3D=n;var l=c.create(),e=c.create(),h=2,m=5,k={points:[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],area:0,screenOverlap:0},d=c.create(),q=f.vec3d.create(),p=[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],r=[0,0,0,0];g.default=n})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("require exports ../../../../core/ObjectPool ./FeatureTileDescriptor3D ../../lib/gl-matrix ../../state/Frustum ../../support/FrustumExtentIntersection ../../support/geometryUtils ../../support/mathUtils".split(" "),
function(n,g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a){this.surfaceElevation=0;this.cache=new Map;a=a.renderCoordsHelper;this.frustum=new b.Frustum({renderCoordsHelper:a});this.extendedFrustum=new b.Frustum({renderCoordsHelper:a});this.intersector=new l.FrustumExtentIntersection({renderCoordsHelper:a});this.renderCoordsHelper=a}a.prototype.begin=function(a,b){this.surfaceElevation=b;this.aboveGround=this.renderCoordsHelper.getAltitude(a.eye)>b;this.frustum.update(a);
this.shortenFrustumFarPlane(this.frustum);this.updateExtendedFrustum(a,b)};a.prototype.end=function(){this.cache.clear()};a.prototype.calculate=function(a){if(this.allTilesInvisible)return 0;var b="global"===this.renderCoordsHelper.type&&a.lij[0]>=m&&a.lij[0]<k,c=this.getOrCalculateSingleTileVisibility(a,!b);return 0!==c&&b?this.calculateAggregatedChildrenVisibility(a):c};a.prototype.shortenFrustumFarPlane=function(a){for(var c=a.points,d=0,e=b.Frustum.nearFarLineIndices;d<e.length;d++){var h=e[d],
k=h[1],h=c[h[0]];f.vec3d.add(h,f.vec3d.scale(f.vec3d.subtract(c[k],h,p),q),c[k])}a.updatePoints(c)};a.prototype.calculateAggregatedChildrenVisibility=function(a){var b=0,c=this.cache.get(a.id);if(null!=c)return c;c=r.acquire();a.getChildren(c);for(var d=0;d<c.length;d++){var e=this.calculate(c[d]);if(0!==e&&(b=e,2===e))break}r.release(c);this.cache.set(a.id,b);return b};a.prototype.getOrCalculateSingleTileVisibility=function(a,b){var c=this.cache.get(a.id);if(null!=c)return c;c=this.calculateSingleTileVisibility(a);
b&&this.cache.set(a.id,c);return c};a.prototype.calculateSingleTileVisibility=function(a){if(!this.aboveGround&&"global"===this.renderCoordsHelper.type&&a.lij[0]<d){if(0===this.calculateSingleTileVisibilitySided(a,!1))return this.calculateSingleTileVisibilitySided(a,!0)}else return this.calculateSingleTileVisibilitySided(a,this.aboveGround)};a.prototype.calculateSingleTileVisibilitySided=function(a,b){this.intersector.update(a.extent,a.tilingScheme.spatialReference,this.surfaceElevation,b);return this.intersector.isVisibleInFrustum(this.extendedFrustum)?
this.intersector.isVisibleInFrustum(this.frustum,!0)?2:1:0};a.prototype.updateExtendedFrustum=function(a,b){var c=this.renderCoordsHelper;this.extendedFrustum.update(a);this.shortenFrustumFarPlane(this.extendedFrustum);var d=this.renderCoordsHelper.worldUpAtPosition(a.eye,p);this.aboveGround||f.vec3d.negate(d);d=h.acos(-f.vec3d.dot(d,a.viewForward));this.allTilesInvisible=d>(Math.PI+a.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=d>a.fovY/2)){a=this.extendedFrustumParameters(b);b=this.extendedFrustum.points;
for(d=0;4>d;d++){var k=a.pointIndices[d],l=b[k],g=c.getAltitude(l);if(a.needsAltitudeAdjustment(g)){this.renderCoordsHelper.worldUpAtPosition(l,p);switch(k){case 4:case 7:case 0:case 3:e.plane.projectVector(this.extendedFrustum.planes[0],p);break;case 5:case 6:case 1:case 2:e.plane.projectVector(this.extendedFrustum.planes[1],p)}f.vec3d.scale(p,a.direction);this.renderCoordsHelper.intersectManifold(l,p,a.zWithMargin,l)}}this.extendedFrustum.updatePoints(b);0>f.vec3d.dot(this.extendedFrustum.planes[4],
this.frustum.planes[4])&&(c=this.extendedFrustum.points,this.aboveGround?(a=[c[1],c[0]],c[0]=a[0],c[1]=a[1]):(a=[c[2],c[3]],c[3]=a[0],c[2]=a[1]),this.extendedFrustum.updatePoints(c))}};a.prototype.extendedFrustumParameters=function(a){return this.aboveGround?this.extendedFrustumParametersAboveSurface(a,1):this.extendedFrustumParametersBelowSurface(a,1)};a.prototype.extendedFrustumParametersAboveSurface=function(a,c){var d=a-c;return{zWithMargin:d,pointIndices:b.Frustum.planePointIndices.bottom,direction:-1,
needsAltitudeAdjustment:function(a){return a>d}}};a.prototype.extendedFrustumParametersBelowSurface=function(a,c){var d=a+c;return{zWithMargin:d,pointIndices:b.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment:function(a){return a<d}}};return a}();g.FeatureTileVisibility3D=n;var m=2,k=6,d=12,q=.95,p=f.vec3d.create(),r=new c(Array,function(b){4!==b.length&&(b[0]=new a.FeatureTileDescriptor3D,b[1]=new a.FeatureTileDescriptor3D,b[2]=new a.FeatureTileDescriptor3D,b[3]=new a.FeatureTileDescriptor3D)},
function(a){a[0].release();a[1].release();a[2].release();a[3].release()});g.default=n})},"esri/views/3d/state/Frustum":function(){define("require exports ../lib/gl-matrix ../support/geometryUtils ../support/intersectionUtils ../webgl-engine/lib/Util".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function l(b){this.planes=Array(6);this.points=Array(8);this.lines=Array(12);this.origin=c.vec3d.create();this.direction=c.vec3d.create();this._altitude=null;
this.renderCoordsHelper=b?b.renderCoordsHelper:null;for(b=0;6>b;b++)this.planes[b]=a.plane.create();for(b=0;8>b;b++)this.points[b]=c.vec3d.create();for(b=0;12>b;b++)this.lines[b]={origin:null,direction:c.vec3d.create(),endpoint:null}}l.prototype.update=function(a){b.matrixToFrustumPoints(a.viewMatrix,a.projectionMatrix,this.points);this.updatePoints(this.points);c.vec3d.set(a.eye,this.origin);c.vec3d.set(a.viewForward,this.direction);this._altitude=this.renderCoordsHelper.getAltitude(this.origin);
this.updateLines()};l.prototype.updatePoints=function(a){if(a!==this.points)for(var e=0;e<this.points.length;e++)c.vec3d.set(a[e],this.points[e]);b.frustumPointsToPlanes(this.points,this.planes);this.updateLines()};Object.defineProperty(l.prototype,"altitude",{get:function(){return this._altitude},enumerable:!0,configurable:!0});l.prototype.intersectsSphere=function(a,b){return f.frustumSphere(this.planes,a,b)};l.prototype.intersectsRay=function(a,b,c){return f.frustumRay(this.planes,a,b,c)};l.prototype.intersectsLineSegment=
function(a,b,c){return f.frustumLineSegment(this.planes,a,b,c)};l.prototype.intersectsPoint=function(a){return f.frustumPoint(this.planes,a)};l.prototype.updateLines=function(){for(var a=0;4>a;a++){var b=a,c=a+4;this.updateLine(this.lines[a],this.points[b],this.points[c]);this.updateLine(this.lines[a+4],this.points[b],3===a?this.points[0]:this.points[b+1]);this.updateLine(this.lines[a+8],this.points[c],3===a?this.points[4]:this.points[c+1])}};l.prototype.updateLine=function(a,b,f){a.origin=b;a.endpoint=
f;c.vec3d.direction(f,b,a.direction)};l.planePointIndices={bottom:[5,1,0,4],near:[0,1,2,3],far:[5,4,7,6],right:[1,5,6,2],left:[4,0,3,7],top:[7,3,2,6]};l.nearFarLineIndices=[[0,4],[1,5],[2,6],[3,7]];return l}();g.Frustum=n;g.default=n})},"esri/views/3d/support/FrustumExtentIntersection":function(){define("require exports ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ./earthUtils ./geometryUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m){Object.defineProperty(g,"__esModule",{value:!0});n=.5*Math.PI;var k=n/Math.PI*180,d=n*b.earthRadius,q=.9*b.earthRadius;b=function(){function b(a){this.renderCoordsHelper=a.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:f.vec3d.create(),direction:f.vec3d.create()};for(a=0;4>a;a++)this.extent[a]={origin:f.vec3d.create(),direction:f.vec3d.create(),cap:{next:null,direction:f.vec3d.create()}},this.planes[a]=l.plane.create();
this.planes[4]=l.plane.create();this.planes[5]=l.plane.create();this.planesWithoutFar=this.planes.slice(0,5)}b.prototype.update=function(a,b,c,d){void 0===d&&(d=!0);var e=this.extent;this.toRenderBoundingExtent(a,b,c);f.vec3d.add(e[0].origin,e[2].origin,this.center.origin);f.vec3d.scale(this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);d||f.vec3d.scale(this.center.direction,-1);for(c=0;4>c;c++){var h=e[c];this.renderCoordsHelper.worldUpAtPosition(h.origin,
h.direction);var k=e[3===c?0:c+1];h.cap.next=k.origin;f.vec3d.direction(k.origin,h.origin,h.cap.direction);l.plane.fromVectorsAndPoint(h.direction,h.cap.direction,h.origin,this.planes[c]);d||f.vec3d.scale(h.direction,-1)}l.plane.fromVectorsAndPoint(e[0].cap.direction,e[1].cap.direction,e[0].origin,this.planes[4]);d?l.plane.negate(this.planes[4],this.planes[5]):(l.plane.set(this.planes[5],this.planes[4]),l.plane.negate(this.planes[4]));this.maxSpan=Math.max(Math.abs(a[0]-a[2]),Math.abs(a[1]-a[3]));
this.maxSpanSpatialReference=b};b.prototype.isVisibleInFrustum=function(a,b){void 0===b&&(b=!1);if("global"===this.renderCoordsHelper.type){if(this.maxSpan>(this.maxSpanSpatialReference.isWGS84?k:d))return!0;if(a.altitude>=q)return this.isVisibleInFrustumGlobal(a)}for(var c=0;c<this.extent.length;c++){var f=this.extent[c];if(!b&&a.intersectsRay(f.origin,null,f.direction)||a.intersectsLineSegment(f.origin,f.cap.next,f.cap.direction))return!0}b=b?this.planes:this.planesWithoutFar;for(c=0;c<a.lines.length;c++)if(f=
a.lines[c],e.frustumLineSegment(b,f.origin,f.endpoint,f.direction))return!0;return!1};b.prototype.toRenderBoundingExtentGlobal=function(b,d,e){a.center(b,r);r[2]=e;m.computeLinearTransformation(d,r,u,this.renderCoordsHelper.spatialReference);f.mat4d.inverse(u,t);c.empty(v);for(var k=0,l=p;k<l.length;k++)for(var g=l[k],q=g.x0,x=g.x1,z=g.y0,g=g.y1,A=0;5>A;A++){var n=A/4;r[0]=h.lerp(b[q],b[x],n);r[1]=h.lerp(b[z],b[g],n);r[2]=e;m.vectorToVector(r,d,r,this.renderCoordsHelper.spatialReference);f.mat4d.multiplyVec3(t,
r);c.expandPointInPlace(v,r)}f.mat4d.multiplyVec3(u,f.vec3d.set3(v[0],v[1],v[2],this.extent[0].origin));f.mat4d.multiplyVec3(u,f.vec3d.set3(v[3],v[1],v[2],this.extent[1].origin));f.mat4d.multiplyVec3(u,f.vec3d.set3(v[3],v[4],v[2],this.extent[2].origin));f.mat4d.multiplyVec3(u,f.vec3d.set3(v[0],v[4],v[2],this.extent[3].origin))};b.prototype.toRenderBoundingExtentLocal=function(a,b,c){f.vec3d.set3(a[0],a[1],c,this.extent[0].origin);f.vec3d.set3(a[2],a[1],c,this.extent[1].origin);f.vec3d.set3(a[2],a[3],
c,this.extent[2].origin);f.vec3d.set3(a[0],a[3],c,this.extent[3].origin)};b.prototype.toRenderBoundingExtent=function(a,b,c){switch(this.renderCoordsHelper.type){case "global":this.toRenderBoundingExtentGlobal(a,b,c);break;case "local":this.toRenderBoundingExtentLocal(a,b,c)}};b.prototype.isVisibleInFrustumGlobal=function(a){if(0>f.vec3d.dot(this.center.direction,a.direction))return!0;for(var b=0;4>b;b++)if(0>f.vec3d.dot(this.extent[b].direction,a.direction))return!0;return!1};return b}();g.FrustumExtentIntersection=
b;var p=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],r=f.vec3d.create(),u=f.mat4d.create(),t=f.mat4d.create(),v=c.create();g.default=b})},"esri/views/3d/layers/support/FeatureTileTree3DDebugger":function(){define("require exports ../../../../Graphic ../../../../core/Handles ../../../../core/watchUtils ../../../../symbols/FillSymbol3DLayer ../../../../symbols/PointSymbol3D ../../../../symbols/PolygonSymbol3D ../../../../symbols/TextSymbol3DLayer ../../support/mathUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m){Object.defineProperty(g,"__esModule",{value:!0});var k=[[0,179,255],[117,62,128],[0,104,255],[215,189,166],[32,0,193],[98,162,206],[102,112,129],[52,125,0],[142,118,246],[138,83,0],[92,122,255],[122,55,83],[0,142,255],[81,40,179],[0,200,244],[13,24,127],[0,170,147],[19,58,241],[22,44,35]];n=function(){function d(c){var d=this;this.view=c;this.graphics=[];this.handles=new a;this._enabled=!0;this.symbols=k.map(function(a){return new e(new b({material:{color:[a[0],a[1],
a[2],.6]},outline:{color:"black",size:1}}))});this.handles.add([c.featureTiles.addClient(),f.on(c.featureTiles,"tiles","change",function(){return d.update()},function(){return d.update()})])}Object.defineProperty(d.prototype,"enabled",{get:function(){return this._enabled},set:function(a){this._enabled=a;this.update()},enumerable:!0,configurable:!0});d.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.view&&(this.clear(),this.view=null)};d.prototype.update=
function(){var a=this;this.clear();if(this._enabled){var b=this.view.featureTiles,d=b.tilingScheme,e=b.tiles.toArray().sort(function(a,b){return a.loadPriority-b.loadPriority});e.forEach(function(b,f){var k=b.lij,g=k[0],q=k[1],p=k[2],t=d.getExtentGeometry(g,q,p),k=new c({geometry:t,symbol:a.symbols[g%a.symbols.length]}),r=f/(e.length-1);f=m.lerp(0,200,r);var r=m.lerp(20,6,r),u=b.loadPriority>=e.length;b=new c({geometry:t.center,symbol:new l({verticalOffset:{screenLength:40/.75},callout:{type:"line",
color:"white",border:{color:"black"}},symbolLayers:[new h({text:g+"/"+q+"/"+p+" ("+b.loadPriority+")",halo:{color:"white",size:1/.75},material:{color:[f,u?0:f,u?0:f]},size:r/.75})]})});a.graphics.push(k,b);a.view.graphics.addMany([k,b])})}};d.prototype.clear=function(){this.view.graphics.removeMany(this.graphics);this.graphics=[]};return d}();g.FeatureTileTree3DDebugger=n;g.default=n})},"esri/views/3d/state/ViewState":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators ../../ViewAnimation ../lib/gl-matrix ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/earthUtils ../support/Evented ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function g(a){a=f.call(this,a)||this;a.propertiesPool=new p.default({camera:r},a);a.lastSeenCameraProjectionValues=new r;a.events=new q.Evented;a.updateQueue=new A;a.processingUpdates=!1;return a}c(g,f);g.prototype.destroy=function(){this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};g.prototype.normalizeCtorArgs=function(a){return{camera:this.createInitialCamera(a.viewingMode),
mode:a.viewingMode,spatialReference:a.spatialReference,constraints:new h.default({mode:a.viewingMode})}};Object.defineProperty(g.prototype,"animation",{get:function(){return this.cameraController instanceof m.AnimationController?this.cameraController.viewAnimation:null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"camera",{get:function(){return this._get("camera")},set:function(a){a!==u&&u.copyFrom(a);u.markViewDirty();u.computeUp(this.mode);t.camera=u;this.events.emit("before-camera-change",
t);a=this._get("camera");this.cameraProjectionChanged(this.lastSeenCameraProjectionValues,u)&&(this.lastSeenCameraProjectionValues.copyFrom(u),v.camera=this.lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",v));a&&a.equivalent(u)||this._set("camera",this.propertiesPool.get("camera").copyFrom(u))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"isGlobal",{get:function(){return!this.isLocal},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"isLocal",{get:function(){return"local"===this.mode},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"interacting",{get:function(){return!!this.cameraController&&this.cameraController.isInteractive},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"cameraController",{get:function(){return this._get("cameraController")},set:function(a){var b=this;this.stopActiveCameraController()?(a&&(a.watch("state",function(c){if(c===k.State.Finished||c===k.State.Stopped)b._set("cameraController",
null),b.updateCamera(function(b){a.onControllerEnd(b)})},!0),a.onControllerStart(this.camera)),this._set("cameraController",a)):a&&(a.state=k.State.Rejected)},enumerable:!0,configurable:!0});g.prototype.switchCameraController=function(a){this.cameraController=a;return a.state!==k.State.Rejected};g.prototype.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};g.prototype.cameraChanged=function(){this.updateCamera(function(){})};g.prototype.updateCamera=
function(a){this.updateQueue.enqueue(a);this.processUpdateQueue()};g.prototype.processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var a=this.updateQueue.dequeue();u.copyFrom(this._get("camera"));a(u);this.camera=u;this.processingUpdates=!1;this.processUpdateQueue()}};g.prototype.createInitialCamera=function(a){return"global"===a?new r(e.vec3d.createFrom(4*d.earthRadius,0,0),e.vec3d.createFrom(d.earthRadius,0,0),e.vec3d.createFrom(0,0,1)):
new r(e.vec3d.createFrom(0,0,100),e.vec3d.createFrom(0,0,0),e.vec3d.createFrom(0,1,0))};g.prototype.cameraProjectionChanged=function(a,b){return a.fov!==b.fov||a.fullViewport[0]!==b.fullViewport[0]||a.fullViewport[1]!==b.fullViewport[1]||a.fullViewport[2]!==b.fullViewport[2]||a.fullViewport[3]!==b.fullViewport[3]||a.padding[0]!==b.padding[0]||a.padding[1]!==b.padding[1]||a.padding[2]!==b.padding[2]||a.padding[3]!==b.padding[3]?!0:!1};a([b.property({readOnly:!0,type:l,dependsOn:["cameraController"]})],
g.prototype,"animation",null);a([b.property({type:r})],g.prototype,"camera",null);a([b.property({constructOnly:!0})],g.prototype,"constraints",void 0);a([b.property({readOnly:!0})],g.prototype,"events",void 0);a([b.property({readOnly:!0,dependsOn:["isLocal"]})],g.prototype,"isGlobal",null);a([b.property({readOnly:!0,dependsOn:["mode"]})],g.prototype,"isLocal",null);a([b.property({constructOnly:!0})],g.prototype,"mode",void 0);a([b.property({constructOnly:!0})],g.prototype,"spatialReference",void 0);
a([b.property({readOnly:!0,dependsOn:["cameraController"]})],g.prototype,"interacting",null);a([b.property()],g.prototype,"cameraController",null);return g=a([b.subclass()],g)}(b.declared(f));g.ViewState=n;var u=new r,t={camera:null},v={camera:null},A=function(){function a(){this.data=[];this.length=this.ptr=0}a.prototype.enqueue=function(a){this.data.push(a);this.length++};a.prototype.dequeue=function(){if(0===this.length)return null;var a=this.data[this.ptr++];this.length--;0===this.length&&(this.ptr=
this.data.length=0);return a};return a}();g.default=n})},"esri/views/3d/support/PropertiesPool":function(){define(["require","exports","../../../core/ObjectPool","../../../core/accessorSupport/watch"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function f(b,f){var e=this;this.owner=f;this.properties={};this.afterDispatchHandle=null;for(var h in b)f=new c(b[h],null,null,2,2),this.properties[h]={pool:f,acquired:[]};this.afterDispatchHandle=a.afterDispatch(function(){return e.release()})}
f.prototype.destroy=function(){this.afterDispatchHandle&&(this.afterDispatchHandle.remove(),this.afterDispatchHandle=null);this.owner=null};f.prototype.get=function(a){var b=this.owner._get(a);a=this.properties[a];var c=a.pool.acquire();for(a.acquired.push(c);c===b;)a.acquired.push(c),c=a.pool.acquire();return c};f.prototype.release=function(){for(var b in this.properties){for(var c=this.properties[b],e=0,f=0,g=c.acquired;f<g.length;f++){var k=g[f];a.isValueInUse(k)?c.acquired[e++]=k:c.pool.release(k)}c.acquired.length=
e}};return f}();g.PropertiesPool=n;g.default=n})},"esri/views/3d/state/ViewStateManager":function(){define("require exports ../../../core/tsSupport/assignHelper ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Error ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/Extent ../../../geometry/Point ../../../geometry/ScreenPoint ../../../geometry/support/webMercatorUtils ../camera/constraintUtils ../camera/intersectionUtils ../lib/gl-matrix ./ConstraintsManager ./Frustum ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera ../../animation/easing".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K,N){Object.defineProperty(g,"__esModule",{value:!0});var H=k.getLogger("esri.views.3d.state.ViewStateManager");n=function(e){function k(a){a=e.call(this)||this;a.propertiesPool=new F.default({frustum:D.default},a);a.handles=new m;a.cameraSetByUser=!1;a.internalSetOrder=[];a.immediateGoToPromise=null;a.animatedGoToPromise=null;a.ready=!1;return a}a(k,e);Object.defineProperty(k.prototype,"camera",{get:function(){return this.ready?E.internalToExternal(this.view,
this.view.state.camera):this._get("camera")},set:function(a){this.updatePropertyBeforeReady("camera",a)||this.setStateCamera(E.externalToInternal(this.view,a),{applyConstraints:!1})||H.error("#camera\x3d","Invalid camera",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"center",{get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(a){this.updatePropertyBeforeReady("center",a)||(a?this.isCompatible(a)?this.setStateCamera(this.centerToCamera(a),
{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.forceUpdate():H.error("#center\x3d","Invalid center",a):H.error("#center\x3d","Center has an incompatible spatial reference (center: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):H.error("#center\x3d","Center may not be null or undefined"))},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"extent",{get:function(){return this.ready?E.toExtent(this.view,null,
null,null,U):this._get("extent")},set:function(a){this.updatePropertyBeforeReady("extent",a)||(a?this.isCompatible(a)?this.setStateCamera(this.extentToCamera(a),{applyConstraints:!0})||H.error("#extent\x3d","Invalid extent",a):H.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(a.spatialReference?a.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a):H.error("#extent\x3d","Extent may not be null or undefined"))},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"frustum",{get:function(){var a=this.propertiesPool.get("frustum");a.renderCoordsHelper=this.view.renderCoordsHelper;a.update(this.view.state.camera);return a},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"hasInitialView",{get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"scale",{get:function(){if(!this.ready)return this._get("scale");var a=this.view.pointsOfInterest.centerOnContent;
return E.distanceToScale(this.view,a.distance,a.location.latitude)},set:function(a){this.updatePropertyBeforeReady("scale",a)||this.setStateCamera(this.scaleToCamera(a),{applyConstraints:!0})||H.error("#scale\x3d","Invalid scale",a)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"padding",{get:function(){if(!this.ready)return this._get("padding");var a=this.view.state.camera.padding,b=this._get("padding");return null!==b&&b.top===a[0]&&b.right===a[1]&&b.bottom===a[2]&&b.left===
a[3]?b:{top:a[0],right:a[1],bottom:a[2],left:a[3]}},set:function(a){this.updatePropertyBeforeReady("padding",a)||(a?x.vec4d.set4(a.top||0,a.right||0,a.bottom||0,a.left||0,O):x.vec4d.set4(0,0,0,0,O),this.view.state.updateCamera(function(a){a.padding=O}))},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"screenCenter",{get:function(){var a=this.padding;return new t((this.view.width-(a.left+a.right))/2+a.left,(this.view.height-(a.top+a.bottom))/2+a.top)},enumerable:!0,configurable:!0});
Object.defineProperty(k.prototype,"viewpoint",{get:function(){return this.ready?I.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(a){if(!this.updatePropertyBeforeReady("viewpoint",a))if(a)if(this.isCompatible(a))this.setStateCamera(this.viewpointToCamera(a),{applyConstraints:!a.camera})||H.error("#viewpoint\x3d","Invalid viewpoint",a);else{var b=a.camera?a.camera.position:a.targetGeometry,b=b&&b.spatialReference;H.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+
(b?b.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",a)}else H.error("#viewpoint\x3d","Viewpoint may not be null or undefined")},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"zoom",{get:function(){return this.ready?E.scaleToZoom(this.view,this.scale):this._get("zoom")},set:function(a){this.updatePropertyBeforeReady("zoom",a)||this.setStateCamera(this.zoomToCamera(a),{applyConstraints:!0})||H.error("#zoom\x3d","Invalid zoom",a)},enumerable:!0,configurable:!0});k.prototype.initialize=
function(){var a=this;this.handles.add(this.view.watch("state.camera",function(b){return a.cameraChangedSync(b)},!0),q.on(this.view,"state.events","before-camera-change",function(b){return a.beforeCameraChangeHandle(b.camera)}));q.once(this.view,"state.camera",function(b){return a.updateCameraAboveGround(b)});this.handles.add(this.view.on("resize",function(b){return a.handleResize(b.width,b.height)}));this.handles.add(this.view.watch("state.cameraController",function(){a.cameraSetByUser=!0;a.handles.remove(P);
a.cancelImmediateGoTo()}));this.handles.add(q.on(this.view,"state.events","camera-projection-changed",function(){return a.notifyChange("scale")}))};k.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};k.prototype.init=function(){var a=this;this.constraintsManager=new B.default({view:this.view});this.handleResize(this.view.width,this.view.height);var b=this.getInitialProperties();this.cameraSetByUser=
!1;this._set("ready",!0);for(var c=0;c<b.length;c++){var d=b[c];this.set(d.name,d.value)}this.cameraSetByUser||((b=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(b)?this.setInitialView(b):"local"===this.view.state.mode&&this.handles.add(q.whenOnce(this.view.basemapTerrain,"ready",function(){a.handles.remove(P);a.setInitialView(a.view.groundExtent)}),P))};k.prototype.deinit=function(){this.ready&&(this._override("padding",this.padding),this.cancelImmediateGoTo(),
this.cancelAnimatedGoTo(),this._set("ready",!1),this._clearOverride("hasInitialView"),this.internalSetOrder.length=0,this.cameraSetByUser=!1,this.handles.remove(P),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};k.prototype.goTo=function(a,b){b=c({animate:!0},b);return b.animate?this.goToAnimated(a,b):this.goToImmediate(a,b)};k.prototype.debugSetCameraOnContent=function(){this.setStateCamera(z.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};
k.prototype.step=function(a){var b=this.view.state,c=b&&this.view.state.cameraController;c&&(b.updateCamera(function(b){c.stepController(a,b)}),c.steppingFinished&&c.finishController())};k.prototype.cancelImmediateGoTo=function(){var a=this.immediateGoToPromise;a&&(this.immediateGoToPromise=null,a.cancel())};k.prototype.cancelAnimatedGoTo=function(){var a=this.animatedGoToPromise;a&&(this.animatedGoToPromise=null,a.cancel())};k.prototype.getInitialProperties=function(){for(var a=this,b=new Set,c=
[],d=0,e=T;d<e.length;d++){var f=e[d],h=f.propertyName,f=f.overrides,k=b.has(h),g=this._isOverridden(h);!k&&g&&c.push({name:h,value:this._get(h)});this._clearOverride(h);(k||g)&&f.forEach(function(a){return b.add(a)})}return c.sort(function(b,c){b=a.internalSetOrder.indexOf(b.name);c=a.internalSetOrder.indexOf(c.name);return b<c?-1:b>c?1:0})};k.prototype.setInitialView=function(a){if(a&&!this.cameraSetByUser)if(a instanceof b)this.setStateCamera(E.externalToInternal(this.view,a),{applyConstraints:!1});
else if(a instanceof l)if(a.targetGeometry instanceof r){var c=E.fromExtent(this.view,a.targetGeometry,0,.5,E.OrientationMode.LOCKED);this.setStateCamera(E.externalToInternal(this.view,c),{applyConstraints:!0})}else c={applyConstraints:!a.camera},a=this.viewpointToCamera(a),this.setStateCamera(a,c);else c=E.fromExtent(this.view,a,0,.5,E.OrientationMode.LOCKED),this.setStateCamera(E.externalToInternal(this.view,c),{applyConstraints:!0})};k.prototype.updatePropertyBeforeReady=function(a,b){if(this.ready)return!1;
this._override(a,b);var c=this.internalSetOrder.indexOf(a);-1!==c&&(this.internalSetOrder=this.internalSetOrder.splice(c,1));b&&(this.internalSetOrder.push(a),-1!==M.indexOf(a)&&this._override("hasInitialView",!0));return!0};k.prototype.isCompatible=function(a){return a?a instanceof l?a.camera?this.isCompatible(a.camera):this.isCompatible(a.targetGeometry):a instanceof b?this.isCompatible(a.position):a.spatialReference&&v.canProject(a.spatialReference,this.view.spatialReference):!1};k.prototype.getPreservingHeadingTilt=
function(a){void 0===a&&(a=V);this.cameraSetByUser?(a.heading=this.camera.heading,a.tilt=this.camera.tilt):(a.heading=0,a.tilt=.5);return a};k.prototype.centerPointAtDistanceToCamera=function(a,b,c){void 0===c&&(c=J);var d=this.getPreservingHeadingTilt();return(a=E.getObserverForPointAtDistance(this.view,d.heading,d.tilt,a,b,E.OrientationMode.ADJUST))?(c.copyFrom(this.view.state.camera),c.eye=a.eye,c.center=a.center,c.up=a.up,c):null};k.prototype.centerToCamera=function(a){var b=this.view.pointsOfInterest.centerOnContent;
b.forceUpdate();return this.centerPointAtDistanceToCamera(a,b.distance)};k.prototype.extentToCamera=function(a){var b=this.getPreservingHeadingTilt();a=E.fromExtent(this.view,a,b.heading,b.tilt,E.OrientationMode.ADJUST,U);return E.externalToInternal(this.view,a)};k.prototype.scaleToCamera=function(a){if(null==a)return null;var b=this.view.pointsOfInterest.centerOnContent;b.forceUpdate();var c=b.renderLocation;a=E.scaleToDistance(this.view,a,b.location.latitude);return this.centerPointAtDistanceToCamera(c,
a)};k.prototype.zoomToCamera=function(a){return this.scaleToCamera(E.zoomToScale(this.view,a))};k.prototype.viewpointToCamera=function(a){return(a=I.toCamera(this.view,a))?E.externalToInternal(this.view,a):null};k.prototype.setStateCamera=function(a,b){var c=this;if(!a||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;this.cancelImmediateGoTo();this.view.state.updateCamera(function(d){d.copyFrom(a);b.applyConstraints&&A.applyAll(c.view,d)});b.applyConstraints||(this.view.state.cameraController=
new G.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:a}));return!0};k.prototype.handleResize=function(a,b){var c=this.view.canvas;!c||c.width===a&&c.height===b||(c.width=a,c.height=b);this.view.state&&(c=this.view.state.camera,c.fullWidth!==a||c.fullHeight!==b)&&(J.copyFrom(c),J.fullWidth=a,J.fullHeight=b,this.view.state.camera=J)};k.prototype.beforeCameraChangeHandle=function(a){this.updateCameraAboveGround(a)};k.prototype.cameraChangedSync=function(a){a&&this.view._stage&&this.view._stage.setCamera(a)};
k.prototype.updateCameraAboveGround=function(a){var b=this.view.basemapTerrain,c=this.view.renderCoordsHelper.getAltitude(a.eye),b=b&&b.spatialReference?z.surfaceElevationBelowEye(this.view,a):0;a.relativeElevation=c-b};k.prototype.createGoToCamera=function(a){var c=this;return q.whenOnce(this,"ready",null,!0).then(function(){return I.create(c.view,a)}).then(function(d){var e=!!(a instanceof l&&a.camera||a instanceof b),f=d.camera;if(!c.isCompatible(f))throw d=(d=f.position)&&d.spatialReference,new h("goto:incompatible-spatialreference",
"Resulting camera has an incompatible spatial reference (camera: "+(d?d.wkid:"none")+", view: "+c.view.spatialReference.wkid+")",{camera:f});f=E.externalToInternal(c.view,f);if(!f)throw new h("goto:invalid-camera","Resulting camera is invalid");return{viewpoint:d,camera:f,isFullySpecified:e}})};k.prototype.cancellableGoTo=function(a){var b=this,c;return d.create(function(b,d){c={resolve:b,reject:d};a.asyncResult=c},function(){b.view.state.cameraController===a&&a.active&&a.asyncResult===c&&a.stopController()})};
k.prototype.goToImmediate=function(a,b){var c=this;this.cancelAnimatedGoTo();this.cancelImmediateGoTo();var d=this.createGoToCamera(a).then(function(a){c.immediateGoToPromise===d&&(c.immediateGoToPromise=null);c.setStateCamera(a.camera,{applyConstraints:!a.isFullySpecified})}).catch(function(a){c.immediateGoToPromise===d&&(c.immediateGoToPromise=null);a instanceof h&&a.message&&H.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));throw a;});return this.immediateGoToPromise=
d};k.prototype.goToAnimatedBeforeReady=function(a,b){var c=this;this.cancelAnimatedGoTo();var d=q.whenOnce(this.view,"ready").then(function(){if(d===c.animatedGoToPromise)return c.animatedGoToPromise=null,c.goToAnimated(a,b);throw new h("view:goto-cancelled","Cancelled");});return this.animatedGoToPromise=d};k.prototype.goToAnimated=function(a,b){var c=this;this.cancelAnimatedGoTo();if(!this.ready)return this.goToAnimatedBeforeReady(a,b);var e=this.view.state.cameraController,f;e instanceof C.PointToPointAnimationController&&
(e.updateStateFromViewAnimation(),e.active&&(f=e));null==f&&(f=new C.PointToPointAnimationController(this.view.state,this.view.sceneIntersectionHelper));var k=f.viewAnimation;a=this.createGoToCamera(a);var g=a.then(function(a){return a.viewpoint});k.update(g);if(f!==e&&!this.view.state.switchCameraController(f))return k.stop(),H.error("#goTo()","Cannot start an animation while interacting"),d.reject(new h("view:goto-cannot-interrupt","Cannot start an animation while interacting"));var l=k.target,
m=function(){return c.view.state.cameraController===f&&f.viewAnimation.target===l&&f.active};a.then(function(a){var d=a.viewpoint,e=a.camera;a=a.isFullySpecified;if(m()){f.viewAnimation.update(d);l=f.viewAnimation.target;var h;a?(h=new G.SurfaceCollisionCorrectionController({view:c.view,desiredCamera:e}),A.applySurfaceCollision(c.view,e,1)):A.applyAll(c.view,e);f.begin(e,c.internalAnimateOptions(b));return k.when().then(function(){var a=c.view.state.cameraController;h&&(a&&a.active?a instanceof C.PointToPointAnimationController&&
a.viewAnimation.target===l&&(c.view.state.cameraController=h):f.viewAnimation.target===l&&(c.view.state.cameraController=h))})}}).catch(function(a){a instanceof h&&a.message&&H.error("#goTo()","Failed to create camera from target, "+a.message[0].toLowerCase()+a.message.slice(1));if(m())throw c.view.state.cameraController.stopController(),a;});return this.cancellableGoTo(f)};k.prototype.internalAnimateOptions=function(a){var b={};a&&(null!=a.speedFactor&&(b.speedFactor=a.speedFactor),null!=a.duration&&
(b.duration=a.duration/1E3),null!=a.maxDuration&&(b.maxDuration=a.maxDuration/1E3),null!=a.easing&&(b.easing="string"===typeof a.easing?N.named[a.easing]:a.easing));return b};f([p.property({type:b,dependsOn:["view.state.camera","ready"]})],k.prototype,"camera",null);f([p.property({type:u,dependsOn:["view.pointsOfInterest.centerOnContent.location","ready"]})],k.prototype,"center",null);f([p.property({type:r,dependsOn:["view.state.camera","ready"]})],k.prototype,"extent",null);f([p.property({readOnly:!0,
dependsOn:["view.state.camera","ready"]})],k.prototype,"frustum",null);f([p.property({readOnly:!0,dependsOn:["view.map.initialViewProperties?.viewpoint"]})],k.prototype,"hasInitialView",null);f([p.property({readOnly:!0,type:Boolean})],k.prototype,"ready",void 0);f([p.property({dependsOn:["view.pointsOfInterest.centerOnContent.distance","ready"],type:Number})],k.prototype,"scale",null);f([p.property({dependsOn:["view.state.camera","ready"]})],k.prototype,"padding",null);f([p.property({readOnly:!0,
dependsOn:["view.width","view.height","padding"]})],k.prototype,"screenCenter",null);f([p.property({constructOnly:!0})],k.prototype,"view",void 0);f([p.property({type:l,dependsOn:["camera","ready"]})],k.prototype,"viewpoint",null);f([p.property({type:Number,dependsOn:["scale"]})],k.prototype,"zoom",null);return k=f([p.subclass("esri.views.3d.state.ViewStateManager")],k)}(p.declared(e));g.ViewStateManager=n;var M="camera viewpoint extent scale center zoom".split(" "),T=[{propertyName:"camera",overrides:["viewpoint"]},
{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"center",overrides:[]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],V={heading:0,tilt:0},U=new b,J=new K,O=x.vec4d.create(),P="pending-initial-view";g.default=n})},"esri/views/3d/state/ConstraintsManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/watchUtils ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils ./NearFarHeuristic ./SurfaceCollisionConstraint ../support/mathUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function g(a){var c=f.call(this)||this;c.handles=new b;c.nearFarHeuristic=k.createNearFarHeuristic(a.view.state.mode,a.view.basemapTerrain,a.view.renderCoordsHelper.spatialReference);return c}c(g,f);g.prototype.initialize=function(){var a=this;this.handles.add([this.view.watch(["constraints.clipDistance.near","constraints.clipDistance.far"],function(){return a.handleClipDistanceNearFarChanged()}),this.view.watch("constraints.clipDistance.mode",
function(){return a.handleClipDistanceModeChanged()}),this.view.state.events.on("before-camera-change",function(b){return a.cameraUpdateNearFar(b.camera)}),this.view.watch("dataExtent",function(){return a.updateNearFar()},!0)]);this.handles.add([this.view.watch(["constraints.altitude.min","constraints.altitude.max"],function(){return a.handleAltitudeMinMaxChanged()},!0)]);this.handles.add([this.view.watch("constraints.tilt.max",function(){return a.handleTiltMaxChanged()},!0),this.view.watch("constraints.tilt.mode",
function(){return a.handleTiltModeChanged()},!0),this.view.watch("state.camera",function(){return a.tiltAutoUpdateMax()},!0)]);this.handles.add(this.view.watch(["map.ground.navigationConstraint.type","constraints.collision.enabled"],function(){return a.updateCollision()},!0));this.view.state.isLocal&&this.handles.add(l.init(this.view,"dataExtent",function(b){return a.updateLocalSurfaceDistance(b)}));this.updateNearFar();"local"!==this.view.state.mode&&this.updateAltitude();this.updateTilt();this.updateCollision();
this._set("surfaceCollisionConstraint",new d.default({view:this.view}))};g.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};g.prototype.handleClipDistanceNearFarChanged=function(){var a=this,b=this.view.constraints&&this.view.constraints.clipDistance;b&&"auto"!==b.mode&&this.view.state.updateCamera(function(c){a.cameraUpdateNearFarManual(c,
b);return!0})};g.prototype.handleClipDistanceModeChanged=function(){this.updateNearFar()};g.prototype.updateNearFar=function(){var a=this;this.view.state.updateCamera(function(b){a.cameraUpdateNearFar(b);return!0})};g.prototype.cameraUpdateNearFar=function(a){var b=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(b?b.mode:"auto")?this.cameraUpdateNearFarManual(a,b):this.cameraUpdateNearFarAuto(a,b)};g.prototype.cameraUpdateNearFarAuto=function(a,b){this.nearFarHeuristic.compute(a.eye,
a.center,this.view.dataExtent,m.surfaceElevationBelowEye(this.view,a),a);b&&b.autoUpdate(a.near,a.far)};g.prototype.cameraUpdateNearFarManual=function(a,b){b&&(a.near=b.near,a.far=b.far)};g.prototype.updateCollision=function(){var a=this.view.map&&this.view.map.ground&&this.view.map.ground.navigationConstraint,b=this.view.constraints&&this.view.constraints.collision.enabled,a=a?"stay-above"===a.type:b,b=this.view.state.constraints.collision;a!==b.enabled&&((b.enabled=a)&&this.reapplyConstraints(8),
(a=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==a.mode||this.updateTiltAuto(a))};g.prototype.handleAltitudeMinMaxChanged=function(){this.updateAltitude()};g.prototype.updateAltitude=function(){var a=this.view.constraints&&this.view.constraints.altitude;this.view.state.constraints.altitude=a&&"local"!==this.view.state.mode?{min:a.min,max:a.max}:null;this.reapplyConstraints()};g.prototype.handleTiltModeChanged=function(){this.updateTilt()};g.prototype.handleTiltMaxChanged=function(){var a=
this.view.constraints&&this.view.constraints.tilt;a&&"auto"!==a.mode&&(this.updateTiltManual(a),this.reapplyConstraints())};g.prototype.updateTilt=function(){var a=this.view.constraints&&this.view.constraints.tilt;"manual"===(a?a.mode:"auto")?this.updateTiltManual(a):this.updateTiltAuto(a);this.reapplyConstraints()};g.prototype.updateTiltManual=function(a){var b=this.view.state.constraints;b.tilt=b.createConstantMaxTilt(q.deg2rad(a.max))};g.prototype.updateTiltAuto=function(a){a=this.view.state.constraints;
a.tilt=a.createDefaultTilt();this.tiltAutoUpdateMax()};g.prototype.tiltAutoUpdateMax=function(){var a=this.view.constraints&&this.view.constraints.tilt;if(a&&"auto"===a.mode){var b=this.view.state.constraints;b.tilt&&(b=b.tilt(this.view.state.camera.distance).max,a.autoUpdate(q.rad2deg(b)))}};g.prototype.updateLocalSurfaceDistance=function(a){var b=Math.max(a.width,a.height);0>=b||(a.hasZ&&(b=Math.max(b,a.zmax-a.zmin)),a=this.view.state,b=3*b/Math.atan(a.camera.fov/2),b!==a.constraints.distance&&
(a.constraints.distance=b))};g.prototype.reapplyConstraints=function(a){var b=this;void 0===a&&(a=15);this.view.state.updateCamera(function(c){return h.applyAll(b.view,c,{selection:a,interactionType:0,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:0})})};a([e.property({constructOnly:!0})],g.prototype,"view",void 0);a([e.property({readOnly:!0})],g.prototype,"surfaceCollisionConstraint",void 0);return g=a([e.subclass("esri.views.3d.state.ConstraintsManager")],
g)}(e.declared(f));g.ConstraintsManager=n;g.default=n})},"esri/views/3d/state/NearFarHeuristic":function(){define("require exports ../../../geometry/support/scaleUtils ../lib/gl-matrix ../support/earthUtils ../support/mathUtils".split(" "),function(n,g,c,a,f,b){function l(a,b,c,d){c=k/c;a/b>c?(d.far=a,d.near=d.far/b):(d.near=c,d.far=d.near*b);return d}Object.defineProperty(g,"__esModule",{value:!0});g.createNearFarHeuristic=function(a,b,c){return"global"===a?new h:new e(b,c)};var e=function(){function e(a,
b){this.elevationProvider=a;this.unitInMeters=c.getMetersPerUnitForSR(b)}e.prototype.compute=function(c,e,h,k,g){g||(g={near:0,far:0});var t=f.earthRadius,u=c[2]*this.unitInMeters,v=u;k=u-k;var x=this.elevationProvider?this.elevationProvider.getElevationBounds():null;x&&(u=0<=k?v-this.unitInMeters*x[0]:this.unitInMeters*x[1]-v);v=Math.max(h.xmax-h.xmin,h.ymax-h.ymin,4*Math.max(h.xmax-h.xmin,h.ymax-h.ymin));a.vec3d.subtract(e,c,r);p[0]=0<r[0]?h.xmax:h.xmin;p[1]=0<r[1]?h.ymax:h.ymin;p[2]=0<r[2]?v/2:
-v/2;a.vec3d.subtract(p,c);a.vec3d.normalize(r);c=1.1*a.vec3d.dot(p,r)*this.unitInMeters;t=Math.sqrt(u*(u+2*t));h=Math.max(h.xmax-h.xmin,h.ymax-h.ymin);e=h*q*this.unitInMeters;u=b.clamp((u-e)/(h*d*this.unitInMeters-e),0,1);u=b.lerp(t,c,u*u*u);u*=Math.max(Math.log(Math.abs(k)),1);u=Math.min(u,Math.max(34064E4,v));u/=this.unitInMeters;return l(u,m,this.unitInMeters,g)};return e}(),h=function(){function c(){}c.prototype.compute=function(c,d,e,h,k){k||(k={near:0,far:0});d=f.earthRadius;c=a.vec3d.length(c)-
d;c=Math.max(Math.abs(c-h),Math.abs(c));h=Math.sqrt(c*(c+2*(d+Math.min(0,h))));c=b.clamp(2E4-(Math.log(c)-7.983)/9.011*19E3,1E3,2E4);return l(1.2*h,c,1,k)};return c}(),m=2E4,k=2,d=.001,q=1E-4,p=a.vec3d.create(),r=a.vec3d.create()})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../camera/constraintUtils ../camera/intersectionUtils".split(" "),
function(n,g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function k(a){a=f.call(this)||this;a.handles=new b;return a}c(k,f);k.prototype.initialize=function(){var a=this;this.handles.add(this.view.basemapTerrain.on("elevation-change",function(b){return a.handleElevationChangeEvent(b)}))};k.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};k.prototype.handleElevationChangeEvent=function(a){if(this.view.state.cameraController)return!1;
h.eyeWithinExtent(this.view,this.view.state.camera,a.extent,a.spatialReference)&&this.applyToCurrentCamera()};k.prototype.applyToCurrentCamera=function(){var a=this;this.view.state.updateCamera(function(b){e.applySurfaceCollision(a.view,b,1)})};a([l.property({constructOnly:!0})],k.prototype,"view",void 0);return k=a([l.subclass("esri.views.3d.state.ElevationCollisionConstraint")],k)}(l.declared(f));g.SurfaceCollisionConstraint=n;g.default=n})},"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Handles ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController".split(" "),
function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});n=function(e){function h(b){var c=e.call(this)||this;c.handles=new a;c.view=b.view;c.desiredCamera=b.desiredCamera.copy();return c}c(h,e);Object.defineProperty(h.prototype,"canStop",{get:function(){return!0},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"constraintEnabled",{get:function(){return this.view.state.constraints.collision.enabled},enumerable:!0,configurable:!0});h.prototype.onControllerStart=function(a){var b=
this;e.prototype.onControllerStart.call(this,a);this.handles.add(this.view.basemapTerrain.on("elevation-change",function(a){return b.handleElevationChangeEvent(a)}));this.applyCorrection()};h.prototype.onControllerEnd=function(a){this.handles.removeAll();e.prototype.onControllerEnd.call(this,a)};h.prototype.handleElevationChangeEvent=function(a){b.eyeWithinExtent(this.view,this.desiredCamera,a.extent,a.spatialReference)&&this.applyCorrection()};h.prototype.applyCorrection=function(){var a=this;this.view.state.updateCamera(function(b){b.copyViewFrom(a.desiredCamera);
f.applySurfaceCollision(a.view,b,1)||a.constraintEnabled||(a.state=l.State.Stopped)})};return h}(l.CameraController);g.SurfaceCollisionCorrectionController=n})},"esri/views/3d/support/viewpointUtils":function(){define("require exports ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ../lib/gl-matrix ./cameraUtils ./intersectionUtils ./mathUtils ./projectionUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t){function v(a){return 360-u.cyclicalDeg.normalize(a)}function A(a){return u.cyclicalDeg.normalize(360-a)}function z(a,b){a&&(null==b?a.reject():a.resolve(b));return b}function x(b,c,d,e){if(!c)return z(e);var f=b.spatialReference||a.SpatialReference.WGS84;if(c.camera){b=c.get("camera.position.spatialReference");if(!k.canProject(b,f))return z(e);c=c.camera.clone();b.equals(f)||(c.position=k.project(c.position,f));return z(e,c)}var h=c.get("targetGeometry.spatialReference");
if(h&&!k.canProject(h,f))return z(e);f=p.internalToExternal(b,b.state.camera);h=p.OrientationMode.ADJUST;null!=c.rotation&&(f.heading=v(c.rotation),h=p.OrientationMode.LOCKED);null!=d&&(f.tilt=d);if("point"===c.targetGeometry.type){d=c.targetGeometry;var g=void 0,l=c.targetGeometry.clone(),g=null!=c.scale?p.scaleToDistance(b,c.scale,d.latitude):b.state.camera.distance;return p.fromCenterDistance(b,l,g,f,h,e)}return p.fromExtent(b,c.targetGeometry.extent,f.heading,f.tilt,h,e)}function B(a,b){var c=
b.scale;null==c&&null!=b.zoom&&(c=p.zoomToScale(a,b.zoom));return c}function D(a,b){var c=!1;null!=b.heading?(a.heading=b.heading,c=!0):null!=b.rotation&&(a.heading=v(b.rotation),c=!0);null!=b.tilt&&(a.tilt=b.tilt,c=!0);null!=b.fov&&(a.fov=b.fov);return c}function C(b,c,d){var e=b.spatialReference||a.SpatialReference.WGS84;c=c||p.externalToInternal(b,d.camera);d.targetGeometry=t.vectorToPoint(c.center,b.renderSpatialReference,e);d.scale=p.computeScale(b,c);d.rotation=A(d.camera.heading);return d}
function G(a,b,c){if(b){if(!k.canProject(b.spatialReference,a.spatialReference))throw new l("viewpointutils:incompatible-spatialreference","Spatial reference ("+(b.spatialReference?b.spatialReference.wkid:"unknown")+") is incompatible with the view ("+a.spatialReference.wkid+")",{geometry:b});var d=[];if(!b.hasZ&&a.basemapTerrain){var e=void 0;switch(b.type){case "point":e=b;break;case "multipoint":case "polyline":case "mesh":e=b.extent.center;break;case "extent":e=b.center;break;case "polygon":e=
b.centroid}e&&k.canProject(e,a.basemapTerrain.spatialReference)?O[2]=a.basemapTerrain.getElevation(e)||0:O[2]=0}(0,W[b.type])(b,function(a){d.push(a[0],a[1],a[2])},O);var f=d.length/3;if(0!==f&&(e=Array(d.length),t.bufferToBuffer(d,b.spatialReference,0,e,a.spatialReference,0,f)))for(b.hasZ&&(c.hasZ=!0),a=0;a<e.length;a+=3)b.hasZ?(O[0]=e[a+0],O[1]=e[a+1],O[2]=e[a+2]):(O[0]=e[a+0],O[1]=e[a+1]),h.expand(c.boundingBox,O)}}function E(a,b,c,d){return a.whenViewForGraphic(b).then(function(a){if(a&&a.whenGraphicBounds)return a.whenGraphicBounds(b,
{minDemResolution:c})}).then(function(a){var b=a.boundingBox;h.expand(d.boundingBox,b);a.screenSpaceObjects&&a.screenSpaceObjects.forEach(function(a){d.screenSpaceObjects.push(a)});isFinite(b[2])&&(d.hasZ=!0)}).catch(function(){G(a,b.geometry,d)})}function F(b,c,d,h){if(Array.isArray(c)&&2===c.length){var k=c[0],g=c[1];if("number"===typeof k&&"number"===typeof g)return da.x=k,da.y=g,da.z=void 0,da.spatialReference=a.SpatialReference.WGS84,G(b,da,h),e.resolve()}if(c&&"function"===typeof c.map)return e.eachAlways(c.map(function(a){return F(b,
a,d,h)}));if(c instanceof a.BaseGeometry)try{G(b,c,h)}catch(X){return e.reject(X)}else if(c instanceof f)return E(b,c,d,h);return e.resolve()}function I(a,b,c,d){if(b.camera)return e.resolve(K(a,c,b.camera,d));d.scale=b.scale;d.rotation=b.rotation;d.targetGeometry=b.targetGeometry?b.targetGeometry.clone():null;d.camera=null;null!=c.heading?d.rotation=A(c.heading):null!=c.rotation&&(d.rotation=c.rotation);b=B(a,c);null!=b&&(d.scale=b);b=e.createResolver();x(a,d,c.tilt,b);return b.promise.then(function(a){d.camera=
a;return d})}function K(a,b,c,d){d.camera=c.clone();d.camera.fov=a.camera.fov;b=a.spatialReference;c=d.camera.position.spatialReference;if(!k.canProject(c,b))return null;c.equals(b)||(d.camera.position=k.project(d.camera.position,b));return C(a,null,d)}function N(b,c,d,e,f){var h=b.renderSpatialReference;t.pointToVector(d.position,aa,h);t.pointToVector(c,ea,h);f.targetGeometry=new a.Point(c);f.camera.position=new a.Point(d.position);q.vec3d.subtract(ea,aa,S);p.directionToHeadingTilt(b,aa,S,e.up,f.camera);
f.scale=p.distanceToScale(b,q.vec3d.dist(aa,ea),f.targetGeometry.latitude);f.rotation=A(f.camera.heading);return f}function H(a,b,c,f){if(!c)return e.reject();f.targetGeometry=c.clone();var h=d.cameraOnContentAlongViewDirection(a);if(b.position)return e.resolve(N(a,f.targetGeometry,b,h,f));if(b.zoomFactor){var k=h.distance/b.zoomFactor,g=q.vec3d.scale(h.viewForward,-k,O);q.vec3d.add(h.center,g,h.eye);h.markViewDirty();f.scale=p.distanceToScale(a,k,c.latitude)}p.internalToExternal(a,h,f.camera);k=
D(f.camera,b)?p.OrientationMode.LOCKED:p.OrientationMode.ADJUST;return b.zoomFactor?e.resolve(f):(f.scale=B(a,b),null==f.scale&&(t.pointToVector(c,O,a.renderSpatialReference),r.frustumPoint(h.frustumPlanes,O)?f.scale=p.distanceToScale(a,q.vec3d.dist(h.eye,O),c.latitude):f.scale=p.computeScale(a,h)),b=e.createResolver(),p.fromCenterScale(a,f.targetGeometry,f.scale,f.camera,k,b),b.promise.then(function(a){f.camera=a;return f}))}function M(a,b,c,f){f.targetGeometry=c.clone();var h=d.cameraOnContentAlongViewDirection(a);
p.internalToExternal(a,h,f.camera);b=D(f.camera,b)?p.OrientationMode.LOCKED:p.OrientationMode.ADJUST;h=e.createResolver();p.fromExtent(a,c,f.camera.heading,f.camera.tilt,b,h);return h.promise.then(function(a){f.camera=a;return f})}function T(a,b,c,d,e){var f=0;c.hasZ?f=c.z:a.basemapTerrain&&(f=a.basemapTerrain.getElevation(c));q.vec3d.set3(c.x,c.y,f,O);t.computeLinearTransformation(a.spatialReference,O,P,a.renderSpatialReference);q.mat4d.toMat3(P,R);q.mat3d.transpose(R);h.empty(Q);c=[[0,1,2],[3,1,
2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var k=0;k<c.length;k++){var g=c[k],l=d[g[2]];isFinite(l)||(l=f);q.vec3d.set3(d[g[0]],d[g[1]],l,O);t.vectorToVector(O,a.spatialReference,O,a.renderSpatialReference);h.expand(Q,q.mat3d.multiplyVec3(R,O))}a=h.width(Q);d=h.height(Q);f=h.depth(Q);c=1/Math.tan(b.fovY/2);return Math.max(.5*Math.sqrt(a*a+f*f)*Math.max(c,1/Math.tan(b.fovX/2))+.5*d,.5*d*c+.5*Math.max(a,f))/e}function V(a,b,c,f,h,k){k.targetGeometry=c.clone();var g=d.cameraOnContentAlongViewDirection(a);
c=T(a,g,c,f,h);p.internalToExternal(a,g,k.camera);b=D(k.camera,b)?p.OrientationMode.LOCKED:p.OrientationMode.ADJUST;k.scale=p.distanceToScale(a,c,k.targetGeometry.latitude);g=e.createResolver();p.fromCenterScale(a,k.targetGeometry,k.scale,k.camera,b,g);return g.promise.then(function(a){k.camera=a;return k})}function U(a,b){if(!b||!a.spatialReference)return null;a={target:null};if("declaredClass"in b||Array.isArray(b))a.target=b;else{for(var c in b)a[c]=b[c];b.center&&!a.target&&(a.target=b.center)}return a}
function J(a){a&&(a.rotation=A(a.camera.heading));return a}Object.defineProperty(g,"__esModule",{value:!0});g.DEFAULT_FRAME_COVERAGE=.66;g.rotationToHeading=v;g.headingToRotation=A;g.toCamera=x;g.fromInternalCamera=function(a,d,e){e||(e=new b({camera:new c}));p.internalToExternal(a,d,e.camera);return C(a,d,e)};g.fromCamera=function(a,c,d){d||(d=new b);d.camera=c.clone();return C(a,null,d)};g.create=function(f,k){var r=U(f,k);if(!r)return e.reject(new l("viewpointutils-create:no-target","Missing target for creating viewpoint"));
var u=new b({camera:new c({fov:f.camera.fov})}),v=null!=r.scale||null!=r.zoom;if(r.target instanceof b)return I(f,r.target,r,u).then(function(a){return J(a)});if(r.target instanceof c)return e.resolve(J(K(f,r,r.target,u)));if(r.target instanceof a.Extent)return k=r.target.xmin===r.target.xmax||r.target.ymin===r.target.ymax,v||k?H(f,r,r.target.center,u).then(function(a){return J(a)}):M(f,r,r.target,u).then(function(a){return J(a)});var x={boundingBox:h.empty(),hasZ:!1,screenSpaceObjects:[]};k=v?p.scaleToResolution(f,
B(f,r)):void 0;return F(f,r.target,k,x).then(function(){if(isFinite(x.boundingBox[0])){h.center(x.boundingBox,O);da.x=O[0];da.y=O[1];da.z=O[2];da.spatialReference=f.spatialReference;var b=void 0;isFinite(da.z)&&x.hasZ?b=h.isPoint(x.boundingBox):(da.z=void 0,b=m.isPoint(h.toRect(x.boundingBox,L)));if(v||b)return H(f,r,da,u);var b=x.screenSpaceObjects,c=g.DEFAULT_FRAME_COVERAGE;if(b.length){for(var e=Number.NEGATIVE_INFINITY,k=0;k<b.length;k++)var l=b[k].screenSpaceBoundingRect,e=Math.max(e,Math.abs(l[0]),
Math.abs(l[1]),Math.abs(l[2]),Math.abs(l[3]));b=c-e/Math.min(f.width,f.height)*2}else b=c;return V(f,r,da,x.boundingBox,b,u)}if(r.position)return b=d.cameraOnContentAlongViewDirection(f),q.vec3d.set(b.viewForward,S),p.directionToHeadingTilt(f,b.eye,S,b.up,Z),u.camera.position=new a.Point(r.position),u.camera.heading=null!=r.heading?r.heading:Z.heading,u.camera.tilt=null!=r.tilt?r.tilt:Z.tilt,C(f,null,u);b=d.cameraOnContentAlongViewDirection(f);b=t.vectorToPoint(b.center,f.renderSpatialReference,da,
f.spatialReference);return H(f,r,b,u)}).then(function(a){return J(a)})};var O=q.vec3d.create(),P=q.mat4d.create(),R=q.mat3d.create(),Q=h.create(),L=m.create(),S=q.vec3d.create(),aa=q.vec3d.create(),ea=q.vec3d.create(),Z={heading:0,tilt:0},da=new a.Point,W={point:function(a,b,c){c[0]=a.x;c[1]=a.y;a.hasZ&&(c[2]=a.z);b(c)},polygon:function(a,b,c){for(var d=a.hasZ,e=0;e<a.rings.length;e++)for(var f=a.rings[e],h=0;h<f.length;h++)c[0]=f[h][0],c[1]=f[h][1],d&&(c[2]=f[h][2]),b(c)},polyline:function(a,b,c){for(var d=
a.hasZ,e=0;e<a.paths.length;e++)for(var f=a.paths[e],h=0;h<f.length;h++)c[0]=f[h][0],c[1]=f[h][1],d&&(c[2]=f[h][2]),b(c)},multipoint:function(a,b,c){var d=a.points;a=a.hasZ;for(var e=0;e<d.length;e++)c[0]=d[e][0],c[1]=d[e][1],a&&(c[2]=d[e][2]),b(c)},extent:function(a,b,c){a.hasZ?(b(q.vec3d.set3(a.xmin,a.ymin,a.zmin,c)),b(q.vec3d.set3(a.xmax,a.ymin,a.zmin,c)),b(q.vec3d.set3(a.xmin,a.ymax,a.zmin,c)),b(q.vec3d.set3(a.xmax,a.ymax,a.zmin,c)),b(q.vec3d.set3(a.xmin,a.ymin,a.zmax,c)),b(q.vec3d.set3(a.xmax,
a.ymin,a.zmax,c)),b(q.vec3d.set3(a.xmin,a.ymax,a.zmax,c)),b(q.vec3d.set3(a.xmax,a.ymax,a.zmax,c))):(b(q.vec3d.set3(a.xmin,a.ymin,c[2],c)),b(q.vec3d.set3(a.xmax,a.ymin,c[2],c)),b(q.vec3d.set3(a.xmin,a.ymax,c[2],c)),b(q.vec3d.set3(a.xmax,a.ymax,c[2],c)))},mesh:function(a,b,c){if(a=a.vertexAttributes&&a.vertexAttributes.position)for(var d=0;d<a.length;d+=3)b(q.vec3d.set3(a[d+0],a[d+1],a[d+2],c))}}})},"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define(["require","exports","../../lib/gl-matrix",
"../../webgl-engine/lib/Selector","../../webgl-engine/lib/SelectorUtils"],function(n,g,c,a,f){function b(a,b,f,g,k){f?c.vec3d.set(b.eye,g):c.vec3d.unproject(c.vec3d.createFrom(a[0],a[1],0),b.viewMatrix,b.projectionMatrix,b.fullViewport,g);c.vec3d.unproject(c.vec3d.createFrom(a[0],a[1],1),b.viewMatrix,b.projectionMatrix,b.fullViewport,k)}Object.defineProperty(g,"__esModule",{value:!0});n=function(){function g(b,f,g){this.viewingMode=b;this.layerProvider=f;this.viewPropertyProvider=g;this.tmpR0=c.vec3d.create();
this.tmpR1=c.vec3d.create();this.tmpScreenPoint=c.vec2d.create();this.tmpScreenPointHud=c.vec2d.create();this.tmpPointHud=c.vec3d.create();this.tmpSelector=new a(this.viewingMode);this.externalIntersectionHandlers=new Set;this.intersectionTolerance=a.DEFAULT_TOLERANCE;this.validateHUDSelector=new a(this.viewingMode);this.validateHUDSelector.enableHUDSelection=!1}g.prototype.getPickRay=function(a,f,g){void 0===f&&(f=c.vec3d.create());void 0===g&&(g=c.vec3d.create());var e=this.viewPropertyProvider.camera();
b(a,e,!1,f,g)};g.prototype.pickPointInScreen=function(a,c,f){var e=this.viewPropertyProvider.camera();b(a,e,!1,this.tmpR0,this.tmpR1);return this.pickPointFromSegment(this.tmpR0,this.tmpR1,c,f)};g.prototype.pickPointFromSegment=function(a,b,c,f){f=this.computeIntersection(a,b,null,null,!1,f||this.tmpSelector);c=f?(a=f.minResult)?a.getIntersectionPoint(c):!1:!1;return c};g.prototype.pickFreePointInScreen=function(a,c){var e=this.viewPropertyProvider.camera();b(a,e,!1,this.tmpR0,this.tmpR1);this.pickFreePointFromSegment(this.tmpR0,
this.tmpR1,c)};g.prototype.pickFreePointFromSegment=function(a,b,f){c.vec3d.set(a,this.tmpR0);c.vec3d.set(b,this.tmpR1);c.vec3d.subtract(this.tmpR1,this.tmpR0);c.vec3d.normalize(this.tmpR1);var e=this.viewPropertyProvider.extent();a=Math.max(e.xmax-e.xmin,e.ymax-e.ymin,8*Math.max(e.xmax-e.xmin,e.ymax-e.ymin));var d=this.viewPropertyProvider.camera();b=Math.max(0,e.xmin-d.eye[0],d.eye[0]-e.xmax);e=Math.max(0,e.ymin-d.eye[1],d.eye[1]-e.ymax);d=a/Math.max(1,Math.pow(Math.max(0,Math.log(a/(Math.abs(d.relativeElevation)+
Number.MIN_VALUE))),2));d=Math.max(d,Math.min(Math.sqrt(b*b+e*e),a));c.vec3d.scale(this.tmpR1,d);c.vec3d.add(this.tmpR0,this.tmpR1,f)};g.prototype.pickSelectorInScreen=function(a,c,f,k){void 0===k&&(k=!1);var d=this.viewPropertyProvider.camera();b(a,d,!1,this.tmpR0,this.tmpR1);return this.computeIntersection(this.tmpR0,this.tmpR1,a,f,k,c)};g.prototype.setTolerance=function(b){void 0===b&&(b=a.DEFAULT_TOLERANCE);this.intersectionTolerance=b};g.prototype.addIntersectionHandler=function(a){this.externalIntersectionHandlers.add(a)};
g.prototype.removeIntersectionHandler=function(a){this.externalIntersectionHandlers.delete(a)};g.prototype.computeIntersection=function(e,h,g,k,d,l){var m=this,q=this.viewPropertyProvider.camera();g||(g=this.tmpScreenPoint,q.projectPoint(h,g));var u=this.layerProvider.getPickableLayers();k&&(u=u.filter(function(a){return k.has(a.id)}));var t=this.viewPropertyProvider.slicePlane(),t=t?f.sliceFilterPredicate(t):null;l=l||new a(this.viewingMode);l.init(u,e,h,g,q,this.intersectionTolerance,d,t);this.externalIntersectionHandlers.forEach(function(a){a.intersect(l,
e,h,g)});if(l.hudResults.length){var v=l.hudResults;v.sort(function(a,b){return b.dist-a.dist});var v=v[v.length-1],n=this.tmpScreenPointHud;q.projectPoint(v.center,n);n[0]=Math.round(n[0]);n[1]=Math.round(n[1]);var z=this.tmpPointHud;b(n,q,!1,e,z);var x=c.vec3d.dist(v.center,e)/c.vec3d.dist(e,z)*.99;this.validateHUDSelector.init(u,e,z,n,q,this.intersectionTolerance,d,t);this.externalIntersectionHandlers.forEach(function(a){a.intersect(m.validateHUDSelector,e,z,n)});d=this.validateHUDSelector.minResult;
(null==d.dist||x<=d.dist)&&l.minResult.copyFrom(v)}return l};return g}();g.SceneIntersectionHelper=n})},"esri/views/3d/webgl-engine/lib/SelectorUtils":function(){define(["require","exports","../../lib/gl-matrix","../../support/geometryUtils/boundedPlane"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.sliceFilterPredicate=function(b){return function(g,e,h){c.vec3d.lerp(g,e,h,f);return!a.extrusionContainsPoint(b,f)}};var f=c.vec3d.create()})},"esri/views/3d/support/geometryUtils/boundedPlane":function(){define(["require",
"exports","../../../../core/Logger","../../lib/gl-matrix","./plane"],function(n,g,c,a,f){function b(b){void 0===b&&(b=g.UP);return{origin:a.vec3d.create(b.origin),basis1:a.vec3d.create(b.basis1),basis2:a.vec3d.create(b.basis2)}}function l(a,b){void 0===b&&(b=f.create());return f.fromVectorsAndPoint(a.basis2,a.basis1,a.origin,b)}function e(b,c){a.vec3d.subtract(c,b.origin,k);c=a.vec3d.length2(b.basis1);var d=a.vec3d.length2(b.basis2),e=a.vec3d.dot(b.basis1,k);b=a.vec3d.dot(b.basis2,k);return 0>-e-
c&&0>e-c&&0>-b-d&&0>b-d}Object.defineProperty(g,"__esModule",{value:!0});var h=c.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");g.create=b;g.set=function(b,c){a.vec3d.set(c.origin,b.origin);a.vec3d.set(c.basis1,b.basis1);a.vec3d.set(c.basis2,b.basis2);return b};g.fromValues=function(c,d,e,f){void 0===f&&(f=b());a.vec3d.set(c,f.origin);a.vec3d.set(d,f.basis1);a.vec3d.set(e,f.basis2);1E-6<Math.abs(a.vec3d.dot(f.basis1,f.basis2))&&h.warn("fromValues()","Provided basis vectors are not perpendicular");
return f};g.toPlane=l;g.intersectRay=function(a,b,c,d){l(a,m);return f.intersectRay(m,b,c,d)?e(a,b):!1};g.extrusionContainsPoint=function(b,c){a.vec3d.cross(b.basis1,b.basis2,d);var f=-a.vec3d.dot(d,b.origin);return 0>a.vec3d.dot(d,c)+f&&e(b,c)};var m=f.create(),k=a.vec3d.create(),d=a.vec3d.create();g.UP={origin:a.vec3d.createFrom(0,0,0),basis1:a.vec3d.createFrom(1,0,0),basis2:a.vec3d.createFrom(0,1,0)}})},"esri/views/3d/support/CombinedElevationProvider":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/Accessor ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../layers/graphics/ElevationQuery ./Evented".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d){return function(b){function d(a){var c=b.call(this)||this;c.providers={im:[],ground:[],scene:[]};c.handles=new Map;c.elevationChange=function(a){c.emit("elevation-change",a)};return c}c(d,b);d.prototype.getElevation=function(a,b){var c=-Infinity,d=!0;"scene"===b&&(c=this._updateElevation(c,this.providers.im,a,b),isFinite(c)&&(d=!1));d&&(c=this._updateElevation(c,this.providers.ground,a,b));"scene"===b&&(c=this._updateElevation(c,this.providers.scene,a,b));return isFinite(c)?
c:null};d.prototype._updateElevation=function(a,b,c,d){for(var e=0;e<b.length;e++){var f=b[e].getElevation(c,d);null!=f&&(a=Math.max(f,a))}return a};d.prototype.queryElevation=function(a,b,c){var d=this;void 0===b&&(b=0);this._elevationService||(this._elevationService=new k.ElevationQuery(this.view.spatialReference,function(){return d.view.map&&d.view.map.ground},{maximumAutoTileRequests:4}));var f=e.createResolver();(m.isPoint(a)?this._elevationService.queryElevation(a.x,a.y,b):this._elevationService.queryElevation(a[0],
a[0],b)).then(function(b){"scene"===c&&(b=d._updateElevation(b,d.providers.scene,a,c));f.resolve(isFinite(b)?b:null)}).catch(function(){return f.resolve(d.getElevation(a))});return f.promise};d.prototype.register=function(a,b){this.handles.set(b,b.on("elevation-change",this.elevationChange));this.providers[a].push(b)};d.prototype.unregister=function(a){this.handles.has(a)&&(this.handles.get(a).remove(),this.handles.delete(a));for(var b=0,c=Object.keys(this.providers);b<c.length;b++){var d=c[b],e=
this.providers[d].indexOf(a);-1<e&&this.providers[d].splice(e,1)}};a([h.property({constructOnly:!0})],d.prototype,"view",void 0);a([h.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],d.prototype,"spatialReference",void 0);return d=a([h.subclass("esri.views.3d.support.CombinedElevationProvider")],d)}(h.declared(l,d.Evented))})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/assignHelper dojo/Deferred ../../../../geometry ../../../../core/scheduling".split(" "),
function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function b(a,b){this.spatialReference=a;this.view=b;this.point=new l.Point;this.point.spatialReference=a}b.prototype.getElevation=function(a,b,c){this.point.x=a;this.point.y=b;return this.view.elevationProvider.getElevation(this.point,c)};b.prototype.queryElevation=function(b,e,d,f){return a(this,void 0,void 0,function(){return c(this,function(a){this.point.x=b;this.point.y=e;return[2,this.view.elevationProvider.queryElevation(this.point,
d,f)]})})};return b}();g.ViewElevationProvider=n;n=function(){function h(a,b,c){this.spatialReference=a;this._getElevationQueryProvider=b;this._queries=[];this._isScheduled=!1;this._queryOptions=f({},c,{ignoreInvisibleLayers:!0})}h.prototype.queryElevation=function(e,f,d){void 0===d&&(d=0);return a(this,void 0,void 0,function(){var a;return c(this,function(c){a=new b;this._queries.push({x:e,y:f,minDemResolution:d,result:a});this._scheduleDoQuery();return[2,a.promise]})})};h.prototype._scheduleDoQuery=
function(){var a=this;this._isScheduled||(e.schedule(function(){return a._doQuery()}),this._isScheduled=!0)};h.prototype._doQuery=function(){return a(this,void 0,void 0,function(){var a,b,d,e,h,g,u,t,v;return c(this,function(c){switch(c.label){case 0:this._isScheduled=!1;a=this._queries;this._queries=[];b=a.map(function(a){return[a.x,a.y]});d=a.reduce(function(a,b){return Math.min(a,b.minDemResolution)},Infinity);e=new l.Multipoint({points:b,spatialReference:this.spatialReference});h=this._getElevationQueryProvider();
if(!h)return a.forEach(function(a,b){return a.result.reject()}),[2];u=f({},this._queryOptions,{minDemResolution:d});c.label=1;case 1:return c.trys.push([1,3,,4]),[4,h.queryElevation(e,u)];case 2:return g=c.sent(),[3,4];case 3:return t=c.sent(),a.forEach(function(a){return a.result.reject(t)}),[2];case 4:return v=g.geometry.points,a.forEach(function(a,b){return a.result.resolve(v[b][2])}),[2]}})})};return h}();g.ElevationQuery=n})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["require",
"exports","../../../core/has"],function(n,g,c){var a=c("esri-mobile"),f=c("esri-iPhone");n=function(){function a(){}a.isValidProfile=function(b){return b in a.profiles};a.getDefaultProfile=function(){return c("trident")||f?"low":"medium"};a.apply=function(b,c){b=a.profiles[b];c.graphics3D.maxTotalNumberOfFeatures=b.graphics3D.maxTotalNumberOfFeatures;c.graphics3D.maxTotalNumberOfVertices=b.graphics3D.maxTotalNumberOfVertices;c.sceneService["3dObject"].lodFactor=b.sceneService["3dObject"].lodFactor;
c.sceneService.point.lodFactor=b.sceneService.point.lodFactor;c.sceneService.integratedMesh.lodFactor=b.sceneService.integratedMesh.lodFactor;c.sceneService.pointCloud.lodFactor=b.sceneService.pointCloud.lodFactor;c.sceneService.uncompressedTextureDownsamplingEnabled=b.sceneService.uncompressedTextureDownsamplingEnabled;c.tiledSurface.lodBias=b.tiledSurface.lodBias;c.tiledSurface.angledSplitBias=b.tiledSurface.angledSplitBias;c.antialiasingEnabled=b.antialiasingEnabled;c.gpuMemoryLimit=b.gpuMemoryLimit;
c.additionalCacheMemory=b.additionalCacheMemory;c.frameRate=b.frameRate};return a}();(function(b){b.profiles={low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfVertices:25E5},sceneService:{"3dObject":{lodFactor:.2},point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5},antialiasingEnabled:!1,gpuMemoryLimit:200,additionalCacheMemory:0,frameRate:0},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,
maxTotalNumberOfVertices:5E6},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:a?400:500,additionalCacheMemory:a?0:100,frameRate:0},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfVertices:5E6},sceneService:{"3dObject":{lodFactor:1},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},
uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1},antialiasingEnabled:!0,gpuMemoryLimit:a?600:1E3,additionalCacheMemory:0,frameRate:0}}})(n||(n={}));return n})},"esri/views/3d/support/HighlightOptions":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b,l){return function(b){function e(){var a=
null!==b&&b.apply(this,arguments)||this;a.color=new f([0,255,255]);a.haloOpacity=1;a.fillOpacity=.25;return a}c(e,b);e.toEngineOptions=function(a){return{color:new Float32Array(f.toUnitRGBA(a.color)),haloOpacity:a.haloOpacity,haloOpacityOccluded:.25*a.haloOpacity,fillOpacity:a.fillOpacity,fillOpacityOccluded:.25*a.fillOpacity}};a([l.property({type:f})],e.prototype,"color",void 0);a([l.property()],e.prototype,"haloOpacity",void 0);a([l.property()],e.prototype,"fillOpacity",void 0);return e=a([l.subclass()],
e)}(l.declared(b))})},"esri/views/3d/support/MapCoordsHelper":function(){define("require exports ../../../geometry ../../../core/Error ../../../core/promiseUtils ../../../geometry/support/scaleUtils ../../../portal/support/geometryServiceUtils ../../../tasks/support/ProjectParameters".split(" "),function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function h(a,c,d){void 0===d&&(d=null);var e=this;this.spatialReference=c;this.unitInMeters=b.getMetersPerUnitForSR(this.spatialReference);
(this.geometryService=d)||l.create(a&&a.get("portalItem")).then(function(a){e.geometryService=a}).catch(function(){})}h.prototype.toGeographic=function(b){var h=this,d=!0;if(!this.geometryService)return f.reject(new a("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config"));Array.isArray(b[0])&&"number"!==typeof b[0]||(b=[b],d=!1);b=b.map(function(a){return a instanceof c.Point?a:new c.Point(a,h.spatialReference)});b=new e({geometries:b,outSR:c.SpatialReference.WGS84});
return this.geometryService.project(b).then(function(a){a=a.map(function(a){if("point"===a.type)return[a.x,a.y]});return d?a:a[0]})};h.prototype.canProject=function(){return!!this.geometryService};return h}();g.MapCoordsHelper=n;g.default=n})},"esri/views/3d/support/QualitySettings":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b){var l=function(e){function d(){var a=
null!==e&&e.apply(this,arguments)||this;a.maxTotalNumberOfFeatures=5E4;a.maxTotalNumberOfVertices=5E6;return a}c(d,e);a([b.property()],d.prototype,"maxTotalNumberOfFeatures",void 0);a([b.property()],d.prototype,"maxTotalNumberOfVertices",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],d)}(b.declared(f)),e=function(e){function d(){return null!==e&&e.apply(this,arguments)||this}c(d,e);d.prototype.getDefaults=function(){return{"3dObject":new h,point:new h,
integratedMesh:new h,pointCloud:new h,uncompressedTextureDownsamplingEnabled:!1}};a([b.property()],d.prototype,"3dObject",void 0);a([b.property()],d.prototype,"point",void 0);a([b.property()],d.prototype,"integratedMesh",void 0);a([b.property()],d.prototype,"pointCloud",void 0);a([b.property()],d.prototype,"uncompressedTextureDownsamplingEnabled",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],d)}(b.declared(f)),h=function(e){function d(){var a=null!==
e&&e.apply(this,arguments)||this;a.lodFactor=1;return a}c(d,e);a([b.property()],d.prototype,"lodFactor",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],d)}(b.declared(f)),m=function(e){function d(){var a=null!==e&&e.apply(this,arguments)||this;a.lodBias=0;a.angledSplitBias=1;return a}c(d,e);a([b.property()],d.prototype,"lodBias",void 0);a([b.property()],d.prototype,"angledSplitBias",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],
d)}(b.declared(f));return function(f){function d(){return null!==f&&f.apply(this,arguments)||this}c(d,f);d.prototype.getDefaults=function(){return{graphics3D:new l,sceneService:new e,tiledSurface:new m,antialiasingEnabled:!0}};a([b.property()],d.prototype,"graphics3D",void 0);a([b.property()],d.prototype,"sceneService",void 0);a([b.property()],d.prototype,"tiledSurface",void 0);a([b.property()],d.prototype,"antialiasingEnabled",void 0);a([b.property()],d.prototype,"gpuMemoryLimit",void 0);a([b.property()],
d.prototype,"additionalCacheMemory",void 0);a([b.property()],d.prototype,"frameRate",void 0);return d=a([b.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],d)}(b.declared(f))})},"esri/views/3d/support/RenderCoordsHelper":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../../layers/graphics/dehydratedFeatures ../lib/gl-matrix ./earthUtils ./geometryUtils ./mathUtils ./projectionUtils ../webgl-engine/lib/Util".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q){Object.defineProperty(g,"__esModule",{value:!0});g.createRenderCoordsHelper=function(a,b){return"global"===a?new r(b):new u(b)};var p;(function(a){a[a.X=0]="X";a[a.Y=1]="Y";a[a.Z=2]="Z"})(p=g.BasisDimension||(g.BasisDimension={}));n=function(){function b(a,b){this.spatialReference=a;this.unitInMeters=b}b.prototype.toRenderCoords=function(a,b,c){return l.isPoint(a)?d.pointToVector(a,b,this.spatialReference):d.vectorToVector(a,b,c,this.spatialReference)};b.prototype.fromRenderCoords=
function(b,c,e){return c instanceof a?d.vectorToPoint(b,this.spatialReference,c,e):c instanceof f?d.vectorToPoint(b,this.spatialReference,c):d.vectorToVector(b,this.spatialReference,c,e)};return b}();g.RenderCoordsHelper=n;var r=function(a){function b(b){b=a.call(this,b||d.SphericalECEFSpatialReference,1)||this;b.type="global";return b}c(b,a);b.prototype.getAltitude=function(a){return e.vec3d.length(a)-h.earthRadius};b.prototype.setAltitude=function(a,b){a=(a+h.earthRadius)/e.vec3d.length(b);e.vec3d.scale(b,
a)};b.prototype.setAltitudeOfTransformation=function(a,b){var c=b[12],d=b[13],e=b[14];a=(a+h.earthRadius)/Math.sqrt(c*c+d*d+e*e);b[12]=c*a;b[13]=d*a;b[14]=e*a};b.prototype.worldUpAtPosition=function(a,b){return this.worldBasisAtPosition(a,p.Z,b)};b.prototype.worldBasisAtPosition=function(a,b,c){switch(b){case p.X:return k.cartesianToSpherical(a||z,v),a=v[2],e.vec3d.set3(-Math.sin(a),Math.cos(a),0,c);case p.Y:k.cartesianToSpherical(a||z,v);b=v[1];a=v[2];var d=Math.sin(b);return e.vec3d.set3(-d*Math.cos(a),
-d*Math.sin(a),Math.cos(b),c);case p.Z:return e.vec3d.normalize(a||z,c)}};b.prototype.intersectManifold=function(a,b,c,d){void 0===d&&(d=e.vec3d.create());if(!q.raySphere(a,b,null,h.earthRadius+c,v)||0>e.vec3d.dot(e.vec3d.direction(v,a,A),b))return!1;e.vec3d.set(v,d);return!0};return b}(n),u=function(a){function d(c){c=a.call(this,c,b.getMetersPerUnitForSR(c))||this;c.type="local";c.worldX=[1,0,0];c.worldY=[0,1,0];c.worldZ=[0,0,1];return c}c(d,a);d.prototype.getAltitude=function(a,b){return b?a[b+
2]:a[2]};d.prototype.setAltitude=function(a,b){b[2]=a};d.prototype.setAltitudeOfTransformation=function(a,b){b[14]=a};d.prototype.worldUpAtPosition=function(a,b){return e.vec3d.set(this.worldZ,b)};d.prototype.worldBasisAtPosition=function(a,b,c){switch(b){case p.X:return e.vec3d.set(this.worldX,c);case p.Y:return e.vec3d.set(this.worldY,c);case p.Z:return e.vec3d.set(this.worldZ,c)}};d.prototype.intersectManifold=function(a,b,c,d){void 0===d&&(d=e.vec3d.create());m.plane.fromNormalAndOffset(this.worldZ,
-c,t);if(!m.plane.intersectRay(t,a,b,v))return!1;e.vec3d.set(v,d);return!0};return d}(n),t=m.plane.create(),v=e.vec3d.create(),A=e.vec3d.create(),z=[0,0,0]})},"esri/views/3d/support/SharedSymbolResources":function(){define("require exports ../../../core/arrayUtils ../../../core/Handles ./ResourceController ./TextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils".split(" "),function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function h(a){this.streamDataSupplier=
this.textures=null;this.graphicsOwners=[];this.screenSizePerspectiveHandles=null;var c=f.ClientType.SYMBOLOGY;this.viewState=a.viewState;this.stage=a.stage;this.pointsOfInterest=a.pointsOfInterest;this.resourceController=a.resourceController;this.streamDataSupplier=this.resourceController.getStreamDataSupplier(c);this.textures=new b(this.streamDataSupplier,a.stage,{preMultiplyAlpha:!0,wrapClamp:!0});this.screenSizePerspectiveSettings=l.getSettings(a.viewingMode);this.screenSizePerspectiveSettingsLabels=
l.getLabelSettings(a.viewingMode)}h.prototype.destroy=function(){this.streamDataSupplier=this.textures=this.streamDataSupplier=null};h.prototype.addGraphicsOwner=function(a){var b=this;if(!a)return{remove:function(){}};this.graphicsOwners.push(a);var d="layer"in a?a.watch("layer.screenSizePerspectiveEnabled",function(){return b.updateScreenSizePerspectiveEnabled()}):null;this.updateScreenSizePerspectiveEnabled();return{remove:function(){d&&(d.remove(),c.removeUnordered(b.graphicsOwners,a),b.updateScreenSizePerspectiveEnabled())}}};
h.prototype.updateScreenSizePerspectiveEnabled=function(){var b=this,c=this.graphicsOwners.some(function(a){return!0===a.get("layer.screenSizePerspectiveEnabled")});c&&!this.screenSizePerspectiveHandles?(this.screenSizePerspectiveHandles=new a,c=function(){return b.updateScreenSizePerspectiveSettings()},this.screenSizePerspectiveHandles.add([this.pointsOfInterest.centerOnSurfaceInfrequent.watch("distance",c,!0),this.viewState.events.on("camera-projection-changed",c)]),this.updateScreenSizePerspectiveSettings()):
!c&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};h.prototype.updateScreenSizePerspectiveSettings=function(){e.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;e.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(e);this.screenSizePerspectiveSettingsLabels.update(e);this.stage.setNeedsRender()};return h}();g.SharedSymbolResources=n;var e={distance:0,fovY:0};g.default=n})},"esri/views/3d/support/TextureCollection":function(){define("../../../core/declare ../../../core/lang ../../../core/urlUtils dojo/Deferred ../webgl-engine/Stage ../webgl-engine/lib/Texture ../webgl-engine/lib/Util".split(" "),
function(n,g,c,a,f,b,l){var e=l.assert;return n(null,{constructor:function(a,b,c){this._streamDataSupplier=a;this._stage=b;this._textureRecords={};this._loadedHandler=this._loadedHandler.bind(this);this._errorHandler=this._errorHandler.bind(this);this._textureOptions=c||{}},acquire:function(b,c,e){var d;if(d=this._textureRecords[b])return d.referenceCount++,d.texture||d.clientDfd;if(c)return e=c(b),this._stage.add(f.ModelContentType.TEXTURE,e),d={texture:e,referenceCount:1},this._textureRecords[b]=
d,e;d=new a;c=this._streamDataSupplier.request(b,"image");this._textureRecords[b]={clientDfd:d,loaderDfd:c,texture:null,size:Math.ceil(e||0),referenceCount:1};c.then(this._loadedHandler,this._errorHandler);return d.promise},release:function(a){var b=this._textureRecords[a];b?(1>b.referenceCount&&console.warn("TextureCollection: reference count is \x3c 1 for "+a),b.referenceCount--,1>b.referenceCount&&(b.texture?(this._stage.remove(f.ModelContentType.TEXTURE,b.texture.id),b.texture=null):this._streamDataSupplier.cancelRequest(b.loaderDfd),
delete this._textureRecords[a])):console.warn("TextureCollection: texture doesn't exist: "+a)},isInUse:function(a){a=this._textureRecords[a];e(!a||0<a.referenceCount,"texture record with zero reference count");return!!a},_loadedHandler:function(a,l){var h=this._textureRecords[a];e(h&&!h.texture);if(c.isSVG(a)&&(h.size||0===l.width&&0===l.height)){a=l.width?l.height/l.width:1;var d=h.size||64;1<a?(l.width=Math.round(d/a),l.height=d):(l.width=d,l.height=Math.round(d*a))}a=g.mixin({width:l.width,height:l.height},
this._textureOptions);l=new b(l,"symbol",a);this._stage.add(f.ModelContentType.TEXTURE,l);h.texture=l;h.clientDfd.resolve(l)},_errorHandler:function(a){a=this._textureRecords[a];e(a&&!a.texture);a.clientDfd.reject()}})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/gl-matrix ../PropertiesPool ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./disposeMembers ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Selector".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v){Object.defineProperty(g,"__esModule",{value:!0});var A=Array;n=function(f){function g(a){a=f.call(this,a)||this;a.handles=new b;a.surfaceAltitudeAtCenter=0;a.surfaceAltitudeAtCenterDirty=!0;a.surfaceAltitudeAtCenterWithContent=0;a.surfaceAltitudeAtCenterWithContentDirty=!0;a.propertiesPool=new m.default({pointOfView:e,renderPointOfView:A},a);a.updateSurfaceAltitudeFrequentInterval=x;a.updateSurfaceAltitudeInfrequentInterval=B;a.renderPointOfView=[0,0,
0];return a}c(g,f);g.prototype.initialize=function(){var a=this,b=this.view,c=b.state,e=b.basemapTerrain,f=b.renderCoordsHelper,b=b.map;this.surfaceSelector=new v(c.mode);this.surfaceSelector.enableBackfacesTerrain=c.isGlobal?!1:!0;this.surfaceSelector.enableInvisibleTerrain=!1;this.contentSelector=new v(c.mode);this.contentSelector.enableTerrain=!1;var h=this.estimateSurfaceAltitudeAtCenter.bind(this);this._set("centerOnSurfaceInfrequent",new d.default({state:c,surface:e,renderCoordsHelper:f,estimateSurfaceAltitudeAtCenter:h,
altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval}));this._set("centerOnSurfaceFrequent",new d.default({state:c,surface:e,renderCoordsHelper:f,estimateSurfaceAltitudeAtCenter:h,altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));this._set("centerOnContent",new d.default({state:c,surface:e,renderCoordsHelper:f,estimateSurfaceAltitudeAtCenter:this.estimateSurfaceAltitudeAtCenterWithContent.bind(this),altitudeEstimationInterval:this.updateSurfaceAltitudeFrequentInterval}));
this._set("cameraOnSurface",new k.default({state:c,surface:e,renderCoordsHelper:f,altitudeEstimationInterval:this.updateSurfaceAltitudeInfrequentInterval,map:b}));this._set("surfaceGeometryUpdates",new t.default({state:c,surface:e,renderCoordsHelper:f,centerOnSurfaceInstances:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new q.default({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:f}));this._set("surfaceOrigin",
new u.default({view:this.view}));this._set("focus",new r.default({state:c,surface:e,renderCoordsHelper:f,centerOnSurface:this.centerOnSurfaceFrequent}));this.handles.add(c.watch("camera",function(b){return a.cameraChanged(b)},!0));this.handles.add(this.surfaceGeometryUpdates.events.on("request-update",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(e.watch("extent",function(){return a.updateCenterPointsOfInterest()}));this.handles.add(this.contentGeometryUpdates.events.on("request-update",
function(){return a.updateCenterOnContent()}));this.cameraChanged(this.view.state.camera);this.forceUpdate()};g.prototype.destroy=function(){p.default(this,"handles","centerOnSurfaceInfrequent","centerOnSurfaceFrequent","cameraOnSurface","centerOnContent","surfaceOrigin","focus","propertiesPool")};Object.defineProperty(g.prototype,"pointOfView",{get:function(){var a=this.propertiesPool.get("pointOfView");this.view.renderCoordsHelper.fromRenderCoords(this.renderPointOfView,a,this.view.state.spatialReference);
return a},enumerable:!0,configurable:!0});g.prototype.forceUpdate=function(){this.surfaceGeometryUpdates.forceUpdate();this.centerOnSurfaceInfrequent.forceUpdate();this.centerOnSurfaceFrequent.forceUpdate();this.cameraOnSurface.forceUpdate();this.centerOnContent.forceUpdate();this.focus.forceUpdate()};g.prototype.hasPendingUpdates=function(){return this.surfaceGeometryUpdates.hasPendingUpdates()||this.centerOnContent.hasPendingUpdates()||this.centerOnSurfaceInfrequent.hasPendingUpdates()||this.cameraOnSurface.hasPendingUpdates()||
this.centerOnSurfaceFrequent.hasPendingUpdates()||this.focus.hasPendingUpdates()};g.prototype.estimateSurfaceAltitudeAtCenterWithContent=function(){if(!this.surfaceAltitudeAtCenterWithContentDirty)return this.surfaceAltitudeAtCenterWithContent;this.surfaceAltitudeAtCenterWithContentDirty=!1;var a=this.view.state.camera;this.view.sceneIntersectionHelper.pickPointFromSegment(a.eye,a.center,z,this.contentSelector)?this.surfaceAltitudeAtCenterWithContent=this.view.renderCoordsHelper.getAltitude(z):this.surfaceAltitudeAtCenterWithContent=
this.estimateSurfaceAltitudeAtCenter();return this.surfaceAltitudeAtCenterWithContent};g.prototype.estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this.surfaceAltitudeAtCenterDirty)return this.surfaceAltitudeAtCenter;this.surfaceAltitudeAtCenterDirty=!1;var a=this.view.state.camera;this.surfaceSelector.init(null,a.eye,a.center,null,a,null,!1);this.view.basemapTerrain.intersect(this.surfaceSelector,a.eye,a.center);this.surfaceSelector.minResult.getIntersectionPoint(z)&&
(this.surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(z));return this.surfaceAltitudeAtCenter};g.prototype.cameraChanged=function(a){this.updateCenterPointsOfInterest(a);a=a.eye;this.renderPointOfView[0]===a[0]&&this.renderPointOfView[1]===a[1]&&this.renderPointOfView[2]===a[2]||this._set("renderPointOfView",h.vec3d.set(a,this.propertiesPool.get("renderPointOfView")))};g.prototype.updateCenterPointsOfInterest=function(a){void 0===a&&(a=this.view.state.camera);this.surfaceAltitudeAtCenterWithContentDirty=
this.surfaceAltitudeAtCenterDirty=!0;this.centerOnSurfaceFrequent.update(a);this.centerOnSurfaceInfrequent.update(a);this.cameraOnSurface.update(a);this.centerOnContent.update(a);this.focus.update(a)};g.prototype.updateCenterOnContent=function(){this.surfaceAltitudeAtCenterWithContentDirty=!0;this.centerOnContent.update(this.view.state.camera)};a([l.property({constructOnly:!0})],g.prototype,"updateSurfaceAltitudeFrequentInterval",void 0);a([l.property({constructOnly:!0})],g.prototype,"updateSurfaceAltitudeInfrequentInterval",
void 0);a([l.property({readOnly:!0})],g.prototype,"centerOnContent",void 0);a([l.property({readOnly:!0})],g.prototype,"centerOnSurfaceFrequent",void 0);a([l.property({readOnly:!0})],g.prototype,"centerOnSurfaceInfrequent",void 0);a([l.property({readOnly:!0})],g.prototype,"cameraOnSurface",void 0);a([l.property({readOnly:!0})],g.prototype,"focus",void 0);a([l.property({readOnly:!0})],g.prototype,"surfaceOrigin",void 0);a([l.property({readOnly:!0})],g.prototype,"contentGeometryUpdates",void 0);a([l.property({readOnly:!0,
dependsOn:["renderPointOfView"]})],g.prototype,"pointOfView",null);a([l.property({readOnly:!0})],g.prototype,"renderPointOfView",void 0);a([l.property({readOnly:!0})],g.prototype,"surfaceGeometryUpdates",void 0);a([l.property({constructOnly:!0})],g.prototype,"view",void 0);return g=a([l.subclass("esri.views.3d.support.PointsOfInterest")],g)}(l.declared(f));g.PointsOfInterest=n;var z=h.vec3d.create(),x=200,B=3E3;g.default=n})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/gl-matrix ../PropertiesPool ./PointOfInterest".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k){Object.defineProperty(g,"__esModule",{value:!0});var d=Array;n=function(k){function g(a){a=k.call(this,a)||this;a.propertiesPool=new m.default({location:e,renderLocation:d},a);a.estimatedSurfaceAltitude=0;a.pendingElevationQuery=null;a.renderLocation=[0,0,0];return a}c(g,k);g.prototype.initialize=function(){var a=this;this.measureSurfaceAltitudeThrottle=f.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude();var c=function(){return a.measureSurfaceAltitudeThrottle()};this.map&&this.handles.add([b.on(this.map,"ground.layers","change",c,c,c)])};g.prototype.destroy=function(){this.cancelPendingRequest()};Object.defineProperty(g.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});g.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();
this.updateCameraOnSurface()};g.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCameraOnSurface()};g.prototype.hasPendingUpdates=function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()||!!this.pendingElevationQuery};g.prototype.cancelPendingRequest=function(){var a=this.pendingElevationQuery;a&&(this.pendingElevationQuery=null,a.cancel())};g.prototype.measureSurfaceAltitude=function(){var a=this;this.cancelPendingRequest();if(this.map&&
this.map.ground){this.renderCoordsHelper.fromRenderCoords(this.state.camera.eye,p,this.state.spatialReference);var b=this.map.ground.queryElevation(p).then(function(b){a.updateSurfaceAltitude(b.geometry.z)}).catch(function(b){b&&"cancel"===b.dojoType||a.updateSurfaceAltitude(0)}).catch(function(){}).then(function(){a.pendingElevationQuery===b&&(a.pendingElevationQuery=null)});b.isFulfilled()||(this.pendingElevationQuery=b)}else this.updateSurfaceAltitude(0)};g.prototype.updateSurfaceAltitude=function(a){this.estimatedSurfaceAltitude!==
a&&(this.estimatedSurfaceAltitude=a,this.updateCameraOnSurface())};g.prototype.updateCameraOnSurface=function(){h.vec3d.set(this.state.camera.eye,q);this.renderCoordsHelper.setAltitude(this.estimatedSurfaceAltitude,q);var a=this._get("renderLocation");a[0]===q[0]&&a[1]===q[1]&&a[2]===q[2]||this._set("renderLocation",h.vec3d.set(q,this.propertiesPool.get("renderLocation")))};g.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;a([l.property({constructOnly:!0})],g.prototype,"altitudeEstimationInterval",void 0);
a([l.property({readOnly:!0,dependsOn:["renderLocation"]})],g.prototype,"location",null);a([l.property({constructOnly:!0})],g.prototype,"map",void 0);a([l.property({readOnly:!0})],g.prototype,"renderLocation",void 0);return g=a([l.subclass("esri.views.3d.support.CameraOnSurface")],g)}(l.declared(k.PointOfInterest));g.CameraOnSurface=n;var q=h.vec3d.create(),p=new e;g.default=n})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators ./disposeMembers".split(" "),
function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function h(a){a=f.call(this)||this;a.handles=new b;return a}c(h,f);h.prototype.destroy=function(){e.default(this,"handles")};a([l.property({constructOnly:!0})],h.prototype,"renderCoordsHelper",void 0);a([l.property({constructOnly:!0})],h.prototype,"surface",void 0);a([l.property({constructOnly:!0})],h.prototype,"state",void 0);return h=a([l.subclass("esri.views.3d.support.PointOfInterest")],h)}(l.declared(f));
g.PointOfInterest=n;g.default=n})},"esri/views/3d/support/pointsOfInterest/disposeMembers":function(){define(["require","exports","../../../../core/Accessor"],function(n,g,c){function a(a){for(var b=[],f=1;f<arguments.length;f++)b[f-1]=arguments[f];if(a instanceof c&&a.destroyed)try{throw Error("instance is already destroyed");}catch(m){console.warn(m.stack)}else for(f=0;f<b.length;f++){var e=b[f];if(!(e in a))throw Error("Property '"+e+"' does not exist and cannot be disposed");var h=a[e];h&&("function"===
typeof h.destroy?h.destroy():"function"===typeof h.dispose?h.dispose():"function"===typeof h.remove&&h.remove());a instanceof c&&e in a.__accessor__.metadatas?a._set(e,null):a[e]=null}}Object.defineProperty(g,"__esModule",{value:!0});g.disposeMembers=a;g.default=a})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/throttle ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/gl-matrix ../debugFlags ../earthUtils ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q){Object.defineProperty(g,"__esModule",{value:!0});var p=Array;n=function(g){function q(a){a=g.call(this,a)||this;a.propertiesPool=new d.default({location:l,renderLocation:p},a);a.latestSurfaceAltitude=0;a.currentSurfaceAltitude=0;a.distance=0;a.renderLocation=[0,0,0];return a}c(q,g);t=q;q.prototype.initialize=function(){this.measureSurfaceAltitudeThrottle=f.throttle(this.measureSurfaceAltitude,this.altitudeEstimationInterval,this);this.handles.add(this.measureSurfaceAltitudeThrottle);
this.measureSurfaceAltitude()};Object.defineProperty(q.prototype,"location",{get:function(){var a=this.propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});q.prototype.update=function(a){this.measureSurfaceAltitudeThrottle();this.updateCenterOnSurface()};q.prototype.forceUpdate=function(){this.measureSurfaceAltitudeThrottle.forceUpdate();this.updateCenterOnSurface()};q.prototype.hasPendingUpdates=
function(){return this.measureSurfaceAltitudeThrottle.hasPendingUpdates()};Object.defineProperty(q.prototype,"estimatedSurfaceAltitude",{get:function(){return this.latestSurfaceAltitude},enumerable:!0,configurable:!0});q.prototype.measureSurfaceAltitude=function(){this.latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this.updateCenterOnSurface()};q.prototype.updateCenterOnSurface=function(){var a=r,b=this.calculateSurfaceIntersection(this.currentSurfaceAltitude,a),c=this.currentSurfaceAltitude!==
this.latestSurfaceAltitude;!b&&c&&(b=this.calculateSurfaceIntersection(this.latestSurfaceAltitude,a))&&(this.currentSurfaceAltitude=this.latestSurfaceAltitude);c=u;b&&this.latestSurfaceAltitudeChangesDistanceSignificantly(a,c)&&(e.vec3d.set(c,a),this.currentSurfaceAltitude=this.latestSurfaceAltitude);b?(b=e.vec3d.dist(this.state.camera.eye,a),b!==this._get("distance")&&this._set("distance",b)):(b=this.state.camera,e.vec3d.add(e.vec3d.scale(b.viewForward,this._get("distance"),a),b.eye));b=this._get("renderLocation");
b[0]===a[0]&&b[1]===a[1]&&b[2]===a[2]||this._set("renderLocation",e.vec3d.set(a,this.propertiesPool.get("renderLocation")))};q.prototype.calculateSurfaceIntersection=function(a,b){var c=this.state.camera;if(!this.renderCoordsHelper.intersectManifold(c.eye,c.viewForward,a,b))return!1;if(this.state.isGlobal){a=m.earthRadius+a;var d=e.vec3d.length2(c.eye),f=d<a*a,h=e.vec3d.dist(c.eye,b);f&&h>m.earthRadius/4&&e.vec3d.add(e.vec3d.scale(c.viewForward,a-Math.sqrt(d),b),c.eye)}else if(c=this.surface.ready&&
this.surface.extent)b[0]=k.clamp(b[0],c[0],c[2]),b[1]=k.clamp(b[1],c[1],c[3]);return!0};q.prototype.latestSurfaceAltitudeChangesDistanceSignificantly=function(a,b){if(this.latestSurfaceAltitude===this.currentSurfaceAltitude||null==a)return!1;if(this.calculateSurfaceIntersection(this.latestSurfaceAltitude,b)){var c=this.state.camera.eye;a=e.vec3d.dist(c,a);b=e.vec3d.dist(c,b);if(h.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS||Math.abs(b-a)/a>t.RELATIVE_ALTITUDE_CHANGE_THRESHOLD)return!0}return!1};var t;
q.RELATIVE_ALTITUDE_CHANGE_THRESHOLD=.05;a([b.property({constructOnly:!0})],q.prototype,"altitudeEstimationInterval",void 0);a([b.property({readOnly:!0})],q.prototype,"distance",void 0);a([b.property({constructOnly:!0})],q.prototype,"estimateSurfaceAltitudeAtCenter",void 0);a([b.property({readOnly:!0,dependsOn:["renderLocation"]})],q.prototype,"location",null);a([b.property({readOnly:!0})],q.prototype,"renderLocation",void 0);return q=t=a([b.subclass("esri.views.3d.support.CenterOnSurface")],q)}(b.declared(q.PointOfInterest));
g.CenterOnSurface=n;var r=e.vec3d.create(),u=e.vec3d.create();g.default=n})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["require","exports","../../../../core/Handles","../Evented"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function b(b){this.handles=new c;this.events=new a.Evented;this.contentLayerViews=b.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",this.layerViewsChanged.bind(this)));this.layerViewsChanged({added:this.contentLayerViews.toArray(),
removed:[],moved:[],target:this.contentLayerViews})}b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.layerViewsChanged=function(a){var b=this;a.added.forEach(function(a){"esri.views.3d.layers.SceneLayerView3D"===a.declaredClass&&b.handles.add(a.on("visible-geometry-changed",b.contentChanged.bind(b)),a.uid)});a.removed.forEach(function(a){return b.handles.remove(a.uid)})};b.prototype.contentChanged=function(){this.events.emit("request-update",f)};
return b}();g.ContentGeometryUpdates=n;var f={};g.default=n})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../lib/gl-matrix ../mathUtils ../PropertiesPool ./PointOfInterest".split(" "),function(n,g,c,a,f,b,l,e,h,m){Object.defineProperty(g,"__esModule",{value:!0});var k=Array;n=function(g){function m(a){a=
g.call(this,a)||this;a.propertiesPool=new h.default({locationOnSurface:b,renderLocationOnSurface:k},a);a.centerOnSurface=null;return a}c(m,g);Object.defineProperty(m.prototype,"locationOnSurface",{get:function(){var a=this.propertiesPool.get("locationOnSurface");this.renderCoordsHelper.fromRenderCoords(this.renderLocationOnSurface,a,this.state.spatialReference);return a},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"renderLocationOnSurface",{get:function(){var a=this.centerOnSurface.renderLocation,
b=this.renderCoordsHelper,c=this.calculateScreenHorizontalEdgeOnSurface(r);l.vec3d.subtract(a,this.state.camera.eye,d);l.vec3d.normalize(d);b.worldUpAtPosition(a,q);var f=Math.abs(Math.acos(l.vec3d.dot(q,d))-.5*Math.PI),b=this.propertiesPool.get("renderLocationOnSurface"),f=1-e.clamp(f/(.5*Math.PI),0,1);l.vec3d.lerp(a,c,f*f*f,b);return b},enumerable:!0,configurable:!0});m.prototype.update=function(a){};m.prototype.forceUpdate=function(){};m.prototype.hasPendingUpdates=function(){return this.centerOnSurface.hasPendingUpdates()};
m.prototype.calculateScreenHorizontalEdgeOnSurface=function(a){var b=this.state.camera,c=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation),d=this.renderCoordsHelper.getAltitude(b.eye)>=c?b.padding[2]:b.fullHeight-b.padding[0];b.unprojectPoint([b.padding[3]+b.width/2,d,.5],p);d=l.vec3d.normalize(l.vec3d.subtract(p,b.eye,p));this.renderCoordsHelper.intersectManifold(b.eye,d,c,a)||(l.vec3d.set(b.eye,a),this.renderCoordsHelper.setAltitude(c,a));return a};a([f.property({constructOnly:!0})],
m.prototype,"centerOnSurface",void 0);a([f.property({readOnly:!0,dependsOn:["renderLocationOnSurface"]})],m.prototype,"locationOnSurface",null);a([f.property({readOnly:!0,dependsOn:["centerOnSurface.renderLocation"]})],m.prototype,"renderLocationOnSurface",null);return m=a([f.subclass("esri.views.3d.support.CenterOnSurface")],m)}(f.declared(m.PointOfInterest));g.Focus=n;var d=l.vec3d.create(),q=l.vec3d.create(),p=l.vec3d.create(),r=l.vec3d.create();g.default=n})},"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(n,g,c,a,f,b,l,e,h,m){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function d(a){a=f.call(this,a)||this;a.location=null;a._updatePromise=null;a._handles=new b;return a}c(d,f);Object.defineProperty(d.prototype,"renderLocation",{get:function(){if(!this.location)return null;var a=[0,0,0];this.view.renderCoordsHelper.toRenderCoords(this.location,a);return a},enumerable:!0,configurable:!0});d.prototype.initialize=function(){var a=this;this.view.state.isLocal&&(this._handles.add([this.watch(["surfaceView.spatialReference",
"surfaceView.extent"],function(){return a._update()}),l.on(this,"surface.layers","change",function(){return a._update()})]),this._update())};d.prototype.destroy=function(){this._handles.destroy()};d.prototype._update=function(){var a=this;this._updatePromise&&(this._updatePromise.cancel("cancel"),this._updatePromise=null);if(this.surfaceView&&this.surfaceView.extent&&this.surfaceView.spatialReference){var b=m.center(this.surfaceView.extent),b=new h({x:b[0],y:b[1],z:0,spatialReference:this.surfaceView.spatialReference});
this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updatePromise=this.surface.queryElevation(b,{noDataValue:0}).then(function(b){a._updatePromise=null;a._set("location",b.geometry)}).catch(function(a){"cancel"===a||a&&"elevation-query:invalid-layer"===a.name||console.error("StableSurfaceCenter failed to update: ",a)})):this._set("location",b)}else this._set("location",null)};a([e.property({constructOnly:!0})],d.prototype,"view",void 0);a([e.property({readOnly:!0,aliasOf:"view.map.ground"})],
d.prototype,"surface",void 0);a([e.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],d.prototype,"surfaceView",void 0);a([e.property({readOnly:!0})],d.prototype,"location",void 0);a([e.property({readOnly:!0,dependsOn:["location"]})],d.prototype,"renderLocation",null);return d=a([e.subclass("esri.views.3d.terrain.StableSurfaceCenter")],d)}(e.declared(f));g.StableSurfaceCenter=n;g.default=n})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("require exports ../../../../core/Handles ../../../../core/scheduling ../../../../geometry/support/aaBoundingRect ../../lib/gl-matrix ../debugFlags ../Evented".split(" "),
function(n,g,c,a,f,b,l,e){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function b(a){var b=this;this.handles=new c;this.tileGeometryUpdateExtent=f.empty();this.tileGeometryUpdateSpatialReference=null;this.hasPendingTileGeometryChanges=!0;this.events=new e.Evented;this.centerOnSurfaceInstances=a.centerOnSurfaceInstances;this.renderCoordsHelper=a.renderCoordsHelper;this.state=a.state;this.handles.add(a.surface.on("elevation-change",function(a){return b.tileGeometryChangeHandler(a)}))}
b.prototype.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};b.prototype.forceUpdate=function(){this.handles.has("tile-geometry-update")&&this.updateCenterOnGeometryUpdate();this.hasPendingTileGeometryChanges&&(this.events.emit("request-update",h),this.hasPendingTileGeometryChanges=!1)};b.prototype.hasPendingUpdates=function(){return this.handles.has("tile-geometry-update")};b.prototype.tileGeometryChangeHandler=function(b){var c=this;this.tileGeometryUpdateSpatialReference=
b.spatialReference;f.expand(this.tileGeometryUpdateExtent,b.tile.extent);this.handles.has("tile-geometry-update")||this.handles.add(a.schedule(function(){return c.updateCenterOnGeometryUpdate()}),"tile-geometry-update")};b.prototype.updateCenterOnGeometryUpdate=function(){this.handles.remove("tile-geometry-update");this.centerIntersectsExtent(this.tileGeometryUpdateExtent,this.tileGeometryUpdateSpatialReference)&&(l.DISABLE_POI_UPDATE_ON_SURFACE_GEOMETRY_CHANGES?this.hasPendingTileGeometryChanges=
!0:this.events.emit("request-update",h));f.empty(this.tileGeometryUpdateExtent)};b.prototype.furthestCenterOnSurface=function(){for(var a=this.centerOnSurfaceInstances[0],b=1;b<this.centerOnSurfaceInstances.length;b++){var c=this.centerOnSurfaceInstances[b];c.distance>a.distance&&(a=c)}return a};b.prototype.centerIntersectsExtent=function(a,b){var c=this.state.camera.eye,e=d,h=this.furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(c,m,b);this.renderCoordsHelper.fromRenderCoords(h.renderLocation,
k,b);m[0]<k[0]?(e[0]=m[0],e[2]=k[0]):(e[0]=k[0],e[2]=m[0]);m[1]<k[1]?(e[1]=m[1],e[3]=k[1]):(e[1]=k[1],e[3]=m[1]);return f.intersects(e,a)};return b}();g.SurfaceGeometryUpdates=n;var h={},m=b.vec3d.create(),k=b.vec3d.create(),d=f.empty();g.default=n})},"esri/views/3d/terrain/TerrainSurface":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Handles ../../../core/Logger ../../../core/ObjectPool ../../../core/PooledArray ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ../support/Evented ../support/mathUtils ../support/projectionUtils ../support/PromiseLightweight ../support/ResourceController ./OverlayManager ./PlanarTile ./SphericalTile ./SurfaceExtentHelper ./SurfaceTilingSchemeLogic ./TerrainConst ./TerrainRenderer ./terrainUtils ./TileGeometryFactory ./TilemapOnlyTile ./tileUtils ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K,N,H,M,T,V,U){function J(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function O(a){return a&&("cancel"===a||"cancel"===a.dojoType)}function P(a,b){var c=!1;b=b||a;var d=0;for(a=a.children;d<a.length;d++){var e=a[d];if(e){for(var f in e.layerInfo)for(var h in e.layerInfo[f]){var k=e.layerInfo[f][h].upsampleFromTile;if(k&&k.tile===b)return!0}c=c||P(e,b)}}return c}var R=K.weakAssert,Q=m.getLogger("esri.views.3d.terrain.TerrainSurface");
n=function(b){function g(a,c){a=b.call(this)||this;a.defaultTileBackground=F.DEFAULT_TILE_BACKGROUND;a.hideSkirtsDistanceFromExtentMargin=L;a.hideSkirtsMinimumCameraTilt=S;a.hideSkirtsMaximumCameraTilt=aa;a._clippingExtent=null;a._dataExtent=null;a._elevationBounds=[0,0];a._rootExtent=r.create();a._iteratorPool=new k(T.IteratorPreorder);a._postorderIterator=new T.IteratorPostorder;a.visible=!1;a.suspended=!1;a._pendingUpdates=!1;a._lvPendingUpdates=!1;a._updateNextFrame=0;a._vectorTileLayerRequests=
0;a._memoryUsed=0;a._overlayOpacity=1;a._eyePosRenderSR=u.vec3d.create();a._eyePosSurfaceSR=u.vec3d.create();a._splitLimits=[0,0,0,0,0,0];a._frustumPlanes=Array(6);a._viewProjectionMatrix=u.mat4d.identity();a.tilemapStats={tilemapRequestsSent:0,tilemapRequestsPending:0,tilemapRequestErrors:0,fullTilemaps:0,emptyTilemaps:0,tilesRequested:0,tileRequestsSent:0,tileRequestErrors:0,tilesNotPresent:0};a._layerViews=[[],[]];a._layerIndexByLayerViewId=[{},{}];a._basemapLayerViewHandles={};a._handles=new h;
a._lowPrioUpdates=new d;a._topLevelTilemapOnlyTiles=Array(F.TILEMAP_SIZE_EXP+1);a.loaded=!1;a.maxTextureScale=1.2;a.rootTiles=null;a.backgroundImage=F.DEFAULT_TILE_BACKGROUND;a.backgroundColor=null;for(c=0;c<a._topLevelTilemapOnlyTiles.length;c++)a._topLevelTilemapOnlyTiles[c]=new H([c-F.TILEMAP_SIZE_EXP,0,0]);for(c=0;6>c;c++)a._frustumPlanes[c]=u.vec4d.create();return a}c(g,b);g.prototype.normalizeCtorArgs=function(a,b){this._view=a;this._stage=a._stage;this._set("manifold",b);return{}};g.prototype.initialize=
function(){var a=this;this.tilePool="planar"===this.manifold?D.Pool:C.Pool;this._renderer=new I(this.manifold,null);this._renderer.loaded=this._setLoaded.bind(this);this._renderer.install(this._view._stage);q.init(this,"_background",function(){a._renderer.updateTileBackground(a._background)});this._handles.add(this._view.watch("pointsOfInterest",function(b){a._renderer.pointsOfInterest=b}));this._set("overlayManager",new B({terrainSurface:this,view:this._view}));this._handles.add(this.watch("overlayManager.hasHighlights",
this._handleHasHighlights.bind(this)),"overlayManager");var b={layers:this._view.map.allLayers,layerViews:this._view.allLayerViews,spatialReference:this._view.spatialReference};this.extentHelper="spherical"===this.manifold?new G.SurfaceExtentHelperGlobal(b):new G.SurfaceExtentHelperLocal(b);this._handles.add(q.init(this.extentHelper,"stencilEnabledExtents",function(b){a._renderer.setStencilEnabledLayerExtents(b)}),"extentHelper");b=this._view.defaultsFromMap?new e({root:this._view.map,rootCollectionNames:this._view.defaultsFromMap.mapCollectionPaths,
getChildrenFunction:function(a){return a.layers}}):this._view.map.allLayers;b=new E({layers:b,extentHelper:this.extentHelper,manifold:this.manifold,viewSpatialReference:this._view.spatialReference});this._set("tilingSchemeLogic",b);this._handles.add([this.tilingSchemeLogic.watch("tilingScheme",this._updateTilingSchemeAndExtent.bind(this),!0),this.tilingSchemeLogic.watch("extent",this._updateTilingSchemeAndExtent.bind(this),!0)],"tilingSchemeLogic");this._updateTilingSchemeAndExtent();this._streamDataSupplier=
this._view.resourceController.getStreamDataSupplier(x.ClientType.TERRAIN);this._handles.add(this._view.resourceController.registerFrameWorker(function(b){return a._frame(b)}));this._handles.add(this._view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a._needsIdleUpdate()},idleFrame:function(){return a._idleUpdate()}}));this._viewChangeUpdate=this._viewChangeUpdate.bind(this);this._view.resourceController.memoryEvents.on("quality-changed",function(){return a._viewChangeUpdate()});
this._handles.add([this._view.on("resize",this._viewChangeUpdate),this._view.watch("state.camera",this._viewChangeUpdate,!0),this._view.watch("qualitySettings.tiledSurface.lodBias",this._viewChangeUpdate),this._view.watch("clippingArea",this._clippingChanged.bind(this))],"view");this._handles.add(this._view.allLayerViews.on("change",this._handleLayerViewChanges.bind(this)),"allLayerViews");this._handleLayerViewChanges({added:this._view.allLayerViews.toArray(),removed:[],moved:[],target:this._view.allLayerViews});
this._updateClippingExtent();this.notifyChange("extent")};g.prototype.destroy=function(){this._handles.destroy();this._removeAllTiles();this.tilingSchemeLogic.destroy();this._set("tilingSchemeLogic",null);this.extentHelper.destroy();this.extentHelper=null;for(var a in this._basemapLayerViewHandles)this._unregisterTiledLayerView(a);this._streamDataSupplier=null;this.overlayManager&&(this.overlayManager.destroy(),this._set("overlayManager",null));this._renderer.destroy(this._stage);this._streamDataSupplier=
this._stage=this._view=this._renderer=null};Object.defineProperty(g.prototype,"renderer",{get:function(){return this._renderer},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"cullBackFaces",{set:function(a){this._renderer.cullBackFaces=a;this._set("cullBackFaces",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"extent",{get:function(){return this._clippingExtent||this._rootExtent},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"baseOpacity",
{set:function(a){this._renderer.opaque=1<=a;this._set("baseOpacity",a);this._updateTileTextures(!0)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"ready",{get:function(){return!!this.rootTiles},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"renderOrder",{set:function(a){this._renderer.renderOrder=a;this._set("renderOrder",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"skirtScale",{set:function(a){this._renderer.skirtScale=a;this._set("skirtScale",
a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_background",{get:function(){return null!=this.backgroundColor?this.backgroundColor:this.backgroundImage},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"velvetOverground",{set:function(a){a!==this.velvetOverground&&(this._renderer.velvetOverground=a);this._set("velvetOverground",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"wireframe",{set:function(a){this._renderer.setWireframe(a);
this._set("wireframe",a);this._view._stage.setRenderParams({earlyOcclusionPixelDraw:a})},enumerable:!0,configurable:!0});g.prototype.setVisibility=function(a){a!==this.visible&&(this.visible=a,this._renderer.setVisibility(a),this.setUpdatesDisabled(!a),a&&this._viewChangeUpdate())};g.prototype.isVisible=function(){return this.visible&&this.ready};g.prototype.isSeeThrough=function(){return!this._renderer.isOpaque()};g.prototype.setUpdatesDisabled=function(a){(this.suspended=a)||this._viewChangeUpdate()};
g.prototype.intersect=function(a,b,c){this._renderer.intersect(a,b,c,null)};g.prototype.getElevation=function(a){if(!this.ready)return null;var b=this.rootTiles;if(0===b[0].layerInfo[F.LayerClass.ELEVATION].length)return null;var c=Z;if(Array.isArray(a))c=a;else if("point"===a.type&&!A.pointToVector(a,c,this.tilingScheme.spatialReference))return Q.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(var d=0;d<b.length;d++)if(a=b[d],M.isPosWithinTile(a,
c)){for(;a&&!a.renderData;)b=0,c[0]>.5*(a.extent[0]+a.extent[2])&&(b+=1),c[1]<.5*(a.extent[1]+a.extent[3])&&(b+=2),a=a.children[b];if(b=(b=a.renderData)&&b.geometryState?b.geometryState.samplerData:null)return N.elevationSampler(c[0],c[1],b);break}return null};g.prototype.getElevationBounds=function(){return this._elevationBounds};g.prototype.getScale=function(a){if(this.tilingScheme){if(!A.pointToVector(a,Z,this.spatialReference))return Q.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),
null;if(this.rootTiles)for(var b=0;b<this.rootTiles.length;b++)if(a=this.rootTiles[b],M.isPosWithinTile(a,Z)){for(;a.children[0];)b=0,Z[0]>a.children[0].extent[2]&&(b+=1),Z[1]<a.children[0].extent[1]&&(b+=2),a=a.children[b];return this._getLodBiasCorrectedScale(a.lij[0])}}return 1E100};g.prototype.queryVisibleScaleRange=function(a,b,c,d){b=b?this.tilingScheme.levelAtScale(b):0;c=c?this.tilingScheme.levelAtScale(c):Infinity;var e=this._getLodBias();this._renderer.queryVisibleLevelRange(a,b+e,c+e,d)};
g.prototype._setLoaded=function(){this.loaded||this._set("loaded",!0)};g.prototype._updateTilingSchemeAndExtent=function(){var a=this.tilingSchemeLogic.extent,b=a&&!r.equals(a,this._dataExtent);b&&(this._dataExtent?r.set(this._dataExtent,a):this._dataExtent=r.create(a));var a=this.tilingSchemeLogic.tilingScheme,c=a!==this.tilingScheme;c&&(R(!!a,"tiling scheme cannot be reset to undefined"),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",a),this._updateClippingExtent(),a&&(this._updateTiledLayers(),
this._renderer.setTileSize(a.pixelSize[0]),this.overlayManager.setSpatialReference(a.spatialReference,"spherical"===this.manifold)));(b||c)&&this._updateRootTiles()};g.prototype._acquireTile=function(a,b,c,d){var e=this.tilePool.acquire();W[0]=a;W[1]=b;W[2]=c;e.init(W,d,this,this.tilingScheme);return e};g.prototype._releaseTile=function(a){a.dispose();a.parent=null;a.parentSurface=null;this.tilePool.release(a)};g.prototype._updateRootTiles=function(){var a=this,b=this._clippingExtent||this._dataExtent,
c=this.tilingScheme;if(b&&c){var d=da,e=c.rootTilesInExtent(b,d,Infinity);if(this.rootTiles){if(e.length>F.MAX_ROOT_TILES){Q.warn(F.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}var b=this.rootTiles.map(function(a){return a.lij}),f=l.difference(b,e,J);if(0<f.removed.length||0<f.added.length){var h=this.rootTiles.filter(function(b){return-1<l.findIndex(f.removed,J.bind(null,b.lij))?(a._purgeChildTiles(b),a._purgeTile(b),!1):!0});f.added.forEach(function(b){b=a._acquireTile(0,b[1],b[2],null);h.push(b);
a._loadTile(b)});this._set("rootTiles",h);this._renderer.setRootTiles(this.rootTiles)}}else e.length>F.MAX_ROOT_TILES&&(Q.warn(F.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),e=c.rootTilesInExtent(b,d,F.MAX_ROOT_TILES)),this._set("rootTiles",e.map(function(b){b=a._acquireTile(0,b[1],b[2],null);a._loadTile(b);return b})),this._renderer.setRootTiles(this.rootTiles);l.equals(d,this._rootExtent)||(this._rootExtent=r.create(d),this._hasFixedExtent()||this.notifyChange("extent"));this.setVisibility(!0);this._viewChangeUpdate();
this.overlayManager.setOverlayDirty();this.notifyChange("ready")}};g.prototype._viewChangeUpdate=function(){this._stage&&!this.suspended&&this.tilingScheme&&this.visible&&(this._updateViewDependentParameters(),this._updateSkirts(),this._updateOverlayOpacity(this._eyePosSurfaceSR[2]),this._updateTiles())};g.prototype._updateClippingStatus=function(a){a.updateClippingStatus(this._clippingExtent)&&a.pendingUpdates&F.TileUpdateTypes.UPDATE_GEOMETRY&&(this._updateTileGeometry(a),a.pendingUpdates&=~F.TileUpdateTypes.UPDATE_GEOMETRY)};
g.prototype._updateTiles=function(a){void 0===a&&(a=this.rootTiles);if(a){var b=this._iteratorPool.acquire();b.reset(a);var c=this._splitLimits,d=this._frustumPlanes,e;M.hasVisibleSiblings(a)?(a=this._elevationBounds[0],e=this._elevationBounds[1]):(a=Infinity,e=-Infinity);for(;!b.done;){var f=b.next();this._updateClippingStatus(f);if(f.updateVisibility(d)){f.updateScreenDepth(this._viewProjectionMatrix);f.renderData&&(a=Math.min(f.elevationBounds[0],a),e=Math.max(f.elevationBounds[1],e));var h=f.shouldSplit(c,
this._eyePosRenderSR);if(h===F.TileUpdateTypes.SPLIT){f.pendingUpdates&=~F.TileUpdateTypes.MERGE;f.renderData&&(f.pendingUpdates|=F.TileUpdateTypes.SPLIT,b.skipSubtree());this._pendingUpdates=this._pendingUpdates||0!==f.pendingUpdates;continue}f.pendingUpdates&=~F.TileUpdateTypes.SPLIT;h===F.TileUpdateTypes.VSPLITMERGE&&f.updateAgents(F.LayerClass.ELEVATION)}b.skipSubtree();if(!f.renderData){f.pendingUpdates|=F.TileUpdateTypes.MERGE;f.pendingUpdates&=~F.TileUpdateTypes.SPLIT;h=this._iteratorPool.acquire();
for(h.resetOne(f);!h.done;){var g=h.next();this._updateClippingStatus(g);g.updateVisibility(d);g.visible&&g.updateScreenDepth(this._viewProjectionMatrix)}this._iteratorPool.release(h)}this._pendingUpdates=this._pendingUpdates||0!==f.pendingUpdates}this._iteratorPool.release(b);isFinite(a)&&isFinite(e)&&(this._elevationBounds[0]!==a||this._elevationBounds[1]!==e)&&(this._elevationBounds[0]=a,this._elevationBounds[1]=e,this.emit("elevation-bounds-change",null))}};g.prototype._updateViewDependentParameters=
function(){var a=this._view.state.camera,b=Math.tan(.5*a.fovX),c=Math.tan(.5*a.fovY),d=this.tilingScheme.pixelSize,e=Math.pow(2,-this._getLodBias());this._splitLimits[0]=b;this._splitLimits[1]=d[0]/a.width*this.maxTextureScale*e;this._splitLimits[2]=c;this._splitLimits[3]=d[1]/a.height*this.maxTextureScale*e;this._splitLimits[4]=this.tilingScheme.getMaxLod();this._splitLimits[5]=this._view.qualitySettings.tiledSurface.angledSplitBias;a.copyFrustumPlanes(this._frustumPlanes);u.mat4d.multiply(a.projectionMatrix,
a.viewMatrix,this._viewProjectionMatrix);u.vec3d.set(a.eye,this._eyePosRenderSR);A.vectorToVector(this._eyePosRenderSR,this._view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};g.prototype._updateSkirts=function(){K.autoUpdateSkirtsVisibility(this,this._eyePosSurfaceSR,this._view.state.camera.near)};g.prototype._setLayerViewsUpdating=function(){for(var a=0;a<F.LayerClass.COUNT;a++)for(var b=this._layerViews[a],c=0;c<b.length;c++)b[c].updatingChanged(this._pendingUpdates)};g.prototype._frameTraversal=
function(a){if(this.suspended||!this._pendingUpdates)return!1;this._lowPrioUpdates.clear();this._pendingUpdates=!1;var b=this._renderer.resourceCounter,c=b.numTileTexturesComposited,d=this._iteratorPool.acquire();d.reset(this.rootTiles);for(var e=!1,f=0;!(d.done||a.done()&&e)&&b.numTileTexturesComposited-c<ea;){var h=d.next(),f=f+h.memoryUsed;h.pendingUpdates&F.TileUpdateTypes.MERGE?(this._mergeTile(h),h.pendingUpdates&=~F.TileUpdateTypes.MERGE,e=!0,d.skipSubtree()):h.pendingUpdates&F.TileUpdateTypes.SPLIT?
(this._splitTile(h),h.pendingUpdates&=~F.TileUpdateTypes.SPLIT,e=!0,d.skipSubtree()):0<h.pendingUpdates&&this._lowPrioUpdates.push(h);this._pendingUpdates=this._pendingUpdates||0!==h.pendingUpdates}d.done?this._memoryUsed=f:this._pendingUpdates=!0;this._iteratorPool.release(d);return e};g.prototype._updateTileGeometry=function(a){this._renderer.updateTileGeometry(a);this._elevationUpdate(a)};g.prototype._elevationUpdate=function(a){ja.spatialReference=this.spatialReference;ja.tile=a;ja.extent=a.extent;
this.emit("elevation-change",ja);r.containsPoint(a.extent,this._eyePosSurfaceSR)&&this._updateSkirts()};g.prototype._frame=function(a){if(this.rootTiles){for(var b=this._frameTraversal(a);(!a.done()||!b)&&0<this._lowPrioUpdates.length;){var c=this._lowPrioUpdates.pop();c.pendingUpdates&F.TileUpdateTypes.DECODE_ELEVATION?(this._decodeElevation(c,a)&&(c.pendingUpdates&=~F.TileUpdateTypes.DECODE_ELEVATION),b=!0):c.pendingUpdates&F.TileUpdateTypes.UPDATE_GEOMETRY?(this._updateTileGeometry(c),c.pendingUpdates&=
~F.TileUpdateTypes.UPDATE_GEOMETRY,b=!0):c.pendingUpdates&F.TileUpdateTypes.UPDATE_TEXTURE&&(this._renderer.updateTileTexture(c),c.pendingUpdates&=~F.TileUpdateTypes.UPDATE_TEXTURE,b=!0);this._pendingUpdates=this._pendingUpdates||0!==c.pendingUpdates}if(0<this._lowPrioUpdates.length||this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)this._pendingUpdates=!0;this._pendingUpdates===this._lvPendingUpdates||!this._pendingUpdates&&20!==++this._updateNextFrame||(this._setLayerViewsUpdating(),
this._lvPendingUpdates=this._pendingUpdates,this._updateNextFrame=0);b&&(this._memoryUsed=0)}};g.prototype._needsIdleUpdate=function(){return this.isVisible()&&this.overlayManager&&this.overlayManager.overlaysNeedUpdate()};g.prototype._idleUpdate=function(){this.overlayManager.updateOverlays();this._updateOverlayOpacity(this._eyePosSurfaceSR[2])};g.prototype._updateClippingExtent=function(){if(!this.spatialReference)return!1;var a=r.create(),b=null;A.extentToBoundingRect(this._view.clippingArea,a,
this.spatialReference)&&(b=a);if(l.equals(b,this._clippingExtent))return!1;this._clippingExtent=b;this._renderer.clippingExtent=b;this.notifyChange("extent");this._updateTileOverlayParams();this.overlayManager.setOverlayDirty();return!0};g.prototype._clippingChanged=function(){this._updateClippingExtent()&&this._updateRootTiles()};g.prototype._getLodBias=function(){return Math.round(this._view.qualitySettings.tiledSurface.lodBias+2*this._view.resourceController.memoryFactor-2)};g.prototype._getLodBiasCorrectedScale=
function(a){var b=this.tilingScheme.levels;a=v.clamp(a-this._getLodBias(),0,b.length-1);return b[a].scale};g.prototype._cancelTilemapRequests=function(a){for(var b=0;b<F.LayerClass.COUNT;b++){var c=a.layerInfo[b];if(c)for(var d=0;d<c.length;d++){var e=c[d];e.tilemapRequest&&(e.tilemapRequest.cancel(),e.tilemapRequest=null)}}};g.prototype._removeAllTiles=function(){var a=this;this.rootTiles&&(this.rootTiles.forEach(function(b){a._purgeChildTiles(b);a._purgeTile(b)}),this._set("rootTiles",null),this.notifyChange("ready"));
for(var b=0;b<this._topLevelTilemapOnlyTiles.length;b++)this._cancelTilemapRequests(this._topLevelTilemapOnlyTiles[b]);this.setVisibility(!1)};g.prototype._purgeChildTiles=function(a){var b=this._postorderIterator;for(b.reset([a]);!b.done;){for(var c=b.next(),d=0;4>d;d++)c.children[d]=null;c!==a&&this._purgeTile(c)}};g.prototype._purgeTile=function(a){a.unload(this._renderer);this._cancelTilemapRequests(a);a.parent=null;this._releaseTile(a)};g.prototype._splitTile=function(a){var b=a.lij[0]+1,c=2*
a.lij[1],d=2*a.lij[2];a.children[0]=this._createTile(b,c,d,a);a.children[1]=this._createTile(b,c,d+1,a);a.children[2]=this._createTile(b,c+1,d,a);a.children[3]=this._createTile(b,c+1,d+1,a);a.unload(this._renderer);ca.spatialReference=this.spatialReference;ca.extent=a.extent;ca.scale=this._getLodBiasCorrectedScale(b);this.emit("scale-change",ca)};g.prototype._createTile=function(a,b,c,d){R(!!d,"_createTile sanity check");a=this._acquireTile(a,b,c,d);a.updateClippingStatus(this._clippingExtent);a.updateVisibility(this._frustumPlanes);
a.visible&&(a.updateScreenDepth(this._viewProjectionMatrix),a.shouldSplit(this._splitLimits,this._eyePosRenderSR)===F.TileUpdateTypes.SPLIT&&(a.pendingUpdates|=F.TileUpdateTypes.SPLIT,this._pendingUpdates=!0));this._loadTile(a);return a};g.prototype._mergeTile=function(a){R(!a.renderData,"_mergeTile sanity check");this._loadTile(a);this._purgeChildTiles(a);ca.spatialReference=this.spatialReference;ca.extent=a.extent;ca.scale=this._getLodBiasCorrectedScale(a.lij[0]);this.emit("scale-change",ca)};g.prototype._loadTile=
function(a){a.load(this._renderer);this.overlayManager&&this.overlayManager.hasOverlays()&&this.overlayManager.setOverlayParamsOfTile(a,a.renderData,this._overlayOpacity);this._elevationUpdate(a)};g.prototype._handleHasHighlights=function(a){this._renderer.setNeedsHighlight(a)};g.prototype._decodeElevation=function(a,b){var c=a.layerInfo[F.LayerClass.ELEVATION];if(!c)return!0;for(var d=0;d<c.length;d++){var e=c[d];e.pendingUpdates&=~F.TileUpdateTypes.DECODE_ELEVATION;if(e.rawData){var f=a.decodeElevationData(e.rawData);
e.rawData=null;if(f){e.data=f;var e=[a],h=a.lij[0],g=this._iteratorPool.acquire();for(g.reset(e);!g.done;){var k=g.next();k.findElevationBoundsForLayer(d,h);k.computeElevationBounds()}this._iteratorPool.release(g);a.dataArrived(d,F.LayerClass.ELEVATION,f);this._updateTiles(e)}if(b.done())break}}return d===c.length};g.prototype._handleLayerViewChanges=function(a){var b=this,c=!1;a.added.forEach(function(a){var d=a.layer;K.isTiledLayerView(a)?(b._registerTiledLayer(a),d.loaded&&(c=!0)):a.supportsDraping&&
b.overlayManager&&b.overlayManager.registerLayerView(a)});a.removed.forEach(function(a){K.isTiledLayerView(a)?(c=!0,b._unregisterTiledLayerView(a.uid)):a.supportsDraping&&b.overlayManager&&b.overlayManager.unregisterLayerView(a)});(c=c||0<a.moved.filter(K.isTiledLayerView).length)&&this._updateTiledLayers()};g.prototype._registerTiledLayer=function(a){var b=this,c=[];c.push(a.watch("suspended",function(){b._updateTiledLayers()}));c.push(a.watch("fullOpacity",function(){return b._updateTileTextures()}));
a.on("data-changed",function(){var c=K.isElevationLayerView(a)?F.LayerClass.ELEVATION:F.LayerClass.MAP,d=b._layerIndexByLayerViewId[c][a.uid];null!=d&&b._invalidateLayerData(d,c)});this._basemapLayerViewHandles[a.uid]=c};g.prototype._unregisterTiledLayerView=function(a){var b=this._basemapLayerViewHandles[a];if(b){for(var c=0;c<b.length;c++)b[c].remove();delete this._basemapLayerViewHandles[a]}};g.prototype._updateTiledLayers=function(){var a=this;if(this.tilingScheme){var b=this._view.allLayerViews,
c=[[],[]],d=null,e=r.empty();b.forEach(function(b){var f=b.layer;if(f&&!b.suspended&&K.isTiledLayerView(b)){var h=b.fullExtent;h?a.tilingScheme.compatibleWith(b.tileInfo)?(r.expand(e,h),K.isElevationLayerView(b)?c[F.LayerClass.ELEVATION].push(b):(Infinity!==b.maxDataLevel&&(null===d||b.maxDataLevel>d)&&(d=b.maxDataLevel),c[F.LayerClass.MAP].push(b))):Q.warn("Terrain: tiling scheme of layer "+f.id+" is incompatible with other tiled layers, will not be drawn"):Q.warn("Terrain: Map or elevation layer does not have fullExtent: "+
f.id)}},this);for(var b=function(a){var b=f._layerViews[a],d=c[a];d.reverse();var e=d.length,h=b.length!==e,g=Array(e),k=Array(b.length);f._layerIndexByLayerViewId[a]={};for(var l=0;l<e;l++){f._layerIndexByLayerViewId[a][d[l].uid]=l;var m=b.indexOf(d[l]);g[l]=m;l!==m&&(h=!0);-1<m&&(k[m]=l)}if(h){f._topLevelTilemapOnlyTiles.forEach(function(b){return b.modifyLayers(k,g,a)});b=f._postorderIterator;for(b.reset(f.rootTiles);!b.done;)b.next().modifyLayers(k,g,a);f._layerViews[a]=d;for(b.reset(f.rootTiles);!b.done;)d=
b.next(),d.restartAgents(a),a===F.LayerClass.ELEVATION&&d.computeElevationBounds();f._updateTiles()}},f=this,h=0;h<F.LayerClass.COUNT;h++)b(h);this.tilingScheme.levels.length-1<d&&(this.tilingScheme.ensureMaxLod(d),this._viewChangeUpdate())}};g.prototype._hasFixedExtent=function(){return!!this._clippingExtent};g.prototype.layerViewByIndex=function(a,b){return this._layerViews[b][a]};g.prototype.numLayers=function(a){return this._layerViews[a].length};g.prototype._updateTileTextures=function(a){void 0===
a&&(a=!1);var b=this._iteratorPool.acquire();for(b.reset(this.rootTiles);!b.done;)b.next().updateTexture(a);this._iteratorPool.release(b)};g.prototype._invalidateLayerData=function(a,b){var c=this._iteratorPool.acquire();for(c.reset(this.rootTiles);!c.done;)c.next().removeLayerAgent(a,b);for(c.reset(this.rootTiles);!c.done;)c.next().invalidateLayerData(a,b);this._iteratorPool.release(c)};g.prototype.setPendingUpdates=function(){this._pendingUpdates=!0};g.prototype.requestTileData=function(a,b,c){var d=
this;this.tilemapStats.tilesRequested++;var e=this.layerViewByIndex(b,c),f=e.layer;if(f.tilemapCache&&!K.isVectorTileLayerView(e)){var h=this.getTilemapTile(a),g=h.layerInfo[c][b];if(g.tilemap){if(!h.hasDataAvailable(a,b,c))return this.tilemapStats.tilesNotPresent++,this._dispatchDataEvent(a,"dataMissing",c,e,{notInTilemap:!0}),b=new z.Promise,b.reject(),b}else{g.tilemapRequest||(g.tilemapRequest=this.requestTilemap(h,b,c,e,f));var k,l=new z.Promise(function(){k&&k.cancel()});g.tilemapRequest.always(function(){g.tilemapRequest=
null;if(!l.isCancelled()){var b=d._layerIndexByLayerViewId[c][e.uid];null!=b&&(h.hasDataAvailable(a,b,c)?(k=d._requestTileData(a,b,c,e),k.then(function(){return l.resolve()})):(d.tilemapStats.tilesNotPresent++,d._dispatchDataEvent(a,"dataMissing",c,e,{notInTilemap:!0}),l.reject()))}});return l}}return this._requestTileData(a,b,c,e)};g.prototype._requestTileData=function(a,b,c,d){this.tilemapStats.tileRequestsSent++;return c===F.LayerClass.ELEVATION?this._requestElevationTileData(a,b,c,d):this._requestMapTileData(a,
b,c,d)};g.prototype._requestElevationTileData=function(a,b,c,d){var e=this;if(K.isElevationLayerView(d)){var f=function(b){var f=e._layerIndexByLayerViewId[c][d.uid];null!=f?(f=a.layerInfo[c][f],f.rawData=b,a.pendingUpdates|=F.TileUpdateTypes.DECODE_ELEVATION,f.pendingUpdates|=F.TileUpdateTypes.DECODE_ELEVATION,e._pendingUpdates=!0):Q.warn("TerrainSurface: received data from unknown layer %d %s",c,a.lij.toString())};b=function(b){O(b)||(e.tilemapStats.tileRequestErrors++,e._dispatchDataEvent(a,"dataMissing",
c,d,b))};var h=d.layer;if(K.useFetchTileForLayer(h))return h=h.fetchTile(a.lij[0],a.lij[1],a.lij[2],F.ELEVATION_NODATA_VALUE),h.then(function(a){return f(a)},b),h;h=d.getTileUrl(a.lij[0],a.lij[1],a.lij[2]);h=this._streamDataSupplier.request(h,"binary");h.then(function(a,b){b.url=a;f(b)},b);return h}R(!1,"_requestElevationTileData can only be called for elevation layer views")};g.prototype._requestMapTileData=function(a,b,c,d){var e=this,f=function(b){e._dispatchDataEvent(a,"dataArrived",c,d,b)};b=
function(b){O(b)||(e._dispatchDataEvent(a,"dataMissing",c,d,b),e.tilemapStats.tileRequestErrors++)};if(K.isVectorTileLayerView(d)){var h=d.tileHandler,g=d.schemaHelper.getLevelRowColumn(a.lij);++this._vectorTileLayerRequests;h=h.getVectorTile(g[0],g[1],g[2],0);h.then(f).catch(b).then(function(){return--e._vectorTileLayerRequests});return h}if(K.useFetchTileForLayer(d.layer)&&K.isTileLayerView(d))return h=d.layer.fetchTile(a.lij[0],a.lij[1],a.lij[2]),h.then(f).catch(b),h;h=d.getTileUrl(a.lij[0],a.lij[1],
a.lij[2]);null!=d.refreshInterval&&d.refreshTimestamp&&(h+=(-1<h.indexOf("?")?"\x26":"?")+"_ts\x3d"+d.refreshTimestamp);h=this._streamDataSupplier.request(h,"image");h.then(function(a,b){return f(b)},b);return h};g.prototype.requestTilemap=function(a,b,c,d,e){var f=this,h=a.lij[0]+F.TILEMAP_SIZE_EXP,g=a.lij[1]<<F.TILEMAP_SIZE_EXP,k=a.lij[2]<<F.TILEMAP_SIZE_EXP;this.tilemapStats.tilemapRequestsSent++;this.tilemapStats.tilemapRequestsPending++;return e.tilemapCache.fetchTilemap(h,g,k,{timeout:6E3}).then(function(e){f.tilemapStats.tilemapRequestsPending--;
b=f._layerIndexByLayerViewId[c][d.uid];null!=b&&(a.layerInfo[c][b].tilemap=e)}).catch(function(a){f.tilemapStats.tilemapRequestsPending--;f.tilemapStats.tilemapRequestErrors++})};g.prototype.getTilemapTile=function(a){var b=a.lij[0];return b>F.TILEMAP_SIZE_EXP?M.getTileNLevelsUp(a,F.TILEMAP_SIZE_EXP):this._topLevelTilemapOnlyTiles[b]};g.prototype._dispatchDataEvent=function(a,b,c,d,e){d=this._layerIndexByLayerViewId[c][d.uid];if(null!=d)a[b](d,c,e);else Q.warn("TerrainSurface: received data from unknown layer")};
g.prototype._updateTileOverlayParams=function(){if(this.rootTiles){var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();b.renderData&&this.overlayManager&&this.overlayManager.setOverlayParamsOfTile(b,b.renderData,this._overlayOpacity)}this._iteratorPool.release(a);this._renderer.setNeedsRender()}};g.prototype._updateOverlayOpacity=function(a){if(this.overlayManager&&(a=this.overlayManager.updateOpacity(a),!isNaN(a))){if(a!==this._overlayOpacity){var b=this._iteratorPool.acquire();
for(b.reset(this.rootTiles);!b.done;){var c=b.next();c.renderData&&(c.renderData.overlayOpacity=a)}this._iteratorPool.release(b)}this._overlayOpacity=a;this._renderer.setNeedsRender()}};g.prototype.getStats=function(){var a=0,b=0,c=0,d=[],e=this._iteratorPool.acquire();for(e.reset(this.rootTiles);!e.done;){var f=e.next();a++;f.renderData&&(b++,f.visible&&(c++,f=f.lij[0],d[f]=null!=d[f]?d[f]+1:1))}this._iteratorPool.release(e);return{numNodes:a,numLeaves:b,numVisible:c,numVisiblePerLevel:d}};g.prototype.getUsedMemory=
function(){if(!this.tilingScheme)return 0;if(0<this._memoryUsed)return this._memoryUsed;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;){var b=a.next();this._memoryUsed+=b.memoryUsed}this._iteratorPool.release(a);return this._memoryUsed};g.prototype.getMemoryUsage=function(){if(!this.tilingScheme)return{};var a=0,b=0,c=0,d=0,e=0,f=0,h=this._iteratorPool.acquire();h.reset(this.rootTiles);for(var g=this.tilingScheme.pixelSize,g=g[0]*g[1]*4;!h.done;){for(var k=h.next(),l=P(k),
m=0,q=k.layerInfo[F.LayerClass.MAP];m<q.length;m++){var p=q[m],p=p.data,t=0,r=0;p instanceof U?t+=1.3*p.descriptor.width*p.descriptor.height*4:p instanceof HTMLImageElement?r+=g:p instanceof V&&(f+=p.getGpuMemoryUsage(),c+=p.getCpuMemoryUsage());k.renderData||l?(a+=r,d+=t):(b+=r,e+=t)}l=0;for(m=k.layerInfo[F.LayerClass.ELEVATION];l<m.length;l++)p=m[l],p=p.data,a+=p?g:0;k.renderData&&(p=k.renderData.texture,d+=p&&p.descriptor?1.3*p.descriptor.width*p.descriptor.height*4:0,k=k.renderData.estimateGeometryMemoryUsage(),
f+=k,c+=k)}this._iteratorPool.release(h);return{cpuVisibleImageData:a,cpuInvisibleImageData:b,cpuGeometryData:c,gpuVisibleImageData:d,gpuInvisibleImageData:e,gpuGeometryData:f}};g.prototype.hasPendingUpdates=function(){if(this._streamDataSupplier.hasPendingDownloads()||0!==this._vectorTileLayerRequests)return!0;var a=this._iteratorPool.acquire();for(a.reset(this.rootTiles);!a.done;)if(0<a.next().pendingUpdates)return this._iteratorPool.release(a),!0;this._iteratorPool.release(a);return!1};g.prototype.getTile=
function(a){var b=a.split("/").map(function(a){return+a});if(0===b[0])return this.rootTiles.forEach(function(a){if(a.lij[1]===b[1]&&a.lij[2]===b[2])return a}),null;var c=Math.pow(2,b[0]),d=Math.floor(b[1]/c),e=Math.floor(b[2]/c),f;this.rootTiles.some(function(a){return a.lij[1]===d&&a.lij[2]===e?(f=a,!0):!1});if(f){for(c=1<<b[0]-1;f.lij[0]<b[0];){var h=b[1]&c?2:0;0<(b[2]&c)&&h++;if(!f.children[h])return console.log("Tile "+a+" doesn't exist, smallest ancestor is "+M.tile2str(f)),null;f=f.children[h];
c>>=1}R(f.lij[0]===b[0]&&f.lij[1]===b[1]&&f.lij[2]===b[2],"not the right tile?");return f}return null};g.prototype.setBorders=function(a){this._renderer.drawBorders=a};g.prototype.setDisableRendering=function(a){this._renderer.disableRendering=a};a([p.property({value:!1})],g.prototype,"cullBackFaces",null);a([p.property({readOnly:!0})],g.prototype,"extent",null);a([p.property({readOnly:!0})],g.prototype,"loaded",void 0);a([p.property({value:1})],g.prototype,"baseOpacity",null);a([p.property({readOnly:!0})],
g.prototype,"overlayManager",void 0);a([p.property({readOnly:!0})],g.prototype,"manifold",void 0);a([p.property()],g.prototype,"maxTextureScale",void 0);a([p.property({readOnly:!0})],g.prototype,"ready",null);a([p.property({value:1})],g.prototype,"renderOrder",null);a([p.property({readOnly:!0})],g.prototype,"rootTiles",void 0);a([p.property({value:!0})],g.prototype,"skirtScale",null);a([p.property({readOnly:!0,aliasOf:"tilingScheme.spatialReference"})],g.prototype,"spatialReference",void 0);a([p.property({})],
g.prototype,"backgroundImage",void 0);a([p.property({type:f})],g.prototype,"backgroundColor",void 0);a([p.property({dependsOn:["backgroundColor","backgroundImage"]})],g.prototype,"_background",null);a([p.property({readOnly:!0})],g.prototype,"tilingScheme",void 0);a([p.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],g.prototype,"tilingSchemeLocked",void 0);a([p.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeDone"})],g.prototype,"tilingSchemeDone",void 0);a([p.property({readOnly:!0})],
g.prototype,"tilingSchemeLogic",void 0);a([p.property({value:!0})],g.prototype,"velvetOverground",null);a([p.property({value:!1})],g.prototype,"wireframe",null);return g=a([p.subclass("esri.views.3d.terrain.TerrainSurface")],g)}(p.declared(b,t.Evented));var L=1.2,S=80/180*Math.PI,aa=110/180*Math.PI,ea=12,Z=u.vec4d.create(),da=r.create(),W=[0,0,0],ja={spatialReference:null,tile:null,extent:null},ca={spatialReference:null,extent:null,scale:0};return n})},"esri/views/3d/terrain/OverlayManager":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/on ../../../Graphic ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/accessorSupport/decorators ../../../geometry/Point ../../../geometry/support/aaBoundingRect ../../../symbols/SimpleMarkerSymbol ../lib/gl-matrix ../state/utils/viewUtils ../support/debugFlags ../support/debugFlags ../support/earthUtils ../support/mathUtils ../support/projectionUtils ../webgl-engine/lib/Selector".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x){var B=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]],D=h.getLogger("esri.views.3d.OverlayManager"),C,G=function(h){function g(){var a=null!==h&&h.apply(this,arguments)||this;a._handles=new e;a._overlaySR=null;a._renderSR=null;a._overlaySREqualsRenderSR=!0;a._connectedLayers={};a._scale=0;a._dirty=!1;a._isSpherical=!1;a._latestOriginId=0;a.opacity=0;return a}c(g,
h);Object.defineProperty(g.prototype,"hasHighlights",{get:function(){return this._renderer.hasHighlights},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this._stage=this.view._stage;this._renderer=this._stage.getDrapedTextureRenderer();this._renderer.onHasHighlightsChanged=function(){return a.onHasHighlightsChanged()};this._renderer.onContentChanged=function(){return a.setOverlayDirty()};this._renderer.forceUpdate=function(b){return a.updateOverlays(b)};this.groundSelector=
new x(this.view.viewingMode);this.groundSelector.enableBackfacesTerrain=!0;this.groundSelector.enableInvisibleTerrain=!0;this.groundSelector.enableHUDSelection=!1;this._handles.add(this.view.watch(["pointsOfInterest.renderPointOfView","pointsOfInterest.centerOnSurfaceFrequent.location"],function(){return a.setOverlayDirty()}));this._handles.add(this.view.on("resize",function(){return a.setOverlayDirty()}))};g.prototype.destroy=function(){for(var a in this._connectedLayers)this.unregisterLayerView(this._connectedLayers[a].layerView);
this._disposeOverlays();this._handles&&(this._handles.destroy(),this._handles=null)};g.prototype.onHasHighlightsChanged=function(){this.setOverlayDirty();this.notifyChange("hasHighlights")};g.prototype.hasOverlays=function(){return!!this._overlays};g.prototype.setSpatialReference=function(a,b){(this._overlaySR=a)?(this._renderSR=this.view.renderSpatialReference,this._overlaySREqualsRenderSR=this._overlaySR.equals(this._renderSR),this._longitudeCyclical=(this._isSpherical=b)?a.isWebMercator?new A.Cyclical(-2.0037508342788905E7,
2.0037508342788905E7):new A.Cyclical(-180,180):null):(this._disposeOverlays(),this._longitudeCyclical=null)};g.prototype.registerLayerView=function(a){var b=this,c=a.layer.uid;if(this._connectedLayers[c])D.warn("[OverlayManager#registerLayerView]: Layer "+c+" is already connected");else{var d=f(a,"draped-data-change",function(){return b.setOverlayDirty()});this._connectedLayers[c]={eventHandles:[d],layerView:a};a.setDrapingExtent&&this._overlays&&[this._overlays.inner,this._overlays.outer].forEach(function(c,
d){a.setDrapingExtent(d,c.extent,b._overlaySR,c.resolution,c.renderLocalOrigin)});this.setOverlayDirty();this._setLayerViewOverlayUpdating(a,this._dirty)}};g.prototype.unregisterLayerView=function(a){for(var b in this._connectedLayers){var c=this._connectedLayers[b];if(c.layerView===a){if(c.eventHandles)for(var d=0;d<c.eventHandles.length;d++)c.eventHandles[d].remove();delete this._connectedLayers[b];this.setOverlayDirty();a.destroyed||(a.overlayUpdating=!1)}}};g.prototype.setOverlayDirty=function(){this._dirty||
(this._setOverlayUpdating(!0),this._dirty=!0)};g.prototype._setLayerViewOverlayUpdating=function(a,b){if(!b||!a.suspended&&a.hasDraped)a.overlayUpdating=b};g.prototype._setOverlayUpdating=function(a){for(var b in this._connectedLayers)this._setLayerViewOverlayUpdating(this._connectedLayers[b].layerView,a);if(b=this.view.graphicsView)b.overlayUpdating=a};g.prototype.updateOverlays=function(a){void 0===a&&(a=this.view.state.camera);if(this._overlaySR){var b;b=Math.max(a.fullWidth,a.fullHeight);b=A.nextHighestPowerOfTwo(b+
256);b=Math.min(b,2048);this._computeOverlayExtents(a,b,H);this._overlays||this._initOverlays();this._updateOverlay(this._overlays.inner,0,H.inner,b);this._updateOverlay(this._overlays.outer,1,H.outer,b);this.opacity=1;this._setOverlayUpdating(!1);this._drawOverlays();this.terrainSurface._updateTileOverlayParams();this._dirty=!1}};g.prototype._updateOverlay=function(a,b,c,e){var f;a:{f=a.extent;for(var h=u.TESTS_DISABLE_UPDATE_THROTTLE_THRESHOLDS?0:G.EXTENTS_DIFFER_THRESHOLD*Math.max(c[2]-c[0],c[3]-
c[1],f[2]-f[0],f[3]-f[1]),g=0;4>g;g++)if(Math.abs(f[g]-c[g])>h){f=!0;break a}f=!1}if(f||e!==a.resolution){d.set(a.extent,c);a.resolution=e;a.renderLocalOrigin={id:"OV_"+this._latestOriginId++,vec3:d.center(a.extent,p.vec3d.create())};for(var k in this._connectedLayers)f=this._connectedLayers[k].layerView,f.setDrapingExtent&&f.setDrapingExtent(b,c,this._overlaySR,e,a.renderLocalOrigin)}};g.prototype.overlaysNeedUpdate=function(){return this._dirty&&!!this._overlaySR};g.prototype.updateOpacity=function(a){var b=
1;if(this._overlays){var c=this._scale;3.5*a<c&&(b=Math.sqrt(A.clamp((a-c/10)/(c/3.5-c/10),0,1)))}return b};g.prototype.setOverlayParamsOfTile=function(a,b,c){var e=this._overlays.inner,f=this._overlays.outer;a=d.intersection(a.extent,a.parentSurface.extent,M);this._rectInsideRect(a,e.extent)?(this._setTileOverlayData(a,e,b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1])):this._rectanglesOverlap(a,e.extent)?(this._setTileOverlayData(a,e,b.overlays[0]),this._setTileOverlayData(a,f,b.overlays[1])):
(this._rectanglesOverlap(a,f.extent)?this._setTileOverlayData(a,f,b.overlays[0]):this._invalidateTileOverlayData(b.overlays[0]),this._invalidateTileOverlayData(b.overlays[1]));b.overlayOpacity=void 0!==c?c:1};g.prototype._setTileOverlayData=function(a,b,c){var d=b.extent;c.texScale[0]=(a[2]-a[0])/(d[2]-d[0]);c.texScale[1]=(a[3]-a[1])/(d[3]-d[1]);var e=a[0];if(this._longitudeCyclical){var e=this._longitudeCyclical.minimalMonotonic(d[0],e),f=this._longitudeCyclical.minimalMonotonic(d[0],a[2]);e>f&&
(e=f-(a[2]-a[0]))}c.texOffset[0]=(e-d[0])/(d[2]-d[0]);c.texOffset[1]=(a[1]-d[1])/(d[3]-d[1]);c.renderTargetId=b.valid?b.renderTargetId:null;c.highlightRenderTargetId=b.highlightValid?b.highlightRenderTargetId:null};g.prototype._invalidateTileOverlayData=function(a){a.renderTargetId=null;a.highlightRenderTargetId=null};g.prototype.overlayPixelSizeInMapUnits=function(a){var b;this._overlays&&(b=this._pointIsInExtent(a,this._overlays.inner.extent)?this._overlays.inner:this._overlays.outer);return b?
(b.extent[2]-b.extent[0])/b.resolution:0};g.prototype._createEmptyOverlay=function(a){var b=this._renderer.createRenderTarget("overlay"+a);a=this._renderer.createHighlightRenderTarget("overlayHighlight"+a);return{extent:d.create(),resolution:0,renderTargetId:b,valid:!1,highlightRenderTargetId:a,highlightValid:!1,renderLocalOrigin:{id:"O",vec3:[0,0,0]}}};g.prototype._initOverlays=function(){this._overlays={inner:this._createEmptyOverlay(0),outer:this._createEmptyOverlay(1)}};g.prototype._disposeOverlays=
function(){this._overlays&&(this._renderer.disposeRenderTarget(this._overlays.inner.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.inner.highlightRenderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.renderTargetId),this._renderer.disposeRenderTarget(this._overlays.outer.highlightRenderTargetId),this._overlays=null)};g.prototype._intersectGroundFromView=function(a,b,c,d){var e=p.vec3d.createFrom(b*a.fullWidth,c*a.fullHeight,1);p.vec3d.unproject(e,a.viewMatrix,
a.projectionMatrix,a.fullViewport,e);b=p.vec3d.createFrom(b*a.fullWidth,c*a.fullHeight,0);p.vec3d.unproject(b,a.viewMatrix,a.projectionMatrix,a.fullViewport,b);this.groundSelector.init([],b,e,null,a,null,!1);this.view.basemapTerrain.intersect(this.groundSelector,b,e);return this.groundSelector.minResult.getIntersectionPoint(d)};g.prototype._findHorizonBasedPointOfInterest=function(a,b,c){var d=.5;if("global"===this.view.viewingMode){d=p.vec3d.create(a.eye);p.vec3d.normalize(d);p.vec3d.negate(d);b=
p.vec3d.length(b);b=Math.asin(b/p.vec3d.length(a.eye));var e=Math.acos(p.vec3d.dot(a.viewForward,d)),d=A.clamp((b-(e-.5*a.fovY))/a.fovY,0,1);b=A.clamp((-b-(e-.5*a.fovY))/a.fovY,0,1);d=1===d&&0===b?.5:b+.55*(d-b)}else d=p.mat4d.multiplyVec4(a.projectionMatrix,p.vec4d.createFrom(0,Math.tan(.5*Math.PI-Math.acos(-a.viewForward[2])),1,0))[1],d=A.clamp(.5+.5*d,0,1),d=1===d||0===d?.5:0<a.eye[2]?.55*d:1-.55*(1-d);return this._intersectGroundFromView(a,.5,d,c)?!0:!1};g.prototype._computeOverlayExtents=function(a,
c,e){var f=this.terrainSurface.extent,h=p.vec3d.create(),g=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation;this._findHorizonBasedPointOfInterest(a,this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,h)||p.vec3d.set(g,h);this._scale=this.view.renderCoordsHelper.getAltitude(a.eye);var l=p.vec3d.dist(a.eye,h),g=r.viewAngle(this.view.renderCoordsHelper,g,a.eye),g=Math.PI/2-Math.abs(g-Math.PI/2);if(t.OVERLAY_SHOW_CENTER){var m=new q({color:[255,0,0],outline:{color:[255,
255,255],width:2}}),u=new k;z.vectorToPoint(h,this._renderSR,u,this._overlaySR);m=new b({geometry:u,symbol:m});void 0!==C&&this.view.graphics.remove(C);this.view.graphics.add(m);C=m}this._overlaySREqualsRenderSR||z.vectorToVector(h,this._renderSR,h,this._overlaySR);c=.5*c*a.perPixelRatio*l*2;u=!1;l=Infinity;this._isSpherical&&(this._overlaySR.isWebMercator?(c/=Math.cos(z.webMercator.y2lat(h[1])),l=this.terrainSurface.extent[3],l*=.999):(u=!0,c/=v.metersPerDegree,l=90),c>=l&&(c=l,h[1]=0,this._overlaySR.isWebMercator&&
(h[0]=0)));m=1;u&&(m=1/Math.max(.2,Math.cos(Math.abs(A.deg2rad(h[1])))),180<c*m&&(m=180/c));var x=c*m,u=e.inner;u[0]=h[0]-x;u[1]=h[1]-c;u[2]=h[0]+x;u[3]=h[1]+c;this._isSpherical&&this._shiftExtentToFitBounds(u,Infinity,l);e=e.outer;d.set(e,u);6*x>f[2]-f[0]?d.set(e,f):g<=.25*Math.PI?(e[0]-=x,e[1]-=c,e[2]+=x,e[3]+=c):(z.vectorToVector(a.eye,this._renderSR,N,this._overlaySR),p.vec2d.subtract(h,N,K),a=-Math.atan2(K[1],K[0])+.125*Math.PI,0>a&&(a+=2*Math.PI),p.vec4d.scale(B[Math.floor(a/(.25*Math.PI))],
2*c,K),K[0]*=m,K[2]*=m,p.vec4d.add(e,K,e));this._isSpherical&&(e[0]=this._longitudeCyclical.clamp(e[0]),e[2]=this._longitudeCyclical.clamp(e[2]),e[1]=Math.max(e[1],-l),e[3]=Math.min(e[3],l));!this._isSpherical&&f&&(a=d.intersection(u,f,M),f=d.intersection(e,f,T),d.contains(a,f)&&(e[2]=e[0],e[3]=e[1]))};g.prototype._drawOverlays=function(){var a=this._overlays.inner.extent[2]-this._overlays.inner.extent[0];this._drawOverlay(this._overlays.inner,0,a);this._drawOverlay(this._overlays.outer,1,a)};g.prototype._drawOverlay=
function(a,b,c){var e=this._renderer,f=a.extent,h=a.resolution,g=this._longitudeCyclical?f[2]>this._longitudeCyclical.max:!1,k=this._longitudeCyclical?f[0]<this._longitudeCyclical.min:!1;if(g||k){E.views=I;var k=void 0,k=g?this._longitudeCyclical.max-f[0]:this._longitudeCyclical.min-f[0],k=Math.round(k/(f[2]-f[0])*h),l=E.views[0];p.vec4d.set4(0,0,k,h,l.viewport);p.vec4d.set4(f[0],f[1],this._longitudeCyclical.max,f[3],l.extent);g||(l.extent[0]+=this._longitudeCyclical.range);l=E.views[1];p.vec4d.set4(k,
0,h-k,h,l.viewport);p.vec4d.set4(this._longitudeCyclical.min,f[1],f[2],f[3],l.extent);g&&(l.extent[2]-=this._longitudeCyclical.range)}else E.views=F,d.set(E.views[0].extent,f),p.vec4d.set4(0,0,h,h,E.views[0].viewport);E.width=h;E.height=h;E.pixelRatio=c/(f[2]-f[0]);E.index=b;a.valid=e.draw(a.renderTargetId,E);a.highlightValid=e.drawHighlights(a.highlightRenderTargetId,E)};g.prototype._rectanglesOverlap=function(a,b){return this._longitudeCyclical?(this._longitudeCyclical.contains(b[0],b[2],a[0])||
this._longitudeCyclical.contains(b[0],b[2],a[2])||this._longitudeCyclical.contains(a[0],a[2],b[0]))&&!(a[1]>b[3]||a[3]<b[1]):d.intersects(a,b)};g.prototype._rectInsideRect=function(a,b){return this._longitudeCyclical?this._longitudeCyclical.contains(b[0],b[2],a[0])&&this._longitudeCyclical.contains(b[0],b[2],a[2])&&a[1]>b[1]&&a[3]<b[3]:d.contains(b,a)};g.prototype._pointIsInExtent=function(a,b){if(this._longitudeCyclical)return this._longitudeCyclical.contains(b[0],b[2],a.x)&&a.y>=b[1]&&a.y<=b[3];
var c=a.x;a=a.y;return c>b[0]&&c<b[2]&&a>b[1]&&a<b[3]};g.prototype._shiftExtentToFitBounds=function(a,b,c){var e=0,f=0;a[0]<-b?e=a[0]+b:a[2]>b&&(e=b-a[2]);a[1]<-c?f=a[1]+c:a[3]>c&&(f=c-a[3]);d.offset(a,e,f)};g.EXTENTS_DIFFER_THRESHOLD=1E-5;a([m.property()],g.prototype,"view",void 0);a([m.property()],g.prototype,"terrainSurface",void 0);a([m.property({type:Boolean})],g.prototype,"hasHighlights",null);return g=a([m.subclass("esri.views.3d.terrain.OverlayManager")],g)}(m.declared(l)),E={width:0,height:0,
pixelRatio:0,views:null,index:0},F=[{viewport:d.create(),extent:d.create()}],I=[F[0],{viewport:d.create(),extent:d.create()}],K=p.vec4d.create(),N=p.vec3d.create(),H={inner:d.create(),outer:d.create()},M=d.create(),T=d.create();return G})},"esri/views/3d/terrain/PlanarTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../lib/gl-matrix ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),function(n,g,c,a,f,b,l,e){n=function(f){function g(a,
b,c,e){var d=f.call(this,g.NumSubdivisionsAtLevel)||this;d.tileUp=h;void 0!==a&&d.init(a,b,c,e);return d}c(g,f);g.prototype.init=function(a,c,e,h){f.prototype.init.call(this,a,c,e,h);this.edgeLen=this.extent[2]-this.extent[0];this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=0;this.centerAtSeaLevel[0]=b.lerp(this.extent[0],this.extent[2],.5);this.centerAtSeaLevel[1]=b.lerp(this.extent[1],this.extent[3],.5);this.centerAtSeaLevel[2]=0;this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=
function(){f.prototype.updateRadiusAndCenter.call(this);var a=(this.extent[2]-this.extent[0])*Math.SQRT1_2,b=.5*(this.elevationBounds[0]-this.elevationBounds[1]);this.radius=Math.sqrt(a*a+b*b)};g.prototype.isVisible=function(a){if(!this.intersectsClippingArea)return!1;for(var b=this.extent[0],c=this.extent[1],d=this.elevationBounds[0],e=this.extent[2],f=this.extent[3],h=this.elevationBounds[1],g=0;6>g;++g){var k=a[g];if(0<k[0]*(0<k[0]?b:e)+k[1]*(0<k[1]?c:f)+k[2]*(0<k[2]?d:h)+k[3])return!1}return!0};
g.prototype.createGeometry=function(a,b,c){a.needsUpdate=!1;e.createPlanarGlobeTile(a.numVertsPerRow,this.extent,a.samplerData,b,c,a.clippingArea,this.renderData);this.updateMemoryUsed()};g.NumSubdivisionsAtLevel=[2,2,2,2,2,2,2,2];g.Pool=new a(g);return g}(l);var h=f.vec3d.createFrom(0,0,1);return n})},"esri/views/3d/terrain/Tile":function(){define("require exports ../../../core/arrayUtils ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ../support/mathUtils ../support/buffer/typedArrayUtil ./ElevationData ./ElevationTileAgent ./MapTileAgent ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./tileUtils ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t){function v(a){a instanceof h?h.Pool.release(a):a instanceof m&&m.Pool.release(a)}var A=d.weakAssert,z=f.vec3d.create(),x=f.vec4d.create(),B=f.vec4d.create(),D=f.vec3d.create(),C=q.AGENT_DONE;return function(){function g(b){this.lij=[0,0,0];this.extent=a.create();this.elevationBounds=f.vec2d.create();this.children=[null,null,null,null];this.layerInfo=Array(k.LayerClass.COUNT);this.extentWGS84Rad=a.create();this.centerAtSeaLevel=f.vec3d.create();this.center=
f.vec3d.create();this.tileUp=D;this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this._memoryUsed=this.radius=this.edgeLen2=this.edgeLen=this.renderOrder=this.screenDepth=this._maxTesselation=0;this.numSubdivisionsAtLevel=b}Object.defineProperty(g.prototype,"memoryUsed",{get:function(){return this._memoryUsed},enumerable:!0,configurable:!0});g.prototype.init=function(a,b,c,d){this.lij[0]=a[0];this.lij[1]=a[1];this.lij[2]=a[2];d.getExtent(a[0],a[1],a[2],this.extent,this.extentWGS84Rad);
this.intersectsClippingArea=this.isWithinClippingArea=!0;this.clippingArea=null;this.radius=this.edgeLen2=this.edgeLen=0;this.vlevel=a?a[0]:0;b&&b.elevationBounds?f.vec2d.set(b.elevationBounds,this.elevationBounds):f.vec2d.set2(0,0,this.elevationBounds);this.pendingUpdates=0;this.renderData=null;this.screenDepth=0;this.visible=!1;this.parent=b;this.parentSurface=c;for(a=0;4>a;a++)this.children[a]=null;for(a=0;a<k.LayerClass.COUNT;a++)if(c){b=c.numLayers(a);var e=void 0;this.layerInfo[a]?(e=this.layerInfo[a],
e.length=b):(e=Array(b),this.layerInfo[a]=e);for(var h=0;h<b;h++)e[h]=p.makeEmptyLayerInfo(a,e[h]),a===k.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(h,-1)}else this.layerInfo[a]=null;this.computeElevationBounds();this._maxTesselation=Math.min(d.pixelSize[0],k.MAX_TILE_TESSELATION)};g.prototype.dispose=function(){for(var a=0;a<k.LayerClass.COUNT;a++)for(var b=0,c=this.layerInfo[a];b<c.length;b++)c[b].dispose();this.updateMemoryUsed()};g.prototype.updateMemoryUsed=function(){for(var a=this.parentSurface.tilingScheme.pixelSize,
a=a[0]*a[1]*4,b=this._memoryUsed=0,c=this.layerInfo[k.LayerClass.MAP];b<c.length;b++){var d=c[b],d=d.data;d instanceof t?this._memoryUsed+=1.3*d.descriptor.width*d.descriptor.height*4:d instanceof HTMLImageElement?this._memoryUsed+=a:d instanceof u&&(this._memoryUsed+=d.getGpuMemoryUsage()+d.getCpuMemoryUsage())}b=0;for(c=this.layerInfo[k.LayerClass.ELEVATION];b<c.length;b++)d=c[b],this._memoryUsed+=d.data?a:0;this.renderData&&(this._memoryUsed+=this.renderData.estimateGeometryMemoryUsage(),a=this.renderData.texture?
this.renderData.texture.descriptor:null)&&(this._memoryUsed+=1.3*a.width*a.height*4)};g.prototype.updateScreenDepth=function(a){f.vec3d.set(this.center,B);B[3]=1;f.mat4d.multiplyVec4(a,B,B);this.screenDepth=B[2]/B[3]};g.prototype.shouldSplit=function(a,c){var d=this.lij[0];f.vec3d.subtract(this.center,c,z);var e=f.vec3d.length2(z),h=a[4];if(e<this.edgeLen2&&d<h)return k.TileUpdateTypes.SPLIT;var g=a[1],e=2*Math.sqrt(e),l=this.edgeLen/(a[0]*e);return l<g?this.vlevel!==this.lij[0]?(this.vlevel=this.lij[0],
k.TileUpdateTypes.VSPLITMERGE):k.TileUpdateTypes.NONE:d>=h?(a=d+Math.ceil(-b.log2(g/l)),a!==this.vlevel?(this.vlevel=a,k.TileUpdateTypes.VSPLITMERGE):k.TileUpdateTypes.NONE):6<d&&(f.vec3d.scale(this.tileUp,f.vec3d.dot(this.tileUp,z),x),f.vec3d.subtract(x,z),d=f.vec3d.length2(x),d>this.radius*this.radius&&(f.vec3d.scale(x,this.radius/Math.sqrt(d)),f.vec3d.add(x,this.center),f.vec3d.subtract(c,x,x),c=this.elevationBounds[1]-this.elevationBounds[0],Math.min(1,(Math.abs(f.vec3d.dot(x,this.tileUp))+.5*
c+this.curvatureHeight)/f.vec3d.length(x))*(this.edgeLen/(a[2]*e))<.1/a[5]*a[3]))?k.TileUpdateTypes.NONE:k.TileUpdateTypes.SPLIT};g.prototype.decodeElevationData=function(a){var b;if(l.isArrayBuffer(a))try{b=e.createFromLERC(this.lij,this.extent,a,k.noDataValueOpt)}catch(I){console.warn("Error decoding raw data: %s",I.message)}else b=e.createFromFetchTileResult(this.lij,this.extent,a);return b};g.prototype.getWGS84Extent=function(){var c=this.extentWGS84Rad;return a.fromValues(b.rad2deg(c[0]),b.rad2deg(c[1]),
b.rad2deg(c[2]),b.rad2deg(c[3]))};g.prototype.load=function(a){for(var b=0;b<k.LayerClass.COUNT;b++)this.layerInfo[b]&&this._createOrUpdateAgents(0,b);a.loadTile(this)};g.prototype.unload=function(a){this.renderData&&a.unloadTile(this);for(a=0;a<k.LayerClass.COUNT;a++)for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==C&&(d.loadingAgent.dispose(),v(d.loadingAgent),d.loadingAgent=null);d.pendingUpdates=0}this.pendingUpdates&=~k.TileUpdateTypes.UPDATE_GEOMETRY;
this.pendingUpdates&=~k.TileUpdateTypes.UPDATE_TEXTURE};g.prototype.updateClippingStatus=function(a){if(c.equals(a,this.clippingArea))return!1;var b=this.intersectsClippingArea,d=this.isWithinClippingArea;a?(this.intersectsClippingArea=this.intersectsExtent(a),this.isWithinClippingArea=this.isWithinExtent(a)):this.isWithinClippingArea=this.intersectsClippingArea=!0;this.clippingArea=a;a=d&&this.isWithinClippingArea;b=!d&&!b&&!this.isWithinClippingArea&&!this.intersectsClippingArea;!this.renderData||
a||b||this.updateGeometry();return!0};g.prototype.updateVisibility=function(a){a=this.isVisible(a)&&this.intersectsClippingArea;if(a!==this.visible){this.visible=a;for(var b=this.layerInfo[0],c=0;c<b.length;c++){var d=b[c];d.loadingAgent&&d.loadingAgent!==C&&d.loadingAgent.setSuspension(!a)}}return a};g.prototype.getLayerInfo=function(a,b){return this.layerInfo[b][a]};g.prototype.hasLayerData=function(a,b){return(a=this.layerInfo[b][a])&&a.data&&!a.dataInvalidated};g.prototype.hasDataAvailable=function(a,
b,c){return(b=this.layerInfo[c][b].tilemap)?"unavailable"!==b.getAvailability(a.lij[1],a.lij[2]):!0};g.prototype.requestLayerData=function(a,b,c){k.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d requested by tile %s",this.lij.toString(),b,a,c.tile.lij.toString());var d=this.layerInfo[b][a];if(-1<d.waitingAgents.indexOf(c))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),!0;d.waitingAgents.push(c);
if(d.data&&!d.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),c.tile.lij.toString(),b,a),setTimeout(c.dataArrived.bind(c,this),0),!0;if(d.pendingUpdates&k.TileUpdateTypes.DECODE_ELEVATION||d.requestPromise)return!0;var e=this.parentSurface.requestTileData(this,a,b);if(!e||e.isFulfilled())return!1;a=function(){d.requestPromise===e&&(d.requestPromise=null)};d.requestPromise=e;e.then(a,a);return!0};g.prototype.descendants=
function(a){a||(a=[]);for(var b=0;4>b;b++){var c=this.children[b];c&&(c.descendants(a),a.unshift(this.children[b]))}return a};g.prototype.hasLij=function(a){return this.lij[0]===a[0]&&this.lij[1]===a[1]&&this.lij[2]===a[2]};g.prototype.findByLij=function(a){if(this.hasLij(a))return this;for(var b=0;4>b;b++){var c=this.children[b];if(c&&(c=c.findByLij(a)))return c}return null};g.prototype.unrequestLayerData=function(a,b,e){k.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d canceled by tile %s",
this.lij.toString(),b,a,e.tile.lij.toString());var f=this.layerInfo[b][a],h=f.waitingAgents;e=null!=c.removeUnordered(h,e);A(e,"agent has not requested this piece of map data");1>h.length&&(h=f.requestPromise,e=!1,b===k.LayerClass.MAP&&(e=this.parentSurface.layerViewByIndex(a,k.LayerClass.MAP),e=d.isVectorTileLayerView(e)),e||A(h||f.rawData,"no pending operations on layerInfo that agents were waiting for"),h&&!h.isFulfilled()&&(h.cancel(),f.requestPromise=null),k.TILE_LOADING_DEBUGLOG&&console.log("tile %s layer %d/%d request/loading canceled",
this.lij.toString(),b,a),this.updateMemoryUsed())};g.prototype.dataArrived=function(a,b,c){a=this.layerInfo[b][a];a.data=c;a.dataInvalidated=!1;for(c=0;c<a.waitingAgents.length;c++)a.waitingAgents[c].dataArrived(this);a.waitingAgents.length=0;this.updateMemoryUsed()};g.prototype.dataMissing=function(a,b,c){c.notInTilemap||console.error("Tile %s layer %d/%d error",this.lij.toString(),b,a);a=this.layerInfo[b][a];a.dataMissing=!0;for(b=0;b<a.waitingAgents.length;b++)a.waitingAgents[b].dataMissing(this);
a.waitingAgents.length=0;this.updateMemoryUsed()};g.prototype.updateTexture=function(a){void 0===a&&(a=!1);this.renderData&&(a?this.parentSurface.renderer.updateTileTexture(this):(this.pendingUpdates|=k.TileUpdateTypes.UPDATE_TEXTURE,this.parentSurface.setPendingUpdates()))};g.prototype.invalidateLayerData=function(a,b){this.layerInfo[b][a].invalidateSourceData();this.restartAgents(b)};g.prototype.computeElevationBounds=function(){f.vec2d.set2(Number.MAX_VALUE,-Number.MAX_VALUE,this.elevationBounds);
for(var a=this.layerInfo[k.LayerClass.ELEVATION],b=!1,c=0;c<a.length;c++){var d=a[c];d.elevationBounds&&(this.elevationBounds[0]=Math.min(this.elevationBounds[0],d.elevationBounds[0]),this.elevationBounds[1]=Math.max(this.elevationBounds[1],d.elevationBounds[1]),b=!0)}b||f.vec2d.set2(0,0,this.elevationBounds);this.updateRadiusAndCenter()};g.prototype.updateRadiusAndCenter=function(){f.vec3d.scale(this.tileUp,.5*(this.elevationBounds[0]+this.elevationBounds[1]),x);f.vec3d.add(this.centerAtSeaLevel,
x,this.center)};g.prototype.findElevationBoundsForLayer=function(a,b){var c=this.layerInfo[k.LayerClass.ELEVATION][a];if(!c.elevationBounds||c.elevationBounds[2]<b)if(b=this.parentSurface.layerViewByIndex(a,k.LayerClass.ELEVATION),r.fallsWithinLayer(this,b.layer,!1)){b=!1;if(c.data){var d=c.data;f.vec2d.set(d.bounds,x);x[2]=this.lij[0];b=!0}else{for(var e=this.parent,h=0,g=null,d=c.data;e&&(!d||h<k.ELEVATION_DESIRED_RESOLUTION_LEVEL);){h=this.vlevel-e.lij[0];g=d||g;d=e.layerInfo[k.LayerClass.ELEVATION][a].data;
if(!d&&g&&h>=k.ELEVATION_DESIRED_RESOLUTION_LEVEL)break;e=e.parent}if(d=d||g)d.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],x),Infinity!==x[0]&&(x[2]=d.level,b=!0)}b&&(c.elevationBounds?f.vec3d.set(x,c.elevationBounds):c.elevationBounds=[x[0],x[1],x[2]])}};g.prototype.updateGeometry=function(){this.pendingUpdates|=k.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()};g.prototype.modifyLayers=function(a,b,c){for(var d=this.layerInfo[c],e=0;e<d.length;e++){var f=d[e];f.loadingAgent&&
f.loadingAgent!==C&&(f.loadingAgent.dispose(),v(f.loadingAgent),f.loadingAgent=null);f.waitingAgents.length=0}if(c===k.LayerClass.MAP)for(e=0;e<d.length;++e)void 0===a[e]&&d[e].dispose();a=b.length;f=Array(a);for(e=0;e<a;e++){var h=b[e];f[e]=-1<h?d[h]:p.makeEmptyLayerInfo(c)}this.layerInfo[c]=f;this.updateMemoryUsed()};g.prototype.restartAgents=function(a){if(this.renderData)if(this._createOrUpdateAgents(0,a),a===k.LayerClass.ELEVATION){this.updateGeometry();a=this.layerInfo[a];for(var b=0;b<a.length;b++)a[b].pendingUpdates|=
k.TileUpdateTypes.UPDATE_GEOMETRY;this.parentSurface.setPendingUpdates()}else this.updateTexture(!0)};g.prototype.updateAgents=function(a){if(this.renderData){for(var b=this.layerInfo[a],c=0;c<b.length;c++){var d=b[c];d.loadingAgent===C&&(d.loadingAgent=null)}this._createOrUpdateAgents(0,a)}};g.prototype.removeLayerAgent=function(a,b){a=this.layerInfo[b][a];a.loadingAgent&&a.loadingAgent!==C&&a.loadingAgent.dispose();a.loadingAgent=null};g.prototype.agentDone=function(a,b){var c=this.layerInfo[b],
d=c[a];d.loadingAgent=C;d.data||d.upsampleFromTile||a<c.length-1&&this._createOrUpdateAgents(a+1,b)};g.prototype._createOrUpdateAgents=function(a,b){for(var c=b===k.LayerClass.ELEVATION?!1:!this.visible,d=this.layerInfo[b];a<d.length;++a){var e=d[a],f=!1,g=this.parentSurface.layerViewByIndex(a,b);if(e.loadingAgent)e.loadingAgent!==C&&(f=e.loadingAgent.update());else if(r.fallsWithinLayer(this,g.layer,!1)){var l;l=b===k.LayerClass.ELEVATION?h.Pool.acquire():m.Pool.acquire();(f=l.init(this,a,b,c))?
e.loadingAgent=l:(l.dispose(),v(l),e.loadingAgent=C)}if(f&&g.isOpaque)break}};g.prototype.geometryState=function(a){var d,e=this._getElevationInfo(a?a.samplerData:null),f=this.lij[0];e.samplerData?(d=this.vlevel-f,d=Math.max(f-e.maxTileLevel,k.ELEVATION_DESIRED_RESOLUTION_LEVEL-d),f=this._maxTesselation,d=b.clamp((f>>d)+1,2,f+1)):d=8>f?this.numSubdivisionsAtLevel[f]+1:2;f=this.clippingArea;if(!this.intersectsClippingArea||this.isWithinClippingArea)f=null;a?(a.needsUpdate=!1,a.numVertsPerRow!==d&&
(a.numVertsPerRow=d,a.needsUpdate=!0),e.changed&&(a.samplerData=e.samplerData,a.needsUpdate=!0),c.equals(a.clippingArea,f)||(a.clippingArea=f,a.needsUpdate=!0)):a={numVertsPerRow:d,samplerData:e.samplerData,needsUpdate:!0,clippingArea:f};return a};g.prototype._getElevationInfo=function(a){for(var b=this.layerInfo[k.LayerClass.ELEVATION],c=b.length,d=Array(c),e=0,f=0,h=!1,g=0;g<c;g++){var l=b[g];if(l.upsampleFromTile){var l=l.upsampleFromTile.tile,m=l.layerInfo[k.LayerClass.ELEVATION][g].data;a&&a[e]===
m.samplerData||(h=!0);d[e++]=m.samplerData;f=Math.max(f,l.lij[0])}else l.data&&(m=this.parentSurface.layerViewByIndex(g,k.LayerClass.ELEVATION),r.fallsWithinLayer(this,m.layer,!1)&&(m=l.data,a&&a[e]===m.samplerData||(h=!0),d[e++]=m.samplerData,f=this.lij[0]))}a&&a.length!==e&&(h=!0);0<e?d.length=e:d=null;return{changed:h,samplerData:d,maxTileLevel:f}};g.prototype.isWithinExtent=function(a){var b=this.extent;return b[0]>=a[0]&&a[2]>=b[2]&&b[1]>=a[1]&&a[3]>=b[3]};g.prototype.intersectsExtent=function(a){var b=
this.extent;return b[2]>=a[0]&&a[2]>=b[0]&&b[3]>=a[1]&&a[3]>=b[1]};return g}()})},"esri/views/3d/terrain/ElevationData":function(){define(["require","exports","../../../layers/support/rasterFormats/LercCodec","../support/mathUtils","./TerrainConst"],function(n,g,c,a,f){return function(){function b(a,b,c,f){this.samplerData=null;this.level=a;this.i=b;this.j=c;this.extent=f}b.prototype.computeMinMaxValue=function(b,c,h,g){var e=Infinity,d=-Infinity;b-=this.level;var l=Math.pow(2,b);if(Math.floor(c/
l)===this.i&&Math.floor(h/l)===this.j&&0<b){var m=this.samplerData.width,r=this.samplerData.pixelData,u=.5*f.ELEVATION_NODATA_VALUE;b=(m-1)/l;h=(h-this.j*l)*b;c=(c-this.i*l)*b;if(1>b){var l=Math.floor(h),t=Math.floor(c),v=l+t*m,n=r[v],z=r[v+1],x=r[v+m],v=r[v+m+1];if(n+z+x+v<u)return e=a.bilerp(n,z,x,v,h-l,c-t),d=a.bilerp(n,z,x,v,h-l+b,c-t),m=a.bilerp(n,z,x,v,h-l,c-t+b),b=a.bilerp(n,z,x,v,h-l+b,c-t+b),g[0]=Math.min(e,d,m,b),g[1]=Math.max(e,d,m,b),g;h=l;c=t;b=1}else h=Math.floor(h),c=Math.floor(c),
b=Math.ceil(b);for(l=h;l<=h+b;l++)for(t=c;t<=c+b;t++)v=l+t*m,n=r[v],n<u?(e=Math.min(e,n),d=Math.max(d,n)):(e=0<e?0:e,d=0>d?0:d)}g[0]=e;g[1]=d;return g};b.createFromLERC=function(a,e,f,g){f=c.decode(f,g);a=new b(a[0],a[1],a[2],e);a.samplerData={pixelData:f.pixelData,width:f.width,height:f.height,minValue:f.minValue,maxValue:f.maxValue,noDataValue:f.noDataValue,safeWidth:.99999999*(f.width-1),dx:(f.width-1)/(a.extent[2]-a.extent[0]),dy:(f.width-1)/(a.extent[3]-a.extent[1]),x0:a.extent[0],y1:a.extent[3]};
a.bounds=[a.samplerData.minValue,-3E38<a.samplerData.maxValue?a.samplerData.maxValue:0];return a};b.createFromFetchTileResult=function(a,c,f){a=new b(a[0],a[1],a[2],c);c=f.values;for(var e=f.noDataValue,h=Infinity,d=-Infinity,g=!0,l=0;l<c.length;l++){var r=c[l];r!==e&&(h=r<h?r:h,d=r>d?r:d,g=!1)}g&&(d=h=0);a.samplerData={pixelData:f.values,width:f.width,height:f.height,minValue:h,maxValue:d,noDataValue:e,safeWidth:.99999999*(f.width-1),dx:(f.width-1)/(a.extent[2]-a.extent[0]),dy:(f.width-1)/(a.extent[3]-
a.extent[1]),x0:a.extent[0],y1:a.extent[3]};a.bounds=[h,d];return a};return b}()})},"esri/views/3d/terrain/ElevationTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TerrainConst ./TileAgent ./UpsampleInfo".split(" "),function(n,g,c,a,f,b,l){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a._scaleRangeEnabled=!1;return a}c(e,b);e.prototype.dataArrived=function(a){a!==this.tile?this._setUpsamplingTile(a):(this._unsetUpsamplingTile(),
this.updateGeometry());this._dataRequested=null;this._requestNext()};e.prototype.updateGeometry=function(){this._tileLayerInfo.pendingUpdates|=f.TileUpdateTypes.UPDATE_GEOMETRY;this.tile.updateGeometry()};e.prototype._findAncestorWithData=function(){for(var a=this.layerClass,b=this.layerIdx,c=this.tile,e=c.vlevel,h;c&&!(c.layerInfo[a][b].data&&(h=c,e-c.lij[0]>=f.ELEVATION_DESIRED_RESOLUTION_LEVEL));)c=c.parent;return h?(a=l.Pool.acquire(),a.init(h,0,0,1),a):null};e.prototype._desiredMinLevelDelta=
function(){return f.ELEVATION_DESIRED_RESOLUTION_LEVEL-(this.tile.vlevel-this.tile.lij[0])};e.prototype._setUpsamplingTile=function(a){this._unsetUpsamplingTile();var b=l.Pool.acquire();b.init(a,0,0,1);this._tileLayerInfo.upsampleFromTile=b;this.updateGeometry()};e.Pool=new a(e);return e}(b)})},"esri/views/3d/terrain/TileAgent":function(){define(["require","exports","./tileUtils","./UpsampleInfo"],function(n,g,c,a){function f(b,c,h,g,k,d,q){if(!b.parent||6<q)return null;g*=.5;k*=.5;d*=.5;b.lij[2]&
1&&(k+=.5);0===(b.lij[1]&1)&&(d+=.5);return b.parent.hasLayerData(c,h)?(c=a.Pool.acquire(),c.init(b.parent,k,d,g),c):f(b.parent,c,h,g,k,d,q+1)}var b=Error("Abstract method called on TileAgent");return function(){function g(){}g.prototype.init=function(b,c,f,g){this.tile=b;this.layerIdx=c;this.layerClass=f;this.suspended=g;this._tileLayerInfo=b.getLayerInfo(c,f);this._dataRequested=null;(b=this._findAncestorWithData())?(this._setUpsamplingTile(b.tile),a.Pool.release(b)):this._unsetUpsamplingTile();
return this._requestNext(!0)};g.prototype.dispose=function(){this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null);this._tileLayerInfo=this.tile=null};g.prototype.setSuspension=function(a){a!==this.suspended&&((this.suspended=a)?this._dataRequested&&(this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this),this._dataRequested=null):this._tileLayerInfo.data||this.update())};g.prototype.update=function(){var b=this._findAncestorWithData(),
c=this._tileLayerInfo.upsampleFromTile;b&&(c&&b.tile!==c.tile&&this._setUpsamplingTile(b.tile),a.Pool.release(b));return this._requestNext()};g.prototype.dataArrived=function(a){throw b;};g.prototype.dataMissing=function(a){this._dataRequested=null;this._tileLayerInfo.disposeData();this._requestNext()};g.prototype._agentDone=function(){this.tile.agentDone(this.layerIdx,this.layerClass);this.dispose()};g.prototype._requestNext=function(a){void 0===a&&(a=!1);if(this.suspended)return!0;var b=this._findNextDownload();
if(this._dataRequested){if(b===this._dataRequested)return!0;this._dataRequested.unrequestLayerData(this.layerIdx,this.layerClass,this);this._dataRequested=null}b?b.requestLayerData(this.layerIdx,this.layerClass,this)&&(this._dataRequested=b):a||this._agentDone();return!!this._dataRequested};g.prototype._findNextDownload=function(){for(var a=this.layerIdx,b=this.layerClass,f=this.tile.parentSurface.layerViewByIndex(a,b),k=f.minDataLevel,d=f.maxDataLevel,l=this._desiredMinLevelDelta(),p=g.START_LOADING_LEVEL_DELTA+
l,r=this._scaleRangeEnabled,u,t=this.tile,v=0,n=t.lij[0],z=this._tileLayerInfo.upsampleFromTile,z=z?z.tile.lij[0]:-1,x=this.tile.parentSurface,B=x.tilemapStats,D=x.getTilemapTile(t),C=!1;t&&(!r||c.fallsWithinLayer(t,f.layer,!1))&&t.lij[0]>=k;){var G=t.layerInfo[b][a];if(G.data&&v>=l){t.lij[0]>z&&this._setUpsamplingTile(t);G.dataInvalidated&&(u=t);break}if(D&&!D.hasDataAvailable(t,a,b))C=!0;else if(t.lij[0]<=d&&!G.data&&!G.dataMissing&&(u=t,v>=p))break;(t=t.parent)&&D&&(D=D.parent||x.getTilemapTile(t));
v++}u&&n-u.lij[0]<l&&this._tileLayerInfo.upsampleFromTile&&(u=null);!u&&C&&B.tilesNotPresent++;return u};g.prototype._findAncestorWithData=function(){return f(this.tile,this.layerIdx,this.layerClass,1,0,0,0)};g.prototype._desiredMinLevelDelta=function(){throw b;};g.prototype._setUpsamplingTile=function(a){throw b;};g.prototype._unsetUpsamplingTile=function(){this._tileLayerInfo.upsampleFromTile&&a.Pool.release(this._tileLayerInfo.upsampleFromTile);this._tileLayerInfo.upsampleFromTile=null};g.START_LOADING_LEVEL_DELTA=
4;g.AGENT_DONE=new g;return g}()})},"esri/views/3d/terrain/tileUtils":function(){define("require exports ../../../core/PooledArray ../lib/gl-matrix ./UpsampleInfo ../webgl-engine/materials/internal/MaterialUtil".split(" "),function(n,g,c,a,f,b){function l(a){return a[0]+"/"+a[1]+"/"+a[2]}function e(a,b){b(a);for(var c=0;4>c;c++){var d=a.children[c];d&&e(d,b)}}function h(a,b){for(var c=0;4>c;c++){var d=a.children[c];d&&h(d,b)}b(a)}Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(){this.q=
new c;this._last=null;this.done=!0}a.prototype.resetOne=function(a){this.q.clear();this.q.push(a);this._last=null;this.done=!1};a.prototype.reset=function(a){this.q.clear();a&&this.q.pushArray(a);this._last=null;this.done=0===this.q.length};a.prototype.skipSubtree=function(){this._last=null;0===this.q.length&&(this.done=!0)};a.prototype.next=function(){if(this.done)return null;if(this._last){var a=this._last.children;if(a[0])for(var b=3;0<=b;b--){var c=a[b];c&&this.q.push(c)}}this._last=this.q.pop();
0!==this.q.length||this._last.children[0]||(this.done=!0);return this._last};return a}();g.IteratorPreorder=n;n=function(){function a(a){void 0===a&&(a=100);this.q=new c({initialSize:a});this.done=!0}a.prototype.reset=function(a){this.q.clear();if(a)for(this.q.pushArray(a),a=0;a<this.q.length;++a)for(var b=this.q.data[a],c=0;4>c;c++){var d=b.children[c];d&&this.q.push(d)}this.done=0===this.q.length};a.prototype.next=function(){var a=this.q.pop();this.done=0===this.q.length;return a};return a}();g.IteratorPostorder=
n;g.lij2str=l;g.tile2str=function(a){return l(a.lij)};g.traverseTilesPreorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)e(a[c],b);else e(a,b)};g.traverseTilesPostorder=function(a,b){if(Array.isArray(a))for(var c=0;c<a.length;c++)h(a[c],b);else h(a,b)};g.fallsWithinLayer=function(a,b,c){if(!b)return!1;var d=b.fullExtent,e=a.extent;if(c){if(e[0]<d.xmin||e[1]<d.ymin||e[2]>d.xmax||e[3]>d.ymax)return!1}else if(d.xmin>e[2]||d.ymin>e[3]||d.xmax<e[0]||d.ymax<e[1])return!1;a=a.parentSurface.tilingScheme.levels[a.lij[0]].scale;
return 0<b.minScale&&a>1.00000001*b.minScale||0<b.maxScale&&a<.99999999*b.maxScale?!1:!0};g.isPosWithinTile=function(a,b){a=a.extent;return b[0]>=a[0]&&b[1]>=a[1]&&b[0]<=a[2]&&b[1]<=a[3]};g.getTileNLevelsUp=function(a,b){for(;b--;)a=a.parent;return a};g.nextTileInAncestry=function(a,b){var c=a.lij[0]-b.lij[0]-1,d=a.lij[2]>>c,e=0;a.lij[1]>>c&1&&(e+=2);d&1&&(e+=1);return b.children[e]};g.computeUpsampleInfoForAncestor=function(a,b){for(var c=1,d=0,e=0;a!==b;)if(c*=.5,d*=.5,e*=.5,a.lij[2]&1&&(d+=.5),
0===(a.lij[1]&1)&&(e+=.5),a=a.parent,null==a)throw Error("tile was not a descendant of ancestorTile");a=f.Pool.acquire();a.init(b,d,e,c);return a};g.hasVisibleSiblings=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.parent;if(d)for(var e=0;4>e;e++){var f=d.children[e];if(f&&f!==c&&f.visible)return!0}}return!1};var m=Math.pow(2,-52),k=a.vec3d.create(),d=a.vec3d.create();g.intersectSkirts=function(c,e,f,h,g,l,n,z,x){var p=l.data,q=l.offsetIdx;l=l.strideIdx;var t=c[0],r=c[1];c=c[2];var u=e[0]-
t,v=e[1]-r;for(e=e[2]-c;f<h;f++){var A=n?n[f]:f,K=q+l*g[3*A],N=q+l*g[3*A+1],H=q+l*g[3*A+2],M=p[K],T=p[K+1],V=p[K+2];2<=p[K+3]&&(a.vec3d.set3(M,T,V,k),z(k),M+=k[0],T+=k[1],V+=k[2]);var U=p[N],K=p[N+1],J=p[N+2];2<=p[N+3]&&(a.vec3d.set3(U,K,J,k),z(k),U+=k[0],K+=k[1],J+=k[2]);var N=p[H],O=p[H+1],P=p[H+2];2<=p[H+3]&&(a.vec3d.set3(N,O,P,k),z(k),N+=k[0],O+=k[1],P+=k[2]);var H=U-M,K=K-T,J=J-V,N=N-M,O=O-T,P=P-V,R=v*P-O*e,Q=e*N-P*u,L=u*O-N*v,U=H*R+K*Q+J*L,M=t-M,S=r-T,aa=c-V,V=S*J-K*aa,T=aa*H-J*M,ea=M*K-H*S;
if(U>m){M=M*R+S*Q+aa*L;if(0>M||M>U)continue;R=u*V+v*T+e*ea;if(0>R||M+R>U)continue}else if(U<-m){M=M*R+S*Q+aa*L;if(0<M||M<U)continue;R=u*V+v*T+e*ea;if(0<R||M+R<U)continue}else continue;V=(N*V+O*T+P*ea)/U;0<=V&&(H=b.computeNormal(H,K,J,N,O,P,d),x(V,H,A))}}})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["require","exports","../../../core/ObjectPool","../lib/gl-matrix"],function(n,g,c,a){return function(){function f(b,c,e,f){this.scale=0;this.tile=null;this.offset=a.vec2d.create();void 0!==
b&&this.init(b,c,e,f)}f.prototype.init=function(a,c,e,f){this.tile=a;this.offset[0]=c;this.offset[1]=e;this.scale=f};f.prototype.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};f.Pool=new c(f);return f}()})},"esri/views/3d/terrain/MapTileAgent":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ./TileAgent ./tileUtils".split(" "),function(n,g,c,a,f,b){return function(f){function e(){var a=f.call(this)||this;a._scaleRangeEnabled=
!0;return a}c(e,f);e.prototype.dataArrived=function(a){a===this.tile?(this._unsetUpsamplingTile(),this.tile.updateTexture()):this._setUpsamplingTile(a);this._dataRequested=null;a!==this.tile&&this._requestNext()};e.prototype._desiredMinLevelDelta=function(){return 0};e.prototype._setUpsamplingTile=function(a){this._tileLayerInfo.upsampleFromTile&&this._tileLayerInfo.upsampleFromTile.tile===a||(this._unsetUpsamplingTile(),this._tileLayerInfo.upsampleFromTile=b.computeUpsampleInfoForAncestor(this.tile,
a),this.tile.updateTexture())};e.Pool=new a(e);return e}(f)})},"esri/views/3d/terrain/terrainUtils":function(){define("require exports ../../../layers/ElevationLayer ../../../layers/TileLayer ../../../layers/VectorTileLayer ../../../support/basemapDefinitions ./terrainUtilsPlanar ./terrainUtilsSpherical".split(" "),function(n,g,c,a,f,b,l,e){function h(a){return a&&"esri.views.3d.layers.TileLayerView3D"===a.declaredClass}function m(a){return a&&"esri.views.3d.layers.VectorTileLayerView3D"===a.declaredClass}
function k(a){return a&&"esri.views.3d.layers.WMTSLayerView3D"===a.declaredClass}function d(a){return a&&"esri.views.3d.layers.ElevationLayerView3D"===a.declaredClass}function q(){u={};for(var a in b)b[a].baseMapLayers.forEach(function(a){u[a.url]=19});u["//services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"]=20}function p(a,b,c,d){return r["local"===d||"planar"===d?"planar":"spherical"].checkIfTileInfoSupportedForViewSR(a,b,c)}Object.defineProperty(g,"__esModule",{value:!0});
var r={planar:l,spherical:e};g.weakAssert=function(a,b){a||console.warn("Terrain: "+b)};g.autoUpdateSkirtsVisibility=function(a,b,c){var d=r[a.manifold],e,f=d.isInsideExtent(a,b);f?e=a.getElevation(b):(e=a.getElevationBounds(),e=.5*(e[0]+e[1]));e=b[2]-e;c=.9*Math.abs(e)<c?0:0>e?-1:1;f||(d.isInsideExtent(a,b,a.hideSkirtsDistanceFromExtentMargin)?(b=d.tiltToExtentEdge(a,b),b>a.hideSkirtsMinimumCameraTilt&&b<a.hideSkirtsMaximumCameraTilt&&(c=0)):c=0);a.skirtScale=c};g.isTiledLayer=function(a){return a&&
"base-tile"===a.type||"tile"===a.type||"elevation"===a.type||"base-elevation"===a.type||"open-street-map"===a.type||"web-tile"===a.type||"wmts"===a.type||"vector-tile"===a.type};g.isVectorTileLayer=function(a){return a&&a.isInstanceOf(f)};g.isTileLayerView=h;g.isVectorTileLayerView=m;g.isWMTSLayerView=k;g.isElevationLayerView=d;g.isTiledLayerView=function(a){return a&&(h(a)||d(a)||m(a)||k(a))};g.useFetchTileForLayer=function(b){return b.fetchTile&&!(b.fetchTile===a.prototype.fetchTile||b.fetchTile===
c.prototype.fetchTile)};var u=null;g.getKnownTiledServiceLevelCap=function(a){u||q();a=a&&a.replace(/https?:/,"");return a in u?u[a]:Infinity};g.prepareKnownTiledServiceLevelCaps=q;g.checkIfTileInfoSupportedForView=p;g.getTiledLayerInfo=function(a,b,c){var d,e;if("wmts"===a.type){if(a=a.activeLayer){var f=a.tileMatrixSet;if(f)d=f.tileInfo,e=f.fullExtent;else if(a=a.tileMatrixSets)if(a=a.find(function(a){return null==p(a.tileInfo,a.fullExtent,b,c)}))return{tileInfo:a.tileInfo,fullExtent:a.fullExtent}}}else d=
"vector-tile"===a.type?a.compatibleTileInfo256:a.tileInfo,e=a.fullExtent;return d&&e&&null==p(d,e,b,c)?{tileInfo:d,fullExtent:e}:{tileInfo:null,fullExtent:null}}})},"esri/layers/VectorTileLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../request ../core/Error ../core/MultiOriginJSONSupport ../core/promiseUtils ../core/urlUtils ../core/urlUtils ../core/accessorSupport/decorators ../geometry/Extent ../geometry/SpatialReference ./Layer ./mixins/ArcGISCachedService ./mixins/OperationalLayer ./mixins/PortalLayer ./mixins/ScaleRangeLayer ./support/TileInfo ./support/TilemapCache ./support/vectorTileLayerLoader ../portal/support/jsonContext ../views/vectorTiles/SchemaHelper ../views/vectorTiles/style/StyleRepository".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G){return function(e){function g(a,b){a=e.call(this)||this;a.capabilities=null;a.currentStyleInfo=null;a.fullExtent=null;a.style=null;a.operationalLayerType="VectorTileLayer";a.tileInfo=null;a.tilemapCache=null;a.type="vector-tile";a.url=null;return a}a(g,e);g.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?c({url:a},b):a};g.prototype.load=function(){var a=this,c=this.loadFromPortal({supportedTypes:["Vector Tile Service"],
supportsData:!1}).then(function(){if(a.portalItem&&a.portalItem.id){var c=a.portalItem.itemUrl+"/resources/styles/root.json";return b(c,{query:{f:"json"}}).then(function(b){b.data&&a.read({url:c},D.createForItem(a.portalItem))})}}).always(function(){return a.loadStyle()});this.addResolvingPromise(c);return this.when()};Object.defineProperty(g.prototype,"attributionDataUrl",{get:function(){var a=this.currentStyleInfo;return(a=a&&a.serviceUrl&&k.urlToObject(a.serviceUrl))?this._getDefaultAttribution(a.path):
null},enumerable:!0,configurable:!0});g.prototype.readCapabilities=function(a,b){var c=b.capabilities&&b.capabilities.split(",").map(function(a){return a.toLowerCase().trim()});a=!!b.exportTilesAllowed;c=-1!==c.indexOf("tilemap");return{operations:{supportsExportTiles:a,supportsTileMap:c},exportTiles:a?{maxExportTilesCount:+b.maxExportTilesCount}:null}};Object.defineProperty(g.prototype,"parsedUrl",{get:function(){return this.serviceUrl?m.urlToObject(this.serviceUrl):null},enumerable:!0,configurable:!0});
Object.defineProperty(g.prototype,"serviceUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.serviceUrl||null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"spatialReference",{get:function(){return this.tileInfo&&this.tileInfo.spatialReference||null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"styleUrl",{get:function(){return this.currentStyleInfo&&this.currentStyleInfo.styleUrl||null},enumerable:!0,configurable:!0});g.prototype.writeStyleUrl=
function(a,b){a&&k.isProtocolRelative(a)&&(a="https:"+a);b.styleUrl=a};g.prototype.readTileIndexType=function(a,b){return b.type};g.prototype.readTileIndexUrl=function(a,b){return k.join(this.serviceUrl,b.tileMap)};g.prototype.readTilemapCache=function(a,b){return b.capabilities&&-1<b.capabilities.indexOf("Tilemap")?new x({layer:this}):null};g.prototype.readTileServers=function(a,b){a=b.tiles;var c=this.serviceUrl||this.styleUrl&&k.removeFile(this.styleUrl);c&&a.forEach(function(a,b,d){k.isAbsolute(a)?
d[b]=a:d[b]=k.join(c,a)});return a};g.prototype.readVersion=function(a,b){return b.version?parseFloat(b.version):parseFloat(b.currentVersion)};g.prototype.readCompatibleTileInfo256=function(a,b){return z.fromJSON(C.create256x256CompatibleTileInfo(b.tileInfo))};g.prototype.readCompatibleTileInfo512=function(a,b){return z.fromJSON(C.create512x512CompatibleTileInfo(b.tileInfo))};g.prototype.loadStyle=function(a){a=a||this.style||this.url;if(this._loadingPromise&&"string"===typeof a&&this.url===a)return this._loadingPromise;
var b=this._loadingPromise;this._loadingPromise=this._getSourceAndStyle(a);b&&!b.isFulfilled()&&b.cancel();return this._loadingPromise};g.prototype.getTileUrl=function(a,b,c){var d=this.tileServers[b%this.tileServers.length];return d=d.replace(/\{z\}/gi,a.toString()).replace(/\{y\}/gi,b.toString()).replace(/\{x\}/gi,c.toString())};g.prototype.write=function(a,b){return b&&b.origin&&!this.styleUrl?(b.messages&&b.messages.push(new l("vectortilelayer:unsupported","VectorTileLayer ("+this.title+", "+
this.id+") with style defined by JSON only are not supported",{layer:this})),null):this.inherited(arguments,[a,b])};g.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return h.create(function(a){return n(["../views/2d/layers/VectorTileLayerView2D"],a)});case "3d":return h.create(function(a){return n(["../views/3d/layers/VectorTileLayerView3D"],a)})}};g.prototype._getSourceAndStyle=function(a){var b=this;return a?B.loadMetadata(a).then(function(c){b._set("currentStyleInfo",{serviceUrl:c.serviceUrl,
styleUrl:c.styleUrl,spriteUrl:c.spriteUrl,glyphsUrl:c.glyphsUrl,style:c.style,layerDefinition:c.layerDefinition});"string"===typeof a?(b.url=a,b.style=null):(b.url=null,b.style=a);b._set("styleRepository",new G(c.style,c));b.read(c.layerDefinition,{origin:"service"})}):h.reject(Error("invalid style!"))};g.prototype._getDefaultAttribution=function(a){var b=a.match(/^https?:\/\/(basemaps|basemapsbeta|basemapsdev)\.arcgis\.com(\/[^\/]+)?\/arcgis\/rest\/services\/([^\/]+(\/[^\/]+)*)\/vectortileserver/i);
if(b&&(a=b[3]&&b[3].toLowerCase()))for(var b=b[2]||"",c=0,d="OpenStreetMap_v2 OpenStreetMap_Export_v2 OpenStreetMap_GCS_v2 World_Basemap World_Basemap_v2 World_Basemap_Export_v2 World_Basemap_GCS_v2 World_Basemap_WGS84".split(" ");c<d.length;c++){var e=d[c];if(-1<e.toLowerCase().indexOf(a))return k.normalize("//static.arcgis.com/attribution/Vector"+b+"/"+e)}};f([d.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],g.prototype,"attributionDataUrl",null);f([d.property({readOnly:!0})],g.prototype,
"capabilities",void 0);f([d.reader("capabilities",["capabilities","exportTilesAllowed","maxExportTilesCount"])],g.prototype,"readCapabilities",null);f([d.property({readOnly:!0})],g.prototype,"currentStyleInfo",void 0);f([d.property({type:q,readOnly:!0})],g.prototype,"fullExtent",void 0);f([d.property()],g.prototype,"style",void 0);f([d.property({readOnly:!0,dependsOn:["serviceUrl"]})],g.prototype,"parsedUrl",null);f([d.property({readOnly:!0,dependsOn:["currentStyleInfo"]})],g.prototype,"serviceUrl",
null);f([d.property({type:p,dependsOn:["tileInfo"],readOnly:!0})],g.prototype,"spatialReference",null);f([d.property({readOnly:!0})],g.prototype,"styleRepository",void 0);f([d.property({type:String,readOnly:!0,dependsOn:["currentStyleInfo"],json:{write:{ignoreOrigin:!0},origins:{"web-document":{write:{ignoreOrigin:!0,isRequired:!0}}}}})],g.prototype,"styleUrl",null);f([d.writer(["portal-item","web-document"],"styleUrl")],g.prototype,"writeStyleUrl",null);f([d.property({readOnly:!0})],g.prototype,
"tileIndexType",void 0);f([d.reader("tileIndexType",["tileIndexType","type"])],g.prototype,"readTileIndexType",null);f([d.property({readOnly:!0})],g.prototype,"tileIndexUrl",void 0);f([d.reader("tileIndexUrl",["tileIndexUrl","tileMap"])],g.prototype,"readTileIndexUrl",null);f([d.property({readOnly:!0,type:z})],g.prototype,"tileInfo",void 0);f([d.property({readOnly:!0,type:x})],g.prototype,"tilemapCache",void 0);f([d.reader("tilemapCache",["capabilities"])],g.prototype,"readTilemapCache",null);f([d.property({readOnly:!0})],
g.prototype,"tileServers",void 0);f([d.reader("tileServers",["tiles"])],g.prototype,"readTileServers",null);f([d.property({json:{read:!1},readOnly:!0,value:"vector-tile"})],g.prototype,"type",void 0);f([d.property({json:{origins:{"web-document":{read:{source:"styleUrl"}},"portal-item":{read:{source:"url"}}},write:!1,read:!1}})],g.prototype,"url",void 0);f([d.property({readOnly:!0})],g.prototype,"version",void 0);f([d.reader("version",["version","currentVersion"])],g.prototype,"readVersion",null);
f([d.property({readOnly:!0})],g.prototype,"compatibleTileInfo256",void 0);f([d.reader("compatibleTileInfo256",["tileInfo"])],g.prototype,"readCompatibleTileInfo256",null);f([d.property({readOnly:!0})],g.prototype,"compatibleTileInfo512",void 0);f([d.reader("compatibleTileInfo512",["tileInfo"])],g.prototype,"readCompatibleTileInfo512",null);return g=f([d.subclass("esri.layers.VectorTileLayer")],g)}(d.declared(r,t,v,A,e,u))})},"esri/layers/support/vectorTileLayerLoader":function(){define("require exports ../../core/tsSupport/assignHelper ../../config ../../request ../../core/promiseUtils ../../core/urlUtils".split(" "),
function(n,g,c,a,f,b,l){function e(a){a&&(a=l.getOrigin(a),k&&-1===k.indexOf(a)&&k.push(a))}function h(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];for(var b=void 0,c=0;c<a.length;++c)l.isProtocolRelative(a[c])?b&&(b=b.split("://")[0]+":"+a[c].trim()):b=l.isAbsolute(a[c])?a[c]:l.join(b,a[c]);return b}function m(a,c,g){var d,k,p;"string"===typeof c?(c=l.normalize(c),e(c),d=l.urlToObject(c),d=f(d.path,{query:{f:"json"},responseType:"json"}),p=k=c):(d=b.resolve({data:c}),k=c.jsonUrl||
null,p=g);return d.then(function(c){var d=c.data;c.ssl&&(k&&(k=k.replace(/^http:/i,"https:")),p&&(p=p.replace(/^http:/i,"https:")));if(d.sources){a.styleUrl=k||null;c=p?l.removeFile(p):l.appBaseUrl;a.styleBase=c;a.style=d;a.styleUrl&&e(a.styleUrl);if(a.source)d=b.resolve();else{b:if(d=d.sources,d.esri)d=d.esri;else{for(var f=0,g=Object.keys(d);f<g.length;f++){var q=g[f];if("vector"===d[q].type){d=d[q];break b}}d=null}d=d.url?m(a,h(c,d.url)):m(a,d,c)}return d}if(d.sources)return b.reject("You must specify the URL or the JSON for a service or for a style.");
a.sourceUrl=k||null;c=p?l.removeTrailingSlash(p)+"/":l.appBaseUrl;a.sourceBase=c;a.source=d;if(d.hasOwnProperty("tileInfo"))f=d;else{for(var f={xmin:-2.0037507067161843E7,ymin:-2.0037507067161843E7,xmax:2.0037507067161843E7,ymax:2.0037507067161843E7,spatialReference:{wkid:102100}},q=(f.xmax-f.xmin)/512,g=[],r=d.hasOwnProperty("minzoom")?parseFloat(d.minzoom):0,t=d.hasOwnProperty("maxzoom")?parseFloat(d.maxzoom):16;r<t;r++){var u=q/Math.pow(2,r);g.push({level:r,scale:Math.floor(3779.527559055118*u),
resolution:u})}q=0;for(t=d.tiles;q<t.length;q++)e(h(c,t[q]));f={capabilities:"TilesOnly",initialExtent:f,fullExtent:f,minScale:g[0].scale,maxScale:g[g.length-1].scale,tiles:d.tiles,tileInfo:{rows:512,cols:512,dpi:96,format:"pbf",origin:{x:-2.0037508342787E7,y:2.0037508342787E7},lods:g,spatialReference:{wkid:102100}}}}a.validatedSource=f;a.sourceUrl&&e(a.sourceUrl);d=a.style?b.resolve():null==d.defaultStyles?b.reject():"string"===typeof d.defaultStyles?m(a,h(c,d.defaultStyles,"root.json")):m(a,d.defaultStyles,
h(c,"root.json"));return d})}Object.defineProperty(g,"__esModule",{value:!0});var k=a.defaults&&a.defaults.io.corsEnabledServers;g.loadMetadata=function(a){var b={source:null,sourceBase:null,sourceUrl:null,validatedSource:null,style:null,styleBase:null,styleUrl:null},c="string"===typeof a?[a,null]:[null,a.jsonUrl],d=c[0],c=c[1],f=d?l.urlToObject(d):null;return m(b,a,c).then(function(){var a={layerDefinition:b.validatedSource,url:d,parsedUrl:f,serviceUrl:b.sourceUrl,style:b.style,styleUrl:b.styleUrl,
spriteUrl:b.style.sprite&&h(b.styleBase,b.style.sprite),glyphsUrl:b.style.glyphs&&h(b.styleBase,b.style.glyphs)};e(a.spriteUrl);e(a.glyphsUrl);return a})}})},"esri/portal/support/jsonContext":function(){define(["require","exports","../../core/urlUtils","../Portal"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.createForItem=function(f){return{origin:"portal-item",url:c.urlToObject(f.itemUrl),portal:f.portal||a.getDefault()}}})},"esri/views/vectorTiles/SchemaHelper":function(){define(["require",
"exports"],function(n,g){return function(){function c(a,c){this.lockedSchemaPixelSize=a;this.isWGS84=c}c.prototype.getLevelRowColumn=function(a){return this.isWGS84?[a[0],a[1]>>1,a[2]>>1]:256===this.lockedSchemaPixelSize&&0<a[0]?[a[0]-1,a[1]>>1,a[2]>>1]:a};c.prototype.adjustLevel=function(a){return this.isWGS84?a:256===this.lockedSchemaPixelSize?0<a?a-1:0:a};c.prototype.getShift=function(a,c){var b=0,f=0;if(256===this.lockedSchemaPixelSize||this.isWGS84)a[2]%2&&(b=2*c),a[1]%2&&(f=2*c);return[b,f]};
c.prototype.getScale=function(a){if(this.isWGS84){if(512===this.lockedSchemaPixelSize)return 2}else if(256===this.lockedSchemaPixelSize&&0===a)return.5;return 1};c.create256x256CompatibleTileInfo=function(a){if(!a)return null;if(256===a.rows&&256===a.cols)return a;for(var c=4326===a.spatialReference.wkid,b=[],g=a.lods.length,e=0;e<g;e++){var h=a.lods[e];b.push({level:h.level,scale:h.scale,resolution:c?h.resolution:2*h.resolution})}return{rows:256,cols:256,dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,
origin:a.origin,spatialReference:a.spatialReference,lods:b}};c.create512x512CompatibleTileInfo=function(a){if(!a||256===a.rows||256===a.cols)return null;for(var c=[],b=a.lods.length,g=0;g<b;g++){var e=a.lods[g];c.push({level:e.level,scale:e.scale,resolution:.5*e.resolution})}return{rows:512,cols:512,dpi:a.dpi,format:a.format,compressionQuality:a.compressionQuality,origin:a.origin,spatialReference:a.spatialReference,lods:c}};return c}()})},"esri/views/vectorTiles/style/StyleRepository":function(){define(["require",
"exports","../../../core/has","./StyleLayer"],function(n,g,c,a){return function(){function c(a,f){this.styleJSON=a;this.version=parseFloat(a.version);this.sprite=f?f.spriteUrl:a.sprite;this.glyphs=f?f.glyphsUrl:a.glyphs;this.layers=(a.layers||[]).map(c._create);this._identifyRefLayers()}c.prototype._identifyRefLayers=function(){for(var a=[],c=[],e=0,f=0,g=this.layers;f<g.length;f++){var k=g[f];if(1===k.type){var d=k,q=k.sourceLayer,q=q+("|"+JSON.stringify(k.minzoom)),q=q+("|"+JSON.stringify(k.maxzoom)),
q=q+("|"+JSON.stringify(k.filter));if(d.hasDataDrivenFill||d.hasDataDrivenOutline)q+="|"+JSON.stringify(e);a.push({key:q,layer:k})}2===k.type&&(d=k,q=k.sourceLayer,q+="|"+JSON.stringify(k.minzoom),q+="|"+JSON.stringify(k.maxzoom),q+="|"+JSON.stringify(k.filter),q+="|"+JSON.stringify(k.layout&&k.layout["line-cap"]),q+="|"+JSON.stringify(k.layout&&k.layout["line-join"]),d.hasDataDrivenLine&&(q+="|"+JSON.stringify(e)),c.push({key:q,layer:k}));++e}this._assignRefLayers(a);this._assignRefLayers(c)};c.prototype._assignRefLayers=
function(a){a.sort(function(a,b){return a.key<b.key?-1:a.key>b.key?1:0});for(var b,c,f=a.length,g=0;g<f;g++){var k=a[g];if(k.key===b)k.layer.refLayerId=c;else if(b=k.key,c=k.layer.id,1===k.layer.type&&!k.layer.getPaintProperty("fill-outline-color"))for(var d=g+1;d<f;d++){var q=a[d];if(q.key===b){if(q.layer.getPaintProperty("fill-outline-color")){a[g]=q;a[d]=k;c=q.layer.id;break}}else break}}};c._create=function(b,c,e){c=1-1/(e.length+1)*(1+c);switch(b.type){case "background":return new a.BackgroundStyleLayer(0,
b,c);case "fill":return new a.FillStyleLayer(1,b,c);case "line":return new a.LineStyleLayer(2,b,c);case "symbol":return new a.SymbolStyleLayer(3,b,c);case "raster":throw Error("Unsupported vector tile raster layer");case "circle":return new a.CircleStyleLayer(4,b,c)}throw Error("Unknown vector tile layer");};return c}()})},"esri/views/vectorTiles/style/StyleLayer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ./Filter ./StyleDefinition ./StyleProperty".split(" "),
function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a,c,e){this.type=a;this.id=c.id;this.source=c.source;this.sourceLayer=c["source-layer"];this.minzoom=c.minzoom;this.maxzoom=c.maxzoom;this.filter=c.filter;this.layout=c.layout;this.paint=c.paint;this.z=e;switch(a){case 0:this._layoutDefinition=b.StyleDefinition.backgroundLayoutDefinition;this._paintDefinition=b.StyleDefinition.backgroundPaintDefinition;break;case 1:this._layoutDefinition=b.StyleDefinition.fillLayoutDefinition;
this._paintDefinition=b.StyleDefinition.fillPaintDefinition;break;case 2:this._layoutDefinition=b.StyleDefinition.lineLayoutDefinition;this._paintDefinition=b.StyleDefinition.linePaintDefinition;break;case 3:this._layoutDefinition=b.StyleDefinition.symbolLayoutDefinition;this._paintDefinition=b.StyleDefinition.symbolPaintDefinition;break;case 4:this._layoutDefinition=b.StyleDefinition.circleLayoutDefinition,this._paintDefinition=b.StyleDefinition.circlePaintDefinition}this._layoutProperties=this._parseLayout(this.layout);
this._paintProperties=this._parsePaint(this.paint)}a.prototype.getFeatureFilter=function(){return void 0!==this._featureFilter?this._featureFilter:this._featureFilter=f.createFilter(this.filter)};a.prototype.getLayoutProperty=function(a){var b=this._layoutProperties;if(b)return b[a]};a.prototype.getPaintProperty=function(a){var b=this._paintProperties;if(b)return b[a]};a.prototype.getLayoutValue=function(a,b,c){var d,e=this._layoutProperties;e&&(e=e[a])&&(d=e.getValue(b,c));a=this._layoutDefinition[a];
void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};a.prototype.getPaintValue=function(a,b,c){var d,e=this._paintProperties;e&&(e=e[a])&&(d=e.getValue(b,c));a=this._paintDefinition[a];void 0===d&&(d=a["default"]);"enum"===a.type&&(d=a.values.indexOf(d));return d};a.prototype._parseLayout=function(a){var b={},c;for(c in a){var d=this._layoutDefinition[c];d&&(b[c]=new l(c,d,a[c]))}return b};a.prototype._parsePaint=function(a){var b={},c;for(c in a){var d=this._paintDefinition[c];
d&&(b[c]=new l(c,d,a[c]))}return b};return a}();g.StyleLayer=n;a=function(a){function b(b,c,d){return a.call(this,b,c,d)||this}c(b,a);return b}(n);g.BackgroundStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("fill-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("fill-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;b.hasDataDrivenFill=b.hasDataDrivenColor||b.hasDataDrivenOpacity;c=b.getPaintProperty("fill-outline-color");b.outlineUsesFillColor=
!c;b.hasDataDrivenOutlineColor=c?c.isDataDriven:!1;b.hasDataDrivenOutline=(c?b.hasDataDrivenOutlineColor:b.hasDataDrivenColor)||b.hasDataDrivenOpacity;return b}c(b,a);return b}(n);g.FillStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("line-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("line-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("line-width");b.hasDataDrivenWidth=c?c.isDataDriven:!1;b.hasDataDrivenLine=
b.hasDataDrivenColor||b.hasDataDrivenOpacity||b.hasDataDrivenWidth;return b}c(b,a);return b}(n);g.LineStyleLayer=a;a=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("icon-color");b.hasDataDrivenIconColor=c?c.isDataDriven:!1;c=b.getPaintProperty("icon-opacity");b.hasDataDrivenIconOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("icon-size");b.hasDataDrivenIconSize=c?c.isDataDriven:!1;b.hasDataDrivenIcon=b.hasDataDrivenIconColor||b.hasDataDrivenIconOpacity||b.hasDataDrivenIconSize;
c=b.getPaintProperty("text-color");b.hasDataDrivenTextColor=c?c.isDataDriven:!1;c=b.getPaintProperty("text-opacity");b.hasDataDrivenTextOpacity=c?c.isDataDriven:!1;c=b.getLayoutProperty("text-size");b.hasDataDrivenTextSize=c?c.isDataDriven:!1;b.hasDataDrivenText=b.hasDataDrivenTextColor||b.hasDataDrivenTextOpacity||b.hasDataDrivenTextSize;return b}c(b,a);return b}(n);g.SymbolStyleLayer=a;n=function(a){function b(b,c,d){b=a.call(this,b,c,d)||this;c=b.getPaintProperty("circle-radius");b.hasDataDrivenRadius=
c?c.isDataDriven:!1;c=b.getPaintProperty("circle-color");b.hasDataDrivenColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-opacity");b.hasDataDrivenOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-width");b.hasDataDrivenStrokeWidth=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-color");b.hasDataDrivenStrokeColor=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-stroke-opacity");b.hasDataDrivenStrokeOpacity=c?c.isDataDriven:!1;c=b.getPaintProperty("circle-blur");b.hasDataDrivenBlur=
c?c.isDataDriven:!1;return b}c(b,a);return b}(n);g.CircleStyleLayer=n;n=function(){return function(a,b,c){this.cap=a.getLayoutValue("line-cap",b,c);this.join=a.getLayoutValue("line-join",b,c);this.miterLimit=a.getLayoutValue("line-miter-limit",b,c);this.roundLimit=a.getLayoutValue("line-round-limit",b,c)}}();g.LineLayout=n;n=function(){return function(a,b,c,f){this.allowOverlap=a.getLayoutValue("icon-allow-overlap",b,f);this.ignorePlacement=a.getLayoutValue("icon-ignore-placement",b,f);this.optional=
a.getLayoutValue("icon-optional",b,f);this.rotationAlignment=a.getLayoutValue("icon-rotation-alignment",b,f);this.size=a.getLayoutValue("icon-size",b,f);this.rotate=a.getLayoutValue("icon-rotate",b,f);this.padding=a.getLayoutValue("icon-padding",b,f);this.keepUpright=a.getLayoutValue("icon-keep-upright",b,f);this.offset=a.getLayoutValue("icon-offset",b,f);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();g.IconLayout=n;n=function(){return function(a,b,c,f){this.allowOverlap=a.getLayoutValue("text-allow-overlap",
b,f);this.ignorePlacement=a.getLayoutValue("text-ignore-placement",b,f);this.optional=a.getLayoutValue("text-optional",b,f);this.rotationAlignment=a.getLayoutValue("text-rotation-alignment",b,f);this.fontArray=a.getLayoutValue("text-font",b,f);this.maxWidth=a.getLayoutValue("text-max-width",b,f);this.lineHeight=a.getLayoutValue("text-line-height",b,f);this.letterSpacing=a.getLayoutValue("text-letter-spacing",b,f);this.justify=a.getLayoutValue("text-justify",b,f);this.anchor=a.getLayoutValue("text-anchor",
b,f);this.maxAngle=a.getLayoutValue("text-max-angle",b,f);this.size=a.getLayoutValue("text-size",b,f);this.rotate=a.getLayoutValue("text-rotate",b,f);this.padding=a.getLayoutValue("text-padding",b,f);this.keepUpright=a.getLayoutValue("text-keep-upright",b,f);this.transform=a.getLayoutValue("text-transform",b,f);this.offset=a.getLayoutValue("text-offset",b,f);2===this.rotationAlignment&&(this.rotationAlignment=c?0:1)}}();g.TextLayout=n})},"esri/views/vectorTiles/style/Filter":function(){define(["require",
"exports"],function(n,g){return function(){function c(a,f,b){this._op=a;"$type"===f?(this._val=b instanceof Array?b.map(function(a){return c._types.indexOf(a)}):c._types.indexOf(b),this._op+=11):(this._key=f,this._val=b)}c.prototype.filter=function(a){switch(this._op){case 0:return this._val;case 1:return a.values[this._key]===this._val;case 2:return a.values[this._key]!==this._val;case 3:return a.values[this._key]<this._val;case 4:return a.values[this._key]>this._val;case 5:return a.values[this._key]<=
this._val;case 6:return a.values[this._key]>=this._val;case 7:return-1!==this._val.indexOf(a.values[this._key]);case 8:return-1===this._val.indexOf(a.values[this._key]);case 9:for(var c=0,b=this._val;c<b.length;c++){var g=b[c];if(g.filter(a))return!0}return!1;case 10:c=0;for(b=this._val;c<b.length;c++)if(g=b[c],!g.filter(a))return!1;return!0;case 11:c=0;for(b=this._val;c<b.length;c++)if(g=b[c],g.filter(a))return!1;return!0;case 12:return a.type===this._val;case 13:return a.type!==this._val;case 14:return a.type<
this._val;case 15:return a.type>this._val;case 16:return a.type>=this._val;case 17:return a.type<=this._val;case 18:return-1!==this._val.indexOf(a.type);case 19:return-1===this._val.indexOf(a.type)}};c.createFilter=function(a){if(!a)return new c(0,void 0,!0);var f=a[0];if(1>=a.length)return new c(0,void 0,"any"!==f);switch(f){case "\x3d\x3d":return new c(1,a[1],a[2]);case "!\x3d":return new c(2,a[1],a[2]);case "\x3e":return new c(4,a[1],a[2]);case "\x3c":return new c(3,a[1],a[2]);case "\x3e\x3d":return new c(6,
a[1],a[2]);case "\x3c\x3d":return new c(5,a[1],a[2]);case "in":return new c(7,a[1],a.slice(2));case "!in":return new c(8,a[1],a.slice(2));case "any":return new c(9,void 0,a.slice(1).map(c.createFilter.bind(this)));case "all":return new c(10,void 0,a.slice(1).map(c.createFilter.bind(this)));case "none":return new c(11,void 0,a.slice(1).map(c.createFilter.bind(this)));default:throw Error("invalid operator: "+f);}};c._types=["Unknown","Point","LineString","Polygon"];return c}()})},"esri/views/vectorTiles/style/StyleDefinition":function(){define(["require",
"exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(){}c.backgroundLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};c.fillLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"}};c.lineLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"line-cap":{type:"enum",values:["butt","round","square"],default:"butt"},"line-join":{type:"enum",values:["bevel",
"round","miter"],default:"miter"},"line-miter-limit":{type:"number",default:2},"line-round-limit":{type:"number",default:1.05}};c.symbolLayoutDefinition={visibility:{type:"enum",values:["visible","none"],default:"visible"},"symbol-placement":{type:"enum",values:["point","line"],default:"point"},"symbol-spacing":{type:"number",minimum:1,default:250},"symbol-avoid-edges":{type:"boolean",default:!1},"icon-image":{type:"string"},"icon-allow-overlap":{type:"boolean",default:!1},"icon-ignore-placement":{type:"boolean",
default:!1},"icon-optional":{type:"boolean",default:!1},"icon-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},"icon-size":{type:"number",minimum:0,default:1},"icon-rotate":{type:"number",default:0},"icon-padding":{type:"number",minimum:0,default:2},"icon-keep-upright":{type:"boolean",default:!1},"icon-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-field":{type:"string"},"text-rotation-alignment":{type:"enum",values:["map","viewport","auto"],default:"auto"},
"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"]},"text-size":{type:"number",minimum:0,default:16},"text-max-width":{type:"number",minimum:0,default:10},"text-line-height":{type:"number",default:1.2},"text-letter-spacing":{type:"number",default:0},"text-justify":{type:"enum",values:["left","center","right"],default:"center"},"text-anchor":{type:"enum",values:"center left right top bottom top-left top-right bottom-left bottom-right".split(" "),default:"center"},
"text-max-angle":{type:"number",minimum:0,default:45},"text-rotate":{type:"number",default:0},"text-padding":{type:"number",minimum:0,default:2},"text-keep-upright":{type:"boolean",default:!0},"text-transform":{type:"enum",values:["none","uppercase","lowercase"],default:"none"},"text-offset":{type:"array",value:"number",length:2,default:[0,0]},"text-allow-overlap":{type:"boolean",default:!1},"text-ignore-placement":{type:"boolean",default:!1},"text-optional":{type:"boolean",default:!1}};c.circleLayoutDefinition=
{visibility:{type:"enum",values:["visible","none"],default:"visible"}};c.backgroundPaintDefinition={"background-opacity":{type:"number",minimum:0,maximum:1,default:1},"background-color":{type:"color",default:[0,0,0,1]},"background-pattern":{type:"string"}};c.fillPaintDefinition={"fill-opacity":{type:"number",minimum:0,maximum:1,default:1},"fill-antialias":{type:"boolean",default:!0},"fill-color":{type:"color",default:[0,0,0,1]},"fill-outline-color":{type:"color",default:[0,0,0,0]},"fill-translate":{type:"array",
value:"number",length:2,default:[0,0]},"fill-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"fill-pattern":{type:"string"}};c.linePaintDefinition={"line-opacity":{type:"number",minimum:0,maximum:1,default:1},"line-color":{type:"color",default:[0,0,0,1]},"line-translate":{type:"array",value:"number",length:2,default:[0,0]},"line-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"line-width":{type:"number",minimum:0,default:1},"line-gap-width":{type:"number",
minimum:0,default:0},"line-offset":{type:"number",default:0},"line-blur":{type:"number",minimum:0,default:0},"line-dasharray":{type:"array",value:"number",default:[]},"line-pattern":{type:"string"}};c.symbolPaintDefinition={"icon-opacity":{type:"number",minimum:0,maximum:1,default:1},"icon-color":{type:"color",default:[0,0,0,1]},"icon-halo-color":{type:"color",default:[0,0,0,0]},"icon-halo-width":{type:"number",minimum:0,default:0},"icon-halo-blur":{type:"number",minimum:0,default:0},"icon-translate":{type:"array",
value:"number",length:2,default:[0,0]},"icon-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"text-opacity":{type:"number",minimum:0,maximum:1,default:1},"text-color":{type:"color",default:[0,0,0,1]},"text-halo-color":{type:"color",default:[0,0,0,0]},"text-halo-width":{type:"number",minimum:0,default:0},"text-halo-blur":{type:"number",minimum:0,default:0},"text-translate":{type:"array",value:"number",length:2,default:[0,0]},"text-translate-anchor":{type:"enum",values:["map",
"viewport"],default:"map"}};c.rasterPaintDefinition={"raster-opacity":{type:"number",minimum:0,maximum:1,default:1},"raster-hue-rotate":{type:"number",default:0},"raster-brightness-min":{type:"number",minimum:0,maximum:1,default:0},"raster-brightness-max":{type:"number",minimum:0,maximum:1,default:1},"raster-saturation":{type:"number",minimum:-1,maximum:1,default:0},"raster-contrast":{type:"number",minimum:-1,maximum:1,default:0},"raster-fade-duration":{type:"number",minimum:0,default:300}};c.circlePaintDefinition=
{"circle-opacity":{type:"number",minimum:0,maximum:1,default:1},"circle-radius":{type:"number",minimum:0,default:5},"circle-color":{type:"color",default:[0,0,0,1]},"circle-blur":{type:"number",minimum:0,default:0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0]},"circle-translate-anchor":{type:"enum",values:["map","viewport"],default:"map"},"circle-stroke-width":{type:"number",minimum:0,default:0},"circle-stroke-color":{type:"color",default:[0,0,0,1]},"circle-stroke-opacity":{type:"number",
minimum:0,maximum:1,default:1}};return c}();g.StyleDefinition=n})},"esri/views/vectorTiles/style/StyleProperty":function(){define(["require","exports","../../../Color","../GeometryUtils"],function(n,g,c,a){return function(){function f(a,c,e){this.isDataDriven=!1;switch(c.type){case "number":a=!0;break;case "color":a=!0;e=f._parseColor(e);break;case "array":a="number"===c.value;break;default:a=!1}null==e&&(e=c.default);a&&"interval"===e.type&&(a=!1);var b=e&&e.stops&&0<e.stops.length;if(b)for(var g=
0,k=e.stops;g<k.length;g++){var d=k[g];d[1]=this._validate(d[1],c)}if(this.isDataDriven=e?!!e.property:!1)if(void 0!==e.default&&(e.default=this._validate(e.default,c)),b)switch(e.type){case "identity":this.getValue=this._buildIdentity(e,c);break;case "categorical":this.getValue=this._buildCategorical(e,c);break;default:this.getValue=a?this._buildInterpolate(e,c):this._buildInterval(e,c)}else this.getValue=this._buildIdentity(e,c);else b?this.getValue=a?this._buildZoomInterpolate(e):this._buildZoomInterval(e):
(e=this._validate(e,c),this.getValue=this._buildSimple(e))}f.prototype._validate=function(a,c){if("number"===c.type){if(a<c.minimum)return c.minimum;if(a>c.maximum)return c.maximum}return a};f.prototype._buildSimple=function(a){return function(){return a}};f.prototype._buildIdentity=function(a,c){var b=this;return function(e,g){var h;g&&(h=g.values[a.property],"color"===c.type&&(h=f._parseColor(h)));void 0===h&&(h=a.default);return void 0!==h?b._validate(h,c):c.default}};f.prototype._buildCategorical=
function(a,c){var b=this;return function(e,f){var h;f&&(h=f.values[a.property]);h=b._categorical(h,a.stops);return void 0!==h?h:void 0!==a.default?a.default:c.default}};f.prototype._buildInterval=function(a,c){var b=this;return function(e,f){var h;f&&(h=f.values[a.property]);return"number"===typeof h?b._interval(h,a.stops):void 0!==a.default?a.default:c.default}};f.prototype._buildInterpolate=function(a,c){var b=this;return function(e,f){var h;f&&(h=f.values[a.property]);return"number"===typeof h?
b._interpolate(h,a.stops,a.base||1):void 0!==a.default?a.default:c.default}};f.prototype._buildZoomInterpolate=function(a){var b=this;return function(c){return b._interpolate(c,a.stops,a.base||1)}};f.prototype._buildZoomInterval=function(a){var b=this;return function(c){return b._interval(c,a.stops)}};f.prototype._categorical=function(a,c){for(var b=c.length,f=0;f<b;f++)if(c[f][0]===a)return c[f][1]};f.prototype._interval=function(a,c){for(var b=c.length,f=0,g=0;g<b;g++)if(c[g][0]<=a)f=g;else break;
return c[f][1]};f.prototype._interpolate=function(b,c,e){for(var f,g,k=c.length,d=0;d<k;d++){var l=c[d];if(l[0]<=b)f=l;else{g=l;break}}if(f&&g){d=g[0]-f[0];b-=f[0];e=1===e?b/d:(Math.pow(e,b)-1)/(Math.pow(e,d)-1);if(Array.isArray(f[1])){f=f[1];g=g[1];b=[];for(d=0;d<f.length;d++)b.push(a.interpolate(f[d],g[d],e));return b}return a.interpolate(f[1],g[1],e)}if(f)return f[1];if(g)return g[1]};f._isEmpty=function(a){for(var b in a)if(a.hasOwnProperty(b))return!1;return!0};f._parseColor=function(a){if(Array.isArray(a))return a;
if("string"===typeof a){if(a=new c(a),!this._isEmpty(a))return c.toUnitRGBA(a)}else return a&&a.default&&(a.default=f._parseColor(a.default)),a&&a.stops&&(a.stops=a.stops.map(function(a){return[a[0],f._parseColor(a[1])]})),a};return f}()})},"esri/views/vectorTiles/GeometryUtils":function(){define(["require","exports"],function(n,g){function c(a,b){a%=b;return 0<=a?a:a+b}Object.defineProperty(g,"__esModule",{value:!0});g.C_INFINITY=Number.POSITIVE_INFINITY;g.C_PI=Math.PI;g.C_2PI=2*g.C_PI;g.C_PI_BY_2=
g.C_PI/2;g.C_RAD_TO_256=128/g.C_PI;g.C_256_TO_RAD=g.C_PI/128;g.C_DEG_TO_256=256/360;g.C_DEG_TO_RAD=g.C_PI/180;g.C_SQRT2=1.414213562;g.C_SQRT2_INV=1/g.C_SQRT2;var a=1/Math.LN2;g.positiveMod=c;g.radToByte=function(a){return c(a*g.C_RAD_TO_256,256)};g.degToByte=function(a){return c(a*g.C_DEG_TO_256,256)};g.log2=function(c){return Math.log(c)*a};g.sqr=function(a){return a*a};g.clamp=function(a,b,c){return Math.min(Math.max(a,b),c)};g.interpolate=function(a,b,c){return a*(1-c)+b*c};g.between=function(a,
b,c){return a>=b&&a<=c||a>=c&&a<=b}})},"esri/views/3d/terrain/terrainUtilsPlanar":function(){define("require exports ../../../core/Error ../../../geometry/support/aaBoundingRect ../lib/gl-matrix ./TerrainConst ./TilingScheme".split(" "),function(n,g,c,a,f,b,l){function e(a,b,c,d){f.vec3d.set(c,h);h[d]=b[d];d=f.vec3d.subtract(h,b);var e=f.vec3d.subtract(a,b,m),e=f.vec3d.dot(e,d),g=f.vec3d.dot(d,d);b=0>=e?b:g<=e?c:f.vec3d.add(b,f.vec3d.scale(d,e/g),h);a=f.vec3d.subtract(a,b,h);return Math.PI/2-Math.atan(a[2]/
Math.sqrt(a[0]*a[0]+a[1]*a[1]))}Object.defineProperty(g,"__esModule",{value:!0});var h=f.vec3d.create(),m=f.vec3d.create(),k=f.vec3d.create(),d=f.vec3d.create();g.isInsideExtent=function(b,c,d){void 0===d&&(d=0);b=b.extent;return 0===d?a.containsPoint(b,c):a.containsPointWithMargin(b,c,d*Math.min(b[2]-b[0],b[3]-b[1]))};g.tiltOnEdge=e;g.tiltToExtentEdge=function(a,b){var c=a.getElevationBounds();a=a.extent;c=.5*(c[0]+c[1]);k[0]=a[0];k[1]=a[1];k[2]=c;d[0]=a[2];d[1]=a[3];d[2]=c;a=c=Infinity;b[0]<k[0]?
c=e(b,k,d,0):b[0]>d[0]&&(c=e(b,d,k,0));b[1]<k[1]?a=e(b,k,d,1):b[1]>d[1]&&(a=e(b,d,k,1));return Math.min(c,a)};g.checkIfTileInfoSupportedForViewSR=function(d,e,f){if(d.spatialReference.isGeographic)return new c("tilingscheme:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes");var h=l.checkUnsupported(d);if(h)return h;var g=d.lods,h=g[0].resolution*Math.pow(2,g[0].level),k=[h*d.size[0],h*d.size[1]],m=[d.origin.x,d.origin.y];e=a.fromExtent(e);var p=a.create();
l.computeRowColExtent(e,k,m,p);k=(p[2]-p[0])*(p[3]-p[1]);k>b.MAX_ROOT_TILES?(g=g[0].scale*Math.pow(2,g[0].level),h=Math.max((e[3]-e[1])/d.size[1],(e[2]-e[0])/d.size[0])*g/h,e=Math.floor(Math.log(h)/Math.log(10)),h=Math.ceil(h/Math.pow(10,e))*Math.pow(10,e),h=new c("tilingscheme:too-many-root-tiles","Scale of level 0 of the tiling scheme (1:"+Math.floor(g).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+h.toLocaleString()+".",{level0Scale:g,suggestedLevel0Scale:h,requiredNumRootTiles:k,
allowedNumRootTiles:b.MAX_ROOT_TILES})):h=null;return h?h:f&&!d.spatialReference.equals(f)?new c("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene"):null}})},"esri/views/3d/terrain/terrainUtilsSpherical":function(){define(["require","exports","../../../core/Error","./TilingScheme"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.isInsideExtent=function(a,b,c){void 0===c&&(c=0);return!0};g.tiltToExtentEdge=function(a,
b){return 0};g.checkIfTileInfoSupportedForViewSR=function(f,b,g){b=f.lods.length-1;if(f.spatialReference.isWebMercator){if(!a.makeWebMercatorAuxiliarySphere(b).compatibleWith(f))return new c("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(f.spatialReference.isWGS84){if(!a.makeWGS84WithTileSize(f.size[1],b).compatibleWith(f))return new c("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme")}else return new c("tilingscheme:global-unsupported-spatial-reference",
"The tiling scheme spatial reference is not supported in global scenes");if(g&&!f.spatialReference.equals(g))return new c("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the global scene")}})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("require exports ./TerrainConst ./TileAgent ./UpsampleInfo ../../vectorTiles/VectorTileDisplayObject ../../webgl/Texture".split(" "),function(n,g,c,a,f,b,l){return function(){function e(a){this.waitingAgents=
[];this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=this.data=null;this.pendingUpdates=0;this.elevationBounds=void 0;this.init(a)}e.prototype.init=function(a){this.waitingAgents.length=0;this.data=null;this.dataInvalidated=this.dataMissing=!1;this.rawData=this.requestPromise=this.loadingAgent=this.upsampleFromTile=this.tilemapRequest=this.tilemap=null;this.pendingUpdates=0;a===c.LayerClass.ELEVATION&&(this.elevationBounds=null)};e.prototype.invalidateSourceData=
function(){this.tilemap=null;this.dataInvalidated=!0;this.dataMissing=!1;this.upsampleFromTile&&(f.Pool.release(this.upsampleFromTile),this.upsampleFromTile=null)};e.prototype.dispose=function(){this.loadingAgent&&this.loadingAgent!==a.AGENT_DONE&&(this.loadingAgent.dispose(),this.loadingAgent=null);this.requestPromise&&(this.requestPromise.cancel(),this.requestPromise=null);this.tilemap=null;this.tilemapRequest&&(this.tilemapRequest.cancel(),this.tilemapRequest=null);this.upsampleFromTile&&(f.Pool.release(this.upsampleFromTile),
this.upsampleFromTile=null);this.rawData=null;this.pendingUpdates=0;this.disposeData()};e.prototype.disposeData=function(){var a=this.data;(a instanceof l||a instanceof b)&&a.dispose();this.data=null};e.makeEmptyLayerInfo=function(a,b){return b?(b.init(a),b):new e(a)};return e}()})},"esri/views/vectorTiles/VectorTileDisplayObject":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/ObjectPool ../../core/libs/gl-matrix/mat4 ../../core/libs/gl-matrix/vec2 ../../geometry/support/spatialReferenceUtils ../2d/engine/DisplayObject ../2d/tiling/enums ../2d/tiling/TileKey ./RenderBucket ../webgl/BufferObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d){var q="fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer".split(" ");return function(e){function g(){for(var a,c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];d=e.call(this)||this;d._renderBuckets=[];d._vectorTileData=
null;d._symbolUpdateData=null;d.status=h.TileStatus.INITIALIZED;d.coords=[0,0];d.bounds=[0,0,0,0];d.tileTransform={transform:Float32Array[16],displayCoord:Float32Array[2]};d.stencilData={mask:0,reference:0};d.status=h.TileStatus.INITIALIZED;d.tileTransform.transform=f.create();d.tileTransform.displayCoord=b.create();0<c.length&&(a=d.acquire).call.apply(a,[d].concat(c));return d}c(g,e);g.prototype.reset=function(){m.pool.release(this.key);this.refKey=this.key=null;this.coords[0]=0;this.coords[1]=0;
this.bounds[0]=0;this.bounds[1]=0;this.bounds[2]=0;this.height=this.width=this.bounds[3]=0;this.resolution=null;this.rotation=0;this.id=this.client=this.styleLayers=this._vectorTileData=null;this.tileTransform.transform.fill(0);this.tileTransform.displayCoord.fill(0);this.stencilData.mask=0;this.stencilData.reference=0;this._renderBuckets.length=0;this._symbolUpdateData=null;this.status=h.TileStatus.INITIALIZED};g.prototype.acquire=function(a,b,c,d,e){this.key=a;this.refKey=b;b=c.lodAt(a.level);b=
null!==b?b.resolution:0;var f=c.size[0]*b,h=c.origin,g=a.col*f,k=a.row*f,m=c.spatialReference,p=0;m&&(m._isWrappable?m._isWrappable():m.isWrappable)&&(m=l.getInfo(m),p=m.valid[1]-m.valid[0]);g=h.x+g+a.world*p;h=h.y-k;this.coords[0]=g;this.coords[1]=h;this.bounds[0]=g;this.bounds[1]=h;this.bounds[2]=g+f;this.bounds[3]=h-f;this.widthInPixels=c.size[1];this.coordRange=4096;this.resolution=b;this.rotation=e;this.styleLayers=d;this.id=a.id};g.prototype.setData=function(a,b){this._vectorTileData=a;this.client=
b;a&&a.bufferDataInfo||(this.status=h.TileStatus.NO_DATA)};g.prototype.updateSymbolData=function(a){a&&(this._symbolUpdateData=a,this.requestRender())};g.prototype.dispose=function(){for(var a="fillVertexArrayObject fillDDVertexArrayObject outlineVertexArrayObject lineVertexArrayObject lineDDVertexArrayObject iconVertexArrayObject iconDDVertexArrayObject textVertexArrayObject textDDVertexArrayObject circleVertexArrayObject fillVertexBuffer fillDDVertexBuffer fillIndexBuffer outlineVertexBuffer outlineDDVertexBuffer outlineIndexBuffer lineVertexBuffer lineDDVertexBuffer lineIndexBuffer iconVertexBuffer iconDDVertexBuffer iconIndexBuffer textVertexBuffer textDDVertexBuffer textIndexBuffer circleVertexBuffer circleIndexBuffer texture".split(" "),
b=0;b<a.length;++b){var c=a[b];this[c]&&(this[c].dispose(),this[c]=null)}this._renderBuckets.length=0;this.status=h.TileStatus.INITIALIZED};g.prototype.getCpuMemoryUsage=function(){return null!=this._vectorTileData&&this._vectorTileData.bufferData?this._vectorTileData.bufferData.reduce(function(a,b){return a+b.byteLength},0)+this._vectorTileData.bufferDataInfo.byteLength+this._vectorTileData.bucketDataInfo.byteLength:0};g.prototype.getGpuMemoryUsage=function(){var a=this,b=q.reduce(function(b,c){return a[c]?
b+a[c].size:b},0);this.texture&&(b+=this.texture.descriptor.width*this.texture.descriptor.height*4);return b};g.prototype.attach=function(a){if(this.status!==h.TileStatus.INITIALIZED)return!0;this._createRenderBuckets();this._createBufferObjects(a);this._vectorTileData=null;this.status=h.TileStatus.READY;return!0};g.prototype._createRenderBuckets=function(){if(0===this._renderBuckets.length)for(var a=new Uint32Array(this._vectorTileData.bucketDataInfo),b=a.length,c=0;c<b;){var d=a[c];switch(a[c+1]){case 0:var e=
new k.BackgroundRenderBucket;e.layerID=d;this._renderBuckets.push(e);c+=2;break;case 1:e=new k.FillRenderBucket;e.layerID=d;e.triangleElementStart=a[c+2];e.triangleElementCount=a[c+3];e.outlineElementStart=a[c+4];e.outlineElementCount=a[c+5];this._renderBuckets.push(e);c+=6;break;case 2:e=new k.LineRenderBucket;e.layerID=d;e.triangleElementStart=a[c+2];e.triangleElementCount=a[c+3];this._renderBuckets.push(e);c+=4;break;case 3:e=new k.SymbolRenderBucket;e.layerID=d;e.isSDF=0!==a[c+2];var f=c+3,d=
a[f];f++;if(0<d)for(var h=void 0,g=void 0,l=void 0,m=0;m<d;m++)h=a[f],g=a[f+1],l=a[f+2],e.markerPerPageElementsMap.set(h,[g,l]),f+=3;var p=a[f];f++;if(0<p)for(l=g=h=void 0,m=0;m<p;m++)h=a[f],g=a[f+1],l=a[f+2],e.glyphPerPageElementsMap.set(h,[g,l]),f+=3;this._renderBuckets.push(e);c+=5+3*d+3*p;break;case 4:e=new k.CircleRenderBucket;e.layerID=d;e.triangleElementStart=a[c+2];e.triangleElementCount=a[c+3];this._renderBuckets.push(e);c+=4;break;default:console.error("Bad bucket type!"),c+=2}}};g._createBufferToObject=
function(){var a=[];a[1]={create:d.createVertex,var:"fillVertexBuffer"};a[2]={create:d.createVertex,var:"fillDDVertexBuffer"};a[3]={create:d.createIndex,var:"fillIndexBuffer"};a[4]={create:d.createVertex,var:"outlineVertexBuffer"};a[5]={create:d.createVertex,var:"outlineDDVertexBuffer"};a[6]={create:d.createIndex,var:"outlineIndexBuffer"};a[7]={create:d.createVertex,var:"lineVertexBuffer"};a[9]={create:d.createIndex,var:"lineIndexBuffer"};a[10]={create:d.createVertex,var:"iconVertexBuffer"};a[11]=
{create:d.createVertex,var:"iconDDVertexBuffer"};a[12]={create:d.createIndex,var:"iconIndexBuffer"};a[13]={create:d.createVertex,var:"textVertexBuffer"};a[14]={create:d.createVertex,var:"textDDVertexBuffer"};a[15]={create:d.createIndex,var:"textIndexBuffer"};a[16]={create:d.createVertex,var:"circleVertexBuffer"};a[17]={create:d.createIndex,var:"circleIndexBuffer"};return a};g.prototype._createBufferObjects=function(a){a=a.context;for(var b=new Uint32Array(this._vectorTileData.bufferDataInfo),c=b.length,
d=0,e=0;e<c;e+=2,d++){var f=b[e];if(!(0>=b[e+1]||0===this._vectorTileData.bufferData[d].byteLength)){var h=g.bufferToObject[f];h?this[h.var]?this[h.var].setData(this._vectorTileData.bufferData[d]):this[h.var]=h.create(a,35044,this._vectorTileData.bufferData[d]):console.error("Bad buffer type "+f)}}};g.prototype.detach=function(a){this.client&&this.status!==h.TileStatus.INVALID&&this.status!==h.TileStatus.INITIALIZED&&this.client.invoke("destructTileData",this.id);this.dispose();e.prototype.detach.call(this,
a)};g.prototype.doRender=function(a){if(this.visible&&this.status===h.TileStatus.READY){var b=a.context,c=a.renderer;if(b&&c){var d=a.drawphase;this._symbolUpdateData&&this._updateSymbolData(a);b.setStencilFunction(514,this.stencilData.reference,this.stencilData.mask);var e=this.styleLayers,f=void 0!==a.layerOpacity?a.layerOpacity:1;if(0!==f){var g=this._renderBuckets.length;if(0===d)for(var k=g-1;0<=k;k--){var l=this._renderBuckets[k];1!==l.type&&0!==l.type||!l.hasData()||c.renderBucket(b,l,a.displayLevel,
a.requiredLevel,d,this,e.layers[l.layerID],f)}else for(k=0;k<g;k++)l=this._renderBuckets[k],l.hasData()&&c.renderBucket(b,l,a.displayLevel,a.requiredLevel,d,this,e.layers[l.layerID],f)}}}};g.prototype._updateSymbolData=function(a){if(!this._symbolUpdateData.bucketDataInfo)return!0;var b=new Uint32Array(this._symbolUpdateData.bucketDataInfo),c=b.length;if(0===c)return this._symbolUpdateData=null,!0;if(this.status!==h.TileStatus.READY)return this.requestRender(),!1;a=a.context;for(var e=new Uint32Array(this._symbolUpdateData.bufferDataInfo),
f=e.length,g=0,l=0;l<f;l+=2,g++)switch(e[l]){case 10:this.iconVertexBuffer&&(this.iconVertexBuffer.dispose(),this.iconVertexBuffer=null);this.iconVertexBuffer=d.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 11:this.iconDDVertexBuffer&&(this.iconDDVertexBuffer.dispose(),this.iconDDVertexBuffer=null);this.iconDDVertexBuffer=d.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 12:this.iconIndexBuffer&&(this.iconIndexBuffer.dispose(),this.iconIndexBuffer=null);
this.iconIndexBuffer=d.createIndex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 13:this.textVertexBuffer&&(this.textVertexBuffer.dispose(),this.textVertexBuffer=null);this.textVertexBuffer=d.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 14:this.textDDVertexBuffer&&(this.textDDVertexBuffer.dispose(),this.textDDVertexBuffer=null);this.textDDVertexBuffer=d.createVertex(a,35044,this._symbolUpdateData.bufferData[g]);break;case 15:this.textIndexBuffer&&(this.textIndexBuffer.dispose(),
this.textIndexBuffer=null),this.textIndexBuffer=d.createIndex(a,35044,this._symbolUpdateData.bufferData[g])}a=this._renderBuckets.length;for(e=0;e<a;e++)this._renderBuckets[e]instanceof k.SymbolRenderBucket&&(f=this._renderBuckets[e],f.markerPerPageElementsMap.clear(),f.glyphPerPageElementsMap.clear());for(a=0;a<c;){f=b[a];g=-1;l=this._renderBuckets.length;for(e=0;e<l;e++)if(this._renderBuckets[e].layerID===f){g=e;break}e=this._renderBuckets[g];e||(e=new k.SymbolRenderBucket,e.layerID=f,e.isSDF=0!==
b[a+2],this._renderBuckets.push(e));var m=a+3,f=b[m];m++;if(0<f)for(var p=l=g=void 0,q=0;q<f;q++)g=b[m],l=b[m+1],p=b[m+2],e.markerPerPageElementsMap.set(g,[l,p]),m+=3;var r=b[m];m++;if(0<r)for(p=l=g=void 0,q=0;q<r;q++)g=b[m],l=b[m+1],p=b[m+2],e.glyphPerPageElementsMap.set(g,[l,p]),m+=3;a+=5+3*f+3*r}this.iconVertexArrayObject&&(this.iconVertexArrayObject.dispose(),this.iconVertexArrayObject=null);this.iconDDVertexArrayObject&&(this.iconDDVertexArrayObject.dispose(),this.iconDDVertexArrayObject=null);
this.textVertexArrayObject&&(this.textVertexArrayObject.dispose(),this.textVertexArrayObject=null);this.textDDVertexArrayObject&&(this.textDDVertexArrayObject.dispose(),this.textDDVertexArrayObject=null);this._symbolUpdateData=null;return!0};g.pool=new a(g);g.bufferToObject=g._createBufferToObject();return g}(e)})},"esri/core/libs/gl-matrix/mat4":function(){define(["./common"],function(n){var g={scalar:{},SIMD:{},create:function(){var c=new n.ARRAY_TYPE(16);c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=
1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c},clone:function(c){var a=new n.ARRAY_TYPE(16);a[0]=c[0];a[1]=c[1];a[2]=c[2];a[3]=c[3];a[4]=c[4];a[5]=c[5];a[6]=c[6];a[7]=c[7];a[8]=c[8];a[9]=c[9];a[10]=c[10];a[11]=c[11];a[12]=c[12];a[13]=c[13];a[14]=c[14];a[15]=c[15];return a},copy:function(c,a){c[0]=a[0];c[1]=a[1];c[2]=a[2];c[3]=a[3];c[4]=a[4];c[5]=a[5];c[6]=a[6];c[7]=a[7];c[8]=a[8];c[9]=a[9];c[10]=a[10];c[11]=a[11];c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];
return c},fromValues:function(c,a,f,b,g,e,h,m,k,d,q,p,r,u,t,v){var l=new n.ARRAY_TYPE(16);l[0]=c;l[1]=a;l[2]=f;l[3]=b;l[4]=g;l[5]=e;l[6]=h;l[7]=m;l[8]=k;l[9]=d;l[10]=q;l[11]=p;l[12]=r;l[13]=u;l[14]=t;l[15]=v;return l},set:function(c,a,f,b,g,e,h,m,k,d,q,p,r,u,t,v,n){c[0]=a;c[1]=f;c[2]=b;c[3]=g;c[4]=e;c[5]=h;c[6]=m;c[7]=k;c[8]=d;c[9]=q;c[10]=p;c[11]=r;c[12]=u;c[13]=t;c[14]=v;c[15]=n;return c},identity:function(c){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;
c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c}};g.scalar.transpose=function(c,a){if(c===a){var f=a[1],b=a[2],g=a[3],e=a[6],h=a[7],m=a[11];c[1]=a[4];c[2]=a[8];c[3]=a[12];c[4]=f;c[6]=a[9];c[7]=a[13];c[8]=b;c[9]=e;c[11]=a[14];c[12]=g;c[13]=h;c[14]=m}else c[0]=a[0],c[1]=a[4],c[2]=a[8],c[3]=a[12],c[4]=a[1],c[5]=a[5],c[6]=a[9],c[7]=a[13],c[8]=a[2],c[9]=a[6],c[10]=a[10],c[11]=a[14],c[12]=a[3],c[13]=a[7],c[14]=a[11],c[15]=a[15];return c};g.SIMD.transpose=function(c,a){var f,b,g,e,h,m;f=SIMD.Float32x4.load(a,0);
b=SIMD.Float32x4.load(a,4);g=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);e=SIMD.Float32x4.shuffle(f,b,0,1,4,5);h=SIMD.Float32x4.shuffle(g,a,0,1,4,5);m=SIMD.Float32x4.shuffle(e,h,0,2,4,6);e=SIMD.Float32x4.shuffle(e,h,1,3,5,7);SIMD.Float32x4.store(c,0,m);SIMD.Float32x4.store(c,4,e);e=SIMD.Float32x4.shuffle(f,b,2,3,6,7);h=SIMD.Float32x4.shuffle(g,a,2,3,6,7);f=SIMD.Float32x4.shuffle(e,h,0,2,4,6);b=SIMD.Float32x4.shuffle(e,h,1,3,5,7);SIMD.Float32x4.store(c,8,f);SIMD.Float32x4.store(c,12,b);return c};
g.transpose=n.USE_SIMD?g.SIMD.transpose:g.scalar.transpose;g.scalar.invert=function(c,a){var f=a[0],b=a[1],g=a[2],e=a[3],h=a[4],m=a[5],k=a[6],d=a[7],q=a[8],p=a[9],r=a[10],u=a[11],t=a[12],v=a[13],n=a[14];a=a[15];var z=f*m-b*h,x=f*k-g*h,B=f*d-e*h,D=b*k-g*m,C=b*d-e*m,G=g*d-e*k,E=q*v-p*t,F=q*n-r*t,I=q*a-u*t,K=p*n-r*v,N=p*a-u*v,H=r*a-u*n,M=z*H-x*N+B*K+D*I-C*F+G*E;if(!M)return null;M=1/M;c[0]=(m*H-k*N+d*K)*M;c[1]=(g*N-b*H-e*K)*M;c[2]=(v*G-n*C+a*D)*M;c[3]=(r*C-p*G-u*D)*M;c[4]=(k*I-h*H-d*F)*M;c[5]=(f*H-g*
I+e*F)*M;c[6]=(n*B-t*G-a*x)*M;c[7]=(q*G-r*B+u*x)*M;c[8]=(h*N-m*I+d*E)*M;c[9]=(b*I-f*N-e*E)*M;c[10]=(t*C-v*B+a*z)*M;c[11]=(p*B-q*C-u*z)*M;c[12]=(m*F-h*K-k*E)*M;c[13]=(f*K-b*F+g*E)*M;c[14]=(v*x-t*D-n*z)*M;c[15]=(q*D-p*x+r*z)*M;return c};g.SIMD.invert=function(c,a){var f,b,g,e,h,m,k,d;h=SIMD.Float32x4.load(a,0);m=SIMD.Float32x4.load(a,4);k=SIMD.Float32x4.load(a,8);d=SIMD.Float32x4.load(a,12);a=SIMD.Float32x4.shuffle(h,m,0,1,4,5);b=SIMD.Float32x4.shuffle(k,d,0,1,4,5);f=SIMD.Float32x4.shuffle(a,b,0,2,
4,6);b=SIMD.Float32x4.shuffle(b,a,1,3,5,7);a=SIMD.Float32x4.shuffle(h,m,2,3,6,7);e=SIMD.Float32x4.shuffle(k,d,2,3,6,7);g=SIMD.Float32x4.shuffle(a,e,0,2,4,6);e=SIMD.Float32x4.shuffle(e,a,1,3,5,7);a=SIMD.Float32x4.mul(g,e);a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.mul(b,a);m=SIMD.Float32x4.mul(f,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,a),h);m=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,a),m);m=SIMD.Float32x4.swizzle(m,2,3,0,1);a=SIMD.Float32x4.mul(b,g);
a=SIMD.Float32x4.swizzle(a,1,0,3,2);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,a),h);d=SIMD.Float32x4.mul(f,a);a=SIMD.Float32x4.swizzle(a,2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(e,a));d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,a),d);d=SIMD.Float32x4.swizzle(d,2,3,0,1);a=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(b,2,3,0,1),e);a=SIMD.Float32x4.swizzle(a,1,0,3,2);g=SIMD.Float32x4.swizzle(g,2,3,0,1);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,a),h);k=SIMD.Float32x4.mul(f,a);a=SIMD.Float32x4.swizzle(a,
2,3,0,1);h=SIMD.Float32x4.sub(h,SIMD.Float32x4.mul(g,a));k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,a),k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);a=SIMD.Float32x4.mul(f,b);a=SIMD.Float32x4.swizzle(a,1,0,3,2);k=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,a),k);d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,a),d);a=SIMD.Float32x4.swizzle(a,2,3,0,1);k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(e,a),k);d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(g,a));a=SIMD.Float32x4.mul(f,e);a=SIMD.Float32x4.swizzle(a,1,0,3,2);m=SIMD.Float32x4.sub(m,
SIMD.Float32x4.mul(g,a));k=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),k);a=SIMD.Float32x4.swizzle(a,2,3,0,1);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(g,a),m);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.mul(f,g);a=SIMD.Float32x4.swizzle(a,1,0,3,2);m=SIMD.Float32x4.add(SIMD.Float32x4.mul(e,a),m);d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(b,a));a=SIMD.Float32x4.swizzle(a,2,3,0,1);m=SIMD.Float32x4.sub(m,SIMD.Float32x4.mul(e,a));d=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,a),d);f=SIMD.Float32x4.mul(f,
h);f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,2,3,0,1),f);f=SIMD.Float32x4.add(SIMD.Float32x4.swizzle(f,1,0,3,2),f);a=SIMD.Float32x4.reciprocalApproximation(f);f=SIMD.Float32x4.sub(SIMD.Float32x4.add(a,a),SIMD.Float32x4.mul(f,SIMD.Float32x4.mul(a,a)));f=SIMD.Float32x4.swizzle(f,0,0,0,0);if(!f)return null;SIMD.Float32x4.store(c,0,SIMD.Float32x4.mul(f,h));SIMD.Float32x4.store(c,4,SIMD.Float32x4.mul(f,m));SIMD.Float32x4.store(c,8,SIMD.Float32x4.mul(f,k));SIMD.Float32x4.store(c,12,SIMD.Float32x4.mul(f,
d));return c};g.invert=n.USE_SIMD?g.SIMD.invert:g.scalar.invert;g.scalar.adjoint=function(c,a){var f=a[0],b=a[1],g=a[2],e=a[3],h=a[4],m=a[5],k=a[6],d=a[7],q=a[8],p=a[9],r=a[10],u=a[11],t=a[12],v=a[13],n=a[14];a=a[15];c[0]=m*(r*a-u*n)-p*(k*a-d*n)+v*(k*u-d*r);c[1]=-(b*(r*a-u*n)-p*(g*a-e*n)+v*(g*u-e*r));c[2]=b*(k*a-d*n)-m*(g*a-e*n)+v*(g*d-e*k);c[3]=-(b*(k*u-d*r)-m*(g*u-e*r)+p*(g*d-e*k));c[4]=-(h*(r*a-u*n)-q*(k*a-d*n)+t*(k*u-d*r));c[5]=f*(r*a-u*n)-q*(g*a-e*n)+t*(g*u-e*r);c[6]=-(f*(k*a-d*n)-h*(g*a-e*n)+
t*(g*d-e*k));c[7]=f*(k*u-d*r)-h*(g*u-e*r)+q*(g*d-e*k);c[8]=h*(p*a-u*v)-q*(m*a-d*v)+t*(m*u-d*p);c[9]=-(f*(p*a-u*v)-q*(b*a-e*v)+t*(b*u-e*p));c[10]=f*(m*a-d*v)-h*(b*a-e*v)+t*(b*d-e*m);c[11]=-(f*(m*u-d*p)-h*(b*u-e*p)+q*(b*d-e*m));c[12]=-(h*(p*n-r*v)-q*(m*n-k*v)+t*(m*r-k*p));c[13]=f*(p*n-r*v)-q*(b*n-g*v)+t*(b*r-g*p);c[14]=-(f*(m*n-k*v)-h*(b*n-g*v)+t*(b*k-g*m));c[15]=f*(m*r-k*p)-h*(b*r-g*p)+q*(b*k-g*m);return c};g.SIMD.adjoint=function(c,a){var f,b,g,e,h,m,k,d;f=SIMD.Float32x4.load(a,0);b=SIMD.Float32x4.load(a,
4);g=SIMD.Float32x4.load(a,8);e=SIMD.Float32x4.load(a,12);m=SIMD.Float32x4.shuffle(f,b,0,1,4,5);h=SIMD.Float32x4.shuffle(g,e,0,1,4,5);a=SIMD.Float32x4.shuffle(m,h,0,2,4,6);h=SIMD.Float32x4.shuffle(h,m,1,3,5,7);m=SIMD.Float32x4.shuffle(f,b,2,3,6,7);b=SIMD.Float32x4.shuffle(g,e,2,3,6,7);f=SIMD.Float32x4.shuffle(m,b,0,2,4,6);b=SIMD.Float32x4.shuffle(b,m,1,3,5,7);m=SIMD.Float32x4.mul(f,b);m=SIMD.Float32x4.swizzle(m,1,0,3,2);g=SIMD.Float32x4.mul(h,m);e=SIMD.Float32x4.mul(a,m);m=SIMD.Float32x4.swizzle(m,
2,3,0,1);g=SIMD.Float32x4.sub(SIMD.Float32x4.mul(h,m),g);e=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,m),e);e=SIMD.Float32x4.swizzle(e,2,3,0,1);m=SIMD.Float32x4.mul(h,f);m=SIMD.Float32x4.swizzle(m,1,0,3,2);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,m),g);d=SIMD.Float32x4.mul(a,m);m=SIMD.Float32x4.swizzle(m,2,3,0,1);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(b,m));d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,m),d);d=SIMD.Float32x4.swizzle(d,2,3,0,1);m=SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,3,0,1),b);
m=SIMD.Float32x4.swizzle(m,1,0,3,2);f=SIMD.Float32x4.swizzle(f,2,3,0,1);g=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,m),g);k=SIMD.Float32x4.mul(a,m);m=SIMD.Float32x4.swizzle(m,2,3,0,1);g=SIMD.Float32x4.sub(g,SIMD.Float32x4.mul(f,m));k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,m),k);k=SIMD.Float32x4.swizzle(k,2,3,0,1);m=SIMD.Float32x4.mul(a,h);m=SIMD.Float32x4.swizzle(m,1,0,3,2);k=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,m),k);d=SIMD.Float32x4.sub(SIMD.Float32x4.mul(f,m),d);m=SIMD.Float32x4.swizzle(m,2,
3,0,1);k=SIMD.Float32x4.sub(SIMD.Float32x4.mul(b,m),k);d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(f,m));m=SIMD.Float32x4.mul(a,b);m=SIMD.Float32x4.swizzle(m,1,0,3,2);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(f,m));k=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,m),k);m=SIMD.Float32x4.swizzle(m,2,3,0,1);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(f,m),e);k=SIMD.Float32x4.sub(k,SIMD.Float32x4.mul(h,m));m=SIMD.Float32x4.mul(a,f);m=SIMD.Float32x4.swizzle(m,1,0,3,2);e=SIMD.Float32x4.add(SIMD.Float32x4.mul(b,m),e);
d=SIMD.Float32x4.sub(d,SIMD.Float32x4.mul(h,m));m=SIMD.Float32x4.swizzle(m,2,3,0,1);e=SIMD.Float32x4.sub(e,SIMD.Float32x4.mul(b,m));d=SIMD.Float32x4.add(SIMD.Float32x4.mul(h,m),d);SIMD.Float32x4.store(c,0,g);SIMD.Float32x4.store(c,4,e);SIMD.Float32x4.store(c,8,k);SIMD.Float32x4.store(c,12,d);return c};g.adjoint=n.USE_SIMD?g.SIMD.adjoint:g.scalar.adjoint;g.determinant=function(c){var a=c[0],f=c[1],b=c[2],g=c[3],e=c[4],h=c[5],m=c[6],k=c[7],d=c[8],q=c[9],p=c[10],r=c[11],u=c[12],t=c[13],v=c[14];c=c[15];
return(a*h-f*e)*(p*c-r*v)-(a*m-b*e)*(q*c-r*t)+(a*k-g*e)*(q*v-p*t)+(f*m-b*h)*(d*c-r*u)-(f*k-g*h)*(d*v-p*u)+(b*k-g*m)*(d*t-q*u)};g.SIMD.multiply=function(c,a,f){var b=SIMD.Float32x4.load(a,0),g=SIMD.Float32x4.load(a,4),e=SIMD.Float32x4.load(a,8);a=SIMD.Float32x4.load(a,12);var h=SIMD.Float32x4.load(f,0),h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,
2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),a))));SIMD.Float32x4.store(c,0,h);h=SIMD.Float32x4.load(f,4);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),a))));SIMD.Float32x4.store(c,4,h);h=SIMD.Float32x4.load(f,8);h=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,
0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,2,2,2,2),e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(h,3,3,3,3),a))));SIMD.Float32x4.store(c,8,h);f=SIMD.Float32x4.load(f,12);b=SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,0,0,0,0),b),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,1,1,1,1),g),SIMD.Float32x4.add(SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,2,2,2,2),
e),SIMD.Float32x4.mul(SIMD.Float32x4.swizzle(f,3,3,3,3),a))));SIMD.Float32x4.store(c,12,b);return c};g.scalar.multiply=function(c,a,f){var b=a[0],g=a[1],e=a[2],h=a[3],m=a[4],k=a[5],d=a[6],q=a[7],p=a[8],r=a[9],u=a[10],t=a[11],v=a[12],n=a[13],z=a[14];a=a[15];var x=f[0],B=f[1],D=f[2],C=f[3];c[0]=x*b+B*m+D*p+C*v;c[1]=x*g+B*k+D*r+C*n;c[2]=x*e+B*d+D*u+C*z;c[3]=x*h+B*q+D*t+C*a;x=f[4];B=f[5];D=f[6];C=f[7];c[4]=x*b+B*m+D*p+C*v;c[5]=x*g+B*k+D*r+C*n;c[6]=x*e+B*d+D*u+C*z;c[7]=x*h+B*q+D*t+C*a;x=f[8];B=f[9];D=
f[10];C=f[11];c[8]=x*b+B*m+D*p+C*v;c[9]=x*g+B*k+D*r+C*n;c[10]=x*e+B*d+D*u+C*z;c[11]=x*h+B*q+D*t+C*a;x=f[12];B=f[13];D=f[14];C=f[15];c[12]=x*b+B*m+D*p+C*v;c[13]=x*g+B*k+D*r+C*n;c[14]=x*e+B*d+D*u+C*z;c[15]=x*h+B*q+D*t+C*a;return c};g.multiply=n.USE_SIMD?g.SIMD.multiply:g.scalar.multiply;g.mul=g.multiply;g.scalar.translate=function(c,a,f){var b=f[0],g=f[1];f=f[2];var e,h,m,k,d,q,p,r,u,t,v,n;a===c?(c[12]=a[0]*b+a[4]*g+a[8]*f+a[12],c[13]=a[1]*b+a[5]*g+a[9]*f+a[13],c[14]=a[2]*b+a[6]*g+a[10]*f+a[14],c[15]=
a[3]*b+a[7]*g+a[11]*f+a[15]):(e=a[0],h=a[1],m=a[2],k=a[3],d=a[4],q=a[5],p=a[6],r=a[7],u=a[8],t=a[9],v=a[10],n=a[11],c[0]=e,c[1]=h,c[2]=m,c[3]=k,c[4]=d,c[5]=q,c[6]=p,c[7]=r,c[8]=u,c[9]=t,c[10]=v,c[11]=n,c[12]=e*b+d*g+u*f+a[12],c[13]=h*b+q*g+t*f+a[13],c[14]=m*b+p*g+v*f+a[14],c[15]=k*b+r*g+n*f+a[15]);return c};g.SIMD.translate=function(c,a,f){var b=SIMD.Float32x4.load(a,0),g=SIMD.Float32x4.load(a,4),e=SIMD.Float32x4.load(a,8),h=SIMD.Float32x4.load(a,12);f=SIMD.Float32x4(f[0],f[1],f[2],0);a!==c&&(c[0]=
a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11]);b=SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,0,0,0,0));g=SIMD.Float32x4.mul(g,SIMD.Float32x4.swizzle(f,1,1,1,1));e=SIMD.Float32x4.mul(e,SIMD.Float32x4.swizzle(f,2,2,2,2));a=SIMD.Float32x4.add(b,SIMD.Float32x4.add(g,SIMD.Float32x4.add(e,h)));SIMD.Float32x4.store(c,12,a);return c};g.translate=n.USE_SIMD?g.SIMD.translate:g.scalar.translate;g.scalar.scale=function(c,a,f){var b=f[0],
g=f[1];f=f[2];c[0]=a[0]*b;c[1]=a[1]*b;c[2]=a[2]*b;c[3]=a[3]*b;c[4]=a[4]*g;c[5]=a[5]*g;c[6]=a[6]*g;c[7]=a[7]*g;c[8]=a[8]*f;c[9]=a[9]*f;c[10]=a[10]*f;c[11]=a[11]*f;c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};g.SIMD.scale=function(c,a,f){var b;f=SIMD.Float32x4(f[0],f[1],f[2],0);b=SIMD.Float32x4.load(a,0);SIMD.Float32x4.store(c,0,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,0,0,0,0)));b=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(c,4,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,1,1,
1,1)));b=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(c,8,SIMD.Float32x4.mul(b,SIMD.Float32x4.swizzle(f,2,2,2,2)));c[12]=a[12];c[13]=a[13];c[14]=a[14];c[15]=a[15];return c};g.scale=n.USE_SIMD?g.SIMD.scale:g.scalar.scale;g.rotate=function(c,a,f,b){var g=b[0],e=b[1];b=b[2];var h=Math.sqrt(g*g+e*e+b*b),m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K;if(Math.abs(h)<n.EPSILON)return null;h=1/h;g*=h;e*=h;b*=h;m=Math.sin(f);k=Math.cos(f);d=1-k;f=a[0];h=a[1];q=a[2];p=a[3];r=a[4];u=a[5];t=a[6];v=a[7];A=a[8];z=a[9];
x=a[10];B=a[11];D=g*g*d+k;C=e*g*d+b*m;G=b*g*d-e*m;E=g*e*d-b*m;F=e*e*d+k;I=b*e*d+g*m;K=g*b*d+e*m;g=e*b*d-g*m;e=b*b*d+k;c[0]=f*D+r*C+A*G;c[1]=h*D+u*C+z*G;c[2]=q*D+t*C+x*G;c[3]=p*D+v*C+B*G;c[4]=f*E+r*F+A*I;c[5]=h*E+u*F+z*I;c[6]=q*E+t*F+x*I;c[7]=p*E+v*F+B*I;c[8]=f*K+r*g+A*e;c[9]=h*K+u*g+z*e;c[10]=q*K+t*g+x*e;c[11]=p*K+v*g+B*e;a!==c&&(c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);return c};g.scalar.rotateX=function(c,a,f){var b=Math.sin(f);f=Math.cos(f);var g=a[4],e=a[5],h=a[6],m=a[7],k=a[8],d=a[9],
q=a[10],p=a[11];a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[4]=g*f+k*b;c[5]=e*f+d*b;c[6]=h*f+q*b;c[7]=m*f+p*b;c[8]=k*f-g*b;c[9]=d*f-e*b;c[10]=q*f-h*b;c[11]=p*f-m*b;return c};g.SIMD.rotateX=function(c,a,f){var b=SIMD.Float32x4.splat(Math.sin(f));f=SIMD.Float32x4.splat(Math.cos(f));a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);var g=SIMD.Float32x4.load(a,4);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(c,
4,SIMD.Float32x4.add(SIMD.Float32x4.mul(g,f),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(c,8,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,f),SIMD.Float32x4.mul(g,b)));return c};g.rotateX=n.USE_SIMD?g.SIMD.rotateX:g.scalar.rotateX;g.scalar.rotateY=function(c,a,f){var b=Math.sin(f);f=Math.cos(f);var g=a[0],e=a[1],h=a[2],m=a[3],k=a[8],d=a[9],q=a[10],p=a[11];a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=g*f-k*b;c[1]=e*f-d*b;c[2]=h*f-q*b;c[3]=m*f-p*
b;c[8]=g*b+k*f;c[9]=e*b+d*f;c[10]=h*b+q*f;c[11]=m*b+p*f;return c};g.SIMD.rotateY=function(c,a,f){var b=SIMD.Float32x4.splat(Math.sin(f));f=SIMD.Float32x4.splat(Math.cos(f));a!==c&&(c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);var g=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,8);SIMD.Float32x4.store(c,0,SIMD.Float32x4.sub(SIMD.Float32x4.mul(g,f),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(c,8,SIMD.Float32x4.add(SIMD.Float32x4.mul(g,b),SIMD.Float32x4.mul(a,
f)));return c};g.rotateY=n.USE_SIMD?g.SIMD.rotateY:g.scalar.rotateY;g.scalar.rotateZ=function(c,a,f){var b=Math.sin(f);f=Math.cos(f);var g=a[0],e=a[1],h=a[2],m=a[3],k=a[4],d=a[5],q=a[6],p=a[7];a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);c[0]=g*f+k*b;c[1]=e*f+d*b;c[2]=h*f+q*b;c[3]=m*f+p*b;c[4]=k*f-g*b;c[5]=d*f-e*b;c[6]=q*f-h*b;c[7]=p*f-m*b;return c};g.SIMD.rotateZ=function(c,a,f){var b=SIMD.Float32x4.splat(Math.sin(f));f=SIMD.Float32x4.splat(Math.cos(f));
a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]);var g=SIMD.Float32x4.load(a,0);a=SIMD.Float32x4.load(a,4);SIMD.Float32x4.store(c,0,SIMD.Float32x4.add(SIMD.Float32x4.mul(g,f),SIMD.Float32x4.mul(a,b)));SIMD.Float32x4.store(c,4,SIMD.Float32x4.sub(SIMD.Float32x4.mul(a,f),SIMD.Float32x4.mul(g,b)));return c};g.rotateZ=n.USE_SIMD?g.SIMD.rotateZ:g.scalar.rotateZ;g.fromTranslation=function(c,a){c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=
0;c[9]=0;c[10]=1;c[11]=0;c[12]=a[0];c[13]=a[1];c[14]=a[2];c[15]=1;return c};g.fromScaling=function(c,a){c[0]=a[0];c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a[1];c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=a[2];c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};g.fromRotation=function(c,a,f){var b=f[0],g=f[1];f=f[2];var e=Math.sqrt(b*b+g*g+f*f),h;if(Math.abs(e)<n.EPSILON)return null;e=1/e;b*=e;g*=e;f*=e;e=Math.sin(a);a=Math.cos(a);h=1-a;c[0]=b*b*h+a;c[1]=g*b*h+f*e;c[2]=f*b*h-g*e;c[3]=0;c[4]=b*g*h-f*e;c[5]=g*g*h+a;c[6]=
f*g*h+b*e;c[7]=0;c[8]=b*f*h+g*e;c[9]=g*f*h-b*e;c[10]=f*f*h+a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};g.fromXRotation=function(c,a){var f=Math.sin(a);a=Math.cos(a);c[0]=1;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a;c[6]=f;c[7]=0;c[8]=0;c[9]=-f;c[10]=a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};g.fromYRotation=function(c,a){var f=Math.sin(a);a=Math.cos(a);c[0]=a;c[1]=0;c[2]=-f;c[3]=0;c[4]=0;c[5]=1;c[6]=0;c[7]=0;c[8]=f;c[9]=0;c[10]=a;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};g.fromZRotation=
function(c,a){var f=Math.sin(a);a=Math.cos(a);c[0]=a;c[1]=f;c[2]=0;c[3]=0;c[4]=-f;c[5]=a;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=1;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};g.fromRotationTranslation=function(c,a,f){var b=a[0],g=a[1],e=a[2],h=a[3],m=b+b,k=g+g,d=e+e;a=b*m;var q=b*k,b=b*d,p=g*k,g=g*d,e=e*d,m=h*m,k=h*k,h=h*d;c[0]=1-(p+e);c[1]=q+h;c[2]=b-k;c[3]=0;c[4]=q-h;c[5]=1-(a+e);c[6]=g+m;c[7]=0;c[8]=b+k;c[9]=g-m;c[10]=1-(a+p);c[11]=0;c[12]=f[0];c[13]=f[1];c[14]=f[2];c[15]=1;return c};g.getTranslation=
function(c,a){c[0]=a[12];c[1]=a[13];c[2]=a[14];return c};g.getRotation=function(c,a){var f=a[0]+a[5]+a[10],b=0;0<f?(b=2*Math.sqrt(f+1),c[3]=.25*b,c[0]=(a[6]-a[9])/b,c[1]=(a[8]-a[2])/b,c[2]=(a[1]-a[4])/b):a[0]>a[5]&a[0]>a[10]?(b=2*Math.sqrt(1+a[0]-a[5]-a[10]),c[3]=(a[6]-a[9])/b,c[0]=.25*b,c[1]=(a[1]+a[4])/b,c[2]=(a[8]+a[2])/b):a[5]>a[10]?(b=2*Math.sqrt(1+a[5]-a[0]-a[10]),c[3]=(a[8]-a[2])/b,c[0]=(a[1]+a[4])/b,c[1]=.25*b,c[2]=(a[6]+a[9])/b):(b=2*Math.sqrt(1+a[10]-a[0]-a[5]),c[3]=(a[1]-a[4])/b,c[0]=(a[8]+
a[2])/b,c[1]=(a[6]+a[9])/b,c[2]=.25*b);return c};g.fromRotationTranslationScale=function(c,a,f,b){var g=a[0],e=a[1],h=a[2],m=a[3],k=g+g,d=e+e,q=h+h;a=g*k;var p=g*d,g=g*q,r=e*d,e=e*q,h=h*q,k=m*k,d=m*d,m=m*q,q=b[0],u=b[1];b=b[2];c[0]=(1-(r+h))*q;c[1]=(p+m)*q;c[2]=(g-d)*q;c[3]=0;c[4]=(p-m)*u;c[5]=(1-(a+h))*u;c[6]=(e+k)*u;c[7]=0;c[8]=(g+d)*b;c[9]=(e-k)*b;c[10]=(1-(a+r))*b;c[11]=0;c[12]=f[0];c[13]=f[1];c[14]=f[2];c[15]=1;return c};g.fromRotationTranslationScaleOrigin=function(c,a,f,b,g){var e=a[0],h=a[1],
l=a[2],k=a[3],d=e+e,q=h+h,p=l+l;a=e*d;var r=e*q,e=e*p,u=h*q,h=h*p,l=l*p,d=k*d,q=k*q,k=k*p,p=b[0],t=b[1];b=b[2];var v=g[0],n=g[1];g=g[2];c[0]=(1-(u+l))*p;c[1]=(r+k)*p;c[2]=(e-q)*p;c[3]=0;c[4]=(r-k)*t;c[5]=(1-(a+l))*t;c[6]=(h+d)*t;c[7]=0;c[8]=(e+q)*b;c[9]=(h-d)*b;c[10]=(1-(a+u))*b;c[11]=0;c[12]=f[0]+v-(c[0]*v+c[4]*n+c[8]*g);c[13]=f[1]+n-(c[1]*v+c[5]*n+c[9]*g);c[14]=f[2]+g-(c[2]*v+c[6]*n+c[10]*g);c[15]=1;return c};g.fromQuat=function(c,a){var f=a[0],b=a[1],g=a[2];a=a[3];var e=f+f,h=b+b,m=g+g,f=f*e,k=
b*e,b=b*h,d=g*e,q=g*h,g=g*m,e=a*e,h=a*h;a*=m;c[0]=1-b-g;c[1]=k+a;c[2]=d-h;c[3]=0;c[4]=k-a;c[5]=1-f-g;c[6]=q+e;c[7]=0;c[8]=d+h;c[9]=q-e;c[10]=1-f-b;c[11]=0;c[12]=0;c[13]=0;c[14]=0;c[15]=1;return c};g.frustum=function(c,a,f,b,g,e,h){var l=1/(f-a),k=1/(g-b),d=1/(e-h);c[0]=2*e*l;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=2*e*k;c[6]=0;c[7]=0;c[8]=(f+a)*l;c[9]=(g+b)*k;c[10]=(h+e)*d;c[11]=-1;c[12]=0;c[13]=0;c[14]=h*e*2*d;c[15]=0;return c};g.perspective=function(c,a,f,b,g){a=1/Math.tan(a/2);var e=1/(b-g);c[0]=a/f;
c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=a;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=(g+b)*e;c[11]=-1;c[12]=0;c[13]=0;c[14]=2*g*b*e;c[15]=0;return c};g.perspectiveFromFieldOfView=function(c,a,f,b){var g=Math.tan(a.upDegrees*Math.PI/180),e=Math.tan(a.downDegrees*Math.PI/180),h=Math.tan(a.leftDegrees*Math.PI/180);a=Math.tan(a.rightDegrees*Math.PI/180);var m=2/(h+a),k=2/(g+e);c[0]=m;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=k;c[6]=0;c[7]=0;c[8]=-((h-a)*m*.5);c[9]=(g-e)*k*.5;c[10]=b/(f-b);c[11]=-1;c[12]=0;c[13]=0;c[14]=b*f/(f-
b);c[15]=0;return c};g.ortho=function(c,a,f,b,g,e,h){var l=1/(a-f),k=1/(b-g),d=1/(e-h);c[0]=-2*l;c[1]=0;c[2]=0;c[3]=0;c[4]=0;c[5]=-2*k;c[6]=0;c[7]=0;c[8]=0;c[9]=0;c[10]=2*d;c[11]=0;c[12]=(a+f)*l;c[13]=(g+b)*k;c[14]=(h+e)*d;c[15]=1;return c};g.lookAt=function(c,a,f,b){var l,e,h,m,k,d,q,p,r=a[0],u=a[1];a=a[2];h=b[0];m=b[1];e=b[2];q=f[0];b=f[1];l=f[2];if(Math.abs(r-q)<n.EPSILON&&Math.abs(u-b)<n.EPSILON&&Math.abs(a-l)<n.EPSILON)return g.identity(c);f=r-q;b=u-b;q=a-l;p=1/Math.sqrt(f*f+b*b+q*q);f*=p;b*=
p;q*=p;l=m*q-e*b;e=e*f-h*q;h=h*b-m*f;(p=Math.sqrt(l*l+e*e+h*h))?(p=1/p,l*=p,e*=p,h*=p):h=e=l=0;m=b*h-q*e;k=q*l-f*h;d=f*e-b*l;(p=Math.sqrt(m*m+k*k+d*d))?(p=1/p,m*=p,k*=p,d*=p):d=k=m=0;c[0]=l;c[1]=m;c[2]=f;c[3]=0;c[4]=e;c[5]=k;c[6]=b;c[7]=0;c[8]=h;c[9]=d;c[10]=q;c[11]=0;c[12]=-(l*r+e*u+h*a);c[13]=-(m*r+k*u+d*a);c[14]=-(f*r+b*u+q*a);c[15]=1;return c};g.str=function(c){return"mat4("+c[0]+", "+c[1]+", "+c[2]+", "+c[3]+", "+c[4]+", "+c[5]+", "+c[6]+", "+c[7]+", "+c[8]+", "+c[9]+", "+c[10]+", "+c[11]+", "+
c[12]+", "+c[13]+", "+c[14]+", "+c[15]+")"};g.frob=function(c){return Math.sqrt(Math.pow(c[0],2)+Math.pow(c[1],2)+Math.pow(c[2],2)+Math.pow(c[3],2)+Math.pow(c[4],2)+Math.pow(c[5],2)+Math.pow(c[6],2)+Math.pow(c[7],2)+Math.pow(c[8],2)+Math.pow(c[9],2)+Math.pow(c[10],2)+Math.pow(c[11],2)+Math.pow(c[12],2)+Math.pow(c[13],2)+Math.pow(c[14],2)+Math.pow(c[15],2))};g.add=function(c,a,f){c[0]=a[0]+f[0];c[1]=a[1]+f[1];c[2]=a[2]+f[2];c[3]=a[3]+f[3];c[4]=a[4]+f[4];c[5]=a[5]+f[5];c[6]=a[6]+f[6];c[7]=a[7]+f[7];
c[8]=a[8]+f[8];c[9]=a[9]+f[9];c[10]=a[10]+f[10];c[11]=a[11]+f[11];c[12]=a[12]+f[12];c[13]=a[13]+f[13];c[14]=a[14]+f[14];c[15]=a[15]+f[15];return c};g.subtract=function(c,a,f){c[0]=a[0]-f[0];c[1]=a[1]-f[1];c[2]=a[2]-f[2];c[3]=a[3]-f[3];c[4]=a[4]-f[4];c[5]=a[5]-f[5];c[6]=a[6]-f[6];c[7]=a[7]-f[7];c[8]=a[8]-f[8];c[9]=a[9]-f[9];c[10]=a[10]-f[10];c[11]=a[11]-f[11];c[12]=a[12]-f[12];c[13]=a[13]-f[13];c[14]=a[14]-f[14];c[15]=a[15]-f[15];return c};g.sub=g.subtract;g.multiplyScalar=function(c,a,f){c[0]=a[0]*
f;c[1]=a[1]*f;c[2]=a[2]*f;c[3]=a[3]*f;c[4]=a[4]*f;c[5]=a[5]*f;c[6]=a[6]*f;c[7]=a[7]*f;c[8]=a[8]*f;c[9]=a[9]*f;c[10]=a[10]*f;c[11]=a[11]*f;c[12]=a[12]*f;c[13]=a[13]*f;c[14]=a[14]*f;c[15]=a[15]*f;return c};g.multiplyScalarAndAdd=function(c,a,f,b){c[0]=a[0]+f[0]*b;c[1]=a[1]+f[1]*b;c[2]=a[2]+f[2]*b;c[3]=a[3]+f[3]*b;c[4]=a[4]+f[4]*b;c[5]=a[5]+f[5]*b;c[6]=a[6]+f[6]*b;c[7]=a[7]+f[7]*b;c[8]=a[8]+f[8]*b;c[9]=a[9]+f[9]*b;c[10]=a[10]+f[10]*b;c[11]=a[11]+f[11]*b;c[12]=a[12]+f[12]*b;c[13]=a[13]+f[13]*b;c[14]=
a[14]+f[14]*b;c[15]=a[15]+f[15]*b;return c};g.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]};g.equals=function(c,a){var f=c[0],b=c[1],g=c[2],e=c[3],h=c[4],m=c[5],k=c[6],d=c[7],q=c[8],p=c[9],r=c[10],u=c[11],t=c[12],v=c[13],A=c[14];c=c[15];var z=a[0],x=a[1],B=a[2],D=a[3],C=a[4],G=a[5],E=a[6],F=a[7],
I=a[8],K=a[9],N=a[10],H=a[11],M=a[12],T=a[13],V=a[14];a=a[15];return Math.abs(f-z)<=n.EPSILON*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(b-x)<=n.EPSILON*Math.max(1,Math.abs(b),Math.abs(x))&&Math.abs(g-B)<=n.EPSILON*Math.max(1,Math.abs(g),Math.abs(B))&&Math.abs(e-D)<=n.EPSILON*Math.max(1,Math.abs(e),Math.abs(D))&&Math.abs(h-C)<=n.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(m-G)<=n.EPSILON*Math.max(1,Math.abs(m),Math.abs(G))&&Math.abs(k-E)<=n.EPSILON*Math.max(1,Math.abs(k),Math.abs(E))&&
Math.abs(d-F)<=n.EPSILON*Math.max(1,Math.abs(d),Math.abs(F))&&Math.abs(q-I)<=n.EPSILON*Math.max(1,Math.abs(q),Math.abs(I))&&Math.abs(p-K)<=n.EPSILON*Math.max(1,Math.abs(p),Math.abs(K))&&Math.abs(r-N)<=n.EPSILON*Math.max(1,Math.abs(r),Math.abs(N))&&Math.abs(u-H)<=n.EPSILON*Math.max(1,Math.abs(u),Math.abs(H))&&Math.abs(t-M)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(M))&&Math.abs(v-T)<=n.EPSILON*Math.max(1,Math.abs(v),Math.abs(T))&&Math.abs(A-V)<=n.EPSILON*Math.max(1,Math.abs(A),Math.abs(V))&&Math.abs(c-
a)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(a))};return g})},"esri/core/libs/gl-matrix/common":function(){define([],function(){var n={EPSILON:1E-6};n.ARRAY_TYPE="undefined"!==typeof Float32Array?Float32Array:Array;n.RANDOM=Math.random;n.ENABLE_SIMD=!1;n.SIMD_AVAILABLE=n.ARRAY_TYPE===Float32Array&&"SIMD"in this;n.USE_SIMD=n.ENABLE_SIMD&&n.SIMD_AVAILABLE;n.setMatrixArrayType=function(c){n.ARRAY_TYPE=c};var g=Math.PI/180;n.toRadian=function(c){return c*g};n.equals=function(c,a){return Math.abs(c-a)<=
n.EPSILON*Math.max(1,Math.abs(c),Math.abs(a))};return n})},"esri/core/libs/gl-matrix/vec2":function(){define(["./common"],function(n){var g={create:function(){var c=new n.ARRAY_TYPE(2);c[0]=0;c[1]=0;return c},clone:function(c){var a=new n.ARRAY_TYPE(2);a[0]=c[0];a[1]=c[1];return a},fromValues:function(c,a){var f=new n.ARRAY_TYPE(2);f[0]=c;f[1]=a;return f},copy:function(c,a){c[0]=a[0];c[1]=a[1];return c},set:function(c,a,f){c[0]=a;c[1]=f;return c},add:function(c,a,f){c[0]=a[0]+f[0];c[1]=a[1]+f[1];
return c},subtract:function(c,a,f){c[0]=a[0]-f[0];c[1]=a[1]-f[1];return c}};g.sub=g.subtract;g.multiply=function(c,a,f){c[0]=a[0]*f[0];c[1]=a[1]*f[1];return c};g.mul=g.multiply;g.divide=function(c,a,f){c[0]=a[0]/f[0];c[1]=a[1]/f[1];return c};g.div=g.divide;g.ceil=function(c,a){c[0]=Math.ceil(a[0]);c[1]=Math.ceil(a[1]);return c};g.floor=function(c,a){c[0]=Math.floor(a[0]);c[1]=Math.floor(a[1]);return c};g.min=function(c,a,f){c[0]=Math.min(a[0],f[0]);c[1]=Math.min(a[1],f[1]);return c};g.max=function(c,
a,f){c[0]=Math.max(a[0],f[0]);c[1]=Math.max(a[1],f[1]);return c};g.round=function(c,a){c[0]=Math.round(a[0]);c[1]=Math.round(a[1]);return c};g.scale=function(c,a,f){c[0]=a[0]*f;c[1]=a[1]*f;return c};g.scaleAndAdd=function(c,a,f,b){c[0]=a[0]+f[0]*b;c[1]=a[1]+f[1]*b;return c};g.distance=function(c,a){var f=a[0]-c[0];c=a[1]-c[1];return Math.sqrt(f*f+c*c)};g.dist=g.distance;g.squaredDistance=function(c,a){var f=a[0]-c[0];c=a[1]-c[1];return f*f+c*c};g.sqrDist=g.squaredDistance;g.length=function(c){var a=
c[0];c=c[1];return Math.sqrt(a*a+c*c)};g.len=g.length;g.squaredLength=function(c){var a=c[0];c=c[1];return a*a+c*c};g.sqrLen=g.squaredLength;g.negate=function(c,a){c[0]=-a[0];c[1]=-a[1];return c};g.inverse=function(c,a){c[0]=1/a[0];c[1]=1/a[1];return c};g.normalize=function(c,a){var f=a[0],b=a[1],f=f*f+b*b;0<f&&(f=1/Math.sqrt(f),c[0]=a[0]*f,c[1]=a[1]*f);return c};g.dot=function(c,a){return c[0]*a[0]+c[1]*a[1]};g.cross=function(c,a,f){a=a[0]*f[1]-a[1]*f[0];c[0]=c[1]=0;c[2]=a;return c};g.lerp=function(c,
a,f,b){var g=a[0];a=a[1];c[0]=g+b*(f[0]-g);c[1]=a+b*(f[1]-a);return c};g.random=function(c,a){a=a||1;var f=2*n.RANDOM()*Math.PI;c[0]=Math.cos(f)*a;c[1]=Math.sin(f)*a;return c};g.transformMat2=function(c,a,f){var b=a[0];a=a[1];c[0]=f[0]*b+f[2]*a;c[1]=f[1]*b+f[3]*a;return c};g.transformMat2d=function(c,a,f){var b=a[0];a=a[1];c[0]=f[0]*b+f[2]*a+f[4];c[1]=f[1]*b+f[3]*a+f[5];return c};g.transformMat3=function(c,a,f){var b=a[0];a=a[1];c[0]=f[0]*b+f[3]*a+f[6];c[1]=f[1]*b+f[4]*a+f[7];return c};g.transformMat4=
function(c,a,f){var b=a[0];a=a[1];c[0]=f[0]*b+f[4]*a+f[12];c[1]=f[1]*b+f[5]*a+f[13];return c};g.forEach=function(){var c=g.create();return function(a,f,b,g,e,h){f||(f=2);b||(b=0);for(g=g?Math.min(g*f+b,a.length):a.length;b<g;b+=f)c[0]=a[b],c[1]=a[b+1],e(c,c,h),a[b]=c[0],a[b+1]=c[1];return a}}();g.str=function(c){return"vec2("+c[0]+", "+c[1]+")"};g.exactEquals=function(c,a){return c[0]===a[0]&&c[1]===a[1]};g.equals=function(c,a){var f=c[0];c=c[1];var b=a[0];a=a[1];return Math.abs(f-b)<=n.EPSILON*Math.max(1,
Math.abs(f),Math.abs(b))&&Math.abs(c-a)<=n.EPSILON*Math.max(1,Math.abs(c),Math.abs(a))};return g})},"esri/views/2d/engine/DisplayObject":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","./Evented"],function(n,g,c,a){return function(a){function b(){var b=null!==a&&a.apply(this,arguments)||this;b._renderRequestedCalled=!1;b._attached=!1;b._opacity=1;b.renderRequested=!1;b._visible=!0;return b}c(b,a);Object.defineProperty(b.prototype,"attached",{get:function(){return this._attached},
set:function(a){this._attached!==a&&((this._attached=a)?this.hasEventListener("attach")&&this.emit("attach"):this.hasEventListener("detach")&&this.emit("detach"))},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"opacity",{get:function(){return this._opacity},set:function(a){this._opacity!==a&&(this._opacity=a,this.requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"visible",{get:function(){return this._visible},set:function(a){this._visible!==a&&
(this._visible=a,this.requestRender())},enumerable:!0,configurable:!0});b.prototype.attach=function(a){return!0};b.prototype.detach=function(a){};b.prototype.processRender=function(a){this._renderRequestedCalled=!1;this.doRender(a);this._renderRequestedCalled||(this.renderRequested=!1);this.hasEventListener("post-render")&&this.emit("post-render")};b.prototype.requestRender=function(){var a=this.renderRequested;this.renderRequested=this._renderRequestedCalled=!0;this.parent&&this.parent.requestChildRender(this);
a!==this.renderRequested&&this.hasEventListener("will-render")&&this.emit("will-render")};b.prototype.dispose=function(){};return b}(a.Evented)})},"esri/views/2d/engine/Evented":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","dojo/aspect","dojo/on"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function b(){}b.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};b.prototype.once=function(a,b){return f.once(this,a,b)};b.prototype.emit=
function(a){f.emit(this,a,this)};b.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};return b}();g.Evented=n;g.EventedMixin=function(b){return function(b){function e(){return null!==b&&b.apply(this,arguments)||this}c(e,b);e.prototype.on=function(b,c){return a.after(this,"on"+b,c,!0)};e.prototype.once=function(a,b){return f.once(this,a,b)};e.prototype.emit=function(a,b){f.emit(this,a,b)};e.prototype.hasEventListener=function(a){a="on"+a;return!(!this[a]||!this[a].after)};
return e}(b)}})},"esri/views/2d/tiling/enums":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=g.TileStatus||(g.TileStatus={});n[n.INITIALIZED=0]="INITIALIZED";n[n.NO_DATA=1]="NO_DATA";n[n.READY=2]="READY";n[n.MODIFIED=3]="MODIFIED";n[n.INVALID=4]="INVALID"})},"esri/views/2d/tiling/TileKey":function(){define(["require","exports","../../../core/ObjectPool"],function(n,g,c){return function(){function a(a,b,c,e){this.set(a,b,c,e)}a.from=function(c,
b,g,e){return a.pool.acquire(c,b,g,e)};a.getId=function(a,b,c,e){return"object"===typeof a?a.level+"/"+a.row+"/"+a.col+"/"+a.world:a+"/"+b+"/"+c+"/"+e};Object.defineProperty(a.prototype,"key",{get:function(){return this},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"id",{get:function(){return this.toString()},enumerable:!0,configurable:!0});a.prototype.equals=function(a){return this.level===a.level&&this.row===a.row&&this.col===a.col&&this.world===a.world};a.prototype.release=
function(){this.world=this.col=this.row=this.level=0};a.prototype.set=function(a,b,c,e){null==a?this.world=this.col=this.row=this.level=0:"object"===typeof a?(this.level=a.level||0,this.row=a.row||0,this.col=a.col||0,this.world=a.world||0):"string"===typeof a?(a=a.split("/"),b=a[1],c=a[2],e=a[3],this.level=parseFloat(a[0]),this.row=parseFloat(b),this.col=parseFloat(c),this.world=parseFloat(e)):(this.level=+a,this.row=+b,this.col=+c,this.world=+e||0);return this};a.prototype.toString=function(){return this.level+
"/"+this.row+"/"+this.col+"/"+this.world};a.prototype.getChildKeys=function(){var c=this.level+1,b=this.row<<1,g=this.col<<1,e=this.world;return[a.pool.acquire(c,b,g,e),a.pool.acquire(c,b,g+1,e),a.pool.acquire(c,b+1,g,e),a.pool.acquire(c,b+1,g+1,e)]};a.prototype._compare=function(a){return this.row<a.row?-1:this.row>a.row?1:this.col<a.col?-1:this.col>a.col?1:0};a.sort=function(c){return c.map(function(b){return a.from(b)}).sort(function(a,c){return a._compare(c)}).map(function(a){return a.id})};a.pool=
new c(a,!0,null,25,50);return a}()})},"esri/views/vectorTiles/RenderBucket":function(){define(["require","exports","../../core/tsSupport/extendsHelper","../../core/tsSupport/decorateHelper"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(){return function(a){this.type=a}}();g.RenderBucket=n;a=function(a){function b(){var b=a.call(this,2)||this;b.triangleElementStart=0;b.triangleElementCount=0;return b}c(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount};
return b}(n);g.LineRenderBucket=a;a=function(a){function b(){var b=a.call(this,1)||this;b.triangleElementStart=0;b.triangleElementCount=0;b.outlineElementStart=0;b.outlineElementCount=0;return b}c(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount||0<this.outlineElementCount};return b}(n);g.FillRenderBucket=a;a=function(a){function b(){var b=a.call(this,3)||this;b.markerPerPageElementsMap=new Map;b.glyphPerPageElementsMap=new Map;b.isSDF=!1;return b}c(b,a);b.prototype.hasData=
function(){return 0<this.markerPerPageElementsMap.size||0<this.glyphPerPageElementsMap.size};return b}(n);g.SymbolRenderBucket=a;a=function(a){function b(){var b=a.call(this,4)||this;b.triangleElementStart=0;b.triangleElementCount=0;return b}c(b,a);b.prototype.hasData=function(){return 0<this.triangleElementCount};return b}(n);g.CircleRenderBucket=a;n=function(a){function b(){return a.call(this,0)||this}c(b,a);b.prototype.hasData=function(){return!0};return b}(n);g.BackgroundRenderBucket=n})},"esri/views/3d/terrain/TileGeometryFactory":function(){define("require exports ../../../geometry/support/aaBoundingBox ../lib/gl-matrix ../support/ArrayPool ../support/earthUtils ../support/mathUtils ./TerrainConst".split(" "),
function(n,g,c,a,f,b,l,e){function h(a,b,c){for(var d=0;d<c.length;d++){var f=c[d];if(f){var h=f.safeWidth,g=f.width,k=f.pixelData,m=l.clamp(f.dy*(f.y1-b),0,h),f=l.clamp(f.dx*(a-f.x0),0,h),h=Math.floor(m),p=Math.floor(f),q=h*g+p,r=q+g,t=k[q],g=k[r],q=k[q+1],k=k[r+1];if(t+g+q+k<.5*e.ELEVATION_NODATA_VALUE)return m-=h,f-=p,a=t+(q-t)*f,a+(g+(k-g)*f-a)*m}}return null}function m(a,b,c,d){var e=0<(c&2),f=b+(d?1024:0)+(e?2048:0),h=r[f];if(!h){var h=b-1,g=b-1,k=b*b,l=2*h+2*g,m=h*g*6,p=6*l,t=6*(2*h+g-1);d&&
(m*=2,p*=2,t*=2);for(var l=65536<k+l?new Uint32Array(m+p):new Uint16Array(m+p),u=0,v=0,x=m,n,z,B,A,Q=0,L=0;L<=g;L++){e&&(Q=0===L?t:L===g?-t:0);for(var x=x+Q,D=0;D<=h;D++)B=q(D,L,h,g),-1<B&&(A=0===L&&D!==h?1:D===h&&L!==g?h+1:L===g&&0!==D?-1:0===D&&0!==L?-(h+1):0,0!==A&&(n=u,z=k+B,B=k+(0===D&&1===L?0:B+1),A=u+A,d?(l[x+0]=n,l[x+1]=z,l[x+2]=z,l[x+3]=B,l[x+4]=B,l[x+5]=n,l[x+6]=B,l[x+7]=A,l[x+8]=A,l[x+9]=n,l[x+10]=n,l[x+11]=B,x+=12):(l[x+0]=n,l[x+1]=z,l[x+2]=B,l[x+3]=B,l[x+4]=A,l[x+5]=n,x+=6))),++u,D<h&&
L<g&&(n=L*(h+1)+D,z=n+1,B=z+(h+1),A=B-1,d?(l[v+0]=n,l[v+1]=z,l[v+2]=z,l[v+3]=B,l[v+4]=B,l[v+5]=n,l[v+6]=B,l[v+7]=A,l[v+8]=A,l[v+9]=n,l[v+10]=n,l[v+11]=B,v+=12):(l[v+0]=n,l[v+1]=z,l[v+2]=B,l[v+3]=B,l[v+4]=A,l[v+5]=n,v+=6));x-=Q}h={values:l,numSurfaceIndices:m,numSkirtIndices:p};r[f]=h}a.indices=h.values;a.numSurfaceIndices=h.numSurfaceIndices;a.numSkirtIndices=h.numSkirtIndices;a.numWithoutSkirtIndices=a.numSurfaceIndices+(c?6*(b-1)*(d?2:1):0)}function k(a,b,c,d){a<d[0]&&(d[0]=a);a>d[3]&&(d[3]=a);
b<d[1]&&(d[1]=b);b>d[4]&&(d[4]=b);c<d[2]&&(d[2]=c);c>d[5]&&(d[5]=c)}function d(a,b){var c=b>a?1:0;return 2+4*c+(1-2*c)*(a+b)}function q(a,b,c,d){return 0===b?a:a===c?c+b:b===d?c+d+(c-a):0===a&&0<b?2*c+d+(d-b):-1}Object.defineProperty(g,"__esModule",{value:!0});var p=new f.ArrayPool(Float32Array);g.releaseGeometry=function(a){p.put(a.vertexAttributes);a.vertexAttributes=null;a.indices=null};g.elevationSampler=h;g.createSphericalGlobeTile=function(e,f,g,r,n,G,E,F,I){var x=g[0],z=g[1],B=g[2];g=g[3];
var D=.1*b.earthRadius*(g-z),C=e-1,V=e-1,U=e*e,J=p.get(5*(U+(2*C+2*V))),O=I.geometryInfo.boundingBox;c.empty(O);var P=f[2]-f[0],R=f[3]-f[1],Q=B-x,B=G[0],L=G[1];G=G[2];for(var S=0;S<=C;S++){var aa=S/C,ea=x+aa*Q;u[S]=Math.sin(ea);t[S]=Math.cos(ea);v[S]=aa;A[S]=f[0]+aa*P}x=r&&!!(E&1);P=r&&!!(E&2);for(ea=Q=0;ea<=V;ea++){var Z=ea/V,S=l.lerp(z,g,Z),da=Math.cos(S),W=Math.sin(S),ja=void 0;r?(ja=b.earthRadius/2*Math.log((1+W)/(1-W)),Z=(ja-f[1])/R):ja=180*S/Math.PI;for(S=0;S<=C;S++){var aa=v[S],ca=u[S],ba=
t[S],ha=b.earthRadius;n&&(ha+=h(A[S],ja,n)||0);ba=ba*da*ha-B;ca=ca*da*ha-L;ha=W*ha-G;k(ba,ca,ha,O);var fa=5*Q;J[fa+0]=ba;J[fa+1]=ca;J[fa+2]=ha;J[fa+3]=aa;J[fa+4]=Z;fa=q(S,ea,C,V);if(-1<fa){var fa=5*(U+fa),ia=x&&0===ea?-1:P&&ea===V?1:0,ba=0===ia?ba:-B,ca=0===ia?ca:-L,ha=0===ia?ha:b.earthRadius*ia-G;J[fa+0]=ba;J[fa+1]=ca;J[fa+2]=ha;J[fa+3]=0===ia?d(aa,Z):aa;J[fa+4]=0===ia?D:Z;0!==ia&&k(ba,ca,ha,O)}++Q}}I.geometryInfo.numVertsPerRow=e;I.geometryInfo.vertexAttributes=J;I.geometryInfo.skirtLength=D;a.vec4d.set4(0,
0,1,1,I.geometryInfo.uvOffsetAndScale);m(I.geometryInfo,e,r?E:0,F)};g.createPlanarGlobeTile=function(b,e,f,g,l,r,t){var u=e[0],v=e[1],n=e[2]-u,x=e[3]-v,z=r?Math.max(0,(r[0]-e[0])/n):0,A=r?Math.max(0,(r[1]-e[1])/x):0,B=r?Math.min(1,(r[2]-e[0])/n):1;e=r?Math.min(1,(r[3]-e[1])/x):1;var D=B>z?1/(B-z):1,C=e>A?1/(e-A):1,E=-z*D,G=-A*C,P=.1*n,R=b-1,Q=b-1,L=b*b,S=p.get(5*(L+(2*R+2*Q))),aa=t.geometryInfo.boundingBox;c.empty(aa);for(var ea=0,Z=0;Z<=Q;Z++){var da=Z/Q,W=G+da*C,da=v+da*x;r&&(da<r[1]?(da=r[1],W=
0):da>r[3]&&(da=r[3],W=1));for(var ja=0;ja<=R;ja++){var ca=ja/R,ba=E+ca*D,ca=u+ca*n;r&&(ca<r[0]?(ca=r[0],ba=0):ca>r[2]&&(ca=r[2],ba=1));var ha=f?h(ca,da,f)||0:0,ca=ca-g[0],fa=da-g[1],ha=ha-g[2];k(ca,fa,ha,aa);S[5*ea]=ca;S[5*ea+1]=fa;S[5*ea+2]=ha;S[5*ea+3]=ba;S[5*ea+4]=W;var ia=q(ja,Z,R,R);-1<ia&&(ia=5*(L+ia),S[ia]=ca,S[ia+1]=fa,S[ia+2]=ha,S[ia+3]=d(ba,W),S[ia+4]=P);++ea}}t.geometryInfo.numVertsPerRow=b;t.geometryInfo.vertexAttributes=S;t.geometryInfo.skirtLength=P;a.vec4d.set4(z,A,B-z,e-A,t.geometryInfo.uvOffsetAndScale);
m(t.geometryInfo,b,0,l)};var r=[],u=Array(e.MAX_TILE_TESSELATION+1),t=Array(e.MAX_TILE_TESSELATION+1),v=Array(e.MAX_TILE_TESSELATION+1),A=Array(e.MAX_TILE_TESSELATION+1)})},"esri/views/3d/support/ArrayPool":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a,c){void 0===c&&(c=50);this.arrayConstructor=a;this.maxPoolSizePerCount=c;this.pool={}}c.prototype.get=function(a){var c=this.pool[a];c||(c={ptr:0,data:Array(this.maxPoolSizePerCount)},
this.pool[a]=c);0<c.ptr?(a=c.data[--c.ptr],c.data[c.ptr]=null):a=new this.arrayConstructor(a);return a};c.prototype.put=function(a){var c=this.pool[a.length];c.ptr<c.data.length&&(c.data[c.ptr++]=a)};return c}();g.ArrayPool=n})},"esri/views/3d/terrain/SphericalTile":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/ObjectPool ../lib/gl-matrix ../support/earthUtils ../support/mathUtils ./Tile ./TileGeometryFactory".split(" "),function(n,g,c,a,f,b,l,e,h){function m(a,
c,e,f){e=b.earthRadius+e;var d=Math.cos(a);f[0]=Math.cos(c)*d*e;f[1]=Math.sin(c)*d*e;f[2]=Math.sin(a)*e}return function(e){function d(a,b,c,h){var g=e.call(this,d.NumSubdivisionsAtLevel)||this;g.obb=[];g.isWebMercator=!1;g.tileUp=f.vec3d.create();g.obb=Array(8);for(var k=0;8>k;k++)g.obb[k]=f.vec3d.create();void 0!==a&&g.init(a,b,c,h);return g}c(d,e);d.prototype.init=function(a,c,d,h){e.prototype.init.call(this,a,c,d,h);this.isWebMercator=h.spatialReference.isWebMercator;c=this.extentWGS84Rad[0];d=
this.extentWGS84Rad[1];h=this.extentWGS84Rad[2];var g=this.extentWGS84Rad[3];a=a[0];var k=l.lerp(d,g,.5),p=l.lerp(c,h,.5);this.edgeLen=(h-c)*Math.cos(0===a?0:Math.min(Math.abs(d),Math.abs(g)))*b.earthRadius;this.edgeLen2=this.edgeLen*this.edgeLen;this.curvatureHeight=b.earthRadius-Math.sqrt(b.earthRadius*b.earthRadius-this.edgeLen2/4);m(k,p,0,this.centerAtSeaLevel);f.vec3d.set(this.centerAtSeaLevel,this.tileUp);f.vec3d.normalize(this.tileUp);this._updateOBB();this.updateRadiusAndCenter()};d.prototype.updateRadiusAndCenter=
function(){if(0===this.lij[0])f.vec3d.set3(0,0,0,this.center),this.radius=b.earthRadius+this.elevationBounds[1];else{e.prototype.updateRadiusAndCenter.call(this);var a=Math.max(f.vec3d.dist2(this.center,this.obb[0]),f.vec3d.dist2(this.center,this.obb[1]));this.radius=Math.sqrt(a)}};d.prototype.isVisible=function(a){if(!this.intersectsClippingArea)return!1;if(9<this.lij[0]){for(var b=this.obb,c=0;6>c;c++){for(var d=void 0,d=0;8>d&&!(0>a[c][0]*b[d][0]+a[c][1]*b[d][1]+a[c][2]*b[d][2]+a[c][3]);d++);if(8===
d)return!1}return!0}b=this.radius;c=this.center;return a[0][0]*c[0]+a[0][1]*c[1]+a[0][2]*c[2]+a[0][3]>b||a[1][0]*c[0]+a[1][1]*c[1]+a[1][2]*c[2]+a[1][3]>b||a[2][0]*c[0]+a[2][1]*c[1]+a[2][2]*c[2]+a[2][3]>b||a[3][0]*c[0]+a[3][1]*c[1]+a[3][2]*c[2]+a[3][3]>b||a[4][0]*c[0]+a[4][1]*c[1]+a[4][2]*c[2]+a[4][3]>b||a[5][0]*c[0]+a[5][1]*c[1]+a[5][2]*c[2]+a[5][3]>b?!1:!0};d.prototype.computeElevationBounds=function(){e.prototype.computeElevationBounds.call(this);this._updateOBB()};d.prototype.createGeometry=function(a,
b,c){var d=this._isPole(this.lij[1],this.lij[0]);a.needsUpdate=!1;h.createSphericalGlobeTile(a.numVertsPerRow,this.extent,this.extentWGS84Rad,this.isWebMercator,a.samplerData,b,d,c,this.renderData);this.updateMemoryUsed()};d.prototype._updateOBB=function(){for(var a=this.extentWGS84Rad,c=this.obb,d=0;2>d;d++){var e=this.elevationBounds[d],h=4*d;m(a[1],a[0],e,c[h++]);m(a[3],a[0],e,c[h++]);m(a[3],a[2],e,c[h++]);m(a[1],a[2],e,c[h++])}this.isWebMercator&&(a=this._isPole(this.lij[1],this.lij[0]),2===a?
(f.vec3d.set3(0,0,b.earthRadius,c[1]),f.vec3d.set3(0,0,b.earthRadius,c[2]),f.vec3d.set3(0,0,b.earthRadius,c[5]),f.vec3d.set3(0,0,b.earthRadius,c[6])):1===a&&(f.vec3d.set3(0,0,-b.earthRadius,c[0]),f.vec3d.set3(0,0,-b.earthRadius,c[3]),f.vec3d.set3(0,0,-b.earthRadius,c[4]),f.vec3d.set3(0,0,-b.earthRadius,c[7])))};d.prototype._isPole=function(a,b){var c=0;a===(1<<b)-1&&(c+=1);0===a&&(c+=2);return c};d.NumSubdivisionsAtLevel=[128,64,32,16,16,8,8,4];d.Pool=new a(d);return d}(e)})},"esri/views/3d/terrain/SurfaceExtentHelper":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingRect ../../../geometry/support/webMercatorUtils ./TerrainConst ./terrainUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k){function d(a,b){a&&!a.spatialReference.equals(b)&&(a=h.canProject(a.spatialReference,b)?h.project(a,b):null);return a}Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function h(a){a=f.call(this,a)||this;a._changeListeners=new b;return a}c(h,f);h.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layerViews.on("change",function(){return a.notifyChange("stencilEnabledExtents")})])};h.prototype.destroy=function(){this._changeListeners.destroy();
this._changeListeners=null};Object.defineProperty(h.prototype,"layerViewsExtent",{get:function(){return this._computeLayerViewsExtent()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"tiledLayersExtent",{get:function(){return this._computeTiledLayersExtent()},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"stencilEnabledExtents",{get:function(){return this._computeStencilEnabledExtents(this.layerViews,this.spatialReference)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,
"spatialReference",{set:function(a){this.tilingScheme||this._set("spatialReference",a)},enumerable:!0,configurable:!0});Object.defineProperty(h.prototype,"tilingScheme",{set:function(a){this._set("tilingScheme",a);this._set("spatialReference",a.spatialReference)},enumerable:!0,configurable:!0});h.prototype._computeStencilEnabledExtents=function(a,b){var c=[],f=0;for(a=a.items;f<a.length;f++){var h=a[f].layer;"IntegratedMeshLayer"===h.operationalLayerType&&null!=b&&(h=d(h.fullExtent,b),null!=h&&c.push(e.fromExtent(h)))}return c};
a([l.property({readOnly:!0})],h.prototype,"layerViewsExtent",null);a([l.property({readOnly:!0,dependsOn:["spatialReference","tilingScheme"]})],h.prototype,"tiledLayersExtent",null);a([l.property({readOnly:!0,dependsOn:["spatialReference"]})],h.prototype,"stencilEnabledExtents",null);a([l.property()],h.prototype,"spatialReference",null);a([l.property()],h.prototype,"tilingScheme",null);a([l.property()],h.prototype,"defaultTiledLayersExtent",void 0);a([l.property({constructOnly:!0})],h.prototype,"layers",
void 0);a([l.property({constructOnly:!0})],h.prototype,"layerViews",void 0);return h=a([l.subclass()],h)}(l.declared(f));f=function(b){function d(){return null!==b&&b.apply(this,arguments)||this}c(d,b);d.prototype._computeLayerViewsExtent=function(){return this._getGlobalExtent()};d.prototype._computeTiledLayersExtent=function(){return this._getGlobalExtent()};d.prototype._getGlobalExtent=function(){return this.spatialReference.isWebMercator?m.WEBMERCATOR_WORLD_EXTENT:m.GEOGRAPHIC_WORLD_EXTENT};a([l.property({dependsOn:["spatialReference"]})],
d.prototype,"layerViewsExtent",void 0);return d=a([l.subclass()],d)}(l.declared(n));g.SurfaceExtentHelperGlobal=f;n=function(b){function f(){return null!==b&&b.apply(this,arguments)||this}c(f,b);f.prototype.initialize=function(){var a=this;this._changeListeners.add([this.layers.on("change",function(){return a.notifyChange("tiledLayersExtent")}),this.layerViews.on("change",function(){return a.notifyChange("layerViewsExtent")})])};f.prototype._computeLayerViewsExtent=function(){var a=e.empty(),b=this.spatialReference;
this.layerViews.forEach(function(c){c.isResolved()&&(c=c.fullExtentInLocalViewSpatialReference||c.layer.fullExtent,(c=d(c,b))&&e.expand(a,c))});var c=e.allFinite(a)?a:null,f=this._get("layerViewsExtent");return e.equals(c,f)?f:c};f.prototype._computeTiledLayersExtent=function(){var a=this.tilingScheme;if(!a)return null;var b=this.spatialReference,c=e.empty();this.layers.forEach(function(d){if(d.loaded&&k.isTiledLayer(d)){var f=k.getTiledLayerInfo(d,b,"local");d=f.tileInfo;f=f.fullExtent;d&&a.compatibleWith(d)&&
f&&f.spatialReference.equals(b)&&e.expand(c,f)}});this.defaultTiledLayersExtent&&e.expand(c,this.defaultTiledLayersExtent);var d=e.allFinite(c)?c:null,f=this._get("tiledLayersExtent");return e.equals(d,f)?f:d};return f=a([l.subclass()],f)}(l.declared(n));g.SurfaceExtentHelperLocal=n})},"esri/views/3d/terrain/SurfaceTilingSchemeLogic":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators ./terrainUtils ./TilingScheme".split(" "),
function(n,g,c,a,f,b,l,e,h){return function(f){function g(a){a=f.call(this,a)||this;a._changeHandles=new b;return a}c(g,f);g.prototype.initialize=function(){var a=this;this._changeHandles.add(this.layers.on("change",function(){return a._update()}));this._changeHandles.add(this.extentHelper.watch("layerViewsExtent",function(){return a._setAdHocTilingScheme()}));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};g.prototype.destroy=function(){this._changeHandles.destroy();this._changeHandles=
null};g.prototype._update=function(){var a=this;this._waitTask=null;if(!this.tilingSchemeLocked){this._set("tilingSchemeDone",!1);var b=this.layers.find(function(b){return e.isTiledLayer(b)?b.isFulfilled()?b.isRejected()?!1:!!e.getTiledLayerInfo(b,a.viewSpatialReference,a.manifold).tileInfo:!0:!1});if(b)if(b.isResolved()){var c=e.getTiledLayerInfo(b,this.viewSpatialReference,this.manifold).tileInfo,c=new h(c),b=e.getKnownTiledServiceLevelCap(b.url);Infinity>b&&c.capMaxLod(b);this._set("tilingSchemeDone",
!0);this._lockTilingScheme(c)}else this._updateWhen(b);else this._set("tilingSchemeDone",!0)}};g.prototype._updateWhen=function(a){var b=this,c=a.when().always(function(){c===b._waitTask&&b._update()});this._waitTask=c};g.prototype._lockTilingScheme=function(a){var b=this;if("spherical"===this.manifold){var c=a.levels.length-1;a=a.spatialReference.isWebMercator?h.makeWebMercatorAuxiliarySphere(c):h.makeWGS84WithTileSize(a.pixelSize[0],c)}this.tilingSchemeLocked=!0;this.tilingScheme=a;this.extentHelper.tilingScheme=
this.tilingScheme;this._updateTiledLayerExtent();this._changeHandles.removeAll();this._changeHandles.add(this.extentHelper.watch("tiledLayersExtent",function(){return b._updateTiledLayerExtent()}))};g.prototype._updateTiledLayerExtent=function(){this.extent=this.extentHelper.tiledLayersExtent};g.prototype._setAdHocTilingScheme=function(){if("spherical"===this.manifold)this.tilingScheme=this.extentHelper.spatialReference.isWebMercator?h.WebMercatorAuxiliarySphere:h.makeWGS84WithTileSize(256),this.extent=
this.extentHelper.layerViewsExtent;else{var a=this.extentHelper.layerViewsExtent;a&&(this.tilingScheme=h.fromExtent(a,this.extentHelper.spatialReference),this.extent=a)}};a([l.property()],g.prototype,"tilingScheme",void 0);a([l.property()],g.prototype,"extent",void 0);a([l.property({value:!1})],g.prototype,"tilingSchemeLocked",void 0);a([l.property({readOnly:!0,value:!1})],g.prototype,"tilingSchemeDone",void 0);a([l.property({constructOnly:!0})],g.prototype,"viewSpatialReference",void 0);a([l.property({constructOnly:!0})],
g.prototype,"layers",void 0);a([l.property({constructOnly:!0})],g.prototype,"extentHelper",void 0);a([l.property({constructOnly:!0})],g.prototype,"manifold",void 0);return g=a([l.subclass()],g)}(l.declared(f))})},"esri/views/3d/terrain/TerrainRenderer":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../Color ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../geometry/support/aaBoundingBox ../lib/gl-matrix ../support/imageUtils ./ResourceCounter ./TerrainConst ./TileGeometryFactory ./TileRenderData ./TileRenderer ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/tracer ../webgl-engine/lib/Util ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainRendererPrograms ../../webgl/BufferObject ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K){function N(a){return function(b,c){b=b.screenDepth;c=c.screenDepth;return b<c?-a:b>c?a:0}}function H(a){var b=N(a);return function(c,d){return 0===c.tiles.length?-a:0===d.tiles.length?a:b(c.tiles.data[0],d.tiles.data[0])}}var M=C.assert,T=h.mat4d.identity(),V=x.OPAQUE_TERRAIN,U=x.TRANSPARENT_TERRAIN,J=h.vec3d.create(),O=h.vec2d.create(),P=e.create(),R=h.vec4d.create(),Q=h.vec4d.create(),L=h.vec4d.create(),S=function(){return function(){this.extent=
h.vec4d.create();this.maxLevel=this.minLevel=0;this.callback=null}}();n=function(){function c(a,c){this.initialized=!1;this.rctx=null;this.renderDataPool=new f(p.TileRenderData);this.perOriginTileData=new b({initialSize:10,allocator:function(){return{root:null,origin:null,tiles:new b({initialSize:300})}}});this.perOriginTileDataDirty=!0;this.tileIterator=new u.IteratorPreorder;this.highestVisibleLODTile=null;this.visible=!0;this.debugScreenSizePerspective=!1;this.wireframe=G.copyParameters(aa);this._opaque=
!0;this._skirtScale=1;this._cullBackFaces=this._disableRendering=this._drawBorders=!1;this._renderOrder=1;this._velvetOverground=!0;this._hasOverlays=!1;this.castShadows=!0;this.receiveShadows=!1;this.backgroundPromise=this.tileRenderer=this.emptyTex=null;this.tileBackgroundInitialized=!1;this.stencilEnabledLayerExtents=[];this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=this.numTrianglesRendered=0;this.resourceCounter=new k;this.loaded=this.clippingExtent=null;this._loaded=!1;this.needsRender=
!0;this.needsHighlight=this.didRender=!1;this.visibleScaleRangeQueries=new b({initialSize:10});this.visibleScaleRangeQueriesInvPtr=0;this.visibleScaleRangeQueryQueue=new b({initialSize:30});this.visibleScaleRangeQueryPool=new f(S,!1);this.manifold=a;this.tileSize=c||256}c.prototype.destroy=function(a){this.uninstall(a);this.backgroundPromise&&(this.backgroundPromise.cancel(),this.backgroundPromise=null)};c.prototype.install=function(a){a.addRenderPlugin([V,U],this);this.drapedRenderer=a.getDrapedTextureRenderer()};
c.prototype.uninstall=function(a){a.removeRenderPlugin(this)};Object.defineProperty(c.prototype,"disableRendering",{set:function(a){this._disableRendering=!!a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"opaque",{set:function(a){this._opaque=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"skirtScale",{set:function(a){this._skirtScale=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,
"drawBorders",{set:function(a){this._drawBorders!==a&&(this._drawBorders=a,this._updatePrograms())},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"cullBackFaces",{set:function(a){this._cullBackFaces=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"renderOrder",{set:function(a){this._renderOrder=a;this.setNeedsRender()},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"velvetOverground",{set:function(a){this._velvetOverground!==
a&&(this._velvetOverground=a,this._updatePrograms())},enumerable:!0,configurable:!0});c.prototype.setRootTiles=function(a){this.rootTiles=a;this.setNeedsRender()};c.prototype.setNeedsHighlight=function(a){this.needsHighlight=a;this.setNeedsRender()};c.prototype.setStencilEnabledLayerExtents=function(a){this.stencilEnabledLayerExtents=a;this.setNeedsRender()};c.prototype.setTileSize=function(a){this.tileSize=a;this.tileRenderer&&(this.tileRenderer.tileSize=a);this.setNeedsRender()};c.prototype.loadTile=
function(a){M(null===a.renderData);a.renderData=this.renderDataPool.acquire();a.renderData.init();var b=this.getLocalOriginOfTile(a);a.createGeometry(a.renderData.updateGeometryState(a),b,"debug"===this.wireframe.mode);a.renderData.localOrigin=b;this._updateTileGeometryBuffers(a);this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};c.prototype.queryVisibleLevelRange=function(a,b,c,d){var e=this.visibleScaleRangeQueryPool.acquire();h.vec4d.set(a,e.extent);e.minLevel=b?b:-Number.MAX_VALUE;
e.maxLevel=null!=c?c:Number.MAX_VALUE;e.callback=d;this.visibleScaleRangeQueryQueue.push(e);this.setNeedsRender()};c.prototype.updateTileTexture=function(a){this.tileRenderer&&this.tileBackgroundInitialized&&this.tileRenderer.updateTileTexture(a)};c.prototype.updateTileGeometry=function(a){a.renderData.updateGeometryState(a);for(var b=a.renderData.geometryState,c=a.layerInfo[d.LayerClass.ELEVATION],e=0;e<c.length;e++)c[e].pendingUpdates&=~d.TileUpdateTypes.UPDATE_GEOMETRY;return b.needsUpdate?(a.renderData.vao&&
this._releaseTileGeometry(a),a.createGeometry(b,a.renderData.localOrigin,"debug"===this.wireframe.mode),this._updateTileGeometryBuffers(a),!0):!1};c.prototype.unloadTile=function(a){this._releaseTileGeometry(a);a.renderData.texture&&a.renderData.texture.dispose();this.renderDataPool.release(a.renderData);a.renderData=null;a.updateMemoryUsed()};c.prototype.getLocalOriginOfTile=function(a){if(10<=a.lij[0]){for(;7<a.lij[0];)a=a.parent;return a.centerAtSeaLevel}if("spherical"===this.manifold)return J;
for(;a.parent;)a=a.parent;return a.centerAtSeaLevel};c.prototype.setVisibility=function(a){this.visible=a;this.setNeedsRender()};c.prototype.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numTrianglesRendered:this.numTrianglesRendered,numOriginsRendered:this.numOriginsRendered}};c.prototype.getWireframeEnabled=function(){return"shader"===this.wireframe.mode};c.prototype.setDebugScreenSizePerspective=function(a){a!==this.debugScreenSizePerspective&&
(this.debugScreenSizePerspective=a,this._updatePrograms())};c.prototype.setWireframe=function(a){var b=this;if(!1===a||!0===a)a={mode:a?"shader":"none"};var c=this.wireframe;if(void 0!==a.mode&&c.mode!==a.mode){var d="debug"===c.mode,e="debug"===a.mode;c.mode=a.mode;this._updatePrograms();d!==e&&this.rootTiles&&u.traverseTilesPreorder(this.rootTiles,function(a){a.renderData&&(a.renderData.vao&&b._releaseTileGeometry(a),a.createGeometry(a.renderData.updateGeometryState(a),a.renderData.localOrigin,
e),b._updateTileGeometryBuffers(a))})}for(var f in a)c.hasOwnProperty(f)&&(c[f]=a[f]),this.setNeedsRender();c.resolution&&(c.resolution=Math.min(c.resolution,this.tileSize),c.resolution=1<<Math.round(Math.log(c.resolution)/Math.LN2))};c.prototype.setNeedsRender=function(){this.needsRender=!0;this.didRender=!1;this.perOriginTileDataDirty=!0};c.prototype.resetNeedsRender=function(){this.didRender&&(this.needsRender=0!==this.visibleScaleRangeQueryQueue.length,this.didRender=!1)};c.prototype.isOpaque=
function(){var a=this.wireframe,a="shader"===a.mode&&(1>a.wireOpacity||1>a.surfaceOpacity);return this._opaque&&!a};c.prototype.updateTileBackground=function(b){this.backgroundPromise&&this.backgroundPromise.cancel();this.backgroundPromise="string"===typeof b?m.requestImage(b).catch(function(){return null}):null!=b?l.resolve(a.toUnitRGBA(b)):l.resolve(null);this._renderTileBackground()};c.prototype.initializeRenderContext=function(a){var b=this,c=this.rctx=a.rctx;a=this.programRep=a.programRep;var d=
function(a){l.when(a).then(function(){b.initialized=!0;b.setNeedsRender()}).catch(d)};d(this._renderTileBackground());this.programs={color:null,normal:null,depth:null,depthShadowMap:null,highlight:null};this._updatePrograms();this.tileRenderer=new r(c,this.tileSize,a,this.resourceCounter,this.setNeedsRender.bind(this));this._renderTileBackground();this.emptyTex=A.createEmptyTexture(c)};c.prototype.uninitializeRenderContext=function(a){null!=this.emptyTex&&(this.emptyTex.dispose(),this.emptyTex=null);
this.tileRenderer&&(this.tileRenderer.dispose(),this.tileRenderer=null)};c.prototype.render=function(a){var b=a.rctx,c=b.gl;if(!this.initialized||this._disableRendering||!this.visible||!this.rootTiles||!this.tileBackgroundInitialized)return!1;var d=this.isOpaque()?V:U;if(a.slot!==d)return!1;D.trace("# BEGIN RENDER TERRAIN");d=a.pass;b.setFaceCullingEnabled(this._cullBackFaces);var e=1===a.lightingData.helper.globalFactor;d===z.MATERIAL?this._renderMaterialPass(a,this._updatePerOriginTileData()):d===
z.MATERIAL_DEPTH_SHADOWMAP&&this.castShadows&&e?this._renderDepthPass(a,this.programs.depthShadowMap,this._updatePerOriginTileData()):d===z.MATERIAL_DEPTH?this._renderDepthPass(a,this.programs.depth,this._updatePerOriginTileData()):d===z.MATERIAL_NORMAL?this._renderNormalPass(a,this._updatePerOriginTileData()):d===z.MATERIAL_HIGHLIGHT&&this.needsHighlight&&(this._renderHighlightPass(a,this._updatePerOriginTileData()),b.clear(c.DEPTH_BUFFER_BIT));this._cullBackFaces&&b.setFaceCullingEnabled(!1);D.trace("# END RENDER TERRAIN");
return!0};c.prototype.intersect=function(a,b,c,d){if(this.rootTiles&&(!a.isSelection||this.isOpaque())&&a.enableTerrain){var f=Z,g=da;h.vec3d.subtract(c,b,f);h.vec3d.set3(1/f[0],1/f[1],1/f[2],g);var k=a.minResult,l=a.maxResult,m=this.clippingExtent,p=this.tileIterator;p.reset(this.rootTiles);d=function(){var d=p.next();if(null===d.renderData)return"continue";if(a.enableInvisibleTerrain){if(!d.visible&&m&&!d.intersectsExtent(m))return"continue"}else if(!d.visible)return"continue";var r=d.renderData.geometryInfo,
t=d.renderData.localOrigin,v=W;h.vec3d.subtract(b,t,v);var n=-q._skirtScale*r.skirtLength;if(0!==n){var x=d.tileUp;e.offset(r.boundingBox,n*x[0],n*x[1],n*x[2],P);e.expandWithBuffer(P,r.boundingBox,0,2)}if(!G.intersectAabbInvDir(0!==n?P:r.boundingBox,v,g,a.tolerance))return"continue";var x=function(b,c,e){if(0<=b&&(a.enableBackfacesTerrain||0>h.vec3d.dot(c,f))){e=void 0;if(void 0===k.dist||b<k.dist)e=u.tile2str(d),k.set(void 0,e,b,c,void 0),k.setIntersector("TerrainRenderer");if(void 0===l.dist||b>
l.dist)e=u.tile2str(d),l.set(void 0,e,b,c,void 0),l.setIntersector("TerrainRenderer")}},z=ja;h.vec3d.subtract(c,t,z);var t=r.indices,L={data:r.vertexAttributes,size:3,offsetIdx:0,strideIdx:5},r=r.numWithoutSkirtIndices/3;G.intersectTriangles(v,z,0,r,t,L,null,x);0!==n&&u.intersectSkirts(v,z,r,t.length/3,t,L,null,"spherical"===q.manifold?function(a){return h.vec3d.scale(a,n/h.vec3d.length(a))}:function(a){return h.vec3d.set3(0,0,n,a)},x)};for(var q=this;!p.done;)d()}};c.prototype._renderTileBackground=
function(){var a=this;if(this.rctx&&this.backgroundPromise&&this.tileRenderer)return this.backgroundPromise.then(function(b){a.tileRenderer&&(a.tileBackgroundInitialized=!0,a.tileRenderer.setBackground(b),a.rootTiles&&u.traverseTilesPreorder(a.rootTiles,function(b){a.tileRenderer.updateTileTexture(b)}))})};c.prototype._updatePrograms=function(){var a="spherical"===this.manifold,b=a?"global":"local",c="shader"===this.wireframe.mode,d=this.programRep;this.programs.color=d.getProgram(E.colorPass,{viewingMode:b,
mode:c||this._drawBorders?"wireframe":"normal",spherical:a,overlay:this._hasOverlays,atmosphere:a&&this._velvetOverground,wireframeTexture:c,tileBorders:this._drawBorders,receiveShadows:this.receiveShadows,screenSizePerspective:this.debugScreenSizePerspective});this.programs.normal=d.getProgram(E.normalPass,{viewingMode:b,spherical:a,alphaZero:!0});this.programs.depth=d.getProgram(E.depthPass,{viewingMode:b,spherical:a,shadowMap:!1});this.programs.depthShadowMap=d.getProgram(E.depthPass,{viewingMode:b,
spherical:a,shadowMap:!0});this.programs.highlight=d.getProgram(E.highlightPass,{viewingMode:b,spherical:a});this.setNeedsRender()};c.prototype._renderMaterialPass=function(a,b){var c=this,d=a.shadowMap&&a.shadowMap.enabled,e=a.rctx;this.receiveShadows!==d&&(this.receiveShadows=d,this._updatePrograms());d=!this.drapedRenderer.isEmpty();d!==this._hasOverlays&&(this._hasOverlays=d,this._updatePrograms());d=a.camera;e.setDepthTestEnabled(!0);var f=this.wireframe,g=this.programs.color;e.bindProgram(g);
if("shader"===f.mode||this._drawBorders)g.setUniform1f("wireframe.width",this.wireframe.width),g.setUniform1f("wireframe.falloff",Math.min(f.width,f.falloff)),g.setUniform1f("wireframe.wireOpacity",f.wireOpacity),g.setUniform1f("wireframe.surfaceOpacity",f.surfaceOpacity),g.setUniform4fv("wireframe.color",f.color);a.shadowMap&&a.shadowMap.bind(g);a.ssaoHelper&&a.ssaoHelper.setUniforms(g);g.setUniform1i("tex",0);g.setUniform1i("overlay0Tex",1);g.setUniform1i("overlay1Tex",2);g.setUniformMatrix4fv("viewNormal",
d.viewInverseTransposeMatrix);g.setUniformMatrix4fv("proj",d.projectionMatrix);a.lightingData.helper.setUniforms(g,!0);e=d.viewMatrix;h.vec3d.set3(e[12],e[13],e[14],ea);h.vec3d.normalize(ea);g.setUniform3fv("viewDirection",ea);this.numOriginsRendered=this.numTrianglesRendered=this.numTilesCulled=this.numTilesRendered=0;this._prepareScaleRangeQueries();this.isOpaque()?this._renderTiles(a,g,b):a.offscreenRenderingHelper.renderToTargets(function(){return c._renderTiles(a,g,b)},a.offscreenRenderingHelper.tmpColor,
a.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._processScaleRangeQueries();0<this.numTilesRendered&&!this._loaded&&(this._loaded=!0,this.loaded&&this.loaded())};c.prototype._renderDepthPass=function(a,b,c){var d=a.rctx,e=a.camera;d.bindProgram(b);d.setBlendingEnabled(!1);d.setDepthTestEnabled(!0);b.setUniformMatrix4fv("model",T);b.setUniformMatrix4fv("viewNormal",e.viewInverseTransposeMatrix);O[0]=e.near;O[1]=e.far;b.setUniform2fv("nearFar",O);this._renderTilesAuxiliary(a,b,c,!1)};c.prototype._renderNormalPass=
function(a,b){var c=a.rctx,d=a.camera,e=this.programs.normal;c.bindProgram(e);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);e.setUniformMatrix4fv("viewNormal",d.viewInverseTransposeMatrix);this._renderTilesAuxiliary(a,e,b,!1)};c.prototype._renderHighlightPass=function(a,b){var c=a.rctx,d=this.programs.highlight;c.bindProgram(d);c.setBlendingEnabled(!1);c.setDepthTestEnabled(!0);var e=a.offscreenRenderingHelper;c.bindTexture(e.depthTexture,3);d.setUniform1i("depthTex",3);d.setUniform4f("highlightViewportPixelSz",
0,0,1/e.width,1/e.height);this._renderTilesAuxiliary(a,d,b,!0)};c.prototype._updatePerOriginTileData=function(){var a=this.perOriginTileData;if(!this.perOriginTileDataDirty)return a;this.highestVisibleLODTile=null;this._renderCollectOrigins();if(0!==this._renderOrder){for(var b=N(this._renderOrder),c=0;c<a.length;c++)this._sortFrontToBack(a.data[c].tiles,b);b=H(this._renderOrder);this._sortFrontToBack(a,b)}this.perOriginTileDataDirty=!1;return a};c.prototype._renderCollectOrigins=function(){var a=
this.perOriginTileData,b=this.rootTiles,c="spherical"===this.manifold;a.clear();for(var d=0;d<b.length;d++){var e=b[d],f=a.pushNew();f.root=e;f.origin=c?J:e.centerAtSeaLevel;f.tiles.clear();this._renderCollectOriginsForRoot(f)}return!0};c.prototype._renderCollectOriginsForRoot=function(a){var b=this.tileIterator,c=this.perOriginTileData;for(b.resetOne(a.root);!b.done;){var d=b.next(),e=d.renderData;if(e&&!d.visible)this.numTilesCulled++,b.skipSubtree();else{var f=c.back();if(7===d.lij[0]){if(f===
a||0!==f.tiles.length)f=c.pushNew(),f.tiles.clear();f.root=d;f.origin=d.centerAtSeaLevel}if(e){10<=d.lij[0]?c.back().tiles.push(d):a.tiles.push(d);if(!this.highestVisibleLODTile||d.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=d;b.skipSubtree()}}}};c.prototype._sortFrontToBack=function(a,b){a.sort(b)};c.prototype._scaleQueriesForTile=function(a){var b=a.extent;a=a.lij[0];for(var c=0;c<this.visibleScaleRangeQueriesInvPtr;){var d=this.visibleScaleRangeQueries.data[c],e=d.extent;
a>=d.minLevel&&a<=d.maxLevel&&e[0]<=b[2]&&e[2]>=b[0]&&e[1]<=b[3]&&e[3]>=b[1]?(this.visibleScaleRangeQueries.swapElements(c,this.visibleScaleRangeQueriesInvPtr-1),this.visibleScaleRangeQueriesInvPtr--):c++}};c.prototype._updateStencilReadStateForTile=function(a,b){if(a.stencilRenderingHelper&&a.stencilRenderingHelper.enabled){for(var c=this.stencilEnabledLayerExtents,d=!1,e=0;e<c.length;e++)if(b.intersectsExtent(c[e])){d=!0;break}d?a.stencilRenderingHelper.enableStencilRead():a.stencilRenderingHelper.disableStencilRead()}};
c.prototype._renderTilesAuxiliary=function(a,b,c,d){var e=a.rctx,f=e.gl,h=a.camera,g=h.viewMatrix;b.setUniformMatrix4fv("proj",h.projectionMatrix);b.setUniform1f("skirtScale",this._skirtScale);d&&(b.setUniform1i("overlay0Tex",1),b.setUniform1i("overlay1Tex",2));for(h=0;h<c.length;h++){var k=c.data[h];b.setUniform3fv("origin",k.origin);G.bindView(k.origin,g,b);for(var l=0;l<k.tiles.length;l++){var m=k.tiles.data[l],p=m.renderData;d&&(this._bindOverlayTextures(b,p.overlays,!0),b.setUniform1f("overlayOpacity",
p.overlayOpacity));this._updateStencilReadStateForTile(a,m);e.bindVAO(p.vao);I.assertCompatibleVertexAttributeLocations(p.vao,b);e.drawElements(f.TRIANGLES,0!==this._skirtScale?p.vao.indexBuffer.size:p.geometryInfo.numWithoutSkirtIndices,p.vao.indexBuffer.indexType,0)}}e.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};c.prototype._renderTiles=function(a,b,c){var d=a.rctx,e=d.gl,f=a.camera,g=f.viewMatrix;if(this.debugScreenSizePerspective&&this.pointsOfInterest){var k=
B.getSettings("spherical"===this.manifold?"global":"local");k.update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:f.fovY});G.bindScreenSizePerspective(k,a,b,"screenSizePerspective")}b.setUniform1f("skirtScale",this._skirtScale);for(f=0;f<c.length;f++)if(k=c.data[f],b.setUniform3fv("origin",k.origin),G.bindView(k.origin,g,b),a.shadowMap&&a.shadowMap.bindView(b,k.origin),this.numOriginsRendered++,k=k.tiles,0!==k.length){var l="debug"===this.wireframe.mode?e.LINES:e.TRIANGLES,
m=this.highestVisibleLODTile,p=void 0,q=void 0;m?(p=m.vlevel,q=this.tileSize/this.wireframe.resolution):(p=16,q=this.tileSize/64);for(m=0;m<k.length;m++){var r=k.data[m],t=r.renderData;this._updateStencilReadStateForTile(a,r);D.trace("# RENDER TILE "+u.tile2str(r)+", screenDepth:"+r.screenDepth);var v=t.geometryInfo.uvOffsetAndScale,n=t.texOffsetAndScale;h.vec4d.set4(v[0]*n[2]+n[0],v[1]*n[3]+n[1],v[2]*n[2],v[3]*n[3],L);b.setUniform4fv("texOffsetAndScale",L);d.bindTexture(t.textureReference||t.texture,
0);b.setUniform1f("opacity",t.opacity);this._bindOverlayTextures(b,t.overlays,!1);b.setUniform1f("overlayOpacity",t.overlayOpacity);("shader"===this.wireframe.mode||this._drawBorders)&&b.setUniform1f("wireframe.subdivision",q*(1<<p-r.vlevel));v=0!==this._skirtScale?t.vao.indexBuffer.size:t.geometryInfo.numWithoutSkirtIndices;d.bindVAO(t.vao);I.assertCompatibleVertexAttributeLocations(t.vao,b);d.drawElements(l,v,t.vao.indexBuffer.indexType,0);r.renderOrder=this.numTilesRendered;this.numTilesRendered++;
this.numTrianglesRendered+=v/3;this._scaleQueriesForTile(r)}}d.bindVAO(null);a.stencilRenderingHelper&&a.stencilRenderingHelper.disableStencilRead()};c.prototype._bindOverlayTextures=function(a,b,c){for(var d=0;2>d;d++){var e=2*d,f=b[d],h=c?f.highlightRenderTargetId:f.renderTargetId;h?(h=this.drapedRenderer.getRenderTargetTexture(h),R[e]=f.texOffset[0],R[e+1]=f.texOffset[1],Q[e]=f.texScale[0],Q[e+1]=f.texScale[1],this.rctx.bindTexture(h,1+d)):(R[e]=0,R[e+1]=0,Q[e]=0,Q[e+1]=0,this.rctx.bindTexture(this.emptyTex,
1+d))}a.setUniform4fv("overlayTexOffset",R);a.setUniform4fv("overlayTexScale",Q)};c.prototype._updateTileGeometryBuffers=function(a){var b=this.rctx,c=b.gl;a=a.renderData;var d=a.geometryInfo.indices;a.vao=new K(b,t.Default3D,{geometry:v.Pos3Tex},{geometry:F.createVertex(b,c.STATIC_DRAW,a.geometryInfo.vertexAttributes)},F.createIndex(b,c.STATIC_DRAW,d));this.setNeedsRender()};c.prototype._releaseTileGeometry=function(a){a=a.renderData;a.vao.dispose(!0);a.vao=null;q.releaseGeometry(a.geometryInfo);
this.setNeedsRender()};c.prototype._prepareScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryQueue;a.length<a.data.length&&0<b.length;){var c=b.pop();a.push(c)}this.visibleScaleRangeQueriesInvPtr=a.length};c.prototype._processScaleRangeQueries=function(){for(var a=this.visibleScaleRangeQueries,b=this.visibleScaleRangeQueryPool,c=0;c<a.length;c++){var d=a.data[c];b.release(d);d.callback(c>=this.visibleScaleRangeQueriesInvPtr);d.callback=null}a.clear()};
return c}();var aa={mode:"none",width:1.5,falloff:1.5,wireOpacity:1,surfaceOpacity:0,color:[1,1,1,0],resolution:64},ea=h.vec3d.create(),Z=h.vec3d.create(),da=h.vec3d.create(),W=h.vec3d.create(),ja=h.vec3d.create();return n})},"esri/views/3d/terrain/ResourceCounter":function(){define(["require","exports"],function(n,g){return function(){function c(){this._numTileTexturesComposited=0}Object.defineProperty(c.prototype,"numTileTexturesComposited",{get:function(){return this._numTileTexturesComposited},
enumerable:!0,configurable:!0});c.prototype.incrementNumTileTexturesComposited=function(){this._numTileTexturesComposited++};c.prototype.resetNumTileTexturesComposited=function(){this._numTileTexturesComposited=0};return c}()})},"esri/views/3d/terrain/TileRenderData":function(){define(["require","exports","../../../geometry/support/aaBoundingBox","../lib/gl-matrix"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function f(){this.overlayTexOffset=a.vec2d.create();
this.texOffsetAndScale=a.vec4d.create();this.geometryInfo={indices:null,vertexAttributes:null,boundingBox:c.empty(),numSurfaceIndices:0,numSkirtIndices:0,numWithoutSkirtIndices:0,numVertsPerRow:0,skirtLength:0,uvOffsetAndScale:a.vec4d.create()};this.init()}f.prototype.init=function(){var b=this.geometryInfo;b.indices=null;b.vertexAttributes=null;c.empty(b.boundingBox);b.numSurfaceIndices=0;b.numSkirtIndices=0;b.numWithoutSkirtIndices=0;b.numVertsPerRow=0;this.textureReference=this.texture=this.vao=
this.geometryState=null;a.vec4d.set4(0,0,1,1,this.texOffsetAndScale);this.opacity=1;if(this.overlays)for(var b=0,f=this.overlays;b<f.length;b++){var e=f[b];e.renderTargetId=null;e.highlightRenderTargetId=null;a.vec2d.set2(1,1,e.texScale);a.vec2d.set2(0,0,e.texOffset)}else for(this.overlays=[null,null],b=0;2>b;b++)this.overlays[b]={renderTargetId:null,highlightRenderTargetId:null,texScale:[1,1],texOffset:[0,0]};this.overlayOpacity=1;this.localOrigin=null};f.prototype.updateGeometryState=function(a){return this.geometryState=
a.geometryState(this.geometryState)};f.prototype.estimateGeometryMemoryUsage=function(){var a=this.geometryInfo;return a.indices.byteLength+a.vertexAttributes.byteLength};return f}();g.TileRenderData=n})},"esri/views/3d/terrain/TileRenderer":function(){define("require exports ../lib/gl-matrix ./TerrainConst ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../webgl-engine/shaders/MiscPrograms ../../vectorTiles/tileRendererHelper3D ../../vectorTiles/VectorTileDisplayObject ../../webgl/BufferObject ../../webgl/FramebufferObject ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){function u(a){return a instanceof HTMLImageElement||a instanceof HTMLCanvasElement}var t=Array(20),v=[0,0];return function(){function g(a,c,d,h,g){this._blackTex=this._backgroundTex=null;this.tileSize=256;this._context=a;this.tileSize=c;this._resourceCounter=h;this._setNeedsRender=g;a.capabilities.textureFilterAnisotropic&&(this._maxAnisotropy=Math.min(8,a.parameters.maxMaxAnisotropy));c=new Float32Array(20);c[0]=-1;c[1]=-1;c[2]=0;c[3]=0;c[4]=0;c[5]=1;c[6]=
-1;c[7]=0;c[8]=1;c[9]=0;c[10]=-1;c[11]=1;c[12]=0;c[13]=0;c[14]=1;c[15]=1;c[16]=1;c[17]=0;c[18]=1;c[19]=1;this._vaoQuad=new r(a,f.Default3D,{geometry:b.Pos3Tex},{geometry:k.createVertex(a,35044,c)});this._blendLayersProgram=d.getProgram(e.blendLayers);this._blackTex=l.createColorTexture(this._context,[0,0,0,1])}g.prototype.dispose=function(){this._fbo&&(this._fbo.dispose(),this._fbo=null);this._vtFBO&&(this._vtFBO.dispose(),this._vtFBO=null);this._vaoQuad&&(this._vaoQuad.dispose(),this._vaoQuad=null);
this._backgroundTex&&(this._backgroundTex.dispose(),this._backgroundTex=null);this._blackTex&&(this._blackTex.dispose(),this._blackTex=null);this._blendLayersProgram&&(this._blendLayersProgram.dispose(),this._blendLayersProgram=null);this._context&&(this._context=null)};g.prototype.updateTileTexture=function(b){for(var d=a.LayerClass.MAP,e=b.layerInfo[d],f=0;f<e.length;f++)e[f].pendingUpdates&=~a.TileUpdateTypes.UPDATE_TEXTURE;if(b.renderData){for(var f=b.renderData,h=b.parentSurface,g=h.baseOpacity,
k=0,l=!1,m=e.length-1,p=e.length,r=0;r<e.length;r++){var v=e[r],n=h.layerViewByIndex(r,d),z=n.fullOpacity;t[r]=z;this._isBaseLayer(n.layer)&&p>=e.length&&(p=r);if(v.data||v.upsampleFromTile)if(k++,n.isOpaque&&1===z){l=!0;m=r;break}}0===k&&this._backgroundTex?(f.opacity=g,f.textureReference=this._backgroundTex,c.vec4d.set4(0,0,1,1,f.texOffsetAndScale)):1===k&&l?(v=e[m],h=e=void 0,v.data?(e=v,c.vec4d.set4(0,0,1,1,f.texOffsetAndScale)):(h=v.upsampleFromTile,e=h.tile.layerInfo[d][m],c.vec4d.set4(h.offset[0],
h.offset[1],h.scale,h.scale,f.texOffsetAndScale)),f.opacity=g,e&&(u(e.data)&&(e.data=this._buildTexture(e.data),h?h.tile.updateMemoryUsed():b.updateMemoryUsed()),e.data instanceof q&&(f.textureReference=e.data))):(f.opacity=this._composeMapLayers(b,e,m,p,l,t),f.textureReference=null,c.vec4d.set4(0,0,1,1,f.texOffsetAndScale));this._setNeedsRender()}};g.prototype.setBackground=function(a){u(a)?this._backgroundTex=this._buildTexture(a):this._backgroundTex=l.createColorTexture(this._context,a||[0,0,0,
0])};g.prototype._buildTexture=function(a){var b={target:3553,pixelFormat:6408,dataType:5121,wrapMode:33071,samplingMode:9729,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0},c=this._context,d;if(a)try{d=new q(c,b,a)}catch(C){d=l.createEmptyTexture(c),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}else b.width=b.height=this.tileSize,d=new q(c,b);c.bindTexture(d);d.generateMipmap();return d};g.prototype._bindFBO=function(a,b,c,e){a&&a.width===
b&&a.height===c||(a&&a.dispose(),a=d.create(this._context,{colorTarget:0,depthStencilTarget:e?1:0,width:b,height:c}));this._context.bindFramebuffer(a);return a};g.prototype._drawRasterData=function(a,b,c,d){void 0===d&&(d=1);var e=this._context,f=this._blendLayersProgram,h=this._vaoQuad;e.bindProgram(f);e.bindVAO(h);p.assertCompatibleVertexAttributeLocations(h,f);e.bindTexture(a,0);f.setUniform1i("tex",0);f.setUniform1f("scale",b);f.setUniform2f("offset",c[0],c[1]);f.setUniform1f("opacity",d);e.drawArrays(5,
0,p.vertexCount(h,"geometry"))};g.prototype._composeMapLayers=function(b,c,d,e,f,g){b.renderData.texture||(b.renderData.texture=this._buildTexture(),b.updateMemoryUsed());var k=a.LayerClass.MAP,l=b.renderData.texture,p=this._context;this._fbo=this._bindFBO(this._fbo,l.descriptor.width,l.descriptor.height,!1);var r=p.gl;p.setViewport(0,0,this.tileSize,this.tileSize);p.setClearColor(0,0,0,0);p.setClearDepth(1);p.clear(r.COLOR_BUFFER_BIT);p.setDepthTestEnabled(!1);p.setBlendFunction(1,771);p.setBlendEquation(32774);
p.setBlendingEnabled(!0);!f&&this._backgroundTex&&this._drawRasterData(this._backgroundTex,1,v);f=b.parentSurface.baseOpacity;for(var t=!1;0<=d;d--){var n=c[d],x=n,z=b.lij,A=v,B=1;!n.data&&n.upsampleFromTile&&(B=n.upsampleFromTile,z=B.tile.lij,x=B.tile.layerInfo[k][d],A=[B.offset[0],B.offset[1]],B=B.scale);if(x){d<e&&1>f&&!t&&(p.setBlendFunction(0,770),this._drawRasterData(this._blackTex,1,v,f),p.setBlendFunction(1,771),t=!0);if(x.data instanceof m){var D=b.parentSurface.layerViewByIndex(d,k);this._vtFBO=
this._bindFBO(this._vtFBO,this.tileSize,this.tileSize,!0);p.setClearColor(1,1,1,0);p.clear(r.COLOR_BUFFER_BIT|r.DEPTH_BUFFER_BIT);h(this._context,z,x.data,D.renderer,D.schemaHelper,l.descriptor.width,l.descriptor.height);x.data.dispose();x.data=this._buildTexture();p.bindTexture(x.data);r.copyTexImage2D(p.gl.TEXTURE_2D,0,x.data.descriptor.pixelFormat,0,0,this.tileSize,this.tileSize,0);x.data.generateMipmap();p.bindFramebuffer(this._fbo);x===n?b.updateMemoryUsed():n.upsampleFromTile.tile.updateMemoryUsed()}else u(x.data)&&
(x.data=this._buildTexture(x.data),x===n?b.updateMemoryUsed():n.upsampleFromTile.tile.updateMemoryUsed());x.data instanceof q&&this._drawRasterData(x.data,B,A,g[d])}}p.bindTexture(l);r.copyTexImage2D(p.gl.TEXTURE_2D,0,l.descriptor.pixelFormat,0,0,l.descriptor.width,l.descriptor.height,0);l.generateMipmap();p.bindFramebuffer(null);p.setBlendFunctionSeparate(770,771,1,771);p.setBlendingEnabled(!1);this._resourceCounter.incrementNumTileTexturesComposited();return t?1:f};g.prototype._isBaseLayer=function(a){return a.parent&&
"esri.Basemap"===a.parent.declaredClass&&-1<a.parent.baseLayers.indexOf(a)};return g}()})},"esri/views/vectorTiles/tileRendererHelper3D":function(){define(["require","exports","../../core/has","../../core/libs/gl-matrix/mat4"],function(n,g,c,a){var f={extent:{xmin:0,ymin:0,xmax:0,ymax:0,spatialReference:{wkid:102100,isWrappable:!0},intersects:function(a){return!1}},center:[0,0],scale:1,resolution:1,rotation:0,width:1,height:1,pixelRatio:1,size:[256,256],spatialReference:{wkid:102100,isWrappable:!0},
worldScreenWidth:1,viewpoint:{},toMap:function(a,c,e){return null},toScreen:function(a,c,e){return null},clone:function(){return null},copy:function(a){return this},toJSON:function(){return null}};return function(b,g,e,h,m,k,d){if(k!==d)throw Error("It is expected that tiles are square!");var l=m.adjustLevel(g[0]),l={context:b,drawPhase:0,state:f,stationary:!0,pixelRatio:1,displayLevel:l,requiredLevel:l,drawphase:0,renderer:h,layerOpacity:1,painter:null};h.initializeProgramCache(b);var p=m.getScale(g[0]);
m=m.getShift(g,p);var r=m[1];e.tileTransform.displayCoord[0]=-1-m[0];e.tileTransform.displayCoord[1]=1+r;m=e.tileTransform.transform;a.identity(m);p=.25*p/k;m[0]=p;m[5]=-p;b.setBlendFunctionSeparate(1,771,1,771);l.state.size=[k,d];l.state.width=k;l.state.height=d;h.setStateParams(l.state,l.pixelRatio,g[0]);e.attach(l);b.setFaceCullingEnabled(!1);b.setDepthFunction(515);b.setBlendingEnabled(!1);b.setDepthTestEnabled(!0);b.setDepthWriteEnabled(!0);e.processRender(l);b.setDepthWriteEnabled(!1);b.setBlendingEnabled(!0);
l.drawphase=1;e.processRender(l);l.drawphase=2;e.processRender(l);c("esri-vector-tiles-debug")&&h.renderTileInfo(b,e);b.setDepthWriteEnabled(!0);b.setDepthTestEnabled(!1);b.setFaceCullingEnabled(!0)}})},"esri/views/3d/webgl-engine/shaders/TerrainRendererPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b=function(a){return f.glslifyDefineMap({SPHERICAL:a.spherical,
OVERLAY:a.overlay,ATMOSPHERE:a.atmosphere,WIREFRAME_TEXTURE:a.wireframeTexture,TILE_BORDERS:a.tileBorders,RECEIVE_SHADOWS:a.receiveShadows,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,ALPHA_ZERO:a.alphaZero,BIAS_SHADOWMAP:a.shadowMap})};g.colorPass={name:"terrain-color",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("terrainRenderer/colorPass.vert"),fragmentShader:b(c)+a.resolveIncludes("terrainRenderer/colorPass.frag")}},attributes:c.Default3D};g.normalPass={name:"terrain-normal",
shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("terrainRenderer/normalPass.vert"),fragmentShader:b(c)+a.resolveIncludes("terrainRenderer/normalPass.frag")}},attributes:c.Default3D};g.depthPass={name:"terrain-depth",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("terrainRenderer/depthPass.vert"),fragmentShader:b(c)+a.resolveIncludes("terrainRenderer/depthPass.frag")}},attributes:c.Default3D};g.highlightPass={name:"terrain-highlight",shaders:function(c){return{vertexShader:b(c)+
a.resolveIncludes("terrainRenderer/highlightPass.vert"),fragmentShader:b(c)+a.resolveIncludes("terrainRenderer/highlightPass.frag")}},attributes:c.Default3D}})},"esri/views/3d/terrain/TilemapOnlyTile":function(){define(["require","exports","./TerrainConst","./TilePerLayerInfo"],function(n,g,c,a){return function(){function f(a){this.parent=null;this.lij=a;this.layerInfo=Array(c.LayerClass.COUNT)}f.prototype.hasDataAvailable=function(a,c,e){return(c=this.layerInfo[e][c].tilemap)?"unavailable"!==c.getAvailability(a.lij[1],
a.lij[2]):!0};f.prototype.modifyLayers=function(b,c,e){b=this.layerInfo[e];for(var f=c.length,g=Array(f),k=0;k<f;k++){var d=c[k];g[k]=-1<d?b[d]:a.makeEmptyLayerInfo(e)}this.layerInfo[e]=g};return f}()})},"esri/views/support/WebGLRequirements":function(){define(["require","exports","../../core/Error","../../core/has"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.check=function(){return a("esri-webgl")?a("esri-webgl-major-performance-caveat")?new c("webgl:major-performance-caveat-detected",
"Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is blacklisted."):a("esri-webgl-high-precision-fragment")?a("esri-webgl-vertex-shader-samplers")?a("esri-webgl-element-index-uint")?a("esri-webgl-standard-derivatives")?a("esri-webgl-instanced-arrays")?null:new c("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported."):new c("webgl:standard-derivatives-required","WebGL support for standard derivatives is required but not supported."):
new c("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported."):new c("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported."):new c("webgl:high-precision-fragment-required","WebGL support for high precision fragment shaders is required but not supported."):new c("webgl:required","WebGL is required but not supported.")}})},"esri/views/ui/3d/DefaultUI3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ../DefaultUI".split(" "),
function(n,g,c,a,f,b){return function(b){function e(a){a=b.call(this)||this;a.components=["attribution","zoom","navigation-toggle","compass"];return a}c(e,b);a([f.property()],e.prototype,"components",void 0);return e=a([f.subclass("esri.views.ui.3d.DefaultUI3D")],e)}(f.declared(b))})},"esri/views/ui/DefaultUI":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-geometry ../../core/watchUtils ../../core/accessorSupport/decorators ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q){return function(h){function g(a){a=h.call(this)||this;a._defaultPositionLookup=null;a.components=[];return a}c(g,h);g.prototype.initialize=function(){this._handles.add([b.init(this,"components",this._componentsWatcher.bind(this)),b.init(this,"view",this._updateViewAwareWidgets.bind(this))])};g.prototype._findComponentPosition=function(a){if(!this._defaultPositionLookup){var b=f.isBodyLtr();this._defaultPositionLookup={attribution:"manual",compass:b?"top-left":"top-right",
"navigation-toggle":b?"top-left":"top-right",zoom:b?"top-left":"top-right"}}return this._defaultPositionLookup[a]};g.prototype._removeComponents=function(a){var b=this;a.forEach(function(a){if(a=b.find(a))b.remove(a),a.destroy()})};g.prototype._updateViewAwareWidgets=function(a){var b=this;this.components.forEach(function(c){(c=(c=b.find(c))&&c.widget)&&void 0!==c.view&&c.set("view",a)})};g.prototype._componentsWatcher=function(a,b){this._removeComponents(b);this._addComponents(a);this._adjustPadding(a)};
g.prototype._adjustPadding=function(a){-1!==a.indexOf("attribution")||this._isOverridden("padding")||(this.padding=this.padding.top)};g.prototype._addComponents=function(a){var b=this;this.initialized&&a.forEach(function(a){return b.add(b._createComponent(a),b._findComponentPosition(a))})};g.prototype._createComponent=function(a){var b=this._createWidget(a);if(b)return new e({id:a,node:b})};g.prototype._createWidget=function(a){if("attribution"===a)return this._createAttribution();if("compass"===
a)return this._createCompass();if("navigation-toggle"===a)return this._createNavigationToggle();if("zoom"===a)return this._createZoom()};g.prototype._createAttribution=function(){return new m({view:this.view})};g.prototype._createCompass=function(){return new k({view:this.view})};g.prototype._createNavigationToggle=function(){return new d({view:this.view})};g.prototype._createZoom=function(){return new q({view:this.view})};a([l.property()],g.prototype,"components",void 0);return g=a([l.subclass("esri.views.ui.DefaultUI")],
g)}(l.declared(h))})},"esri/views/ui/Component":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom dojo/dom-class ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b,l,e){return function(h){function g(){var a=null!==h&&h.apply(this,arguments)||this;a.widget=null;return a}c(g,h);g.prototype.destroy=function(){this.widget&&this.widget.destroy();this.node=null};Object.defineProperty(g.prototype,
"id",{get:function(){return this._get("id")||this.get("node.id")},set:function(a){this._set("id",a)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"node",{set:function(a){var c=this._get("node");a!==c&&(a&&b.add(a,"esri-component"),c&&b.remove(c,"esri-component"),this._set("node",a))},enumerable:!0,configurable:!0});g.prototype.castNode=function(a){if(!a)return this._set("widget",null),null;if("string"===typeof a||a&&"nodeType"in a)return this._set("widget",null),f.byId(a);a&&
"function"===typeof a.render&&!a.domNode&&(a.domNode=document.createElement("div"));this._set("widget",a);return a.domNode};a([e.property()],g.prototype,"id",null);a([e.property()],g.prototype,"node",null);a([e.cast("node")],g.prototype,"castNode",null);a([e.property({readOnly:!0})],g.prototype,"widget",void 0);return g=a([e.subclass("esri.views.ui.Component")],g)}(e.declared(l))})},"esri/views/ui/UI":function(){define("require exports ../../core/tsSupport/assignHelper ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper dojo/dom-class dojo/dom-construct dojo/dom-style ../../core/Accessor ../../core/Evented ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ./Component".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p){function r(a){return"object"!==typeof a||a&&a.isInstanceOf&&a.isInstanceOf(p)||!("component"in a||"index"in a||"position"in a)?null:a}var u={left:0,top:0,bottom:0,right:0},t={bottom:30,top:15,right:15,left:15};return function(h){function g(){var a=h.call(this)||this;a._cornerNameToContainerLookup={};a._positionNameToContainerLookup={};a._components=[];a._handles=new k;a._componentToKey=new Map;a.view=null;a._initContainers();return a}a(g,h);g.prototype.initialize=
function(){this._handles.add([d.init(this,"view.padding, container",this._applyViewPadding.bind(this)),d.init(this,"padding",this._applyUIPadding.bind(this))])};g.prototype.destroy=function(){this.container=null;this._components.forEach(function(a){a.destroy()});this._components.length=0;this._handles.destroy();this._componentToKey.clear();this._componentToKey=null};Object.defineProperty(g.prototype,"container",{set:function(a){var c=this._get("container");a!==c&&(a&&(b.add(a,"esri-ui"),this._attachContainers(a)),
c&&(b.remove(c,"esri-ui"),e.set(c,{top:"",bottom:"",left:"",right:""}),l.empty(c)),this._set("container",a))},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"height",{get:function(){var a=this.get("view.height")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.top+b.bottom),0)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"padding",{get:function(){return this._get("padding")},set:function(a){a?this._override("padding",a):this._clearOverride("padding")},
enumerable:!0,configurable:!0});g.prototype.castPadding=function(a){return"number"===typeof a?{bottom:a,top:a,right:a,left:a}:c({},t,a)};Object.defineProperty(g.prototype,"width",{get:function(){var a=this.get("view.width")||0;if(0===a)return a;var b=this._getViewPadding();return Math.max(a-(b.left+b.right),0)},enumerable:!0,configurable:!0});g.prototype.add=function(a,b){var c=this,d,e;if(Array.isArray(a))a.forEach(function(a){return c.add(a,b)});else{var f=r(a);f&&(d=f.index,b=f.position,a=f.component,
e=f.key);b&&"object"===typeof b&&(d=b.index,e=b.key,b=b.position);!a||b&&!this._isValidPosition(b)||(a&&a.isInstanceOf&&a.isInstanceOf(p)||(a=new p({node:a})),this._place({component:a,position:b,index:d}),this._components.push(a),e&&this._componentToKey.set(a,e))}};g.prototype.remove=function(a,b){var c=this;if(a){if(Array.isArray(a))return a.map(function(a){return c.remove(a,b)});var d=this.find(a);if(d){var e=this._componentToKey;if(!e.has(a)||e.get(a)===b)return e=this._components.indexOf(d),d.node.parentNode&&
d.node.parentNode.removeChild(d.node),this._componentToKey.delete(a),this._components.splice(e,1)[0]}}};g.prototype.empty=function(a){var c=this;if(Array.isArray(a))return a.map(function(a){return c.empty(a)}).reduce(function(a,b){return a.concat(b)});a=a||"manual";if("manual"===a)return Array.prototype.slice.call(this._manualContainer.children).filter(function(a){return!b.contains(a,"esri-ui-corner")}).map(function(a){return c.remove(a)});if(this._isValidPosition(a))return Array.prototype.slice.call(this._cornerNameToContainerLookup[a].children).map(this.remove,
this)};g.prototype.move=function(a,b){var c=this;Array.isArray(a)&&a.forEach(function(a){return c.move(a,b)});if(a){var d,e=r(a)||r(b);e&&(d=e.index,b=e.position,a=e.component||a);(!b||this._isValidPosition(b))&&(a=this.remove(a))&&this.add(a,{position:b,index:d})}};g.prototype.find=function(a){return a?a&&a.isInstanceOf&&a.isInstanceOf(p)?this._findByComponent(a):"string"===typeof a?this._findById(a):this._findByNode(a.domNode||a):null};g.prototype._getViewPadding=function(){return this.get("view.padding")||
u};g.prototype._attachContainers=function(a){l.place(this._manualContainer,a);l.place(this._innerContainer,a)};g.prototype._initContainers=function(){var a=l.create("div",{className:"esri-ui-inner-container esri-ui-corner-container"}),b=l.create("div",{className:"esri-ui-inner-container esri-ui-manual-container"}),d=l.create("div",{className:"esri-ui-top-left esri-ui-corner"},a),e=l.create("div",{className:"esri-ui-top-right esri-ui-corner"},a),f=l.create("div",{className:"esri-ui-bottom-left esri-ui-corner"},
a),h=l.create("div",{className:"esri-ui-bottom-right esri-ui-corner"},a);this._innerContainer=a;this._manualContainer=b;this._cornerNameToContainerLookup={"top-left":d,"top-right":e,"bottom-left":f,"bottom-right":h};this._positionNameToContainerLookup=c({manual:b},this._cornerNameToContainerLookup)};g.prototype._isValidPosition=function(a){return!!this._positionNameToContainerLookup[a]};g.prototype._place=function(a){var b=a.component,c=a.index;a=this._positionNameToContainerLookup[a.position||"manual"];
var d;-1<c?(d=Array.prototype.slice.call(a.children),0===c?this._placeComponent(b,a,"first"):c>=d.length?this._placeComponent(b,a,"last"):this._placeComponent(b,d[c],"before")):this._placeComponent(b,a,"last")};g.prototype._placeComponent=function(a,b,c){var d=a.widget;d&&!d._started&&"function"===typeof d.postMixInProperties&&"function"===typeof d.buildRendering&&"function"===typeof d.postCreate&&"function"===typeof d.startup&&a.widget.startup();l.place(a.node,b,c)};g.prototype._applyViewPadding=
function(){var a=this.container;a&&e.set(a,this._toPxPosition(this._getViewPadding()))};g.prototype._applyUIPadding=function(){this._innerContainer&&e.set(this._innerContainer,this._toPxPosition(this.padding))};g.prototype._toPxPosition=function(a){return{top:this._toPxUnit(a.top),left:this._toPxUnit(a.left),right:this._toPxUnit(a.right),bottom:this._toPxUnit(a.bottom)}};g.prototype._toPxUnit=function(a){return 0===a?0:a+"px"};g.prototype._findByComponent=function(a){var b=null,c;this._components.some(function(d){(c=
d===a)&&(b=d);return c});return b};g.prototype._findById=function(a){var b=null,c;this._components.some(function(d){(c=d.id===a)&&(b=d);return c});return b};g.prototype._findByNode=function(a){var b=null,c;this._components.some(function(d){(c=d.node===a)&&(b=d);return c});return b};f([q.property()],g.prototype,"container",null);f([q.property({dependsOn:["view.height"]})],g.prototype,"height",null);f([q.property({value:t})],g.prototype,"padding",null);f([q.cast("padding")],g.prototype,"castPadding",
null);f([q.property()],g.prototype,"view",void 0);f([q.property({dependsOn:["view.width"]})],g.prototype,"width",null);return g=f([q.subclass("esri.views.ui.UI")],g)}(q.declared(h,m))})},"esri/widgets/Attribution":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Attribution/nls/Attribution ../core/watchUtils ../core/accessorSupport/decorators ./Widget ./Attribution/AttributionViewModel ./support/widget".split(" "),function(n,g,
c,a,f,b,l,e,h,m){return function(e){function d(a){a=e.call(this)||this;a._isOpen=!1;a._attributionTextOverflowed=!1;a._prevSourceNodeHeight=0;a.iconClass="esri-icon-description";a.itemDelimiter=" | ";a.label=f.widgetLabel;a.view=null;a.viewModel=new h;return a}c(d,e);d.prototype.postInitialize=function(){var a=this;this.own(b.on(this,"viewModel.items","change",function(){return a.scheduleRender()}))};Object.defineProperty(d.prototype,"attributionText",{get:function(){return this.viewModel.items.reduce(function(a,
b){-1===a.indexOf(b.text)&&a.push(b.text);return a},[]).join(this.itemDelimiter)},enumerable:!0,configurable:!0});d.prototype.render=function(){var a,b=(a={},a["esri-attribution--open"]=this._isOpen,a);return m.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",b),onclick:this._toggleState,onkeydown:this._toggleState},this._renderSourcesNode(),m.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",m.tsx("a",{target:"_blank",href:"http://www.esri.com/",class:this.classes("esri-attribution__link",
"esri-widget__anchor")},"Esri")))};d.prototype._renderSourcesNode=function(){var a,b=this._isOpen,c=this._isInteractive(),d=c?0:-1,e=this.attributionText,f=c?"button":void 0,b=(a={},a["esri-attribution__sources--open"]=b,a["esri-interactive"]=c,a);return m.tsx("div",{afterCreate:this._afterSourcesNodeCreate,afterUpdate:this._afterSourcesNodeUpdate,bind:this,class:this.classes("esri-attribution__sources",b),innerHTML:e,role:f,tabIndex:d})};d.prototype._afterSourcesNodeCreate=function(a){this._prevSourceNodeHeight=
a.clientWidth};d.prototype._afterSourcesNodeUpdate=function(a){var b=!1,c=a.clientHeight;a=a.scrollWidth>=a.clientWidth;var d=this._attributionTextOverflowed!==a;this._attributionTextOverflowed=a;d&&(b=!0);this._isOpen&&(a=c<this._prevSourceNodeHeight,this._prevSourceNodeHeight=c,a&&(this._isOpen=!1,b=!0));b&&this.scheduleRender()};d.prototype._toggleState=function(){this._isInteractive()&&(this._isOpen=!this._isOpen)};d.prototype._isInteractive=function(){return this._isOpen||this._attributionTextOverflowed};
a([l.property({dependsOn:["viewModel.items.length","itemDelimiter"],readOnly:!0}),m.renderable()],d.prototype,"attributionText",null);a([l.property()],d.prototype,"iconClass",void 0);a([l.property(),m.renderable()],d.prototype,"itemDelimiter",void 0);a([l.property()],d.prototype,"label",void 0);a([l.aliasOf("viewModel.view")],d.prototype,"view",void 0);a([l.property({type:h}),m.renderable(["state","view.size"])],d.prototype,"viewModel",void 0);a([m.accessibleHandler()],d.prototype,"_toggleState",
null);return d=a([l.subclass("esri.widgets.Attribution")],d)}(l.declared(e))})},"esri/widgets/Attribution/AttributionViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/Collection ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../../geometry/support/contains ../../geometry/support/webMercatorUtils".split(" "),function(n,g,c,a,f,b,l,e,h,m,k,d){return function(b){function g(a){a=
b.call(this,a)||this;a._handles=new e;a._pendingAttributionItemsByLayerId={};a._attributionDataByLayerId={};a.items=new l;a.view=null;a._updateAttributionItems=a._updateAttributionItems.bind(a);return a}c(g,b);g.prototype.initialize=function(){this._handles.add(h.init(this,"view",this._viewWatcher))};g.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,
configurable:!0});g.prototype._viewWatcher=function(a){var b=this,c=this._handles;c&&c.remove();a&&(c.add([a.allLayerViews.on("change",function(a){b._addLayerViews(a.added);0<a.removed.length&&(a.removed.forEach(function(a){c.remove(a.uid)}),b._updateAttributionItems())}),h.init(a,"stationary",this._updateAttributionItems)]),this._addLayerViews(a.allLayerViews))};g.prototype._addLayerViews=function(a){var b=this;a.forEach(function(a){b._handles.has(a.uid)||b._handles.add(h.init(a,"suspended",b._updateAttributionItems),
a.uid)})};g.prototype._updateAttributionItems=function(){var a=this,b=[];this._getActiveLayerViews().forEach(function(c){var d=c.layer;if(!d.hasAttributionData){if(c=d.get("copyright")){var e=a._findItem(b,{layer:d,text:c});e||b.push({text:c,layer:d})}}else if(d&&d.tileInfo){var f=a._attributionDataByLayerId;if(f[d.uid]){if(c=a._getDynamicAttribution(f[d.uid],a.view,d))(e=a._findItem(b,{layer:d,text:c}))||b.push({text:c,layer:d})}else{var g=a._pendingAttributionItemsByLayerId;a._inProgress(g[d.uid])||
(g[d.uid]=d.fetchAttributionData().then(function(b){b=a._createContributionIndex(b,a._isBingLayer(d));delete g[d.uid];f[d.uid]=b;a._updateAttributionItems()}))}}});this._itemsChanged(this.items,b)&&(this.items.removeAll(),this.items.addMany(b))};g.prototype._itemsChanged=function(a,b){return a.length!==b.length||a.some(function(a,c){return a.text!==b[c].text})};g.prototype._inProgress=function(a){return a&&!a.isFulfilled()};g.prototype._getActiveLayerViews=function(){return this.get("view.allLayerViews").filter(function(a){return!a.suspended&&
a.get("layer.attributionVisible")})};g.prototype._findItem=function(a,b){var c=b.layer,d=b.text,e;a.some(function(a){var b=a.layer===c&&a.text===d;b&&(e=a);return b});return e};g.prototype._isBingLayer=function(a){return"bing-maps"===a.type};g.prototype._createContributionIndex=function(a,b){a=a.contributors;var c={};if(!a)return c;for(var e=0;e<a.length;e++){var g=a[e],h=g.coverageAreas;if(!h)return;for(var k=0;k<h.length;k++)for(var l=h[k],m=l.bbox,p=l.zoomMin-(b&&l.zoomMin?1:0),q=l.zoomMax-(b&&
l.zoomMax?1:0),l={extent:d.geographicToWebMercator({xmin:m[1],ymin:m[0],xmax:m[3],ymax:m[2],spatialReference:f.SpatialReference.WGS84}),attribution:g.attribution||"",score:null!=l.score?l.score:100,id:e};p<=q;p++)c[p]=c[p]||[],c[p].push(l)}c.maxKey=Math.max.apply(null,Object.keys(c));return c};g.prototype._getDynamicAttribution=function(a,b,c){var e=b.extent;c=c.tileInfo.scaleToZoom(b.scale);c=Math.min(a.maxKey,Math.round(c));if(!e||null==c||-1>=c)return"";a=a[c];var f=d.project(e.center.clone().normalize(),
b.spatialReference),g={};return a.filter(function(a){var b=!g[a.id]&&f&&k.extentContainsPoint(a.extent,f);b&&(g[a.id]=!0);return b}).sort(function(a,b){return b.score-a.score||a.objectId-b.objectId}).map(function(a){return a.attribution}).join(", ")};a([m.property({readOnly:!0,type:l})],g.prototype,"items",void 0);a([m.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"state",null);a([m.property()],g.prototype,"view",void 0);return g=a([m.subclass("esri.widgets.Attribution.AttributionViewModel")],
g)}(m.declared(b))})},"esri/widgets/Compass":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Compass/nls/Compass ../core/accessorSupport/decorators ./Widget ./Compass/CompassViewModel ./support/widget".split(" "),function(n,g,c,a,f,b,l,e,h){return function(g){function k(a){a=g.call(this)||this;a.goToOverride=null;a.iconClass="esri-icon-locate-circled";a.label=f.widgetLabel;a.view=null;a.viewModel=new e;return a}c(k,g);k.prototype.reset=
function(){};k.prototype.render=function(){var a,b,c=this.viewModel,e=c.orientation,c=c.state,g="disabled"===c,k="compass"===("rotation"===c?"rotation":"compass"),c=g?-1:0,g=(a={},a["esri-disabled"]=g,a["esri-interactive"]=!g,a);a=(b={},b["esri-icon-compass"]=k,b["esri-icon-dial"]=!k,b);return h.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",g),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:c,"aria-label":f.reset,title:f.reset},h.tsx("span",
{"aria-hidden":"true",class:this.classes("esri-compass__icon",a),styles:this._toRotationTransform(e)}),h.tsx("span",{class:"esri-icon-font-fallback-text"},f.reset))};k.prototype._reset=function(){this.viewModel.reset()};k.prototype._toRotationTransform=function(a){return{transform:"rotateZ("+a.z+"deg)"}};a([b.aliasOf("viewModel.goToOverride")],k.prototype,"goToOverride",void 0);a([b.property()],k.prototype,"iconClass",void 0);a([b.property()],k.prototype,"label",void 0);a([b.aliasOf("viewModel.view")],
k.prototype,"view",void 0);a([b.property({type:e}),h.renderable(["viewModel.orientation","viewModel.state"])],k.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.reset")],k.prototype,"reset",null);a([h.accessibleHandler()],k.prototype,"_reset",null);return k=a([b.subclass("esri.widgets.Compass")],k)}(b.declared(l))})},"esri/widgets/Compass/CompassViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators ../support/GoTo".split(" "),
function(n,g,c,a,f,b,l,e,h){return function(f){function g(a){a=f.call(this,a)||this;a._handles=new b;a.orientation={x:0,y:0,z:0};a.view=null;a._updateForCamera=a._updateForCamera.bind(a);a._updateForRotation=a._updateForRotation.bind(a);a._updateRotationWatcher=a._updateRotationWatcher.bind(a);return a}c(g,f);g.prototype.initialize=function(){this._handles.add(l.init(this,"view",this._updateRotationWatcher))};g.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(g.prototype,
"canShowNorth",{get:function(){var a=this.get("view.spatialReference");return a&&(a.isWebMercator||a.isWGS84)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"},enumerable:!0,configurable:!0});g.prototype.reset=function(){if(this.get("view.ready")){var a={};"2d"===this.view.type?a.rotation=0:a.heading=0;this.callGoTo({target:a})}};g.prototype._updateForRotation=function(a){void 0!==
a&&null!==a&&(this.orientation={z:a})};g.prototype._updateForCamera=function(a){a&&(this.orientation={x:0,y:0,z:-a.heading})};g.prototype._updateRotationWatcher=function(a){this._handles.removeAll();a&&("2d"===a.type?this._handles.add(l.init(this,"view.rotation",this._updateForRotation)):this._handles.add(l.init(this,"view.camera",this._updateForCamera)))};a([e.property({dependsOn:["view.spatialReference.isWebMercator","view.spatialReference.wkid"],readOnly:!0})],g.prototype,"canShowNorth",null);
a([e.property()],g.prototype,"orientation",void 0);a([e.property({dependsOn:["view.ready","canShowNorth"],readOnly:!0})],g.prototype,"state",null);a([e.property()],g.prototype,"view",void 0);a([e.property()],g.prototype,"reset",null);return g=a([e.subclass("esri.widgets.CompassViewModel")],g)}(e.declared(f,h))})},"esri/widgets/NavigationToggle":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./NavigationToggle/nls/NavigationToggle ../core/accessorSupport/decorators ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/widget".split(" "),
function(n,g,c,a,f,b,l,e,h){return function(g){function k(a){a=g.call(this)||this;a.iconClass="esri-icon-pan2";a.label=f.widgetLabel;a.view=null;a.viewModel=new e;return a}c(k,g);Object.defineProperty(k.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});k.prototype.toggle=function(){};k.prototype.render=function(){var a,b,c,e="disabled"===this.get("viewModel.state"),g="pan"===this.get("viewModel.navigationMode"),k=(a={},a["esri-disabled"]=
e,a["esri-navigation-toggle--horizontal"]="horizontal"===this.layout,a);a=(b={},b["esri-navigation-toggle__button--active"]=g,b);b=(c={},c["esri-navigation-toggle__button--active"]=!g,c);c=e?-1:0;return h.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",k),onclick:this._toggle,onkeydown:this._toggle,tabIndex:c,"aria-label":f.toggle,title:f.toggle},h.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",
a)},h.tsx("span",{class:"esri-icon-pan"})),h.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--rotate",b)},h.tsx("span",{class:"esri-icon-rotate"})))};k.prototype._toggle=function(){this.toggle()};a([b.property()],k.prototype,"iconClass",void 0);a([b.property()],k.prototype,"label",void 0);a([b.property({value:"vertical"}),h.renderable()],k.prototype,"layout",null);a([b.aliasOf("viewModel.view"),h.renderable()],k.prototype,"view",void 0);
a([b.property({type:e}),h.renderable(["viewModel.state","viewModel.navigationMode"])],k.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.toggle")],k.prototype,"toggle",null);a([h.accessibleHandler()],k.prototype,"_toggle",null);return k=a([b.subclass("esri.widgets.NavigationToggle")],k)}(b.declared(l))})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/Handles ../../core/watchUtils ../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b,l,e){return function(f){function g(a){a=f.call(this,a)||this;a._handles=new b;a.navigationMode="pan";a.view=null;a.toggle=a.toggle.bind(a);return a}c(g,f);g.prototype.initialize=function(){this._handles.add(l.when(this,"view.inputManager",this._setNavigationMode.bind(this)))};g.prototype.destroy=function(){this._handles.destroy();this.view=this._handles=null};Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":
"disabled"},enumerable:!0,configurable:!0});g.prototype.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",this._setNavigationMode())};g.prototype._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a([e.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"state",null);a([e.property()],g.prototype,"navigationMode",void 0);a([e.property()],g.prototype,"view",void 0);
a([e.property()],g.prototype,"toggle",null);return g=a([e.subclass("esri.widgets.NavigationToggleViewModel")],g)}(e.declared(f))})},"esri/widgets/Zoom":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/i18n!./Zoom/nls/Zoom ../core/accessorSupport/decorators ./Widget ./Zoom/IconButton ./Zoom/ZoomViewModel ./support/widget".split(" "),function(n,g,c,a,f,b,l,e,h,m){return function(g){function d(a){a=g.call(this)||this;a.iconClass="esri-icon-zoom-in-magnifying-glass";
a.label=f.widgetLabel;a.view=null;a.viewModel=new h;return a}c(d,g);d.prototype.postInitialize=function(){this._zoomInButton=new e({action:this.zoomIn,iconClass:"esri-icon-plus",title:f.zoomIn});this._zoomOutButton=new e({action:this.zoomOut,iconClass:"esri-icon-minus",title:f.zoomOut})};Object.defineProperty(d.prototype,"layout",{set:function(a){"horizontal"!==a&&(a="vertical");this._set("layout",a)},enumerable:!0,configurable:!0});d.prototype.render=function(){var a,b=this.viewModel,c=(a={},a["esri-zoom--horizontal"]=
"horizontal"===this.layout,a);this._zoomInButton.enabled="ready"===b.state&&b.canZoomIn;this._zoomOutButton.enabled="ready"===b.state&&b.canZoomOut;return m.tsx("div",{class:this.classes("esri-zoom esri-widget",c)},this._zoomInButton.render(),this._zoomOutButton.render())};d.prototype.zoomIn=function(){};d.prototype.zoomOut=function(){};a([b.property()],d.prototype,"iconClass",void 0);a([b.property()],d.prototype,"label",void 0);a([b.property({value:"vertical"}),m.renderable()],d.prototype,"layout",
null);a([b.aliasOf("viewModel.view"),m.renderable()],d.prototype,"view",void 0);a([b.property({type:h}),m.renderable(["viewModel.canZoomIn","viewModel.canZoomOut","viewModel.state"])],d.prototype,"viewModel",void 0);a([b.aliasOf("viewModel.zoomIn")],d.prototype,"zoomIn",null);a([b.aliasOf("viewModel.zoomOut")],d.prototype,"zoomOut",null);return d=a([b.subclass("esri.widgets.Zoom")],d)}(b.declared(l))})},"esri/widgets/Zoom/IconButton":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/accessorSupport/decorators ../Widget ../support/widget".split(" "),
function(n,g,c,a,f,b,l){return function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.enabled=!0;a.iconClass="";a.title="";return a}c(e,b);e.prototype.render=function(){var a,b,c=this.enabled?0:-1,e=(a={},a["esri-disabled"]=!this.enabled,a["esri-interactive"]=this.enabled,a);a=(b={},b[this.iconClass]=!!this.iconClass,b);return l.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",e),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:c,
title:this.title},l.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",a)}),l.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};e.prototype._triggerAction=function(){this.action.call(this)};a([f.property()],e.prototype,"action",void 0);a([f.property(),l.renderable()],e.prototype,"enabled",void 0);a([f.property({readOnly:!1}),l.renderable()],e.prototype,"iconClass",void 0);a([f.property(),l.renderable()],e.prototype,"title",void 0);a([l.accessibleHandler()],
e.prototype,"_triggerAction",null);return e=a([f.subclass("esri.widgets.IconButton")],e)}(f.declared(b))})},"esri/widgets/Zoom/ZoomViewModel":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(n,g,c,a,f,b,l,e){return function(f){function g(a){a=f.call(this,a)||this;a.canZoomIn=null;a.canZoomOut=null;a.zoomIn=a.zoomIn.bind(a);
a.zoomOut=a.zoomOut.bind(a);return a}c(g,f);g.prototype.destroy=function(){this.view=null};Object.defineProperty(g.prototype,"state",{get:function(){return this.get("view.ready")?"ready":"disabled"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"view",{set:function(a){a?"2d"===a.type?this._zoomConditions=new l({view:a}):"3d"===a.type&&(this._zoomConditions=new e):this._zoomConditions=null;this._set("view",a)},enumerable:!0,configurable:!0});g.prototype.zoomIn=function(){this.canZoomIn&&
this._zoomToFactor(.5)};g.prototype.zoomOut=function(){this.canZoomOut&&this._zoomToFactor(2)};g.prototype._zoomToFactor=function(a){if("ready"===this.state){var b=this.view;"3d"===this.view.type?b.goTo({zoomFactor:1/a}):b.goTo({scale:this.get("view.scale")*a})}};a([b.property()],g.prototype,"_zoomConditions",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],g.prototype,"canZoomIn",void 0);a([b.property({aliasOf:"_zoomConditions.canZoomOut",readOnly:!0})],g.prototype,"canZoomOut",
void 0);a([b.property({dependsOn:["view.ready"],readOnly:!0})],g.prototype,"state",null);a([b.property()],g.prototype,"view",null);a([b.property()],g.prototype,"zoomIn",null);a([b.property()],g.prototype,"zoomOut",null);return g=a([b.subclass("esri.widgets.Zoom.ZoomViewModel")],g)}(b.declared(f))})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b){return function(f){function e(){return null!==f&&f.apply(this,arguments)||this}c(e,f);Object.defineProperty(e.prototype,"canZoomIn",{get:function(){var a=this.get("view.animation.target.scale")||this.get("view.scale"),b=this.get("view.constraints.effectiveMaxScale");return 0===b||a>b},enumerable:!0,configurable:!0});Object.defineProperty(e.prototype,"canZoomOut",{get:function(){var a=this.get("view.animation.target.scale")||this.get("view.scale"),b=this.get("view.constraints.effectiveMinScale");
return 0===b||a<b},enumerable:!0,configurable:!0});a([b.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],e.prototype,"canZoomIn",null);a([b.property({dependsOn:["view.ready","view.scale"],readOnly:!0})],e.prototype,"canZoomOut",null);a([b.property()],e.prototype,"view",void 0);return e=a([b.subclass("esri.widgets.Zoom.ZoomConditions2D")],e)}(b.declared(f))})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b){return function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a.canZoomIn=!0;a.canZoomOut=!0;return a}c(e,f);a([b.property({readOnly:!0})],e.prototype,"canZoomIn",void 0);a([b.property({readOnly:!0})],e.prototype,"canZoomOut",void 0);return e=a([b.subclass("esri.widgets.Zoom.ZoomConditions3D")],e)}(b.declared(f))})},"esri/layers/graphics/controllers/SnapshotController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/Accessor ../../../core/Error ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/accessorSupport/decorators ../../../geometry/support/scaleUtils ../../support/GraphicsManager ../../../views/3d/layers/graphics/Graphics3DVerticalScale".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){var t=m.getLogger("esri.layers.graphics.controllers.SnapshotController");return function(b){function e(a){a=b.call(this)||this;a.type="snapshot";a._gManager=null;a._verticalScale=null;a._handles=new h;a._source=null;a._started=!1;a._pendingQueries=new Map;a.extent=null;a.hasAllFeatures=!1;a.hasFeatures=!1;a.layer=null;a.layerView=null;a.maxPageSize=null;a.defaultReturnZ=void 0;a.defaultReturnM=void 0;a.pageSize=null;a.paginationEnabled=!1;return a}c(e,b);
e.prototype.initialize=function(){var a=this,b=this.layer.when(function(){return a._verifyCapabilities()}).then(function(){return a._init()});this.addResolvingPromise(b)};e.prototype.destroy=function(){this.cancelQuery();this._gManager&&(this._gManager.destroy(),this._gManager=null);this._handles.destroy();this._pendingQueries=this._handles=null};Object.defineProperty(e.prototype,"updating",{get:function(){return!!(this._pendingQueries&&0<this._pendingQueries.size)},enumerable:!0,configurable:!0});
Object.defineProperty(e.prototype,"graphics",{set:function(a){var b=this._get("graphics");b!==a&&(this._handles.remove("graphics"),a&&(this._collectionChanged({added:a.toArray(),removed:b&&b.toArray()}),this._handles.add(a.on("change",this._collectionChanged.bind(this)),"graphics")),this._set("graphics",a))},enumerable:!0,configurable:!0});e.prototype.cancelQuery=function(){var a=this;this._pendingQueries&&(this._pendingQueries.forEach(function(b,c){b.isFulfilled()||b.cancel(Error(a._cancelErrorMsg))}),
this._pendingQueries.clear(),this.notifyChange("updating"))};e.prototype.refresh=function(){this.isResolved()&&this._started&&this._queryFeatures()};e.prototype.startup=function(){this._started||(this._started=!0,this._resolutionParams=this._getResolutionParams(),this._queryFeatures())};e.prototype.update=function(){this.startup()};e.prototype._init=function(){var a=this.layer;this.paginationEnabled=!!a.get("capabilities.query.supportsPagination");this._source=a.source;var b=a.maxRecordCount||4E3;
this.pageSize=null==this.maxPageSize?b:Math.min(b,this.maxPageSize);this._gManager=new r({graphics:this.graphics,objectIdField:a.objectIdField});this._verticalScale=new u({sourceSpatialReference:a.spatialReference,destSpatialReference:this.layerView.view.spatialReference});this._setupStateWatchers()};e.prototype._getResolutionParams=function(){var a=this.layer,b=a.get("capabilities.query.supportsQuantization"),c;if("polyline"===a.geometryType||"polygon"===a.geometryType){var d=p.getMetersPerUnit(this.layerView.view.spatialReference);
null!=d&&(c=this._featureResolution.scale,d=this._featureResolution.value/d,c=a.maxScale?a.maxScale:a.minScale?Math.min(c,a.minScale):Math.min(c,p.getScale(this.layerView.view,a.fullExtent)),c*=d/this._featureResolution.scale)}return c?{maxAllowableOffset:b?null:c,quantizationParameters:b?{mode:"view",originPosition:"upperLeft",tolerance:c,extent:a.fullExtent}:null}:null};e.prototype._setupStateWatchers=function(){var a=this;this._handles.add([this.watch("extent",this.refresh.bind(this)),this.layer.watch("outFields",
function(b,c){b&&c?-1===c.indexOf("*")&&(b.sort(),c.sort(),JSON.stringify(b)!==JSON.stringify(c)&&a.refresh()):a.refresh()}),this.layer.watch("definitionExpression, historicMoment",this.refresh.bind(this)),this.layer.on("edits",this._editsHandler.bind(this))])};e.prototype._createQueryParams=function(){var a=this.layer,b=this.layerView,c=a.createQuery();c.outSpatialReference=b.view.spatialReference;c.geometry=this.extent;(a=a.capabilities&&a.capabilities.data)&&a.supportsZ&&null==c.returnZ&&null!=
this.defaultReturnZ&&(c.returnZ=this.defaultReturnZ);a&&a.supportsM&&null==c.returnM&&null!=this.defaultReturnM&&(c.returnM=this.defaultReturnM);c.set(this._resolutionParams);this.paginationEnabled&&(c.start=0,c.num=this.pageSize);return c};e.prototype._queryFeatures=function(){this.cancelQuery();this.hasAllFeatures=this.hasFeatures=!1;this._gManager.beginPagedUpdate();this.emit("query-start");this._executeQuery(this._createQueryParams())};e.prototype._executeQuery=function(a){var b=this,c=this._source.queryFeatures(a),
d=this._gManager.createIntentToAdd();this._querySetup(d,c);c.then(this._processFeatureSet.bind(this,a,d)).catch(function(a){return b._queryError(d,a)}).always(function(){return b._queryTeardown(d)})};e.prototype._processFeatureSet=function(a,b,c){var d=c.exceededTransferLimit,e=c.features,f=this._maxFeatures[this.layer.geometryType]||0,g=e?e.length:0,h=this._gManager.numGraphics+g,k=h>=f;k&&(t.warn('Feature limit exceeded on layer "',this.layer.title,'". Not all features are shown.'),(f=h-f)&&e.splice(g-
f,f));a=d&&this.paginationEnabled&&!k?this._queryNextPage(a):!1;this._verticalScale.adjust(e);e&&this._gManager.addPage(e,b);this.hasFeatures=!0;a||(this._gManager.endPagedUpdate(),this.hasAllFeatures=!d,this.emit("query-end",{success:!0}));return c};e.prototype._queryNextPage=function(a){a.start+=this.pageSize;this._executeQuery(a);return!0};e.prototype._queryError=function(a,b){b&&"cancel"===b.dojoType&&!this.hasFeatures?this._gManager.revertPagedUpdate():this._gManager.endPagedUpdate();this.emit("query-end",
{success:!1});if(b&&"cancel"===b.dojoType)return d.reject(b);a=new l("snapshotcontroller:tile-request-failed","Failed to query for features",{error:b});t.error(a);return d.reject(a)};e.prototype._querySetup=function(a,b){this._pendingQueries.set(a,b);this.notifyChange("updating")};e.prototype._queryTeardown=function(a){this._gManager.removeIntent(a);this._pendingQueries.delete(a);this.notifyChange("updating")};e.prototype._processRefetch=function(a,b){(b=b.features)&&this._gManager.add(b,a)};e.prototype._refetchError=
function(a,b){};e.prototype._verifyCapabilities=function(){if(!this.layer.get("capabilities.operations.supportsQuery"))throw new l("graphicscontroller:query-capability-required","Service requires query capabilities to be used as a feature layer",{layer:this.layer});};e.prototype._collectionChanged=function(a){var b=a.added;if(b)for(var c=0;c<b.length;c++)b[c].layer=this.layer,b[c].sourceLayer=this.layer;if(b=a.removed)for(c=0;c<b.length;c++)b[c].layer=null,b[c].sourceLayer=null};e.prototype._editsHandler=
function(a){var b=function(a){return a.objectId},c=a.deletedFeatures.map(b);this._gManager.delete(c);a=a.addedFeatures.concat(a.updatedFeatures).map(b);a.length&&(b=this._createQueryParams(),b.objectIds=a,b=this._source.queryFeatures(b),a=this._gManager.createIntentToAdd(a),this._querySetup(a,b),b.then(this._processRefetch.bind(this,a)).catch(this._refetchError.bind(this,a)).always(this._queryTeardown.bind(this,a)))};a([q.shared("SnapshotController: query cancelled")],e.prototype,"_cancelErrorMsg",
void 0);a([q.property({readOnly:!0})],e.prototype,"type",void 0);a([q.shared({value:.25,scale:945})],e.prototype,"_featureResolution",void 0);a([q.shared({point:16E3,multipoint:8E3,polyline:4E3,polygon:4E3,multipatch:4E3})],e.prototype,"_maxFeatures",void 0);a([q.property()],e.prototype,"_pendingQueries",void 0);a([q.property({dependsOn:["_pendingQueries"]})],e.prototype,"updating",null);a([q.property()],e.prototype,"graphics",null);a([q.property()],e.prototype,"extent",void 0);a([q.property()],e.prototype,
"hasAllFeatures",void 0);a([q.property()],e.prototype,"hasFeatures",void 0);a([q.property()],e.prototype,"layer",void 0);a([q.property()],e.prototype,"layerView",void 0);a([q.property()],e.prototype,"maxPageSize",void 0);a([q.property()],e.prototype,"defaultReturnZ",void 0);a([q.property()],e.prototype,"defaultReturnM",void 0);a([q.property()],e.prototype,"pageSize",void 0);a([q.property()],e.prototype,"paginationEnabled",void 0);return e=a([q.subclass("esri.layers.graphics.controllers.SnapshotController")],
e)}(q.declared(b,k,e))})},"esri/layers/support/GraphicsManager":function(){define(["../../core/Accessor"],function(n){var g=0;return n.createSubclass({constructor:function(){this._deletedGraphicsIndex=new Set;this._intentsIndex=new Map},destroy:function(){this.removeAll();this._intentsIndex=this._deletedGraphicsIndex=null},properties:{graphics:null,indexById:{value:null,dependsOn:["graphics","objectIdField"],get:function(){return this._createIndexById(this.graphics&&this.graphics.toArray(),this.objectIdField)}},
numGraphics:{value:0,dependsOn:["indexById"],get:function(){return this.indexById?this.indexById.size:0}},objectIdField:null,updating:{value:!1,dependsOn:["_intentsIndex"],get:function(){return!!(this._intentsIndex&&0<this._intentsIndex.size)}},_intentsIndex:{value:null}},_oldIndex:null,_deletedGraphicsIndex:null,beginPagedUpdate:function(){this._oldIndex=this.indexById;this.indexById=null;this.notifyChange("numGraphics")},addPage:function(c,a){this.add(c,a)},revertPagedUpdate:function(){var c=this._removeLeftOnly(this.indexById,
this._oldIndex);this.indexById=this._oldIndex;this._oldIndex=null;this.graphics.removeMany(c);this.notifyChange("numGraphics")},endPagedUpdate:function(){var c=this._removeLeftOnly(this._oldIndex,this.indexById);this._oldIndex=null;this.graphics.removeMany(c);this.notifyChange("numGraphics")},findGraphic:function(c){return(c=this.indexById&&this.indexById.get(c))&&c.graphic},removeAll:function(){this.indexById=this._oldIndex=null;this.graphics.removeAll();this.notifyChange("numGraphics")},add:function(c,
a){if(c&&c.length){for(var f=this.objectIdField,b=this.indexById=this.indexById||new Map,g=this._oldIndex,e=this._createIndexById(c,f),e=this._extractObjectIds(e),b=this._extractObjectIds(b),g=this._extractObjectIds(g),b=b.concat(g),h=[],m=b.length,g=0;g<m;g++){var k=b[g];-1<e.indexOf(k)&&h.push(k)}h.length&&this._remove(h,!1);a=this.findIntent(a);e=new Map;b=c.length;for(g=0;g<b;g++)(h=c[g])&&h.attributes&&e.set(h.attributes[f],a);c.length&&this._add(c,e)}},remove:function(c){this._remove(c,!1)},
delete:function(c){this._remove(c,!0)},isDeleted:function(c){return this._deletedGraphicsIndex.has(c)},createIntentToAdd:function(c){c&&this._intentsIndex.forEach(function(a,b){c.forEach(function(b){a.ignoredIds.add(b)})},this);var a=g++;this._intentsIndex.set(a,{ignoredIds:new Set});this.notifyChange("updating");return a},findIntent:function(c){return this._intentsIndex.get(c)},removeIntent:function(c){this._intentsIndex.delete(c);this.notifyChange("updating")},update:function(c,a){if(c&&c.length){var f=
this.objectIdField,b=this.indexById=this.indexById||new Map,g=this._oldIndex;c=this._createIndexById(c,f);for(var f=this._extractObjectIds(c),e=this._extractObjectIds(b),h=this._extractObjectIds(g),e=e.concat(h),h=[],m=e.length,k=0;k<m;k++){var d=e[k];if(-1===f.indexOf(d))h.push(d);else{var q=b.get(d)||g.get(d),q=q&&q.graphic&&q.graphic._ts,p=c.get(d);(p&&p.graphic&&p.graphic._ts)>q&&h.push(d)}}b=[];g=f.length;for(k=0;k<g;k++)d=f[k],(-1===e.indexOf(d)||-1<h.indexOf(d))&&b.push(d);h.length&&this._remove(h,
!1);b.length&&this._add(this._extractGraphics(b,c),a)}},_createIndexById:function(c,a){var f;if(c&&c.length&&a){var b,g,e;f=new Map;for(b=0;g=c[b];b++)e=g.attributes&&g.attributes[a],null!=e&&f.set(e,{graphic:g,refCount:1})}return f},_add:function(c,a){var f=this.objectIdField;c.forEach(function(b){var c=a.get(b.attributes&&b.attributes[f]);this._addToIndex(b,this.indexById,c)},this);this.graphics.addMany(c);this.notifyChange("numGraphics")},_addToIndex:function(c,a,f){var b=c.attributes&&c.attributes[this.objectIdField];
a&&null!=b&&(a.has(b)?f&&f.ignoredIds.has(b)||(f=a.get(b),a.set(b,{graphic:c,refCount:f.refCount+1})):this.isDeleted(b)||a.set(b,{graphic:c,refCount:1}))},_remove:function(c,a){c=c||[];c="object"===typeof c[0]?c.map(function(a){return a.attributes&&a.attributes[this.objectIdField]}.bind(this)):c;var f=this._extractGraphics(c,this._oldIndex),b=this._extractGraphics(c,this.indexById);c.forEach(function(b){a&&this._deletedGraphicsIndex.add(b);this._removeFromIndex(b,this._oldIndex,a);this._removeFromIndex(b,
this.indexById,a)}.bind(this));this.graphics.removeMany(f.concat(b));this.notifyChange("numGraphics")},_removeFromIndex:function(c,a,f){if(a&&a.has(c))if(f)a.delete(c);else{f=a.get(c);var b=f.refCount-1;0===b?a.delete(c):f.refCount=b}},_removeLeftOnly:function(c,a){var f=[];c&&c.forEach(function(b,g){var e=b.graphic;!e||a&&a.has(g)||(--b.refCount,0===b.refCount&&c.delete(g),f.push(e))});return f},_extractGraphics:function(c,a){return c&&a?c.map(function(c){return(c=a.get(c))&&c.graphic}):[]},_extractObjectIds:function(c){var a=
[];c&&c.forEach(function(c,b){a.push(b)});return a}})})},"esri/views/3d/layers/graphics/Graphics3DVerticalScale":function(){define(["require","exports","../../../../geometry/support/scaleUtils"],function(n,g,c){return function(){function a(a){this.sourceSpatialReference=a.sourceSpatialReference;this.destSpatialReference=a.destSpatialReference}a.prototype.adjust=function(a){var b=this._getVerticalUnitScale();1!==b&&this._scaleVerticalUnits(a,b)};a.prototype._getVerticalUnitScale=function(){if(this.sourceSpatialReference&&
!this.sourceSpatialReference.equals(this.destSpatialReference)){var a=c.getMetersPerVerticalUnitForSR(this.sourceSpatialReference),b=c.getMetersPerVerticalUnitForSR(this.destSpatialReference);return a/b}return 1};a.prototype._vertexListsScaleZ=function(a,b){for(var c=0;c<a.length;++c)for(var e=a[c],f=0;f<e.length;++f)e[f][2]*=b};a.prototype._scaleVerticalUnits=function(a,b){for(var c=0;c<a.length;++c){var e=a[c].geometry;e&&e.hasZ&&(this._geometryIsPoint(e)?null!==e.z&&(e.z*=b):this._geometryIsPolyline(e)?
this._vertexListsScaleZ(e.paths,b):this._geometryIsPolygon(e)&&this._vertexListsScaleZ(e.rings,b))}};a.prototype._geometryIsPoint=function(a){return"point"===a.type};a.prototype._geometryIsPolygon=function(a){return"polygon"===a.type};a.prototype._geometryIsPolyline=function(a){return"polyline"===a.type};return a}()})},"esri/layers/SceneLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper dojo/promise/all ../PopupTemplate ../request ../core/Error ../core/Logger ../core/promiseUtils ../core/urlUtils ../core/accessorSupport/decorators ../core/accessorSupport/PropertyOrigin ../core/accessorSupport/utils ./FeatureLayer ./Layer ./mixins/SceneService ./support/commonProperties ./support/commonProperties ./support/FeatureReduction ./support/FeatureReductionSelection ./support/Field ./support/fieldUtils ./support/LabelClass ./support/labelingInfo ./support/RangeInfo ../portal/PortalItem ../renderers/support/jsonUtils ../renderers/support/styleUtils ../renderers/support/typeUtils ../symbols/support/ElevationInfo ../tasks/support/Query".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K,N,H,M,T){function V(a,b,c){a&&((a=K.read(a,b,c)||void 0)||J.error("Failed to create renderer",{rendererDefinition:a,layer:this,context:c}));return a}var U=["3DObject","Point"],J=m.getLogger("esri.layers.SceneLayer"),O={"mesh-pyramids":"mesh-pyramids",meshpyramids:"mesh-pyramids","features-meshes":"mesh-pyramids",points:"points","features-points":"points",lines:"lines","features-lines":"lines",polygons:"polygons","features-polygons":"polygons"},
P={"mesh-pyramids":"mesh",points:"point",lines:"polyline",polygons:"polygon"};return function(g){function m(a,b){a=g.call(this)||this;a.featureReduction=null;a.rangeInfos=null;a.operationalLayerType="ArcGISSceneServiceLayer";a.type="scene";a.fields=[];a.definitionExpression=null;a.labelsVisible=!0;a.labelingInfo=null;a.legendEnabled=!0;a.cachedDrawingInfo={color:!1};a.popupEnabled=!0;a.popupTemplate=null;a.objectIdField=null;a.objectIdFilter=null;a._fieldUsageInfo={};a.screenSizePerspectiveEnabled=
!0;return a}a(m,g);m.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?c({url:a},b):a};m.prototype.getField=function(a){return C.getField(a,this.fields)};Object.defineProperty(m.prototype,"elevationInfo",{set:function(a){this._set("elevationInfo",a);this.loaded&&this._validateElevationInfo()},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,"geometryType",{get:function(){return P[this.profile]||"mesh"},enumerable:!0,configurable:!0});Object.defineProperty(m.prototype,
"renderer",{set:function(a){C.fixRendererFields(a,this.fields);this._set("renderer",a)},enumerable:!0,configurable:!0});m.prototype.readCachedDrawingInfo=function(a,b){if(null==a||"object"!==typeof a)a={};null==a.color&&(a.color=!1);return a};m.prototype.readObjectIdField=function(a,b){!a&&b.fields&&b.fields.some(function(b){"esriFieldTypeOID"===b.type&&(a=b.name);return!!a});return a||void 0};m.prototype.readProfile=function(a,b){a=b.store.profile;if(null!=a&&O[a])return O[a];J.error("Unknown or missing profile",
{profile:a,layer:this});return"mesh-pyramids"};m.prototype.readNormalReferenceFrame=function(a,b){return b.store.normalReferenceFrame};m.prototype.load=function(){var a=this,c=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return b([a._verifyRootNodeAndUpdateExtent(),a._setCompanionFeatureLayer()])}).then(function(){return a._validateElevationInfo()}).then(function(){return a._applyCompanionOverrides()}).then(function(){return a._populateFieldUsageInfo()}).then(function(){return N.loadStyleRenderer(a,
{origin:"service"})}).then(function(){return C.fixRendererFields(a.renderer,a.fields)});this.addResolvingPromise(c);return this.when()};m.prototype.createLayerView=function(a){var b=this;return(null==this.profile||"mesh-pyramids"===this.profile?k.create(function(a){return n(["../views/3d/layers/SceneLayerView3D"],a)}):k.create(function(a){return n(["../views/3d/layers/SceneLayerGraphicsView3D"],a)})).then(function(c){return new c({view:a,layer:b})})};m.prototype.createQuery=function(){var a=new T;
"mesh"!==this.geometryType&&(a.returnGeometry=!0,a.returnZ=!0);a.where=this.definitionExpression||"1\x3d1";a.sqlFormat="standard";return a};m.prototype.queryExtent=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryExtent(a||b.createQuery())})};m.prototype.queryFeatureCount=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatureCount(a||b.createQuery())})};m.prototype.queryFeatures=function(a){var b=this;
return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeatures(a||b.createQuery())}).then(function(a){if(a&&a.features)for(var c=0,d=a.features;c<d.length;c++){var e=d[c];e.layer=b;e.sourceLayer=b}return a})};m.prototype.queryFeaturesJSON=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryFeaturesJSON(a||b.createQuery())})};m.prototype.queryObjectIds=function(a){var b=this;return this._getAssociatedLayerForQuery().then(function(c){return c.queryObjectIds(a||
b.createQuery())})};m.prototype.getFieldUsageInfo=function(a){var b={supportsLabelingInfo:!1,supportsRenderer:!1,supportsPopupTemplate:!1,supportsLayerQuery:!1};return this.loaded?this._fieldUsageInfo[a]||b:(J.error("#getFieldUsageInfo()","Unavailable until layer is loaded"),b)};m.prototype._getAssociatedLayerForQuery=function(){var a=this;if(!this.loaded)return this.load().then(function(){return a._getAssociatedLayerForQuery()});var b=this.associatedLayer;return null!=b?k.resolve(b):k.reject(new h("scenelayer:query-not-available",
"SceneLayer queries are not available without associated feature layer"))};m.prototype.hasCachedStatistics=function(a){return null!=this.statisticsInfo&&this.statisticsInfo.some(function(b){return b.name===a})};m.prototype.queryCachedStatistics=function(a){if(!this.hasCachedStatistics(a))return k.reject(new h("scenelayer:no-cached-statistics","Cached statistics for this attribute are not available"));for(var b=0,c=this.statisticsInfo;b<c.length;b++){var f=c[b];if(f.name===a)return a=d.join(this.parsedUrl.path,
f.href),e(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data})}};m.prototype.graphicChanged=function(a){this.emit("graphic-update",a)};m.prototype._validateLayer=function(a){if(a.layerType&&-1===U.indexOf(a.layerType))throw new h("scenelayer:layer-type-not-supported","SceneLayer does not support this layer type",{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new h("layer:service-version-not-supported","Service version is not supported.",
{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new h("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});a=this.normalReferenceFrame;var b=this.spatialReference,c=!1,d=!1;if(null==a)d=c=!0;else switch(b=b&&b.isGeographic,a){case "east-north-up":case "earth-centered":c=!0;d=b;break;case "vertex-reference-frame":c=!0;d=!b;break;default:c=!1}if(!c)throw new h("scenelayer:unsupported-normal-reference-frame",
"Normal reference frame is invalid.");if(!d)throw new h("scenelayer:incompatible-normal-reference-frame","Normal reference frame is incompatible with layer spatial reference.");};m.prototype._populateFieldUsageInfo=function(){this._fieldUsageInfo={};if(this.fields)for(var a=function(a){var c=!(!b.attributeStorageInfo||!b.attributeStorageInfo.some(function(b){return b.name===a.name})),d=!!(b.associatedLayer&&b.associatedLayer.fields&&b.associatedLayer.fields.some(function(b){return b&&a.name===b.name}));
b._fieldUsageInfo[a.name]={supportsLabelingInfo:c,supportsRenderer:c,supportsPopupTemplate:c||d,supportsLayerQuery:d}},b=this,c=0,d=this.fields;c<d.length;c++)a(d[c])};m.prototype._applyCompanionOverrides=function(){if(this.associatedLayer){if(this.associatedLayer.fields)for(var a=0,b=this.associatedLayer.fields;a<b.length;a++){var c=b[a];this.getField(c.name)||this.fields.push(c.clone())}a=["popupTemplate","popupEnabled"];b=r.getProperties(this);for(c=0;c<a.length;c++){var d=a[c];this._buddyIsMoreImportant(d)&&
(b.setDefaultOrigin(this.associatedLayer.originOf(d)),b.set(d,this.associatedLayer[d]),b.setDefaultOrigin("user"))}}};m.prototype._setCompanionFeatureLayer=function(){var a=this;return this._fetchCompanionFeatureLayer().then(function(b){a.associatedLayer=b})};m.prototype._fetchCompanionFeatureLayer=function(){var a=this;return-1===["mesh-pyramids","points"].indexOf(this.profile)?k.resolve(null):(this.portalItem&&this.portalItem.isResolved()?this._fetchCompanionFeatureLayerFromRelatedItems(this.portalItem):
this._fetchCompanionFeatureLayerFromUrl()).then(function(a){return a.load()}).catch(function(b){null==a.attributeStorageInfo?J.warn("Companion FeatureLayer could not be loaded and no binary attributes found. Popups will not work for this SceneLayer: "+a.title):J.info("Companion FeatureLayer could not be loaded. Falling back to binary attributes for Popups on this SceneLayer: "+a.title);return null})};m.prototype._fetchCompanionFeatureLayerFromRelatedItems=function(a){var b=this;return a.fetchRelatedItems({relationshipType:"Service2Service",
direction:"reverse"}).then(function(a){return(a=a.filter(function(a){return"Feature Service"===a.type})[0])?b._fetchCompanionFeatureLayerFromPortalItem(new I({id:a.id,portal:a.portal})):k.reject()}).catch(function(){return b._fetchCompanionFeatureLayerFromUrl()})};m.prototype._fetchCompanionFeatureLayerFromPortalItem=function(a){var b=this;return a.load().then(function(a){return b._findMatchingCompanionSublayerUrl(a.url)}).then(function(b){return k.resolve(new u({url:b,portalItem:a}))})};m.prototype._fetchCompanionFeatureLayerFromUrl=
function(){return this._findMatchingCompanionSublayerUrl().then(function(a){return k.resolve(new u({url:a}))})};m.prototype._findMatchingCompanionSublayerUrl=function(a){var c=this.parsedUrl.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);if(!c)return k.reject();null==a&&(a=c[1]+"/FeatureServer");var d=a.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1");a={query:{f:"json"},responseType:"json"};var f=c[1]+"/SceneServer",g=parseInt(c[2],10),c=e(f,a).catch(function(a){return{layers:null}});a=
e(d,a);return b([a,c]).then(function(a){var b=a[0];a=a[1];a=a.data&&a.data.layers;b=b.data&&b.data.layers;if(!Array.isArray(b))throw Error("expected layers array");if(Array.isArray(a))for(var c=0;c<Math.min(a.length,b.length);c++){if(a[c].id===g)return d+"/"+b[c].id}else if(g<b.length)return d+"/"+b[g].id;throw Error("could not find matching associated sublayer");})};m.prototype._buddyIsMoreImportant=function(a){if(!this.associatedLayer)return!1;var b=p.nameToId(this.originOf(a));a=p.nameToId(this.associatedLayer.originOf(a));
return null!=a&&a<=p.OriginId.SERVICE?null==b||b<p.OriginId.SERVICE:null!=a&&a<=p.OriginId.PORTAL_ITEM?null==b||b<p.OriginId.PORTAL_ITEM:!1};m.prototype._validateElevationInfo=function(){var a=this.elevationInfo;a&&("mesh-pyramids"===this.profile&&"absolute-height"!==a.mode&&J.warn(".elevationInfo\x3d","Mesh scene layers only support absolute-height elevation mode"),a.featureExpressionInfo&&"0"!==a.featureExpressionInfo.expression&&J.warn(".elevationInfo\x3d","Scene layers do not support featureExpressionInfo"))};
f([q.shared("esri.layers.SceneLayer")],m.prototype,"declaredClass",void 0);f([q.property({types:{key:"type",base:x.default,typeMap:{selection:B.default}},json:{origins:{"web-scene":{read:{source:"layerDefinition.featureReduction"},write:{target:"layerDefinition.featureReduction"}}}}})],m.prototype,"featureReduction",void 0);f([q.property({type:[F.default],json:{read:!1,origins:{"web-scene":{read:{source:"layerDefinition.rangeInfos"},write:{target:"layerDefinition.rangeInfos"}}}}})],m.prototype,"rangeInfos",
void 0);f([q.property()],m.prototype,"associatedLayer",void 0);f([q.property()],m.prototype,"operationalLayerType",void 0);f([q.property({json:{read:!1},readOnly:!0})],m.prototype,"type",void 0);f([q.property({type:[D]})],m.prototype,"fields",void 0);f([q.property({readOnly:!0})],m.prototype,"attributeStorageInfo",void 0);f([q.property({readOnly:!0})],m.prototype,"statisticsInfo",void 0);f([q.property({type:String,json:{origins:{service:{read:!1,write:!1}},read:{source:"layerDefinition.definitionExpression"},
write:{target:"layerDefinition.definitionExpression"}}})],m.prototype,"definitionExpression",void 0);f([q.property({value:null,type:M,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],m.prototype,"elevationInfo",null);f([q.property({type:String,dependsOn:["profile"]})],m.prototype,"geometryType",null);f([q.property(A.labelsVisible)],m.prototype,"labelsVisible",void 0);f([q.property({type:[G],json:{origins:{service:{read:{source:"drawingInfo.labelingInfo",
reader:E.reader},write:{target:"drawingInfo.labelingInfo",enabled:!1}}},read:{source:"layerDefinition.drawingInfo.labelingInfo",reader:E.reader},write:{target:"layerDefinition.drawingInfo.labelingInfo"}}})],m.prototype,"labelingInfo",void 0);f([q.property({type:Boolean,json:{origins:{service:{read:{enabled:!1}}},read:{source:"showLegend"},write:{target:"showLegend"}}})],m.prototype,"legendEnabled",void 0);f([q.property({types:H.types,json:{origins:{service:{read:{source:"drawingInfo.renderer",reader:V}}},
read:{source:"layerDefinition.drawingInfo.renderer",reader:V},write:{target:"layerDefinition.drawingInfo.renderer"}},value:null})],m.prototype,"renderer",null);f([q.property({json:{read:!1}})],m.prototype,"cachedDrawingInfo",void 0);f([q.reader("service","cachedDrawingInfo")],m.prototype,"readCachedDrawingInfo",null);f([q.property(A.popupEnabled)],m.prototype,"popupEnabled",void 0);f([q.property({type:l,json:{read:{source:"popupInfo"},write:{target:"popupInfo"}}})],m.prototype,"popupTemplate",void 0);
f([q.property({type:String,json:{read:!1}})],m.prototype,"objectIdField",void 0);f([q.reader("service","objectIdField",["objectIdField","fields"])],m.prototype,"readObjectIdField",null);f([q.property()],m.prototype,"objectIdFilter",void 0);f([q.property({type:String,json:{read:!1}})],m.prototype,"profile",void 0);f([q.reader("service","profile",["store.profile"])],m.prototype,"readProfile",null);f([q.property({readOnly:!0,type:String,json:{read:!1}})],m.prototype,"normalReferenceFrame",void 0);f([q.reader("service",
"normalReferenceFrame",["store.normalReferenceFrame"])],m.prototype,"readNormalReferenceFrame",null);f([q.property(z.screenSizePerspectiveEnabled)],m.prototype,"screenSizePerspectiveEnabled",void 0);return m=f([q.subclass()],m)}(q.declared(t,v))})},"esri/layers/mixins/SceneService":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../request ../../core/Error ../../core/Logger ../../core/MultiOriginJSONSupport ../../core/promiseUtils ../../core/urlUtils ../../core/accessorSupport/decorators ../../geometry/Extent ../../geometry/HeightModelInfo ../../geometry/SpatialReference ../Layer ./ArcGISService ./OperationalLayer ./PortalLayer ../support/arcgisLayerUrl".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A){var z=l.getLogger("esri.layers.mixins.SceneService");return function(e){function g(){var a=null!==e&&e.apply(this,arguments)||this;a.blendMode=null;a.spatialReference=null;a.fullExtent=null;a.heightModelInfo=null;a.version={major:Number.NaN,minor:Number.NaN,versionString:""};a.copyright=null;a.sublayerTitleMode="item-title";a.title=null;a.layerId=null;return a}c(g,e);g.prototype.readSpatialReference=function(a,b){return this._readSpatialReference(b)};
g.prototype._readSpatialReference=function(a){if(null!=a.spatialReference)return p.fromJSON(a.spatialReference);a=a.store;a=(a=a.indexCRS||a.geographicCRS)&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10);return null!=a?new p(a):null};g.prototype.readFullExtent=function(a,b){a=b.store;b=this._readSpatialReference(b);return null==b||null==a||null==a.extent?null:new d({xmin:a.extent[0],ymin:a.extent[1],xmax:a.extent[2],ymax:a.extent[3],spatialReference:b})};g.prototype.readVersion=function(a,
b){a=b.store;b=null!=a.version?a.version.toString():"";a={major:Number.NaN,minor:Number.NaN,versionString:b};b=b.split(".");2<=b.length&&(a.major=parseInt(b[0],10),a.minor=parseInt(b[1],10));return a};g.prototype.readTitlePortalItem=function(a,b){return"item-title"!==this.sublayerTitleMode?void 0:a};g.prototype.readTitleService=function(a,b){a=this.portalItem&&this.portalItem.title;if("item-title"===this.sublayerTitleMode)return A.titleFromUrlAndName(this.url,b.name);b=b.name||A.parse(this.url).title;
"item-title-and-service-name"===this.sublayerTitleMode&&a&&(b=a+" - "+b);return A.cleanTitle(b)};g.prototype.readLayerId=function(a,b){return b.id};Object.defineProperty(g.prototype,"url",{set:function(a){a=A.sanitizeUrlWithLayerId(this,a,z);this._set("url",a.url);null!=a.layerId&&this._set("layerId",a.layerId)},enumerable:!0,configurable:!0});g.prototype.writeUrl=function(a,b){A.writeUrlWithLayerId(this,a,"layers",b)};Object.defineProperty(g.prototype,"parsedUrl",{get:function(){var a=this._get("url");
if(!a)return null;a=m.urlToObject(a);null!=this.layerId&&A.match.test(a.path)&&(a.path=a.path+"/layers/"+this.layerId);return a},enumerable:!0,configurable:!0});g.prototype.readRootNode=function(a,b){return b.store.rootNode};g.prototype._verifyRootNodeAndUpdateExtent=function(){var a=this;return this._fetchRootNode().then(function(b){return a._updateExtentFromRootNode(b)})};g.prototype._updateExtentFromRootNode=function(a){if(null!=this.fullExtent&&!this.fullExtent.hasZ&&null!=a&&Array.isArray(a.mbs)&&
4===a.mbs.length){var b=a.mbs[2];a=a.mbs[3];this.fullExtent.zmin=b-a;this.fullExtent.zmax=b+a}};g.prototype._fetchRootNode=function(){if(!this.rootNode)return h.resolve();var a=m.join(this.parsedUrl.path,this.rootNode);return f(a,{query:{f:"json"},responseType:"json"}).then(function(a){return a.data}).catch(function(c){throw new b("sceneservice:root-node-missing","Root node missing.",{error:c,url:a});})};g.prototype._fetchService=function(){var a=this;return(null==this.layerId&&/SceneServer\/*$/i.test(this.url)?
this._fetchFirstLayerId().then(function(b){null!=b&&(a.layerId=b)}):h.resolve()).then(function(){return a._fetchServiceLayer()})};g.prototype._fetchFirstLayerId=function(){return f(this.url,{query:{f:"json"},responseType:"json"}).then(function(a){if(a.data&&Array.isArray(a.data.layers)&&0<a.data.layers.length)return a.data.layers[0].id})};g.prototype._fetchServiceLayer=function(){var a=this;return f(this.parsedUrl.path,{query:{f:"json"},responseType:"json"}).then(function(b){b.ssl&&(a.url=a.url.replace(/^http:/i,
"https:"));b=b.data;a.read(b,{origin:"service",url:a.parsedUrl});a._validateLayer(b)})};g.prototype._validateLayer=function(a){};a([k.shared({id:{json:{origins:{service:{read:!1},"portal-item":{read:!1}}}}})],g.prototype,"properties",void 0);a([k.property({type:p})],g.prototype,"spatialReference",void 0);a([k.reader("spatialReference",["spatialReference","store.indexCRS","store.geographicCRS"])],g.prototype,"readSpatialReference",null);a([k.property({type:d})],g.prototype,"fullExtent",void 0);a([k.reader("fullExtent",
["store.extent","spatialReference","store.indexCRS","store.geographicCRS"])],g.prototype,"readFullExtent",null);a([k.property({readOnly:!0,type:q})],g.prototype,"heightModelInfo",void 0);a([k.property({readOnly:!0})],g.prototype,"version",void 0);a([k.reader("version",["store.version"])],g.prototype,"readVersion",null);a([k.property({type:String,json:{read:{source:"copyrightText"}}})],g.prototype,"copyright",void 0);a([k.property({type:String})],g.prototype,"sublayerTitleMode",void 0);a([k.property({type:String})],
g.prototype,"title",void 0);a([k.reader("portal-item","title")],g.prototype,"readTitlePortalItem",null);a([k.reader("service","title",["name"])],g.prototype,"readTitleService",null);a([k.property({type:Number})],g.prototype,"layerId",void 0);a([k.reader("service","layerId",["id"])],g.prototype,"readLayerId",null);a([k.property()],g.prototype,"url",null);a([k.writer("url")],g.prototype,"writeUrl",null);a([k.property({dependsOn:["layerId"]})],g.prototype,"parsedUrl",null);a([k.property()],g.prototype,
"store",void 0);a([k.property({type:String})],g.prototype,"rootNode",void 0);a([k.reader("rootNode",["store.rootNode"])],g.prototype,"readRootNode",null);return g=a([k.subclass("esri.layers.mixins.SceneService")],g)}(k.declared(r,u,e,t,v))})},"esri/layers/support/RangeInfo":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/JSONSupport ../../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,
"__esModule",{value:!0});n=function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a.name=null;a.field=null;a.currentRangeExtent=null;a.fullRangeExtent=null;a.type="rangeInfo";return a}c(e,f);a([b.property({type:String,json:{read:!0,write:!0}})],e.prototype,"name",void 0);a([b.property({type:String,json:{read:!0,write:!0}})],e.prototype,"field",void 0);a([b.property({type:[Number],json:{read:!0,write:!0}})],e.prototype,"currentRangeExtent",void 0);a([b.property({type:[Number],json:{read:!0,
write:!0}})],e.prototype,"fullRangeExtent",void 0);a([b.property({type:String,readOnly:!0,json:{read:!1,write:!0}})],e.prototype,"type",void 0);return e=a([b.subclass("esri.layers.support.RangeInfo")],e)}(b.declared(f));g.RangeInfo=n;g.default=n})},"esri/views/3d/layers/ElevationLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ./TiledLayerView3D ./support/tiledLayerUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m){return function(g){function d(){return null!==g&&g.apply(this,arguments)||this}c(d,g);d.prototype.initialize=function(){var a=this,c=this.get("view.map.ground.layers"),d=this.get("view.map.allLayers"),d=d&&d.includes(this.layer),c=c&&c.includes(this.layer);d&&!c&&(c=new f("layerview:elevation-layer-only","3D elevation layer '"+this.layer.id+"' can only be added in the map ground"),this.addResolvingPromise(b.reject(c)));(c=this._getTileInfoSupportError(this.tileInfo,this.layer.fullExtent))?
this.addResolvingPromise(b.reject(c)):(c=l.whenTrueOnce(this.view,"basemapTerrain.tilingSchemeLocked").then(function(){m.throwIfError(a._getTileInfoCompatibilityError(a.tileInfo,a.view.basemapTerrain.tilingScheme))}),this.addResolvingPromise(c));this.addResolvingPromise(m.checkArcGISServiceVersionCompatibility(this.layer));this._updateMinMaxDataLevel()};a([e.property({aliasOf:"layer.fullExtent"})],d.prototype,"fullExtent",void 0);a([e.property()],d.prototype,"layer",void 0);a([e.property({aliasOf:"layer.tileInfo"})],
d.prototype,"tileInfo",void 0);return d=a([e.subclass("esri.views.3d.layers.ElevationLayerView3D")],d)}(e.declared(h))})},"esri/views/3d/layers/TiledLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper ../../../core/Error ../../../core/accessorSupport/decorators ./LayerView3D ./support/layerViewUpdatingProperties ../terrain/terrainUtils".split(" "),function(n,g,c,a,f,b,l,e,h){return function(g){function k(){var a=null!==g&&g.apply(this,
arguments)||this;a.minDataLevel=0;a.maxDataLevel=Infinity;a._isUpdating=!1;return a}c(k,g);Object.defineProperty(k.prototype,"imageFormatIsOpaque",{get:function(){return!1},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"isOpaque",{get:function(){return 1<=this.fullOpacity&&this.imageFormatIsOpaque},enumerable:!0,configurable:!0});k.prototype.getTileUrl=function(a,b,c){return this.layer.getTileUrl(a,b,c)};k.prototype.updatingChanged=function(a){this._isUpdating=a;this.notifyChange("updating")};
k.prototype.isUpdating=function(){return this._isUpdating};k.prototype._getTileInfoSupportError=function(a,b){if(a=h.checkIfTileInfoSupportedForView(a,b,this.view.spatialReference,this.view.basemapTerrain.manifold)){b={layer:this.layer,error:a};var c=void 0;switch(a.name){case "tilingscheme:local-gcs-not-supported":c=new f("layerview:local-gcs-not-supported","Geographic coordinate systems are not supported in local scenes",b);break;case "tilingscheme:spatial-reference-mismatch":case "tilingscheme:global-unsupported-spatial-reference":c=
new f("layerview:spatial-reference-incompatible","The spatial reference of this layer does not meet the requirements of the view",b);break;default:c=new f("layerview:tiling-scheme-unsupported","The tiling scheme of this layer is not supported by SceneView",b)}return c}return null};k.prototype._getTileInfoCompatibilityError=function(a,b){return b.compatibleWith(a)?null:new f("layerview:tiling-scheme-incompatible","The tiling scheme of this layer is incompatible with the tiling scheme of the surface")};
k.prototype._updateMinMaxDataLevel=function(){var a,b=Infinity,c=0;this.tileInfo.lods.forEach(function(a){b=Math.min(a.level,b);c=Math.max(a.level,c)});a=[b,c];this.minDataLevel=a[0];this.maxDataLevel=a[1]};a([b.property({readOnly:!0})],k.prototype,"imageFormatIsOpaque",null);a([b.property(e.updatingPercentage)],k.prototype,"updatingPercentage",void 0);a([b.property(e.updatingPercentageValue)],k.prototype,"updatingPercentageValue",void 0);a([b.property()],k.prototype,"fullExtent",void 0);a([b.property({readOnly:!0,
dependsOn:["fullOpacity","imageFormatIsOpaque"]})],k.prototype,"isOpaque",null);a([b.property()],k.prototype,"layer",void 0);a([b.property()],k.prototype,"minDataLevel",void 0);a([b.property()],k.prototype,"maxDataLevel",void 0);a([b.property()],k.prototype,"tileInfo",void 0);return k=a([b.subclass("esri.views.3d.layers.TiledLayerView3D")],k)}(b.declared(l))})},"esri/views/3d/layers/LayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../geometry/support/heightModelInfoUtils ../../layers/LayerView".split(" "),
function(n,g,c,a,f,b,l,e,h){return function(g){function h(){var a=null!==g&&g.apply(this,arguments)||this;a.slicePlaneEnabled=!1;a.supportsHeightUnitConversion=!1;return a}c(h,g);h.prototype.postscript=function(a){this.inherited(arguments);e.mayHaveHeightModelInfo(this.layer)&&this.addResolvingPromise(this._validateHeightModelInfo())};h.prototype._validateHeightModelInfo=function(){var a=this;return f.create(function(c,d){b.whenFalseOnce(a.view.defaultsFromMap,"isHeightModelInfoSearching",function(){var b=
e.rejectLayerError(a.layer,a.view.heightModelInfo,a.supportsHeightUnitConversion);b?d(b):c()})})};a([l.property()],h.prototype,"view",void 0);a([l.property()],h.prototype,"slicePlaneEnabled",void 0);return h=a([l.subclass("esri.views.3d.layers.LayerView3D")],h)}(l.declared(h))})},"esri/views/3d/layers/support/layerViewUpdatingProperties":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.updatingPercentageValue={value:100,readOnly:!0};g.updatingPercentage=
{dependsOn:["updating","updatingPercentageValue"],readOnly:!0,value:0,get:function(){return this.updating?this.updatingPercentageValue:0}}})},"esri/views/3d/layers/support/tiledLayerUtils":function(){define("require exports dojo/request/xhr ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/support/arcgisLayerUrl".split(" "),function(n,g,c,a,f,b){function l(a){var b=null,c=a.search(/\/rest\/services\//i);0<c&&(b=a.substring(0,c+6));return b}Object.defineProperty(g,"__esModule",
{value:!0});g.checkArcGISServiceVersionCompatibility=function(e){if(!b.isHostedAgolService(e.url)){if(10.22>e.version)return e=new a("layerview:service-version-too-old","Tiled Map Layers on servers prior to 10.2.2 are not supported. Detected version: "+e.version,{minVersion:10.22,detectedVersion:e.version}),f.reject(e);if(10.22!==e.version||b.isHostedSecuredProxyService(e.url,e.get("portalItem.id")))return f.resolve();e=l(e.url);var g=new a("tiledlayerview3d:service-missing-cors-patch","Tiled Map Layers from 10.2.2 servers are only supported if all server updates have been applied.");
return c(e+"self?f\x3djson",{headers:{"X-Requested-With":null},timeout:1E4,handleAs:"json"}).then(function(a){if(!a||a.error)throw g;}).catch(function(){throw g;})}};g.throwIfError=function(a){if(a)throw a;}})},"esri/views/3d/layers/FeatureLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/assignHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../Graphic ../../../core/Collection ../../../core/Error ../../../core/Evented ../../../core/has ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/controllers/support/controllerUtils ../../../layers/graphics/sources/MemorySource ./FeatureLikeLayerView3D ../../layers/RefreshableLayerView".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A){g=function(f){function g(a){return f.call(this)||this}c(g,f);k=g;Object.defineProperty(g.prototype,"controllerTypeForSource",{get:function(){return this.layer.source&&this.layer.source.isInstanceOf&&this.layer.source.isInstanceOf(t.default)?"memory":d("enable-feature:jkieboom/manyfeatures-lines-and-polygons")||"point"===this.layer.geometryType?"feature-tile-3d":"snapshot"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"asyncGraphicsUpdates",
{get:function(){if(this.controller&&"feature-tile-3d"===this.controller.type)switch(this.controller.mode){case "snapshot":return!1;case "tiles":return!0}switch(this.controller?this.controller.type:this.controllerTypeForSource){case "feature-tile-3d":return!0;case "memory":case "snapshot":return!1}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"suspendResumeExtentMode",{get:function(){if(this.controller&&"feature-tile-3d"===this.controller.type)return this.controller.suspendResumeExtentMode;
switch(this.controller?this.controller.type:this.controllerTypeForSource){case "feature-tile-3d":return"data";case "memory":case "snapshot":return"computed"}},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"displayLimitExceeded",{get:function(){return this.controller&&"feature-tile-3d"===this.controller.type?!(this.suspended||!this.controller.displayLimitExceeded):!1},enumerable:!0,configurable:!0});g.prototype.createController=function(){return l(this,void 0,void 0,function(){var a;
return b(this,function(b){switch(b.label){case 0:a=this.controllerTypeForSource;switch(a){case "memory":return[3,1];case "snapshot":return[3,3];case "feature-tile-3d":return[3,5]}return[3,7];case 1:return[4,this.createMemoryController()];case 2:return[2,b.sent()];case 3:return[4,this.createSnapshotController()];case 4:return[2,b.sent()];case 5:return[4,this.createFeatureTileController()];case 6:return[2,b.sent()];case 7:return[3,8];case 8:return[2]}})})};g.prototype.createMemoryController=function(){return l(this,
void 0,void 0,function(){var a;return b(this,function(b){switch(b.label){case 0:return[4,q.create(function(a){n(["../../../layers/graphics/controllers/MemoryController"],a)})];case 1:return a=b.sent(),[2,new a({layerView:this,layer:this.layer,graphics:this.layer.source})]}})})};g.prototype.createFeatureTileController=function(){return l(this,void 0,void 0,function(){var a,c,d=this;return b(this,function(b){switch(b.label){case 0:return[4,q.create(function(a){n(["../../../layers/graphics/controllers/FeatureTileController3D"],
a)})];case 1:return a=b.sent(),c=new a({layerView:this,graphics:new z,extent:this.clippingExtent}),this.handles.add([c.watch("suspendResumeExtentMode",function(){return d.notifyChange("suspendResumeExtentMode")},!0),c.watch("displayLimitExceeded",function(){return d.notifyChange("displayLimitExceeded")},!0),c.watch("mode",function(){return d.notifyChange("asyncGraphicsUpdates")},!0)]),this.handles.add(p.init(c,"serviceDataExtent",function(a){return d.graphics3d.dataExtent=a})),this.handles.add(p.init(this,
"suspended",function(a){a?c.suspend():c.resume()},!0)),this.handles.add(p.init(this.graphics3d.graphicsCore,"maxNumberOfFeatures",function(a){c.displayFeatureLimit={min:Math.ceil(x*a),max:a,perTile:Math.ceil(B*a)}})),[2,c]}})})};g.prototype.createSnapshotController=function(){return l(this,void 0,void 0,function(){var a,c,d;return b(this,function(b){switch(b.label){case 0:return this.addResolvingPromise(this.validateMaximumFeatureCount()),[4,q.create(function(a){n(["../../../layers/graphics/controllers/SnapshotController"],
a)})];case 1:return a=b.sent(),c=h.ofType(e),d=new a({layerView:this,layer:this.layer,graphics:new c,maxPageSize:300,defaultReturnZ:!0,extent:this.clippingExtent}),[4,d.when()];case 2:return b.sent(),this.handles.add(p.whenFalseOnce(this,"suspended",function(){d.startup()})),[2,d]}})})};g.prototype.validateMaximumFeatureCount=function(){return 0>k.maximumFeatureCount||!this.layer.url?q.resolve():this.layer.queryFeatureCount().then(function(a){if(a>k.maximumFeatureCount)throw new m("featurelayerview3d:maximum-feature-count-exceeded",
"The maximum number of allowed features (${maximumFeatureCount}) has been exceeded (layer has ${numberOfFeatures} features)",{maximumFeatureCount:k.maximumFeatureCount,numberOfFeatures:a});})};g.prototype.doRefresh=function(){!this.suspended&&u.isRefreshable(this.controller)&&this.controller.refresh()};var k;g.maximumFeatureCount=-1;a([r.property()],g.prototype,"layer",void 0);a([r.property()],g.prototype,"controller",void 0);a([r.property({readOnly:!0,dependsOn:["layer"]})],g.prototype,"controllerTypeForSource",
null);a([r.property({readOnly:!0,dependsOn:["controllerTypeForSource","controller"]})],g.prototype,"asyncGraphicsUpdates",null);a([r.property({readOnly:!0,dependsOn:["controllerTypeForSource","controller"]})],g.prototype,"suspendResumeExtentMode",null);a([r.property({dependsOn:["suspended","controller"]})],g.prototype,"displayLimitExceeded",null);return g=k=a([r.subclass("esri.views.3d.layers.FeatureLayerView3D")],g)}(r.declared(v,A));var z=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||
this;a.items=new Set;return a}c(d,b);e=d;Object.defineProperty(d.prototype,"length",{get:function(){return this.items.size},enumerable:!0,configurable:!0});d.prototype.addMany=function(a){for(var b=0;b<a.length;b++)this.items.add(a[b]);this.emit("change",{added:a,removed:[],moved:[]})};d.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.items.delete(a[b]);this.emit("change",{added:[],removed:a,moved:[]});return a};d.prototype.removeAll=function(){var a=this.toArray();this.emit("change",
{added:[],removed:a,moved:[]})};d.prototype.toArray=function(){var a=[];this.items.forEach(function(b){return a.push(b)});return a};d.prototype.forEach=function(a){this.items.forEach(a)};d.prototype.some=function(a){return this.toArray().some(a)};d.prototype.find=function(a){var b=null;this.forEach(function(c){!b&&a(c)&&(b=c)});return b};d.prototype.filter=function(a){var b=new e;this.forEach(function(c){a(c)&&b.items.add(c)});return b};var e;return d=e=a([r.subclass("esri.views.3d.layers.FeatureLayerView3D.SetCollection")],
d)}(r.declared(k)),x=.1,B=.25;return g})},"esri/layers/graphics/controllers/support/controllerUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.isRefreshable=function(c){return c&&c.refresh}})},"esri/views/3d/layers/FeatureLikeLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/awaiterHelper ../../../core/Error ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/QueryEngine ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/stats ./support/projectExtentUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t){return function(g){function p(a){a=g.call(this)||this;a.controller=null;a.asyncGraphicsUpdates=!1;a.suspendResumeExtentMode="computed";a.slicePlaneEnabled=!1;a.supportsDraping=!0;a.overlayUpdating=!1;a.fullExtentInLocalViewSpatialReference=null;a.suspendResumeExtent=null;a._queryEngine=null;a._controllerCreated=!1;a._controllerClientSideFiltering=!1;a.clippingExtent=null;a.supportsHeightUnitConversion=!0;return a}c(p,g);p.prototype.initialize=function(){var a=
this;this._set("graphics3d",new r({owner:this,layer:this.layer,frustumVisibilityEnabled:!0,scaleVisibilityEnabled:!0,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!0,asyncGraphicsUpdates:this.asyncGraphicsUpdates,suspendResumeExtentMode:this.suspendResumeExtentMode,updateClippingExtent:function(b){return a.updateClippingExtent(b)}}));this.handles.add([this.watch("asyncGraphicsUpdates",function(b){a.graphics3d.graphicsCore.asyncUpdates=b}),this.watch("suspendResumeExtentMode",function(b){a.graphics3d.suspendResumeExtentMode=
b})]);this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this.addResolvingPromise(this.graphics3d.setup().then(function(){return a.validateGeometryType()}).then(function(){return t.toViewIfLocal(a)}).then(function(b){a.fullExtentInLocalViewSpatialReference=b}).then(function(){return a.initializeController()}));this.notifyChange("updating")};p.prototype.destroy=function(){this.controller&&(this.controller.destroy(),this.controller=null);this.graphics3d&&(this.graphics3d.destroy(),this._set("graphics3d",
null));this.loadedGraphics=null};Object.defineProperty(p.prototype,"drawingOrder",{set:function(a){this.graphics3d.graphicsCore.setDrawingOrder(a);this._set("drawingOrder",a)},enumerable:!0,configurable:!0});p.prototype.getRenderingInfo=function(a){if((a=q.getRenderingInfo(a,{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a};p.prototype.getGraphicFromGraphicUid=function(a){var b=this,c=null;this.loadedGraphics&&this.loadedGraphics.forEach(function(d){d.uid===
a&&(c=k.hydrateGraphic(d,b.layer))});return e.create(function(a,b){null!==c?a(c):b()})};Object.defineProperty(p.prototype,"graphics3DGraphics",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphics:null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"graphics3DGraphicsKeys",{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.graphics3DGraphicsKeys:null},enumerable:!0,configurable:!0});Object.defineProperty(p.prototype,"symbolUpdateType",
{get:function(){return this.graphics3d?this.graphics3d.graphicsCore.symbolUpdateType:null},enumerable:!0,configurable:!0});p.prototype.whenGraphicBounds=function(a,b){return this.graphics3d?this.graphics3d.graphicsCore.whenGraphicBounds(a,b):null};p.prototype.queryFeatures=function(a){return this._queryEngine?this._queryEngine.queryFeatures(a):this._rejectQuery()};p.prototype.queryObjectIds=function(a){return this._queryEngine?this._queryEngine.queryObjectIds(a):this._rejectQuery()};p.prototype.queryFeatureCount=
function(a){return this._queryEngine?this._queryEngine.queryFeatureCount(a):this._rejectQuery()};p.prototype.queryExtent=function(a){return this._queryEngine?this._queryEngine.queryExtent(a):this._rejectQuery()};p.prototype.highlight=function(a,b){return this.graphics3d.highlight(a,b,this.layer.objectIdField)};p.prototype.getStats=function(){var a=u.stats(this,this.graphics3d.graphicsCore);a.elevationUpdating=this.graphics3d.elevationAlignment.updating;a.visibilityFrustum=!this.graphics3d.frustumVisibility.suspended;
a.visibilityScale=!this.graphics3d.scaleVisibility.suspended;return a};p.prototype.canResume=function(){return!this.inherited(arguments)||this.graphics3d&&this.graphics3d.suspended?!1:!0};p.prototype.isUpdating=function(){return!this.graphics3d||this.graphics3d.destroyed?!1:!this._controllerCreated||this.controller&&this.controller.updating||this.overlayUpdating||!(this.view.basemapTerrain&&this.view.basemapTerrain.ready)||this.graphics3d.updating};p.prototype.initializeController=function(){return b(this,
void 0,void 0,function(){var a;return f(this,function(b){switch(b.label){case 0:return[4,this.createController()];case 1:return a=b.sent(),[4,a.when()];case 2:return b.sent(),this.setControllerWhenInitialized(a),[2]}})})};p.prototype.setControllerWhenInitialized=function(a){return b(this,void 0,void 0,function(){return f(this,function(b){switch(b.label){case 0:return b.trys.push([0,2,,3]),[4,this.when()];case 1:return b.sent(),[3,3];case 2:return b.sent(),[3,3];case 3:return this._controllerCreated=
!0,this.notifyChange("updating"),this.isResolved()?[4,h.whenTrueOnce(this.view,"basemapTerrain.ready")]:[2];case 4:return b.sent(),this.controller=a,this.loadedGraphics=a.graphics,this._queryEngine=new d({layer:this.layer,features:this.loadedGraphics,objectIdField:this.layer.objectIdField,dataSpatialReference:this.view.spatialReference}),this.notifyChange("updating"),[2]}})})};p.prototype.updateClippingExtent=function(a){this.clippingExtent=a;if(!this.controller)return!1;switch(this.controller.type){case "memory":case "stream":return!1;
case "snapshot":if(this._controllerClientSideFiltering)return!1;this.controller.extent?(this.controller.extent=null,this._controllerClientSideFiltering=!0):this.controller.extent=a;return!0;case "feature-tile-3d":return this.controller.extent=a,!0}};p.prototype.validateGeometryType=function(){var a=this.layer;switch(a.geometryType){case "multipatch":case "multipoint":return e.reject(new l("featurelayerview3d:unsupported-geometry-type","Unsupported geometry type ${geometryType}",{geometryType:a.geometryType}))}};
p.prototype._rejectQuery=function(){return e.reject(new l("featurelayerview3d:query","Not ready to execute query"))};a([m.property()],p.prototype,"loadedGraphics",void 0);a([m.property({dependsOn:["graphics3d.suspended"]})],p.prototype,"suspended",void 0);a([m.property({dependsOn:["graphics3d.updating","controller.updating","overlayUpdating"]})],p.prototype,"updating",void 0);a([m.property()],p.prototype,"controller",void 0);a([m.property()],p.prototype,"graphics3d",void 0);a([m.property({readOnly:!0})],
p.prototype,"asyncGraphicsUpdates",void 0);a([m.property({readOnly:!0})],p.prototype,"suspendResumeExtentMode",void 0);a([m.property({type:Boolean})],p.prototype,"slicePlaneEnabled",void 0);a([m.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],p.prototype,"hasDraped",void 0);a([m.property({readOnly:!0,type:Boolean})],p.prototype,"supportsDraping",void 0);a([m.property({type:Boolean})],p.prototype,"overlayUpdating",void 0);a([m.property()],p.prototype,"drawingOrder",null);return p=a([m.subclass("esri.views.3d.layers.FeatureLikeLayerView3D")],
p)}(m.declared(p))})},"esri/layers/graphics/QueryEngine":function(){define("require exports ../../core/tsSupport/extendsHelper ../../core/tsSupport/decorateHelper ../../geometry ../../core/Accessor ../../core/Error ../../core/promiseUtils ../../core/accessorSupport/decorators ../../geometry/support/aaBoundingRect ./dehydratedFeatures ../../tasks/support/FeatureSet".split(" "),function(n,g,c,a,f,b,l,e,h,m,k,d){n=function(b){function g(a){a=b.call(this)||this;a.features=null;a.layer=null;a.objectIdField=
null;a.dataSpatialReference=null;return a}c(g,b);g.prototype.queryFeatures=function(a){var b=this;return this._queryFeatures(a).then(function(a){a=a.map(function(a){return k.hydrateGraphic(a,b.layer)});return new d({features:a,fields:b.layer?b.layer.fields.slice():null,geometryType:b.layer?b.layer.geometryType:null,spatialReference:b.dataSpatialReference?b.dataSpatialReference.clone():null})})};g.prototype.queryObjectIds=function(a){var b=this;return this.objectIdField?this.queryFeatures(a).then(function(a){return b._getObjectIds(a.features)}):
this._rejectQuery("Unsupported query")};g.prototype.queryFeatureCount=function(a){return this.features&&!a?e.resolve(this.features.length):this._queryFeatures(a).then(function(a){return a.length})};g.prototype.queryExtent=function(a){var b=this;return this.queryFeatures(a).then(function(a){return{count:a.features.length,extent:b._getExtent(a.features)}})};g.prototype._queryFeatures=function(a){if(this.features){if(a){if(this._isSupportedQuery(a)){var b=this._createFilters(a);return b.length?this._executeQuery(a,
b):this._rejectQuery("Invalid query")}return this._rejectQuery("Unsupported query")}return this._returnAllFeatures()}return this._rejectQuery("Engine not initialized")};g.prototype._returnAllFeatures=function(){return e.resolve(this.features.toArray())};g.prototype._executeQuery=function(a,b){var c=this,d=[];this.features.forEach(function(e){b.every(function(b){return b.call(c,e,a)})&&d.push(e)});return e.resolve(d)};g.prototype._isSupportedQuery=function(a){var b=!0;if(null!=a.distance||null!=a.geometryPrecision||
a.groupByFieldsForStatistics&&a.groupByFieldsForStatistics.length||null!=a.maxAllowableOffset||a.multipatchOption||null!=a.num||a.orderByFields&&a.orderByFields.length||a.outFields&&a.outFields.length||a.outSpatialReference||a.outStatistics&&a.outStatistics.length||a.pixelSize||a.quantizationParameters||a.relationParameter||a.returnDistinctValues||null!=a.start||a.text||a.timeExtent||a.where||a.objectIds&&a.objectIds.length&&!this.objectIdField)b=!1;return b};g.prototype._createFilters=function(a){var b=
[];a.objectIds&&a.objectIds.length&&b.push(this._createObjectIdFilter());a.geometry&&"extent"===a.geometry.type&&"intersects"===a.spatialRelationship&&b.push(this._createExtentFilter());return b};g.prototype._createExtentFilter=function(){return function(a,b){a=a.geometry;if(!a)return!1;m.fromExtent(b.geometry,q);k.computeAABR(a,p);return m.intersects(q,p)}};g.prototype._createObjectIdFilter=function(){var a=this;return function(b,c){b=b.attributes;return-1<c.objectIds.indexOf(b&&b[a.objectIdField])}};
g.prototype._rejectQuery=function(a){return e.reject(new l(this.declaredClass,a))};g.prototype._getObjectIds=function(a){var b=this.objectIdField,c=[];a.forEach(function(a){a=(a=a.attributes)&&a[b];null!=a&&c.push(a)});return c};g.prototype._getExtent=function(a){if(0===a.length)return null;m.empty(q);for(var b=0;b<a.length;b++)k.computeAABR(a[b].geometry,p),m.expand(q,p,q);return new f.Extent({xmin:q[0],ymin:q[1],xmax:q[2],ymax:q[3],spatialReference:a[0].geometry.spatialReference})};a([h.property()],
g.prototype,"features",void 0);a([h.property({constructOnly:!0})],g.prototype,"layer",void 0);a([h.property()],g.prototype,"objectIdField",void 0);a([h.property()],g.prototype,"dataSpatialReference",void 0);return g=a([h.subclass("esri.layers.graphics.QueryEngine")],g)}(h.declared(b));var q=m.create(),p=m.create();return n})},"esri/renderers/support/renderingInfoUtils":function(){define(["require","exports"],function(n,g){function c(a,b){if(!a||a.symbol)return null;b=b.renderer;return a&&b&&b.getObservationRenderer?
b.getObservationRenderer(a):b}function a(a,b){if(a.symbol)return a.symbol;var f=c(a,b);return f&&f.getSymbol(a,b)}Object.defineProperty(g,"__esModule",{value:!0});g.getRenderer=c;g.getSymbol=a;g.getRenderingInfo=function(f,b){var g=c(f,b),e=a(f,b);if(!e)return null;e={renderer:g,symbol:e};if(g){g.colorInfo&&(e.color=g.getColor(f).toRgba());if(g.sizeInfo){var h=g.getSize(f);e.size=[h,h,h]}if(g.visualVariables){f=g.getVisualVariableValues(f,b);h=["proportional","proportional","proportional"];for(b=
0;b<f.length;b++){var m=f[b],g=m.variable,k=m.value;"color"===g.type?e.color=k.toRgba():"size"===g.type?"outline"===g.target?e.outlineSize=k:(m=g.axis,g=g.useSymbolValue?"symbolValue":k,"width"===m?h[0]=g:"depth"===m?h[1]=g:"height"===m?h[2]=g:h[0]="width-and-depth"===m?h[1]=g:h[1]=h[2]=g):"opacity"===g.type?e.opacity=k:"rotation"===g.type&&"tilt"===g.axis?e.tilt=k:"rotation"===g.type&&"roll"===g.axis?e.roll=k:"rotation"===g.type&&(e.heading=k)}if(isFinite(h[0])||isFinite(h[1])||isFinite(h[2]))e.size=
h}}return e}})},"esri/views/3d/layers/graphics/Graphics3DFeatureLikeLayerView":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../Graphic ../../../../core/Accessor ../../../../core/Handles ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/webMercatorUtils ../../../../tasks/support/Query ./constants ./Graphics3DCore ./Graphics3DElevationAlignment ./Graphics3DFrustumVisibility ./Graphics3DHighlights ./Graphics3DScaleVisibility ./Graphics3DSpatialIndex ./graphicUtils ../support/attributeUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x){return function(b){function g(a){a=b.call(this)||this;a._handles=new l;a.highlights=new t;a.suspendResumeExtentMode="computed";a.dataExtent=null;a.suspendResumeExtent=null;return a}c(g,b);Object.defineProperty(g.prototype,"suspended",{get:function(){return this.scaleVisibility&&this.scaleVisibility.suspended||this.frustumVisibility&&this.frustumVisibility.suspended},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"updating",{get:function(){return!!(this.graphicsCore&&
this.graphicsCore.updating||this.frustumVisibility&&this.frustumVisibility.updating||this.scaleVisibility&&this.scaleVisibility.updating)},enumerable:!0,configurable:!0});g.prototype.normalizeCtorArgs=function(a){var b=a.queryGraphicUIDsInExtent||!a.scaleVisibilityEnabled&&!a.elevationAlignmentEnabled?null:new A({spatialReference:a.owner.view.spatialReference}),c=a.frustumVisibilityEnabled?new u:null,d=a.scaleVisibilityEnabled?new v:null,e=a.elevationAlignmentEnabled?new r:null,f=function(a,c,d){return b.queryGraphicUIDsInExtent(a,
c,d)};return{graphicsCore:new p({owner:a.owner,layer:a.layer,asyncUpdates:a.asyncGraphicsUpdates,basemapTerrain:a.owner.view.basemapTerrain,elevationFeatureExpressionEnabled:a.elevationFeatureExpressionEnabled,graphicSymbolSupported:!1}),frustumVisibility:c,scaleVisibility:d,elevationAlignment:e,spatialIndex:b,updateClippingExtent:a.updateClippingExtent,suspendResumeExtentMode:a.suspendResumeExtentMode,dataExtent:a.dataExtent,queryGraphicUIDsInExtent:a.queryGraphicUIDsInExtent||f}};g.prototype.initialize=
function(){var a=this;this.scaleVisibility&&this._handles.add(this.layer.watch(["minScale","maxScale"],function(){return a.scaleVisibility.layerMinMaxScaleChangeHandler()}));this.elevationAlignment&&this._handles.add(this.layer.watch("elevationInfo",function(){return a.graphicsCore.elevationInfoChange()}));this.graphicsCore&&(this._handles.add(this.layer.watch("labelsVisible",function(){return a.graphicsCore.updateVisibilityInfo()})),this._handles.add(this.layer.watch("labelingInfo",function(){return a.graphicsCore.updateLabelingInfo()})));
this.idleClients=[this.frustumVisibility,this.scaleVisibility,this.elevationAlignment,this.graphicsCore]};g.prototype.setup=function(){var a=this;this.frustumVisibility&&this.frustumVisibility.setup(this.owner);var b=this.owner.view.basemapTerrain,c=this.owner.view.elevationProvider;this.scaleVisibility&&this.scaleVisibility.setup(this.owner,this.layer,this.queryGraphicUIDsInExtent,this.graphicsCore,b);this.elevationAlignment&&this.elevationAlignment.setup(this.owner,this.queryGraphicUIDsInExtent,
this.graphicsCore,c);this.highlights&&this.highlights.setup(this.graphicsCore);this._set("labeling",this.owner.view.labeler.addGraphicsOwner(this.graphicsCore,this.scaleVisibility,this.spatialIndex));this.graphicsCore.setup({elevationAlignment:this.elevationAlignment,scaleVisibility:this.scaleVisibility,spatialIndex:this.spatialIndex,labeling:this.labeling,highlights:this.highlights});this._handles.add([this.layer.watch("renderer",function(b){return a.graphicsCore.rendererChange(b)}),this.owner.watch("fullOpacity",
function(){return a.graphicsCore.opacityChange()})]);this._handles.add(this.layer.on("graphic-update",function(b){return a.graphicsCore.graphicUpdateHandler(b)}));this.setupSuspendResumeExtent();this._handles.add(this.owner.view.resourceController.registerIdleFrameWorker({needsUpdate:function(){return a.needsIdleUpdate()},idleFrame:function(b){return a.idleUpdate(b)}}));this.updateClippingExtent&&(this._handles.add(this.owner.view.watch("clippingArea",function(){return a._updateClippingExtent()})),
this._updateClippingExtent());this.graphicsCore.startCreateGraphics();return this.graphicsCore.labelsEnabled?this.graphicsCore.updateLabelingInfo():e.resolve()};g.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null);this.frustumVisibility&&(this.frustumVisibility.destroy(),this._set("frustumVisibility",null));this.scaleVisibility&&(this.scaleVisibility.destroy(),this._set("scaleVisibility",null));this.elevationAlignment&&(this.elevationAlignment.destroy(),this._set("elevationAlignment",
null));this.graphicsCore&&(this.graphicsCore.destroy(),this._set("graphicsCore",null));this.spatialIndex&&(this.spatialIndex.destroy(),this._set("spatialIndex",null));this.highlights&&(this.highlights.destroy(),this._set("highlights",null));this._set("layer",null);this._set("owner",null)};g.prototype.highlight=function(a,b,c){var e=this;if(a instanceof d){b=this.highlights.acquireSet(b,c);var g=b.set,h=b.handle;this.owner.queryObjectIds(a).then(function(a){return e.highlights.setObjectIds(g,a)});
return h}if("number"===typeof a||a instanceof f)return this.highlight([a],b,c);"toArray"in a&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof f)if(h=a,c&&h[0].attributes&&null!==x.attributeLookup(h[0].attributes,c))a=h.map(function(a){return x.attributeLookup(a.attributes,c)});else return a=h.map(function(a){return a.uid}),h=this.highlights.acquireSet(b,null),b=h.set,h=h.handle,this.highlights.setUids(b,a),h;if("number"===typeof a[0])return h=this.highlights.acquireSet(b,c),b=h.set,
h=h.handle,this.highlights.setObjectIds(b,a),h}return{remove:function(){}}};g.prototype.needsIdleUpdate=function(){for(var a=0,b=this.idleClients;a<b.length;a++){var c=b[a];if(c&&c.needsIdleUpdate())return!0}return!1};g.prototype.idleUpdate=function(a){for(var b=0,c=this.idleClients;b<c.length;b++){var d=c[b];d&&d.idleUpdate(a)}};g.prototype._updateClippingExtent=function(){var a=this.owner.view.clippingArea;this.graphicsCore.setClippingExtent(a,this.owner.view.spatialReference)&&(this.updateClippingExtent(a)||
this.graphicsCore.recreateAllGraphics())};g.prototype.setupSuspendResumeExtent=function(){var a=this;(this.frustumVisibility||this.scaleVisibility)&&this._handles.add(h.init(this,"suspendResumeExtentMode",function(b){a._handles.remove("suspendResumeExtentMode");switch(a.suspendResumeExtentMode){case "computed":a._handles.add(h.init(a.graphicsCore,"computedExtent",function(b){return a.updateSuspendResumeExtent(b)}),"suspendResumeExtentMode");break;case "data":a._handles.add(h.init(a,"dataExtent",function(b){return a.updateSuspendResumeExtent(b)}),
"suspendResumeExtentMode")}}))};g.prototype.updateSuspendResumeExtent=function(a){a?this.suspendResumeExtentChanged(this.extentToSuspendResumeRect(a,this.suspendResumeExtent)):this.suspendResumeExtentChanged(null)};g.prototype.extentToSuspendResumeRect=function(a,b){var c=this.owner.view.spatialReference;if(!a.spatialReference.equals(c)){if(!k.canProject(a,c))return;a=k.project(a,c)}return z.enlargeExtent(a,b,q.SUSPEND_RESUME_EXTENT_OPTIMISM)};g.prototype.suspendResumeExtentChanged=function(a){this.frustumVisibility&&
this.frustumVisibility.setExtent(a);this.scaleVisibility&&this.scaleVisibility.setExtent(a)};a([m.property({aliasOf:"graphicsCore.layer"})],g.prototype,"layer",void 0);a([m.property({aliasOf:"graphicsCore.owner"})],g.prototype,"owner",void 0);a([m.property({constructOnly:!0})],g.prototype,"updateClippingExtent",void 0);a([m.property({constructOnly:!0})],g.prototype,"queryGraphicUIDsInExtent",void 0);a([m.property({constructOnly:!0})],g.prototype,"graphicsCore",void 0);a([m.property({constructOnly:!0})],
g.prototype,"spatialIndex",void 0);a([m.property({constructOnly:!0})],g.prototype,"scaleVisibility",void 0);a([m.property({constructOnly:!0})],g.prototype,"elevationAlignment",void 0);a([m.property({constructOnly:!0})],g.prototype,"frustumVisibility",void 0);a([m.property({readOnly:!0})],g.prototype,"labeling",void 0);a([m.property({readOnly:!0})],g.prototype,"highlights",void 0);a([m.property()],g.prototype,"suspendResumeExtentMode",void 0);a([m.property()],g.prototype,"dataExtent",void 0);a([m.property({readOnly:!0,
dependsOn:["scaleVisibility.suspended","frustumVisibility.suspended"]})],g.prototype,"suspended",null);a([m.property({readOnly:!0,dependsOn:["graphicsCore.updating","frustumVisibility.updating","scaleVisibility.updating"]})],g.prototype,"updating",null);return g=a([m.subclass("esri.views.3d.layers.graphics.Graphics3DFeatureLikeLayerView")],g)}(m.declared(b))})},"esri/views/3d/layers/graphics/Graphics3DCore":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/Deferred ../../../../geometry ../../../../renderers ../../../../symbols ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Error ../../../../core/Handles ../../../../core/iteratorUtils ../../../../core/Logger ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../core/promiseUtils ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/Layer ../../../../layers/graphics/dehydratedFeatures ../../../../renderers/support/diffUtils ../../../../renderers/support/rendererConversion ../../../../symbols/support/symbolConversion ./ElevationQuery ./featureExpressionInfoUtils ./Graphics3DGraphic ./Graphics3DOwner ./Graphics3DSymbolFactory ./Graphics3DWebStyleSymbol ./graphicUtils ../../lib/gl-matrix ../../support/mathUtils ../../support/projectionUtils ../../support/PropertiesPool ../../webgl-engine/Stage ../../webgl-engine/lib/FloatingBoxLocalOriginFactory ../../webgl-engine/lib/Layer".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K,N,H,M,T,V,U,J,O,P,R,Q,L,S){var aa=new e.Point,ea=J.vec3d.create(),Z=B.create(),da=u.getLogger("esri.views.3d.layers.graphics.Graphics3DCore");n=function(g){function k(a){a=g.call(this)||this;a.propertiesPool=new R.PropertiesPool({computedExtent:e.Extent},a);a.computedExtent=null;a.symbolCreationContext=new M.Graphics3DSymbolCreationContext;a.graphics={};a.stageLayer=null;a.stage=null;a.graphicsDrapedUids={};a.graphicsBySymbol={};a.graphicsKeys=
[];a.symbols={};a.graphicsWithoutSymbol={};a.graphicsWaitingForSymbol=new Set;a.lastFastUpdate=null;a.handles=new p;a.viewSR=null;a.elevationAlignment=null;a.scaleVisibility=null;a.spatialIndex=null;a.labeling=null;a.highlights=null;a.viewElevationProvider=null;a.sharedSymbolResourcesOwnerHandle=null;a.whenGraphics3DGraphicRequests={};a.pendingUpdates=new Map;a.pendingUpdatesPool=new v({initialSize:2E3,allocator:function(){return{add:null,remove:null}},deallocator:function(a){a.add=null;a.remove=
null}});a.symbolWarningLogged=!1;a.geometryWarningLogged=!1;a.asyncUpdates=!1;a.elevationFeatureExpressionEnabled=!0;a.owner=null;a.layer=null;a.hasDraped=!1;a.graphicSymbolSupported=!0;a.minTotalNumberOfFeatures=2E3;a.numberOfGraphics=0;a._visible=void 0;a._startCreateGraphics=!1;return a}c(k,g);t=k;Object.defineProperty(k.prototype,"updating",{get:function(){return!!(0<this.graphicsWaitingForSymbol.size||this.needsIdleUpdate()||this.elevationAlignment&&this.elevationAlignment.updating||this.scaleVisibility&&
this.scaleVisibility.updating)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"maxNumberOfFeatures",{get:function(){return O.clamp(Math.ceil((this.maxTotalNumberOfVertices||1)/this.maxSymbolNumberOfVertices),this.minTotalNumberOfFeatures,this.maxTotalNumberOfFeatures||1)},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"maxSymbolNumberOfVertices",{get:function(){var a=0,b;for(b in this.symbols){var c=this.symbols[b];c&&(a=Math.max(a,c.numberOfVertices))}return 0===
a?this._get("maxSymbolNumberOfVertices")||1:a},enumerable:!0,configurable:!0});k.prototype.initialize=function(){this.viewSR=this.owner.view.spatialReference};k.prototype.setup=function(a){var b=this;this._set("elevationAlignment",a.elevationAlignment);this._set("scaleVisibility",a.scaleVisibility);this._set("spatialIndex",a.spatialIndex);this._set("labeling",a.labeling);this._set("highlights",a.highlights);var c=this.owner.view;this.viewElevationProvider=new K.ViewElevationProvider(this.viewSR,c);
this.initializeStage(c,this.layer.uid);this.symbolCreationContext.sharedResources=c.sharedSymbolResources;this.sharedSymbolResourcesOwnerHandle=c.sharedSymbolResources.addGraphicsOwner(this.owner);this.symbolCreationContext.renderer=this.layer.renderer;this.symbolCreationContext.stage=this.stage;this.symbolCreationContext.streamDataSupplier=c.sharedSymbolResources.streamDataSupplier;this.symbolCreationContext.renderSpatialReference=c.renderSpatialReference;this.symbolCreationContext.renderCoordsHelper=
c.renderCoordsHelper;this.symbolCreationContext.layer=this.layer;this.symbolCreationContext.layerView=this.owner;this.symbolCreationContext.layerOrder=0;this.symbolCreationContext.localOriginFactory=t.createLocalOriginFactory();this.symbolCreationContext.elevationProvider=c.elevationProvider;a=N.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=N.createContext(a,this.viewSR,da);c.deconflictor.addGraphicsOwner(this);
this.symbolCreationContext.screenSizePerspectiveEnabled=c.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled;this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled;this.handles.add(this.owner.watch("suspended",function(){return b.updateLayerVisibility()}));this.handles.add([this.owner.watch("layer"in this.owner?["layer.screenSizePerspectiveEnabled,view.screenSizePerspectiveEnabled"]:"view.screenSizePerspectiveEnabled",function(){var a=c.screenSizePerspectiveEnabled&&
b.layer.screenSizePerspectiveEnabled;a!==b.symbolCreationContext.screenSizePerspectiveEnabled&&(b.symbolCreationContext.screenSizePerspectiveEnabled=a,b.recreateAllGraphics())}),this.owner.watch("slicePlaneEnabled",function(a){a=!!a;a!==b.symbolCreationContext.slicePlaneEnabled&&(b.symbolCreationContext.slicePlaneEnabled=a,b.recreateAllGraphics())})]);this.handles.add(z.when(c.basemapTerrain,"tilingScheme",function(a){a.spatialReference.equals(b.symbolCreationContext.overlaySR)||(b.symbolCreationContext.overlaySR=
b.basemapTerrain.spatialReference);b.handles.has("loaded-graphics")?b.recreateAllGraphics():b.handles.add(z.on(b.owner,"loadedGraphics","change",function(a){return b.graphicsCollectionChanged(a)},function(){return b.recreateAllGraphics()}),"loaded-graphics")}));this.validateRenderer(this.layer.renderer)};k.prototype.destroy=function(){this.owner.view.deconflictor.removeGraphicsOwner(this);this.owner.view.labeler.removeGraphicsOwner(this);this.clear();this.stage&&(this.stage.removeFromViewContent([this.stageLayer.id]),
this.stage.remove(Q.ModelContentType.LAYER,this.stageLayer.id),this.stage=this.stageLayer=null);this.handles.destroy();this.viewSR=this.handles=null;this._set("owner",null);for(var a in this.whenGraphics3DGraphicRequests)this.whenGraphics3DGraphicRequests[a].reject(new q("graphic:layer-destroyed","Layer has been destroyed"));this.whenGraphics3DGraphicRequests=null;this.sharedSymbolResourcesOwnerHandle&&(this.sharedSymbolResourcesOwnerHandle.remove(),this.sharedSymbolResourcesOwnerHandle=null);this.propertiesPool&&
(this.propertiesPool.destroy(),this.propertiesPool=null);this.pendingUpdatesPool=null};k.prototype.clear=function(){for(var a in this.graphics)this.graphics[a].destroy();this.spatialIndex&&this.spatialIndex.clear();this.graphics={};this.graphicsKeys=null;this.numberOfGraphics=0;this.updateLayerVisibility();for(var b in this.symbols)(a=this.symbols[b])&&a.destroy();this.symbols={};this.graphicsBySymbol={};this.graphicsWithoutSymbol={};this.graphicsWaitingForSymbol.clear();this.pendingUpdates.clear();
this.pendingUpdatesPool.clear();this._set("hasDraped",!1);this.notifyChange("updating")};k.prototype.initializeStage=function(a,b){this.stage=a._stage;this.stageLayer=new S(b,{isPickable:!this.owner.suspended},b);this.stage.add(Q.ModelContentType.LAYER,this.stageLayer);this.stage.addToViewContent([this.stageLayer.id])};k.prototype.setDrawingOrder=function(a){this.symbolCreationContext.layerOrder=a;var b=new Set,c;for(c in this.symbols){var d=this.symbols[c];d&&d.setDrawOrder(a,b)}0<b.size&&this.stage.getDrapedTextureRenderer().updateRenderOrder(b)};
k.prototype.updateLayerVisibility=function(){var a=this.numberOfGraphics>this.maxNumberOfFeatures*ba,a=!this.owner.suspended&&!a;a!==this._visible&&((this._visible=a)?(this.stageLayer.isPickable=!0,this.updateAllGraphicsVisibility()):(this.stageLayer.isPickable=!1,this.hideAllGraphics()))};Object.defineProperty(k.prototype,"graphics3DGraphics",{get:function(){return this.graphics},enumerable:!0,configurable:!0});k.prototype.getGraphics3DGraphicById=function(a){return this.graphics[a]};Object.defineProperty(k.prototype,
"graphics3DGraphicsKeys",{get:function(){null===this.graphicsKeys&&(this.graphicsKeys=Object.keys(this.graphics));return this.graphicsKeys},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"labelsEnabled",{get:function(){return!(!this.labeling||!this.labeling.layerLabelsEnabled())},enumerable:!0,configurable:!0});k.prototype.updateLabelingInfo=function(a){return this.labeling&&this.labeling.labelingInfoChange(a)};k.prototype.updateVisibilityInfo=function(){return this.labeling&&this.labeling.visibilityInfoChange()};
Object.defineProperty(k.prototype,"symbolUpdateType",{get:function(){if(0<this.pendingUpdates.size)return"unknown";var a=0,b=0,c;for(c in this.symbols){var d=this.symbols[c];if(d){d=d.getFastUpdateStatus();if(0<d.loading)return"unknown";this.graphicsBySymbol[c]&&(b+=d.fast,a+=d.slow)}}return 0<=b&&0===a?"fast":0<=a&&0===b?"slow":"mixed"},enumerable:!0,configurable:!0});k.prototype.needsIdleUpdate=function(){return 0<this.pendingUpdates.size?!0:!!this.lastFastUpdate&&500<performance.now()-this.lastFastUpdate};
k.prototype.idleUpdate=function(a){var b=this.needsIdleUpdate();this._applyPendingUpdates(a);!a.done()&&this.lastFastUpdate&&(this.lastFastUpdate=null);a=this.needsIdleUpdate();b!==a&&this.notifyChange("updating")};k.prototype.whenGraphics3DGraphic=function(a){var b=this.graphics[a.uid];if(b)return A.resolve(b);b=this.whenGraphics3DGraphicRequests[a.uid];b||(b=new l,this.whenGraphics3DGraphicRequests[a.uid]=b);return b.promise};k.prototype.boundsForGraphics3DGraphic=function(a,c){return b(this,void 0,
void 0,function(){var b,d,e,g,h,k,l,m,p,q;return f(this,function(f){switch(f.label){case 0:return b=this.owner.view.spatialReference,d=this.owner.view.renderSpatialReference,e=this.owner.view.basemapTerrain.spatialReference,g=function(a,c,e){return P.bufferToBuffer(a,d,c,a,b,c,e)},h=function(a,c,d){return P.bufferToBuffer(a,e,c,a,b,c,d)},k=this.viewElevationProvider?{service:this.viewElevationProvider,useViewElevation:c&&c.useViewElevation,minDemResolution:c&&c.minDemResolution,minDemResolutionForPoints:this.owner.view.resolution}:
null,[4,a.getProjectedBoundingBox(g,h,k)];case 1:l=f.sent();if(!l)return[2,null];m=l.boundingBox;l.requiresDrapedElevation&&(p=this.symbolCreationContext.elevationProvider)&&(B.center(m,ea),aa.x=ea[0],aa.y=ea[1],aa.z=void 0,aa.spatialReference=b,q=p.getElevation(aa)||0,m[2]=Math.min(m[2],q),m[5]=Math.max(m[5],q));return[2,{boundingBox:m,screenSpaceObjects:l.screenSpaceObjects}]}})})};k.prototype.whenGraphicBounds=function(a,b){var c=this;return z.whenOnce(this.owner,"loadedGraphics").then(function(){var b=
c.owner.layer&&c.owner.layer.objectIdField,d=c.owner.loadedGraphics.find(function(c){return c===a?!0:b&&c.attributes&&a.attributes&&c.attributes[b]===a.attributes[b]});if(d)return c.whenGraphics3DGraphic(d);throw new q("internal:graphic-not-part-of-view","Graphic is not part of this view");}).then(function(a){return c.boundsForGraphics3DGraphic(a,b)})};k.prototype.graphicsCollectionChanged=function(a){this._startCreateGraphics&&(this.add(a.added),this.remove(a.removed))};k.prototype.graphicUpdateHandler=
function(a){var b=this.graphics[a.graphic.uid];if(b)switch(a.property){case "visible":this.graphicUpdateVisible(b,a);break;case "geometry":case "attributes":case "symbol":this.recreateGraphic(b)}};k.prototype.graphicUpdateVisible=function(a,b){a.setVisibilityFlag(0,b.newValue)&&this.labeling&&(this.lastFastUpdate=performance.now(),this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())};k.prototype.recreateGraphic=function(a){a=[a.graphic];this.remove(a);this.add(a)};k.prototype.beginGraphicUpdate=
function(a,b){this.graphicsWaitingForSymbol.add(a.uid);1===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating");this._get("symbolsUpdating")||this._set("symbolsUpdating",!0)};k.prototype.endGraphicUpdate=function(a){a&&(this.graphicsWaitingForSymbol.delete(a.uid),0===this.graphicsWaitingForSymbol.size&&this.notifyChange("updating"));this._get("symbolsUpdating")&&0===this.graphicsWaitingForSymbol.size&&(this.owner.view.flushDisplayModifications(),this._set("symbolsUpdating",!1))};k.prototype.expandComputedExtent=
function(a){var b=a.spatialReference;G.computeAABB(a,Z);a=this.viewSR;var c=t.tmpVec;!b.equals(a)&&P.xyzToVector(Z[0],Z[1],0,b,c,a)&&(Z[0]=c[0],Z[1]=c[1],P.xyzToVector(Z[3],Z[4],0,b,c,a),Z[3]=c[0],Z[4]=c[1]);if(O.isFinite(Z[0])&&O.isFinite(Z[3])&&O.isFinite(Z[1])&&O.isFinite(Z[4])){var b=this.computedExtent,c=null,d=O.isFinite(Z[2])&&O.isFinite(Z[5]),e=d&&(!b||null==b.zmin||Z[2]<b.zmin),d=d&&(!b||null==b.zmax||Z[5]>b.zmax);if(b){if(Z[0]<b.xmin||Z[1]<b.ymin||Z[3]>b.xmax||Z[4]>b.ymax||e||d)c=this.propertiesPool.get("computedExtent"),
c.xmin=Math.min(Z[0],b.xmin),c.ymin=Math.min(Z[1],b.ymin),c.xmax=Math.max(Z[3],b.xmax),c.ymax=Math.max(Z[4],b.ymax),c.spatialReference=a}else c=this.propertiesPool.get("computedExtent"),c.xmin=Z[0],c.ymin=Z[1],c.xmax=Z[3],c.ymax=Z[4],c.spatialReference=a;c&&(e&&(c.zmin=Z[2]),d&&(c.zmax=Z[5]),this._set("computedExtent",c))}};k.prototype.updateHasDraped=function(){var a=!1,b;for(b in this.graphicsDrapedUids)if(this.graphicsDrapedUids.hasOwnProperty(b)){a=!0;break}this._set("hasDraped",a)};k.prototype.elevationInfoChange=
function(){var a=N.extractExpressionInfo(this.layer.elevationInfo,this.elevationFeatureExpressionEnabled);this.symbolCreationContext.featureExpressionInfoContext=N.createContext(a,this.viewSR,da);this.labeling&&this.labeling.elevationInfoChange();this.layer.renderer!==this.symbolCreationContext.renderer&&this.rendererChange(this.layer.renderer);for(var b in this.graphicsBySymbol){var c=this.symbols[b],a=this.graphicsBySymbol[b];if(c&&c.layerPropertyChanged("elevationInfo",a))for(var d in a)for(var e=
a[d],c=e.graphic,e=e._labelGraphics,f=0;f<e.length;f++){var g=e[f];g.graphics3DSymbolLayer.updateGraphicElevationContext(c,g)}else this._recreateSymbol(b)}this.elevationAlignment&&this.elevationAlignment.elevationInfoChange()};k.prototype.clearSymbolsAndGraphics=function(){this.clear();this.elevationAlignment&&this.elevationAlignment.clear();this.labeling&&this.labeling.clear();this.stageLayer&&this.stageLayer.invalidateSpatialQueryAccelerator()};k.prototype.startCreateGraphics=function(){this._startCreateGraphics=
!0;this.recreateAllGraphics()};k.prototype.recreateAllGraphics=function(){this._startCreateGraphics&&(this.clearSymbolsAndGraphics(),this._set("computedExtent",null),this.symbolCreationContext.screenSizePerspectiveEnabled=this.owner.view.screenSizePerspectiveEnabled&&this.layer.screenSizePerspectiveEnabled,this.symbolCreationContext.slicePlaneEnabled=!!this.owner.slicePlaneEnabled,this.owner.loadedGraphics&&this.owner.view.basemapTerrain.tilingScheme&&this.add(this.owner.loadedGraphics.toArray()))};
k.prototype._recreateSymbol=function(a){var b=this.graphicsBySymbol[a],c=[],d=[],e;for(e in b){var f=b[e];f.isDraped()&&delete this.graphicsDrapedUids[e];this.spatialIndex&&c.push(f);d.push(f.graphic);f.destroy();this.removeGraphics3DGraphic(e);this.updateLayerVisibility()}0<c.length&&this.spatialIndex.removeMany(c);this.graphicsBySymbol[a]={};(b=this.symbols[a])&&b.destroy();delete this.symbols[a];this.updateHasDraped();this.add(d)};k.prototype.add=function(a){this.owner.view.basemapTerrain&&this.owner.view.basemapTerrain.tilingScheme?
(this.asyncUpdates?this._addDelayed(a):this._addImmediate(a),this.notifyChange("updating")):da.error("#add()","Cannot add graphics before terrain surface has been initialized")};k.prototype._addImmediate=function(a){var b=this;this.symbolWarningLogged=this.geometryWarningLogged=!1;W.clear();for(var c=0;c<a.length;c++)this._startAddGraphic(a[c],W);W.forEach(function(a){return b._finishAddGraphics(a)});W.clear();this.updateHasDraped();this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};
k.prototype._addDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add=c:(e=this.pendingUpdatesPool.pushNew(),e.add=c,this.pendingUpdates.set(d,e))}};k.prototype.remove=function(a){this.asyncUpdates?this._removeDelayed(a):this._removeImmediate(a);this.notifyChange("updating")};k.prototype._removeImmediate=function(a){for(var b=[],c=0;c<a.length;c++){var d=this._removeGraphic(a[c]);this.spatialIndex&&d&&b.push(d)}0<b.length&&this.spatialIndex.removeMany(b);
this.updateHasDraped();this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()};k.prototype._removeDelayed=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.uid,e=this.pendingUpdates.get(d);e?e.add&&(e.remove?e.add=null:this.pendingUpdates.delete(d)):(e=this.pendingUpdatesPool.pushNew(),e.remove=c,this.pendingUpdates.set(d,e))}0===this.pendingUpdates.size&&this.pendingUpdatesPool.clear()};k.prototype._applyPendingUpdates=function(a){var b=this;if(!a.done()){this.symbolWarningLogged=
this.geometryWarningLogged=!1;var c=0;W.clear();r.everyMap(this.pendingUpdates,function(d,e){if(a.done())return!1;if(d.remove){var f=b._removeGraphic(d.remove);b.spatialIndex&&f&&b.spatialIndex.remove(f)}d.add&&b._startAddGraphic(d.add,W)&&c++;b.pendingUpdates.delete(e);1E3<c&&(W.forEach(function(a){return b._finishAddGraphics(a)}),W.clear(),c=0)});W.forEach(function(a){return b._finishAddGraphics(a)});W.clear();0===this.pendingUpdates.size&&this.pendingUpdatesPool.clear();this.updateHasDraped();
this.owner.view.deconflictor.setDirty();this.owner.view.labeler.setDirty()}};k.prototype._startAddGraphic=function(a,b){this.graphicsWithoutSymbol[a.uid]=a;var c=a.geometry;if(!c)return this.geometryWarningLogged||(this.geometryWarningLogged=!0,da.warn("Graphic in layer "+this.layer.id+" has no geometry and will not render")),!1;if(!this.graphicSymbolSupported&&a.symbol)return this.symbolWarningLogged||(this.symbolWarningLogged=!0,da.warn("Graphic in layer "+this.layer.id+" is not allowed to have a symbol, use a renderer instead")),
!1;var d=this.owner.getRenderingInfo&&this.owner.getRenderingInfo(a);if(!d||!d.symbol)return this.symbolWarningLogged||(this.symbolWarningLogged=!0,da.warn("Graphic in layer "+this.layer.id+" has no symbol and will not render")),!1;var e=this.getOrCreateGraphics3DSymbol(d.symbol,d.renderer);if(!e)return!1;d={graphic:a,renderingInfo:d,layer:this.layer};this.expandComputedExtent(c);this.beginGraphicUpdate(a,e);a=e.symbol.id;(c=b.get(a))?c.graphics.push(d):(c=ca.acquire(),c.clear(),c.push(d),b.set(a,
{asyncSymbol:e,graphics:c}));return!0};k.prototype._finishAddGraphics=function(a){var b=this;a.asyncSymbol.then(function(){ja.clear();for(var c=0;c<a.graphics.length;c++){var d=a.graphics.data[c],e=d.graphic;b.graphicsWaitingForSymbol.has(e.uid)&&(d=b.createGraphics3DGraphic(a.asyncSymbol,d),b.spatialIndex&&d&&ja.push(d));b.endGraphicUpdate(e)}0<ja.length&&b.spatialIndex.addMany(ja.data,ja.length);ja.clear();a.graphics.clear();ca.release(a.graphics);b.labeling&&(b.lastFastUpdate=performance.now(),
b.owner.view.labeler.setDirty())},function(){for(var c=0;c<a.graphics.length;c++)b.endGraphicUpdate(a.graphics.data[c].graphic);a.graphics.clear();ca.release(a.graphics)})};k.prototype._removeGraphic=function(a){a=a.uid;var b=this.graphics[a];if(b){b.isDraped()&&delete this.graphicsDrapedUids[a];var c=b.graphics3DSymbol.symbol.id;b.destroy();delete this.graphicsBySymbol[c][a];delete this.graphicsWithoutSymbol[a];this.removeGraphics3DGraphic(a);this.labeling&&this.labeling.removeGraphic(b)}else this.graphicsWaitingForSymbol.delete(a);
return b};k.prototype.hasLabelingContext=function(a){if(a instanceof m.LabelSymbol3D||a instanceof m.TextSymbol){var b=this.symbolCreationContext.layer;return b.labelingInfo?b.labelingInfo.some(function(b){return b.symbol===a}):!1}return!1};k.prototype.hasValidSymbolCreationContext=function(a){return a instanceof m.LabelSymbol3D&&!this.hasLabelingContext(a)?(da.error("LabelSymbol3D is only valid as part of a LabelClass. Using LabelSymbol3D as a renderer symbol is not supported."),!1):!0};k.prototype.createGraphics3DSymbol=
function(a,b){var c=this;if(!this.hasValidSymbolCreationContext(a))return null;a=I.to3D(a,!0,!1,this.hasLabelingContext(a));if(a.symbol){var d=void 0;b&&"backgroundFillSymbol"in b&&b.backgroundFillSymbol&&(b=I.to3D(b.backgroundFillSymbol,!1,!0),b.symbol&&"web-style"!==b.symbol.type&&(d=b.symbol.symbolLayers));b=T.make(a.symbol,this.symbolCreationContext,d);b.then(function(){c.notifyChange("maxSymbolNumberOfVertices")});return b}a.error&&da.error(a.error.message);return null};k.prototype.getOrCreateGraphics3DSymbol=
function(a,b){var c=this,d=this.symbols[a.id];void 0===d&&(d=a instanceof m.WebStyleSymbol?new V(a,function(a){return c.createGraphics3DSymbol(a,b)}):this.createGraphics3DSymbol(a,b),this.symbols[a.id]=d);return d};k.prototype.addGraphics3DGraphic=function(a){this.graphics[a.graphic.uid]=a;this.graphicsKeys=null;this.numberOfGraphics++;this.updateLayerVisibility()};k.prototype.removeGraphics3DGraphic=function(a){delete this.graphics3DGraphics[a];this.graphicsKeys=null;this.numberOfGraphics--;this.updateLayerVisibility()};
k.prototype.createGraphics3DGraphic=function(a,b){var c=b.graphic;delete this.graphicsWithoutSymbol[c.uid];if(!this.symbols[a.symbol.id])this.add([c]);else if(!this.graphics[c.uid]){b=a.createGraphics3DGraphic(b);a=a.symbol.id;this.addGraphics3DGraphic(b);this.graphicsBySymbol[a]||(this.graphicsBySymbol[a]={});this.graphicsBySymbol[a][c.uid]=b;b.initialize(this.stageLayer,this.stage);b.isDraped()&&(this.graphicsDrapedUids[c.uid]=!0,this._set("hasDraped",!0));b.centroid=null;"point"!==c.geometry.type&&
b instanceof H&&(b.centroid=U.computeCentroid(c.geometry),b.centroid&&U.convertPointSR(b.centroid,this.viewSR));a=this.scaleVisibility&&this.scaleVisibility.scaleRangeActive();this.labeling&&this.labeling.addGraphic(b);a&&this.scaleVisibility.updateGraphicScaleVisibility(b);b.setVisibilityFlag(0,!!c.visible&&!this.owner.suspended);this.owner.view.deconflictor.setInitialIconVisibilityFlag(this.layer,b);if(a=this.whenGraphics3DGraphicRequests[c.uid])delete this.whenGraphics3DGraphicRequests[c.uid],
a.resolve(b);this.highlights&&this.highlights.graphicCreated(b);return b}};k.prototype.rendererChange=function(a){var b=this.symbolCreationContext.renderer;if(a!==b){this.validateRenderer(a);var c=E.diff(b,a);this.updateUnchangedSymbolMappings(c,a,b);this.symbolCreationContext.renderer=a;c&&("complete"===c.type?this.recreateAllGraphics():"partial"===c.type&&(this.applyRendererDiff(c,a,b)?this.volatileGraphicsUpdated():this.recreateAllGraphics()))}};k.prototype.diffHasSymbolChange=function(a){for(var b in a.diff)switch(b){case "visualVariables":case "defaultSymbol":case "uniqueValueInfos":break;
case "authoringInfo":case "fieldDelimiter":delete a.diff[b];break;default:return!0}return!1};k.prototype.applySymbolSetDiff=function(a,b,c,d){a=a||[];b=b||[];d=[];for(var e=0;e<b.length;e++){var f=b[e],g=this.graphicsBySymbol[f.id],h;for(h in g){var k=g[h],l=k.graphic,m=this.layer instanceof C?this.layer:null;if(f!==c.defaultSymbol||c.getSymbol(G.hydrateGraphic(l,m))!==c.defaultSymbol)k.isDraped()&&delete this.graphicsDrapedUids[h],a.length||c.defaultSymbol?d.push(l):this.graphicsWithoutSymbol[h]=
l,k.destroy(),this.highlights&&this.highlights.graphicDeleted(this.graphics[h]),delete g[h],this.removeGraphics3DGraphic(h),this.updateLayerVisibility()}if(void 0===g||0===Object.keys(g).length)delete this.graphicsBySymbol[f.id],(g=this.symbols[f.id])&&g.destroy(),delete this.symbols[f.id],this.notifyChange("maxSymbolNumberOfVertices")}if(a.length||d.length){for(h in this.graphicsWithoutSymbol)d.push(this.graphicsWithoutSymbol[h]);this.graphicsWithoutSymbol={};this.add(d)}this.updateHasDraped();this.owner.view.deconflictor.setDirty();
this.owner.view.labeler.setDirty()};k.prototype.applyUniqueValueRendererDiff=function(a,b,c){var d=a.diff.defaultSymbol,e=a.diff.uniqueValueInfos;if(d||e){var f=e?e.added.map(function(a){return a.symbol}):[],g=e?e.removed.map(function(a){return a.symbol}):[];if(e)for(var h=0;h<e.changed.length;h++)f.push(e.changed[h].newValue.symbol),g.push(e.changed[h].oldValue.symbol);d?(c.defaultSymbol&&g.push(c.defaultSymbol),b.defaultSymbol&&f.push(b.defaultSymbol)):c.defaultSymbol&&f.length&&g.push(b.defaultSymbol);
this.applySymbolSetDiff(f,g,b,c);delete a.diff.defaultSymbol;delete a.diff.uniqueValueInfos;return!0}return!1};k.prototype.calculateUnchangedSymbolMapping=function(a,b,c){if(b instanceof h.UniqueValueRenderer&&c instanceof h.UniqueValueRenderer)if(!a){if(c&&c.defaultSymbol)return[{oldId:c.defaultSymbol.id,newId:b.defaultSymbol.id}]}else if("partial"===a.type){var d=a.diff;a=d.defaultSymbol;var d=d.uniqueValueInfos,e=void 0,e=d?d.unchanged.map(function(a){return{oldId:a.oldValue.symbol.id,newId:a.newValue.symbol.id}}):
c.uniqueValueInfos.map(function(a,c){return{oldId:a.symbol.id,newId:b.uniqueValueInfos[c].symbol.id}});!a&&c.defaultSymbol&&e.push({oldId:c.defaultSymbol.id,newId:b.defaultSymbol.id});return e}return[]};k.prototype.updateUnchangedSymbolMappings=function(a,b,c){var d=0;for(a=this.calculateUnchangedSymbolMapping(a,b,c);d<a.length;d++)if(c=a[d],b=c.oldId,c=c.newId,b&&b!==c){var e=this.graphicsBySymbol[b];delete this.graphicsBySymbol[b];void 0!==e&&(this.graphicsBySymbol[c]=e);e=this.symbols[b];delete this.symbols[b];
void 0!==e&&(this.symbols[c]=e,e.symbol.id=c)}};k.prototype.applyRendererDiff=function(a,b,c){if(this.diffHasSymbolChange(a))return!1;if(b instanceof h.UniqueValueRenderer&&c instanceof h.UniqueValueRenderer&&this.applyUniqueValueRendererDiff(a,b,c)&&0===Object.keys(a.diff).length)return!0;for(var d in this.graphicsBySymbol)if((c=this.symbols[d])&&!c.applyRendererDiff(a,b,this.graphicsBySymbol[d]))return!1;return!0};k.prototype.opacityChange=function(){for(var a in this.graphicsBySymbol){var b=this.symbols[a];
b&&b.layerPropertyChanged("opacity")}};k.prototype.setClippingExtent=function(a,b){var c=this.symbolCreationContext.clippingExtent,e=D.create();P.extentToBoundingRect(a,e,b)?this.symbolCreationContext.clippingExtent=[e[0],e[1],-Infinity,e[2],e[3],Infinity]:this.symbolCreationContext.clippingExtent=null;return!d.equals(this.symbolCreationContext.clippingExtent,c)};k.prototype.forEachGraphics3DGraphic=function(a){var b=this;if(this.owner.loadedGraphics){var c=!1;this.owner.loadedGraphics.forEach(function(d){var e=
b.getGraphics3DGraphicById(d.uid);e&&a(e,d)&&(c=!0)});c&&(this.owner.view.deconflictor.setDirty(),this.owner.view.labeler.setDirty())}};k.prototype.updateAllGraphicsVisibility=function(){var a=this;this.forEachGraphics3DGraphic(function(b,c){c=b.setVisibilityFlag(0,c.visible);var d=!1;a.scaleVisibility&&(d=a.scaleVisibility.updateGraphicScaleVisibility(b));return c||d})};k.prototype.hideAllGraphics=function(){this.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(0,!1)})};k.prototype.validateRenderer=
function(a){(a=F.validateTo3D(a))&&da.warn("Renderer for layer '"+(this.layer.title?this.layer.title+", ":"")+", id:"+this.layer.id+"' is not supported in a SceneView",a.message)};k.prototype.volatileGraphicsUpdated=function(){this.labeling&&(this.lastFastUpdate=performance.now(),this.labeling.clear());this.stageLayer.invalidateSpatialQueryAccelerator();this.stageLayer.shaderTransformationChanged();this.notifyChange("updating")};k.createLocalOriginFactory=function(){return new L(5E6,16)};k.prototype.snapshotInternals=
function(){var a=this;return{graphics:Object.keys(this.graphics).sort(),symbols:Object.keys(this.symbols).sort(),graphicsBySymbol:Object.keys(this.graphicsBySymbol).sort().map(function(b){return{symbolId:b,graphics:Object.keys(a.graphicsBySymbol[b]).sort()}}),graphicsWithoutSymbol:Object.keys(this.graphicsWithoutSymbol).sort(),graphicsDrapedUids:Object.keys(this.graphicsDrapedUids).sort(),pendingUpdates:this.pendingUpdates}};var t;k.tmpVec=J.vec3d.create();a([x.property({readOnly:!0})],k.prototype,
"computedExtent",void 0);a([x.property({readOnly:!0})],k.prototype,"elevationAlignment",void 0);a([x.property({readOnly:!0})],k.prototype,"scaleVisibility",void 0);a([x.property({readOnly:!0})],k.prototype,"spatialIndex",void 0);a([x.property({readOnly:!0})],k.prototype,"labeling",void 0);a([x.property({readOnly:!0})],k.prototype,"highlights",void 0);a([x.property()],k.prototype,"asyncUpdates",void 0);a([x.property({constructOnly:!0})],k.prototype,"elevationFeatureExpressionEnabled",void 0);a([x.property({constructOnly:!0})],
k.prototype,"owner",void 0);a([x.property({constructOnly:!0})],k.prototype,"layer",void 0);a([x.property({constructOnly:!0})],k.prototype,"basemapTerrain",void 0);a([x.property({readOnly:!0})],k.prototype,"hasDraped",void 0);a([x.property({readOnly:!0})],k.prototype,"symbolsUpdating",void 0);a([x.property({constructOnly:!0})],k.prototype,"graphicSymbolSupported",void 0);a([x.property({readOnly:!0,dependsOn:["elevationAlignment.updating","scaleVisibility.updating"]})],k.prototype,"updating",null);
a([x.property({aliasOf:"owner.view.qualitySettings.graphics3D.maxTotalNumberOfVertices"})],k.prototype,"maxTotalNumberOfVertices",void 0);a([x.property({aliasOf:"owner.view.qualitySettings.graphics3D.maxTotalNumberOfFeatures"})],k.prototype,"maxTotalNumberOfFeatures",void 0);a([x.property()],k.prototype,"minTotalNumberOfFeatures",void 0);a([x.property({readOnly:!0,dependsOn:["maxSymbolNumberOfVertices","maxTotalNumberOfVertices","minTotalNumberOfFeatures","maxTotalNumberOfFeatures"]})],k.prototype,
"maxNumberOfFeatures",null);a([x.property({readOnly:!0})],k.prototype,"maxSymbolNumberOfVertices",null);return k=t=a([x.subclass("esri.views.3d.layers.graphics.Graphics3DCore")],k)}(x.declared(k));var W=new Map,ja=new v,ca=new t(v);(function(){return function(){this.remove=this.add=null}})();var ba=10;return n})},"esri/renderers/support/rendererConversion":function(){define(["require","exports","../../core/Error","../../symbols/support/symbolConversion"],function(n,g,c,a){function f(a,b){if(!b)return null;
b=Array.isArray(b)?b:[b];if(0<b.length){var e=b.map(function(a){return a.details.symbol.type||a.details.symbol.declaredClass}).filter(function(a){return!!a});e.sort();var f=[];e.forEach(function(a,b){0!==b&&a===e[b-1]||f.push(a)});return new c("renderer-conversion-3d:unsupported-symbols","Renderer contains symbols ("+f.join(", ")+") which are not supported in 3D",{renderer:a,symbolErrors:b})}return null}function b(b){var c=b.uniqueValueInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),
e=a.to3D(b.defaultSymbol);e.error&&c.unshift(e.error);return f(b,c)}function l(b){var c=b.classBreakInfos.map(function(b){return a.to3D(b.symbol).error}).filter(function(a){return!!a}),e=a.to3D(b.defaultSymbol);e.error&&c.unshift(e.error);return f(b,c)}Object.defineProperty(g,"__esModule",{value:!0});g.validateTo3D=function(e){return e?"simple"===e.type?f(e,a.to3D(e.symbol).error):"unique-value"===e.type?b(e):"class-breaks"===e.type?l(e):new c("renderer-conversion-3d:unsupported-renderer","Unsupported renderer of type '"+
(e.type||e.declaredClass)+"'",{renderer:e}):null}})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../core/asyncUtils ../../../../core/ObjectPool ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ./featureExpressionInfoUtils ../../support/projectionUtils".split(" "),function(n,g,c,a,f,
b,l,e,h,m,k){var d=new b(Array,function(a){return l.set(a,l.ZERO)},null,10,5),q=e.create();return function(){function b(a,b,c,d){this.addedToSpatialIndex=!1;this._labelGraphics=[];this._auxiliaryGraphics=[];for(var e=Array(2),f=0;f<e.length;f++)e[f]=Array(3);this._visibilityFlags=e;this.extent=this._featureExpressionFeature=null;this.graphics3DSymbol=b;this.graphic=a;this._graphics=c;this._featureExpressionFeature=m.createFeature(a,d)}b.prototype.initialize=function(a,b){var c=this;this._layer=a;
this._stage=b;this.forEachSymbolLayerGraphic(function(d){d.initialize(a,b);d.setVisibility(c.isVisible())})};b.prototype.destroy=function(){this.forEachRenderedGraphic(function(a){return a.destroy()});this._graphics.length=0;this._labelGraphics.length=0;this._auxiliaryGraphics.length=0};b.prototype.clearLabelGraphics=function(){this.forEachLabelGraphic(function(a){return a.destroy()});this._labelGraphics.length=0};b.prototype.addLabelGraphic=function(a,b,c){this._labelGraphics.push(a);a.initialize(b,
c);a.setVisibility(this.isVisible(1))};b.prototype.addAuxiliaryGraphic=function(a){this._auxiliaryGraphics.push(a);this._layer&&(a.initialize(this._layer,this._stage),a.setVisibility(this.isVisible()))};b.prototype.isDraped=function(){var a=!1;this.forEachSymbolLayerGraphic(function(b){"draped"===b.type&&(a=!0)});return a};b.prototype.areVisibilityFlagsSet=function(a,b,c){void 0===c&&(c=0);c=this._visibilityFlags[c];if(null!=a)return c[a];a=!0;for(var d=0;d<c.length;d++)if(d!==b){var e=c[d];a=a&&
(null==e||!0===e)}return a};b.prototype.isVisible=function(a){void 0===a&&(a=0);for(var b=0;b<=a;b++)for(var c=this._visibilityFlags[b],d=0;d<c.length;d++){var e=c[d];if(null!==e&&!1===e)return!1}return!0};b.prototype.setVisibilityFlag=function(a,b,c){void 0===c&&(c=0);var d=this.isVisible(c);this._visibilityFlags[c][a]=b;var e=this.isVisible(c);if(d===e)return!1;if(1===c)this.forEachLabelGraphic(function(a){return a.setVisibility(e)});else{this.forEachSymbolLayerGraphic(function(a){return a.setVisibility(e)});
var f=this.isVisible(1);this.forEachLabelGraphic(function(a){return a.setVisibility(f)})}return!0};b.prototype.getBSRadius=function(){var a=0;this.forEachSymbolLayerGraphic(function(b){a=Math.max(a,b.getBSRadius())});return a};b.prototype.getCenterObjectSpace=function(){return this._graphics[0].getCenterObjectSpace()};b.prototype.computeExtent=function(a){if(!this.extent){this.extent=e.create();var b=this.graphic.geometry,c=b.spatialReference;h.computeAABR(b,this.extent);if(!c.equals(a)&&!k.boundingRectToBoundingRect(this.extent,
c,this.extent,a))return this.extent=null,!1}return!0};b.prototype.getProjectedBoundingBox=function(b,g,h,k){return a(this,void 0,void 0,function(){var m=this;return c(this,function(p){switch(p.label){case 0:return k||(k={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]}),k.boundingBox?l.empty(k.boundingBox):k.boundingBox=l.empty(),k.requiresDrapedElevation=!1,[4,f.forEach(this._graphics,function(e){return a(m,void 0,void 0,function(){var a,f,m;return c(this,function(c){switch(c.label){case 0:if(!e)return[2];
a="draped"===e.type?g:b;f=d.acquire();return[4,e.getProjectedBoundingBox(a,h,f,k.screenSpaceObjects)];case 1:return m=c.sent(),isFinite(m[2])&&isFinite(m[5])||(k.requiresDrapedElevation=!0),m&&l.expand(k.boundingBox,f),d.release(f),[2]}})})})];case 1:return p.sent(),l.allFinite(k.boundingBox)||e.allFinite(l.toRect(k.boundingBox,q))?[2,k]:[2,null]}})})};b.prototype.needsElevationUpdates=function(){for(var a=0,b=this._graphics;a<b.length;a++){var c=b[a];if(c&&("object3d"===c.type||"lod-instance"===
c.type)&&c.needsElevationUpdates)return!0}a=0;for(b=this._labelGraphics;a<b.length;a++)if((c=b[a])&&c.needsElevationUpdates)return!0;return!1};b.prototype.alignWithElevation=function(a,b){var c=this;this.forEachRenderedGraphic(function(d){"object3d"!==d.type&&"lod-instance"!==d.type||d.alignWithElevation(a,b,c._featureExpressionFeature)})};b.prototype.addHighlight=function(a,b){this.forEachSymbolLayerGraphic(function(c){return c.addHighlight(a,b)})};b.prototype.removeHighlight=function(a){this.forEachSymbolLayerGraphic(function(b){return b.removeHighlight(a)})};
b.prototype.forEachGraphicList=function(a,b){a.forEach(function(a,c){return a&&b(a,c)})};b.prototype.forEachSymbolLayerGraphic=function(a){this.forEachGraphicList(this._graphics,a);this.forEachGraphicList(this._auxiliaryGraphics,a)};b.prototype.forEachLabelGraphic=function(a){this.forEachGraphicList(this._labelGraphics,a)};b.prototype.forEachRenderedGraphic=function(a){this.forEachSymbolLayerGraphic(a);this.forEachLabelGraphic(a)};return b}()})},"esri/views/3d/layers/graphics/Graphics3DOwner":function(){define(["require",
"exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){return function(){this.featureExpressionInfoContext=this.localOriginFactory=this.layerView=this.layer=this.overlaySR=this.renderCoordsHelper=this.renderSpatialReference=this.clippingExtent=this.layerOrderDelta=this.layerOrder=this.stage=this.renderer=this.elevationProvider=this.streamDataSupplier=this.sharedResources=null;this.screenSizePerspectiveEnabled=!0;this.slicePlaneEnabled=!1}}();g.Graphics3DSymbolCreationContext=
n})},"esri/views/3d/layers/graphics/Graphics3DSymbolFactory":function(){define(["require","exports","./Graphics3DPointSymbol","./Graphics3DSymbol"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.make=function(f,b,g){var e;switch(f.type){case "point-3d":e=c;break;default:e=a}return new e(f,b,g)}})},"esri/views/3d/layers/graphics/Graphics3DPointSymbol":function(){define(["require","exports","../../../../core/tsSupport/extendsHelper","./Graphics3DCalloutSymbolLayerFactory","./Graphics3DSymbol"],
function(n,g,c,a,f){return function(b){function f(c,f,g){c=b.call(this,c,f,g)||this;c.calloutSymbolLayer=null;c.symbol.hasVisibleCallout()&&(c.calloutSymbolLayer=a.make(c.symbol,f));return c}c(f,b);f.prototype.destroy=function(){b.prototype.destroy.call(this)};f.prototype.createGraphics3DGraphic=function(a,c,f){c=b.prototype.createGraphics3DGraphic.call(this,a,f);this.calloutSymbolLayer&&(a=this.createCalloutGraphic(a))&&c.addAuxiliaryGraphic(a);return c};f.prototype.layerPropertyChanged=function(a,
c){var e=this;return b.prototype.layerPropertyChanged.call(this,a,c)?this.calloutSymbolLayer?this.calloutSymbolLayer.layerPropertyChanged(a,c,function(a){var b=0;for(a=a._auxiliaryGraphics;b<a.length;b++){var c=a[b];if(c.graphics3DSymbolLayer===e.calloutSymbolLayer)return c}}):!0:!1};f.prototype.createCalloutGraphic=function(a){var b=a.renderingInfo;a.renderingInfo={renderer:b.renderer,symbol:b.symbol,needsOffsetAdjustment:b.needsOffsetAdjustment,translation:[0,0,0],centerOffset:[0,0,0,0],screenOffset:[0,
0],centerOffsetUnits:"world",elevationOffset:0,materialCollection:null};return this.calloutSymbolLayer.createGraphics3DGraphic(a)};return f}(f)})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("require exports ../../../../core/tsSupport/extendsHelper ./Graphics3DGraphic ./Graphics3DSymbolLayerFactory ../../support/PromiseLightweight".split(" "),function(n,g,c,a,f,b){return function(b){function e(a,c,e){var d=b.call(this)||this;d.symbol=a;a=a.symbolLayers;e&&(a=e.concat(a));e=
a.length;d.childGraphics3DSymbols=Array(a.length);d.childGraphics3DSymbolPromises=Array(a.length);for(var g=c.layerOrder,h=0,k=0,l=!1,m=function(a,b){b&&(this.childGraphics3DSymbols[a]=b,k++);h--;!this.isRejected()&&l&&1>h&&(0<k?this.resolve():this.reject())},n=0;n<e;n++){var A=a.getItemAt(n);!1!==A.enabled&&(c.layerOrder=g+(1-(1+n)/e),c.layerOrderDelta=1/e,A=f.make(d.symbol,A,c,A._ignoreDrivers))&&(h++,d.childGraphics3DSymbolPromises[n]=A,A.then(m.bind(d,n,A),m.bind(d,n,null)))}c.layerOrder=g;l=
!0;!d.isRejected()&&1>h&&d.resolve();return d}c(e,b);e.prototype.createGraphics3DGraphic=function(b,c){for(var e=b.graphic,d=Array(this.childGraphics3DSymbols.length),f=0;f<this.childGraphics3DSymbols.length;f++){var g=this.childGraphics3DSymbols[f];g&&(d[f]=g.createGraphics3DGraphic(b))}return new a(e,c||this,d,b.layer)};Object.defineProperty(e.prototype,"numberOfVertices",{get:function(){for(var a=0,b=0;b<this.childGraphics3DSymbols.length;++b){var c=this.childGraphics3DSymbols[b];c&&(a+=c.numberOfVertices)}return a},
enumerable:!0,configurable:!0});e.prototype.layerPropertyChanged=function(a,b){for(var c=this.childGraphics3DSymbols.length,d=function(c){var d=e.childGraphics3DSymbols[c],f=function(a){return a._graphics[c]};if(d&&!d.layerPropertyChanged(a,b,f))return{value:!1}},e=this,f=0;f<c;f++){var g=d(f);if("object"===typeof g)return g.value}return!0};e.prototype.applyRendererDiff=function(a,b,c){return this.isResolved()?this.childGraphics3DSymbols.reduce(function(d,e,f){return d&&(!e||e.applyRendererDiff(a,
b,c,f))},!0):!1};e.prototype.getFastUpdateStatus=function(){var a=0,b=0,c=0;this.childGraphics3DSymbolPromises.forEach(function(d){d&&!d.isFulfilled()?a++:d&&d.isFastUpdatesEnabled()?c++:d&&b++});return{loading:a,slow:b,fast:c}};e.prototype.setDrawOrder=function(a,b){for(var c=this.childGraphics3DSymbols.length,d=1/c,e=0;e<c;e++){var f=this.childGraphics3DSymbols[e];f&&f.setDrawOrder(a+(1-(1+e)/c),d,b)}};e.prototype.destroy=function(){this.isFulfilled()||this.reject();for(var a=0;a<this.childGraphics3DSymbolPromises.length;a++)this.childGraphics3DSymbolPromises[a]&&
this.childGraphics3DSymbolPromises[a].destroy()};return e}(b.Promise)})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("require exports ../../../../core/has ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DObjectSymbolLayerLod ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer".split(" "),function(n,
g,c,a,f,b,l,e,h,m,k,d,q){Object.defineProperty(g,"__esModule",{value:!0});var p=a.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory");g.make=function(a,b,c,d){var e=u[a.type]&&u[a.type][b.type]||r[b.type];return e?new e(a,b,c,d):(p.error("GraphicsLayerFactory#make","unknown symbol type "+b.type),null)};var r={icon:b,object:c("enable-feature:skallweit/lod-rendering")?m:h,line:l,path:k,fill:d,extrude:f,text:q},u={"mesh-3d":{fill:e}}})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/libs/earcut/earcut ../../../../geometry/Point ../../../../geometry/Polygon ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../support/edgeUtils ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A){function z(a,b,c,e,f,g,h,k,l,m,p,q,r,t){var u=c.length/3,n=0;p+=2*e.count;var v=e.index,x=e.count,L=l,Q=p;d.vec3d.set(r,C);var A=0<q?1:-1,v=3*v,z=L;r=3*z;for(var S=L+x,L=3*S,R=0;R<x;++R)t&&(C[0]=a[v+0],C[1]=a[v+1],C[2]=a[v+2],d.vec3d.normalize(C)),f[r+0]=a[v+0],f[r+1]=a[v+1],f[r+2]=a[v+2],g[r+0]=b[v+0],g[r+1]=b[v+1],g[r+2]=b[v+2],h[r+0]=-A*C[0],h[r+1]=-A*C[1],h[r+2]=-A*C[2],k[z]=0,f[L+0]=a[v+0]+q*C[0],f[L+1]=a[v+1]+q*C[1],f[L+2]=a[v+2]+q*C[2],g[L+0]=
b[v+0],g[L+1]=b[v+1],g[L+2]=b[v+2],h[L+0]=A*C[0],h[L+1]=A*C[1],h[L+2]=A*C[2],k[S]=q,r+=3,L+=3,v+=3,z+=1,S+=1;v=0;r=3*Q;L=3*(Q+u);r=3*(Q+u);L=3*Q;a=G;b=E;0>q&&(a=E,b=G);for(R=0;R<u;++R)m[r+0]=c[v+a[0]],m[r+1]=c[v+a[1]],m[r+2]=c[v+a[2]],m[L+0]=c[v+b[0]]+x,m[L+1]=c[v+b[1]]+x,m[L+2]=c[v+b[2]]+x,r+=3,L+=3,v+=3;l+=2*e.count;p=p+2*u-(2*e.count+2*u);B(f,g,k,h,n,e.pathLengths[0],e.count,l,m,p,q);l+=4*e.pathLengths[0];p+=2*e.pathLengths[0];n+=e.pathLengths[0];for(c=1;c<e.pathLengths.length;++c)B(f,g,k,h,n,
e.pathLengths[c],e.count,l,m,p,q),l+=4*e.pathLengths[c],p+=2*e.pathLengths[c],n+=e.pathLengths[c]}function x(a,b,c,d,e,f,g){d[f]=d[g];g*=3;f*=3;a[f+0]=a[g+0];a[f+1]=a[g+1];a[f+2]=a[g+2];b[f+0]=b[g+0];b[f+1]=b[g+1];b[f+2]=b[g+2];c[f+0]=e[0];c[f+1]=e[1];c[f+2]=e[2]}function B(a,b,c,e,f,g,h,k,l,m,p){var q=f,r=f+1,t=f+h,u=f+h+1,n=k,v=k+1,L=k+2*g;k=k+2*g+1;0>p&&(q=f+h+1,u=f);m*=3;for(var A=0;A<g;++A){A===g-1&&(0<p?(r=f,u=f+h):(r=f,q=f+h));var B=a,Q=q,z=r,S=t,R=K,Q=3*Q,z=3*z,S=3*S;d.vec3d.set3(B[Q++],B[Q++],
B[Q++],N);d.vec3d.set3(B[z++],B[z++],B[z++],H);d.vec3d.set3(B[S++],B[S++],B[S++],M);d.vec3d.subtract(H,N,T);d.vec3d.subtract(M,N,V);d.vec3d.cross(V,T,R);d.vec3d.normalize(R,R);x(a,b,e,c,K,n,q);x(a,b,e,c,K,v,r);x(a,b,e,c,K,L,t);x(a,b,e,c,K,k,u);l[m++]=n;l[m++]=L;l[m++]=k;l[m++]=n;l[m++]=k;l[m++]=v;q++;r++;t++;u++;n+=2;v+=2;L+=2;k+=2}}var D=d.vec3d.create(),C=d.vec3d.create(),G=[0,2,1],E=[0,1,2],F=new f,I={verticalDistanceToGround:0,terrainElevation:0};n=function(f){function g(){var a=null!==f&&f.apply(this,
arguments)||this;a._edgeStageObjects=new Set;return a}c(g,f);g.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=m.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),c=d.vec3d.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new A(c,
a+"_3dlinemat");this._context.stage.add(p.ModelContentType.MATERIAL,this._material);this.resolve()};g.prototype.destroy=function(){f.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&this._context.stage.remove(p.ModelContentType.MATERIAL,this._material.id)};g.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;var c=a.geometry;if("polygon"!==c.type&&"extent"!==c.type)return this._logWarning("unsupported geometry type for extrude symbol: "+c.type),
null;if(!this._validateGeometry(c))return null;var c="polygon"===c.type||"extent"===c.type?"rings":"paths",d="graphic"+a.uid,e=this._getVertexOpacityAndColor(b,Float32Array,255),f=this.getGraphicElevationContext(a);return this._createAs3DShape(a,c,b,e,f,d,a.uid)};g.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a){b=this._getMaterialOpacity();c=1>b||this._isPropertyDriven("opacity");this._material.setParameterValues({opacity:b,transparent:c});if(0<this._edgeStageObjects.size){var d=
this._context.stage.view.getEdgeView(),f=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){d.updateAllComponentOpacities(a,[f])})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(var g in b){var h=b[g];if(a=c(h))h=this.getGraphicElevationContext(h.graphic),a.needsElevationUpdates=e.needsElevationUpdates3D(h.mode),a.elevationContext.set(h)}return!0}return!1};Object.defineProperty(g.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});
g.prototype._getExtrusionSize=function(a){a=a.size&&this._isPropertyDriven("size")?e.getSingleSizeDriver(a.size,2):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};g.prototype._getSymbolSize=function(){return this.symbol.size||1};g.prototype._createAs3DShape=function(c,f,g,h,m,p,u){var n=this,x=c.geometry;"extent"===x.type&&(x=b.fromExtent(x));c=x[f];var L=[],B=[],A=[],Q=d.vec3d.create(),S=Array(6),R=this._context.renderSpatialReference===q.SphericalECEFSpatialReference,
P=this._getExtrusionSize(g),C=d.vec3d.create();R||this._context.renderCoordsHelper.worldUpAtPosition(null,C);g=e.getGeometryVertexData3D(c,x.hasZ,x.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,m);this._logGeometryCreationWarnings(g,c,f,"ExtrudeSymbol3DLayer");if(0<c.length){var N=g.geometryData.polygons,ea=g.eleVertexData,w=g.vertexData;f=w.length/3;var Z=new Float64Array(18*f),aa=new Float64Array(18*f),H=new Float64Array(18*
f),O=new Float64Array(6*f),E=0;f=function(b){var c=N[b],f=c.count,g=c.index;if(G._context.clippingExtent&&(e.computeBoundingBox(ea,g,f,S),e.boundingBoxClipped(S,G._context.clippingExtent)))return"continue";var k=new Float64Array(ea.buffer,3*g*Z.BYTES_PER_ELEMENT,3*f),l=c.holeIndices.map(function(a){return a-g}),k=a(k,l,3);if(0<k.length){e.chooseOrigin(w,g,f,Q);var l=new Uint32Array(6*f+2*k.length),m=6*f,q=new Float64Array(Z.buffer,3*E*Z.BYTES_PER_ELEMENT,3*m),t=new Float64Array(aa.buffer,3*E*aa.BYTES_PER_ELEMENT,
3*m),u=new Float64Array(H.buffer,3*E*H.BYTES_PER_ELEMENT,3*m),n=new Float64Array(O.buffer,1*E*O.BYTES_PER_ELEMENT,1*m);z(w,ea,k,c,q,u,t,n,0,l,0,P,C,R);e.subtractCoordinates(q,0,m,Q);E+=6*f;c=G._createExtrudeGeometry(l,{positions:q,elevation:u,normals:t,heights:n},h);b=new r(c,p+"path"+b);b.singleUse=!0;L.push(b);B.push([G._material]);b=d.mat4d.identity();d.mat4d.translate(b,Q,b);A.push(b)}};var G=this;for(c=0;c<N.length;++c)f(c);if(0<L.length){var V=new t({geometries:L,materials:B,transformations:A,
castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:u},idHint:p}),K=function(a){var b=n._context.stage.view.getEdgeView();if(b){b.removeObject(a);n._edgeStageObjects.delete(a);var c={opacity:n._getLayerOpacity(),slicePlaneEnabled:n._context.slicePlaneEnabled};if(c=k.createMaterial(b,n.symbol,c))n._edgeStageObjects.add(a),b.addObject(a,[c])}};K(V);u=new l(this,V,L,null,null,function(a,b,c,d){a=a.stageObject;var f=d.setAltitude;F.spatialReference=c.spatialReference;for(var g=a.getGeometryRecords(),
h=g.length,k="absolute-height"!==b.mode,l=0,m=0;m<h;m++){var p=g[m].geometry,q=g[m].transformation;J[0]=q[12];J[1]=q[13];J[2]=q[14];p.invalidateBoundingInfo();for(var r=p.data.getVertexAttr(),p=r[v.VertexAttrConstants.POSITION].data,q=r[v.VertexAttrConstants.SIZE].data,r=r.mapPos.data,t=p.length/3,u=0,n=0,x=!1,L=0,B=0;B<t;B++){F.x=r[n];F.y=r[n+1];F.z=r[n+2];U[0]=p[u];U[1]=p[u+1];U[2]=p[u+2];var A=e.computeElevation(c,F,b,d,k?I:null);k&&(L+=I.terrainElevation);D[0]=p[u]+J[0];D[1]=p[u+1]+J[1];D[2]=
p[u+2]+J[2];f(A+q[u/3],D);p[u]=D[0]-J[0];p[u+1]=D[1]-J[1];p[u+2]=D[2]-J[2];A=.01/d.unitInMeters;if(Math.abs(U[0]-p[u])>A||Math.abs(U[1]-p[u+1])>A||Math.abs(U[2]-p[u+2])>A)x=!0;n+=3;u+=3}x&&a.geometryVertexAttrsUpdated(m);l+=L/t}b=l/h;K(V);return b},m);u.alignedTerrainElevation=g.terrainElevation;u.needsElevationUpdates=e.needsElevationUpdates3D(m.mode);return u}}return null};g.prototype._createExtrudeGeometry=function(a,b,c){for(var d=a.length,e=new Uint32Array(d),f=0;f<d;f++)e[f]=0;d={};f={};d[v.VertexAttrConstants.POSITION]=
a;d[v.VertexAttrConstants.NORMAL]=a;d[v.VertexAttrConstants.COLOR]=e;f[v.VertexAttrConstants.POSITION]={size:3,data:b.positions};f[v.VertexAttrConstants.NORMAL]={size:3,data:b.normals};f[v.VertexAttrConstants.COLOR]={size:4,data:c};f[v.VertexAttrConstants.SIZE]={size:1,data:b.heights};b.elevation&&(f.mapPos={size:3,data:b.elevation},d.mapPos=a);return new u(f,d)};return g}(h);var K=d.vec3d.create(),N=d.vec3d.create(),H=d.vec3d.create(),M=d.vec3d.create(),T=d.vec3d.create(),V=d.vec3d.create(),U=d.vec3d.create(),
J=d.vec3d.create();return n})},"esri/views/3d/layers/support/edgeUtils":function(){define(["require","exports","../../../../Color","../../../../core/screenUtils"],function(n,g,c,a){function f(b,f,e){if(!f)return null;var g=c.toUnitRGBA(f.color),l=e.opacity;e=e.slicePlaneEnabled;switch(f.type){case "solid":return b.createSolidEdgeMaterial({color:g,size:a.pt2px(f.size),extensionLength:a.pt2px(f.extensionLength),opacity:l,slicePlaneEnabled:e});case "sketch":return b.createSketchEdgeMaterial({color:g,
size:a.pt2px(f.size),extensionLength:a.pt2px(f.extensionLength),opacity:l,slicePlaneEnabled:e})}}Object.defineProperty(g,"__esModule",{value:!0});g.createMaterial=function(a,c,e){return f(a,c&&c.enabled&&c.edges||null,e)};g.createMaterialFromEdges=f})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/has ../../layers/graphics/graphicUtils ../../lib/gl-matrix ../../support/buffer/InterleavedLayout ../lib/GLMaterialTexture ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ./internal/MaterialUtil ../shaders/DefaultPrograms".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){function u(a,b,c){c=b.slicePlaneEnabled?!1:b.cullFace?"none"!==b.cullFace:!b.transparent&&!b.doubleSided;c?(a.setFaceCullingEnabled(!0),"front"===b.cullFace?a.setCullFace(1028):a.setCullFace(1029)):a.setFaceCullingEnabled(!1)}function t(a,b){return a?m.TRANSPARENT_MATERIAL:b?m.STENCIL_MATERIAL:m.OPAQUE_MATERIAL}function v(a,c){var d=c.vvSizeEnabled;c.vvSizeEnabled?(a.setUniform3fv("vvSizeMinSize",c.vvSizeMinSize),a.setUniform3fv("vvSizeMaxSize",c.vvSizeMaxSize),
a.setUniform3fv("vvSizeOffset",c.vvSizeOffset),a.setUniform3fv("vvSizeFactor",c.vvSizeFactor)):d&&a.setUniform3fv("vvSizeValue",c.vvSizeValue);d&&(a.setUniform3fv("vvSymbolAnchor",c.vvSymbolAnchor),f.computeObjectRotation(c.vvSymbolRotation[2],c.vvSymbolRotation[0],c.vvSymbolRotation[1],b.mat4d.identity(K)),a.setUniformMatrix3fv("vvSymbolRotation",b.mat4d.toMat3(K,I)));c.vvColorEnabled&&(a.setUniform1fv("vvColorValues",c.vvColorValues),a.setUniform4fv("vvColorColors",c.vvColorColors))}var A=k.assert;
n=function(a){function d(b,c){c=a.call(this,c)||this;c.supportsEdges=!0;c.params=p.copyParameters(b,G);c.instanced=!!b.instanced;c.vertexBufferLayout=d.getVertexBufferLayout(c.params);c.instanceBufferLayout=c.instanced?d.getInstanceBufferLayout(c.params):null;c.bufferWriter=new E(c.vertexBufferLayout,c.instanceBufferLayout);return c}c(d,a);d.prototype.isVisible=function(){var b=this.params;if(!a.prototype.isVisible.call(this)||0===b.layerOpacity)return!1;var c=b.instanced,d=b.vertexColors,e=b.symbolColors,
c=!!c&&-1<c.indexOf("color"),f=b.vvColorEnabled,g="replace"===b.colorMixMode,h=0<b.opacity,b=b.externalColor&&0<b.externalColor[3];return d&&(c||f||e)?g?!0:h:d?g?b:h:c||f||e?g?!0:h:g?b:h};d.prototype.getParams=function(){return this.params};d.prototype.getParameterValues=function(){return p.copyParameters(this.params)};d.prototype.setParameterValues=function(a){var b=this.params,c;for(c in a)"textureId"===c&&A(b.textureId,"Can only change texture of material that already has a texture"),"castShadows"===
c&&A(a.castShadows===b.castShadows,"Can not change shadow casting behavior."),b[c]=a[c];this.notifyDirty("matChanged")};d.prototype.intersect=function(a,c,d,e,f,g,h,k){if(null!==this.params.verticalOffset){k=e.camera;b.vec3d.set3(d[12],d[13],d[14],U);var l=b.vec3d.subtract(U,k.eye,J),m=b.vec3d.length(l),q=b.vec3d.scale(l,1/m),r=null,l=null;switch(e.viewingMode){case "global":l=b.vec3d.normalize(U,T);break;case "local":l=b.vec3d.set(M,T)}this.params.screenSizePerspective&&(r=b.vec3d.dot(l,q));k=p.verticalOffsetAtDistance(k,
m,this.params.verticalOffset,r,this.params.screenSizePerspective);b.vec3d.scale(l,k);b.mat3d.multiplyVec3(e.transformInverseRotation,l,V);f=b.vec3d.subtract(f,V,N);g=b.vec3d.subtract(g,V,H)}p.intersectTriangleGeometry(a,c,d,e,f,g,h)};d.prototype.getGLMaterials=function(){return{color:z,depthShadowMap:this.params.castShadows?B:null,normal:D,depth:x,highlight:C}};d.prototype.getAllTextureIds=function(){return this.params.textureId?[this.params.textureId]:[]};d.getVertexBufferLayout=function(a){var b=
l.newLayout().vec3f("position");a.groundNormalShading||(b=a.compressedNormals?b.vec2i16("normalCompressed",{glNormalized:!0}):b.vec3f("normal"));a.textureId&&(b=b.vec2f("uv0"),a.atlasRegions&&(b=b.vec4u16("region",{glNormalized:!0})));a.vertexColors&&(b=b.vec4u8("color"));a.symbolColors&&(b=b.vec4u8("symbolColor"));a.componentIndices&&(b=b.u16("componentIndex").u16("_padding",{glPadding:!0}));return b};d.getInstanceBufferLayout=function(a){var b=l.newLayout(),b=a.instancedDoublePrecision?b.vec3f("modelOriginHi").vec3f("modelOriginLo").mat3f("model").mat3f("modelNormal"):
b.mat4f("model").mat4f("modelNormal");a.instanced&&-1<a.instanced.indexOf("color")&&(b=b.vec4f("instanceColor"));a.instanced&&-1<a.instanced.indexOf("featureAttribute")&&(b=b.vec4f("instanceFeatureAttribute"));return b};return d}(h);var z=function(a){function b(b,c,d){var e=this,f=b.getParams(),e=a.call(this,b,c,d,f.textureId,f.textureInitTransparent)||this;e.params=p.copyParameters(f);b=e.params;e.slot=t(b.transparent,b.writeStencil);e.texturing=b.textureId?b.atlasRegions?"AtlasTextured":"Textured":
"none";b=b.instanced;e.instanced=!!b;e.instancedColor=!!b&&-1<b.indexOf("color");e._createPrograms();return e}c(b,a);b.prototype._createPrograms=function(){var a=this;this.programs=q.BindParametersMap.create(this.params,function(b){return a._createProgram(b)})};b.prototype._createProgram=function(a){var b=this.params;return this.programRep.getProgram(r.colorPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,vertexColors:b.vertexColors,symbolColors:b.symbolColors,
flipV:b.flipV,doubleSided:b.doubleSided&&"normal"===b.doubleSidedType,windowOrderDoubleSided:b.doubleSided&&"winding-order"===b.doubleSidedType,instanced:!!this.instanced,instancedDoublePrecision:b.instancedDoublePrecision,instancedColor:this.instancedColor,receiveShadows:a.receiveShadows,receiveSSAO:a.receiveSSAO,vvSize:b.vvSizeEnabled,vvColor:b.vvColorEnabled,verticalOffset:null!==b.verticalOffset,screenSizePerspective:null!==b.screenSizePerspective,slice:b.slicePlaneEnabled,groundNormalShading:b.groundNormalShading,
compressedNormals:b.compressedNormals,componentColor:null!=b.componentColorBuffer,transparencyDiscard:b.transparent,alphaCoverageCorrection:F})};b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program||this.getPrograms()[0]};b.prototype.getPrograms=function(){return q.BindParametersMap.programs(this.programs)};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.slot=t(this.params.transparent,this.params.writeStencil);
this.updateTexture(this.params.textureId);this._createPrograms()};b.prototype.bind=function(a,b){var c=this.params,d=this.program=q.BindParametersMap.lookup(this.programs,b);a.bindProgram(d);d.setUniform3fv("ambient",c.ambient);d.setUniform3fv("diffuse",c.diffuse);d.setUniform3fv("specular",c.specular);d.setUniform4fv("externalColor",c.externalColor);d.setUniform1i("colorMixMode",p.colorMixModes[c.colorMixMode]);d.setUniform1f("opacity",c.opacity);d.setUniform1f("layerOpacity",c.layerOpacity);p.bindVerticalOffset(c.verticalOffset,
b,d);p.bindScreenSizePerspective(c.screenSizePerspective,b,d);v(d,c);this.bindTexture(a,d);"none"!==this.texturing&&this.bindTextureSize(a,d);a.setBlendFunctionSeparate(770,771,1,771);c.inverseWindingOrder&&a.setFrontFace(2304);c.transparent?(a.setBlendingEnabled(!0),c.blendModeOneOne?(a.setBlendFunction(1,1),a.setDepthWriteEnabled(!1)):a.setBlendFunctionSeparate(770,771,1,771)):a.setBlendingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(2,2));u(a,c,b);a.setDepthTestEnabled(!0);
c.componentIndices&&c.componentColorBuffer&&(c.componentColorBuffer.updateTexture(),c.componentColorBuffer.bind(d,{texName:"uComponentColorTex",invDimName:"uComponentColorTexInvDim",unit:1}))};b.prototype.release=function(a,b){a.setPolygonOffsetFillEnabled(!1);a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!1);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthWriteEnabled(!0);a.setFrontFace(2305)};b.prototype.bindView=function(a,b){a=this.program=q.BindParametersMap.lookup(this.programs,b);var c=
this.params,d=c.instancedDoublePrecision?[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;p.bindView(d,b.view,a);p.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&p.bindViewOriginDouble(d,a);c.slicePlaneEnabled&&p.bindSlicePlane(d,b.slicePlane,a);b.shadowMappingEnabled&&b.shadowMap.bindView(a,d)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=
function(a){return 4};return b}(e),x=function(a){function b(b,c,d,e){void 0===e&&(e=!1);c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=p.copyParameters(b.getParams());c.instanced=!!c.params.instanced;c.texturing=b.bufferWriter.vertexBufferLayout.hasField("uv0")?c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.biased=e;c.selectProgram();c.selectSlot();return c}c(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};
b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(r.depthPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,shadowMap:this.biased,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,
alphaCoverageCorrection:F})};b.prototype.selectSlot=function(){this.slot=t(this.params.transparent,this.params.writeStencil)};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform2fv("nearFar",b.nearFar);d.inverseWindingOrder&&a.setFrontFace(2304);p.bindVerticalOffset(d.verticalOffset,b,c);p.bindScreenSizePerspective(d.screenSizePerspective,
b,c);v(c,d);this.bindTexture(a,c);u(a,d,b);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2305)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;p.bindView(d,b.view,a);c.slicePlaneEnabled&&p.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&p.bindCamPos(d,b.viewInvTransp,
a);c.instancedDoublePrecision&&p.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 4};return b}(e),B=function(a){function b(b,c,d){return a.call(this,b,c,d,!0)||this}c(b,a);return b}(x),D=function(a){function b(b,c,d,e){void 0===e&&(e=!1);c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=p.copyParameters(b.getParams());c.instanced=!!c.params.instanced;c.texturing=b.bufferWriter.vertexBufferLayout.hasField("uv0")?
c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.selectProgram();c.selectSlot();return c}c(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(r.normalPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,
verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,compressedNormals:this.params.compressedNormals,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:F})};b.prototype.selectSlot=function(){this.slot=t(this.params.transparent,this.params.writeStencil)};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};
b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);this.bindTexture(a,c);p.bindVerticalOffset(d.verticalOffset,b,c);p.bindScreenSizePerspective(d.screenSizePerspective,b,c);v(c,d);u(a,d,b);d.inverseWindingOrder&&a.setFrontFace(2304);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2305)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?
[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;p.bindView(d,b.view,a);a.setUniformMatrix4fv("viewNormal",b.viewInvTransp);c.slicePlaneEnabled&&p.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&p.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&p.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=
function(a){return 4};return b}(e),C=function(a){function b(b,c,d,e){void 0===e&&(e=!1);c=a.call(this,b,c,d,b.getParams().textureId)||this;c.params=p.copyParameters(b.getParams());c.instanced=!!c.params.instanced;c.texturing=b.bufferWriter.vertexBufferLayout.hasField("uv0")?c.params.atlasRegions?"AtlasTextured":"Textured":"none";c.selectProgram();c.selectSlot();return c}c(b,a);b.prototype.beginSlot=function(a){return a===this.slot};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=
function(){this.program=this.programRep.getProgram(r.highlightPass,{viewingMode:this.programRep.globalOptions.viewingMode,textureMode:this.texturing,flipV:this.params.flipV,instanced:this.instanced,instancedDoublePrecision:this.params.instancedDoublePrecision,vvSize:this.params.vvSizeEnabled,verticalOffset:null!==this.params.verticalOffset,screenSizePerspective:null!==this.params.screenSizePerspective,slice:this.params.slicePlaneEnabled,transparencyDiscard:this.params.transparent,alphaCoverageCorrection:F})};
b.prototype.selectSlot=function(){this.slot=t(this.params.transparent,this.params.writeStencil)};b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram();this.selectSlot();this.updateTexture(this.params.textureId)};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);this.bindTexture(a,c);p.bindVerticalOffset(d.verticalOffset,b,c);p.bindScreenSizePerspective(d.screenSizePerspective,b,c);v(c,d);u(a,d,b);d.inverseWindingOrder&&
a.setFrontFace(2304);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setFaceCullingEnabled(!1);b.inverseWindingOrder&&a.setFrontFace(2304)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params,d=c.instancedDoublePrecision?[b.viewInvTransp[3],b.viewInvTransp[7],b.viewInvTransp[11]]:b.origin;p.bindView(d,b.view,a);c.slicePlaneEnabled&&p.bindSlicePlane(b.origin,b.slicePlane,a);c.screenSizePerspective&&p.bindCamPos(d,b.viewInvTransp,a);c.instancedDoublePrecision&&
p.bindViewOriginDouble(d,a)};b.prototype.bindInstance=function(a,b){a=this.program;a.setUniformMatrix4fv("model",b.transformation);a.setUniformMatrix4fv("modelNormal",b.transformationNormal)};b.prototype.getDrawMode=function(a){return 4};return b}(e),G={textureId:void 0,textureInitTransparent:!1,ambient:[.2,.2,.2],diffuse:[.8,.8,.8],specular:[0,0,0],externalColor:[1,1,1,1],colorMixMode:"multiply",opacity:1,layerOpacity:1,blendModeOneOne:!1,inverseWindingOrder:!1,vertexColors:!1,symbolColors:!1,componentIndices:!1,
componentColorBuffer:null,flipV:!1,doubleSided:!1,doubleSidedType:"normal",cullFace:void 0,instanced:void 0,instancedDoublePrecision:!1,compressedNormals:!1,groundNormalShading:!1,writeStencil:!1,receiveSSAO:!0,castShadows:!0,verticalOffset:null,screenSizePerspective:null,slicePlaneEnabled:!1,vvSizeEnabled:!1,vvSizeMinSize:[1,1,1],vvSizeMaxSize:[100,100,100],vvSizeOffset:[0,0,0],vvSizeFactor:[1,1,1],vvSizeValue:[1,1,1],vvColorEnabled:!1,vvColorValues:[0,0,0,0,0,0,0,0],vvColorColors:[1,0,0,0,1,0,0,
0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0],vvSymbolAnchor:[0,0,0],vvSymbolRotation:[0,0,0],transparent:!1,polygonOffset:!1,atlasRegions:!1},E=function(){function a(a,b){this.vertexBufferLayout=a;this.instanceBufferLayout=b}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices.position.length};a.prototype.write=function(a,b,c,e,f){d.writeDefaultAttributes(b,c,this.vertexBufferLayout,a.transformation,a.invTranspTransformation,
e,f)};return a}(),F=!!a("enable-feature:skallweit/lod-rendering"),I=b.mat3d.create(),K=b.mat4d.create(),N=b.vec3d.create(),H=b.vec3d.create(),M=b.vec3d.createFrom(0,0,1),T=b.vec3d.create(),V=b.vec3d.create(),U=b.vec3d.create(),J=b.vec3d.create();return n})},"esri/views/3d/webgl-engine/shaders/DefaultPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});
var b=function(a){return f.glslifyDefineMap({VIEWING_MODE_GLOBAL:"global"===a.viewingMode,VIEWING_MODE_LOCAL:"local"===a.viewingMode,TEXTURING:"none"!==a.textureMode,TEXTURE_ATLAS:"AtlasTextured"===a.textureMode,VERTEXCOLORS:a.vertexColors,SYMBOLVERTEXCOLORS:a.symbolColors,FLIPV:a.flipV,DOUBLESIDED:a.doubleSided,WINDINGORDERDOUBLESIDED:a.windowOrderDoubleSided,INSTANCED:a.instanced,INSTANCED_DOUBLE_PRECISION:a.instancedDoublePrecision,INSTANCEDCOLOR:a.instancedColor,RECEIVE_SHADOWS:a.receiveShadows,
RECEIVE_SSAO:a.receiveSSAO,VV_SIZE:a.vvSize,VV_COLOR:a.vvColor,VERTICAL_OFFSET:a.verticalOffset,SCREEN_SIZE_PERSPECTIVE:a.screenSizePerspective,SLICE:a.slice,GROUND_NORMAL_SHADING:a.groundNormalShading,COMPRESSED_NORMALS:a.compressedNormals,COMPONENTCOLORS:a.componentColor,TRANSPARENCY_DISCARD:a.transparencyDiscard,ALPHA_COVERAGE_CORRECTION:a.alphaCoverageCorrection,BIAS_SHADOWMAP:a.shadowMap})};g.colorPass={name:"default-color",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/defaultMaterial/colorPass.vert"),
fragmentShader:b(c)+a.resolveIncludes("materials/defaultMaterial/colorPass.frag")}},attributes:c.Default3D};g.depthPass={name:"default-depth",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/defaultMaterial/depthPass.vert"),fragmentShader:b(c)+a.resolveIncludes("materials/defaultMaterial/depthPass.frag")}},attributes:c.Default3D};g.normalPass={name:"default-normal",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/defaultMaterial/normalPass.vert"),
fragmentShader:b(c)+a.resolveIncludes("materials/defaultMaterial/normalPass.frag")}},attributes:c.Default3D};g.highlightPass={name:"default-highlight",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/defaultMaterial/highlightPass.vert"),fragmentShader:b(c)+a.resolveIncludes("materials/defaultMaterial/highlightPass.frag")}},attributes:c.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/tsSupport/extendsHelper dojo/when dojo/errors/CancelError ../../../../Color ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/screenUtils ../../../../core/urlUtils ../../../../symbols/support/symbolUtils ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./SignedDistanceFunctions ../support/FastSymbolUpdates ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K){function N(a){return"cross"===a||"x"===a}function H(a){var b;"primitive:"===a.substring(0,10)&&(a=a.substring(10));switch(a){case R.PRIM_CIRCLE:b=z.computeSignedDistancefieldCicle(128,64);break;case R.PRIM_SQUARE:b=z.computeSignedDistancefieldSquare(128,64,!1);break;case R.PRIM_KITE:b=z.computeSignedDistancefieldSquare(128,64,!0);break;case R.PRIM_CROSS:b=z.computeSignedDistancefieldCrossAndX(128,64,!1);break;case R.PRIM_X:b=z.computeSignedDistancefieldCrossAndX(128,
64,!0)}return new I(b,"sdf_"+a,{mipmap:!1,wrapClamp:!0,width:128,height:128,components:4})}var M=B.mat4d.identity(),T=[0,0,1],V=[0,0,0,0],U=[0,0,0],J=[1,1,1],O="center bottom top left right bottom-left bottom-right top-left top-right".split(" "),P=[.25,.25,.75,.75],R={PRIM_CIRCLE:"circle",PRIM_SQUARE:"square",PRIM_CROSS:"cross",PRIM_X:"x",PRIM_KITE:"kite"},Q=[64,64];n=function(g){function n(){var a=null!==g&&g.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};
return a}a(n,g);n.prototype._prepareResources=function(){var a=this.symbol,b=Math.round(null!=a.size?k.pt2px(a.size):16);this._size=null;this._symbolTextureRatio=1;this._primitive=null;var c=this._getStageIdHint();if(!this._isPropertyDriven("size")){var d=A.validateSymbolLayerSize(b);if(d){this._logWarning(d);this.reject();return}}this._isPropertyDriven("size")&&64>b&&(b=64);var e=a.resource||{primitive:"circle",href:void 0},d={anchorPos:this._getAnchorPos(a)},f=this.symbolContainer;if(this._hasVisibleVerticalOffset(f)){var f=
f.verticalOffset,g=f.minWorldLength,h=f.maxWorldLength;d.verticalOffset={screenLength:k.pt2px(f.screenLength),minWorldLength:g||0,maxWorldLength:null!=h?h:Infinity}}this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);e.href?(this._outlineSize=this._getOutlineSize(a,null),d.color=this._getFillColor(a,null),d.outlineColor=this._getOutlineColor(a),d.outlineSize=this._outlineSize,d.textureIsSignedDistanceField=!1,this._prepareImageResources(b,
d,c)):(e=e.primitive||"circle",f="primitive:"+e,this._primitive=e,this._outlineSize=this._getOutlineSize(a,e),d.color=this._getFillColor(a,e),d.outlineColor=this._getOutlineColor(a),d.outlineSize=this._outlineSize,N(e)&&0===d.outlineSize?this.reject():(this.texture=this._context.sharedResources.textures.acquire(f,H),this._textureURI=f,d.textureIsSignedDistanceField=!0,d.distanceFieldBoundingBox=P,d.textureId=this.texture.id,this._size=[b,b],this._symbolTextureRatio=2,this._createMaterialsAndAddToStage(d,
this._context.stage,c),this.resolve()))};n.prototype._getOutlineSize=function(a,b){var c=0,c=a.outline&&null!=a.outline.size?k.pt2px(a.outline.size):N(b)?1.5:0;return Math.max(c,0)};n.prototype._getOutlineColor=function(a){var b=this._getLayerOpacity();if(a.outline&&null!=a.outline.color){var c=l.toUnitRGB(a.outline.color);return[c[0],c[1],c[2],a.outline.color.a*b]}return[0,0,0,b]};n.prototype._getFillColor=function(a,b){return N(b)?V:this._getMaterialOpacityAndColor()};n.prototype._getAnchorPos=
function(a){return-1<O.indexOf(a.anchor)?a.anchor:"center"};n.prototype._prepareImageResources=function(a,c,g){var k=this,l=q.getIconHref(this.symbolContainer,this.symbol);!h("esri-canvas-svg-support")&&d.isSVG(l)?(this._logWarning("IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"),this.reject(new e("SVG Not Supported","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)"))):(f(this._context.sharedResources.textures.acquire(l,null,a),function(b){if(!k.isRejected()){var d=
b.params,e=d.width/d.height;k._size=a?1<e?[a,Math.round(a/e)]:[Math.round(a*e),a]:[d.width,d.height];c.textureId=b.id;k._createMaterialsAndAddToStage(c,k._context.stage,g);k.resolve()}},function(a){a instanceof b?k.reject():(a="IconSymbol3DLayer failed to load (Request for icon resource failed: "+l+")",k._logWarning(a),k.reject(new e("Request Failed",a)))}),this._textureURI=l)};n.prototype._createMaterialsAndAddToStage=function(a,b,d){this._fastUpdates=x.initFastSymbolUpdatesState(this._context.renderer,
this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&m.mixin(a,this._fastUpdates.materialParameters);var e=c({},a);e.verticalOffset=null;e.screenSizePerspective=null;e.occlusionTest=!1;e.slicePlaneEnabled=!1;e.shaderPolygonOffset=0;this._drapedMaterial=new K(e,d+"_iconDraped");b.add(C.ModelContentType.MATERIAL,this._drapedMaterial);a.occlusionTest=!0;a.slicePlaneEnabled=this._context.slicePlaneEnabled;this._material=new K(a,d+"_icon");b.add(C.ModelContentType.MATERIAL,this._material)};
n.prototype.destroy=function(){g.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(C.ModelContentType.MATERIAL,this._material.id),this._material=null);this._drapedMaterial&&(this._context.stage.remove(C.ModelContentType.MATERIAL,this._drapedMaterial.id),this._drapedMaterial=null);this._textureURI&&(this._context.sharedResources.textures.release(this._textureURI),this._textureURI=null)};n.prototype._getScaleFactor=function(a){if(this._isPropertyDriven("size")&&
a.size){for(var b=0;3>b;b++){var c=a.size[b];c&&"symbolValue"!==c&&"proportional"!==c&&(a.size[b]=k.pt2px(c))}b=this._size[0]>this._size[1]?this._size[0]:this._size[1];if("symbolValue"!==a.size[0]){if(isFinite(+a.size[0]))return+a.size[0]/b;if(isFinite(+a.size[2]))return+a.size[2]/b}}return 1};n.prototype.createGraphics3DGraphic=function(a){var b=a.renderingInfo;a=a.graphic;if(!this._validateGeometry(a.geometry))return null;var c=t.placePointOnGeometry(a.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+
a.geometry.type),null;var d="graphic"+a.uid,e=this._getVertexOpacityAndColor(b),f=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(f=this._getScaleFactor(b));f*=this._symbolTextureRatio;b=[this._size[0]*f,this._size[1]*f];f=this.getGraphicElevationContext(a);return"on-the-ground"===f.mode?this._createAsOverlay(a,c,e,b,f,d,a.uid):this._createAs3DShape(a,c,e,b,f,d,a.uid)};n.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._getFillColor(this.symbol,this._primitive),
this._drapedMaterial.setParameterValues({color:b}),this._material.setParameterValues({color:b}),b=this._getOutlineColor(this.symbol),this._drapedMaterial.setParameterValues({outlineColor:b}),this._material.setParameterValues({outlineColor:b}),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=t.needsElevationUpdates2D(d)||
"absolute-height"===d;for(var e in b){var f=b[e];(d=c(f))&&"object3d"===d.type&&(f=this.getGraphicElevationContext(f.graphic),d.needsElevationUpdates=a,d.elevationContext.set(f))}return!0}return!1};n.prototype.applyRendererDiff=function(a,b,c,d){for(var e in a.diff)switch(e){case "visualVariables":if(x.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._material.setParameterValues(this._fastUpdates.materialParameters),this._drapedMaterial.setParameterValues(this._fastUpdates.materialParameters);
else return!1;break;default:return!1}return!0};n.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._drapedMaterial&&(this._drapedMaterial.renderPriority=a,c.add(this._drapedMaterial.id))};Object.defineProperty(n.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0});n.prototype._defaultElevationInfoNoZ=function(){return L};n.prototype._createAs3DShape=function(a,b,c,d,e,f,g){var h=this,k=this.getFastUpdateAttrValues(a);a=k?function(a){return x.evaluateModelTransform(h._fastUpdates.materialParameters,
k,a)}:null;c=E.createPointGeometry(T,null,c,d,S,null,k);c=[new G(c,f)];f=t.createStageObjectForPoint.call(this,b,c,[[this._material]],null,null,e,f,this._context.layer.uid,g,!0,a);if(null===f)return null;var l=new u(this,f.object,c,null,null,p.perObjectElevationAligner,e);l.alignedTerrainElevation=f.terrainElevation;l.needsElevationUpdates=t.needsElevationUpdates2D(e.mode)||"absolute-height"===e.mode;l.getScreenSize=this._createScreenSizeGetter(d,a);l.calculateRelativeScreenBounds=function(a){return h._material.calculateRelativeScreenBounds(l.getScreenSize(),
1,a)};t.extendPointGraphicElevationContext(l,b,this._context.elevationProvider);return l};n.prototype._createAsOverlay=function(a,b,c,d,e,f,g){var h=this;this._drapedMaterial.renderPriority=this._symbolLayerOrder;e=B.vec3d.create();D.pointToVector(b,e,this._context.overlaySR);e[2]=this._getDrapedZ();if((b=this._context.clippingExtent)&&!t.pointInBox2D(e,b))return null;var k=this.getFastUpdateAttrValues(a);a=k?function(a){return x.evaluateModelTransform(h._fastUpdates.materialParameters,k,a)}:null;
c=E.createPointGeometry(T,e,c,d,null,null,k);b=new F(c);b.material=this._drapedMaterial;b.center=e;b.bsRadius=0;b.transformation=M;b.name=f;b.uniqueName=f+"#"+c.id;var l=new r(this,[b],null);l.getScreenSize=this._createScreenSizeGetter(d,a);l.calculateRelativeScreenBounds=function(a){return h._drapedMaterial.calculateRelativeScreenBounds(l.getScreenSize(),1,a)};return l};n.prototype._createScreenSizeGetter=function(a,b){var c=this._outlineSize+2;if(this._fastUpdates.enabled){var d=a[0]/this._symbolTextureRatio,
e=a[1]/this._symbolTextureRatio;return function(a){void 0===a&&(a=Array(2));var f=b(M);a[0]=f[0]*d+c;a[1]=f[5]*e+c;return a}}var f=a[0]/this._symbolTextureRatio+c,g=a[1]/this._symbolTextureRatio+c;return function(a){void 0===a&&(a=Array(2));a[0]=f;a[1]=g;return a}};n.prototype._fastVisualVariableConvertOptions=function(){var a=this._size[0]>this._size[1]?this._size[0]:this._size[1],b=[a,a,a],c=k.px2pt(1),a=a*c;return{modelSize:b,symbolSize:[a,a,a],unitInMeters:c,transformation:{anchor:U,scale:J,rotation:U}}};
n.prototype._hasVisibleVerticalOffset=function(a){return this.symbolContainer&&"point-3d"===this.symbolContainer.type&&this.symbolContainer.hasVisibleVerticalOffset()};n.PRIMITIVE_SIZE=Q;n.VALID_ANCHOR_STRINGS=O;return n}(v);var L={mode:"relative-to-ground",offset:0},S=B.vec4d.createFrom(0,0,0,1);return n})},"esri/symbols/support/symbolUtils":function(){define(["require","exports","../../core/has"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.isVolumetricSymbol=function(a){return(a=
a&&a.symbolLayers)?a.some(function(a){a=a.type;return"object"===a||"path"===a||"extrude"===a}):!1};g.getIconHref=function(f,b){b=b.resource.href;return!c("esri-canvas-svg-support")&&f.styleOrigin&&a.test(b)?b.replace(a,"/resource/png/$1.png"):b};var a=/\/resource\/(.*?)\.svg$/})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils".split(" "),
function(n,g,c,a,f,b,l,e){n=function(){function c(a,b,c){this.type="draped";this.graphics3DSymbolLayer=a;this.renderGeometries=b;this.boundingBox=c;this.stage=null;this._visible=!1}c.prototype.initialize=function(a,b){this.stage=b};c.prototype.setVisibility=function(a){if(null!=this.stage)return this._visible!==a?((this._visible=a)?this.stage.getDrapedTextureRenderer().addRenderGeometries(this.renderGeometries):this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries),!0):
!1};c.prototype.destroy=function(){this.stage&&this._visible&&this.stage.getDrapedTextureRenderer().removeRenderGeometries(this.renderGeometries);this._visible=!1;this.stage=null};c.prototype.getBSRadius=function(){return this.renderGeometries.reduce(function(a,b){return Math.max(a,b.bsRadius)},0)};c.prototype.getCenterObjectSpace=function(){return[0,0,0]};c.prototype.addHighlight=function(a,b){var c=this.stage.getDrapedTextureRenderer();this.renderGeometries.forEach(function(d){var e=c.addRenderGeometryHighlight(d,
b);a.addRenderGeometry(d,c,e)})};c.prototype.removeHighlight=function(a){this.renderGeometries.forEach(function(b){a.removeRenderGeometry(b)})};c.prototype.getProjectedBoundingBox=function(c,d,g,l){return f(this,void 0,void 0,function(){var f,m,p,q;return a(this,function(a){switch(a.label){case 0:b.empty(g);for(f=0;f<this.renderGeometries.length;f++)m=this.renderGeometries[f],this._getRenderGeometryProjectedBoundingRect(m,h,c,l),b.expand(g,h);if(!d)return[3,5];b.center(g,k);p=void 0;q=e.demResolutionForBoundingBox(g,
d);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,d.service.queryElevation(k[0],k[1],q)];case 2:return p=a.sent(),[3,4];case 3:return a.sent(),p=null,[3,4];case 4:null!=p&&(g[2]=Math.min(g[2],p),g[5]=Math.max(g[5],p)),a.label=5;case 5:return[2,g]}})})};c.prototype._getRenderGeometryProjectedBoundingRect=function(a,c,d,e){if(this.boundingBox)b.set(m,this.boundingBox);else{var f=a.center;a=a.bsRadius;m[0]=f[0]-a;m[1]=f[1]-a;m[2]=f[2]-a;m[3]=f[0]+a;m[4]=f[1]+a;m[5]=f[2]+a}d(m,0,2);this.calculateRelativeScreenBounds&&
e.push({location:b.center(m),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});return b.toRect(m,c)};return c}();var h=l.create(),m=b.create(),k=[0,0,0];return n})},"esri/views/3d/layers/graphics/SignedDistanceFunctions":function(){define(["require","exports","../../webgl-engine/lib/Util"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.computeSignedDistancefieldCicle=function(a,f){var b=new Uint8Array(4*a*a),g=a/2-.5;f/=2;for(var e=0;e<a;e++)for(var h=0;h<a;h++){var m=
h+a*e,k=h-g,d=e-g,k=Math.sqrt(k*k+d*d)-f,k=k/a+.5;c.packFloatRGBA(k,b,4*m)}return b};g.computeSignedDistancefieldSquare=function(a,f,b){b&&(f/=Math.SQRT2);for(var g=new Uint8Array(4*a*a),e=0;e<a;e++)for(var h=0;h<a;h++){var m=h-.5*(a-.5),k=e-.5*(a-.5),d=e*a+h;if(b)var q=(m+k)/Math.SQRT2,k=(k-m)/Math.SQRT2,m=q;m=Math.max(Math.abs(m),Math.abs(k))-.5*f;m=m/a+.5;c.packFloatRGBA(m,g,4*d)}return g};g.computeSignedDistancefieldCrossAndX=function(a,f,b){b&&(f*=Math.SQRT2);f*=.5;for(var g=new Uint8Array(4*
a*a),e=0;e<a;e++)for(var h=0;h<a;h++){var m=h-.5*a,k=e-.5*a,d=e*a+h;if(b)var q=(m+k)/Math.SQRT2,k=(k-m)/Math.SQRT2,m=q;q=void 0;m=Math.abs(m);k=Math.abs(k);q=m>k?m>f?Math.sqrt((m-f)*(m-f)+k*k):k:k>f?Math.sqrt(m*m+(k-f)*(k-f)):m;q=q/a+.5;c.packFloatRGBA(q,g,4*d)}return g}})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define(["require","exports","../../../../renderers/support/utils","../graphics/graphicUtils","../../lib/gl-matrix"],function(n,g,c,a,f){function b(a){return null!==a&&
void 0!==a}function l(a){return"number"===typeof a}function e(a,b){a&&a.push(b)}function h(a,d,f,g,h){var k=a.minSize,p=a.maxSize;if(a.expression)return e(h,"Could not convert size info: expression not supported"),!1;if(a.useSymbolValue)return a=g.symbolSize[f],d.minSize[f]=a,d.maxSize[f]=a,d.offset[f]=d.minSize[f],d.factor[f]=0,d.type[f]=1,!0;if(b(a.field)){if(b(a.stops)){if(2===a.stops.length&&l(a.stops[0].size)&&l(a.stops[1].size))return m(a.stops[0].size,a.stops[1].size,a.stops[0].value,a.stops[1].value,
d,f),d.type[f]=1,!0;e(h,"Could not convert size info: stops only supported with 2 elements");return!1}if(l(k)&&l(p)&&b(a.minDataValue)&&b(a.maxDataValue))return m(k,p,a.minDataValue,a.maxDataValue,d,f),d.type[f]=1,!0;if(null!=c.meterIn[a.valueUnit])return d.minSize[f]=-Infinity,d.maxSize[f]=Infinity,d.offset[f]=0,d.factor[f]=1/c.meterIn[a.valueUnit],d.type[f]=1,!0;"unknown"===a.valueUnit?e(h,"Could not convert size info: proportional size not supported"):e(h,"Could not convert size info: scale-dependent size not supported");
return!1}if(!b(a.field)){if(a.stops&&a.stops[0]&&l(a.stops[0].size))return d.minSize[f]=a.stops[0].size,d.maxSize[f]=a.stops[0].size,d.offset[f]=d.minSize[f],d.factor[f]=0,d.type[f]=1,!0;if(l(k))return d.minSize[f]=k,d.maxSize[f]=k,d.offset[f]=k,d.factor[f]=0,d.type[f]=1,!0}e(h,"Could not convert size info: unsupported variant of sizeInfo");return!1}function m(a,b,c,d,e,f){d=0<Math.abs(d-c)?(b-a)/(d-c):0;e.minSize[f]=0<d?a:b;e.maxSize[f]=0<d?b:a;e.offset[f]=a-c*d;e.factor[f]=d}function k(a,b,c,d){if(a.normalizationField||
a.valueRepresentation)return e(d,"Could not convert size info: unsupported property"),null;var f=a.field;if(null!=f&&"string"!==typeof f)return e(d,"Could not convert size info: field is not a string"),null;if(!b.size)b.size={field:a.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[0,0,0]};else if(a.field)if(!b.size.field)b.size.field=a.field;else if(a.field!==b.size.field)return e(d,"Could not convert size info: multiple fields in use"),null;switch(a.axis){case "width":return(f=
h(a,b.size,0,c,d))?b:null;case "height":return(f=h(a,b.size,2,c,d))?b:null;case "depth":return(f=h(a,b.size,1,c,d))?b:null;case "width-and-depth":return(f=h(a,b.size,0,c,d))&&h(a,b.size,1,c,d),f?b:null;case null:case void 0:case "all":return(f=(f=(f=h(a,b.size,0,c,d))&&h(a,b.size,1,c,d))&&h(a,b.size,2,c,d))?b:null;default:return e(d,'Could not convert size info: unknown axis "'+a.axis+'""'),null}}function d(a,b,c){for(var d=0;3>d;++d){var f=b.unitInMeters;1===a.type[d]&&(f*=b.modelSize[d],a.type[d]=
2);a.minSize[d]/=f;a.maxSize[d]/=f;a.offset[d]/=f;a.factor[d]/=f}if(0!==a.type[0])b=0;else if(0!==a.type[1])b=1;else if(0!==a.type[2])b=2;else return e(c,"No size axis contains a valid size or scale"),!1;for(d=0;3>d;++d)0===a.type[d]&&(a.minSize[d]=a.minSize[b],a.maxSize[d]=a.maxSize[b],a.offset[d]=a.offset[b],a.factor[d]=a.factor[b],a.type[d]=a.type[b]);return!0}function q(a,b,c){a[4*b+0]=c.r/255;a[4*b+1]=c.g/255;a[4*b+2]=c.b/255;a[4*b+3]=c.a}function p(a,c,d){if(a.normalizationField)return e(d,
"Could not convert color info: unsupported property"),null;if("string"===typeof a.field)if(a.stops){if(8<a.stops.length)return e(d,"Could not convert color info: too many color stops"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};a=a.stops;for(d=0;8>d;++d){var f=a[Math.min(d,a.length-1)];c.color.values[d]=f.value;q(c.color.colors,d,f.color)}}else if(a.colors){if(!b(a.minDataValue)||!b(a.maxDataValue))return e(d,"Could not convert color info: missing data values"),
null;if(2!==a.colors.length)return e(d,"Could not convert color info: invalid colors array"),null;c.color={field:a.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};c.color.values[0]=a.minDataValue;q(c.color.colors,0,a.colors[0]);c.color.values[1]=a.maxDataValue;q(c.color.colors,1,a.colors[1]);for(d=2;8>d;++d)c.color.values[d]=a.maxDataValue,q(c.color.colors,d,a.colors[1])}else return e(d,"Could not convert color info: missing stops or colors"),
null;else if(a.stops&&0<=a.stops.length||a.colors&&0<=a.colors.length)for(a=a.stops&&0<=a.stops.length?a.stops[0].color:a.colors[0],c.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},d=0;8>d;d++)c.color.values[d]=Infinity,q(c.color.colors,d,a);else return e(d,"Could not convert color info: no field and no colors/stops"),null;return c}function r(a,b,c,d){a=2===c&&"arithmetic"===a.rotationType;b.offset[c]=a?90:0;b.factor[c]=a?-1:1;
b.type[c]=1}function u(a,b,c){if("string"!==typeof a.field)return e(c,"Could not convert rotation info: field is not a string"),null;if(!b.rotation)b.rotation={field:a.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(a.field)if(!b.rotation.field)b.rotation.field=a.field;else if(a.field!==b.rotation.field)return e(c,"Could not convert rotation info: multiple fields in use"),null;switch(a.axis){case "tilt":return r(a,b.rotation,0,c),b;case "roll":return r(a,b.rotation,1,c),b;case null:case void 0:case "heading":return r(a,
b.rotation,2,c),b;default:return e(c,'Could not convert rotation info: unknown axis "'+a.axis+'""'),null}}function t(a,b,c){if(!a)return null;var f=!b.supportedTypes||!!b.supportedTypes.size,g=!b.supportedTypes||!!b.supportedTypes.color,h=!b.supportedTypes||!!b.supportedTypes.rotation;return(a=a.reduce(function(a,d){if(!a)return a;if(d.valueExpression)return e(c,"Could not convert visual variables: arcade expressions not supported"),null;switch(d.type){case "size":return f?k(d,a,b,c):a;case "color":return g?
p(d,a,c):a;case "rotation":return h?u(d,a,c):a;default:return e(c,"Could not convert visual variables: unsupported type "+d.type),null}},{size:null,color:null,rotation:null}))&&a.size&&!d(a.size,b,c)?null:a}function v(a,b,c){if(!!a!==!!b||a&&a.field!==b.field)return!1;if(a&&"rotation"===c)for(c=0;3>c;c++)if(a.type[c]!==b.type[c]||a.offset[c]!==b.offset[c]||a.factor[c]!==b.factor[c])return!1;return!0}function A(a,b){var c={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,
vvSizeValue:null,vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvSymbolAnchor:null,vvSymbolRotation:null},d=a&&null!=a.size;a&&a.size?(c.vvSizeEnabled=!0,c.vvSizeMinSize=a.size.minSize,c.vvSizeMaxSize=a.size.maxSize,c.vvSizeOffset=a.size.offset,c.vvSizeFactor=a.size.factor):a&&d&&(c.vvSizeValue=b.transformation.scale);a&&d&&(c.vvSymbolAnchor=b.transformation.anchor,c.vvSymbolRotation=b.transformation.rotation);a&&a.color&&(c.vvColorEnabled=!0,c.vvColorValues=a.color.values,c.vvColorColors=
a.color.colors);return c}Object.defineProperty(g,"__esModule",{value:!0});g.convertVisualVariables=t;g.initFastSymbolUpdatesState=function(a,b){return!a||a.disableFastUpdates?{enabled:!1}:(a=t(a.visualVariables,b))?{enabled:!0,visualVariables:a,materialParameters:A(a,b),customTransformation:a&&null!=a.size}:{enabled:!1}};g.updateFastSymbolUpdatesState=function(a,b,c){if(!b||!a.enabled)return!1;var d=a.visualVariables;b=t(b.visualVariables,c);if(!(b&&v(d.size,b.size,"size")&&v(d.color,b.color,"color")&&
v(d.rotation,b.rotation,"rotation")))return!1;a.visualVariables=b;a.materialParameters=A(b,c);a.customTransformation=b&&null!=b.size;return!0};g.getMaterialParams=A;var z;(function(b){var c=f.mat4d.create(),d=f.vec3d.create();b.evaluateModelTransform=function(b,e,g){if(!b.vvSizeEnabled)return g;f.mat4d.set(g,c);a.computeObjectRotation(b.vvSymbolRotation[2],b.vvSymbolRotation[0],b.vvSymbolRotation[1],c);if(b.vvSizeEnabled){for(g=0;3>g;++g){var h=b.vvSizeOffset[g]+e[0]*b.vvSizeFactor[g],k=g;var l=b.vvSizeMinSize[g],
m=b.vvSizeMaxSize[g],h=h<l?l:h>m?m:h;d[k]=h}f.mat4d.scale(c,d,c)}else f.mat4d.scale(c,b.vvSizeValue,c);f.mat4d.translate(c,b.vvSymbolAnchor,c);return c}})(z||(z={}));g.evaluateModelTransform=z.evaluateModelTransform})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/screenUtils ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/gl-matrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v){return function(g){function k(){return null!==g&&g.apply(this,arguments)||this}c(k,g);k.prototype._prepareResources=function(){var b=this.symbol,c=this._isPropertyDriven("size")||this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),e=this._getStageIdHint();b=null!=b.size?a.pt2px(b.size):1;e={idHint:e,width:b,color:this._getMaterialOpacityAndColor(),slicePlaneEnabled:this._context.slicePlaneEnabled};if(!this._isPropertyDriven("size")&&(b=
d.validateSymbolLayerSize(e.width))){this._logWarning(b);this.reject();return}if(c||1.5<=e.width)this._isPropertyDriven("size")&&(e.width=0),this._material=q.createRibbonMaterial(e);else if(0<e.width)this._material=q.createNativeMaterial(e);else{this.reject();return}this._context.stage.add(r.ModelContentType.MATERIAL,this._material);this.resolve()};k.prototype.destroy=function(){g.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(r.ModelContentType.MATERIAL,
this._material.id),this._material=null)};k.prototype.createGraphics3DGraphic=function(b){var c=b.renderingInfo;b=b.graphic;var d=b.geometry;if("polyline"!==d.type&&"polygon"!==d.type&&"extent"!==d.type)return this._logWarning("unsupported geometry type for line symbol: "+d.type),null;if(!this._validateGeometry(d))return null;var d="polygon"===d.type||"extent"===d.type?"rings":"paths",e="graphic"+b.uid,f=this._getVertexOpacityAndColor(c,Float32Array,255),g=0;c.size&&this._isPropertyDriven("size")&&
(g=m.getSingleSizeDriver(c.size),g=a.pt2px(g));c=this.getGraphicElevationContext(b);return"on-the-ground"===c.mode?this._createAsOverlay(b,d,f,g,c,e):this._createAs3DShape(b,d,f,g,c,e,b.uid)};k.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._material.getColor(),this._material.setColor([b[0],b[1],b[2],this._getMaterialOpacity()]),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var d=this._elevationContext.mode;if(null==a||null==
d)return!1;if("on-the-ground"===a&&"on-the-ground"===d)return!0;if(a!==d&&("on-the-ground"===a||"on-the-ground"===d))return!1;a=m.needsElevationUpdates2D(d);for(var e in b){var f=b[e];(d=c(f))&&"object3d"===d.type&&(f=f.graphic,d.needsElevationUpdates=a,d.elevationContext.set(this.getGraphicElevationContext(f)))}return!0}return!1};Object.defineProperty(k.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});k.prototype._getOutlineGeometry=function(a,b){return b};k.prototype._getGeometry=
function(a){a=a.geometry;"extent"===a.type&&(a=f.fromExtent(a));return a};k.prototype._createAs3DShape=function(a,b,c,d,e,f,g){var k=this._getGeometry(a),r=k[b],n=this._getOutlineGeometry(k,r);a=[];var v=[],x=[],A=p.vec3d.create(),z=Array(6),k=m.getGeometryVertexData3D(n,k.hasZ,k.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,e);this._logGeometryCreationWarnings(k,r,b,"LineSymbol3DLayer");if(0<n.length){for(var r=k.geometryData.outlines,
n=k.eleVertexData,B=k.vertexData,D=0;D<r.length;++D){var C=r[D];if(!(1>=C.count)){var P=C.index,R=C.count;if(this._context.clippingExtent&&(m.computeBoundingBox(n,P,R,z),m.boundingBoxClipped(z,this._context.clippingExtent)))continue;m.chooseOrigin(B,P,R,A);m.subtractCoordinates(B,P,R,A);C=new Float64Array(n.buffer,3*P*n.BYTES_PER_ELEMENT,3*R);P=new Float64Array(B.buffer,3*P*B.BYTES_PER_ELEMENT,3*R);P=q.createPolylineGeometry(P,C,"rings"===b,c,d);P=new u(P,f+"path"+D);P.singleUse=!0;a.push(P);v.push([this._material]);
P=p.mat4d.identity();p.mat4d.translate(P,A,P);x.push(P)}}if(0<a.length)return b=new t({geometries:a,materials:v,transformations:x,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:g},idHint:f}),b=new h(this,b,a,null,null,l.perVertexElevationAligner,e),b.alignedTerrainElevation=k.terrainElevation,b.needsElevationUpdates=m.needsElevationUpdates2D(e.mode),b}return null};k.prototype._createAsOverlay=function(a,c,d,f,g,h){var k=this._getGeometry(a);this._material.renderPriority=this._symbolLayerOrder;
var l=k[c],r=this._getOutlineGeometry(k,l);a=[];g=Array(6);var t=b.empty(),n=p.vec3d.create(),k=m.getGeometryVertexDataDraped(r,k.spatialReference,this._context.overlaySR);this._logGeometryCreationWarnings(k,l,c,"LineSymbol3DLayer");if(0<r.length){l=k.vertexData;r=k.geometryData.outlines;for(k=0;k<r.length;++k){var u=r[k],x=u.index,u=u.count;m.computeBoundingBox(l,x,u,g);if(!m.boundingBoxClipped(g,this._context.clippingExtent)){b.expand(t,g);m.chooseOrigin(l,x,u,n);m.subtractCoordinates(l,x,u,n);
m.setZ(l,x,u,this._getDrapedZ());u=new Float64Array(l.buffer,3*x*l.BYTES_PER_ELEMENT,3*u);x=p.mat4d.identity();p.mat4d.translate(x,n,x);var u=q.createPolylineGeometry(u,null,"rings"===c,d,f),A=new v(u);A.material=this._material;A.center=[.5*(g[0]+g[3]),.5*(g[1]+g[4]),0];A.bsRadius=.5*Math.sqrt((g[3]-g[0])*(g[3]-g[0])+(g[4]-g[1])*(g[4]-g[1]));A.transformation=x;A.name=h;A.uniqueName=h+"#"+u.id;a.push(A)}}return new e(this,a,t)}return null};return k}(k)})},"esri/views/3d/layers/graphics/lineUtils":function(){define("require exports ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Util ../../webgl-engine/materials/NativeLineMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(n,g,c,a,f,b){function l(a){var b=a.length;return a[0]===a[b-3]&&a[1]===a[b-2]&&a[2]===a[b-1]}Object.defineProperty(g,"__esModule",{value:!0});var e=a.VertexAttrConstants;g.createRibbonMaterial=function(a){var c={width:a.width,color:a.color,miterLimit:a.miterLimit,polygonOffset:!0,join:"miter",slicePlaneEnabled:a.slicePlaneEnabled};"miter"===a.join||"bevel"===a.join?c.join=a.join:a.join&&console.warn("unsupported join type for line symbol: "+a.join);return new b(c,a.idHint+"_ribbonlinemat")};
g.createNativeMaterial=function(a){return new f({color:a.color,slicePlaneEnabled:a.slicePlaneEnabled},a.idHint+"_nativelinemat")};g.isClosed=l;g.createPolylineGeometry=function(a,b,f,d,g){var h,k,m;if(f=f&&!l(a)){f=new Float32Array(a.length+3);for(k=0;k<a.length;k++)f[k]=a[k];k=f.length;f[k-3]=a[0];f[k-2]=a[1];f[k-1]=a[2];h=a.length/3+1;k=new Uint32Array(2*(h-1));m=new Uint32Array(2*(h-1))}else h=a.length/3,k=new Uint32Array(2*(h-1)),m=new Uint32Array(2*(h-1)),f=a;a=new Float32Array(1);a[0]=g;for(var q=
g=0,n=0;n<h-1;n++)k[g++]=n,k[g++]=n+1,m[q++]=0,m[q++]=0;g={};h={};g[e.POSITION]=k;g[e.COLOR]=m;g[e.SIZE]=m;h[e.POSITION]={size:3,data:f,offsetIdx:0,strideIdx:3};h[e.COLOR]={size:4,data:d,offsetIdx:0,strideIdx:4};h[e.SIZE]={size:1,data:a,offsetIdx:0,strideIdx:1};b&&(g.mapPos=k,h.mapPos={size:3,data:b,offsetIdx:0,strideIdx:3});return new c(h,g,c.DefaultOffsets,"line")}})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../lib/gl-matrix ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/NativeLinePrograms".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){var u=a.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");n=function(a){function g(b,c){c=a.call(this,c)||this;c.bufferWriter=new B;c.canBeMerged=!0;c.params=p.copyParameters(b,A);return c}c(g,a);g.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};g.prototype.getColor=function(){return this.params.color};g.prototype.getParameterValues=function(){return p.copyParameters(this.params)};g.prototype.intersect=function(a,
c,g,h,k,l,m,p){if(h.isSelection&&!e.isAllHidden(c.componentVisibilities,a.data.componentOffsets))if(d.isTranslationMatrix(g)){c=a.data.getVertexAttr().position.data;k=h.camera;l=h.point;f.vec3d.set3(l[0]-2,l[1]+2,0,M[0]);f.vec3d.set3(l[0]+2,l[1]+2,0,M[1]);f.vec3d.set3(l[0]+2,l[1]-2,0,M[2]);f.vec3d.set3(l[0]-2,l[1]-2,0,M[3]);for(p=0;4>p;p++)k.unprojectPoint(M[p],T[p]);b.plane.fromPoints(k.eye,T[0],T[1],V);b.plane.fromPoints(k.eye,T[1],T[2],U);b.plane.fromPoints(k.eye,T[2],T[3],J);b.plane.fromPoints(k.eye,
T[3],T[0],O);a=Number.MAX_VALUE;for(p=0;p<c.length-5;p+=3)if(D[0]=c[p]+g[12],D[1]=c[p+1]+g[13],D[2]=c[p+2]+g[14],C[0]=c[p+3]+g[12],C[1]=c[p+4]+g[13],C[2]=c[p+5]+g[14],!(0>b.plane.distance(V,D)&&0>b.plane.distance(V,C)||0>b.plane.distance(U,D)&&0>b.plane.distance(U,C)||0>b.plane.distance(J,D)&&0>b.plane.distance(J,C)||0>b.plane.distance(O,D)&&0>b.plane.distance(O,C))){k.projectPoint(D,F);k.projectPoint(C,I);if(0>F[2]&&0<I[2]){f.vec3d.subtract(D,C,G);var q=k.frustumPlanes,r=-b.plane.distance(q[4],D),
q=r/f.vec3d.dot(G,q[4]);f.vec3d.scale(G,q,G);f.vec3d.add(D,G,D);k.projectPoint(D,F)}else if(0<F[2]&&0>I[2])f.vec3d.subtract(C,D,G),q=k.frustumPlanes,r=-b.plane.distance(q[4],C),q=r/f.vec3d.dot(G,q[4]),f.vec3d.scale(G,q,G),f.vec3d.add(C,G,C),k.projectPoint(C,I);else if(0>F[2]&&0>I[2])continue;q=d.pointLineSegmentDistanceSquared2D(F,I,l);q<a&&(a=q,f.vec3d.set(D,K),f.vec3d.set(C,N))}g=h.p0;h=h.p1;4>a&&(a=d.lineLineDistanceSquared3D(K,N,g,h,H),c=Number.MAX_VALUE,a.success&&(f.vec3d.subtract(a.pa,g,E),
a=f.vec3d.length(E),f.vec3d.scale(E,1/a),c=a/f.vec3d.dist(g,h)),m(c,E))}else u.error("intersection assumes a translation-only matrix")};g.prototype.getGLMaterials=function(){return{color:t,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:v}};g.prototype.getAllTextureIds=function(){return[]};return g}(m);var t=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}c(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};
b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(r.colorPass,{slice:this.params.slicePlaneEnabled})};b.prototype.beginSlot=function(a){return a===k.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("color",c.color);a.setBlendingEnabled(1>c.color[3]);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){1>this.params.color[3]&&
a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;p.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&p.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 1};return b}(h),v=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}c(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();
this.selectProgram()};b.prototype.beginSlot=function(a){return a===k.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(r.highlightPass,{slice:this.params.slicePlaneEnabled})};b.prototype.bind=function(a,b){a.bindProgram(this.program);a.setDepthTestEnabled(!0)};b.prototype.release=function(a){};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;p.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&
p.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 1};return b}(h),A={color:[1,1,1,1],slicePlaneEnabled:!1},z=l.newLayout().vec3f(d.VertexAttrConstants.POSITION),x,B=function(){function a(){this.vertexBufferLayout=z}a.prototype.allocate=function(a){return this.vertexBufferLayout.createBuffer(a)};a.prototype.elementCount=function(a){return a.indices[d.VertexAttrConstants.POSITION].length};
a.prototype.write=function(a,b,c,e,f){var g=c=b.vertexAttr[d.VertexAttrConstants.POSITION].data;if(a=a.transformation){if(!x||x.length<c.length)x=new Float32Array(c.length);for(var g=x,h=0;h<c.length;h+=3){var k=c[h],l=c[h+1],m=c[h+2];g[h]=a[0]*k+a[4]*l+a[8]*m+a[12];g[h+1]=a[1]*k+a[5]*l+a[9]*m+a[13];g[h+2]=a[2]*k+a[6]*l+a[10]*m+a[14]}}q.writeBufferVec3(b.indices[d.VertexAttrConstants.POSITION],g,e.position,f)};return a}(),D=f.vec3d.create(),C=f.vec3d.create(),G=f.vec3d.create(),E=f.vec3d.create(),
F=f.vec3d.create(),I=f.vec3d.create(),K=f.vec3d.create(),N=f.vec3d.create(),H={success:!1,dist2:0,pa:f.vec3d.create(),pb:f.vec3d.create()},M=[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],T=[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],V=b.plane.create(),U=b.plane.create(),J=b.plane.create(),O=b.plane.create();return n})},"esri/views/3d/webgl-engine/shaders/NativeLinePrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations",
"./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});g.colorPass={name:"native-line-color",shaders:function(b){return{vertexShader:a.resolveIncludes("materials/nativeLine/nativeLine.vert"),fragmentShader:f.glslifyDefineMap({SLICE:b.slice})+a.resolveIncludes("materials/nativeLine/colorPass.frag")}},attributes:c.Default3D};g.highlightPass={name:"native-line-highlight",shaders:function(b){return{vertexShader:a.resolveIncludes("materials/nativeLine/nativeLine.vert"),
fragmentShader:f.glslifyDefineMap({SLICE:b.slice})+a.resolveIncludes("materials/nativeLine/highlightPass.frag")}},attributes:c.Default3D}})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/Logger ../../lib/gl-matrix ../../support/geometryUtils ../../support/buffer/InterleavedLayout ../lib/ComponentUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/MaterialUtil ../shaders/RibbonLinePrograms".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p){var r=a.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");n=function(a){function g(b,c){c=a.call(this,c)||this;c.params=q.copyParameters(b,v);"miter"!==c.params.join&&(c.params.miterLimit=0);c.numVertsAtJoin="wall"===c.params.type?2:4;c.numVertsAtCap=2;c.canBeMerged="screen"===c.params.type&&null==c.params.stippleLength;c.bufferWriter="wall"===c.params.type?new B:new z(c.canBeMerged);return c}c(g,a);g.prototype.setColor=function(a){this.params.color=
a;this.notifyDirty("matChanged")};g.prototype.getColor=function(){return this.params.color};g.prototype.dispose=function(){};g.prototype.getParams=function(){return this.params};g.prototype.getParameterValues=function(){var a=q.copyParameters(this.params);a.miterLimit="miter"===a.join?a.miterLimit:0;return a};g.prototype.setParameterValues=function(a){for(var b in a)d.assert("type"!==b,"RibbonLineMaterial: type cannot be changed after creation"),d.assert("stippleLength"!==b||null!=a[b]===(null!=this.params[b]),
"RibbonLineMaterial: stippleLength on/off cannot be changed after creation"),this.params[b]=a[b];"miter"!==this.params.join&&(this.params.miterLimit=0);this.notifyDirty("matChanged")};g.prototype.intersect=function(a,c,g,h,k,l,m,p){if(h.isSelection&&!e.isAllHidden(c.componentVisibilities,a.data.componentOffsets))if(d.isTranslationMatrix(g)){c=a.data;a=c.getVertexAttr()[d.VertexAttrConstants.POSITION].data;c=c.getVertexAttr()[d.VertexAttrConstants.SIZE];l=h.camera;p=h.point;c=((c&&c.data[0])+this.params.width)/
2+4;f.vec3d.set3(p[0]-c,p[1]+c,0,V[0]);f.vec3d.set3(p[0]+c,p[1]+c,0,V[1]);f.vec3d.set3(p[0]+c,p[1]-c,0,V[2]);f.vec3d.set3(p[0]-c,p[1]-c,0,V[3]);for(var q=0;4>q;q++)l.unprojectPoint(V[q],U[q]);b.plane.fromPoints(l.eye,U[0],U[1],J);b.plane.fromPoints(l.eye,U[1],U[2],O);b.plane.fromPoints(l.eye,U[2],U[3],P);b.plane.fromPoints(l.eye,U[3],U[0],R);k=Number.MAX_VALUE;for(q=0;q<a.length-5;q+=3)if(G[0]=a[q]+g[12],G[1]=a[q+1]+g[13],G[2]=a[q+2]+g[14],E[0]=a[q+3]+g[12],E[1]=a[q+4]+g[13],E[2]=a[q+5]+g[14],!(0>
b.plane.distance(J,G)&&0>b.plane.distance(J,E)||0>b.plane.distance(O,G)&&0>b.plane.distance(O,E)||0>b.plane.distance(P,G)&&0>b.plane.distance(P,E)||0>b.plane.distance(R,G)&&0>b.plane.distance(R,E))){l.projectPoint(G,K);l.projectPoint(E,N);if(0>K[2]&&0<N[2]){f.vec3d.subtract(G,E,F);var t=l.frustumPlanes,n=-b.plane.distance(t[4],G),t=n/f.vec3d.dot(F,t[4]);f.vec3d.scale(F,t,F);f.vec3d.add(G,F,G);l.projectPoint(G,K)}else if(0<K[2]&&0>N[2])f.vec3d.subtract(E,G,F),t=l.frustumPlanes,n=-b.plane.distance(t[4],
E),t=n/f.vec3d.dot(F,t[4]),f.vec3d.scale(F,t,F),f.vec3d.add(E,F,E),l.projectPoint(E,N);else if(0>K[2]&&0>N[2])continue;t=d.pointLineSegmentDistanceSquared2D(K,N,p);t<k&&(k=t,f.vec3d.set(G,H),f.vec3d.set(E,M))}g=h.p0;h=h.p1;k<c*c&&(a=d.lineLineDistanceSquared3D(H,M,g,h,T),c=Number.MAX_VALUE,a.success&&(f.vec3d.subtract(a.pa,g,I),a=f.vec3d.length(I),f.vec3d.scale(I,1/a),c=a/f.vec3d.dist(g,h)),m(c,I))}else r.error("intersection assumes a translation-only matrix")};g.prototype.getGLMaterials=function(){return{color:u,
depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:t}};g.prototype.getAllTextureIds=function(){return[]};return g}(m);var u=function(a){function b(b,c){b=a.call(this,b,c)||this;b.updateParameters();return b}c(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.beginSlot=function(a){return a===k.TRANSPARENT_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=
this.programRep.getProgram(p.colorPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*
b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setBlendingEnabled(!0);a.setBlendFunctionSeparate(770,771,1,771);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};b.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setBlendingEnabled(!1);
a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;q.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&q.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 5};return b}(h),t=function(a){function b(b,c){b=a.call(this,b,c)||this;b.updateParameters();return b}c(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();
this.selectProgram()};b.prototype.beginSlot=function(a){return a===k.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(p.highlightPass,{screenScale:"screen"===this.params.type,wall:"wall"===this.params.type,stipple:null!=this.params.stippleLength,slice:this.params.slicePlaneEnabled})};b.prototype.bind=function(a,b){var c=this.program,d=this.params;a.bindProgram(c);c.setUniform4fv("eColor",d.color);c.setUniform1f("miterLimit",
d.miterLimit);c.setUniform1f("nearPlane",b.nearFar[0]);"screen"===d.type?(c.setUniform2fv("screenSize",[b.viewport[2],b.viewport[3]]),c.setUniform1f("extLineWidth",d.width*b.pixelRatio)):c.setUniform1f("extLineWidth",d.width);null!=d.stippleLength&&c.setUniform1f("stippleLengthDoubleInv",d.stippleLength?1/(2*d.stippleLength):0);d.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(0,-4));a.setFaceCullingEnabled(!1);a.setDepthTestEnabled(!0);a.setDepthWriteEnabled(1<=d.color[3])};
b.prototype.release=function(a){this.params.polygonOffset&&a.setPolygonOffsetFillEnabled(!1);a.setDepthWriteEnabled(!0)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;q.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&q.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 5};return b}(h),v={color:[1,1,1,1],width:0,type:"screen",join:"miter",miterLimit:5,
polygonOffset:!1,stippleLength:null,slicePlaneEnabled:!1},A=l.newLayout().vec3f(d.VertexAttrConstants.POSITION).vec2f(d.VertexAttrConstants.UV0).vec3f(d.VertexAttrConstants.AUXPOS1).vec3f(d.VertexAttrConstants.AUXPOS2).vec4f(d.VertexAttrConstants.COLOR).f32(d.VertexAttrConstants.SIZE),z=function(){function a(a){this.canBeMerged=a;this.vertexBufferLayout=A;this.numVertsAtJoin=4;this.numVertsAtCap=2}a.prototype.allocate=function(a){return A.createBuffer(a)};a.prototype.elementCount=function(a){a=(a.indices[d.VertexAttrConstants.POSITION].length/
2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap;this.canBeMerged&&(a+=2);return a};a.prototype.write=function(a,b,c,e,f){c=b.vertexAttr[d.VertexAttrConstants.POSITION].data;var g=b.indices&&b.indices[d.VertexAttrConstants.POSITION];g&&g.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");g=b.vertexAttr[d.VertexAttrConstants.COLOR]?b.vertexAttr[d.VertexAttrConstants.COLOR].data:D;b=b.vertexAttr[d.VertexAttrConstants.SIZE]?b.vertexAttr[d.VertexAttrConstants.SIZE].data:
C;var h=c.length/3;a=a.transformation;e=e.position.typedBuffer;var k=0,l=this.vertexBufferLayout.stride/4,m=f*=l;this.canBeMerged&&(f+=l);var p=c[0],q=c[1],r=c[2];if(a)var t=p,n=q,u=r,p=a[0]*t+a[4]*n+a[8]*u+a[12],q=a[1]*t+a[5]*n+a[9]*u+a[13],r=a[2]*t+a[6]*n+a[10]*u+a[14];var v=c[3],x=c[4],u=c[5];a&&(t=v,n=x,v=a[0]*t+a[4]*n+a[8]*u+a[12],x=a[1]*t+a[5]*n+a[9]*u+a[13],u=a[2]*t+a[6]*n+a[10]*u+a[14]);for(var A=p,z=q,B=r,L=0;L<h;L++)t=3*L,L<h-1&&(v=c[t+3],x=c[t+4],u=c[t+5],a&&(t=v,n=x,v=a[0]*t+a[4]*n+a[8]*
u+a[12],x=a[1]*t+a[5]*n+a[9]*u+a[13],u=a[2]*t+a[6]*n+a[10]*u+a[14])),k+=Math.sqrt((A-p)*(A-p)+(z-q)*(z-q)+(B-r)*(B-r)),e[f++]=A,e[f++]=z,e[f++]=B,e[f++]=k,e[f++]=0===L?-1.2:-1,e[f++]=p,e[f++]=q,e[f++]=r,e[f++]=v,e[f++]=x,e[f++]=u,e[f++]=g[0],e[f++]=g[1],e[f++]=g[2],e[f++]=g[3],e[f++]=b[0],e[f++]=A,e[f++]=z,e[f++]=B,e[f++]=k,e[f++]=0===L?1.2:1,e[f++]=p,e[f++]=q,e[f++]=r,e[f++]=v,e[f++]=x,e[f++]=u,e[f++]=g[0],e[f++]=g[1],e[f++]=g[2],e[f++]=g[3],e[f++]=b[0],0<L&&L<h-1&&(e[f++]=A,e[f++]=z,e[f++]=B,e[f++]=
k,e[f++]=-1.2,e[f++]=p,e[f++]=q,e[f++]=r,e[f++]=v,e[f++]=x,e[f++]=u,e[f++]=g[0],e[f++]=g[1],e[f++]=g[2],e[f++]=g[3],e[f++]=b[0],e[f++]=A,e[f++]=z,e[f++]=B,e[f++]=k,e[f++]=1.2,e[f++]=p,e[f++]=q,e[f++]=r,e[f++]=v,e[f++]=x,e[f++]=u,e[f++]=g[0],e[f++]=g[1],e[f++]=g[2],e[f++]=g[3],e[f++]=b[0]),p=A,q=z,r=B,A=v,z=x,B=u;if(this.canBeMerged){for(L=m;L<m+l;L++)e[L]=e[L+l];c=f-l;for(L=0;L<l;L++)e[f++]=e[c++]}};return a}(),x=l.newLayout().vec3f(d.VertexAttrConstants.POSITION).vec2f(d.VertexAttrConstants.UV0),
B=function(){function a(){this.vertexBufferLayout=x;this.numVertsAtCap=this.numVertsAtJoin=2;this.tmpCurrent=f.vec3d.create();this.tmpLast=f.vec3d.create()}a.prototype.allocate=function(a){return A.createBuffer(a)};a.prototype.elementCount=function(a){return(a.indices[d.VertexAttrConstants.POSITION].length/2+1-2)*this.numVertsAtJoin+2*this.numVertsAtCap};a.prototype.write=function(a,b,c,e,g){c=b.vertexAttr[d.VertexAttrConstants.POSITION].data;(b=b.indices&&b.indices[d.VertexAttrConstants.POSITION])&&
b.length!==2*(c.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");b=c.length/3;a=a.transformation;var h=0,k=this.tmpCurrent,l=this.tmpLast;f.vec3d.set3(c[0],c[1],c[2],k);for(var m=0;m<b;m++){var p=3*m;f.vec3d.set(k,l);f.vec3d.set3(c[p],c[p+1],c[p+2],k);a&&f.mat4d.multiplyVec3(a,k,k);h+=f.vec3d.dist2(l,k);e.position.setVec(g,k);e.uv0.set(g,0,h);e.uv0.set(g,1,-1);++g;e.position.setVec(g,k);e.uv0.set(g,0,h);e.uv0.set(g,1,1);++g}};return a}(),D=[255,255,255,255],C=[0,0,0,0],G=f.vec3d.create(),
E=f.vec3d.create(),F=f.vec3d.create(),I=f.vec3d.create(),K=f.vec3d.create(),N=f.vec3d.create(),H=f.vec3d.create(),M=f.vec3d.create(),T={success:!1,dist2:0,pa:f.vec3d.create(),pb:f.vec3d.create()},V=[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],U=[f.vec3d.create(),f.vec3d.create(),f.vec3d.create(),f.vec3d.create()],J=b.plane.create(),O=b.plane.create(),P=b.plane.create(),R=b.plane.create();return n})},"esri/views/3d/webgl-engine/shaders/RibbonLinePrograms":function(){define(["require",
"exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b=function(a){return f.glslifyDefineMap({WALL:a.wall,SCREENSCALE:a.screenScale,STIPPLE:a.stipple,SLICE:a.slice})};g.colorPass={name:"ribbon-line-color",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:b(c)+a.resolveIncludes("materials/ribbonLine/colorPass.frag")}},
attributes:c.Default3D};g.highlightPass={name:"ribbon-line-highlight",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/ribbonLine/ribbonLine.vert"),fragmentShader:b(c)+a.resolveIncludes("materials/ribbonLine/highlightPass.frag")}},attributes:c.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/webMercatorUtils ../../../../geometry/support/meshUtils/projection ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../lib/gl-matrix ../../support/debugFlags ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G){var E=D.VertexAttrConstants;n=function(b){function d(){var a=null!==b&&b.apply(this,arguments)||this;a._edgeStageObjects=new Set;a._materials={};a._textures={};return a}c(d,b);d.prototype._prepareResources=function(){u.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new G({color:[1,0,1,1]},"debugVertexNormal"),this._debugFaceNormalMaterial=new G({color:[0,1,1,1]},"debugFAceNormal"));this.resolve()};d.prototype.destroy=function(){b.prototype.destroy.call(this);
this.isFulfilled()||this.reject();for(var a in this._materials)this._context.stage.remove(v.ModelContentType.MATERIAL,this._materials[a].material.id);for(a in this._textures)this._context.stage.remove(v.ModelContentType.TEXTURE,this._textures[a].id);this._materials={};this._textures={}};d.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("mesh"!==b.geometry.type)return this._logWarning("unsupported geometry type for fill on mesh-3d symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;
var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};d.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a){b=this._getLayerOpacity();for(var d in this._materials){c=this._materials[d];c.material.setParameterValues({layerOpacity:b});var e=c.material.getParameterValues();this._setMaterialTransparentParameter(e,c.isComponentTransparent);c.material.setParameterValues({transparent:e.transparent})}if(0<this._edgeStageObjects.size){var f=
this._context.stage.view.getEdgeView(),g=this._getLayerOpacity();this._edgeStageObjects.forEach(function(a){f.updateAllComponentOpacities(a,[g])})}return!0}if("elevationInfo"===a){this._updateElevationContext();for(e in b)if(a=b[e],d=c(a))a=this.getGraphicElevationContext(a.graphic),d.needsElevationUpdates=k.needsElevationUpdates3D(a.mode),d.elevationContext.set(a);return!0}return!1};Object.defineProperty(d.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});d.prototype._requiresSymbolVertexColors=
function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};d.prototype._colorUid=function(a){a=a.material&&a.material.color;if(!a)return"-";if(a)switch(a.type){case "value":return a.value.toHex();case "image":return a.uid}};d.prototype._materialProperties=function(a,b,c){var d=this._requiresSymbolVertexColors(),e=b.material&&b.material.color;b=this._colorUid(b);a=!!a.vertexAttributes.color;return{hasSymbolVertexColors:d,hasVertexColors:a,color:e,uid:"vc:"+a+",vct"+c+",svc:"+
d+",cmuid:"+b}};d.prototype._setInternalColorValueParameters=function(b,c){c.diffuse=a.toUnitRGB(b.value);c.opacity=b.value.a};d.prototype._getLoadableTextureResource=function(a){return a.data?a.data instanceof HTMLImageElement?a.data.complete?a.data:a.data.src:a.data:a.url};d.prototype._setInternalColorImageParameters=function(a,b,c){var d=this._getLoadableTextureResource(a);if(d){var e=this._textures[a.uid];e||(e=new B(d,b+"_"+a.uid+"_tex",{mipmap:!0,wrapClamp:!1,noUnpackFlip:!0}),this._textures[a.uid]=
e,this._context.stage.add(v.ModelContentType.TEXTURE,e));c.textureId=e.id}};d.prototype._setInternalMaterialParameters=function(a,b,c){if(a=a.material&&a.material.color)switch(a.type){case "value":this._setInternalColorValueParameters(a,c);break;case "image":this._setInternalColorImageParameters(a,b,c)}};d.prototype._setExternalMaterialParameters=function(b){if(this._isPropertyDriven("color"))b.externalColor=I;else{var c=this.symbol.material?a.toUnitRGBA(this.symbol.material.color):I;b.externalColor=
c}if(c=this.symbol.material&&this.symbol.material.colorMixMode)b.colorMixMode=c};d.prototype._hasTransparentVertexColors=function(a){a=a.vertexAttributes.color;if(!a)return!1;for(var b=3;b<a.length;b+=4)if(255!==a[b])return!0;return!1};d.prototype._getOrCreateMaterial=function(a,b){var c=this._hasTransparentVertexColors(a)||!!b.get("material.color.transparent");a=this._materialProperties(a,b,c);var d=this._materials[a.uid];if(d)return d.material;var d=this._getStageIdHint(),e={specular:K,vertexColors:a.hasVertexColors,
symbolColors:a.hasSymbolVertexColors,ambient:K,diffuse:F,opacity:1,doubleSided:!0,doubleSidedType:"winding-order",cullFace:"none",layerOpacity:this._getLayerOpacity(),slicePlaneEnabled:this._context.slicePlaneEnabled,textureInitTransparent:!0};this._setInternalMaterialParameters(b,d,e);this._setExternalMaterialParameters(e);this._setMaterialTransparentParameter(e,c);b=new C(e,d+"_"+a.uid+"_mat");this._materials[a.uid]={material:b,isComponentTransparent:c};this._context.stage.add(v.ModelContentType.MATERIAL,
b);return b};d.prototype._setMaterialTransparentParameter=function(a,b){var c=this._isPropertyDriven("opacity");a.transparent=c||b||1>a.layerOpacity||1>a.opacity||a.externalColor&&1>a.externalColor[3]};d.prototype._addDebugNormals=function(a,b,c,d){var e,f,g,h,k=b.length,l=a.spatialReference.isWGS84?20015077/180:1,m=.1*Math.max(a.extent.width*l,a.extent.height*l,a.extent.zmax-a.extent.zmin),p=[],q=[];a=[];for(var l=[],t=0;t<k;t++)for(var n=b[t],u=n.data.getAttribute(E.POSITION),v=n.data.getAttribute(E.NORMAL),
x=n.data.getIndices(E.POSITION),n=n.data.getIndices(E.NORMAL),u=u.data,v=v.data,B=0;B<x.length;B++){for(var L=3*x[B],Q=3*n[B],D=0;3>D;D++)p.push(u[L+D]);for(D=0;3>D;D++)p.push(u[L+D]+v[Q+D]*m);q.push(q.length);q.push(q.length);if(0===B%3){this._calculateFaceNormal(u,x,B,V);this._getFaceVertices(u,x,B,H,M,T);r.vec3d.add(H,M);r.vec3d.add(H,T);r.vec3d.scale(H,1/3);for(D=0;3>D;D++)a.push(H[D]);for(D=0;3>D;D++)a.push(H[D]+V[D]*m);l.push(l.length);l.push(l.length)}}k=(e={},e[E.POSITION]={data:new Float64Array(p),
size:3},e);e=(f={},f[E.POSITION]=new Uint32Array(q),f);f=new z(k,e,void 0,"line");f=new A(f,"debugVertexNormal");f.singleUse=!0;b.push(f);c.push([this._debugVertexNormalMaterial]);d.push(r.mat4d.create(d[0]));k=(g={},g[E.POSITION]={data:new Float64Array(a),size:3},g);e=(h={},h[E.POSITION]=new Uint32Array(l),h);f=new z(k,e,void 0,"line");f=new A(f,"debugFaceNormal");f.singleUse=!0;b.push(f);c.push([this._debugFaceNormalMaterial]);d.push(r.mat4d.create(d[0]))};d.prototype._createAs3DShape=function(a,
b,c,d,e){var f=this;a=a.geometry;if("mesh"!==a.type)return null;var g=this._createGeometryInfo(a,b,d);if(!g)return null;b=g.geometries;var l=g.materials,p=g.transformations,g=g.objectTransformation;u.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(a,b,l,p);var r=new x({geometries:b,materials:l,transformations:p,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:e},idHint:d});r.setObjectTransformation(g);var t=function(a){var b=f._context.stage.view.getEdgeView();if(b){b.removeObject(a);
f._edgeStageObjects.delete(a);var c={opacity:f._getLayerOpacity(),slicePlaneEnabled:f._context.slicePlaneEnabled};if(c=q.createMaterial(b,f.symbol,c))f._edgeStageObjects.add(a),b.addObject(a,[c],{mergeGeometries:!0})}};t(r);d=function(a,b,c,d,e){a=h.perObjectElevationAligner(a,b,c,d,e);t(r);return a};e=new m(this,r,b,null,null,d,c);e.needsElevationUpdates=k.needsElevationUpdates3D(c.mode);c=a.extent.center.clone();c.z=0;e.elevationContext.centerPointInElevationSR=c;e.alignedTerrainElevation=d(e,e.elevationContext,
this._context.elevationProvider,this._context.renderCoordsHelper,this._context.featureExpressionInfoContext);return e};d.prototype._createComponentNormals=function(a,b,c,d){switch(c.shading||"flat"){case "source":return this._createComponentNormalsSource(a,b,c,d);case "flat":return this._createComponentNormalsFlat(a,c,d);case "smooth":return this._createComponentNormalsSmooth(a,c,d)}};d.prototype._createComponentNormalsSource=function(a,b,c,d){if(!b)return this._createComponentNormalsFlat(a,c,d);
c=!1;for(var e=0;e<d.length;e+=3){this._calculateFaceNormal(a,d,e,V);for(var f=0;3>f;f++){var g=3*d[e+f];H[0]=b[g+0];H[1]=b[g+1];H[2]=b[g+2];0>r.vec3d.dot(V,H)&&(b[g+0]=-b[g+0],b[g+1]=-b[g+1],b[g+2]=-b[g+2],c=!0)}}return{normals:b,indices:d,didFlipNormals:c}};d.prototype._createComponentNormalsFlat=function(a,b,c){b=new Float32Array(c.length);for(var d=new Uint32Array(3*c.length),e=0;e<c.length;e+=3)for(var f=this._calculateFaceNormal(a,c,e,V),g=0;3>g;g++)b[e+g]=f[g],d[e+g]=e/3;return{normals:b,indices:d,
didFlipNormals:!1}};d.prototype._createComponentNormalsSmooth=function(a,b,c){b={};for(var d=0;d<c.length;d+=3)for(var e=this._calculateFaceNormal(a,c,d,V),f=0;3>f;f++){var g=c[d+f],h=b[g];h||(h={normal:r.vec3d.create(),count:0},b[g]=h);r.vec3d.add(h.normal,e);h.count++}a=new Float32Array(3*c.length);e=new Uint32Array(3*c.length);for(d=0;d<c.length;d++){g=c[d];h=b[g];1!==h.count&&(r.vec3d.normalize(r.vec3d.scale(h.normal,1/h.count)),h.count=1);for(f=0;3>f;f++)a[3*d+f]=h.normal[f];e[d]=d}return{normals:a,
indices:e,didFlipNormals:!1}};d.prototype._getFaceVertices=function(a,b,c,d,e,f){var g=3*b[c+0],h=3*b[c+1];b=3*b[c+2];d[0]=a[g+0];d[1]=a[g+1];d[2]=a[g+2];e[0]=a[h+0];e[1]=a[h+1];e[2]=a[h+2];f[0]=a[b+0];f[1]=a[b+1];f[2]=a[b+2]};d.prototype._calculateFaceNormal=function(a,b,c,d){this._getFaceVertices(a,b,c,H,M,T);r.vec3d.subtract(M,H);r.vec3d.subtract(T,H);r.vec3d.cross(M,T,H);r.vec3d.normalize(H,d);return d};d.prototype._getOrCreateComponents=function(a){return a.components?a.components:P};d.prototype._createPositionBuffer=
function(a){var b=a.vertexAttributes.position,c=new Float64Array(b.length);k.reproject(a.vertexAttributes.position,0,a.spatialReference,c,0,this._context.renderSpatialReference,b.length/3);return c};d.prototype._createNormalBuffer=function(a,b){var c=a.vertexAttributes.normal;if(!c)return null;if("local"===this._context.layerView.view.viewingMode)return c;var d=a.vertexAttributes.position,f=new Float32Array(c.length);return e.projectNormalToECEF(c,d,b,a.spatialReference,f)};d.prototype._createColorBuffer=
function(a){return a.vertexAttributes.color};d.prototype._createSymbolColorBuffer=function(a){if(this._requiresSymbolVertexColors()){a=this._getVertexOpacityAndColor(a);var b=this.symbol.material&&this.symbol.material.colorMixMode||null,c=new Uint8Array(4);p.encodeSymbolColor(a,b,c);return c}return null};d.prototype._createColorIndices=function(a,b){a=new Uint32Array(b.length);for(b=0;b<a.length;b++)a[b]=0;return a};d.prototype._createBuffers=function(a,b){var c=a.vertexAttributes&&a.vertexAttributes.position;
if(!c)return this._logWarning("Mesh geometry must contain position vertex attributes"),null;var d=a.vertexAttributes.normal,e=a.vertexAttributes.uv;if(d&&d.length!==c.length)return this._logWarning("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(e&&e.length/2!==c.length/3)return this._logWarning("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;c=this._createPositionBuffer(a);d=this._createColorBuffer(a);
b=this._createSymbolColorBuffer(b);var f=this._createNormalBuffer(a,c);a=this._transformCenterLocal(a,c,f);return{positionBuffer:c,normalBuffer:f,uvBuffer:e,colorBuffer:d,symbolColorBuffer:b,objectTransformation:a}};d.prototype._transformCenterLocal=function(a,b,c){var d=a.extent.center,e=this._context.renderSpatialReference;N[0]=d.x;N[1]=d.y;N[2]=0;d=r.mat4d.create();t.computeLinearTransformation(a.spatialReference,N,d,e);r.mat4d.inverse(d,U);for(a=0;a<b.length;a+=3)H[0]=b[a+0],H[1]=b[a+1],H[2]=
b[a+2],r.mat4d.multiplyVec3(U,H),b[a+0]=H[0],b[a+1]=H[1],b[a+2]=H[2];if(c)for(r.mat4d.toMat3(d,J),r.mat3d.transpose(J,J),a=0;a<c.length;a+=3)H[0]=c[a+0],H[1]=c[a+1],H[2]=c[a+2],r.mat3d.multiplyVec3(J,H),c[a+0]=H[0],c[a+1]=H[1],c[a+2]=H[2];return d};d.prototype._validateFaces=function(a,b){a=a.vertexAttributes.position.length/3;if(b=b.faces){for(var c=-1,d=0;d<b.length;d++){var e=b[d];e>c&&(c=e)}if(a<=c)return this._logWarning("Vertex index "+c+" is out of bounds of the mesh position buffer"),!1}else if(0!==
a%3)return this._logWarning("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),!1;return!0};d.prototype._getOrCreateFaces=function(a,b){if(b.faces)return b.faces;a=new Uint32Array(a.vertexAttributes.position.length/3);for(b=0;b<a.length;b++)a[b]=b;return a};d.prototype._isOutsideClippingArea=function(a){if(!this._context.clippingExtent)return!1;var b=a.vertexAttributes&&a.vertexAttributes.position;if(!b)return!1;
var c=this._context.elevationProvider.spatialReference,d=b.length/3;a.spatialReference.equals(c)||(b=new Float64Array(b.length),k.reproject(a.vertexAttributes.position,0,a.spatialReference,b,0,c,d));k.computeBoundingBox(b,0,d,O);return k.boundingBoxClipped(O,this._context.clippingExtent)};d.prototype._createGeometryInfo=function(a,b,c){var d,e;if(!l.canProject(a,this._context.layerView.view.spatialReference))return this._logWarning("Geometry spatial reference is not compatible with the view"),null;
if(this._isOutsideClippingArea(a))return null;var f=this._createBuffers(a,b);if(!f)return null;b=f.positionBuffer;for(var g=f.uvBuffer,h=f.colorBuffer,k=f.symbolColorBuffer,m=f.normalBuffer,f=f.objectTransformation,p=[],q=[],t=[],n=!1,u=0,v=this._getOrCreateComponents(a);u<v.length;u++){var x=v[u];if(!this._validateFaces(a,x))return null;var w=this._getOrCreateFaces(a,x);if(0!==w.length){var B=this._createComponentNormals(b,m,x,w);B.didFlipNormals&&(n=!0);var Q=(d={},d[E.POSITION]={size:3,data:b},
d[E.NORMAL]={size:3,data:B.normals},d),B=(e={},e[E.POSITION]=w,e[E.NORMAL]=B.indices,e);h&&(Q[E.COLOR]={size:4,data:h},B[E.COLOR]=w);k&&(Q[E.SYMBOLCOLOR]={size:4,data:k},B[E.SYMBOLCOLOR]=this._createColorIndices(x,w));a.vertexAttributes.uv&&(Q[E.UV0]={size:2,data:g},B[E.UV0]=w);w=new z(Q,B);w=new A(w,c+"_mesh");w.singleUse=!0;p.push(w);q.push(r.mat4d.identity());t.push([this._getOrCreateMaterial(a,x)])}}n&&this._logWarning("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");
return{geometries:p,transformations:q,materials:t,objectTransformation:f}};return d}(d);var F=[1,1,1],I=[1,1,1,1],K=[0,0,0],N=r.vec3d.create(),H=r.vec3d.create(),M=r.vec3d.create(),T=r.vec3d.create(),V=r.vec3d.create(),U=r.mat4d.create(),J=r.mat3d.create(),O=f.create(),P=[new b];return n})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.encodeSymbolColor=function(b,e,g,m){void 0===m&&(m=0);null==
b||"ignore"===e?(g[m+0]=255,g[m+1]=255,g[m+2]=255,g[m+3]=255):(g[m+0]=Math.floor(255*b[0]),g[m+1]=Math.floor(255*b[1]),g[m+2]=Math.floor(255*b[2]),b=Math.floor(b[3]*c),g[m+3]=0===b?0:"tint"===e?b:"replace"===e?b+a:b+f)};g.isOpaqueSymbolColor=function(c,e){void 0===e&&(e=0);c=c[e+3];return c===a||c===f||c===b};var c=85,a=c,f=2*c,b=3*c})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/asyncUtils ../../../../core/lang ../../../../core/screenUtils ../../../../geometry/support/aaBoundingBox ../../../../symbols/ObjectSymbol3DLayer ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./objectResourceUtils ./primitiveObjectSymbolUtils ../support/FastSymbolUpdates ../../lib/gl-matrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D){var C=[z.ModelContentType.MATERIAL,z.ModelContentType.TEXTURE,z.ModelContentType.GEOMETRY],G=[1,1,1],E=[1,1,1,1],F=[0,0,0];return function(g){function p(){return null!==g&&g.apply(this,arguments)||this}c(p,g);p.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();if(!this._isPropertyDriven("size")){var c=r.validateSymbolLayerSize(this.symbol);if(c){this._logWarning(c);this.reject();return}}a.resource&&a.resource.href?
this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};p.prototype._preparePrimitiveResources=function(a,b){if(t.isValidPrimitive(a)){var c=this.symbol;this._geometry=new x(t.primitiveGeometryData(a),b);this._context.stage.add(z.ModelContentType.GEOMETRY,this._geometry);this._resourceBoundingBox=t.primitiveBoundingBox(a);this._resourceSize=h.size(this._resourceBoundingBox);this._symbolSize=r.computeSizeWithResourceSize(this._resourceSize,
c);a=this._getMaterialOpacity();a={specular:[0,0,0],opacity:a,transparent:1>a||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:G,diffuse:G};var d=this.symbolContainer;if("point-3d"===d.type&&d.verticalOffset){var d=d.verticalOffset,g=d.minWorldLength,k=d.maxWorldLength;a.verticalOffset={screenLength:e.pt2px(d.screenLength),minWorldLength:g||0,maxWorldLength:null!=k?k:Infinity};a.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(a.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);
this._isPropertyDriven("color")?a.externalColor=E:(c=c.material?f.toUnitRGBA(c.material.color):E,a.externalColor=c);this._fastUpdates=v.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(l.mixin(a,this._fastUpdates.materialParameters),a.instanced.push("featureAttribute")):this._hasPerInstanceColor()&&a.instanced.push("color");a.slicePlaneEnabled=this._context.slicePlaneEnabled;this._material=new D(a,b+"_objectmat");this._context.stage.add(z.ModelContentType.MATERIAL,
this._material);this.resolve()}else this._logWarning("Unknown object symbol primitive: "+a),this.reject()};p.prototype._prepareModelResources=function(c,d){var f=this,g=["transformation"];d={materialParamsMixin:{instanced:g},idHint:d,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=v.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled?(l.mixin(d.materialParamsMixin,this._fastUpdates.materialParameters),g.push("featureAttribute")):
this._hasPerInstanceColor()&&g.push("color");g=this.symbolContainer;if("point-3d"===g.type&&g.verticalOffset){var g=g.verticalOffset,k=g.minWorldLength,m=g.maxWorldLength;d.materialParamsMixin.verticalOffset={screenLength:e.pt2px(g.screenLength),minWorldLength:k||0,maxWorldLength:null!=m?m:Infinity};d.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=b.safeCast(u.fetch(c,d));this._symbolLoaderPromise.then(function(a){f._symbolLoaderPromise=null;if(!f.isRejected()){var b=f._context,c=a.stageResources,
d=b.stage,e=f._getExternalColorParameters(f.symbol.material),g=f._getMaterialOpacity(),k=f._isPropertyDriven("opacity"),l=c[z.ModelContentType.MATERIAL];a.originalMaterialOpacities=Array(l.length);l.forEach(function(c,d){var f=c.getParameterValues();c.setParameterValues(e);a.originalMaterialOpacities[d]=f.opacity;d=f.opacity*g;c.setParameterValues({opacity:d,transparent:1>d||k||f.transparent});b.screenSizePerspectiveEnabled&&c.setParameterValues({screenSizePerspective:b.sharedResources.screenSizePerspectiveSettings})});
C.forEach(function(a){for(var b=c[a],e=0;b&&e<b.length;e++)d.add(a,b[e])});f._resourceBoundingBox=u.computeBoundingBox(a);f._resourceSize=h.size(f._resourceBoundingBox);f._pivotOffset=a.pivotOffset;f._symbolSize=r.computeSizeWithResourceSize(f._resourceSize,f.symbol);f._i3sModel=a;v.updateFastSymbolUpdatesState(f._fastUpdates,f._context.renderer,f._fastVisualVariableConvertOptions())&&l.forEach(function(a){return a.setParameterValues(f._fastUpdates.materialParameters)});f.resolve()}},function(b){f._symbolLoaderPromise=
null;if(!f.isFulfilled()){if(!(b instanceof a)){var c="ObjectSymbol3DLayer failed to load";b&&b.message&&(c+=" ("+b.message+")");f._logWarning(c)}f.reject()}})};p.prototype._forEachMaterial=function(a){this._i3sModel?this._i3sModel.stageResources[z.ModelContentType.MATERIAL].forEach(a):a(this._material)};p.prototype._getExternalColorParameters=function(a){var b={};this._isPropertyDriven("color")?b.externalColor=E:a&&a.color?b.externalColor=f.toUnitRGBA(a.color):(b.externalColor=E,b.colorMixMode="ignore");
return b};p.prototype.destroy=function(){g.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;if(this._i3sModel){var b=this._i3sModel.stageResources;C.forEach(function(c){for(var d=b[c],e=0;d&&e<d.length;e++)a.remove(c,d[e].id)})}else this._material&&a.remove(z.ModelContentType.MATERIAL,this._material.id),this._geometry&&a.remove(z.ModelContentType.GEOMETRY,this._geometry.id)};p.prototype.createGraphics3DGraphic=
function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=q.placePointOnGeometry(b.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,c,a.renderingInfo,e,d,b.uid)};p.prototype.layerPropertyChanged=function(a,b,c){var d=this;if("opacity"===a){var e=this._isPropertyDriven("opacity");if(this._i3sModel){var f=this._getMaterialOpacity();
this._i3sModel.stageResources[z.ModelContentType.MATERIAL].forEach(function(a,b){b=d._i3sModel.originalMaterialOpacities[b]*f;a.setParameterValues({opacity:b,transparent:1>b||e})})}else b=this._getMaterialOpacity(),this._material.setParameterValues({opacity:b,transparent:1>b||e});return!0}if("elevationInfo"===a){this._updateElevationContext();for(var g in b){var h=b[g];if(a=c(h))h=this.getGraphicElevationContext(h.graphic),a.needsElevationUpdates=q.needsElevationUpdates3D(h.mode),a.elevationContext.set(h)}return!0}return!1};
p.prototype.applyRendererDiff=function(a,b,c,d){var e=this,f;for(f in a.diff)switch(f){case "visualVariables":if(v.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._forEachMaterial(function(a){return a.setParameterValues(e._fastUpdates.materialParameters)});else return!1;break;default:return!1}return!0};Object.defineProperty(p.prototype,"numberOfVertices",{get:function(){return this._i3sModel?this._i3sModel.numberOfVertices:this._geometry.data.getIndices(B.VertexAttrConstants.POSITION).length},
enumerable:!0,configurable:!0});p.prototype._createAs3DShape=function(a,b,c,e,f,g){var h=this,l=null,m=null,p=this.getFastUpdateAttrValues(a);p&&(l={featureAttribute:p},m=function(a){return v.evaluateModelTransform(h._fastUpdates.materialParameters,p,a)});!this._fastUpdates.enabled&&this._hasPerInstanceColor()&&(l=l||{},l.color=r.mixinColorAndOpacity(c.color,c.opacity));a=this._context.layer.uid;var t=A.mat4d.identity();this._applyObjectRotation(c,t);this._applyObjectRotation(this.symbol,t);this._applyObjectScale(c,
t);this._applyAnchor(t);if(this._i3sModel){c=this._i3sModel.stageResources[z.ModelContentType.GEOMETRY];for(var u=this._i3sModel.materialsByComponent,n=Array(c.length),x=0;x<n.length;x++)n[x]=t;f=q.createStageObjectForPoint.call(this,b,c,u,n,l,e,f,a,g,null,m)}else f=q.createStageObjectForPoint.call(this,b,[this._geometry],[[this._material]],[t],l,e,f,a,g,null,m);if(null===f)return null;if(this._fastUpdates.enabled){var B=v.getMaterialParams(this._fastUpdates.visualVariables,this._fastVisualVariableConvertOptions());
this._forEachMaterial(function(a){return a.setParameterValues(B)})}f.object.setCastShadow(!0);g=new d(this,f.object,null,null,null,k.perObjectElevationAligner,e,d.VisibilityModes.REMOVE_OBJECT);g.alignedTerrainElevation=f.terrainElevation;g.needsElevationUpdates=q.needsElevationUpdates3D(e.mode);q.extendPointGraphicElevationContext(g,b,this._context.elevationProvider);return g};p.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||(a=this._isPropertyDriven("size")&&
a.size?a.size:this._symbolSize,a=r.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||A.mat4d.scale(b,a))};p.prototype._applyObjectRotation=function(a,b){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&a instanceof m))return r.computeObjectRotation(a.heading,a.tilt,a.roll,b)};p.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return A.vec3d.scale(h.center(this._resourceBoundingBox),
-1);case "top":var a=h.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=h.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];default:return this._pivotOffset?A.vec3d.scale(this._pivotOffset,-1,Array(3)):F}};p.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&A.mat4d.translate(a,b)}};p.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||
this._isPropertyDriven("opacity")};p.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?h.size(this._resourceBoundingBox):G,b=this._resourceBoundingBox?this._computeAnchor():F,c=this._context.renderCoordsHelper.unitInMeters,d=r.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,c);return{modelSize:a,symbolSize:this._symbolSize||G,unitInMeters:c,transformation:{anchor:b,scale:d,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||
0]}}};return p}(p)})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper dojo/errors/CancelError ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/has ../../../../core/lang ../../../../core/Logger ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ../../../../geometry/support/aaBoundingBox ../../glTF/DefaultLoadingContext ../../glTF/loader ../../lib/gl-matrix ../../support/imageUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G){function E(a,b){b.lods&&b.lods.length===a.length&&a.forEach(function(a,c){a.lodMetrics=b.lods[c].metrics});return a}function F(a,c){c=c||{};var d=c.streamDataSupplier;if(d){var e=d.request(a,"json");return q.create(function(a,c){e.then(function(b,c){a(c)},function(a){c(a instanceof b?a:I(a))})},function(){d.cancelRequest(e)})}var f=l(a);return q.create(function(a,c){f.then(function(b){a(b.data)},function(a){c(a instanceof b?a:I(a))})},function(){f.cancel()})}
function I(a){return new h("","Request for object resource failed: "+a)}function K(b,c){return f(this,void 0,void 0,function(){var d,e,f,g,h,l,p,q,t,n,u,v,x,A,z,C,F,E,I,V,K,T,ka,w,Aa,ya,na,qa,sa,ta,Ja,xa,wa,Ca;return a(this,function(a){switch(a.label){case 0:return f=[],g=[],h=[],l=[],p=[],q=r.Version.parse(b.version||"1.0","wosr"),M.validate(q),t="meshsymbol_"+b.model.name,n=b.textureDefinitions,[4,N(t,n,c)];case 1:u=a.sent();for(v in u)p.push(u[v].engineTexObj);x=b.model.geometries;A=b.materialDefinitions;
for(C=z=0;C<x.length;C++){var Q=F=x[C],L=Q.params,P=L.topology;a=!0;L.vertexAttributes||(H.warn("Geometry must specify vertex attributes"),a=!1);switch(L.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:P=L.faces;if(!P)H.warn("Indexed geometries must specify faces"),a=!1;else if(L.vertexAttributes){var R=void 0;for(R in L.vertexAttributes)(L=P[R])&&L.values?(null!=L.valueType&&"UInt32"!==L.valueType&&(H.warn("Unsupported indexed geometry indices type '"+L.valueType+"', only UInt32 is currently supported"),
a=!1),null!=L.valuesPerElement&&1!==L.valuesPerElement&&(H.warn("Unsupported indexed geometry values per element '"+L.valuesPerElement+"', only 1 is currently supported"),a=!1)):(H.warn("Indexed geometry does not specify face indices for '"+R+"' attribute"),a=!1)}break;default:H.warn("Unsupported topology '"+P+"'"),a=!1}Q.params.material||(H.warn("Geometry requires material"),a=!1);Q=Q.params.vertexAttributes;L=void 0;for(L in Q)Q[L].values||(H.warn("Geometries with externally defined attributes are not yet supported"),
a=!1);if(a){a=F.params;d=a.material;e=a.texture;E=F.params.vertexAttributes;I={};for(V in E)K=E[V],T=K.values,I[V]={data:T,size:K.valuesPerElement};h.push([]);ka={};if("PerAttributeArray"===F.params.topology){a=w=I.position.data.length/I.position.size;Q=new Uint32Array(a);for(L=0;L<a;L++)Q[L]=L;Aa=Q;for(ya in I)ka[ya]=Aa}else for(qa in na=F.params.faces,na)ka[qa]=new Uint32Array(na[qa].values);sa=e?u[e]:null;ta=l[d]?l[d][e]:null;ta||(Ja=d.substring(d.lastIndexOf("/")+1),xa=A[Ja].params,1===xa.transparency&&
(xa.transparency=0),wa={ambient:xa.diffuse,diffuse:xa.diffuse,specular:[0,0,0],opacity:1-(xa.transparency||0),transparent:0<xa.transparency,textureId:sa?sa.engineTexObj.id:void 0,textureInitTransparent:!0,doubleSided:!0,cullFace:"none",flipV:!1,colorMixMode:xa.externalColorMixMode||"tint"},m("enable-feature:jkieboom/alpha-channel-usage")&&sa&&("transparency"===sa.alphaChannelUsage||"maskAndTransparency"===sa.alphaChannelUsage)&&(wa.transparent=!0),c&&c.materialParamsMixin&&k.mixin(wa,c.materialParamsMixin),
ta=new G(wa,t),l[d]||(l[d]={}),l[d][e]=ta,g.push(ta));h[C].push(ta);Ca=new B(new D(I,ka),t);z+=ka.position?ka.position.length:0;f.push(Ca)}}return[2,{stageResources:{textures:p,materials:g,geometries:f},materialsByComponent:h,pivotOffset:b.model.pivotOffset,numberOfVertices:z}]}})})}function N(b,c,d){return f(this,void 0,void 0,function(){var e,f,g,h,k,l,p,r;return a(this,function(a){switch(a.label){case 0:e=[];f=function(a){var f=c[a],g=f.images[0].data;if(!g)return H.warn("Externally referenced texture data is not yet supported"),
"continue";var g=f.encoding+";base64,"+g,h="/textureDefinitions/"+a,k={noUnpackFlip:!0,wrapClamp:!1};m("enable-feature:jkieboom/alpha-channel-usage")&&(k.wrapClamp=!0);a=d&&d.disablePreloadTextures?q.resolve(g):z.requestImage(g);e.push(a.then(function(a){return{refId:h,engineTexObj:new C(a,b,k),alphaChannelUsage:"rgba"===f.channels?f.alphaChannelUsage||"transparency":"none"}}))};for(g in c)f(g);return[4,q.all(e)];case 1:h=a.sent();k={};l=0;for(p=h;l<p.length;l++)r=p[l],k[r.refId]=r;return[2,k]}})})}
Object.defineProperty(g,"__esModule",{value:!0});var H=d.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),M=new r.Version(1,2,"wosr");g.fetch=function(b,c){void 0===c&&(c={});return f(this,void 0,void 0,function(){var d,e;return a(this,function(a){switch(a.label){case 0:if(!k.endsWith(b,".gltf")&&!k.endsWith(b,".glb"))return[3,2];d=new t.DefaultLoadingContext(c.streamDataSupplier);return[4,v.load(d,b)];case 1:return[2,a.sent()];case 2:return[4,F(b,c)];case 3:return e=a.sent(),[4,K(e,
c)];case 4:return[2,a.sent()]}})})};g.fetchLod=function(b,c){return f(this,void 0,void 0,function(){var d,g,h,k,l,m=this;return a(this,function(r){switch(r.label){case 0:return d=p.removeFile(b),[4,F(b,c)];case 1:return g=r.sent(),g.lods?[4,q.all(g.lods.map(function(a){return a.href?F(p.makeAbsolute(a.href,d)):g}))]:[3,4];case 2:return h=r.sent(),k=E,[4,e.map(h,function(b){return f(m,void 0,void 0,function(){return a(this,function(a){switch(a.label){case 0:return[4,K(b,c)];case 1:return[2,a.sent()]}})})})];
case 3:return[2,k.apply(void 0,[r.sent(),g])];case 4:return l=E,[4,K(g,c)];case 5:return[2,l.apply(void 0,[[r.sent()],g])]}})})};g.computeBoundingBox=function(a){a=a.stageResources[x.ModelContentType.GEOMETRY];for(var b=u.empty(),c=[0,0,0],d=[0,0,0],e=0;e<a.length;e++){var f=a[e].boundingInfo;A.vec3d.set(f.getBBMin(),c);A.vec3d.set(f.getBBMax(),d);for(f=0;3>f;++f)b[f]=Math.min(b[f],c[f]),b[f+3]=Math.max(b[f+3],d[f])}return b};g.createStageResources=K;g.createTextureResources=N})},"esri/core/Version":function(){define(["require",
"exports","./Error"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a,b,c){void 0===c&&(c="");this.major=a;this.minor=b;this._context=c}a.prototype.lessThan=function(a,b){return this.major<a||a===this.major&&this.minor<b};a.prototype.since=function(a,b){return!this.lessThan(a,b)};a.prototype.validate=function(a){if(this.major!==a.major)throw new c((this._context&&this._context+":")+"unsupported-version","Required major "+(this._context&&this._context+" ")+
"version is '"+this.major+"', but got '${version.major}.${version.minor}'",{version:a});};a.prototype.clone=function(){return new a(this.major,this.minor,this._context)};a.parse=function(f,b){void 0===b&&(b="");var g=f.split("."),e=g[0],g=g[1],h=/^\s*\d+\s*$/;if(!e||!e.match||!e.match(h))throw new c((b&&b+":")+"invalid-version","Expected major version to be a number, but got '${version}'",{version:f});if(!g||!g.match||!g.match(h))throw new c((b&&b+":")+"invalid-version","Expected minor version to be a number, but got '${version}'",
{version:f});f=parseInt(e,10);e=parseInt(g,10);return new a(f,e,b)};return a}();g.Version=n})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper dojo/errors/CancelError ../../../request ../../../core/Error ../../../core/promiseUtils ../../../core/urlUtils".split(" "),function(n,g,c,a,f,b,l,e,h,m){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function d(a){this.streamDataSupplier=
a}d.prototype.loadJson=function(b){return c(this,void 0,void 0,function(){return a(this,function(a){return[2,this.load("json",b)]})})};d.prototype.loadBinary=function(b){return c(this,void 0,void 0,function(){return a(this,function(a){return m.isDataProtocol(b)?[2,m.dataToArrayBuffer(b)]:[2,this.load("binary",b)]})})};d.prototype.loadImage=function(b){return c(this,void 0,void 0,function(){return a(this,function(a){return[2,this.load("image",b)]})})};d.prototype.load=function(d,f){return c(this,void 0,
void 0,function(){var c,g,m=this;return a(this,function(a){switch(a.label){case 0:if(!this.streamDataSupplier)return[3,1];c=this.streamDataSupplier.request(f,d);return[2,h.create(function(a,d){c.then(function(b,c){a(c)},function(a){d(a instanceof b?a:new e("","Request for resource failed: "+a))})},function(){m.streamDataSupplier.cancelRequest(c)})];case 1:return[4,l(f,k[d])];case 2:return g=a.sent(),[2,g.data]}})})};return d}();g.DefaultLoadingContext=n;var k={image:{responseType:"image"},binary:{responseType:"array-buffer"},
json:void 0}})},"esri/views/3d/glTF/loader":function(){define("require exports ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper ../../../core/tsSupport/assignHelper ../../../core/arrayUtils ./DefaultErrorContext ./internal/Resource ../support/buffer/BufferView ../support/buffer/bufferViewUtil ../support/buffer/glUtil ../support/buffer/math ../webgl-engine/lib/Geometry ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Texture ../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){function t(b,d){return c(this,void 0,void 0,function(){var c,e,f,g,h,k,l,m;return a(this,function(a){switch(a.label){case 0:c=b.json,e=0,a.label=1;case 1:if(!(e<c.nodes.length))return[3,6];f=c.nodes[e];g=b.getNodeTransform(e);A.warnUnsupportedIf(null!=f.weights,"Morph targets are not supported.");if(null==f.mesh)return[3,5];h=c.meshes[f.mesh];k=0;l=h.primitives;a.label=2;case 2:if(!(k<l.length))return[3,5];m=l[k];return[4,d(m,g)];case 3:a.sent(),a.label=4;
case 4:return k++,[3,2];case 5:return e++,[3,1];case 6:return[2]}})})}function v(a,b){if(a.materials.has(b))return a.materials.get(b);var c;if(null!=b.colorTexture&&(c=a.textures.get(b.colorTexture),!c)){var d=b.colorTexture;c=new r(d.data,d.name,{wrapClamp:33071===d.wrapS||33071===d.wrapT,mipmap:z.some(function(a){return a===d.minFilter}),preMultiplyAlpha:!0,noUnpackFlip:!0});a.textures.set(b.colorTexture,c)}c=new u({transparent:"OPAQUE"!==b.alphaMode,diffuse:[b.color[0],b.color[1],b.color[2]],ambient:[b.color[0],
b.color[1],b.color[2]],opacity:b.color[3],doubleSided:b.doubleSided,doubleSidedType:"winding-order",vertexColors:b.vertexColors,castShadows:!0,receiveSSAO:!0,textureId:c?c.id:void 0},b.name||"");a.materials.set(b,c);return c}Object.defineProperty(g,"__esModule",{value:!0});g.load=function(f,g){return c(this,void 0,void 0,function(){var l,r,n,z,B=this;return a(this,function(D){switch(D.label){case 0:return[4,e.Resource.load(f,A,g)];case 1:return l=D.sent(),r={textures:new Map,materials:new Map,geometries:[],
materialsByComponent:[],numberOfVertices:0},n=0,[4,t(l,function(b,e){return c(B,void 0,void 0,function(){var c,f,g,t,z,B,D,C,Q,L,F,N,E,H;return a(this,function(a){switch(a.label){case 0:return c="gltf_"+n++,f=b.mode||4,4!==f?(A.warnUnsupported("Unsupported primitive mode ("+x[f]+"). Skipping primitive."),[2]):b.attributes.NORMAL?[4,l.getMaterial(b)]:(A.warnUnsupported("Vertex normals are required. Skipping primitive."),[2]);case 1:return g=a.sent(),t=v(r,g),z=u.getVertexBufferLayout(t.getParams()),
[4,l.getIndexData(b)];case 2:return B=a.sent(),[4,l.getPositionData(b)];case 3:return D=a.sent(),C=z.createBuffer(D.count),d.vec3.transformMat4(C.position,D,e),(Q=C.getField("normal",h.BufferViewVec3f))?[4,l.getNormalData(b)]:[3,5];case 4:L=a.sent(),d.vec3.transformMat4(Q,L,e),a.label=5;case 5:return(F=C.getField("uv0",h.BufferViewVec2f))?[4,l.getTextureCoordinates(b)]:[3,7];case 6:N=a.sent(),m.unrolledCopyVec2(F,N),a.label=7;case 7:return(E=C.getField("color",h.BufferViewVec4u8))?[4,l.getVertexColors(b)]:
[3,9];case 8:H=a.sent(),H instanceof h.BufferViewVec4f?d.vec4.scale(E,H,255):m.unrolledCopyVec4(E,H),a.label=9;case 9:return r.numberOfVertices+=C.count,r.materialsByComponent.push([t]),r.geometries.push(new q(new p(new Float32Array(C.buffer),k.glLayout(z),void 0,void 0,B,!1),c)),[2]}})})})];case 2:return D.sent(),z={stageResources:{textures:b.fromMapValues(r.textures),materials:b.fromMapValues(r.materials),geometries:r.geometries},materialsByComponent:r.materialsByComponent,numberOfVertices:r.numberOfVertices,
pivotOffset:void 0},[2,z]}})})};var A=new l.DefaultErrorContext,z=[9987,9985],x="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ")})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["require","exports","../../../core/Logger"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});var a=c.getLogger("esri.views.3d.glTF");n=function(){function c(){}c.prototype.error=function(a){throw Error("[glTF loader]"+a);};c.prototype.errorUnsupported=function(a){this.error("[Unsupported Feature] "+
a)};c.prototype.errorUnsupportedIf=function(a,c){a&&this.error("[Unsupported Feature] "+c)};c.prototype.assert=function(a,c){a||this.error(c)};c.prototype.warn=function(b){a.warn(b)};c.prototype.warnUnsupported=function(a){this.warn("[Unsupported Feature] "+a)};c.prototype.warnUnsupportedIf=function(a,c){a&&this.warnUnsupported(c)};return c}();g.DefaultErrorContext=n})},"esri/views/3d/glTF/internal/Resource":function(){define("require exports ../../../../core/tsSupport/awaiterHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/assignHelper ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../core/Version ./BinaryStreamReader ./fillDefaults ./pathUtils ../../lib/gl-matrix ../../support/buffer/BufferView ../../support/buffer/bufferViewUtil".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){function u(b){return c(this,void 0,void 0,function(){return a(this,function(a){return[2,l.create(function(a,c){var d=new Blob([b]),e=new FileReader;e.onload=function(){a(JSON.parse(e.result))};e.onerror=function(a){c(a)};e.readAsText(d)})]})})}function t(b,d){return c(this,void 0,void 0,function(){return a(this,function(a){return[2,l.create(function(a,c){var e=new Blob([b],{type:d}),f=URL.createObjectURL(e),g=new Image;g.addEventListener("load",function(){URL.revokeObjectURL(f);
a(g)});g.addEventListener("error",function(a){URL.revokeObjectURL(f);c(a)});g.src=f})]})})}Object.defineProperty(g,"__esModule",{value:!0});var v;n=function(){function f(a,b,c,e,f){this.context=a;this.errorContext=b;this.uri=c;this.json=e;this.glbBuffer=f;this.bufferCache=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=d.splitURI(this.uri).dirPart;this.checkVersionSupported();this.checkRequiredExtensionsSupported();
b.errorUnsupportedIf(null==e.scene,"A scene must be defined.");b.errorUnsupportedIf(null==e.scenes,"Scenes must be defined.");b.errorUnsupportedIf(null==e.meshes,"Meshes must be defined");b.errorUnsupportedIf(null==e.nodes,"Nodes must be defined.");this.computeNodeParents()}f.load=function(d,e,g){return c(this,void 0,void 0,function(){var c,h,k;return a(this,function(a){switch(a.label){case 0:return b.endsWith(g,".gltf")?[4,d.loadJson(g)]:[3,2];case 1:return c=a.sent(),[2,new f(d,e,g,c)];case 2:return b.endsWith(g,
".glb")?[4,d.loadBinary(g)]:[3,5];case 3:return h=a.sent(),[4,f.parseGLB(e,h)];case 4:return k=a.sent(),[2,new f(d,e,g,k.json,k.binaryData)];case 5:e.error('URI needs to end in ".gltf" or ".glb"'),a.label=6;case 6:return[2]}})})};f.parseGLB=function(b,d){return c(this,void 0,void 0,function(){var c,e,f,g,h,k,l,p,q;return a(this,function(a){switch(a.label){case 0:c=new m.BinaryStreamReader(d),b.assert(12<=c.remainingBytes(),"GLB binary data is insufficiently large."),e=c.readUint32(),f=c.readUint32(),
g=c.readUint32(),b.assert(1179937895===e,"Magic first 4 bytes do not fit to expected GLB value."),b.assert(d.byteLength>=g,"GLB binary data is smalller than header specifies."),b.errorUnsupportedIf(2!==f,"Only GLB container version 2 is supported."),h=0,a.label=1;case 1:if(!(8<=c.remainingBytes()))return[3,5];p=c.readUint32();q=c.readUint32();if(0!==h)return[3,3];b.assert(1313821514===q,"First GLB chunck must be JSON.");b.assert(0<=p,"No JSON data found.");return[4,u(c.readUint8Array(p))];case 2:return k=
a.sent(),[3,4];case 3:1===h?(b.errorUnsupportedIf(5130562!==q,"Second GLB chunck expected to be BIN."),l=c.readUint8Array(p)):b.warnUnsupported("More than 2 GLB chunks detected. Skipping."),a.label=4;case 4:return h+=1,[3,1];case 5:return k||b.error("No GLB JSON chunk detected."),[2,{json:k,binaryData:l}]}})})};f.prototype.getBuffer=function(b){return c(this,void 0,void 0,function(){var c,d,e,f;return a(this,function(a){switch(a.label){case 0:return c=this.json.buffers[b],d=this.errorContext,null==
c.uri?(d.assert(null!=this.glbBuffer,"GLB buffer not present"),[2,this.glbBuffer]):(e=this.bufferCache.get(b))?[3,2]:[4,this.context.loadBinary(this.resolveUri(c.uri))];case 1:f=a.sent(),e=new Uint8Array(f),this.bufferCache.set(b,e),d.assert(e.byteLength===c.byteLength,"Buffer byte lengths should match."),a.label=2;case 2:return[2,e]}})})};f.prototype.getAccessor=function(b){return c(this,void 0,void 0,function(){var c,d,e,f,g,h,k,l;return a(this,function(a){switch(a.label){case 0:return c=this.json.accessors[b],
d=this.errorContext,d.errorUnsupportedIf(null==c.bufferView,"An accessor bufferView is required."),d.errorUnsupportedIf(c.type in["MAT2","MAT3","MAT4"],"AttributeType "+c.type+" is not supported"),e=this.json.bufferViews[c.bufferView],[4,this.getBuffer(e.buffer)];case 1:return f=a.sent(),g=B[c.type],h=D[c.componentType],k=g*h,l=e.byteStride||k,[2,{raw:f.buffer,byteStride:l,byteOffset:f.byteOffset+(e.byteOffset||0)+(c.byteOffset||0),entryCount:c.count,isDenselyPacked:l===k,componentCount:g,componentByteSize:h,
componentType:c.componentType,min:c.min,max:c.max}]}})})};f.prototype.getIndexData=function(b){return c(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:if(null==b.indices)return[2,null];c=this.errorContext;return[4,this.getAccessor(b.indices)];case 1:d=a.sent();c.errorUnsupportedIf(5121===d.componentType,"uint8 indices are not supported.");if(d.isDenselyPacked)switch(d.componentType){case 5123:return[2,new Uint16Array(d.raw,d.byteOffset,d.entryCount)];case 5125:return[2,
new Uint32Array(d.raw,d.byteOffset,d.entryCount)]}else switch(d.componentType){case 5123:return[2,r.makeDenseSingle(new p.BufferViewUint16(d.raw,d.byteOffset,d.byteOffset+d.byteStride,d.byteStride*d.entryCount))];case 5125:return[2,r.makeDenseSingle(new p.BufferViewUint32(d.raw,d.byteOffset,d.byteOffset+d.byteStride,d.byteStride*d.entryCount))]}return[2]}})})};f.prototype.getPositionData=function(b){return c(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:return c=
this.errorContext,c.errorUnsupportedIf(null==b.attributes.POSITION,"POSITION vertex data is required."),[4,this.getAccessor(b.attributes.POSITION)];case 1:return d=a.sent(),c.errorUnsupportedIf(5126!==d.componentType,"[POSITION attribute] Expected type FLOAT, found "+C[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,"POSITION attribute must have 3 components."),[2,new p.BufferViewVec3f(d.raw,d.byteOffset,d.byteStride,d.byteOffset+d.byteStride*d.entryCount)]}})})};f.prototype.getNormalData=
function(b){return c(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==b.attributes.NORMAL,"NORMAL vertex data is required."),[4,this.getAccessor(b.attributes.NORMAL)];case 1:return d=a.sent(),c.errorUnsupportedIf(5126!==d.componentType,"[NORMAL attribute] Expected type FLOAT, found "+C[d.componentType]),c.errorUnsupportedIf(3!==d.componentCount,"NORMAL attribute must have 3 components."),[2,new p.BufferViewVec3f(d.raw,
d.byteOffset,d.byteStride,d.byteOffset+d.byteStride*d.entryCount)]}})})};f.prototype.getTextureCoordinates=function(b){return c(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==b.attributes.TEXCOORD_0,"TEXCOORD_0 vertex data is required."),[4,this.getAccessor(b.attributes.TEXCOORD_0)];case 1:return d=a.sent(),c.errorUnsupportedIf(5126!==d.componentType,"[TEXCOORD_0 attribute] Expected type FLOAT, found "+C[d.componentType]),
c.errorUnsupportedIf(2!==d.componentCount,"TEXCOORD_0 attribute must have 2 components."),[2,new p.BufferViewVec2f(d.raw,d.byteOffset,d.byteStride,d.byteOffset+d.byteStride*d.entryCount)]}})})};f.prototype.getVertexColors=function(b){return c(this,void 0,void 0,function(){var c,d;return a(this,function(a){switch(a.label){case 0:return c=this.errorContext,c.errorUnsupportedIf(null==b.attributes.COLOR_0,"COLOR_0 vertex data is required."),[4,this.getAccessor(b.attributes.COLOR_0)];case 1:d=a.sent();
c.errorUnsupportedIf(4!==d.componentCount,"COLOR_0 attribute must have 4 components.");if(5126===d.componentType)return[2,new p.BufferViewVec4f(d.raw,d.byteOffset,d.byteStride,d.byteOffset+d.byteStride*d.entryCount)];if(5121===d.componentType)return[2,new p.BufferViewVec4u8(d.raw,d.byteOffset,d.byteStride,d.byteOffset+d.byteStride*d.entryCount)];c.errorUnsupported("[COLOR_0 attribute] Unsupported component type: "+C[d.componentType]);return[2]}})})};f.prototype.getMaterial=function(b){return c(this,
void 0,void 0,function(){var c,d,e,f,g,h;return a(this,function(a){switch(a.label){case 0:c=this.errorContext;if(d=this.materialCache.get(b.material))return[3,3];e=k.material(this.json.materials[b.material]);f=e.pbrMetallicRoughness;g=!!b.attributes.COLOR_0;h=void 0;if(!f.baseColorTexture)return[3,2];c.errorUnsupportedIf(0!==(f.baseColorTexture.texCoord||0),"Only TEXCOORD_0 is supported");return[4,this.getTexture(f.baseColorTexture.index)];case 1:h=a.sent(),a.label=2;case 2:d={alphaMode:e.alphaMode,
color:f.baseColorFactor,doubleSided:!!e.doubleSided,colorTexture:h,name:e.name,vertexColors:g},a.label=3;case 3:return[2,d]}})})};f.prototype.getTexture=function(b){return c(this,void 0,void 0,function(){var c,d,e,f,g,h,l,m;return a(this,function(a){switch(a.label){case 0:c=this.errorContext;d=this.json.textures[b];e=k.textureSampler(d.sampler);c.errorUnsupportedIf(null==d.source,"source must be defined for a texture");f=this.json.images[d.source];if(g=this.textureCache.get(b))return[3,6];h=void 0;
return f.uri?[4,this.context.loadImage(this.resolveUri(f.uri))]:[3,2];case 1:return h=a.sent(),[3,5];case 2:return c.errorUnsupportedIf(null==f.bufferView,"Image bufferView must be defined."),c.errorUnsupportedIf(null==f.mimeType,"Image mimeType must be defined."),l=this.json.bufferViews[f.bufferView],[4,this.getBuffer(l.buffer)];case 3:return m=a.sent(),c.errorUnsupportedIf(null!=l.byteStride,"byteStride not supported for image buffer"),[4,t(new Uint8Array(m.buffer,m.byteOffset+(l.byteOffset||0),
l.byteLength),f.mimeType)];case 4:h=a.sent(),a.label=5;case 5:g={data:h,wrapS:e.wrapS,wrapT:e.wrapT,minFilter:e.minFilter,name:f.name},this.textureCache.set(b,g),a.label=6;case 6:return[2,g]}})})};f.prototype.getNodeTransform=function(a){if(void 0===a)return z;var b=this.nodeTransformCache.get(a);if(!b){var b=this.getNodeTransform(this.getNodeParent(a)),c=this.json.nodes[a];if(c.matrix)b=q.mat4d.multiply(b,c.matrix,q.mat4d.create());else if(c.translation||c.rotation||c.scale)b=q.mat4d.create(b),c.translation&&
q.mat4d.translate(b,c.translation,b),c.rotation&&(q.quat4d.toAngleAxis(c.rotation,x),q.mat4d.rotate(b,x[3],x,b)),c.scale&&q.mat4d.scale(b,c.scale,b);this.nodeTransformCache.set(a,b)}return b};f.prototype.resolveUri=function(a){return e.isDataProtocol(a)?a:this.baseUri+a};f.prototype.getNodeParent=function(a){return this.nodeParentMap.get(a)};f.prototype.checkVersionSupported=function(){h.Version.parse(this.json.asset.version,"glTF").validate(A)};f.prototype.checkRequiredExtensionsSupported=function(){var a=
this.json,b=this.errorContext;a.extensionsRequired&&0!==a.extensionsRequired.length&&b.errorUnsupportedIf(!0,"Extensions: "+a.extensionsRequired.join(", "))};f.prototype.computeNodeParents=function(){var a=this;this.json.nodes.forEach(function(b,c){b.children&&b.children.forEach(function(b){a.nodeParentMap.set(b,c)})})};return f}();g.Resource=n;var A=new h.Version(2,0,"glTF"),z=q.mat4d.rotateX(q.mat4d.identity(),Math.PI/2),x=q.quat4d.create(),B={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},D=(v={},v[5120]=1,v[5121]=
1,v[5122]=2,v[5123]=2,v[5126]=4,v[5125]=4,v),C={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"}})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function c(a){this.data=a;this.offset4=0;this.dataUint32=new Uint32Array(this.data)}c.prototype.readUint32=function(){var a=this.offset4;this.offset4+=1;return this.dataUint32[a]};c.prototype.readUint8Array=
function(a){var c=4*this.offset4;this.offset4+=a/4;return new Uint8Array(this.data,c,a)};c.prototype.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return c}();g.BinaryStreamReader=n})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["require","exports","../../../../core/tsSupport/assignHelper"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});var a={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},f={pbrMetallicRoughness:a,emissiveFactor:[0,
0,0],alphaMode:"OPAQUE",alphaCutOff:.5,doubleSided:!1};g.material=function(b){void 0===b&&(b={});var e=c({},a,b?b.pbrMetallicRoughness:void 0);return c({},f,b,{pbrMetallicRoughness:e})};var b={magFilter:9729,minFilter:9987,wrapS:10497,wrapT:10497};g.textureSampler=function(a){return c({},b,a)}})},"esri/views/3d/glTF/internal/pathUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.splitURI=function(c){var a,f;c.replace(/^(.*\/)?([^/]*)$/,
function(b,c,e){a=c;f=e;return""});return{dirPart:a,filePart:f}}})},"esri/views/3d/support/buffer/math":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});(function(c){c.transformMat4=function(a,c,b){if(a.count!==c.count)console.error("input and output buffers need to have the same number of elements");else{var f=a.count,e=b[0],g=b[1],m=b[2],k=b[3],d=b[4],q=b[5],p=b[6],r=b[7],n=b[8],t=b[9],v=b[10],A=b[11],z=b[12],x=b[13],B=b[14];b=b[15];for(var D=
0;D<f;D++){var C=c.get(D,0),G=c.get(D,1),E=c.get(D,2),F=k*C+r*G+A*E+b,F=F||1;a.set(D,0,(e*C+d*G+n*E+z)/F);a.set(D,1,(g*C+q*G+t*E+x)/F);a.set(D,2,(m*C+p*G+v*E+B)/F)}}};c.transformMat3=function(a,c,b){if(a.count!==c.count)console.error("input and output buffers need to have the same number of elements");else{var f=a.count,e=b[0],g=b[1],m=b[2],k=b[3],d=b[4],q=b[5],p=b[6],r=b[7];b=b[8];for(var n=0;n<f;n++){var t=c.get(n,0),v=c.get(n,1),A=c.get(n,2);a.set(n,0,e*t+k*v+p*A);a.set(n,1,g*t+d*v+r*A);a.set(n,
2,m*t+q*v+b*A)}}}})(g.vec3||(g.vec3={}));(function(c){c.scale=function(a,c,b){for(var f=Math.min(a.count,c.count),e=0;e<f;e++)a.set(e,0,c.get(e,0)*b),a.set(e,1,c.get(e,1)*b),a.set(e,2,c.get(e,2)*b),a.set(e,3,c.get(e,3)*b)}})(g.vec4||(g.vec4={}))})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["require","exports","../../../../geometry/support/aaBoundingBox","../../webgl-engine/lib/Geometry","../../webgl-engine/lib/GeometryUtil"],function(n,g,c,a,f){Object.defineProperty(g,
"__esModule",{value:!0});var b=c.fromValues(-.5,-.5,-.5,.5,.5,.5),l=c.fromValues(-.5,-.5,0,.5,.5,1),e=c.fromValues(-.5,-.5,0,.5,.5,.5);g.isValidPrimitive=function(a){switch(a){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};g.primitiveBoundingBox=function(a){switch(a){case "sphere":case "cube":case "diamond":return b;case "cylinder":case "cone":case "inverted-cone":return l;case "tetrahedron":return e}};g.primitiveGeometryData=
function(a){switch(a){case "sphere":return f.createPolySphereGeometry(.5,2,!0);case "cube":return f.createBoxGeometry(1);case "cylinder":return f.createCylinderGeometry(1,.5,32,[0,0,1],[0,0,.5]);case "cone":return f.cgToGIS(f.createConeGeometry(1,.5,15,!1));case "inverted-cone":return f.cgToGIS(f.createConeGeometry(1,.5,15,!0));case "tetrahedron":return f.cgToGIS(f.createTetrahedronGeometry(1));case "diamond":return f.cgToGIS(f.createDiamondGeometry(1))}};g.primitiveLodResources=function(b,c,e){var d=
function(b,d,g){void 0===g&&(g=!1);return{levels:b.map(function(b,h){var k=d(b.tesselation);g&&f.cgToGIS(k);return{components:[{geometry:new a(k,e+("_lod"+h)),material:c}],faceCount:k.indexCount/3,minScreenSpaceRadius:b.minScreenSpaceRadius}})}};switch(b){case "sphere":return d([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:5},{tesselation:2,minScreenSpaceRadius:15}],function(a){return f.createPolySphereGeometry(.5,a,!0)});case "cube":return d([{tesselation:0,minScreenSpaceRadius:0}],
function(a){return f.createBoxGeometry(1)});case "cone":return d([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:16,minScreenSpaceRadius:20}],function(a){return f.createConeGeometry(1,.5,a,!1)},!0);case "inverted-cone":return d([{tesselation:4,minScreenSpaceRadius:0},{tesselation:8,minScreenSpaceRadius:10},{tesselation:16,minScreenSpaceRadius:20}],function(a){return f.createConeGeometry(1,.5,a,!0)},!0);case "cylinder":return d([{tesselation:4,minScreenSpaceRadius:0},
{tesselation:8,minScreenSpaceRadius:10},{tesselation:32,minScreenSpaceRadius:20}],function(a){return f.createCylinderGeometry(1,.5,a,[0,0,1],[0,0,.5])});case "tetrahedron":return d([{tesselation:0,minScreenSpaceRadius:0}],function(a){return f.createTetrahedronGeometry(1)},!0);case "diamond":return d([{tesselation:0,minScreenSpaceRadius:0}],function(a){return f.createDiamondGeometry(1)},!0)}}})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayerLod":function(){define("require exports ../../../../core/tsSupport/extendsHelper dojo/errors/CancelError ../../../../Color ../../../../core/asyncUtils ../../../../core/lang ../../../../core/screenUtils ../../../../geometry/support/aaBoundingBox ../../../../symbols/ObjectSymbol3DLayer ./ElevationAligners ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lodResourceUtils ./primitiveObjectSymbolUtils ../support/FastSymbolUpdates ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Util ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G){n=function(g){function p(){var a=null!==g&&g.apply(this,arguments)||this;a._instanceIndexToGraphicUid={};return a}c(p,g);Object.defineProperty(p.prototype,"lodRenderer",{get:function(){return this._lodRenderer},enumerable:!0,configurable:!0});p.prototype._prepareResources=function(){var a=this.symbol,b=this._getStageIdHint();this._optionalFields=[];if(!this._isPropertyDriven("size")){var c=r.validateSymbolLayerSize(this.symbol);if(c){this._logWarning(c);
this.reject();return}}a.resource&&a.resource.href?this._prepareModelResources(a.resource.href,b):this._preparePrimitiveResources(a.resource?a.resource.primitive:"sphere",b)};p.prototype._preparePrimitiveResources=function(a,b){if(t.isValidPrimitive(a)){var c=this.symbol,d=this._getMaterialOpacity(),d={specular:[0,0,0],opacity:d,transparent:1>d||this._isPropertyDriven("opacity"),instanced:["transformation"],ambient:E,diffuse:E},g=this.symbolContainer;if("point-3d"===g.type&&g.verticalOffset){var g=
g.verticalOffset,k=g.minWorldLength,m=g.maxWorldLength;d.verticalOffset={screenLength:e.pt2px(g.screenLength),minWorldLength:k||0,maxWorldLength:null!=m?m:Infinity};d.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(d.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._isPropertyDriven("color")?d.externalColor=F:(g=c.material?f.toUnitRGBA(c.material.color):F,d.externalColor=g);this._fastUpdates=v.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());
this._fastUpdates.enabled?(l.mixin(d,this._fastUpdates.materialParameters),d.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(d.instanced.push("color"),this._optionalFields.push("color"));d=new G(d,b+"_objectmat");(this._lodResources=t.primitiveLodResources(a,d,b))?(this._resourceBoundingBox=h.create(t.primitiveBoundingBox(a)),this._resourceSize=h.size(this._resourceBoundingBox),this._symbolSize=r.computeSizeWithResourceSize(this._resourceSize,
c),this.finalizeSymbolResources(),this.initializeLodRenderer(),this.resolve()):(this._logWarning("Unknown object symbol primitive: "+a),this.reject())}else this._logWarning("Unknown object symbol primitive: "+a),this.reject()};p.prototype._prepareModelResources=function(c,d){var f=this,g=["transformation"];d={materialParamsMixin:{instanced:g},idHint:d,streamDataSupplier:this._context.streamDataSupplier};this._fastUpdates=v.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());
this._fastUpdates.enabled?(l.mixin(d.materialParamsMixin,this._fastUpdates.materialParameters),g.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(g.push("color"),this._optionalFields.push("color"));g=this.symbolContainer;if("point-3d"===g.type&&g.verticalOffset){var g=g.verticalOffset,k=g.minWorldLength,m=g.maxWorldLength;d.materialParamsMixin.verticalOffset={screenLength:e.pt2px(g.screenLength),minWorldLength:k||0,maxWorldLength:null!=m?m:Infinity};
d.materialParamsMixin.castShadows=!1}this._symbolLoaderPromise=b.safeCast(u.fetchObjectLodResources(c,d));this._symbolLoaderPromise.then(function(a){f._symbolLoaderPromise=null;if(!f.isRejected()){u.fillEstimatedMinScreenSpaceRadius(a);f._lodResources=a;var b=f._context,c=f._getExternalColorParameters(f.symbol.material),d=f._getMaterialOpacity(),e=f._isPropertyDriven("opacity");a=C.materialsFromLodResources(f._lodResources);f._originalOpacities=a.map(function(a){return a.getParameterValues().opacity||
1});a.forEach(function(a){var f=a.getParameterValues();a.setParameterValues(c);var g=f.opacity*d;a.setParameterValues({opacity:g,transparent:1>g||e||f.transparent});b.screenSizePerspectiveEnabled&&a.setParameterValues({screenSizePerspective:b.sharedResources.screenSizePerspectiveSettings})});f._resourceBoundingBox=C.computeBoundingBox(f._lodResources.levels[0]);f._resourceSize=h.size(f._resourceBoundingBox);f._pivotOffset=f._lodResources.levels[0].pivotOffset;f._symbolSize=r.computeSizeWithResourceSize(f._resourceSize,
f.symbol);f.finalizeSymbolResources();f.initializeLodRenderer();v.updateFastSymbolUpdatesState(f._fastUpdates,f._context.renderer,f._fastVisualVariableConvertOptions())&&f._materials.forEach(function(a){return a.setParameterValues(f._fastUpdates.materialParameters)});f.resolve()}},function(b){f._symbolLoaderPromise=null;if(!f.isFulfilled()){if(!(b instanceof a)){var c="ObjectSymbol3DLayer failed to load";b&&b.message&&(c+=" ("+b.message+")");f._logWarning(c)}f.reject()}})};p.prototype.finalizeSymbolResources=
function(){var a=this._context.stage;this._materials=C.materialsFromLodResources(this._lodResources);this._originalOpacities||(this._originalOpacities=this._materials.map(function(a){return a.getParameterValues().opacity||1}));this._materials.forEach(function(b){a.add(x.ModelContentType.MATERIAL,b)});this._textures=C.texturesFromLodResources(this._lodResources);this._textures.forEach(function(b){a.add(x.ModelContentType.TEXTURE,b)});this._geometries=C.geometriesFromLodResources(this._lodResources);
this._geometries.forEach(function(b){a.add(x.ModelContentType.GEOMETRY,b)})};p.prototype.initializeLodRenderer=function(){var a=this,b=this._context.stage;this._lodRenderer=new D.LodRenderer(this._lodResources,this._optionalFields,function(b){return{layerUid:a._context.layer.uid,graphicUid:a._instanceIndexToGraphicUid[b]}});b.addRenderPlugin(this._lodRenderer.slots,this._lodRenderer)};p.prototype._getExternalColorParameters=function(a){var b={};this._isPropertyDriven("color")?b.externalColor=F:a&&
a.color?b.externalColor=f.toUnitRGBA(a.color):(b.externalColor=F,b.colorMixMode="ignore");return b};p.prototype.destroy=function(){g.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._symbolLoaderPromise&&this._symbolLoaderPromise.cancel();var a=this._context.stage;this._lodRenderer&&(a.removeRenderPlugin(this._lodRenderer),this._lodRenderer.destroy());this._materials&&this._materials.forEach(function(b){return a.remove(x.ModelContentType.MATERIAL,b.id)});this._textures&&this._textures.forEach(function(b){return a.remove(x.ModelContentType.TEXTURE,
b.id)});this._geometries&&this._geometries.forEach(function(b){return a.remove(x.ModelContentType.GEOMETRY,b.id)})};p.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if(!this._validateGeometry(b.geometry))return null;var c=q.placePointOnGeometry(b.geometry);if(!c)return this._logWarning("unsupported geometry type for icon symbol: "+b.geometry.type),null;var d="graphic"+b.uid,e=this.getGraphicElevationContext(b);return this._createAs3DShape(b,c,a.renderingInfo,e,d,b.uid)};p.prototype.notifyDestroyGraphicLayer=
function(a){delete this._instanceIndexToGraphicUid[a.instanceIndex]};p.prototype.graphicLayerToGraphicId=function(a){return 0};p.prototype.layerPropertyChanged=function(a,b,c){var d=this;if("opacity"===a){var e=this._isPropertyDriven("opacity");this._materials.forEach(function(a,b){b=d._getMaterialOpacity()*d._originalOpacities[b];a.setParameterValues({opacity:b,transparent:1>b||e})});return!0}if("elevationInfo"===a){this._updateElevationContext();for(var f in b){var g=b[f];if(a=c(g))g=this.getGraphicElevationContext(g.graphic),
a.needsElevationUpdates=q.needsElevationUpdates3D(g.mode),a.elevationContext.set(g)}return!0}return!1};p.prototype.applyRendererDiff=function(a,b,c,d){var e=this,f;for(f in a.diff)switch(f){case "visualVariables":if(v.updateFastSymbolUpdatesState(this._fastUpdates,b,this._fastVisualVariableConvertOptions()))this._materials.forEach(function(a){return a.setParameterValues(e._fastUpdates.materialParameters)});else return!1;break;default:return!1}return!0};Object.defineProperty(p.prototype,"numberOfVertices",
{get:function(){return C.geometriesFromLodLevelResources(this._lodResources.levels[0]).reduce(function(a,b){return a+b.data.getIndices(B.VertexAttrConstants.POSITION).length},0)},enumerable:!0,configurable:!0});p.prototype._createAs3DShape=function(a,b,c,e,f,g){var h=this,l=this.getFastUpdateAttrValues(a);a=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?r.mixinColorAndOpacity(c.color,c.opacity):null;l?function(a){return v.evaluateModelTransform(h._fastUpdates.materialParameters,l,a)}:null;
f=this._context.clippingExtent;z.pointToVector(b,K,this._context.elevationProvider.spatialReference);if(f&&!q.pointInBox2D(K,f))return null;z.pointToVector(b,K,this._context.renderSpatialReference);f="absolute-height"!==e.mode;var m=q.computeElevation(this._context.elevationProvider,b,e,this._context.renderCoordsHelper,f?M:null),p=N,t=H;A.mat4d.identity(N);this._applyObjectRotation(c,p);this._applyObjectRotation(this.symbol,p);this._applyObjectScale(c,p);this._applyAnchor(p);K[0]=b.x;K[1]=b.y;K[2]=
m;z.computeLinearTransformation(b.spatialReference,K,t,this._context.renderSpatialReference)||console.warn("Could not locate symbol object properly, it might be misplaced");c=this._lodRenderer.instanceData;A.mat4d.multiply(t,p,t);p=c.addInstance();this._instanceIndexToGraphicUid[p]=g;c.setTransform(p,t);l&&c.setFeatureAttribute(p,l);a&&c.setColor(p,a);g=new d(this,p,k.perLodInstanceElevationAligner,e);f&&(g.alignedTerrainElevation=M.terrainElevation);g.needsElevationUpdates=q.needsElevationUpdates3D(e.mode);
q.extendPointGraphicElevationContext(g,b,this._context.elevationProvider);return g};p.prototype._applyObjectScale=function(a,b){this._fastUpdates.enabled&&this._fastUpdates.customTransformation||(a=this._isPropertyDriven("size")&&a.size?a.size:this._symbolSize,a=r.computeObjectScale(a,this._symbolSize,this._resourceSize,this._context.renderCoordsHelper.unitInMeters),1===a[0]&&1===a[1]&&1===a[2]||A.mat4d.scale(b,a))};p.prototype._applyObjectRotation=function(a,b){if(!(this._fastUpdates.enabled&&this._fastUpdates.customTransformation&&
a instanceof m))return r.computeObjectRotation(a.heading,a.tilt,a.roll,b)};p.prototype._computeAnchor=function(){switch(this.symbol.anchor){case "center":return A.vec3d.scale(h.center(this._resourceBoundingBox),-1);case "top":var a=h.center(this._resourceBoundingBox);return[-a[0],-a[1],-this._resourceBoundingBox[5]];case "bottom":return a=h.center(this._resourceBoundingBox),[-a[0],-a[1],-this._resourceBoundingBox[2]];default:return this._pivotOffset?A.vec3d.scale(this._pivotOffset,-1,Array(3)):I}};
p.prototype._applyAnchor=function(a){if(!this._fastUpdates.enabled||!this._fastUpdates.customTransformation){var b=this._computeAnchor();b&&A.mat4d.translate(a,b)}};p.prototype._hasPerInstanceColor=function(){return this._isPropertyDriven("color")||this._isPropertyDriven("opacity")};p.prototype._fastVisualVariableConvertOptions=function(){var a=this._resourceBoundingBox?h.size(this._resourceBoundingBox):E,b=this._resourceBoundingBox?this._computeAnchor():I,c=this._context.renderCoordsHelper.unitInMeters,
d=r.computeObjectScale(this._symbolSize,this._symbolSize,this._resourceSize,c);return{modelSize:a,symbolSize:this._symbolSize||E,unitInMeters:c,transformation:{anchor:b,scale:d,rotation:[this.symbol.tilt||0,this.symbol.roll||0,this.symbol.heading||0]}}};return p}(p);var E=[1,1,1],F=[1,1,1,1],I=[0,0,0],K=A.vec3d.create(),N=A.mat4d.create(),H=A.mat4d.create(),M={verticalDistanceToGround:0,terrainElevation:0};return n})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./Graphics3DGraphicElevationContext ./graphicUtils ../../lib/gl-matrix ../../webgl-engine/lib/HighlightUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k){n=function(){function c(a,b,c,d){this.type="lod-instance";this.alignedTerrainElevation=0;this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=a;this.instanceIndex=b;this.elevationAligner=c;this.elevationContext=new e(d)}c.prototype.initialize=function(a,b){};c.prototype.setVisibility=function(a){var b=this.lodRenderer.instanceData;return a!==b.getVisible(this.instanceIndex)?(b.setVisible(this.instanceIndex,a),!0):!1};c.prototype.destroy=function(){null!=this.instanceIndex&&
(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};c.prototype.alignWithElevation=function(a,b,c){this.elevationAligner&&(l.setContextFeature(this.elevationContext.featureExpressionInfoContext,c),a=this.elevationAligner(this,this.elevationContext,a,b),null!=a&&(this.alignedTerrainElevation=a))};c.prototype.getBSRadius=function(){var a=this.lodRenderer;return a.baseBoundingSphere.radius*a.instanceData.getScaleFactor(this.instanceIndex)};
c.prototype.getCenterObjectSpace=function(){return this.lodRenderer.baseBoundingSphere.center};c.prototype.getBoundingBoxObjectSpace=function(a){a=a||b.create();b.set(a,this.lodRenderer.baseBoundingBox);return a};c.prototype.getProjectedBoundingBox=function(c,e,g,k){return f(this,void 0,void 0,function(){var f,l,t,n,v,x,A,z,N;return a(this,function(a){switch(a.label){case 0:f=this.getBoundingBoxObjectSpace(g);l=r;t=b.isPoint(f)?1:l.length;this.lodRenderer.instanceData.getTransform(this.instanceIndex,
u);for(n=0;n<t;n++)v=l[n],q[0]=f[v[0]],q[1]=f[v[1]],q[2]=f[v[2]],m.mat4d.multiplyVec3(u,q),d[3*n+0]=q[0],d[3*n+1]=q[1],d[3*n+2]=q[2];if(!c(d,0,t))return[2,null];b.empty(f);x=null;this.calculateRelativeScreenBounds&&(x=this.calculateRelativeScreenBounds());for(n=0;n<3*t;n+=3){for(A=0;3>A;A++)f[A]=Math.min(f[A],d[n+A]),f[A+3]=Math.max(f[A+3],d[n+A]);x&&k.push({location:d.slice(n,n+3),screenSpaceBoundingRect:x})}if(!e)return[3,5];b.center(f,p);if("absolute-height"===this.elevationContext.mode)return[3,
5];z=void 0;N=h.demResolutionForBoundingBox(f,e);a.label=1;case 1:return a.trys.push([1,3,,4]),[4,e.service.queryElevation(p[0],p[1],N)];case 2:return z=a.sent(),[3,4];case 3:return a.sent(),z=null,[3,4];case 4:null!=z&&b.offset(f,0,0,-this.alignedTerrainElevation+z),a.label=5;case 5:return[2,f]}})})};c.prototype.addHighlight=function(a,b){var c=this;this.highlightId=k.generateHighlightId();this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0);a.addExternal(function(a){c.lodRenderer.instanceData.setHighlight(c.instanceIndex,
!1);c.highlightId=null},this.highlightId)};c.prototype.removeHighlight=function(a){this.highlightId&&a.remove(this.highlightId)};Object.defineProperty(c.prototype,"lodRenderer",{get:function(){return this.graphics3DSymbolLayer.lodRenderer},enumerable:!0,configurable:!0});return c}();var d=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=m.vec3d.create(),p=m.vec3d.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],u=m.mat4d.create();return n})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define("require exports ../../../../core/tsSupport/generatorHelper ../../../../core/tsSupport/awaiterHelper ./objectResourceUtils ../../webgl-engine/lib/lodRendering/LodResources".split(" "),
function(n,g,c,a,f,b){function l(a){var b=[];a.stageResources.geometries.forEach(function(c,d){b.push({material:a.materialsByComponent[d][0],geometry:c,textures:a.stageResources.textures})});return{components:b,faceCount:a.lodMetrics?a.lodMetrics.faceCount:null,minScreenSpaceRadius:null,pivotOffset:a.pivotOffset}}function e(a){return{levels:a.map(function(a){return l(a)})}}function h(a,c){void 0===c&&(c=m);a=b.computeFaceCount(a);return Math.sqrt(a/(c*Math.PI))}Object.defineProperty(g,"__esModule",
{value:!0});g.makeLodLevelResources=l;g.makeLodResources=e;g.fetchObjectLodResources=function(b,d){return a(this,void 0,void 0,function(){var a;return c(this,function(c){switch(c.label){case 0:return[4,f.fetchLod(b,d)];case 1:return a=c.sent(),[2,e(a)]}})})};g.estimateMinScreenSpaceRadius=h;g.fillEstimatedMinScreenSpaceRadius=function(a){a.levels.forEach(function(a){a.minScreenSpaceRadius=h(a)});a.levels[0].minScreenSpaceRadius=Math.min(2,a.levels[0].minScreenSpaceRadius)};var m=.05})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["require",
"exports","../../../../../core/arrayUtils","../../../../../geometry/support/aaBoundingBox"],function(n,g,c,a){function f(a){var b=[];a.components.forEach(function(a){b.push(a.geometry)});return c.unique(b)}Object.defineProperty(g,"__esModule",{value:!0});g.materialsFromLodResources=function(a){var b=[];a.levels.forEach(function(a){a.components.forEach(function(a){b.push(a.material)})});return c.unique(b)};g.texturesFromLodResources=function(a){var b=[];a.levels.forEach(function(a){a.components.forEach(function(a){a.textures&&
b.push.apply(b,a.textures)})});return c.unique(b)};g.geometriesFromLodLevelResources=f;g.geometriesFromLodResources=function(a){var b=[];a.levels.forEach(function(a){a.components.forEach(function(a){b.push(a.geometry)})});return c.unique(b)};g.computeBoundingBox=function(b){var c=a.empty();f(b).forEach(function(b){b=b.boundingInfo;a.expand(c,b.getBBMin());a.expand(c,b.getBBMax())});return c};g.computeFaceCount=function(a){var b=0;f(a).forEach(function(a){b+=a.data.indexCount/3});return b}})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../../../geometry/support/aaBoundingBox ../../../lib/gl-matrix ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ../RenderSlot ./InstanceData ./InstanceOctree ./LevelSelector ./RenderInstanceData ./utils ../../materials/DefaultMaterial ../../../../webgl/BufferObject ../../../../webgl/Util ../../../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v){function A(a,b,c,d){p.encodeDoubleVec3(a.modelOrigin,b,c.modelOriginHi,c.modelOriginLo,d);a.model.getMat(b,G);c.model.setMat(d,G);a.modelNormal.getMat(b,G);c.modelNormal.setMat(d,G);a.color&&c.color&&(a.color.getVec(b,C),c.color.setVec(d,C));a.featureAttribute&&c.featureAttribute&&(a.featureAttribute.getVec(b,C),c.featureAttribute.setVec(d,C))}Object.defineProperty(g,"__esModule",{value:!0});var z=t.assert,x=function(){function a(a,c){this.glMaterials=
{};var d=a.rctx,f=c.geometry;c=c.material;var g=f.data.toRenderData();this.materialRep=a.materialRep;c.setParameterValues({instancedDoublePrecision:!0});a=c.bufferWriter;var h=a.vertexBufferLayout,k=a.elementCount(g),l=a.allocate(k);a.write({},g,void 0,l,0);this.geometry=f;this.material=c;this.glMaterials=p.acquireGLMaterials(c,this.materialRep);this.vertexBufferLayout=h;this.vbo=u.createVertex(d,35044,l.buffer);this.vao=new v(d,e.Default3D,{geometry:b.glLayout(h)},{geometry:this.vbo});this.vertexCount=
k}a.prototype.destroy=function(){p.releaseGLMaterials(this.material,this.materialRep);this.vbo.dispose();this.vao.dispose()};Object.defineProperty(a.prototype,"boundingInfo",{get:function(){return this.geometry.boundingInfo},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"triangleCount",{get:function(){return this.vertexCount/3},enumerable:!0,configurable:!0});a.prototype.intersect=function(a,b,c,d,e){var f=this.geometry.id,g=d.toString();this.material.intersect(this.geometry,null,
I,a,b,c,function(b,c,h,k,l,m){if(0<=b){l={type:"external",metadata:e(d)};if(null==a.minResult.priority||k>=a.minResult.priority)if(null==a.minResult.dist||b<a.minResult.dist)a.minResult.set(l,g,b,c,k,null,f,h),a.minResult.setIntersector("LodRenderer");if(null==a.maxResult.priority||k>=a.maxResult.priority)if(null==a.maxResult.dist||b>a.maxResult.dist)a.maxResult.set(l,g,b,c,k,null,f,h),a.minResult.setIntersector("LodRenderer")}},null)};return a}();g.LodComponentData=x;var B=function(){function b(a,
b){var c=this;this.components=[];this.minScreenSpaceRadius=b.minScreenSpaceRadius;b.components.forEach(function(b){c.components.push(new x(a,b))})}b.prototype.destroy=function(){this.components.forEach(function(a){a.destroy()})};b.prototype.intersect=function(a,b,c,d,e){this.components.forEach(function(f){f.intersect(a,b,c,d,e)})};Object.defineProperty(b.prototype,"boundingBox",{get:function(){if(!this._boundingBox){var b=a.empty();this.components.forEach(function(c){a.expand(b,c.boundingInfo.bbMin);
a.expand(b,c.boundingInfo.bbMax)});this._boundingBox=b}return this._boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"boundingSphere",{get:function(){if(!this._boundingSphere){var b=this.boundingBox,c=f.vec3d.create();a.center(b,c);this._boundingSphere={center:c,radius:.5*a.diameter(b)}}return this._boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(b.prototype,"triangleCount",{get:function(){return this.components.reduce(function(a,b){return a+b.triangleCount},
0)},enumerable:!0,configurable:!0});return b}();g.LodLevelData=B;n=function(){function a(a,c,d){var e=this;this._levels=[];this._renderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._lastCamera=new l;this._updateCyclesWithStaticCamera=-1;this.didRender=this._needFullCycle=!1;this._symbol=a;this._optionalFields=c;this._instanceToMetadata=d;this._instanceBufferLayout=r.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:c});this._glInstanceBufferLayout=b.glLayout(this._instanceBufferLayout,
{divisor:1});this._instanceData=new m.InstanceData(this._optionalFields);this._instanceData.on("instance-added",function(a){e.resetUpdateCycle()});this._instanceData.on("instance-removed",function(a){e.resetUpdateCycle()});this._instanceData.on("instance-transform-changed",function(a){e.resetUpdateCycle()});this._instanceData.on("instance-visibility-changed",function(a){e.resetUpdateCycle();e.requestFullCycle()});this._instanceData.on("instance-highlight-changed",function(a){e.resetUpdateCycle();
e.requestFullCycle()});g.lodRenderers.push(this);window.lodRenderer=this}a.prototype.destroy=function(){g.lodRenderers.splice(g.lodRenderers.indexOf(this),1)};Object.defineProperty(a.prototype,"baseBoundingBox",{get:function(){return this._levels[0].boundingBox},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"baseBoundingSphere",{get:function(){return this._levels[0].boundingSphere},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"instanceData",{get:function(){return this._instanceData},
enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){var a={cpu:0,gpu:0};this._renderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});this._highlightRenderInstanceData.forEach(function(b){b=b.memoryUsage;a.cpu+=b.cpu;a.gpu+=b.gpu});return a},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"renderStats",{get:function(){var a=this,b=this._instanceData.size,c=[];this._levels.forEach(function(b,d){d=a._renderInstanceData[d].size+
a._highlightRenderInstanceData[d].size;b=b.triangleCount;c.push({renderedInstances:d,renderedTriangles:d*b,trianglesPerInstance:b})});return{totalInstances:b,renderedInstances:c.reduce(function(a,b){return a+b.renderedInstances},0),renderedTriangles:c.reduce(function(a,b){return a+b.renderedTriangles},0),levels:c}},enumerable:!0,configurable:!0});a.prototype.initializeRenderContext=function(a){var b=this,c=a.rctx;this._symbol.levels.forEach(function(d){b._levels.push(new B(a,d));b._renderInstanceData.push(new q.RenderInstanceData(c,
b._optionalFields,b._instanceBufferLayout));b._highlightRenderInstanceData.push(new q.RenderInstanceData(c,b._optionalFields,b._instanceBufferLayout))});var e=this._levels[0].boundingSphere.radius,f=this._levels.map(function(a){return a.minScreenSpaceRadius});this._levelSelector=new d.LevelSelector(e,f);this._octree=new k.InstanceOctree(this._instanceData,this._levels[0].boundingSphere)};a.prototype.uninitializeRenderContext=function(a){this._levels.forEach(function(a){a.destroy()});this._renderInstanceData.forEach(function(a){a.destroy()});
this._highlightRenderInstanceData.forEach(function(a){a.destroy()})};Object.defineProperty(a.prototype,"slots",{get:function(){return[h.OPAQUE_EXTERNAL,h.TRANSPARENT_EXTERNAL]},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"needsHighlight",{get:function(){return 0<this._highlightRenderInstanceData.reduce(function(a,b){return a+b.size},0)},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"needsRender",{get:function(){return 1>this._updateCyclesWithStaticCamera},
enumerable:!0,configurable:!0});a.prototype.resetNeedsRender=function(){this.didRender&&(this.didRender=!1)};a.prototype.prepareRender=function(a){var b=a.equivalent(this._lastCamera);this._lastCamera.copyFrom(a);b||this.resetUpdateCycle();b=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this.updateInstances(a,b)};a.prototype.render=function(a){var b=a.slot===h.OPAQUE_EXTERNAL?h.OPAQUE_MATERIAL:a.slot===h.TRANSPARENT_EXTERNAL?h.TRANSPARENT_MATERIAL:null;if(b){var c={view:a.camera.viewMatrix,
proj:a.camera.projectionMatrix,origin:[0,0,0],viewInvTransp:a.camera.viewInverseTransposeMatrix,lightingData:a.lightingData,viewport:a.camera.viewport,fovY:a.camera.fovY,nearFar:[a.camera.near,a.camera.far],framebufferTex:a.offscreenRenderingHelper?a.offscreenRenderingHelper.colorTexture:null,shadowMap:a.shadowMap,shadowMappingEnabled:!!a.shadowMap&&a.shadowMap.enabled,ssaoEnabled:!!a.ssaoHelper&&a.ssaoHelper.enabled,pixelRatio:a.pixelRatio,cameraAboveGround:a.camera.aboveGround,hudVisibilityTexture:a.offscreenRenderingHelper?
a.offscreenRenderingHelper.hudVisibilityTexture:null};a.rctx.bindVAO();if(a.isHighlightPass)for(var d=0;d<this._levels.length;++d)this.renderLevel(a,b,c,this._highlightRenderInstanceData[d],this._levels[d]);else for(d=0;d<this._levels.length;++d)this.renderLevel(a,b,c,this._renderInstanceData[d],this._levels[d]);return!0}};a.prototype.intersect=function(a,b,c,d){var e=this;d=f.vec3d.create();f.vec3d.subtract(c,b,d);this._octree.forEachAlongRay(b,d,function(d){e._instanceData.getTranslation(d,D);e._instanceData.getModel(d,
G);f.vec3d.subtract(b,D,E);f.vec3d.subtract(c,D,F);f.mat3d.inverse(G,G);f.mat3d.multiplyVec3(G,E);f.mat3d.multiplyVec3(G,F);var g=e._instanceData.getState(d),h=e._instanceData.getLodLevel(d);z(g&m.StateFlags.ACTIVE,"invalid instance state");z(0<=h&&h<e._levels.length,"invaid lod level");e._levels[h].intersect(a,E,F,d,e._instanceToMetadata)})};a.prototype.queryDepthRange=function(a){return this.queryDepthRangeOctree(a)};a.prototype.queryDepthRangeOctree=function(a){var b=a.eye,c=a.viewForward,d=this._octree.findClosest(c,
"front-to-back",a.frustumPlanes),e=this._octree.findClosest(c,"back-to-front",a.frustumPlanes);return null!=d&&null!=e?(this._instanceData.view.boundingSphere.getVec(d,C),f.vec3d.subtract(C,b),d=f.vec3d.dot(C,c)-C[3],this._instanceData.view.boundingSphere.getVec(e,C),f.vec3d.subtract(C,b),b=f.vec3d.dot(C,c)+C[3],{near:Math.max(a.near,d),far:Math.min(a.far,b)}):{near:Infinity,far:-Infinity}};a.prototype.updateInstances=function(a,b){var c=this._levelSelector;c.updateCamera(a);this._renderInstanceData.forEach(function(a){a.beginUpdate()});
this._highlightRenderInstanceData.forEach(function(a){a.beginUpdate()});a=this._instanceData;var d=this._instanceData.view,e=a.capacity,f=this._instanceIndex;b=Math.min(a.size,b);for(var g=0;g<b;++g){0===f&&this.startUpdateCycle();var h=d.state.get(f),k=0;if(h&m.StateFlags.ALLOCATED){var l=d.lodLevel.get(f);h&m.StateFlags.ACTIVE&&this._renderInstanceData[l].freeTail();h&m.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[l].freeTail();if(h&m.StateFlags.REMOVE)a.notifyRemoved(f);else if(h&
m.StateFlags.VISIBLE){d.modelOrigin.getVec(f,D);l=c.selectLevel(D,d.modelScaleFactor.get(f));k=h&~(m.StateFlags.ACTIVE|m.StateFlags.HIGHLIGHT_ACTIVE|m.StateFlags.TRANSFORM_CHANGED);if(0<=l){var p=this._renderInstanceData[l],q=p.allocateHead();A(d,f,p.view,q);k|=m.StateFlags.ACTIVE;h&m.StateFlags.HIGHLIGHT&&(p=this._highlightRenderInstanceData[l],q=p.allocateHead(),A(d,f,p.view,q),k|=m.StateFlags.HIGHLIGHT_ACTIVE)}d.state.set(f,k);d.lodLevel.set(f,l)}else k=h&~(m.StateFlags.ACTIVE|m.StateFlags.HIGHLIGHT_ACTIVE|
m.StateFlags.TRANSFORM_CHANGED),d.state.set(f,k);l=!!(h&m.StateFlags.ACTIVE);k=!!(k&m.StateFlags.ACTIVE);!l&&k?this._octree.addInstance(f):l&&!k?this._octree.removeInstance(f):l&&k&&h&m.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(f),this._octree.addInstance(f));f=(f+1)%e}else f=(f+1)%e,b++}this._instanceIndex=f;this._renderInstanceData.forEach(function(a){a.endUpdate()});this._highlightRenderInstanceData.forEach(function(a){a.endUpdate()})};a.prototype.startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;
this._renderInstanceData.forEach(function(a){a.startUpdateCylce()});this._highlightRenderInstanceData.forEach(function(a){a.startUpdateCylce()})};a.prototype.resetUpdateCycle=function(){this._updateCyclesWithStaticCamera=-1};a.prototype.requestFullCycle=function(){this._needFullCycle=!0};a.prototype.renderLevel=function(a,b,c,d,e){var f=this;e.components.forEach(function(e){f.renderComponent(a,b,c,d,e)})};a.prototype.renderComponent=function(a,b,c,d,f){var g=f.glMaterials[a.pass];if(g&&g.beginSlot(b)&&
g.isVisible&&0!==d.size){var k=a.rctx,l=k.capabilities.instancing,m=g.getDrawMode(k);c.origin=[0,0,0];b===h.STENCIL_MATERIAL&&(a.stencilRenderingHelper.enabled=!0,a.stencilRenderingHelper.prepareStencilWritePass());g.bind(k,c);k.bindVAO(f.vao);b=g.getProgram();t.assertCompatibleVertexAttributeLocations(f.vao,b);a.isHighlightPass&&(k.bindTexture(a.offscreenRenderingHelper?a.offscreenRenderingHelper.depthTexture:null,5),b.setUniform1i("depthTex",5),b.setUniform4f("highlightViewportPixelSz",0,0,1/c.viewport[2],
1/c.viewport[3]));g.bindView(k,c);a=d.capacity;b=d.headIndex;var p=d.tailIndex,q=d.firstIndex,r=this._glInstanceBufferLayout,n=function(a,b){t.bindVertexBufferLayout(k,e.Default3D,d.buffer,r,a);l.drawArraysInstanced(m,0,f.vertexCount,b-a);t.unbindVertexBufferLayout(k,e.Default3D,d.buffer,r)};f.material.getParams().transparent&&null!=q?b>p?(z(q>=p&&q<=b,"invalid firstIndex"),n(q,b),n(p,q)):b<p&&(q<=b?(z(0<=q&&q<=b,"invalid firstIndex"),n(q,b),n(p,a),n(0,q)):(z(q>=p&&q<=a,"invalid firstIndex"),n(q,
a),n(0,b),n(p,q))):b>p?n(p,b):b<p&&(n(0,b),n(p,a));k.bindVAO(null);g.release(k,c)}};return a}();g.LodRenderer=n;g.lodRenderers=[];var D=f.vec3d.create(),C=f.vec4d.create(),G=f.mat3d.create(),E=f.vec3d.create(),F=f.vec3d.create(),I=f.mat4d.identity()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("require exports ../../../../../core/tsSupport/extendsHelper ../../../lib/gl-matrix ../../../support/Evented ../../../support/buffer/BufferView ../../../../webgl/Util".split(" "),
function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});var e=l.assert,h;(function(a){a[a.ALLOCATED=1]="ALLOCATED";a[a.ACTIVE=2]="ACTIVE";a[a.VISIBLE=4]="VISIBLE";a[a.HIGHLIGHT=8]="HIGHLIGHT";a[a.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";a[a.REMOVE=32]="REMOVE";a[a.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED"})(h=g.StateFlags||(g.StateFlags={}));var m=function(){return function(a,c,d){var e=0;this.modelOrigin=new b.BufferViewVec3f64(a,e,d);e+=24;this.model=new b.BufferViewMat3f(a,e,d);
e+=36;this.modelNormal=new b.BufferViewMat3f(a,e,d);e+=36;this.modelScaleFactor=new b.BufferViewFloat(a,e,d);e+=4;this.boundingSphere=new b.BufferViewVec4f(a,e,d);e+=16;0<=c.indexOf("color")&&(this.color=new b.BufferViewVec4f(a,e,d),e+=16);0<=c.indexOf("featureAttribute")&&(this.featureAttribute=new b.BufferViewVec4f(a,e,d),e+=16);this.state=new b.BufferViewUint8(a,e,d);this.lodLevel=new b.BufferViewUint8(a,e+1,d)}}();g.View=m;n=function(b){function f(a){var c=b.call(this)||this;c._capacity=0;c._size=
0;c._next=0;c._optionalFields=a;c._elementSize=f.BASE_ELEMENT_SIZE;0<=c._optionalFields.indexOf("color")&&(c._elementSize+=16);0<=c._optionalFields.indexOf("featureAttribute")&&(c._elementSize+=16);return c}c(f,b);Object.defineProperty(f.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"size",{get:function(){return this._size},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});f.prototype.addInstance=function(){this._size+1>this._capacity&&this.grow();var a=this.findSlot();this._view.state.set(a,h.ALLOCATED);this._size++;this.emit("instance-added",{index:a});return a};f.prototype.removeInstance=function(a){var b=this._view.state;
e(0<=a&&a<this._capacity&&b.get(a)&h.ALLOCATED,"invalid instance handle");this.getStateFlag(a,h.ACTIVE)?this.setStateFlags(a,h.REMOVE):this.notifyRemoved(a)};f.prototype.notifyRemoved=function(a){var b=this._view.state;e(0<=a&&a<this._capacity&&b.get(a)&h.ALLOCATED,"invalid instance handle");b.set(a,0);this._size--;this.emit("instance-removed",{index:a})};f.prototype.setTransform=function(b,c){var d=this._view,e=q,f=p;a.vec3d.set3(c[12],c[13],c[14],e);d.modelOrigin.setVec(b,e);a.mat4d.toMat3(c,f);
d.model.setMat(b,f);d.modelScaleFactor.set(b,a.mat4d.maxScale(c));a.mat3d.inverse(f,f);a.mat3d.transpose(f,f);d.modelNormal.setMat(b,f);this.setStateFlags(b,h.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:b})};f.prototype.getTransform=function(a,b){var c=this._view;c.model.getMat(a,p);c.modelOrigin.getVec(a,q);b[0]=p[0];b[1]=p[1];b[2]=p[2];b[3]=0;b[4]=p[3];b[5]=p[4];b[6]=p[5];b[7]=0;b[8]=p[6];b[9]=p[7];b[10]=p[8];b[11]=0;b[12]=q[0];b[13]=q[1];b[14]=q[2];b[15]=0};f.prototype.setTranslation=
function(a,b){this._view.modelOrigin.setVec(a,b);this.emit("instance-transform-changed",{index:a})};f.prototype.getTranslation=function(a,b){this._view.modelOrigin.getVec(a,b)};f.prototype.getModel=function(a,b){this._view.model.getMat(a,b)};f.prototype.getScaleFactor=function(a){return this._view.modelScaleFactor.get(a)};f.prototype.setFeatureAttribute=function(a,b){this._view.featureAttribute.setVec(a,b)};f.prototype.setColor=function(a,b){this._view.color.setVec(a,b)};f.prototype.getColor=function(a,
b){this._view.color.getVec(a,b)};f.prototype.getFeatureAttribute=function(a,b){this._view.featureAttribute.getVec(a,b)};f.prototype.setVisible=function(a,b){b!==this.getVisible(a)&&(this.setStateFlag(a,h.VISIBLE,b),this.emit("instance-visibility-changed",{index:a}))};f.prototype.getVisible=function(a){return this.getStateFlag(a,h.VISIBLE)};f.prototype.setHighlight=function(a,b){b!==this.getHighlight(a)&&(this.setStateFlag(a,h.HIGHLIGHT,b),this.emit("instance-highlight-changed",{index:a}))};f.prototype.getHighlight=
function(a){return this.getStateFlag(a,h.HIGHLIGHT)};f.prototype.getState=function(a){return this._view.state.get(a)};f.prototype.getLodLevel=function(a){return this._view.lodLevel.get(a)};f.prototype.countFlags=function(a){for(var b=0,c=0;c<this._capacity;++c)this.getState(c)&a&&++b;return b};f.prototype.setStateFlags=function(a,b){var c=this._view.state;b|=c.get(a);c.set(a,b)};f.prototype.clearStateFlags=function(a,b){var c=this._view.state;b=c.get(a)&~b;c.set(a,b)};f.prototype.setStateFlag=function(a,
b,c){c?this.setStateFlags(a,b):this.clearStateFlags(a,b)};f.prototype.getStateFlag=function(a,b){return!!(this._view.state.get(a)&b)};f.prototype.grow=function(){var a=Math.max(k,Math.floor(this._capacity*d)),b=new ArrayBuffer(a*this.elementSize);if(this._buffer){var c=new Uint8Array(this._buffer);(new Uint8Array(b)).set(c)}this._capacity=a;this._buffer=b;this._view=new m(this._buffer,this._optionalFields,this.elementSize)};f.prototype.findSlot=function(){for(var a=this._view.state,b=this._next;a.get(b)&
h.ALLOCATED;)b=(b+1)%this._capacity;this._next=(b+1)%this._capacity;return b};f.BASE_ELEMENT_SIZE=120;return f}(f.Evented);g.InstanceData=n;var k=1024,d=2,q=a.vec3d.create(),p=a.mat3d.create()})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define(["require","exports","../../../../../core/tsSupport/extendsHelper","../../../lib/gl-matrix","../Octree"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function f(c,f){var e=b.call(this,[0,0,
0],1,{getCenter:function(a){var b=e._instanceData.view.boundingSphere,c=e._tmpCenter;c[0]=b.get(a,0);c[1]=b.get(a,1);c[2]=b.get(a,2);return c},getRadius:function(a){return e._instanceData.view.boundingSphere.get(a,3)}},{maximumDepth:25})||this;e._instanceData=c;e._boundingSphere=f;e._tmpCenter=a.vec3d.create();e._tmpTranslation=a.vec3d.create();e._tmpModel=a.mat3d.create();return e}c(f,b);f.prototype.addInstance=function(b){var c=this._instanceData.view.boundingSphere,e=this._tmpCenter;this._instanceData.getModel(b,
this._tmpModel);a.mat3d.multiplyVec3(this._tmpModel,this._boundingSphere.center,e);this._instanceData.getTranslation(b,this._tmpTranslation);a.vec3d.add(e,this._tmpTranslation);var f=this._boundingSphere.radius*this._instanceData.getScaleFactor(b);c.set(b,0,e[0]);c.set(b,1,e[1]);c.set(b,2,e[2]);c.set(b,3,f);this.add(b)};f.prototype.removeInstance=function(a){this.remove(a)};return f}(f);g.InstanceOctree=n})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["require",
"exports","../Camera"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a,b){this._camera=new c;this._worldSpaceRadius=a;this._thresholds=b.map(function(a){return a})}a.prototype.updateCamera=function(a){this._camera.copyFrom(a)};a.prototype.selectLevel=function(a,b){a=this._camera.computePixelSizeAt(a);b=this._worldSpaceRadius*b/a;a=this._thresholds;for(var c=-1,e=0;e<a.length;++e)b>=a[e]&&(c=e);return c};return a}();g.LevelSelector=n})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define(["require",
"exports","../../../support/buffer/BufferView","./BackedBufferObject","../../../../webgl/Util"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b=f.assert,l=function(){return function(a,b,d){var e=0;this.modelOriginHi=new c.BufferViewVec3f(a,e,d);e+=12;this.modelOriginLo=new c.BufferViewVec3f(a,e,d);e+=12;this.model=new c.BufferViewMat3f(a,e,d);e+=36;this.modelNormal=new c.BufferViewMat3f(a,e,d);e+=36;0<=b.indexOf("color")&&(this.color=new c.BufferViewVec4f(a,e,d),e+=16);
0<=b.indexOf("featureAttribute")&&(this.featureAttribute=new c.BufferViewVec4f(a,e,d),e+=16)}}();g.View=l;n=function(){function c(a,b,c){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=a;this._optionalFields=b;this._elementSize=c.stride;this._capacity=1}c.prototype.destroy=function(){this._buffer&&this._buffer.destroy()};Object.defineProperty(c.prototype,"buffer",{get:function(){return this._buffer.buffer},enumerable:!0,
configurable:!0});Object.defineProperty(c.prototype,"view",{get:function(){return this._view},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"size",{get:function(){var a=this._headIndex,b=this._tailIndex;return a>=b?a-b:a+this._capacity-b},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isEmpty",{get:function(){return this._headIndex===this._tailIndex},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"isFull",{get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"headIndex",{get:function(){return this._headIndex},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"tailIndex",{get:function(){return this._tailIndex},enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"firstIndex",{get:function(){return this._firstIndex},
enumerable:!0,configurable:!0});Object.defineProperty(c.prototype,"memoryUsage",{get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}},enumerable:!0,configurable:!0});c.prototype.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};c.prototype.startUpdateCylce=function(){this._captureFirstIndex=!0};c.prototype.beginUpdate=function(){b(!this._updating,"already updating");this._updating=!0;this._prevHeadIndex=this._headIndex};c.prototype.endUpdate=function(){b(this._updating,
"not updating");this.size<m*this.capacity&&this.shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this.transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};c.prototype.allocateHead=function(){b(this._updating,"not updating");this.isFull&&this.grow();var a=this.headIndex;this._captureFirstIndex&&(this._firstIndex=a,this._captureFirstIndex=!1);this.incrementHead();b(this._headIndex!==this._tailIndex,"invalid pointers");return a};c.prototype.freeTail=function(){b(this._updating,
"not updating");b(0<this.size,"invalid size");var a=this._tailIndex===this._firstIndex;this.incrementTail();a&&(this._firstIndex=this._tailIndex)};c.prototype.grow=function(){this.resize(Math.max(e,Math.floor(this._capacity*h)))};c.prototype.shrink=function(){d&&this.resize(Math.max(e,Math.floor(this._capacity*k)))};c.prototype.resize=function(c){b(this._updating,"not updating");if(c!==this._capacity){var d=new a(this._rctx,34962,35044,this._elementSize,c);if(this._buffer){this._firstIndex&&(this._firstIndex=
(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);var e=this.size,f=this.compactInstances(d);b(f===e,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=f;this._prevHeadIndex=0}this._resized=!0;this._capacity=c;this._buffer=d;this._view=new l(this._buffer.array,this._optionalFields,this._elementSize)}};c.prototype.compactInstances=function(a){var b=this._headIndex,c=this._tailIndex;return c<b?(this._buffer.copyRange(c,b,a),b-c):c>b?(this._buffer.copyRange(c,
this._capacity,a),0<b&&this._buffer.copyRange(0,b,a,this._capacity-c),b+(this._capacity-c)):0};c.prototype.incrementHead=function(a){void 0===a&&(a=1);this._headIndex=(this._headIndex+a)%this._capacity};c.prototype.incrementTail=function(a){void 0===a&&(a=1);this._tailIndex=(this._tailIndex+a)%this._capacity};c.prototype.transferRange=function(a,b){a<b?this._buffer.transferRange(a,b):a>b&&(0<b&&this._buffer.transferRange(0,b),this._buffer.transferRange(a,this._capacity))};return c}();g.RenderInstanceData=
n;var e=1024,h=2,m=.3,k=.5,d=!0})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["require","exports","../../../../webgl/BufferObject"],function(n,g,c){return function(){function a(a,b,g,e,h){this._elementSize=e;this._buffer=new c(a,b,g);this.resize(h)}a.prototype.destroy=function(){this._buffer.dispose()};Object.defineProperty(a.prototype,"elementSize",{get:function(){return this._elementSize},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,
"capacity",{get:function(){return this._capacity},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"array",{get:function(){return this._array},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"buffer",{get:function(){return this._buffer},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"memoryUsage",{get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}},enumerable:!0,configurable:!0});a.prototype.copyRange=
function(a,b,c,e){void 0===e&&(e=0);a=new Uint8Array(this.array,a*this.elementSize,(b-a)*this.elementSize);(new Uint8Array(c.array,e*this.elementSize)).set(a)};a.prototype.transferAll=function(){this._buffer.setData(this._array)};a.prototype.transferRange=function(a,b){a*=this._elementSize;this._buffer.setSubData(this._array,a,a,b*this._elementSize)};a.prototype.resize=function(a){var b=a*this._elementSize,c=new ArrayBuffer(b);this._array&&(a>=this._capacity?(new Uint8Array(c)).set(new Uint8Array(this._array)):
(new Uint8Array(c)).set((new Uint8Array(this._array)).subarray(0,a*this._elementSize)));this._array=c;this._buffer.setData(b);this._capacity=a};return a}()})},"esri/views/3d/webgl-engine/lib/lodRendering/utils":function(){define(["require","exports","../doublePrecisionUtils","../RenderPass"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});g.acquireGLMaterials=function(b,c){var e={};e[a.MATERIAL]=c.aquire(b);e[a.MATERIAL_DEPTH_SHADOWMAP]=c.aquireDepthShadowMap(b);e[a.MATERIAL_NORMAL]=
c.aquireNormal(b);e[a.MATERIAL_DEPTH]=c.aquireDepth(b);e[a.MATERIAL_HIGHLIGHT]=c.aquireHighlight(b);return e};g.releaseGLMaterials=function(a,b){b.release(a.id);b.releaseDepthShadowMap(a.id);b.releaseNormal(a.id);b.releaseDepth(a.id);b.releaseHighlight(a.id)};g.encodeDoubleVec3=function(a,e,g,m,k){f[0]=a.get(e,0);f[1]=a.get(e,1);f[2]=a.get(e,2);c.encodeDoubleArray(f,b,3);g.set(k,0,b[0]);m.set(k,0,b[1]);g.set(k,1,b[2]);m.set(k,1,b[3]);g.set(k,2,b[4]);m.set(k,2,b[5])};var f=new Float64Array(3),b=new Float32Array(6)})},
"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../geometry/Point ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../lib/gl-matrix ../../support/projectionUtils ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Util ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u){function t(a,c,d,e){a=a.stageObject;for(var f=a.getGeometryRecords(),g=f.length,h="absolute-height"!==c.mode,k=0,l=0;l<g;l++){var m=f[l].geometry,p=[f[l].transformation[12],f[l].transformation[13],f[l].transformation[14]],q=m.data.getVertexAttr(),r=q[A.POSITION].data,t=q.zOffset.data,q=q.mapPos.data,n=q.length/3;v(r.length/3===n*D+2,"unexpected tube geometry");var u=0,Q=0;x.spatialReference=d.spatialReference;for(var L=0,C=0;C<n;C++){x.x=q[3*C];x.y=q[3*C+
1];x.z=q[3*C+2];var E=b.computeElevation(d,x,c,e,h?B:null);h&&(L+=B.terrainElevation);var F=D;0!==C&&C!==n-1||F++;for(var G=0;G<F;G++)z[0]=r[u]+p[0],z[1]=r[u+1]+p[1],z[2]=r[u+2]+p[2],e.setAltitude(E+t[Q],z),r[u]=z[0]-p[0],r[u+1]=z[1]-p[1],r[u+2]=z[2]-p[2],u+=3,Q+=1;m.invalidateBoundingInfo()}a.geometryVertexAttrsUpdated(l);k+=L/n}return k/g}var v=r.assert;n=function(a){function g(){return null!==a&&a.apply(this,arguments)||this}c(g,a);g.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=
e.validateSymbolLayerSize(this._getSymbolSize());if(a){this._logWarning(a);this.reject();return}}var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),c=h.vec3d.create(b),b=b[3],c={diffuse:c,ambient:c,opacity:b,transparent:1>b||this._isPropertyDriven("opacity"),vertexColors:this._isPropertyDriven("color")||this._isPropertyDriven("opacity"),slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new u(c,a+"_3dlinemat");this._context.stage.add(k.ModelContentType.MATERIAL,this._material);
this.resolve()};g.prototype.destroy=function(){a.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(k.ModelContentType.MATERIAL,this._material.id),this._material=null)};g.prototype.createGraphics3DGraphic=function(a){var b=a.graphic;if("polyline"!==b.geometry.type)return this._logWarning("unsupported geometry type for path symbol: "+b.geometry.type),null;if(!this._validateGeometry(b.geometry))return null;var c="graphic"+b.uid,d=this.getGraphicElevationContext(b);
return this._createAs3DShape(b,a.renderingInfo,d,c,b.uid)};g.prototype.layerPropertyChanged=function(a,c,d){if("opacity"===a)return c=this._getMaterialOpacity(),d=1>c||this._isPropertyDriven("opacity"),this._material.setParameterValues({opacity:c,transparent:d}),!0;if("elevationInfo"===a){this._updateElevationContext();for(var e in c){var f=c[e];if(a=d(f))f=this.getGraphicElevationContext(f.graphic),a.needsElevationUpdates=b.needsElevationUpdates3D(f.mode),a.elevationContext.set(f)}return!0}return!1};
Object.defineProperty(g.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});g.prototype._getPathSize=function(a){a=a.size&&this._isPropertyDriven("size")?b.getSingleSizeDriver(a.size):this._getSymbolSize();return a/=this._context.renderCoordsHelper.unitInMeters};g.prototype._getSymbolSize=function(){return this.symbol.size||1};g.prototype._createAs3DShape=function(a,c,e,g,k){var l=a.geometry,r=l.paths;a=[];var n=[],u=[],v=h.vec3d.create(),x=this._context.renderSpatialReference===
m.SphericalECEFSpatialReference,A=Array(6),z=this._getPathSize(c),l=b.getGeometryVertexData3D(r,l.hasZ,l.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,e);this._logGeometryCreationWarnings(l,r,"paths","PathSymbol3DLayer");if(0<r.length){for(var r=l.geometryData.outlines,B=l.eleVertexData,Q=l.vertexData,L=0;L<r.length;++L){var C=r[L];if(!(1>=C.count)){var G=C.index,E=C.count;if(this._context.clippingExtent&&(b.computeBoundingBox(B,
G,E,A),b.boundingBoxClipped(A,this._context.clippingExtent)))continue;b.chooseOrigin(Q,G,E,v);b.subtractCoordinates(Q,G,E,v);C=new Float64Array(B.buffer,3*G*B.BYTES_PER_ELEMENT,3*E);G=b.flatArrayToArrayOfArrays(Q,G,E);G=q.createTubeGeometry(G,.5*z,D,x,v);G.getVertexAttr().mapPos={size:3,data:C,offsetIdx:0,strideIdx:3};this._material.getParams().vertexColors&&(C=this._getVertexOpacityAndColor(c),G=q.addVertexColors(G,C));C=new d(G,g+"path"+L);C.singleUse=!0;a.push(C);n.push([this._material]);C=h.mat4d.identity();
h.mat4d.translate(C,v,C);u.push(C)}}if(0<a.length)return c=new p({geometries:a,materials:n,transformations:u,castShadow:!0,metadata:{layerUid:this._context.layer.uid,graphicUid:k},idHint:g}),c=new f(this,c,a,null,null,t,e),c.alignedTerrainElevation=l.terrainElevation,c.needsElevationUpdates=b.needsElevationUpdates3D(e.mode),c}return null};return g}(l);var A=r.VertexAttrConstants,z=h.vec3d.create(),x=new a,B={verticalDistanceToGround:0,terrainElevation:0},D=10;return n})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../core/libs/earcut/earcut ../../../../geometry/Polygon ../../../../geometry/support/aaBoundingBox ./ElevationAligners ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ../../lib/gl-matrix ../../webgl-engine/Stage ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryData ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Util ../../webgl-engine/materials/ColorMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D){n=function(g){function q(){var a=null!==g&&g.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};return a}c(q,g);q.prototype._prepareResources=function(){this._prepareFillResources();this._prepareOutlineResources();this.resolve()};q.prototype._prepareFillResources=function(){var a=this._getStageIdHint(),b=this._getMaterialOpacityAndColor(),b={color:b,transparent:1>b[3]||this._isPropertyDriven("opacity"),
polygonOffset:!1,vertexColors:!0,slicePlaneEnabled:this._context.slicePlaneEnabled};this._material=new D(b,a+"_colormat");this._context.stage.add(t.ModelContentType.MATERIAL,this._material)};q.prototype._prepareOutlineResources=function(){var a=this.symbol.outline;if(this._hasOutline=!!(a&&a.size&&0<a.size&&a.color))a={idHint:this._getStageIdHint()+"_outline",color:this._getOutlineColor(),width:f.pt2px(a.size),slicePlaneEnabled:this._context.slicePlaneEnabled},this._outlineMaterial=1.5<=a.width?r.createRibbonMaterial(a):
r.createNativeMaterial(a),this._context.stage.add(t.ModelContentType.MATERIAL,this._outlineMaterial)};q.prototype.destroy=function(){g.prototype.destroy.call(this);this.isFulfilled()||this.reject();this._material&&(this._context.stage.remove(t.ModelContentType.MATERIAL,this._material.id),this._material=null);this._outlineMaterial&&(this._context.stage.remove(t.ModelContentType.MATERIAL,this._outlineMaterial.id),this._outlineMaterial=null)};q.prototype.createGraphics3DGraphic=function(a){var b=a.graphic,
c=b.geometry.type;if("polyline"!==c&&"polygon"!==c&&"extent"!==c)return this._logWarning("unsupported geometry type for fill symbol: "+c),null;if(!this._validateGeometry(b.geometry))return null;c="graphic"+b.uid;a=this._getVertexOpacityAndColor(a.renderingInfo,Uint8Array,255);var d=this.getGraphicElevationContext(b);return"on-the-ground"===d.mode?this._createAsOverlay(b,a,d,c):this._createAs3DShape(b,a,d,c,b.uid)};q.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)return b=this._material.getColor(),
c=this._getMaterialOpacity(),this._material.setColor([b[0],b[1],b[2],c]),this._material.setTransparent(1>c||this._isPropertyDriven("opacity")),this._outlineMaterial&&(b=this._outlineMaterial.getColor(),this._outlineMaterial.setColor([b[0],b[1],b[2],this._getOutlineOpacity()])),!0;if("elevationInfo"===a){a=this._elevationContext.mode;this._updateElevationContext();var e=this._elevationContext.mode;if(null==a||null==e)return!1;if("on-the-ground"===a&&"on-the-ground"===e)return!0;if(a!==e&&("on-the-ground"===
a||"on-the-ground"===e))return!1;a=d.needsElevationUpdates2D(e);for(var f in b){var g=b[f];(e=c(g))&&"object3d"===e.type&&(g=g.graphic,e.needsElevationUpdates=a,e.elevationContext.set(this.getGraphicElevationContext(g)))}return!0}return!1};q.prototype.setDrawOrder=function(a,b,c){this.updateSymbolLayerOrder(a,b);this._material&&(this._material.renderPriority=a+b/2,c.add(this._material.id));this._outlineMaterial&&(this._outlineMaterial.renderPriority=a,c.add(this._outlineMaterial.id))};q.prototype._createAs3DShape=
function(a,b,c,e,f){var g=this._getPolyGeometry(a);a=g.rings;var l=this._getOutlineGeometry(g,a),g=d.getGeometryVertexData3D(l,g.hasZ,g.spatialReference,this._context.renderSpatialReference,this._context.elevationProvider,this._context.renderCoordsHelper,c);F.idHint=e;F.color=b;F.data=g;var m;this._hasOutline&&(m=new g.vertexData.constructor(g.vertexData));F.outNum=0;F.outGeometries=[];F.outTransforms=[];F.outMaterials=[];this._createAs3DShapeFill(F);F.data.vertexData=m;this._createAs3DShapeOutline(F);
this._logGeometryCreationWarnings(F.data,a,"rings","FillSymbol3DLayer");if(0===F.outNum)return null;b=new z({geometries:F.outGeometries,materials:F.outMaterials,transformations:F.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:f},idHint:e});b=new k(this,b,F.outGeometries,null,null,h.perVertexElevationAligner,c);b.alignedTerrainElevation=g.terrainElevation;b.needsElevationUpdates=d.needsElevationUpdates2D(c.mode);return b};q.prototype._createAs3DShapeFill=function(a){for(var c=
a.data.geometryData.polygons,e=a.data.eleVertexData,f=a.data.vertexData,g=function(g){var k=c[g];g=k.count;var l=k.index;if(h._context.clippingExtent&&(d.computeBoundingBox(e,l,g,C),d.boundingBoxClipped(C,h._context.clippingExtent)))return"continue";var m=new Float64Array(e.buffer,3*l*e.BYTES_PER_ELEMENT,3*g),p=new Float64Array(f.buffer,3*l*f.BYTES_PER_ELEMENT,3*g),k=k.holeIndices.map(function(a){return a-l}),k=b(m,k,3);if(0===k.length)return"continue";d.chooseOrigin(f,l,g,G);d.subtractCoordinates(f,
l,g,G);g=h._createFillGeometry(k,0,p,m,a.color);g=new v(g,a.idHint);g.singleUse=!0;m=u.mat4d.identity();u.mat4d.translate(m,G,m);a.outGeometries.push(g);a.outMaterials.push([h._material]);a.outTransforms.push(m);a.outNum++},h=this,k=0;k<c.length;++k)g(k)};q.prototype._createAs3DShapeOutline=function(a){if(this._hasOutline)for(var b=a.data.geometryData.outlines,c=a.data.eleVertexData,e=a.data.vertexData,f=0;f<b.length;++f){var g=b[f],h=g.index,k=g.count;if(this._context.clippingExtent&&(d.computeBoundingBox(c,
h,k,C),d.boundingBoxClipped(C,this._context.clippingExtent)))continue;d.chooseOrigin(e,h,k,G);d.subtractCoordinates(e,h,k,G);g=new Float64Array(c.buffer,3*h*c.BYTES_PER_ELEMENT,3*k);h=new Float64Array(e.buffer,3*h*e.BYTES_PER_ELEMENT,3*k);h=r.createPolylineGeometry(h,g,a.isRings,E,0);h=new v(h,a.idHint+"outline"+f);h.singleUse=!0;g=u.mat4d.identity();u.mat4d.translate(g,G,g);a.outGeometries.push(h);a.outMaterials.push([this._outlineMaterial]);a.outTransforms.push(g);a.outNum++}};q.prototype._createAsOverlay=
function(a,b,c,f){c=this._getPolyGeometry(a);a=c.rings;var g=this._getOutlineGeometry(c,a);this._material.renderPriority=this._symbolLayerOrder+this._symbolLayerOrderDelta/2;this._hasOutline&&(this._outlineMaterial.renderPriority=this._symbolLayerOrder);c=d.getGeometryVertexDataDraped(g,c.spatialReference,this._context.overlaySR);F.idHint=f;F.color=b;F.data=c;var h;this._hasOutline&&(h=new c.vertexData.constructor(c.vertexData));F.outNum=0;F.outGeometries=[];F.outBoundingBox=e.empty();this._createAsOverlayFill(F);
F.data.vertexData=h;this._createAsOverlayOutline(F);this._logGeometryCreationWarnings(F.data,a,"rings","FillSymbol3DLayer");return 0<F.outNum?new m(this,F.outGeometries,F.outBoundingBox):null};q.prototype._createAsOverlayFill=function(a){for(var c=a.data.vertexData,f=a.data.geometryData.polygons,g=function(g){var k=f[g];g=k.count;var l=k.index,m=new Float64Array(c.buffer,3*l*c.BYTES_PER_ELEMENT,3*g),k=k.holeIndices.map(function(a){return a-l}),m=b(m,k,3);if(0===m.length)return"continue";d.computeBoundingBox(c,
l,g,C);if(d.boundingBoxClipped(C,h._context.clippingExtent))return"continue";e.expand(a.outBoundingBox,C);d.chooseOrigin(c,l,g,G);d.subtractCoordinates(c,l,g,G);d.setZ(c,l,g,h._getDrapedZ());g=u.mat4d.identity();u.mat4d.translate(g,G,g);m=h._createFillGeometry(m,l,c,null,a.color);k=new x(m);k.material=h._material;var p=C;k.center=[.5*(p[0]+p[3]),.5*(p[1]+p[4]),0];k.bsRadius=.5*Math.sqrt((p[3]-p[0])*(p[3]-p[0])+(p[4]-p[1])*(p[4]-p[1]));k.transformation=g;k.name=a.idHint;k.uniqueName=a.idHint+"#"+m.id;
a.outGeometries.push(k);a.outNum++},h=this,k=0;k<f.length;++k)g(k)};q.prototype._createAsOverlayOutline=function(a){if(this._hasOutline)for(var b=a.data.vertexData,c=a.data.geometryData.outlines,f=0;f<c.length;++f){var g=c[f],h=g.index,g=g.count;d.computeBoundingBox(b,h,g,C);if(!d.boundingBoxClipped(C,this._context.clippingExtent)){e.expand(a.outBoundingBox,C);d.chooseOrigin(b,h,g,G);d.subtractCoordinates(b,h,g,G);d.setZ(b,h,g,this._getDrapedZ());g=new Float64Array(b.buffer,3*h*b.BYTES_PER_ELEMENT,
3*g);h=u.mat4d.identity();u.mat4d.translate(h,G,h);var g=r.createPolylineGeometry(g,null,!0,E,0),k=new x(g);k.material=this._outlineMaterial;var l=C;k.center=[.5*(l[0]+l[3]),.5*(l[1]+l[4]),0];k.bsRadius=.5*Math.sqrt((l[3]-l[0])*(l[3]-l[0])+(l[4]-l[1])*(l[4]-l[1]));k.transformation=h;k.name=a.idHint+"outline";k.uniqueName=a.idHint+"outline#"+g.id;a.outGeometries.push(k);a.outNum++}}};q.prototype._getOutlineGeometry=function(a,b){return b};q.prototype._getOutlineOpacity=function(){return this._getLayerOpacity()*
this.symbol.outline.color.a};q.prototype._getOutlineColor=function(){var b=this.symbol.outline.color,c=this._getOutlineOpacity();return p.mixinColorAndOpacity(a.toUnitRGB(b),c)};q.prototype._getPolyGeometry=function(a){a=a.geometry;return"extent"===a.type?l.fromExtent(a):a};q.prototype._createFillGeometry=function(a,b,c,d,e){for(var f=a.length,g=new Uint32Array(f),h=new Uint32Array(f),k=0;k<f;k++)g[k]=a[k]+b,h[k]=0;a={};b={};a[B.VertexAttrConstants.POSITION]=g;a[B.VertexAttrConstants.COLOR]=h;b[B.VertexAttrConstants.POSITION]=
{size:3,data:c};b[B.VertexAttrConstants.COLOR]={size:4,data:e};d&&(b.mapPos={size:3,data:d},a.mapPos=g);return new A(b,a)};Object.defineProperty(q.prototype,"numberOfVertices",{get:function(){return 0},enumerable:!0,configurable:!0});return q}(q);var C=e.create(),G=u.vec3d.create(),E=new Float32Array([255,255,255,255]),F={idHint:null,color:null,data:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};return n})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../support/buffer/InterleavedLayout ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ./internal/bufferWriters ./internal/MaterialUtil ../shaders/ColorPrograms".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k){n=function(a){function b(b,c){c=a.call(this,c)||this;c.supportsEdges=!0;c.bufferWriter=new u;c.params=m.copyParameters(b,p);return c}c(b,a);b.prototype.getParams=function(){return this.params};b.prototype.getParameterValues=function(){return m.copyParameters(this.params)};b.prototype.setColor=function(a){this.params.color=a;this.notifyDirty("matChanged")};b.prototype.getColor=function(){return this.params.color};b.prototype.setTransparent=function(a){this.params.transparent=
a;this.notifyDirty("matChanged")};b.prototype.getTransparent=function(){return this.params.transparent};b.prototype.intersect=function(a,b,c,d,e,f,g,h){m.intersectTriangleGeometry(a,b,c,d,e,f,g)};b.prototype.getGLMaterials=function(){return{color:d,depthShadowMap:void 0,normal:void 0,depth:void 0,highlight:q}};b.prototype.getAllTextureIds=function(){return[]};return b}(b);var d=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}c(b,a);b.prototype.updateParameters=
function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(k.colorPass,{vertexColors:this.params.vertexColors,slice:this.params.slicePlaneEnabled})};b.prototype.beginSlot=function(a){return a===(1>this.params.color[3]?l.TRANSPARENT_MATERIAL:l.OPAQUE_MATERIAL)};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",
c.color);a.setFaceCullingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1));c.transparent&&(a.setBlendingEnabled(!0),a.setBlendFunctionSeparate(770,771,1,771));a.setDepthTestEnabled(!0)};b.prototype.release=function(a){var b=this.params;a.setPolygonOffsetFillEnabled(!1);b.transparent&&a.setBlendingEnabled(!1)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;m.bindView(b.origin,b.view,a);c.slicePlaneEnabled&&m.bindSlicePlane(b.origin,b.slicePlane,
a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 4};return b}(f),q=function(a){function b(b,c,d){b=a.call(this,b,c)||this;b.updateParameters();return b}c(b,a);b.prototype.updateParameters=function(){this.params=this.material.getParameterValues();this.selectProgram()};b.prototype.selectProgram=function(){this.program=this.programRep.getProgram(k.colorPass,{vertexColors:this.params.vertexColors,slice:this.params.slicePlaneEnabled})};
b.prototype.beginSlot=function(a){return a===l.OPAQUE_MATERIAL};b.prototype.getProgram=function(){return this.program};b.prototype.bind=function(a,b){b=this.program;var c=this.params;a.bindProgram(b);b.setUniform4fv("eColor",c.color);a.setFaceCullingEnabled(!1);c.polygonOffset&&(a.setPolygonOffsetFillEnabled(!0),a.setPolygonOffset(1,1))};b.prototype.release=function(a){a.setPolygonOffsetFillEnabled(!1)};b.prototype.bindView=function(a,b){a=this.program;var c=this.params;m.bindView(b.origin,b.view,
a);c.slicePlaneEnabled&&m.bindSlicePlane(b.origin,b.slicePlane,a)};b.prototype.bindInstance=function(a,b){this.program.setUniformMatrix4fv("model",b.transformation)};b.prototype.getDrawMode=function(a){return 4};return b}(f),p={color:[1,1,1,1],transparent:!1,vertexColors:!1,polygonOffset:!1,slicePlaneEnabled:!1},r=a.newLayout().vec3f(e.VertexAttrConstants.POSITION).vec4u8(e.VertexAttrConstants.COLOR),u=function(){function a(){this.vertexBufferLayout=r}a.prototype.allocate=function(a){return r.createBuffer(a)};
a.prototype.elementCount=function(a){return a.indices[e.VertexAttrConstants.POSITION].length};a.prototype.write=function(a,b,c,d,e){h.writeDefaultAttributes(b,c,r,a.transformation,a.invTranspTransformation,d,e)};return a}();return n})},"esri/views/3d/webgl-engine/shaders/ColorPrograms":function(){define(["require","exports","../lib/DefaultVertexAttributeLocations","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b=function(a){return f.glslifyDefineMap({VERTEX_COLORS:a.vertexColors,
SLICE:a.slice})};g.colorPass={name:"color-color",shaders:function(c){return{vertexShader:b(c)+a.resolveIncludes("materials/color/color.vert"),fragmentShader:b(c)+a.resolveIncludes("materials/color/color.frag")}},attributes:c.Default3D}})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("require exports ../../../../core/tsSupport/extendsHelper ../../../../Color ../../../../core/screenUtils ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolCommonCode ./Graphics3DSymbolLayer ./graphicUtils ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextTexture ../../webgl-engine/materials/HUDMaterial".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r){var u=[1,1,1,1],t=[0,0,1],v={mode:"relative-to-ground",offset:0},A=[0,0,0,1];return function(g){function m(){var a=null!==g&&g.apply(this,arguments)||this;a._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};return a}c(m,g);m.prototype._prepareResources=function(){if(!this._isPropertyDriven("size")){var a=k.validateSymbolLayerSize(this._getTextSize());if(a){this._logWarning(a);this.reject();return}}this._anchor="center";this.resolve()};m.prototype.destroy=
function(){g.prototype.destroy.call(this);this.isFulfilled()||this.reject()};m.prototype.createGraphics3DGraphic=function(a,b,c,d){void 0===b&&(b={});a=a.graphic;var e=h.placePointOnGeometry(a.geometry);if(!e)return this._logWarning("unsupported geometry type for text symbol: "+a.geometry.type),null;var f=b.text||this.symbol.text;if(!f||1>f.length)return null;null!=b.needsOffsetAdjustment&&(this._elevationOptions.needsOffsetAdjustment=b.needsOffsetAdjustment);var g=this.getGraphicElevationContext(a,
b.elevationOffset||0);return this._createAs3DShape(this.symbol,e,f,g,this._context.layer.id+"_label_"+a.uid,a.uid,b,c,d,"polyline"===a.geometry.type)};m.prototype.getGraphicElevationContext=function(a,b){void 0===b&&(b=0);a=g.prototype.getGraphicElevationContext.call(this,a);a.addOffsetRenderUnits(b);return a};m.prototype.layerPropertyChanged=function(a,b,c){if("opacity"===a)this._logWarning("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");else if("elevationInfo"===a){this._updateElevationContext();
if(b)for(var d in b){a=b[d];var e=c(a);e&&this.updateGraphicElevationContext(a.graphic,e)}return!0}return!1};m.prototype.updateGraphicElevationContext=function(a,b){a=this.getGraphicElevationContext(a,b.metadata.elevationOffset);b.elevationContext.set(a);b.needsElevationUpdates=h.needsElevationUpdates2D(a.mode)||"absolute-height"===a.mode};Object.defineProperty(m.prototype,"numberOfVertices",{get:function(){return 6},enumerable:!0,configurable:!0});m.prototype._defaultElevationInfoNoZ=function(){return v};
m.prototype._createAs3DShape=function(c,g,k,m,n,v,x,z,N,H){var B=x.centerOffset||A,D=x.screenOffset||[0,0],C=x.debugDrawBorder||!1,G=x.translation||[0,0,0],F=x.anchor||this._anchor||"center";this._anchor=F;var E=c.material?a.toUnitRGBA(c.material.color):u,P=c.halo&&c.halo.color&&0<c.halo.size,R=P?a.toUnitRGBA(c.halo.color):u,P=P?f.pt2px(c.halo.size):0,Q=this._getTextSize(c),L=new p(k,{size:Q,color:E,font:{family:c.font&&c.font.family?c.font.family:"sans-serif",weight:c.font&&c.font.weight?c.font.weight:
"normal",style:c.font&&c.font.style?c.font.style:"normal"},halo:{size:P,color:R}},n),S;z?S=x:b.isCalloutSupport(this.symbolContainer)&&this.symbolContainer.hasVisibleVerticalOffset()&&(S=this.symbolContainer);c={textureId:N?N.textureId:L.id,texCoordScale:N?[1,1]:L.texcoordScale,occlusionTest:!0,screenOffset:D,anchorPos:F,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:x.centerOffsetUnits,debugDrawBorder:C,drawInSecondSlot:!0};S&&S.verticalOffset&&(S=S.verticalOffset,D=S.minWorldLength,C=S.maxWorldLength,
c.verticalOffset={screenLength:f.pt2px(S.screenLength),minWorldLength:D||0,maxWorldLength:null!=C?C:Infinity});this._context.screenSizePerspectiveEnabled&&(S=this._context.sharedResources,D=S.screenSizePerspectiveSettings,c.screenSizePerspective=S.screenSizePerspectiveSettingsLabels.overridePadding(P),c.screenSizePerspectiveAlignment=D);H&&(c.shaderPolygonOffset=1E-4);c.slicePlaneEnabled=this._context.slicePlaneEnabled;H=null;P=JSON.stringify(c);null!=z?(H=z.getMaterial(P),null==H&&(H=new r(c,n),
z.addMaterial(P,H))):H=new r(c,n);H=[H];B=q.createPointGeometry(t,G,void 0,N?[0,0]:[L.textWidth,L.textHeight],B,N?[0,0]:null);B=[new d(B,n)];n=h.createStageObjectForPoint.call(this,g,B,[H],null,null,m,n,this._context.layer.uid,v,!0);if(null===n)return null;z=new e(this,n.object,B,null==z?H:null,N?null:[L],l.perObjectElevationAligner,m);z.alignedTerrainElevation=n.terrainElevation;z.needsElevationUpdates=h.needsElevationUpdates2D(m.mode)||"absolute-height"===m.mode;z.getScreenSize=function(a){void 0===
a&&(a=Array(2));a[0]=N?L.textWidth:L.width;a[1]=N?L.textHeight:L.height;return a};z.metadata={labelText:k,elevationOffset:x.elevationOffset||0};h.extendPointGraphicElevationContext(z,g,this._context.elevationProvider);return z};m.prototype._getTextSize=function(a){return f.pt2px((a||this.symbol).size)||12};return m}(m)})},"esri/views/3d/webgl-engine/lib/FloatingBoxLocalOriginFactory":function(){define(["require","exports","../../lib/gl-matrix"],function(n,g,c){n=function(){function f(a,c){this._origins=
[];this._boxSize=a;this._maxNumOrigins=c}f.prototype.getOrigin=function(b){for(var g=this._origins.length,e,h=!1,m=Number.MAX_VALUE,k=0;k<g;k++){var d=this._origins[k];c.vec3d.subtract(b,d.vec3,a);a[0]=Math.abs(a[0]);a[1]=Math.abs(a[1]);a[2]=Math.abs(a[2]);var q=a[0]+a[1]+a[2];q<m&&(e=d,m=q,h=a[0]<this._boxSize&&a[1]<this._boxSize&&a[2]<this._boxSize)}h||e&&null!=this._maxNumOrigins&&!(this._origins.length<this._maxNumOrigins)||(g=f.OFFSET,d=[b[0]+g,b[1]+g,b[2]+g],e={vec3:d,id:this.getOriginId(d)},
this._origins.push(e));return e};f.prototype.getOriginId=function(a){return""+f.ORIGIN_PREFIX+a[0]+"/"+a[1]+"/"+a[2]};f.OFFSET=1.11;f.ORIGIN_PREFIX="fb_";return f}();var a=c.vec3d.create();return n})},"esri/views/3d/layers/graphics/Graphics3DElevationAlignment":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect".split(" "),
function(n,g,c,a,f,b,l,e){var h=function(){function a(){this.extents=new b({initialSize:32,allocator:function(){return e.create()}});this.tempExtent=e.create()}Object.defineProperty(a.prototype,"count",{get:function(){return this.extents.length},enumerable:!0,configurable:!0});Object.defineProperty(a.prototype,"area",{get:function(){var a=0;this.extents.forEach(function(b){a+=e.area(b)});return a},enumerable:!0,configurable:!0});a.prototype.clear=function(){this.extents.clear()};a.prototype.add=function(a){this.contains(a)||
(this.removeContained(a),e.set(this.extents.pushNew(),a))};a.prototype.pop=function(){return this.extents.pop()};a.prototype.forEach=function(a){this.extents.forEach(function(b){return a(b)})};a.prototype.mergeAll=function(){for(;1<this.extents.length;){var a=this.extents.length-1;e.expand(this.extents.data[a-1],this.extents.data[a]);this.extents.pop()}};a.prototype.mergeTight=function(){for(var a=this.extents,b=this.tempExtent,c=!1;!c;)for(var c=!0,f=0;f<a.length;++f){for(var g=f,h=a.data[g],l=e.area(h),
m=!1,n=a.length-1;n>g;--n){var z=a.data[n],x=e.area(z);e.expand(h,z,b);z=l+x;.05>(e.area(b)-z)/z&&(e.set(h,b),l=e.area(h),a.swapElements(n,a.length-1),a.pop(),m=!0)}if(m){c=!1;break}}};a.prototype.toArray=function(){return this.extents.toArray()};a.prototype.contains=function(a){return this.extents.some(function(b){return e.contains(b,a)})};a.prototype.removeContained=function(a){for(var b=this.extents.length-1;0<=b;--b)e.contains(a,this.extents.data[b])&&(this.extents.swapElements(b,this.extents.length-
1),this.extents.pop())};return a}();return function(e){function f(){var a=e.call(this)||this;a.dirtyExtents=new h;a.globalDirty=!1;a.dirtyGraphicsQueue=new b;a.elevationUpdateEventHandle=null;a.eventHandles=[];a.updateElevation=!1;a.layerView=null;a.graphicsCore=null;return a}c(f,e);Object.defineProperty(f.prototype,"updating",{get:function(){return this.hasPendingOperations()},enumerable:!0,configurable:!0});f.prototype.setup=function(a,b,c,e){var d=this;this.layerView=a;this.graphicsCore=c;this.elevationProvider=
e;this.queryGraphicUIDsInExtent=b;this.elevationUpdateEventHandle=e.on("elevation-change",function(a){return d.elevationUpdateHandler(a)});this.eventHandles.push(this.layerView.watch("suspended",function(){return d.suspendedChange()}))};f.prototype.destroy=function(){this.dirtyGraphicsQueue=null;this.elevationUpdateEventHandle&&(this.elevationUpdateEventHandle.remove(),this.elevationUpdateEventHandle=null);this.eventHandles.forEach(function(a){return a.remove()});this.queryGraphicUIDsInExtent=this.graphicsCore=
this.layerView=this.eventHandles=null};f.prototype.clear=function(){this.dirtyGraphicsQueue.clear();this.notifyChange("updating")};f.prototype.suspendedChange=function(){!0===this.layerView.suspended?this.updateElevation=!1:!1===this.layerView.suspended&&this.updateElevation&&this.markAllGraphicsElevationDirty()};f.prototype.elevationInfoChange=function(){this.markAllGraphicsElevationDirty()};f.prototype.needsIdleUpdate=function(){return this.hasPendingOperations()};f.prototype.idleUpdate=function(a){var b=
this;this.globalDirty&&(this.markAllGraphicsElevationDirty(),this.globalDirty=!1);for(var c=this.layerView.view,d=this.graphicsCore.stageLayer.id,e=this.graphicsCore.labelsEnabled?c.labeler.labelStageLayerId:null,f=!1;this.hasPendingOperations()&&!a.done();){for(;0<this.dirtyGraphicsQueue.length&&!a.done();){for(var g=Math.min(this.dirtyGraphicsQueue.length,100),h=0;h<g;h++){var k=this.dirtyGraphicsQueue.pop();(k=this.graphicsCore.graphics[k])&&k.alignWithElevation(this.elevationProvider,c.renderCoordsHelper)}c._stage.processDirtyLayer(d);
null!=e&&c._stage.processDirtyLayer(e)}for(;0<this.dirtyExtents.count&&100>this.dirtyGraphicsQueue.length&&!a.done();)f||(this.dirtyExtents.mergeTight(),f=!0),g=this.dirtyExtents.pop(),this.queryGraphicUIDsInExtent(g,this.spatialReference,function(a){var c=b.graphicsCore.graphics[a];c&&c.needsElevationUpdates()&&b.dirtyGraphicsQueue.push(a)})}c.deconflictor.setDirty();c.labeler.setDirty();this.notifyChange("updating")};f.prototype.markAllGraphicsElevationDirty=function(){this.dirtyExtents.clear();
this.dirtyGraphicsQueue.clear();for(var a in this.graphicsCore.graphics)this.dirtyGraphicsQueue.push(+a);this.notifyChange("updating")};f.prototype.hasPendingOperations=function(){return 0<this.dirtyGraphicsQueue.length||0<this.dirtyExtents.count||this.globalDirty};f.prototype.elevationUpdateHandler=function(a){var b=a.extent;this.layerView.suspended?this.updateElevation||(a=this.graphicsCore.computedExtent)&&b[2]>a.xmin&&b[0]<a.xmax&&b[3]>a.ymin&&b[1]<a.ymax&&(this.updateElevation=!0):(-Infinity===
b[0]?this.globalDirty=!0:this.dirtyExtents.add(b),this.spatialReference=a.spatialReference,this.notifyChange("updating"))};a([l.property({readOnly:!0})],f.prototype,"updating",null);return f=a([l.subclass("esri.views.3d.layers.graphics.Graphics3DElevationAlignment")],f)}(l.declared(f))})},"esri/views/3d/layers/graphics/Graphics3DFrustumVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Handles ../../../../core/watchUtils ../../../../core/accessorSupport/decorators ../../support/earthUtils ../../support/FrustumExtentIntersection".split(" "),
function(n,g,c,a,f,b,l,e,h,m){var k=-.3*h.earthRadius;return function(d){function f(){var a=d.call(this)||this;a.suspended=!0;a._frustumVisibilityDirty=!0;a.extent=null;a.extentIntersectionDirty=!0;a._isVisibleBelowSurface=!1;a.handles=new b;a.layerView=null;return a}c(f,d);Object.defineProperty(f.prototype,"frustumVisibilityDirty",{get:function(){return this._frustumVisibilityDirty},set:function(a){a!==this._frustumVisibilityDirty&&(this._frustumVisibilityDirty=a,this.notifyChange("updating"))},
enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updating",{get:function(){return this.frustumVisibilityDirty},enumerable:!0,configurable:!0});f.prototype.setup=function(a){var b=this;this.layerView=a;this.extentIntersection=new m.FrustumExtentIntersection({renderCoordsHelper:a.view.renderCoordsHelper});a=a.view;var c=a.basemapTerrain;this.handles.add([a.on("resize",function(){return b.viewChange()}),a.state.watch("camera",function(){return b.viewChange()},!0),c.on("elevation-bounds-change",
function(){return b.elevationBoundsChange()})]);"local"===a.viewingMode?this.isVisibleBelowSurface=!0:this.handles.add(l.init(c,["opacity","wireframe"],function(){return b.isVisibleBelowSurface=c.isSeeThrough()}))};f.prototype.destroy=function(){this.extentIntersection=this.extent=this.layerView=null;this.handles&&(this.handles.destroy(),this.handles=null)};f.prototype.needsIdleUpdate=function(){return this.frustumVisibilityDirty};f.prototype.setExtent=function(a){this.extent=a;this.frustumVisibilityDirty=
this.extentIntersectionDirty=!0};f.prototype.viewChange=function(){this.frustumVisibilityDirty=!0};f.prototype.elevationBoundsChange=function(){this.extentIntersectionDirty=this.frustumVisibilityDirty=!0};Object.defineProperty(f.prototype,"isVisibleBelowSurface",{set:function(a){this._isVisibleBelowSurface=a;this.extentIntersectionDirty=this.frustumVisibilityDirty=!0},enumerable:!0,configurable:!0});f.prototype.idleUpdate=function(a){!a.done()&&this.frustumVisibilityDirty&&(this.updateSuspendFrustumVisible(),
this.frustumVisibilityDirty=!1)};f.prototype.updateExtentIntersection=function(){if(this.extentIntersectionDirty){this.extentIntersectionDirty=!1;var a=this.layerView.view,b;if(this._isVisibleBelowSurface)b=k;else{b=a.basemapTerrain.getElevationBounds();var c=b[0];b=c-Math.max(1,(b[1]-c)*(1.2-1))}this.extentIntersection.update(this.extent,a.spatialReference,b)}};f.prototype.updateSuspendFrustumVisible=function(){this.extent?(this.updateExtentIntersection(),this._set("suspended",!this.extentIntersection.isVisibleInFrustum(this.layerView.view.frustum))):
this._set("suspended",!1)};a([e.property({readOnly:!0})],f.prototype,"suspended",void 0);a([e.property({readOnly:!0})],f.prototype,"updating",null);return f=a([e.subclass("esri.views.3d.layers.graphics.Graphics3DFrustumVisibility")],f)}(e.declared(f))})},"esri/views/3d/layers/graphics/Graphics3DHighlights":function(){define(["require","exports","./Graphics3DHighlightSet"],function(n,g,c){return function(){function a(){this.graphicsCore=null;this.highlights=[]}a.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});
this.highlights=null};a.prototype.setup=function(a){this.graphicsCore=a};a.prototype.acquireSet=function(a,b){var f=this,e=new c(a,b);this.highlights.push(e);return{set:e,handle:{remove:function(){return f.releaseSet(e)}}}};a.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,1)};a.prototype.setUids=function(a,b){var c=this.graphicsCore.graphics;b.forEach(function(b){a.ids.add(b);(b=c[b])&&b.addHighlight(a.highlightSet,
a.options)})};a.prototype.setObjectIds=function(a,b){var c=this.graphicsCore.graphics;b.forEach(function(b){return a.ids.add(b)});for(var e in c)(b=c[e])&&a.hasGraphic(b)&&b.addHighlight(a.highlightSet,a.options)};a.prototype.graphicCreated=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.addHighlight(b.highlightSet,b.options)})};a.prototype.graphicDeleted=function(a){this.highlights.forEach(function(b){b.hasGraphic(a)&&a.removeHighlight(b.highlightSet)})};a.prototype.allGraphicsDeleted=
function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return a}()})},"esri/views/3d/layers/graphics/Graphics3DHighlightSet":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(n,g,c){return function(){function a(a,b){this.highlightSet=new c;this.ids=new Set;this.options=a;this.objectIdField=b}a.prototype.hasGraphic=function(a){return this.objectIdField?this.ids.has(a.graphic.attributes[this.objectIdField]):this.ids.has(a.graphic.uid)};
return a}()})},"esri/views/3d/webgl-engine/lib/HighlightSet":function(){define(["require","exports"],function(n,g){return function(){function c(){this.items=[]}c.prototype.addObject=function(a,c){this.items.push({type:"object",highlightId:c,object:a})};c.prototype.addRenderGeometry=function(a,c,b){this.items.push({type:"renderGeometry",highlightId:b,renderGeometry:a,renderer:c})};c.prototype.addExternal=function(a,c){this.items.push({type:"external",highlightId:c,remove:a})};c.prototype.remove=function(a){for(var c=
this.items.length-1;0<=c;--c){var b=this.items[c];b.highlightId===a&&(this.removeHighlight(b),this.items.splice(c,1))}};c.prototype.removeObject=function(a){for(var c=this.items.length-1;0<=c;--c){var b=this.items[c];"object"===b.type&&b.object===a&&(this.removeHighlight(b),this.items.splice(c,1))}};c.prototype.removeRenderGeometry=function(a){for(var c=this.items.length-1;0<=c;--c){var b=this.items[c];"renderGeometry"===b.type&&b.renderGeometry===a&&(this.removeHighlight(b),this.items.splice(c,1))}};
c.prototype.removeAll=function(){var a=this;this.items.forEach(function(c){a.removeHighlight(c)});this.items=[]};c.prototype.removeHighlight=function(a){switch(a.type){case "object":a.object.removeHighlights(a.highlightId);break;case "renderGeometry":a.renderer.removeRenderGeometryHighlight(a.renderGeometry,a.highlightId);break;case "external":a.remove(a.highlightId)}};return c}()})},"esri/views/3d/layers/graphics/Graphics3DScaleVisibility":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b){function l(a,b){return null!==a&&0<a&&8E7>a||50<b}return function(e){function f(){var a=e.call(this)||this;a._scaleRangeActive=!1;a._layerScaleRangeVisibilityDirty=!0;a.layerScaleRangeVisibilityQuery=!1;a.scaleChangeEventHandle=null;a.layerView=null;a.layer=null;a.queryGraphicUIDsInExtent=null;a.extent=null;a.graphicsCore=null;a.basemapTerrain=null;a.suspended=!1;return a}c(f,e);Object.defineProperty(f.prototype,"layerScaleRangeVisibilityDirty",{get:function(){return this._layerScaleRangeVisibilityDirty},
set:function(a){this._layerScaleRangeVisibilityDirty!==a&&(this._layerScaleRangeVisibilityDirty=a,this.notifyChange("updating"))},enumerable:!0,configurable:!0});Object.defineProperty(f.prototype,"updating",{get:function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty},enumerable:!0,configurable:!0});f.prototype.setup=function(a,b,c,e,f){this.layerView=a;this.layer=b;this.queryGraphicUIDsInExtent=c;this.graphicsCore=e;this.basemapTerrain=f;this.updateScaleRangeActive()};
f.prototype.destroy=function(){this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);this.graphicsCore=this.queryGraphicUIDsInExtent=this.extent=this.layerView=null};f.prototype.needsIdleUpdate=function(){return this.layerView.view.basemapTerrain&&this.layerScaleRangeVisibilityDirty};f.prototype.setExtent=function(a){this.extent=a;this.layerScaleRangeVisibilityDirty=!0};f.prototype.idleUpdate=function(a){this.layerView.view.basemapTerrain&&!a.done()&&
this.layerScaleRangeVisibilityDirty&&(this.updateSuspendScaleVisible(),this.layerScaleRangeVisibilityDirty=!1)};f.prototype.scaleRangeActive=function(){return this._scaleRangeActive};f.prototype.updateScaleRangeActive=function(){var a=this,b=this.layer,c=!1;b.labelingInfo&&(c=c||b.labelingInfo.some(function(a){return a&&l(a.minScale,a.maxScale)}));c=c||l(b.minScale,b.maxScale);b=this._scaleRangeActive!==c;(this._scaleRangeActive=c)&&!this.scaleChangeEventHandle&&this.basemapTerrain?this.scaleChangeEventHandle=
this.basemapTerrain.on("scale-change",function(b){return a.scaleUpdateHandler(b)}):!c&&this.scaleChangeEventHandle&&(this.scaleChangeEventHandle.remove(),this.scaleChangeEventHandle=null);return b};f.prototype.updateSuspendScaleVisibleFinish=function(a){this.layerScaleRangeVisibilityQuery=!1;this._set("suspended",!a)};f.prototype.updateSuspendScaleVisible=function(){var a=this,b=this.layerView.view.basemapTerrain;this.extent&&b&&this._scaleRangeActive?this.layerScaleRangeVisibilityQuery||(this.layerScaleRangeVisibilityQuery=
!0,b.queryVisibleScaleRange(this.extent,this.layer.minScale,this.layer.maxScale,function(b){return a.updateSuspendScaleVisibleFinish(b)})):this.updateSuspendScaleVisibleFinish(!0)};f.prototype.visibleAtScale=function(a,b,c){return null==a?!0:a>c&&(!b||a<b)};f.prototype.visibleAtLayerScale=function(a){return this.visibleAtScale(a,this.layer.minScale,this.layer.maxScale)};f.prototype.visibleAtLabelScale=function(a,b){return this.visibleAtScale(a,b.minScale,b.maxScale)};f.prototype.graphicScale=function(a){var b;
a.centroid?b=a.centroid:"point"===a.graphic.geometry.type&&(b=a.graphic.geometry);return b?this.layerView.view.basemapTerrain?this.layerView.view.basemapTerrain.getScale(b):1:null};f.prototype.graphicVisible=function(a){a=this.graphicScale(a);return this.visibleAtLayerScale(a)};f.prototype.updateGraphicScaleVisibility=function(a){if(this._scaleRangeActive){var b=this.graphicVisible(a);return a.setVisibilityFlag(1,b)}return!1};f.prototype.updateGraphicLabelScaleVisibility=function(a){if(!this._scaleRangeActive||
!a._labelGraphics||0===a._labelGraphics.length)return!1;var b=this.graphicScale(a);if(a=this.updateLabelScaleVisibility(a,b))this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty();return a};f.prototype.updateLabelScaleVisibility=function(a,b){if(!a._labelGraphics||0===a._labelGraphics.length)return!1;var c=a._labelGraphics[0]._labelClass;return c&&null!=c.minScale&&null!=c.maxScale&&(b=this.visibleAtLabelScale(b,c),a.setVisibilityFlag(1,b,1))?!0:!1};f.prototype.scaleUpdateHandler=
function(a){var b=this;if(!this.layerView.suspended){var c=a.extent,e=a.scale,f=this.visibleAtLayerScale(e),g=!1;this.queryGraphicUIDsInExtent(c,a.spatialReference,function(a){if(a=b.graphicsCore.getGraphics3DGraphicById(a)){var d=a.centroid;d&&(c[0]>d.x||c[1]>d.y||c[2]<d.x||c[3]<d.y)||(d=!1,a.setVisibilityFlag(1,f)&&(d=!0),b.updateLabelScaleVisibility(a,e)&&(d=!0),d&&(g=!0))}});g&&(this.layerView.view.deconflictor.setDirty(),this.layerView.view.labeler.setDirty())}this.layerScaleRangeVisibilityDirty=
!0};f.prototype.layerMinMaxScaleChangeHandler=function(){this.updateScaleRangeActive()&&(this._scaleRangeActive?this.graphicsCore.updateAllGraphicsVisibility():this.graphicsCore.forEachGraphics3DGraphic(function(a){return a.setVisibilityFlag(1,void 0)}));this.layerScaleRangeVisibilityDirty=!0};a([b.property({readOnly:!0})],f.prototype,"suspended",void 0);a([b.property({readOnly:!0})],f.prototype,"updating",null);return f=a([b.subclass("esri.views.3d.layers.graphics.Graphics3DScaleVisibility")],f)}(b.declared(f))})},
"esri/views/3d/layers/graphics/Graphics3DSpatialIndex":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/has ../../../../core/PooledArray ../../../../core/accessorSupport/decorators ../../../../core/libs/rbush/PooledRBush".split(" "),function(n,g,c,a,f,b,l,e,h){n=function(d){function f(a){a=d.call(this)||this;a.index=new h.default(9,b("csp-restrictions")?function(a){return{minX:a.extent[0],
minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]);a.spatialReference=null;return a}c(f,d);f.prototype.destroy=function(){this.index.clear();this.index=null};f.prototype.queryGraphicUIDsInExtent=function(a,b,c){b.equals(this.spatialReference)&&(k.minX=a[0],k.minY=a[1],k.maxX=a[2],k.maxY=a[3],this.index.search(k,function(a){c(a.graphic.uid)}))};f.prototype.add=function(a){!a.addedToSpatialIndex&&a.computeExtent(this.spatialReference)&&(this.index.insert(a),
a.addedToSpatialIndex=!0)};f.prototype.addMany=function(a,b){void 0===b&&(b=a.length);m.clear();for(var c=0;c<b;c++){var d=a[c];!d.addedToSpatialIndex&&d.computeExtent(this.spatialReference)&&(m.push(d),d.addedToSpatialIndex=!0)}this.index.load(m.data,m.length)};f.prototype.remove=function(a){a.addedToSpatialIndex&&(a.addedToSpatialIndex=!1,this.index.remove(a))};f.prototype.removeMany=function(a){for(var b=0;b<a.length;b++)this.remove(a[b])};f.prototype.clear=function(){this.index.clear()};a([e.property({constructOnly:!0})],
f.prototype,"spatialReference",void 0);return f=a([e.subclass("esri.views.3d.layers.graphics.Graphics3DSpatialIndex")],f)}(e.declared(f));var m=new l({initialSize:50}),k={minX:0,minY:0,maxX:0,maxY:0};return n})},"esri/core/libs/rbush/PooledRBush":function(){define(["require","exports","../../PooledArray","../quickselect/quickselect"],function(n,g,c,a){function f(a,c){b(a,0,a.children.length,c,a)}function b(a,b,c,d,e){e||(e=p(null,!0));e.minX=Infinity;e.minY=Infinity;e.maxX=-Infinity;e.maxY=-Infinity;
for(var f=void 0;b<c;b++)f=a.children[b],l(e,a.leaf?d(f):f);return e}function l(a,b){a.minX=Math.min(a.minX,b.minX);a.minY=Math.min(a.minY,b.minY);a.maxX=Math.max(a.maxX,b.maxX);a.maxY=Math.max(a.maxY,b.maxY);return a}function e(a,b){return a.minX-b.minX}function h(a,b){return a.minY-b.minY}function m(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function k(a){return a.maxX-a.minX+(a.maxY-a.minY)}function d(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function q(a,b){return b.minX<=
a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function p(a,b){return{children:a,height:1,leaf:b,minX:Infinity,minY:Infinity,maxX:-Infinity,maxY:-Infinity}}function r(b,c,d,e,f){for(var g=[c,d];g.length;)if(d=g.pop(),c=g.pop(),!(d-c<=e)){var h=c+Math.ceil((d-c)/e/2)*e;a(b,h,c,d,f);g.push(c,h,h,d)}}Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(a,b){void 0===a&&(a=9);this.compareMinX=e;this.compareMinY=h;this.toBBox=function(a){return a};this._maxEntries=Math.max(4,
a||9);this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries));b&&("function"===typeof b?this.toBBox=b:this._initFormat(b));this.clear()}a.prototype.all=function(a){this._all(this.data,a)};a.prototype.search=function(a,b){var c=this.data,e=this.toBBox;if(q(a,c))for(u.clear();c;){for(var f=0,g=c.children.length;f<g;f++){var h=c.children[f],k=c.leaf?e(h):h;q(a,k)&&(c.leaf?b(h):d(a,k)?this._all(h,b):u.push(h))}c=u.pop()}};a.prototype.collides=function(a){var b=this.data,c=this.toBBox;if(!q(a,b))return!1;
for(u.clear();b;){for(var e=0,f=b.children.length;e<f;e++){var g=b.children[e],h=b.leaf?c(g):g;if(q(a,h)){if(b.leaf||d(a,h))return!0;u.push(g)}}b=u.pop()}return!1};a.prototype.load=function(a,b){void 0===b&&(b=a.length);if(!b)return this;if(b<this._minEntries){for(var c=0;c<b;c++)this.insert(a[c]);return this}a=this._build(a.slice(0,b),0,b-1,0);this.data.children.length?this.data.height===a.height?this._splitRoot(this.data,a):(this.data.height<a.height&&(c=this.data,this.data=a,a=c),this._insert(a,
this.data.height-a.height-1,!0)):this.data=a;return this};a.prototype.insert=function(a){a&&this._insert(a,this.data.height-1);return this};a.prototype.clear=function(){this.data=p([],!0);return this};a.prototype.remove=function(a,b){if(!a)return this;var c=this.data,e,f,g,h,k=this.toBBox(a);v.clear();for(A.clear();c||v.length;){c||(c=v.pop(),e=v.data[v.length-1],f=A.pop(),g=!0);if(c.leaf){a:{h=a;var l=c.children,m=b;if(m){for(var p=0;p<l.length;p++)if(m(h,l[p])){h=p;break a}h=-1}else h=l.indexOf(h)}if(-1!==
h){c.children.splice(h,1);v.push(c);this._condense(v);break}}g||c.leaf||!d(c,k)?e?(f++,c=e.children[f],g=!1):c=null:(v.push(c),A.push(f),f=0,e=c,c=c.children[0])}return this};a.prototype.toJSON=function(){return this.data};a.prototype.fromJSON=function(a){this.data=a;return this};a.prototype._all=function(a,b){for(t.clear();a;){if(!0===a.leaf){var c=0;for(a=a.children;c<a.length;c++)b(a[c])}else t.pushArray(a.children);a=t.pop()}};a.prototype._build=function(a,b,c,d){var e=c-b+1,g=this._maxEntries,
h;if(e<=g)return h=p(a.slice(b,c+1),!0),f(h,this.toBBox),h;d||(d=Math.ceil(Math.log(e)/Math.log(g)),g=Math.ceil(e/Math.pow(g,d-1)));h=p([],!1);h.height=d;e=Math.ceil(e/g);g=e*Math.ceil(Math.sqrt(g));for(r(a,b,c,g,this.compareMinX);b<=c;b+=g){var k=Math.min(b+g-1,c);r(a,b,k,e,this.compareMinY);for(var l=b;l<=k;l+=e)h.children.push(this._build(a,l,Math.min(l+e-1,k),d-1))}f(h,this.toBBox);return h};a.prototype._chooseSubtree=function(a,b,c,d){for(;;){d.push(b);if(!0===b.leaf||d.length-1===c)break;for(var e=
Infinity,f=Infinity,g=void 0,h=0,k=b.children.length;h<k;h++){var l=b.children[h],p=m(l),q=(Math.max(l.maxX,a.maxX)-Math.min(l.minX,a.minX))*(Math.max(l.maxY,a.maxY)-Math.min(l.minY,a.minY))-p;q<f?(f=q,e=p<e?p:e,g=l):q===f&&p<e&&(e=p,g=l)}b=g||b.children[0]}return b};a.prototype._insert=function(a,b,c){var d=this.toBBox;c=c?a:d(a);v.clear();d=this._chooseSubtree(c,this.data,b,v);d.children.push(a);for(l(d,c);0<=b;)if(v.data[b].children.length>this._maxEntries)this._split(v,b),b--;else break;this._adjustParentBBoxes(c,
v,b)};a.prototype._split=function(a,b){var c=a.data[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);d=this._chooseSplitIndex(c,e,d);d=p(c.children.splice(d,c.children.length-d),c.leaf);d.height=c.height;f(c,this.toBBox);f(d,this.toBBox);b?a.data[b-1].children.push(d):this._splitRoot(c,d)};a.prototype._splitRoot=function(a,b){this.data=p([a,b],!1);this.data.height=a.height+1;f(this.data,this.toBBox)};a.prototype._chooseSplitIndex=function(a,c,d){var e,f,g;e=f=Infinity;for(var h=
c;h<=d-c;h++){var k=b(a,0,h,this.toBBox),l=b(a,h,d,this.toBBox),p;p=Math.max(0,Math.min(k.maxX,l.maxX)-Math.max(k.minX,l.minX))*Math.max(0,Math.min(k.maxY,l.maxY)-Math.max(k.minY,l.minY));k=m(k)+m(l);p<e?(e=p,g=h,f=k<f?k:f):p===e&&k<f&&(f=k,g=h)}return g};a.prototype._chooseSplitAxis=function(a,b,c){var d=a.leaf?this.compareMinX:e,f=a.leaf?this.compareMinY:h,g=this._allDistMargin(a,b,c,d);b=this._allDistMargin(a,b,c,f);g<b&&a.children.sort(d)};a.prototype._allDistMargin=function(a,c,d,e){a.children.sort(e);
e=this.toBBox;for(var f=b(a,0,c,e),g=b(a,d-c,d,e),h=k(f)+k(g),m=c;m<d-c;m++){var p=a.children[m];l(f,a.leaf?e(p):p);h+=k(f)}for(m=d-c-1;m>=c;m--)p=a.children[m],l(g,a.leaf?e(p):p),h+=k(g);return h};a.prototype._adjustParentBBoxes=function(a,b,c){for(;0<=c;c--)l(b.data[c],a)};a.prototype._condense=function(a){for(var b=a.length-1,c=void 0;0<=b;b--)0===a.data[b].children.length?0<b?(c=a.data[b-1].children,c.splice(c.indexOf(a.data[b]),1)):this.clear():f(a.data[b],this.toBBox)};a.prototype._initFormat=
function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0]));this.compareMinY=new Function("a","b",b.join(a[1]));this.toBBox=new Function("a","return {minX: a"+a[0]+", minY: a"+a[1]+", maxX: a"+a[2]+", maxY: a"+a[3]+"};")};return a}();g.PooledRBush=n;var u=new c({initialSize:50}),t=new c({initialSize:50}),v=new c({initialSize:10}),A=new c({initialSize:10});g.default=n})},"esri/core/libs/quickselect/quickselect":function(){define([],function(){function n(a,c,b,l,e){for(;l>
b;){if(600<l-b){var f=l-b+1,m=c-b+1,k=Math.log(f),d=.5*Math.exp(2*k/3),k=.5*Math.sqrt(k*d*(f-d)/f)*(0>m-f/2?-1:1);n(a,c,Math.max(b,Math.floor(c-m*d/f+k)),Math.min(l,Math.floor(c+(f-m)*d/f+k)),e)}f=a[c];m=b;d=l;g(a,b,c);for(0<e(a[l],f)&&g(a,b,l);m<d;){g(a,m,d);m++;for(d--;0>e(a[m],f);)m++;for(;0<e(a[d],f);)d--}0===e(a[b],f)?g(a,b,d):(d++,g(a,d,l));d<=c&&(b=d+1);c<=d&&(l=d-1)}}function g(a,c,b){var f=a[c];a[c]=a[b];a[b]=f}function c(a,c){return a<c?-1:a>c?1:0}return function(a,f,b,g,e){n(a,f,b||0,g||
a.length-1,e||c)}})},"esri/views/3d/layers/support/attributeUtils":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.attributeLookup=function(c,a){a=a.toLowerCase();for(var f=0,b=Object.keys(c);f<b.length;f++){var g=b[f];if(g.toLowerCase()===a)return c[g]}return null}})},"esri/views/3d/layers/graphics/stats":function(){define(["require","exports"],function(n,g){Object.defineProperty(g,"__esModule",{value:!0});g.stats=function(c,a){var f=a.graphics3DGraphics,
b="null",g=c.suspendResumeExtent;g&&(b=[g[0],g[1],g[2],g[3]].map(function(a){return a.toPrecision(4)}).join(", "));var g="null",e=a.computedExtent;e&&(g=[e.xmin,e.ymin,e.xmax,e.ymax].map(function(a){return a.toPrecision(4)}).join(", "));return{numCollection:c.loadedGraphics.length,numGraphics:Object.keys(f).length,graphicsUpdating:a.updating,resumeExtent:b,computedExtent:g,updating:c.updating,suspended:c.suspended}}})},"esri/views/3d/layers/support/projectExtentUtils":function(){define(["require",
"exports","../../../../core/promiseUtils","../../../../geometry/support/webMercatorUtils","../../../../portal/support/geometryServiceUtils"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});g.toViewIfLocal=function(b){var g=b.view.spatialReference,e=b.layer.fullExtent,h=e&&e.spatialReference;return h?h.equals(g)?c.resolve(e.clone()):a.canProject(h,g)?c.resolve(a.project(e,g)):b.view.state.isLocal?f.projectGeometry(e,g,b.layer.portalItem).then(function(a){if(!b.destroyed&&a)return a}).catch(function(){return null}):
c.resolve(null):c.resolve(null)}})},"esri/views/layers/RefreshableLayerView":function(){define("require exports ../../core/tsSupport/declareExtendsHelper ../../core/tsSupport/decorateHelper ../../core/Accessor ../../core/accessorSupport/decorators".split(" "),function(n,g,c,a,f,b){return function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a.refreshTimestamp=null;return a}c(e,f);e.prototype.refresh=function(a){void 0===a&&(a=Date.now());this._set("refreshTimestamp",a);this.doRefresh&&
this.doRefresh()};a([b.property()],e.prototype,"layer",void 0);a([b.aliasOf("layer.refreshInterval")],e.prototype,"refreshInterval",void 0);a([b.property({readOnly:!0})],e.prototype,"refreshTimestamp",void 0);return e=a([b.subclass("esri.layers.mixins.RefreshableLayerView")],e)}(b.declared(f))})},"esri/views/3d/layers/PointCloudLayerView3D":function(){define("require exports ../../../core/tsSupport/extendsHelper ../../../core/tsSupport/decorateHelper dojo/errors/CancelError dojo/promise/all ../../../request ../../../core/arrayUtils ../../../core/arrayUtils ../../../core/Handles ../../../core/Logger ../../../core/promiseUtils ../../../core/requireUtils ../../../core/screenUtils ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingBox ../../../geometry/support/scaleUtils ../../../symbols/support/unitConversionUtils ./LayerView3D ./PointCloudWorker ./i3s/I3SUtil ./i3s/IdleQueue ./i3s/LoDUtil ./i3s/PagedNodeIndex ./i3s/PointCloudRendererUtil ./i3s/PointRenderer ./support/layerViewUpdatingProperties ../lib/gl-matrix ../support/geometryUtils ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/RenderSlot module".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K,N,H,M,T,V,U){var J=k.getLogger("esri.views.3d.layers.PointCloudLayerView3D"),O=H.plane.create();return function(g){function k(){var a=null!==g&&g.apply(this,arguments)||this;a.maximumPointCount=4E6;a.slicePlaneEnabled=!1;a._renderer=null;a._rendererAdded=!1;a._renderedNodes=new Set;a._updateViewNeeded=!0;a._lodFactor=1;a._worker=new B;a._workerThread=null;a._maxLoggedBoxWarnings=5;a._pageMultiplier=1;a._handles=new m;a._indexQueue=
[];a._workQueue=[];a._idleQueue=new C.IdleQueue;a._indexPagesLoading=new Map;a._loadingNodes=new Map;a._layerIsVisible=!1;a._totalWork=0;a._index=null;a._loadingInitNodePage=!1;a._nodeIdArray=[];return a}c(k,g);Object.defineProperty(k.prototype,"pointScale",{get:function(){var a=F.getSplatSizeAlgorithm(this.layer.renderer);return a&&null!=a.scaleFactor?a.scaleFactor:1},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"useRealWorldSymbolSizes",{get:function(){var a=F.getFixedSizeAlgorithm(this.layer.renderer);
return a&&null!=a.useRealWorldSymbolSizes?a.useRealWorldSymbolSizes:!1},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"pointSize",{get:function(){var a=F.getFixedSizeAlgorithm(this.layer.renderer);return a&&null!=a.size?a.size:0},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"inverseDensity",{get:function(){return this.layer.renderer?96/this.layer.renderer.pointsPerInch:5},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"_clippingBox",{get:function(){var a=
v.create();return T.extentToBoundingBox(this.view.clippingArea,a,this.view.renderSpatialReference)?a:null},enumerable:!0,configurable:!0});Object.defineProperty(k.prototype,"_elevationOffset",{get:function(){var a=this.layer.elevationInfo;if(a&&"absolute-height"===a.mode){var b=A.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=z.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});k.prototype.initialize=function(){var a=this;D.checkPointCloudLayerValid(this.layer);
D.checkPointCloudLayerCompatibleWithView(this.layer,this.view);this._initRenderer();var b=this._initNodePages(),c={idleBegin:function(){return a._idleBegin()},idleEnd:function(){return a._idleEnd()}};u.open(q.getAbsMid("./PointCloudWorker",n,U),{client:this}).then(function(b){a.destroyed?b.close():a._workerThread=b});this._memCache=this.view.resourceController.getMemCache(this.layer.uid);this._handles.add(r.init(this,"_clippingBox",function(){return a._setUpdateViewNeeded()}));this._handles.add(r.init(this,
"_elevationOffset",function(){return a._elevationOffsetChanged()}));this._handles.add(r.init(this.layer,"renderer",function(){return a._rendererChanged()}));this._handles.add(r.init(this,"clippingArea",function(){a._setUpdateViewNeeded()}));this._handles.add(this.view.state.watch("camera",function(){a._setUpdateViewNeeded()}));this.view.resourceController.memoryEvents.on("quality-changed",function(){return a._setUpdateViewNeeded()});this.addResolvingPromise(b);this.when(function(){a._handles.add(a.view.resourceController.registerFrameWorker(function(b){return a._process(b)}));
a._handles.add(a.view.resourceController.registerIdleFrameWorker(c));a._handles.add(r.init(a,"suspended",function(b){b?a._clearNodeState():a._setUpdateViewNeeded()}))})};k.prototype._setUpdateViewNeeded=function(){this._updateViewNeeded=!0;this._updateLoading()};k.prototype.destroy=function(){this._cancelNodeLoading();this._workerThread&&(this._workerThread.close(),this._workerThread=null);this._handles.destroy();this._destroyRenderer();this._memCache.destroy();this._memCache=null};k.prototype._initRenderer=
function(){var a=this;this._renderer=new I;this._renderer.layerUid=this.layer.uid;this._handles.add(r.init(this,"_clippingBox",function(b){a._renderer.clippingBox=b}));this._handles.add(r.init(this,"_clippingBox",function(b){a._renderer.clippingBox=b}));this._handles.add(r.init(this,"suspended",function(b){return a._setPointsVisible(!b)}));this._handles.add(r.init(this,"pointScale",function(b){a._renderer.scaleFactor=b}));this._renderer.minSizePx=Math.sqrt(2);this._handles.add(r.init(this,"useRealWorldSymbolSizes",
function(b){a._renderer.useRealWorldSymbolSizes=b}));this._handles.add(r.init(this,"pointSize",function(b){var c=p.pt2px(b);a._renderer.size=b;a._renderer.sizePx=c}));this._handles.add(r.init(this,"slicePlaneEnabled",function(b){a._renderer.slicePlaneEnabled=b}));this._handles.add(r.init(this,["inverseDensity","maximumPointCount"],function(){a._setUpdateViewNeeded()}));this._handles.add(r.init(this.view,"qualitySettings.sceneService.pointCloud.lodFactor",function(b){a._lodFactor=b;a._setUpdateViewNeeded()}))};
k.prototype._destroyRenderer=function(){this._setPointsVisible(!1)};k.prototype._setPointsVisible=function(a){a&&!this._rendererAdded?(this.view._stage.addRenderPlugin([V.OPAQUE_EXTERNAL],this._renderer),this._rendererAdded=!0):!a&&this._rendererAdded&&(this.view._stage.removeRenderPlugin(this._renderer),this._rendererAdded=!1)};k.prototype._rendererChanged=function(){this._clearNodeState();this._memCache.clear();this._renderer.useFixedSizes=F.rendererUsesFixedSizes(this.layer.renderer);this._setUpdateViewNeeded()};
k.prototype._elevationOffsetChanged=function(){this._clearNodeState();this._memCache.clear();this._initNodePages()};k.prototype.displayNodes=function(a){this._workQueue=G.nodeDiff(h.keysOfSet(this._renderedNodes),a,this._index);G.sortFrontToBack(this._workQueue,this.view.state.camera.viewForward,this._index);G.splitWorkEntries(this._workQueue,8,this._index);this._updateQueues();this._totalWork=this._computeWork();this._updateLoading();this._layerIsVisible=0<a.length||this._loadingInitNodePage;this.notifyChange("suspended")};
k.prototype.cancelLoading=function(){this._cancelNodeLoading();this._cancelIndexLoading()};k.prototype._cancelNodeLoading=function(){var a=[];this._loadingNodes.forEach(function(b){return a.push(b)});this._loadingNodes.clear();for(var b=0;b<a.length;b++)a[b].cancel();this._workQueue=[];this._idleQueue.cancelAll();this._totalWork=this._computeWork();this._updateLoading()};k.prototype._updateQueues=function(){var a=this,b=new Set;this._workQueue.forEach(function(a){a.load.forEach(function(a){b.add(a)})});
var c=[],d=new Map;this._loadingNodes.forEach(function(a,e){b.has(e)?d.set(e,a):c.push(a)});this._loadingNodes=d;for(var e=0;e<c.length;e++)c[e].cancel();this._workQueue=this._workQueue.filter(function(b){var c=0;for(b=b.load;c<b.length;c++)if(a._loadingNodes.has(b[c]))return!1;return!0});this._totalWork=this._computeWork();this._updateLoading()};k.prototype._cancelIndexLoading=function(){this._indexQueue=[];this._indexPagesLoading.forEach(function(a){return a.cancel()});this._indexPagesLoading.clear();
this._totalWork=this._computeWork();this._updateLoading()};k.prototype._clearNodeState=function(){var a=this;this._renderedNodes.forEach(function(b){return a._removeFromRenderer(b)});this._cancelNodeLoading()};k.prototype._idleBegin=function(){this._setUpdateViewNeeded()};k.prototype._idleEnd=function(){this._setUpdateViewNeeded()};k.prototype._process=function(a){if(this.suspended)this._updateViewNeeded&&(this._updateViewNeeded=!1,a=this._isRootNodeVisible(),a!==this._layerIsVisible&&(this._layerIsVisible=
a,this.notifyChange("suspended")));else{for(this._updateViewNeeded&&!a.done()&&this._updateWorkQueues();0<this._indexQueue.length&&!a.done();)this._processIndexQueue();for(this._processWorkQueue(a);0<this._idleQueue.length()&&!a.done();)this._idleQueue.process()}};k.prototype._processIndexQueue=function(){var a=this,b=this._indexQueue.shift();this._indexPagesLoading.set(b,this._loadNodePage(b));this._indexPagesLoading.get(b).then(function(c){a._index.addPage(b,c,a._elevationOffset);a._setUpdateViewNeeded()}).always(function(){a._indexPagesLoading.delete(b)})};
k.prototype._processWorkQueue=function(a){for(;!a.done();){var b=this._scheduleWorkEntry();if(!b)break;this._processWorkEntry(b)}};k.prototype._scheduleWorkEntry=function(){var a=this;if(8<=this._loadingNodes.size)return null;for(var b=0;b<this._workQueue.length;++b){var c=this._workQueue[b];if(!e.find(c.remove,function(b){return!a._renderedNodes.has(b)})){for(;0<b;--b)this._workQueue[b]=this._workQueue[b-1];this._workQueue.shift();return c}}return null};k.prototype._processWorkEntry=function(a){var c=
this;if(0===a.load.length)for(var e=0;e<a.remove.length;e++)this._removeFromRenderer(a.remove[e]);else b(a.load.map(function(a){var b=c._memCache.pop(a.toString());b?c._loadingNodes.set(a,d.resolve(b)):c._loadingNodes.has(a)||c._loadingNodes.set(a,c.loadNode(a));return c._loadingNodes.get(a)})).then(function(b){for(var d=0;d<a.load.length;d++)if(b[d]){var e=c._setupRendererData(a.load[d],b[d]);c._addToRenderer(e)}for(d=0;d<a.remove.length;d++)c._removeFromRenderer(a.remove[d])}).always(function(){for(var b=
0;b<a.load.length;b++)c._loadingNodes.delete(a.load[b]);c._updateLoading()}),this._updateLoading()};k.prototype._computeWork=function(){for(var a=0,b=0;b<this._workQueue.length;b++)a+=this._workQueue[b].load.length;a+=this._loadingNodes.size;a+=(this._indexQueue.length+this._indexPagesLoading.size)*this._index.pageSize;a+=this._loadingInitNodePage?100:0;return a+=this._updateViewNeeded?100:0};Object.defineProperty(k.prototype,"updatingPercentageValue",{get:function(){var a=this._computeWork();return 100*
Math.min(this._totalWork,a)/this._totalWork},enumerable:!0,configurable:!0});k.prototype._updateLoading=function(){this.notifyChange("updating");this.notifyChange("updatingPercentageValue")};k.prototype.canResume=function(){return this.inherited(arguments)&&this._layerIsVisible};k.prototype.isUpdating=function(){return 0<this._computeWork()};k.prototype._initNodePages=function(){var a=this,b=this.layer.store.index;this._index=new E(this.layer.spatialReference,this.view.renderCoordsHelper.spatialReference,
b.nodesPerPage||b.nodePerIndexBlock);this._cancelIndexLoading();this._traverseVisible=this._index.createVisibilityTraverse();this._layerIsVisible=this._loadingInitNodePage=!0;this.notifyChange("suspended");this._updateLoading();this._pageMultiplier=null!=b.nodesPerPage?1:b.nodePerIndexBlock;return this._loadNodePage(0).then(function(b){a._index.addPage(0,b,a._elevationOffset);a._loadingInitNodePage=!1;a._setUpdateViewNeeded()})};k.prototype._loadNodePage=function(a){var b=this;return this._requestJSON(this.baseUrl+
"/nodepages/"+a*this._pageMultiplier).then(function(c){return c.data.nodes.map(function(c,d){return{resourceId:null!=c.resourceId?c.resourceId:a*b._index.pageSize+d,obb:c.obb,firstChild:c.firstChild,childCount:c.childCount,vertexCount:null!=c.vertexCount?c.vertexCount:c.pointCount,lodThreshold:null!=c.lodThreshold?c.lodThreshold:c.effectiveArea}})})};k.prototype._updateWorkQueues=function(){for(var a=this.inverseDensity/this._lodFactor*this._getLodMemoryFactor(),b=this.maximumPointCount*this._lodFactor*
this._getLodMemoryFactor(),c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(d/(.75*b));d>b;)a*=e,c=this._computeNodesForMinimumDensity(a),d=this._computePointCount(c),e=Math.sqrt(2);this.displayNodes(c);this._updateViewNeeded=!1;this._updateLoading()};k.prototype._computePointCount=function(a){for(var b=0,c=0;c<a.length;c++){var d=this._index.getNode(a[c]);d&&(b+=d.vertexCount)}return b};k.prototype._getLodMemoryFactor=function(){return this.view.resourceController.memoryFactor};
k.prototype._isRootNodeVisible=function(){var a=!1;this._traverseVisible({frustumPlanes:this.view.state.camera.frustumPlanes,clippingBox:this._clippingBox},{predicate:function(b,c,d){a=d;return!1},pageMiss:function(a,b){}});return a};k.prototype._computeNodesForMinimumDensity=function(a){var b=this,c=this.view.state.camera,d=c.frustumPlanes,e=this._clippingBox,f=c.viewForward,g=N.vec3d.dot(f,c.eye),h=H.plane.fromNormalAndOffset(f,-g,O),k=c.perPixelRatio,l=a*a,m=this._nodeIdArray;m.length=0;this._traverseVisible({frustumPlanes:d,
clippingBox:e},{predicate:function(a,c,d){if(!d)return!1;if(0===c.childCount)return m.push(a),!1;d=b._index.getRenderObb(a);return b._computeAveragePixelArea(d,c.lodThreshold,c.vertexCount,h,k)<=l?(m.push(a),!1):!0},pageMiss:function(a,c){m.push(a);0>b._indexQueue.indexOf(c)&&b._indexQueue.push(c)}});return m};k.prototype._computeAveragePixelArea=function(a,b,c,d,e){a=Math.max(1E-7,M.minimumDistancePlane(a,d));return b/(a*a)/(4*e*e)/c};k.prototype.loadNode=function(a){var c=this,e=this._index.getNode(a),
g=F.getRendererInfo(this.layer),h=[];return this._idleQueue.push().then(function(){var a=e.resourceId,d=c.loadGeometry(a),f=c.loadAttribute(a,g.primaryAttribute),a=c.loadAttribute(a,g.modulationAttribute);h=[d,f,a];return b(h)}).then(function(b){var e=b[0],f=b[1],h=b[2];b=[e];f&&b.push(f);h&&b.push(h);e={geometryBuffer:e,primaryAttribute:f,modulationAttribute:h,schema:c.layer.store.defaultGeometrySchema,rendererInfo:g,obb:c._index.getRenderObb(a),elevationOffset:c._elevationOffset,inSR:c.layer.spatialReference.toJSON(),
outSR:c.view.renderCoordsHelper.spatialReference.toJSON()};return c._workerThread?c._workerThread.invoke("process",e,b):d.resolve(c._worker.transform(e))}).catch(function(a){if(a instanceof f)for(var b=0,c=h;b<c.length;b++)c[b].cancel();else console.error(a);return d.reject(a)})};k.prototype.loadGeometry=function(a){return this._requestBinary(this.baseUrl+"/nodes/"+a+"/geometries/0").then(function(a){return a.data})};k.prototype.loadAttribute=function(a,b){return b&&b.storageInfo?this._requestBinary(this.baseUrl+
"/nodes/"+a+"/attributes/"+b.storageInfo.key).then(function(a){return a.data}):d.resolve(null)};k.prototype._requestJSON=function(a){return l(a,{query:{f:"json"},responseType:"json"})};k.prototype._requestBinary=function(a){return l(a,{responseType:"array-buffer"})};k.prototype._removeFromRenderer=function(a){if(this._renderedNodes.has(a)){var b=this._renderer.removeNode(a);this._renderedNodes.delete(a);this._memCache.put(b.id.toString(),b,5*b.coordinates.length+128)}};k.prototype._addToRenderer=
function(a){this._renderedNodes.has(a.id)||(this._renderedNodes.add(a.id),this._renderer.addNode(a))};k.prototype._setupRendererData=function(a,b){var c=this._index.getNode(a),d=Math.sqrt(c.lodThreshold/c.vertexCount),e=this._index.getRenderObb(a);if(I.isInstanceOfNode(b))return b.splatSize=d,b.obb=e,b.origin=N.vec3.create(b.obb.center),b;if(b.obb.halfSize[0]>e.halfSize[0]||b.obb.halfSize[1]>e.halfSize[1]||b.obb.halfSize[2]>e.halfSize[2])0<this._maxLoggedBoxWarnings&&(J.warn("Node",a,"reported bounding box too small, got",
e,"but points cover",b.obb),0===--this._maxLoggedBoxWarnings&&J.warn("  Too many bounding box errors, stopping reporting for this layer.")),this._index.setRenderObb(a,b.obb);return{id:a,coordinates:b.points,origin:N.vec3.create(e.center),rgb:new Uint8Array(b.rgb),splatSize:d,obb:e,isLeaf:0===c.childCount}};k.prototype.getUsedMemory=function(){var a=this;return h.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+15*a._index.getNode(c).vertexCount+128},0)};k.prototype.getUnloadedMemory=function(){var a=
this,b=this._renderedNodes.size;if(4>b)return 0;for(var c=h.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount}),d=this._loadingNodes.size,e=0;e<this._workQueue.length;e++)d+=this._workQueue[e].load.length,d-=this._workQueue[e].remove.length;return 0>d?0:d*c/b*15+128*d};k.prototype.getStats=function(){var a=this;return{"Rendered Nodes":this._renderedNodes.size,"Rendered Points":h.keysOfSet(this._renderedNodes).reduce(function(b,c){return b+a._index.getNode(c).vertexCount},
0),"Loading Nodes":this._loadingNodes.size,"Index Queue":this._indexQueue.length,"Work Queue":this._workQueue.length,"Idle Queue":this._idleQueue.length()}};a([t.property()],k.prototype,"layer",void 0);a([t.property({readOnly:!0,aliasOf:"layer.parsedUrl.path"})],k.prototype,"baseUrl",void 0);a([t.property({readOnly:!0,dependsOn:["layer.renderer"]})],k.prototype,"pointScale",null);a([t.property({readOnly:!0,dependsOn:["layer.renderer"]})],k.prototype,"useRealWorldSymbolSizes",null);a([t.property({readOnly:!0,
dependsOn:["layer.renderer"]})],k.prototype,"pointSize",null);a([t.property({readOnly:!0,dependsOn:["layer.renderer"]})],k.prototype,"inverseDensity",null);a([t.property()],k.prototype,"maximumPointCount",void 0);a([t.property({readOnly:!0,dependsOn:["view.clippingArea"]})],k.prototype,"_clippingBox",null);a([t.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],k.prototype,"_elevationOffset",null);a([t.property({type:Boolean})],k.prototype,"slicePlaneEnabled",void 0);a([t.property(K.updatingPercentage)],
k.prototype,"updatingPercentage",void 0);a([t.property({readOnly:!0})],k.prototype,"updatingPercentageValue",null);return k=a([t.subclass("esri.views.3d.layers.PointCloudLayerView3D")],k)}(t.declared(x))})},"esri/views/3d/layers/PointCloudWorker":function(){define("require exports ../../../core/promiseUtils ../../../geometry/SpatialReference ./i3s/I3SBinaryReader ./i3s/LEPCC ./i3s/PointCloudRendererUtil ../lib/gl-matrix ../support/projectionUtils".split(" "),function(n,g,c,a,f,b,l,e,h){n=function(){function g(){}
g.prototype.process=function(a){a=this.transform(a);return c.resolve({result:a,transferList:[a.rgb]})};g.prototype.transform=function(b){var c=this.readGeometry(b.schema,b.geometryBuffer),d=l.evaluateRenderer(b.rendererInfo,b.primaryAttribute,b.modulationAttribute,c,c.length/3);this._applyElevationOffsetInPlace(c,b.elevationOffset);c=this._transformCoordinates(c,b.obb,a.fromJSON(b.inSR),a.fromJSON(b.outSR));return{obb:b.obb,points:c,rgb:d.buffer}};g.prototype.readGeometry=function(a,c){if(null==a.encoding||
""===a.encoding){a=f.createGeometryDataIndex(c,a,!1);c=f.createTypedView(c,a.vertexAttributes.position);var d=a.header.fields;a=[d.offsetX,d.offsetY,d.offsetZ];for(var d=[d.scaleX,d.scaleY,d.scaleZ],e=c.length/3,g=new Float64Array(3*e),h=0;h<e;h++)g[3*h]=c[3*h]*d[0]+a[0],g[3*h+1]=c[3*h+1]*d[1]+a[1],g[3*h+2]=c[3*h+2]*d[2]+a[2];return g}if("lepcc-xyz"===a.encoding)return b.decodeXYZ(c).result};g.prototype._transformCoordinates=function(a,b,c,f){var d=a.length/3;if(!h.bufferToBuffer(a,c,0,a,f,0,d))throw Error("Can't reproject");
c=e.vec3.createFrom(b.center[0],b.center[1],b.center[2]);f=e.vec3.create();var g=e.vec3.create();e.quat4.conjugate(b.quaternion,m);for(var k=new Float32Array(3*d),l=0;l<d;l++)f[0]=a[3*l]-c[0],f[1]=a[3*l+1]-c[1],f[2]=a[3*l+2]-c[2],e.quat4.multiplyVec3(m,f,g),b.halfSize[0]=Math.max(b.halfSize[0],Math.abs(g[0])),b.halfSize[1]=Math.max(b.halfSize[1],Math.abs(g[1])),b.halfSize[2]=Math.max(b.halfSize[2],Math.abs(g[2])),k[3*l]=f[0],k[3*l+1]=f[1],k[3*l+2]=f[2];return k};g.prototype._applyElevationOffsetInPlace=
function(a,b){var c=a.length/3;if(0!==b)for(var d=0;d<c;d++)a[3*d+2]+=b};return g}();var m=e.quat4.create();return n})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("require exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC".split(" "),function(n,g,c,a,f,b){function l(a,b,d){for(var e="",f=0;f<d;){var g=a[b+f];if(128>g)e+=String.fromCharCode(g),f++;else if(192<=g&&224>g){if(f+1>=d)throw new c("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");
var h=a[b+f+1],g=(g&31)<<6|h&63,e=e+String.fromCharCode(g),f=f+2}else if(224<=g&&240>g){if(f+2>=d)throw new c("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");var h=a[b+f+1],k=a[b+f+2],g=(g&15)<<12|(h&63)<<6|k&63,e=e+String.fromCharCode(g),f=f+3}else if(240<=g&&248>g){if(f+3>=d)throw new c("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");h=a[b+f+1];k=a[b+f+2];g=(g&7)<<18|(h&63)<<12|(k&63)<<6|a[b+f+3]&63;e=65536<=g?e+String.fromCharCode((g-
65536>>10)+55296,(g&1023)+56320):e+String.fromCharCode(g);f+=4}else throw new c("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return e}function e(a,b){for(var c={byteOffset:0,byteCount:0,fields:Object.create(null)},d=0,e=0;e<b.length;e++){var f=b[e],h=f.valueType||f.type;c.fields[f.property]=(0,g.valueType2ArrayBufferReader[h])(a,d);d+=g.valueType2TypedArrayClassMap[h].BYTES_PER_ELEMENT}c.byteCount=d;return c}function h(a,b,d){var e=[],f,g=0,h;for(h=0;h<a;h+=1){f=b[h];
if(0<f){if(e.push(l(d,g,f-1)),0!==d[g+f-1])throw new c("string-array-error","Invalid string array: missing null termination.");}else e.push(null);g+=f}return e}function m(a,b){return new g.valueType2TypedArrayClassMap[b.valueType](a,b.byteOffset,b.count*b.valuesPerElement)}function k(a,b){return new Uint8Array(a,b.byteOffset,b.byteCount)}function d(b,d,f){b=null!=d.header?e(b,d.header):{byteOffset:0,byteCount:0,fields:{count:f}};f={header:b,byteOffset:b.byteCount,byteCount:0,entries:Object.create(null)};
for(var g=b.byteCount,h=0;h<d.ordering.length;h++){var k=d.ordering[h],l=a.clone(d[k]);l.count=b.fields.count;if("String"===l.valueType){if(l.byteOffset=g,l.byteCount=b.fields[k+"ByteCount"],"UTF-8"!==l.encoding)throw new c("unsupported-encoding","Unsupported String encoding.",{encoding:l.encoding});}else if(p(l.valueType)){var m=r(l.valueType),g=g+(0!==g%m?m-g%m:0);l.byteOffset=g;l.byteCount=m*l.valuesPerElement*l.count}else throw new c("unsupported-value-type","Unsupported binary valueType",{valueType:l.valueType});
g+=l.byteCount;f.entries[k]=l}f.byteCount=g-f.byteOffset;return f}function q(a,b,d){b!==a&&u.error("Invalid "+d+" buffer size\n expected: "+a+", actual: "+b+")");if(b<a)throw new c("buffer-too-small","Binary buffer is too small",{expectedSize:a,actualSize:b});}function p(a){return g.valueType2TypedArrayClassMap.hasOwnProperty(a)}function r(a){return p(a)&&g.valueType2TypedArrayClassMap[a].BYTES_PER_ELEMENT}Object.defineProperty(g,"__esModule",{value:!0});var u=f.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader");
g.readHeader=e;g.readStringArray=h;g.createTypedView=m;g.createRawView=k;g.createAttributeDataIndex=d;g.createGeometryDataIndex=function(b,c,d){var f=e(b,c&&c.header),g=f.byteCount,h={header:f,byteOffset:f.byteCount,byteCount:0,vertexAttributes:a.clone(c.vertexAttributes)},k=h.vertexAttributes;d||null==k.region||delete k.region;var f=f.fields,l=null!=f.vertexCount?f.vertexCount:f.count;for(d=0;d<c.ordering.length;d++){var m=c.ordering[d];null!=k[m]&&(k[m].byteOffset=g,k[m].count=l,g+=r(k[m].valueType)*
k[m].valuesPerElement*l)}k=f.faceCount;if(c.faces&&k)for(h.faces=a.clone(c.faces),l=h.faces,d=0;d<c.ordering.length;d++)m=c.ordering[d],null!=l[m]&&(l[m].byteOffset=g,l[m].count=k,g+=r(l[m].valueType)*l[m].valuesPerElement*k);f=f.featureCount;if(c.featureAttributes&&c.featureAttributeOrder&&f)for(h.featureAttributes=a.clone(c.featureAttributes),k=h.featureAttributes,d=0;d<c.featureAttributeOrder.length;d++)l=c.featureAttributeOrder[d],k[l].byteOffset=g,k[l].count=f,m=r(k[l].valueType),"UInt64"===
k[l].valueType&&(m=8),g+=m*k[l].valuesPerElement*f;q(g,b.byteLength,"geometry");h.byteCount=g-h.byteOffset;return h};g.readBinaryAttribute=function(a,e,f){if("lepcc-rgb"===a.encoding)return b.decodeRGB(e);if("lepcc-intensity"===a.encoding)return b.decodeIntensity(e);if(null!=a.encoding&&""!==a.encoding)throw new c("unknown-attribute-storage-info-encoding","Unknown Attribute Storage Info Encoding");a["attributeByteCounts "]&&!a.attributeByteCounts&&(u.warn("Warning: Trailing space in 'attributeByteCounts '."),
a.attributeByteCounts=a["attributeByteCounts "]);"ObjectIds"===a.ordering[0]&&a.hasOwnProperty("objectIds")&&(u.warn("Warning: Case error in objectIds"),a.ordering[0]="objectIds");f=d(e,a,f);q(f.byteOffset+f.byteCount,e.byteLength,"attribute");if(a=f.entries.attributeValues||f.entries.objectIds){if("String"===a.valueType){f=f.entries.attributeByteCounts;var g=m(e,f);e=k(e,a);return h(f.count,g,e)}return m(e,a)}throw new c("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};g.valueType2TypedArrayClassMap=
{Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array};g.valueType2ArrayBufferReader={Float32:function(a,b){return(new DataView(a,0)).getFloat32(b,!0)},Float64:function(a,b){return(new DataView(a,0)).getFloat64(b,!0)},UInt8:function(a,b){return(new DataView(a,0)).getUint8(b)},Int8:function(a,b){return(new DataView(a,0)).getInt8(b)},UInt16:function(a,b){return(new DataView(a,0)).getUint16(b,!0)},Int16:function(a,
b){return(new DataView(a,0)).getInt16(b,!0)},UInt32:function(a,b){return(new DataView(a,0)).getUint32(b,!0)},Int32:function(a,b){return(new DataView(a,0)).getInt32(b,!0)}};g.isValueType=p;g.getBytesPerValue=r})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["require","exports","../../../../core/Error"],function(n,g,c){function a(a,b,c){return{identifier:String.fromCharCode.apply(null,new Uint8Array(a,c+l.identifierOffset,l.identifierLength)),version:b.getUint16(c+l.versionOffset,!0),checksum:b.getUint32(c+
l.checksumOffset,!0)}}function f(a,c,f){var e=[];c=b(a,c,e);for(var d=[],g=0;g<e.length;g++){d.length=0;c=b(a,c,d);for(var h=0;h<d.length;h++)f.push(d[h]+e[g])}return c}function b(a,b,f){var e=new DataView(a,b),d=e.getUint8(0),g=d&31,h=!!(d&32),l=(d&192)>>6,d=0;if(0===l)d=e.getUint32(1,!0),b+=5;else if(1===l)d=e.getUint16(1,!0),b+=3;else if(2===l)d=e.getUint8(1),b+=2;else throw new c("lepcc-decode-error","Bad count type");if(h)throw new c("lepcc-decode-error","LUT not implemented");a=new Uint8Array(a,
b,Math.ceil(d*g/8));for(var l=h=e=0,m=-1>>>32-g,n=0;n<d;n++){for(;h<g;)e|=a[l]<<h,h+=8,l+=1;f[n]=e&m;e>>>=g;h-=g;32<h+g&&(e|=a[l-1]>>8-h)}return b+l}Object.defineProperty(g,"__esModule",{value:!0});var l={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};g.decodeXYZ=function(b){var e,g,k,d,q,p,r,n,t,v,A,z,x=new DataView(b,0),B=0;d=a(b,x,B);k=d.identifier;d=d.version;B+=l.byteCount;if("LEPCC     "!==k)throw new c("lepcc-decode-error","Bad identifier");if(1<d)throw new c("lepcc-decode-error",
"Unknown version");var D=B;e=x.getUint32(D+0,!0);g=x.getUint32(D+4,!0);k=x.getFloat64(D+8,!0);d=x.getFloat64(D+16,!0);q=x.getFloat64(D+24,!0);p=x.getFloat64(D+32,!0);r=x.getFloat64(D+40,!0);n=x.getFloat64(D+48,!0);t=x.getFloat64(D+56,!0);v=x.getFloat64(D+64,!0);A=x.getFloat64(D+72,!0);z=x.getUint32(D+80,!0);x.getUint32(D+84,!0);B+=88;if(g*Math.pow(2,32)+e!==b.byteLength)throw new c("lepcc-decode-error","Bad size");x=new Float64Array(3*z);e=[];g=[];z=[];D=[];B=f(b,B,e);B=f(b,B,g);B=f(b,B,z);B=f(b,
B,D);if(B!==b.byteLength)throw new c("lepcc-decode-error","Bad length");for(var C=B=b=0;C<e.length;C++)for(var B=B+e[C],G=0,E=0;E<g[C];E++){var G=G+z[b],F=D[b];x[3*b]=Math.min(p,k+2*t*G);x[3*b+1]=Math.min(r,d+2*v*B);x[3*b+2]=Math.min(n,q+2*A*F);b++}return{errorX:t,errorY:v,errorZ:A,result:x}};g.decodeRGB=function(b){var e,f,g,d,q,p,r=new DataView(b,0),n=0;d=a(b,r,n);g=d.identifier;d=d.version;n+=l.byteCount;if("ClusterRGB"!==g)throw new c("lepcc-decode-error","Bad identifier");if(1<d)throw new c("lepcc-decode-error",
"Unknown version");p=n;e=r.getUint32(p+0,!0);f=r.getUint32(p+4,!0);g=r.getUint32(p+8,!0);d=r.getUint16(p+12,!0);q=r.getUint8(p+14);p=r.getUint8(p+15);n+=16;if(f*Math.pow(2,32)+e!==b.byteLength)throw new c("lepcc-decode-error","Bad size");if(2!==q&&1!==q||0!==p){if(0===q&&0===p){if(3*g+n!==b.byteLength||0!==d)throw new c("lepcc-decode-error","Bad count");return(new Uint8Array(b,n)).slice()}if(2>=q&&1===p){if(n+3!==b.byteLength||1!==d)throw new c("lepcc-decode-error","Bad count");d=r.getUint8(n);e=
r.getUint8(n+1);r=r.getUint8(n+2);n=new Uint8Array(3*g);for(b=0;b<g;b++)n[3*b]=d,n[3*b+1]=e,n[3*b+2]=r;return n}throw new c("lepcc-decode-error","Bad method "+q+","+p);}if(3*d+g+n!==b.byteLength||256<d)throw new c("lepcc-decode-error","Bad count");r=new Uint8Array(b,n,3*d);d=new Uint8Array(b,n+3*d,g);n=new Uint8Array(3*g);for(b=0;b<g;b++)e=d[b],n[3*b]=r[3*e],n[3*b+1]=r[3*e+1],n[3*b+2]=r[3*e+2];return n};g.decodeIntensity=function(e){var f,g,k,d,q,p=new DataView(e,0),r=0;d=a(e,p,r);k=d.identifier;
d=d.version;r+=l.byteCount;if("Intensity "!==k)throw new c("lepcc-decode-error","Bad identifier");if(1<d)throw new c("lepcc-decode-error","Unknown version");var n=r;f=p.getUint32(n+0,!0);g=p.getUint32(n+4,!0);k=p.getUint32(n+8,!0);d=p.getUint16(n+12,!0);q=p.getUint8(n+14);p.getUint8(n+15);r+=16;if(g*Math.pow(2,32)+f!==e.byteLength)throw new c("lepcc-decode-error","Bad size");p=new Uint16Array(k);if(8===q){if(k+r!==e.byteLength)throw new c("lepcc-decode-error","Bad size");q=new Uint8Array(e,r,k)}else if(16===
q){if(2*k+r!==e.byteLength)throw new c("lepcc-decode-error","Bad size");q=new Uint16Array(e,r,k)}else if(q=[],b(e,r,q)!==e.byteLength)throw new c("lepcc-decode-error","Bad size");for(e=0;e<k;e++)p[e]=q[e]*d;return p}})},"esri/views/3d/layers/i3s/PointCloudRendererUtil":function(){define("require exports ../../../../renderers/PointCloudClassBreaksRenderer ../../../../renderers/PointCloudStretchRenderer ../../../../renderers/PointCloudUniqueValueRenderer ./I3SBinaryReader".split(" "),function(n,g,c,
a,f,b){function l(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b&&null!=d.attributeValues&&"UInt8"===d.attributeValues.valueType&&3===d.attributeValues.valuesPerElement)return{storageInfo:d,useElevation:!1}}return null}function e(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.name===b)return a="embedded-elevation"===d.encoding,{storageInfo:a?null:d,useElevation:a}}return"elevation"===b.toLowerCase()?{storageInfo:null,useElevation:!0}:null}function h(a,c,e,f){if(a&&a.useElevation){a=new Float64Array(f);
for(c=0;c<f;c++)a[c]=e[3*c+2];return a}return a&&c?b.readBinaryAttribute(a.storageInfo,c,f):null}function m(a){return null==a||"none"===a?null:"low-four-bit"===a?function(a){return a&15}:"high-four-bit"===a?function(a){return(a&240)>>4}:"absolute-value"===a?function(a){return Math.abs(a)}:"modulo-ten"===a?function(a){return a%10}:null}Object.defineProperty(g,"__esModule",{value:!0});g.getRendererInfo=function(a){var b=a.renderer,c=b&&b.type,f=b&&a.renderer.toJSON()||null,g=null,h=!1;"point-cloud-unique-value"===
c?g=e(a.attributeStorageInfo,b.field):"point-cloud-stretch"===c?g=e(a.attributeStorageInfo,b.field):"point-cloud-class-breaks"===c?g=e(a.attributeStorageInfo,b.field):(g="point-cloud-rgb"===c?l(a.attributeStorageInfo,b.field):l(a.attributeStorageInfo,"RGB"),h=null!=g);c=null;b&&b.colorModulation&&(c=e(a.attributeStorageInfo,b.colorModulation.field));return{rendererJSON:f,isRGBRenderer:h,primaryAttribute:g,modulationAttribute:c}};g.evaluateRenderer=function(b,d,e,g,l){var k=b.rendererJSON,p=b.isRGBRenderer,
q=b.modulationAttribute;b=h(b.primaryAttribute,d,g,l);e=h(q,e,g,l);q=g=null;if(b&&p)g=b;else if(b&&"pointCloudUniqueValueRenderer"===k.type){var q=f.fromJSON(k),r=q.colorUniqueValueInfos;g=new Uint8Array(3*l);p=m(q.fieldTransformType);for(k=0;k<l;k++){d=p?p(b[k]):b[k];d+="";for(var n=0;n<r.length;n++)if(0<=r[n].values.indexOf(d)){g[3*k]=r[n].color.r;g[3*k+1]=r[n].color.g;g[3*k+2]=r[n].color.b;break}}}else if(b&&"pointCloudStretchRenderer"===k.type)for(q=a.fromJSON(k),r=q.stops,g=new Uint8Array(3*
l),p=m(q.fieldTransformType),k=0;k<l;k++)if(d=p?p(b[k]):b[k],n=r.length-1,d<r[0].value)g[3*k]=r[0].color.r,g[3*k+1]=r[0].color.g,g[3*k+2]=r[0].color.b;else if(d>=r[n].value)g[3*k]=r[n].color.r,g[3*k+1]=r[n].color.g,g[3*k+2]=r[n].color.b;else for(n=1;n<r.length;n++){if(d<r[n].value){d=(d-r[n-1].value)/(r[n].value-r[n-1].value);g[3*k]=r[n].color.r*d+r[n-1].color.r*(1-d);g[3*k+1]=r[n].color.g*d+r[n-1].color.g*(1-d);g[3*k+2]=r[n].color.b*d+r[n-1].color.b*(1-d);break}}else if(b&&"pointCloudClassBreaksRenderer"===
k.type)for(q=c.fromJSON(k),r=q.colorClassBreakInfos,g=new Uint8Array(3*l),p=m(q.fieldTransformType),k=0;k<l;k++)for(d=p?p(b[k]):b[k],n=0;n<r.length;n++){if(d>=r[n].minValue&&d<=r[n].maxValue){g[3*k]=r[n].color.r;g[3*k+1]=r[n].color.g;g[3*k+2]=r[n].color.b;break}}else for(g=new Uint8Array(3*l),k=0;k<g.length;k++)g[k]=255;if(e&&q&&q.colorModulation)for(b=q.colorModulation.minValue,q=q.colorModulation.maxValue,k=0;k<l;k++)d=e[k],p=d>=q?1:d<=b?.3:.3+.7*(d-b)/(q-b),g[3*k]*=p,g[3*k+1]*=p,g[3*k+2]*=p;return g};
g.getSplatSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"splat"===a.type?a:null};g.getFixedSizeAlgorithm=function(a){return(a=a&&a.pointSizeAlgorithm)&&"fixed-size"===a.type?a:null};g.rendererUsesFixedSizes=function(a){return(a=a&&a.pointSizeAlgorithm)&&a.type?"fixed-size"===a.type:!1}})},"esri/renderers/PointCloudClassBreaksRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorClassBreakInfo".split(" "),
function(n,g,c,a,f,b,l,e,h,m){return function(g){function d(a){a=g.call(this)||this;a.type="point-cloud-class-breaks";a.field=null;a.legendOptions=null;a.fieldTransformType=null;a.colorClassBreakInfos=null;return a}a(d,g);k=d;d.prototype.clone=function(){return new k(c({},this.cloneProperties(),{field:this.field,fieldTransformType:this.fieldTransformType,colorClassBreakInfos:b.clone(this.colorClassBreakInfos),legendOptions:b.clone(this.legendOptions)}))};var k;f([l.enumeration.serializable()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks"})],
d.prototype,"type",void 0);f([l.property({json:{write:!0},type:String})],d.prototype,"field",void 0);f([l.property({type:h.default,json:{write:!0}})],d.prototype,"legendOptions",void 0);f([l.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);f([l.property({type:[m.default],json:{write:!0}})],d.prototype,"colorClassBreakInfos",
void 0);return d=k=f([l.subclass("esri.renderers.PointCloudClassBreaksRenderer")],d)}(l.declared(e))})},"esri/renderers/PointCloudRenderer":function(){define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/JSONSupport ../core/kebabDictionary ../core/lang ../core/accessorSupport/decorators ./support/pointCloud/ColorModulation ./support/pointCloud/pointSizeAlgorithmJSONUtils ./support/pointCloud/pointSizeAlgorithmTypeUtils".split(" "),function(n,g,c,
a,f,b,l,e,h,m,k){var d=b.strict()({pointCloudClassBreaksRenderer:"point-cloud-class-breaks",pointCloudRGBRenderer:"point-cloud-rgb",pointCloudStretchRenderer:"point-cloud-stretch",pointCloudUniqueValueRenderer:"point-cloud-unique-value"});n=function(b){function f(a){a=b.call(this)||this;a.type=void 0;a.pointSizeAlgorithm=null;a.colorModulation=null;a.pointsPerInch=10;return a}c(f,b);f.prototype.clone=function(){console.warn(".clone() is not implemented for "+this.declaredClass);return null};f.prototype.cloneProperties=
function(){return{pointSizeAlgorithm:l.clone(this.pointSizeAlgorithm),colorModulation:l.clone(this.colorModulation),pointsPerInch:l.clone(this.pointsPerInch)}};a([e.property({type:d.apiValues,readOnly:!0,nonNullable:!0,json:{type:d.jsonValues,read:!1,write:d.write}})],f.prototype,"type",void 0);a([e.property({types:k.pointSizeAlgorithmTypes,json:{read:m.read,write:!0}})],f.prototype,"pointSizeAlgorithm",void 0);a([e.property({type:h.default,json:{write:!0}})],f.prototype,"colorModulation",void 0);
a([e.property({json:{write:!0},nonNullable:!0,type:Number})],f.prototype,"pointsPerInch",void 0);return f=a([e.subclass("esri.renderers.PointCloudRenderer")],f)}(e.declared(f));(n||(n={})).fieldTransformTypeKebabDict=b({none:"none",lowFourBit:"low-four-bit",highFourBit:"high-four-bit",absoluteValue:"absolute-value",moduloTen:"modulo-ten"});return n})},"esri/renderers/support/pointCloud/ColorModulation":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(f){function e(){var a=null!==f&&f.apply(this,arguments)||this;a.field=null;a.minValue=0;a.maxValue=255;return a}c(e,f);g=e;e.prototype.clone=function(){return new g({field:this.field,minValue:this.minValue,maxValue:this.maxValue})};var g;a([b.property({type:String,json:{write:!0}})],e.prototype,"field",void 0);a([b.property({type:Number,nonNullable:!0,json:{write:!0}})],e.prototype,"minValue",void 0);a([b.property({type:Number,
nonNullable:!0,json:{write:!0}})],e.prototype,"maxValue",void 0);return e=g=a([b.subclass("esri.renderers.support.pointCloud.ColorModulation")],e)}(b.declared(f));g.ColorModulation=n;g.default=n})},"esri/renderers/support/pointCloud/pointSizeAlgorithmJSONUtils":function(){define(["require","exports","../../../core/Warning","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});var b={pointCloudFixedSizeAlgorithm:a.default,
pointCloudSplatAlgorithm:f.default};g.read=function(a,e,f){if(e=a?b[a.type]||null:null)return e=new e,e.read(a,f),e;f&&f.messages&&a&&f.messages.push(new c("pointsizealgorithm:unsupported","Point size algorithms of type '"+(a.type||"unknown")+"' are not supported",{definition:a,context:f}));return null};g.fromJSON=function(a){var c=a?b[a.type]||null:null;return c?c.fromJSON(a):null}})},"esri/renderers/support/pointCloud/PointSizeFixedSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),
function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.type="fixed-size";a.size=0;a.useRealWorldSymbolSizes=null;return a}c(e,b);g=e;e.prototype.clone=function(){return new g({size:this.size,useRealWorldSymbolSizes:this.useRealWorldSymbolSizes})};var g;a([f.enumeration.serializable()({pointCloudFixedSizeAlgorithm:"fixed-size"})],e.prototype,"type",void 0);a([f.property({type:Number,nonNullable:!0,json:{write:!0}})],
e.prototype,"size",void 0);a([f.property({type:Boolean,json:{write:!0}})],e.prototype,"useRealWorldSymbolSizes",void 0);return e=g=a([f.subclass("esri.renderers.support.pointCloud.PointSizeFixedSizeAlgorithm")],e)}(f.declared(b.default));g.PointSizeFixedSizeAlgorithm=n;g.default=n})},"esri/renderers/support/pointCloud/PointSizeAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/JSONSupport ../../../core/kebabDictionary ../../../core/accessorSupport/decorators".split(" "),
function(n,g,c,a,f,b,l){Object.defineProperty(g,"__esModule",{value:!0});g.typeKebabDictionary=b({pointCloudFixedSizeAlgorithm:"fixed-size",pointCloudSplatAlgorithm:"splat"});n=function(b){function e(){return null!==b&&b.apply(this,arguments)||this}c(e,b);a([l.property({type:g.typeKebabDictionary.apiValues,readOnly:!0,nonNullable:!0,json:{type:g.typeKebabDictionary.jsonValues,read:!1,write:g.typeKebabDictionary.write}})],e.prototype,"type",void 0);return e=a([l.subclass("esri.renderers.support.pointCloud.PointSizeAlgorithm")],
e)}(l.declared(f));g.PointSizeAlgorithm=n;g.default=n})},"esri/renderers/support/pointCloud/PointSizeSplatAlgorithm":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/accessorSupport/decorators ./PointSizeAlgorithm".split(" "),function(n,g,c,a,f,b){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function e(){var a=null!==b&&b.apply(this,arguments)||this;a.type="splat";a.scaleFactor=1;return a}c(e,b);
g=e;e.prototype.clone=function(){return new g({scaleFactor:this.scaleFactor})};var g;a([f.enumeration.serializable()({pointCloudSplatAlgorithm:"splat"})],e.prototype,"type",void 0);a([f.property({type:Number,value:1,nonNullable:!0,json:{write:!0}})],e.prototype,"scaleFactor",void 0);return e=g=a([f.subclass("esri.renderers.support.pointCloud.PointSizeSplatAlgorithm")],e)}(f.declared(b.default));g.PointSizeSplatAlgorithm=n;g.default=n})},"esri/renderers/support/pointCloud/pointSizeAlgorithmTypeUtils":function(){define(["require",
"exports","./PointSizeAlgorithm","./PointSizeFixedSizeAlgorithm","./PointSizeSplatAlgorithm"],function(n,g,c,a,f){Object.defineProperty(g,"__esModule",{value:!0});g.pointSizeAlgorithmTypes={key:"type",base:c.default,typeMap:{"fixed-size":a.default,splat:f.default}}})},"esri/renderers/support/pointCloud/ColorClassBreakInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(n,g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.minValue=0;a.maxValue=0;a.color=null;return a}c(g,b);d=g;g.prototype.clone=function(){return new d({description:this.description,label:this.label,minValue:this.minValue,maxValue:this.maxValue,color:l.clone(this.color)})};var d;a([e.property({type:String,json:{write:!0}})],g.prototype,"description",void 0);a([e.property({type:String,
json:{write:!0}})],g.prototype,"label",void 0);a([e.property({type:Number,json:{read:{source:"classMinValue"},write:{target:"classMinValue"}}})],g.prototype,"minValue",void 0);a([e.property({type:Number,json:{read:{source:"classMaxValue"},write:{target:"classMaxValue"}}})],g.prototype,"maxValue",void 0);a([e.property({type:f,json:{type:[h.Integer],write:!0}})],g.prototype,"color",void 0);return g=d=a([e.subclass("esri.renderers.support.pointCloud.ColorClassBreakInfo")],g)}(e.declared(b));g.ColorClassBreakInfo=
n;g.default=n})},"esri/renderers/PointCloudStretchRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/StopInfo".split(" "),function(n,g,c,a,f,b,l,e,h,m){return function(g){function d(a){a=g.call(this)||this;a.type="point-cloud-stretch";a.field=null;a.legendOptions=null;a.fieldTransformType=
null;a.stops=null;return a}a(d,g);k=d;d.prototype.clone=function(){return new k(c({},this.cloneProperties(),{field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),stops:b.clone(this.stops),legendOptions:b.clone(this.legendOptions)}))};var k;f([l.enumeration.serializable()({pointCloudStretchRenderer:"point-cloud-stretch"})],d.prototype,"type",void 0);f([l.property({json:{write:!0},type:String})],d.prototype,"field",void 0);f([l.property({type:h.default,json:{write:!0}})],d.prototype,
"legendOptions",void 0);f([l.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);f([l.property({type:[m.default],json:{write:!0}})],d.prototype,"stops",void 0);return d=k=f([l.subclass("esri.renderers.PointCloudStretchRenderer")],d)}(l.declared(e))})},"esri/renderers/support/pointCloud/StopInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),
function(n,g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.label=null;a.value=0;a.color=null;return a}c(g,b);d=g;g.prototype.clone=function(){return new d({label:this.label,value:this.value,color:l.clone(this.color)})};var d;a([e.property({type:String,json:{write:!0}})],g.prototype,"label",void 0);a([e.property({type:Number,nonNullable:!0,json:{write:!0}})],g.prototype,"value",void 0);a([e.property({type:f,
json:{type:[h.Integer],write:!0}})],g.prototype,"color",void 0);return g=d=a([e.subclass("esri.renderers.support.pointCloud.StopInfo")],g)}(e.declared(b));g.StopInfo=n;g.default=n})},"esri/renderers/PointCloudUniqueValueRenderer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/lang ../core/accessorSupport/decorators ./PointCloudRenderer ./support/LegendOptions ./support/pointCloud/ColorUniqueValueInfo".split(" "),
function(n,g,c,a,f,b,l,e,h,m){return function(g){function d(a){a=g.call(this)||this;a.type="point-cloud-unique-value";a.field=null;a.fieldTransformType=null;a.colorUniqueValueInfos=null;a.legendOptions=null;return a}a(d,g);k=d;d.prototype.clone=function(){return new k(c({},this.cloneProperties(),{field:b.clone(this.field),fieldTransformType:b.clone(this.fieldTransformType),colorUniqueValueInfos:b.clone(this.colorUniqueValueInfos),legendOptions:b.clone(this.legendOptions)}))};var k;f([l.enumeration.serializable()({pointCloudUniqueValueRenderer:"point-cloud-unique-value"})],
d.prototype,"type",void 0);f([l.property({json:{write:!0},type:String})],d.prototype,"field",void 0);f([l.property({type:e.fieldTransformTypeKebabDict.apiValues,json:{type:e.fieldTransformTypeKebabDict.jsonValues,read:e.fieldTransformTypeKebabDict.read,write:e.fieldTransformTypeKebabDict.write}})],d.prototype,"fieldTransformType",void 0);f([l.property({type:[m.default],json:{write:!0}})],d.prototype,"colorUniqueValueInfos",void 0);f([l.property({type:h.default,json:{write:!0}})],d.prototype,"legendOptions",
void 0);return d=k=f([l.subclass("esri.renderers.PointCloudUniqueValueRenderer")],d)}(l.declared(e))})},"esri/renderers/support/pointCloud/ColorUniqueValueInfo":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Color ../../../core/JSONSupport ../../../core/lang ../../../core/accessorSupport/decorators ../../../core/accessorSupport/ensureType".split(" "),function(n,g,c,a,f,b,l,e,h){Object.defineProperty(g,"__esModule",{value:!0});
n=function(b){function g(){var a=null!==b&&b.apply(this,arguments)||this;a.description=null;a.label=null;a.values=null;a.color=null;return a}c(g,b);d=g;g.prototype.clone=function(){return new d({description:this.description,label:this.label,values:l.clone(this.values),color:l.clone(this.color)})};var d;a([e.property({type:String,json:{write:!0}})],g.prototype,"description",void 0);a([e.property({type:String,json:{write:!0}})],g.prototype,"label",void 0);a([e.property({type:[String],json:{write:!0}})],
g.prototype,"values",void 0);a([e.property({type:f,json:{type:[h.Integer],write:!0}})],g.prototype,"color",void 0);return g=d=a([e.subclass("esri.renderers.support.pointCloud.ColorUniqueValueInfo")],g)}(e.declared(b));g.ColorUniqueValueInfo=n;g.default=n})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("require exports ../../../../request ../../../../core/Error ../../../../core/promiseUtils ../../../../core/urlUtils ../../../../geometry/SpatialReference ../../../../geometry/support/webMercatorUtils ../../../../tasks/QueryTask ../../../../tasks/support/Query ./I3SBinaryReader ../../support/projectionUtils ../../support/buffer/typedArrayUtil".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q){function p(a){return a&&parseInt(a.substring(a.lastIndexOf("/")+1,a.length),10)}function r(a,b,c,e,f,g){if(null!=c){var h=c.mbs;b!==e&&(h=N,d.mbsToMbs(c.mbs,e,h,b));if(0!==u(a,h)&&(g(c),c.children))for(h=0;h<c.children.length;++h)r(a,b,f[c.children[h].id],e,f,g)}}function u(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=0;if(c<a[0])var g=a[0]-c,f=f+g*g;d<a[1]&&(g=a[1]-d,f+=g*g);e<a[2]&&(g=a[2]-e,f+=g*g);c>a[3]&&(g=c-a[3],f+=g*g);d>a[4]&&(g=d-a[4],f+=g*g);e>a[5]&&(g=
e-a[5],f+=g*g);if(f>b*b)return 0;if(0<f)return 1;f=Infinity;c-a[0]<f&&(f=c-a[0]);d-a[1]<f&&(f=d-a[1]);e-a[2]<f&&(f=e-a[2]);a[3]-c<f&&(f=a[3]-c);a[4]-d<f&&(f=a[4]-d);a[5]-e<f&&(f=a[5]-e);return f>b?2:1}function t(a,b,c){var d=[],e=c&&c.missingFields;c=c&&c.originalFields;for(var f=0;f<a.length;f++){for(var g=a[f],h=g.toLowerCase(),k=!1,l=0,m=b;l<m.length;l++){var p=m[l];if(h===p.name.toLowerCase()){d.push(p.name);k=!0;c&&c.push(g);break}}!k&&e&&e.push(g)}return d}function v(a,b){return a.filter(function(a){return a.toLowerCase()!==
b.toLowerCase()}).concat([b])}function A(a,b,c,d){b.sort(function(a,b){return a.attributes[c]-b.attributes[c]});var e=b.map(function(a){return a.attributes[c]}),f=[],g=t(d,a.fields,{originalFields:f});return x(a,e,g).then(function(a){for(var c=0;c<b.length;c++){var d=b[c],e=a[c];d.attributes={};for(var h=0;h<f.length;h++)d.attributes[f[h]]=e[g[h]]}return b})}function z(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];e in b.attributes||c.push(e)}return c}function x(b,c,d){if(null!=b.maxRecordCount&&
c.length>b.maxRecordCount){var e=C(c,b.maxRecordCount);return f.all(e.map(function(a){return x(b,a,d)})).then(G)}e=new m({objectIds:c,outFields:d,orderByFields:[b.objectIdField]});return(new h(b.parsedUrl.path)).execute(e).then(function(b){return b&&b.features&&b.features.length===c.length?b.features.map(function(a){return a.attributes}):f.reject(new a("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer"))})}function B(d,e,g,h,l){for(var m=[],p=0;p<e.attributeData.length;p++){var q=
e.attributeData[p],n=d[p];n&&-1!==h.indexOf(n.name)&&(q=b.makeAbsolute(q.href,e.baseUrl),m.push({url:q,storageInfo:n}))}return f.eachAlways(m.map(function(a){return c(a.url,{responseType:"array-buffer"}).then(function(b){return k.readBinaryAttribute(a.storageInfo,b.data)})})).then(function(b){var c=[];if(!l.ignoreUnavailableFields&&b.some(function(a){return null==a.value})){for(var c=[],d=0;d<b.length;d++)null==b[d].value&&c.push({name:m[d].storageInfo.name,error:b[d].error});return f.reject(new a("scenelayer:attribute-request-failed",
"Request for scene layer attributes failed",{failedAttributes:c}))}for(var e=0;e<g.length;e++){for(var h=g[e],k={},d=0;d<b.length;d++)null!=b[d].value&&(k[m[d].storageInfo.name]=D(b[d].value,h));c.push(k)}return c})}function D(a,b){b=a[b];return q.isInt16Array(a)?b===H?null:b:q.isInt32Array(a)?b===M?null:b:b!==b?null:b}function C(a,b){var c=a.length;b=Math.ceil(c/b);for(var d=[],e=0;e<b;e++)d.push(a.slice(Math.floor(c*e/b),Math.floor(c*(e+1)/b)));return d}function G(a){for(var b=[],c=0;c<a.length;c++)b=
b.concat(a[c]);return b}function E(a){var b=new l(p(a.store.indexCRS||a.store.geographicCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function F(a){var b=new l(p(a.store.vertexCRS||a.store.projectedCRS));return b.equals(a.spatialReference)?a.spatialReference:b}function I(b,c,d){if(!e.canProject(b,c))throw new a("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===d&&b.isGeographic)throw new a("layerview:local-gcs-not-supported",
"Geographic coordinate systems are not supported in local scenes",{});}function K(a,b,c){var d=E(a);a=F(a);I(d,b,c);I(a,b,c)}Object.defineProperty(g,"__esModule",{value:!0});g.DDS_ENCODING_STRING="image/vnd-ms.dds";g.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS=["image/jpeg","image/png"];g.extractWkid=p;g.getAppropriateTextureEncoding=function(a,b){if(Array.isArray(a)){if(b&&(b=a.indexOf(g.DDS_ENCODING_STRING),-1<b))return b;for(b=0;b<a.length;b++)if(-1<g.BROWSER_SUPPORTED_IMAGE_ENCODING_STRINGS.indexOf(a[b]))return b;
throw Error("Could not find appropriate texture encoding (among "+a.toString()+")");}return-1};g.findIntersectingNodes=r;g.buildTopNodeMap=function(a,b,c,d){void 0===d&&(d=Number.POSITIVE_INFINITY);if(0>=b)a.clear();else{var e=new Map,f=Number.POSITIVE_INFINITY;a.forEach(function(g,h){var k=c(g);if(h<b)f=Math.min(f,k),e.set(g.id,k);else if(!(k<=f||k>=d)){e.set(g.id,k);h=f=e.get(a.front().id);for(var k=0,l=1;l<b;++l){var m=e.get(a.data[l].id);m<f&&(k=l,h=f,f=m)}a.data[k]=g;f=h}});a.length=Math.min(a.length,
b);a.sort(function(a,b){return e.get(b.id)-e.get(a.id)})}};var N=[0,0,0,0];g.intersectBoundingBoxWithMbs=u;g.findFieldsCaseInsensitive=t;g.whenGraphicAttributes=function(b,c,d,e,g,h){var k=!0===(h&&h.populateObjectId),l=h.ignoreUnavailableFields?void 0:[],m=1===e.length&&"*"===e[0];!m&&k&&(e=v(e,d));e=m?e:t(e,b.fields,{missingFields:l});if(l&&0!==l.length)return f.reject(new a("scenelayer:unknown-fields","This scene layer does not have the requested fields",{unknownFields:l}));if(0===c.length)return f.resolve(c);
var k=b.associatedLayer,l=b.attributeStorageInfo,p=m?b.fields.map(function(a){return a.name}):e;if(k)return A(k,c,d,p);b=z(p,c[0]);return 0===b.length?f.resolve(c):l?(g=g(),null==g?f.reject(new a("scenelayer:feature-not-loaded","Tried to query attributes for unloaded features")):B(l,g.node,g.indices,b,h).then(function(a){for(var b=0;b<c.length;b++){for(var d=0,e=p;d<e.length;d++){var f=e[d];f in a[b]||(a[b][f]=c[b].attributes[f])}c[b].attributes=a[b]}return c})):f.reject(new a("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available"))};var H=-Math.pow(2,15),M=-Math.pow(2,31);g.getCachedAttributeValue=D;g.convertFlatRangesToOffsets=function(b,c,d){void 0===d&&(d=2);c=null!=c?c:b.length/d;for(var e=new Uint32Array(c+1),f=0;f<c;f++){var g=b[f*d];e[f]=3*g;var h=(f-1)*d+1;if(0<=h&&g-1!==b[h])throw new a("Face ranges are not continuous");}e[e.length-1]=3*(b[(c-1)*d+1]+1);return e};g.getIndexCrs=E;g.getVertexCrs=F;g.getCacheKeySuffix=function(a,b){return b===d.SphericalECEFSpatialReference?
"@ECEF":a.equals(b)?"":null!=b.wkid?"@"+b.wkid:null};g.checkSpatialReference=I;g.checkSpatialReferences=K;g.checkSceneLayerValid=function(b){var c;(c=null==b.store||null==b.store.defaultGeometrySchema)||(b=b.store.defaultGeometrySchema,c=!!(null!=b.geometryType&&"triangles"!==b.geometryType||null!=b.topology&&"PerAttributeArray"!==b.topology||null==b.vertexAttributes||null==b.vertexAttributes.position));if(c)throw new a("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",
{});};g.checkSceneLayerCompatibleWithView=function(a,b){K(a,b.spatialReference,b.viewingMode)};g.checkPointCloudLayerValid=function(b){var c;(c=null==b.store||null==b.store.defaultGeometrySchema)||(b=b.store.defaultGeometrySchema,c=!!(null==b.geometryType||"points"!==b.geometryType||null!=b.topology&&"PerAttributeArray"!==b.topology||null!=b.encoding&&""!==b.encoding&&"lepcc-xyz"!==b.encoding||null==b.vertexAttributes||null==b.vertexAttributes.position));if(c)throw new a("pointcloud:unsupported-geometry-schema",
"The geometry schema of this point cloud scene layer is not supported.",{});};g.checkPointCloudLayerCompatibleWithView=function(a,b){I(a.spatialReference,b.spatialReference,b.viewingMode)};g.rendererNeedsTextures=function(a){if(null==a||"simple"!==a.type&&"class-breaks"!==a.type&&"unique-value"!==a.type||("unique-value"===a.type||"class-breaks"===a.type)&&null==a.defaultSymbol)return!0;a=a.getSymbols();if(0===a.length)return!0;for(var b=0;b<a.length;b++){var c=a[b];if("mesh-3d"!==c.type||0===c.symbolLayers.length)return!0;
for(var d=0,c=c.symbolLayers.items;d<c.length;d++){var e=c[d];if("fill"!==e.type||null==e.material||"replace"!==e.material.colorMixMode)return!0}}return!1};var T=function(){return function(){this.material=this.edges=null}}();g.SymbolInfo=T;g.getSymbolInfo=function(a){var b=new T,c=!1,d=!1,e=0;for(a=a.symbolLayers.items;e<a.length;e++){var f=a[e];if("fill"===f.type&&f.enabled){var g=f.material,h=f.edges;g&&!c&&(c=g.color,b.material={color:c?[c.r/255,c.g/255,c.b/255]:null,alpha:c?c.a:null,colorMixMode:g.colorMixMode},
c=!0);h&&!d&&(b.edges=f.edges,d=!0)}}return b}})},"esri/views/3d/layers/i3s/IdleQueue":function(){define(["require","exports","dojo/Deferred","dojo/errors/CancelError"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function f(){this._deferreds=[];this._values=[]}f.prototype.push=function(a){var b=new c;this._deferreds.push(b);this._values.push(a);return b.promise};f.prototype.unshift=function(a){var b=new c;this._deferreds.unshift(b);this._values.unshift(a);return b.promise};
f.prototype.length=function(){return this._deferreds.length};f.prototype.process=function(){this._deferreds.shift().resolve(this._values.shift())};f.prototype.cancelAll=function(){for(var b=new a,c=0,e=this._deferreds;c<e.length;c++)e[c].cancel(b);this._deferreds.length=0;this._values.length=0};return f}();g.IdleQueue=n})},"esri/views/3d/layers/i3s/LoDUtil":function(){define(["require","exports","../../lib/gl-matrix"],function(n,g,c){function a(a,b,c){for(;0<a;){var d=b.indexOf(a);if(0<=d)return d;
a=c.getParentId(a)}return b.indexOf(a)}function f(a,b){for(var c=[a.remove[0]],e=[];1===c.length;)for(var f=c.pop(),g=e.length=0;g<a.load.length;g++){for(var h=a.load[g],k=b.getParentId(h);k!==f;)h=k,k=b.getParentId(h);k=c.indexOf(h);0>k&&(k=c.length,c.push(h),e.push([]));e[k].push(a.load[g])}b=[];b.push({remove:a.remove,load:c});for(g=0;g<c.length;g++)1<e[g].length?b.push({remove:[c[g]],load:e[g]}):c[g]=e[g][0];return b}Object.defineProperty(g,"__esModule",{value:!0});g.nodeDiff=function(c,f,d){for(var g=
0;g<f.length;g++)e[g]=!1,h[g]=null;for(g=0;g<c.length;g++)b[g]=!1,l[g]=null;for(g=0;g<f.length;g++){var k=a(f[g],c,d);0<=k&&(e[g]=!0,null!=l[k]?l[k].push(f[g]):l[k]=[f[g]])}for(g=0;g<c.length;g++)k=a(c[g],f,d),0<=k&&(b[g]=!0,null!=h[k]?h[k].push(c[g]):h[k]=[c[g]]);d=[];for(g=0;g<c.length;g++)null!=l[g]||b[g]||d.push({load:[],remove:[c[g]]});for(g=0;g<f.length;g++)null!=h[g]||e[g]||d.push({load:[f[g]],remove:[]});for(g=0;g<f.length;g++)null!=h[g]&&(1<h[g].length||h[g][0]!==f[g])&&d.push({load:[f[g]],
remove:h[g]});for(g=0;g<c.length;g++)null!=l[g]&&(1<l[g].length||l[g][0]!==c[g])&&d.push({load:l[g],remove:[c[g]]});return d};var b=[!1],l=[null],e=[!1],h=[null];g.sortFrontToBack=function(a,b,d){return a.sort(function(a,e){if(0===a.load.length&&0===e.load.length)return 0;if(0===a.load.length)return-1;if(0===e.load.length)return 1;if(0===a.remove.length&&0===e.remove.length)return a=d.getRenderCenter(a.load[0]),e=d.getRenderCenter(e.load[0]),c.vec3d.dot(a,b)-c.vec3d.dot(e,b);if(0===a.remove.length)return-1;
if(0===e.remove.length)return 1;if(1===a.load.length&&1===e.load.length)return a=d.getRenderCenter(a.load[0]),e=d.getRenderCenter(e.load[0]),c.vec3d.dot(a,b)-c.vec3d.dot(e,b);if(1===a.load.length)return-1;if(1===e.load.length)return 1;a=d.getRenderCenter(a.remove[0]);e=d.getRenderCenter(e.remove[0]);return c.vec3d.dot(a,b)-c.vec3d.dot(e,b)})};g.splitWorkEntries=function(a,b,c){for(var d=0;d<a.length;++d){var e=a[d];if(e.load.length>b&&1===e.remove.length){e=f(e,c);a[d]=e[0];for(var g=1;g<e.length;g++)a.push(e[g])}}};
g.splitWorkEntry=f})},"esri/views/3d/layers/i3s/PagedNodeIndex":function(){define("require exports ../../../../geometry/support/aaBoundingBox ../../lib/gl-matrix ../../support/orientedBoundingBox ../../support/projectionUtils".split(" "),function(n,g,c,a,f,b){var l=a.vec3d.create();n=function(){function g(a,b,c){this._pages=[];this.pageSize=0;this._renderSR=this._nodeSR=null;this._nodeSR=a;this._renderSR=b;this.pageSize=c}g.prototype.addPage=function(c,d,g){for(void 0===g&&(g=0);this._pages.length<
c;)this._pages.push(null);for(var k=this._nodeSR,m=this._renderSR,q=new f.ObbArray(d.length),n=0;n<d.length;n++){var v=d[n].obb,A=q.obbs[n];f.set(v,A);a.vec3d.set3(v.center[0],v.center[1],v.center[2]+g,l);k.isGeographic||m!==b.SphericalECEFSpatialReference||(b.computeLinearTransformation(k,l,e,m),v=2*Math.sqrt(1+e[0]+e[5]+e[10]),h[0]=(e[9]-e[6])/v,h[1]=(e[2]-e[8])/v,h[2]=(e[4]-e[1])/v,h[3]=.25*v,a.quat4.conjugate(h),a.quat4.multiply(h,A.quaternion,A.quaternion));b.bufferToBuffer(l,k,0,A.center,m,
0,1)}this._pages[c]={nodes:d,renderObbs:q.obbs,parents:new Uint32Array(this.pageSize)};c=this._pages;d=this.pageSize;for(k=[0];k.length;)for(m=k.pop(),g=c[m/d|0].nodes[m%d],q=0;q<g.childCount;q++)n=g.firstChild+q,null!=c[n/d|0]&&(c[n/d|0].parents[n%d]=m,k.push(n))};g.prototype.hasPage=function(a){return!!this._pages[a]};g.prototype.getNode=function(a){var b=this.pageSize;return this._pages[a/b|0].nodes[a%b]};g.prototype.getRenderObb=function(a){var b=this.pageSize;return this._pages[a/b|0].renderObbs[a%
b]};g.prototype.getRenderCenter=function(a){return this.getRenderObb(a).center};g.prototype.setRenderObb=function(a,b){var c=this.pageSize;f.set(b,this._pages[a/c|0].renderObbs[a%c])};g.prototype.getParentId=function(a){var b=this.pageSize;return this._pages[a/b|0].parents[a%b]};g.prototype.hasNodes=function(a,b){b=(a+b-1)/this.pageSize|0;for(a=a/this.pageSize|0;a<=b;a++)if(null==this._pages[a])return!1;return!0};g.prototype.createVisibilityTraverse=function(){var a=this,b=[],e=[],g=c.create();return function(d,
h){if(a.hasNodes(0,1))for(b.length=0,b.push(0),e.length=0,e.push(0);0<b.length;){var k=b.pop(),l=e.pop(),m=a.getNode(k),p=a.getRenderObb(k),q=!0;if(null!=d.clippingBox){var n=1<<d.frustumPlanes.length;if(0===(l&n)){var r=f.toAaBoundingBox(p,g);c.contains(d.clippingBox,r)?l|=n:c.intersects(d.clippingBox,r)||(q=!1)}}for(r=0;r<d.frustumPlanes.length&&q;r++)if(n=1<<r,0===(l&n)){var u=f.intersectPlane(p,d.frustumPlanes[r]);0<u?q=!1:0>u&&(l|=n)}if(h.predicate(k,m,q)){p=m.firstChild;m=m.childCount;r=!1;
q=(p+m-1)/a.pageSize|0;for(n=p/a.pageSize|0;n<=q;n++)if(!a.hasPage(n)){h.pageMiss(k,n);r=!0;break}if(!r)for(r=0;r<m;r++)b.push(p+r),e.push(l)}}}};return g}();var e=a.mat4d.create(),h=a.quat4.create();return n})},"esri/views/3d/support/orientedBoundingBox":function(){define("require exports ../../../geometry/support/aaBoundingBox ../lib/gl-matrix ./dito ./geometryUtils".split(" "),function(n,g,c,a,f,b){function l(b,c,d){return{center:a.vec3d.createFrom(b[0],b[1],b[2]),halfSize:a.vec3.createFrom(c[0],
c[1],c[2]),quaternion:a.quat4.createFrom(d[0],d[1],d[2],d[3])}}function e(a,c){var d=b.plane.distance(c,a.center);a=h(a,c);return d>a?1:d<-a?-1:0}function h(b,c){a.quat4.conjugate(b.quaternion,m);a.quat4d.multiplyVec3(m,c,k);b=b.halfSize;return Math.abs(k[0]*b[0])+Math.abs(k[1]*b[1])+Math.abs(k[2]*b[2])}Object.defineProperty(g,"__esModule",{value:!0});var m=a.quat4.create(),k=a.vec3.create(),d=a.vec3.create(),q=a.mat3.create();n=function(){return function(a){this.buffer=new ArrayBuffer(56*a);this.obbs=
Array(a);for(var b=0;b<a;b++)this.obbs[b]={center:new Float64Array(this.buffer,56*b+0,3),halfSize:new Float32Array(this.buffer,56*b+24,3),quaternion:new Float32Array(this.buffer,56*b+36,4)}}}();g.ObbArray=n;g.create=l;g.clone=function(a){return l(a.center,a.halfSize,a.quaternion)};g.set=function(b,c){a.vec3d.set(b.center,c.center);a.vec3.set(b.halfSize,c.halfSize);a.quat4.set(b.quaternion,c.quaternion)};g.compute=function(a,b){b||(b=l([0,0,0],[-1,-1,-1],[0,0,0,1]));f.computeOBB(a,b);return b};g.intersectPlane=
e;g.toAaBoundingBox=function(b,d){d||(d=c.create());var e=a.quat4.toMat3(b.quaternion,q),f=b.halfSize[0]*Math.abs(e[0])+b.halfSize[1]*Math.abs(e[3])+b.halfSize[2]*Math.abs(e[6]),g=b.halfSize[0]*Math.abs(e[1])+b.halfSize[1]*Math.abs(e[4])+b.halfSize[2]*Math.abs(e[7]),e=b.halfSize[0]*Math.abs(e[2])+b.halfSize[1]*Math.abs(e[5])+b.halfSize[2]*Math.abs(e[8]);d[0]=b.center[0]-f;d[1]=b.center[1]-g;d[2]=b.center[2]-e;d[3]=b.center[0]+f;d[4]=b.center[1]+g;d[5]=b.center[2]+e;return d};g.minimumDistancePlane=
function(a,c){var d=b.plane.distance(c,a.center);a=h(a,c);return d-a};g.maximumDistancePlane=function(a,c){var d=b.plane.distance(c,a.center);a=h(a,c);return d+a};g.isVisible=function(a,b){return 0>=e(a,b[0])&&0>=e(a,b[1])&&0>=e(a,b[2])&&0>=e(a,b[3])&&0>=e(a,b[4])&&0>=e(a,b[5])};g.intersectLine=function(b,c,e,f){void 0===f&&(f=0);a.quat4.conjugate(b.quaternion,m);a.vec3d.subtract(c,b.center,k);c=a.quat4d.multiplyVec3(m,k,k);e=a.quat4d.multiplyVec3(m,e,d);for(var g=-Infinity,h=Infinity,l=0;3>l;l++)if(1E-6<
Math.abs(e[l]))var p=(f+b.halfSize[l]-c[l])/e[l],q=(-f-b.halfSize[l]-c[l])/e[l],g=Math.max(g,Math.min(p,q)),h=Math.min(h,Math.max(p,q));else if(c[l]>b.halfSize[l]+f||c[l]<-b.halfSize[l]-f)return!1;return g<=h}})},"esri/views/3d/support/dito":function(){define(["require","exports","../lib/gl-matrix"],function(n,g,c){function a(a,b,d,e,g,k){if(!(1E-6>c.vec3d.length2(b)))for(c.vec3d.cross(d,b,B),c.vec3d.cross(e,b,D),c.vec3d.cross(g,b,C),f(a,b,x),E[1]=x[0],G[1]=x[1],F[1]=G[1]-E[1],d=[d,e,g],e=[B,D,C],
g=0;3>g;++g){f(a,d[g],x);E[0]=x[0];G[0]=x[1];f(a,e[g],x);E[2]=x[0];G[2]=x[1];F[0]=G[0]-E[0];F[2]=G[2]-E[2];var l=h(F);l<k.quality&&(c.vec3d.set(d[g],k.b0),c.vec3d.set(b,k.b1),c.vec3d.set(e[g],k.b2),k.quality=l)}}function f(a,b,c){var d=a.data,e=a.offsetIdx;a=a.strideIdx;c[0]=Number.POSITIVE_INFINITY;for(c[1]=Number.NEGATIVE_INFINITY;e<d.length;e+=a){var f=d[e]*b[0]+d[e+1]*b[1]+d[e+2]*b[2];c[0]=Math.min(c[0],f);c[1]=Math.max(c[1],f)}}function b(a,b,d){c.vec3d.set(a,d.center);c.vec3d.scale(b,.5,d.halfSize);
c.quat4.identity(d.quaternion)}function l(a,b,c,d,e,g){f(a,b,x);e[0]=x[0];g[0]=x[1];f(a,c,x);e[1]=x[0];g[1]=x[1];f(a,d,x);e[2]=x[0];g[2]=x[1]}function e(a,b,d,e,f,g,h){J[0]=a[0];J[3]=a[1];J[6]=a[2];J[1]=b[0];J[4]=b[1];J[7]=b[2];J[2]=d[0];J[5]=d[1];J[8]=d[2];c.quat4.fromRotationMatrix(J,h.quaternion);c.vec3d.add(e,f,O);c.vec3d.scale(O,.5);c.vec3d.scale(a,O[0],h.center);c.vec3d.scale(b,O[1],U);c.vec3d.add(h.center,U);c.vec3d.scale(d,O[2],U);c.vec3d.add(h.center,U);c.vec3d.scale(g,.5,h.halfSize)}function h(a){return a[0]*
a[1]+a[0]*a[2]+a[1]*a[2]}Object.defineProperty(g,"__esModule",{value:!0});var m=c.vec3d.create(),k=c.vec3d.create();g.computeOBB=function(f,g){var n=f.data.length/f.strideIdx;if(!(0>=n)){var B=new P(f);c.vec3d.add(B.minProj,B.maxProj,m);c.vec3d.scale(m,.5);c.vec3d.subtract(B.maxProj,B.minProj,k);var D=h(k),C=new R;C.quality=D;14>n&&(f={data:new Float64Array(B.buffer,112,42),size:3,offsetIdx:0,strideIdx:3});var L=c.vec3d.create(),E=c.vec3d.create(),F=c.vec3d.create(),n=c.vec3d.create(),G=c.vec3d.create(),
Q=c.vec3d.create(),O=c.vec3d.create(),J;J=f;for(var U=c.vec3d.dist2(B.maxVert[0],B.minVert[0]),X=0,ma=1;7>ma;++ma){var oa=c.vec3d.dist2(B.maxVert[ma],B.minVert[ma]);oa>U&&(U=oa,X=ma)}c.vec3d.set(B.minVert[X],L);c.vec3d.set(B.maxVert[X],E);if(1E-6>c.vec3d.dist2(L,E))J=1;else{c.vec3d.subtract(L,E,n);c.vec3d.normalize(n);B=J.data;U=J.strideIdx;X=Number.NEGATIVE_INFINITY;ma=0;for(oa=J.offsetIdx;oa<B.length;oa+=U){c.vec3d.set3(B[oa]-L[0],B[oa+1]-L[1],B[oa+2]-L[2],z);var ka=n[0]*z[0]+n[1]*z[1]+n[2]*z[2],
w=c.vec3d.length2(n),ka=c.vec3d.length2(z)-ka*ka/w;ka>X&&(X=ka,ma=oa)}c.vec3d.set3(B[ma],B[ma+1],B[ma+2],F);1E-6>X?J=2:(c.vec3d.subtract(E,F,G),c.vec3d.normalize(G),c.vec3d.subtract(F,L,Q),c.vec3d.normalize(Q),c.vec3d.cross(G,n,O),c.vec3d.normalize(O),a(J,O,n,G,Q,C),J=0)}switch(J){case 1:b(m,k,g);return;case 2:D=f;c.vec3d.set(n,K);Math.abs(n[0])>Math.abs(n[1])&&Math.abs(n[0])>Math.abs(n[2])?K[0]=0:Math.abs(n[1])>Math.abs(n[2])?K[1]=0:K[2]=0;1E-6>c.vec3d.length2(K)&&(K[0]=K[1]=K[2]=1);c.vec3d.cross(n,
K,N);c.vec3d.normalize(N);c.vec3d.cross(n,N,H);c.vec3d.normalize(H);l(D,n,N,H,M,T);c.vec3d.subtract(T,M,V);e(n,N,H,M,T,V,g);return}J=f;B=d;U=q;X=x;ma=J.data;ka=J.offsetIdx;oa=J.strideIdx;c.vec3d.set3(ma[ka],ma[ka+1],ma[ka+2],U);c.vec3d.set(U,B);X[0]=c.vec3d.dot(I,O);X[1]=X[0];for(ka+=oa;ka<ma.length;ka+=oa)c.vec3d.set3(ma[ka],ma[ka+1],ma[ka+2],I),w=c.vec3d.dot(I,O),w<X[0]&&(X[0]=w,c.vec3d.set(I,U)),w>X[1]&&(X[1]=w,c.vec3d.set(I,B));O=c.vec3d.dot(L,O);x[1]-1E-6<=O&&(B[0]=void 0);x[0]+1E-6>=O&&(U[0]=
void 0);void 0!==d[0]&&(c.vec3d.subtract(d,L,p),c.vec3d.normalize(p),c.vec3d.subtract(d,E,r),c.vec3d.normalize(r),c.vec3d.subtract(d,F,u),c.vec3d.normalize(u),c.vec3d.cross(r,n,t),c.vec3d.normalize(t),c.vec3d.cross(u,G,v),c.vec3d.normalize(v),c.vec3d.cross(p,Q,A),c.vec3d.normalize(A),a(J,t,n,r,p,C),a(J,v,G,u,r,C),a(J,A,Q,p,u,C));void 0!==q[0]&&(c.vec3d.subtract(q,L,p),c.vec3d.normalize(p),c.vec3d.subtract(q,E,r),c.vec3d.normalize(r),c.vec3d.subtract(q,F,u),c.vec3d.normalize(u),c.vec3d.cross(r,n,t),
c.vec3d.normalize(t),c.vec3d.cross(u,G,v),c.vec3d.normalize(v),c.vec3d.cross(p,Q,A),c.vec3d.normalize(A),a(J,t,n,r,p,C),a(J,v,G,u,r,C),a(J,A,Q,p,u,C));l(f,C.b0,C.b1,C.b2,M,T);f=c.vec3d.create();c.vec3d.subtract(T,M,f);C.quality=h(f);C.quality<D?e(C.b0,C.b1,C.b2,M,T,f,g):b(m,k,g)}};var d=c.vec3d.create(),q=c.vec3d.create(),p=c.vec3d.create(),r=c.vec3d.create(),u=c.vec3d.create(),t=c.vec3d.create(),v=c.vec3d.create(),A=c.vec3d.create(),z=c.vec3d.create(),x=c.vec2d.create(),B=c.vec3d.create(),D=c.vec3d.create(),
C=c.vec3d.create(),G=c.vec3d.create(),E=c.vec3d.create(),F=c.vec3d.create(),I=c.vec3d.create(),K=c.vec3d.create(),N=c.vec3d.create(),H=c.vec3d.create(),M=c.vec3d.create(),T=c.vec3d.create(),V=c.vec3d.create(),U=c.vec3d.create(),J=c.mat3.create(),O=c.vec3d.create(),P=function(){return function(a){this.minVert=[];this.maxVert=[];this.buffer=new ArrayBuffer(448);var b=0;this.minProj=new Float64Array(this.buffer,b,7);b+=56;this.maxProj=new Float64Array(this.buffer,b,7);for(b+=56;7>this.minVert.length;)this.minVert.push(new Float64Array(this.buffer,
b,3)),b+=24;for(;7>this.maxVert.length;)this.maxVert.push(new Float64Array(this.buffer,b,3)),b+=24;for(b=0;7>b;++b)this.minProj[b]=Number.POSITIVE_INFINITY,this.maxProj[b]=Number.NEGATIVE_INFINITY;for(var d=[],e=[],f=a.data,g=a.strideIdx,b=a.offsetIdx;b<f.length;b+=g)a=f[b],a<this.minProj[0]&&(this.minProj[0]=a,d[0]=b),a>this.maxProj[0]&&(this.maxProj[0]=a,e[0]=b),a=f[b+1],a<this.minProj[1]&&(this.minProj[1]=a,d[1]=b),a>this.maxProj[1]&&(this.maxProj[1]=a,e[1]=b),a=f[b+2],a<this.minProj[2]&&(this.minProj[2]=
a,d[2]=b),a>this.maxProj[2]&&(this.maxProj[2]=a,e[2]=b),a=f[b]+f[b+1]+f[b+2],a<this.minProj[3]&&(this.minProj[3]=a,d[3]=b),a>this.maxProj[3]&&(this.maxProj[3]=a,e[3]=b),a=f[b]+f[b+1]-f[b+2],a<this.minProj[4]&&(this.minProj[4]=a,d[4]=b),a>this.maxProj[4]&&(this.maxProj[4]=a,e[4]=b),a=f[b]-f[b+1]+f[b+2],a<this.minProj[5]&&(this.minProj[5]=a,d[5]=b),a>this.maxProj[5]&&(this.maxProj[5]=a,e[5]=b),a=f[b]-f[b+1]-f[b+2],a<this.minProj[6]&&(this.minProj[6]=a,d[6]=b),a>this.maxProj[6]&&(this.maxProj[6]=a,e[6]=
b);for(b=0;7>b;++b)a=d[b],c.vec3d.set3(f[a],f[a+1],f[a+2],this.minVert[b]),a=e[b],c.vec3d.set3(f[a],f[a+1],f[a+2],this.maxVert[b])}}(),R=function(){return function(){this.b0=c.vec3d.createFrom(1,0,0);this.b1=c.vec3d.createFrom(0,1,0);this.b2=c.vec3d.createFrom(0,0,1);this.quality=0}}()})},"esri/views/3d/layers/i3s/PointRenderer":function(){define("require exports ../../../../geometry/support/aaBoundingBox ../../lib/gl-matrix ../../support/geometryUtils ../../support/orientedBoundingBox ../../webgl-engine/lib/ProgramRepository ../../webgl-engine/lib/RenderPass ../../webgl-engine/materials/internal/MaterialUtil ../../webgl-engine/shaders/PointRendererPrograms ../../../webgl/BufferObject ../../../webgl/VertexArrayObject".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d){function q(a,b,c,d,e){if(c.drawScreenSpace)return c.fixedSize*b*d;e=(e?256:64)*b*d;return c.drawFixedSize?Math.min(c.fixedSize/2,e):0<c.screenMinSize?Math.min(Math.max(c.screenMinSize*b*d,a/2),e):Math.min(a/2,e)}function p(b,c,d){null==d&&(d=a.vec3d.create());d[0]=b.origin[0]+b.coordinates[3*c];d[1]=b.origin[1]+b.coordinates[3*c+1];d[2]=b.origin[2]+b.coordinates[3*c+2];return d}var r={positions:[{name:"aPosition",count:3,type:5126,offset:0,stride:12,normalized:!1}],
colors:[{name:"aColor",count:3,type:5121,offset:0,stride:3,normalized:!0}]};n=function(){function g(){this.didRender=!1;this.needsRender=!0;this.layerUid="";this._useFixedSizes=!1;this._scaleFactor=1;this._minSizePx=0;this._useRealWorldSymbolSizes=!1;this._sizePx=this._size=0;this._slicePlaneEnabled=!1;this._clipBox=c.create(c.POSITIVE_INFINITY);this._programRep=null;this._needsPrograms=!0;this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=null;this.tempMatrix4=
a.mat4.create();this.tempVec3=a.vec3.create();this.nodes=[]}g.prototype.initializeRenderContext=function(a){this._programRep=new l(a.rctx);this._needsPrograms=this.needsRender=!0};g.prototype.uninitializeRenderContext=function(a){this._programRep.dispose();this._programScreenDepth=this._programWorldDepth=this._programScreen=this._programWorld=this._programRep=null};g.prototype.intersect=function(d,e,g,h){var k=a.vec3d.create(),l=a.vec3d.create(),m=a.vec3d.create(),n=a.vec3d.create(),r=f.plane.create(),
t=d.camera.perPixelRatio,u=d.camera.near,v=this._getSizeParams();a.vec3d.subtract(g,e,l);var A=1/a.vec3d.length(l);a.vec3d.scale(l,A,l);a.vec3d.negate(l,m);a.vec4d.set4(l[0],l[1],l[2],-a.vec3d.dot(l,e),r);h={};g={};var z=c.create(),H=c.create(this._clipBox);c.offset(H,-e[0],-e[1],-e[2],H);for(var M=0,T=this.nodes;M<T.length;M++){var V=T[M],U=V.splatSize*this._scaleFactor,J=b.minimumDistancePlane(V.obb,r),O=b.maximumDistancePlane(V.obb,r),J=J-(v.drawScreenSpace?0:q(U,J+u,v,t,V.isLeaf)),O=O-(v.drawScreenSpace?
0:q(U,O+u,v,t,V.isLeaf)),J=null!=h.dist&&null!=g.dist&&h.dist<J*A&&g.dist>O*A;if(!(0>O||J)&&(O=q(U,O+u,v,t,V.isLeaf),b.intersectLine(V.obb,e,l,O))){O*=O;b.toAaBoundingBox(V.obb,z);c.offset(z,-e[0],-e[1],-e[2],z);J=!c.contains(H,z);a.vec3d.subtract(V.origin,e,n);for(var P=V.coordinates.length/3,R=0;R<P;R++)if(k[0]=n[0]+V.coordinates[3*R],k[1]=n[1]+V.coordinates[3*R+1],k[2]=n[2]+V.coordinates[3*R+2],!J||c.containsPoint(H,k)){var Q=a.vec3d.dot(k,l),L=Q+u,S=v.drawScreenSpace?0:q(U,L,v,t,V.isLeaf);if(!(0>
Q-S)){var aa=a.vec3d.length2(k)-Q*Q;if(!(aa>O||(L-=S,L=q(U,L,v,t,V.isLeaf),aa>L*L))){aa=this.layerUid+"/"+V.id+"/"+R;Q=(Q-S)*A;if(null==h.dist||Q<h.dist)h.point=p(V,R,h.point),h.dist=Q,h.normal=m,h.pointId=aa,h.layerUid=this.layerUid;if(null==g.dist||Q>g.dist)g.point=p(V,R,g.point),g.dist=Q,g.normal=m,g.pointId=aa,g.layerUid=this.layerUid}}}}}null!=h.dist&&(k=d.minResult,null==k.dist||h.dist<k.dist)&&(e={type:"external",point:h.point,metadata:{pointId:h.pointId,layerUid:h.layerUid}},k.set(e,h.pointId,
h.dist,h.normal,void 0),k.setIntersector("PointRenderer"));null!=g.dist&&(d=d.maxResult,null==d.dist||g.dist>d.dist)&&(e={type:"external",point:g.point,metadata:{pointId:g.pointId,layerUid:g.layerUid}},d.set(e,g.pointId,g.dist,g.normal,void 0),d.setIntersector("PointRenderer"))};g.prototype.render=function(b){if(b.pass!==e.MATERIAL&&b.pass!==e.MATERIAL_DEPTH)return!1;for(var d=b.pass===e.MATERIAL_DEPTH,f=b.rctx,g=0,k=this.nodes;g<k.length;g++){var l=k[g];null==l.vao&&this._initNode(b,l)}this._selectPrograms();
g=this._getSizeParams();k=d?g.drawScreenSpace?this._programScreenDepth:this._programWorldDepth:g.drawScreenSpace?this._programScreen:this._programWorld;if(null==k||0===this.nodes.length)return!0;var m=this._clipBox,p=!c.equals(m,c.POSITIVE_INFINITY,function(a,b){return a===b});p||(a.vec3.set3(-Infinity,-Infinity,-Infinity,this.tempVec3),k.setUniform3fv("uClipMin",this.tempVec3),a.vec3.set3(Infinity,Infinity,Infinity,this.tempVec3),k.setUniform3fv("uClipMax",this.tempVec3));f.setDepthTestEnabled(!0);
f.bindProgram(k);k.setUniformMatrix4fv("uProjectionMatrix",b.camera.projectionMatrix);d&&k.setUniform2f("nearFar",b.camera.near,b.camera.far);g.drawFixedSize&&k.setUniform2f("uPointScale",g.fixedSize,b.camera.fullHeight);for(var d=this._slicePlaneEnabled?b.sliceHelper&&b.sliceHelper.plane:null,q=0,n=this.nodes;q<n.length;q++){l=n[q];k.setUniform2f("uScreenMinMaxSize",g.screenMinSize,l.isLeaf?256:64);g.drawFixedSize||k.setUniform2f("uPointScale",l.splatSize*this._scaleFactor,b.camera.fullHeight);var r=
l.origin;p&&(a.vec3.set3(m[0]-r[0],m[1]-r[1],m[2]-r[2],this.tempVec3),k.setUniform3fv("uClipMin",this.tempVec3),a.vec3.set3(m[3]-r[0],m[4]-r[1],m[5]-r[2],this.tempVec3),k.setUniform3fv("uClipMax",this.tempVec3));a.mat4.identity(this.tempMatrix4);a.mat4.translate(this.tempMatrix4,r,this.tempMatrix4);a.mat4.multiply(b.camera.viewMatrix,this.tempMatrix4,this.tempMatrix4);k.setUniformMatrix4fv("uModelViewMatrix",this.tempMatrix4);d&&h.bindSlicePlane(r,d,k);f.bindVAO(l.vao);f.drawArrays(0,0,l.coordinates.length/
3)}return!0};Object.defineProperty(g.prototype,"useFixedSizes",{get:function(){return this._useFixedSizes},set:function(a){this._useFixedSizes!==a&&(this._useFixedSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"scaleFactor",{get:function(){return this._scaleFactor},set:function(a){this._scaleFactor!==a&&(this._scaleFactor=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"minSizePx",{get:function(){return this._minSizePx},
set:function(a){this._minSizePx!==a&&(this._minSizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"useRealWorldSymbolSizes",{get:function(){return this._useRealWorldSymbolSizes},set:function(a){this._useRealWorldSymbolSizes!==a&&(this._useRealWorldSymbolSizes=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"size",{get:function(){return this._size},set:function(a){this._size!==a&&(this._size=a,this._requestRender())},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"sizePx",{get:function(){return this._sizePx},set:function(a){this._sizePx!==a&&(this._sizePx=a,this._requestRender())},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"clippingBox",{set:function(a){c.set(this._clipBox,a||c.POSITIVE_INFINITY)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"slicePlaneEnabled",{set:function(a){this._slicePlaneEnabled!==a&&(this._slicePlaneEnabled=a,this._requestRender(),
this._needsPrograms=!0)},enumerable:!0,configurable:!0});g.prototype.addNode=function(a){this.nodes.push(a);this._requestRender()};g.prototype.removeNode=function(a){var b=null;this.nodes=this.nodes.filter(function(c){return c.id===a?(b=c,c.vao&&(c.vao.dispose(!0),c.vao=null),!1):!0});this._requestRender();return b};g.prototype.removeAll=function(){this.nodes.forEach(function(a){a.vao&&(a.vao.dispose(!0),a.vao=null)});this.nodes=[];this._requestRender()};g.prototype._initNode=function(a,b){a=a.rctx;
b.vao=new d(a,m.program.attributes,r,{positions:k.createVertex(a,35044,b.coordinates),colors:k.createVertex(a,35044,b.rgb)})};g.prototype._requestRender=function(){this.didRender=!1;this.needsRender=!0};g.prototype._getSizeParams=function(){var a=this._useFixedSizes,b=a&&!this._useRealWorldSymbolSizes,c=b?this._sizePx:this._size,d=this._minSizePx;a&&(d=0);return{drawScreenSpace:b,drawFixedSize:a,fixedSize:c,screenMinSize:d}};g.prototype._selectPrograms=function(){this._needsPrograms&&(this._needsPrograms=
!1,this._programWorld=this._programRep.getProgram(m.program,{slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreen=this._programRep.getProgram(m.program,{drawScreenSize:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programWorldDepth=this._programRep.getProgram(m.program,{depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}),this._programScreenDepth=this._programRep.getProgram(m.program,{drawScreenSize:!0,depthPass:!0,slicePlaneEnabled:this._slicePlaneEnabled}))};return g}();(function(a){a.isInstanceOfNode=
function(a){return a.hasOwnProperty("splatSize")}})(n||(n={}));return n})},"esri/views/3d/webgl-engine/shaders/PointRendererPrograms":function(){define(["require","exports","./sources/resolver","../../../webgl/programUtils"],function(n,g,c,a){Object.defineProperty(g,"__esModule",{value:!0});var f=function(b){return a.glslifyDefineMap({DEPTH_PASS:b.depthPass,DRAW_SCREEN_SIZE:b.drawScreenSize,SLICE:b.slicePlaneEnabled})};g.program={name:"point-renderer",shaders:function(a){return{vertexShader:f(a)+
c.resolveIncludes("pointRenderer/pointRenderer.vert"),fragmentShader:f(a)+c.resolveIncludes("pointRenderer/pointRenderer.frag")}},attributes:{aPosition:0,aColor:1}}})},"esri/views/3d/layers/SceneLayerView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../core/tsSupport/awaiterHelper ../../../core/tsSupport/generatorHelper dojo/errors/CancelError ../../../Color ../../../Graphic ../../../core/arrayUtils ../../../core/Collection ../../../core/has ../../../core/iteratorUtils ../../../core/lang ../../../core/Logger ../../../core/promiseUtils ../../../core/requireUtils ../../../core/scheduling ../../../core/watchUtils ../../../core/workers ../../../core/accessorSupport/decorators ../../../geometry/support/aaBoundingBox ../../../geometry/support/scaleUtils ../../../layers/IntegratedMeshLayer ../../../layers/graphics/controllers/I3SOnDemandController ../../../symbols/Symbol3D ../../../symbols/support/unitConversionUtils ../../../tasks/support/Query ./LayerView3D ./SceneLayerWorker ./graphics/graphicUtils ./i3s/Highlights ./i3s/I3SElevationProvider ./i3s/I3SProjectionUtil ./i3s/I3SQueryEngine ./i3s/I3SUtil ./i3s/IDBCache ./support/attributeUtils ./support/edgeUtils ./support/layerViewUpdatingProperties ./support/symbolColorUtils ../lib/gl-matrix ../support/mathUtils ../support/orientedBoundingBox ../support/projectionUtils ../support/buffer/glUtil ../support/buffer/typedArrayUtil ../webgl-engine/Stage ../webgl-engine/lib/Geometry ../webgl-engine/lib/Layer ../webgl-engine/lib/Object3D ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Texture ../webgl-engine/lib/Util ../webgl-engine/lib/TextureBackedBuffer/BufferManager ../webgl-engine/materials/DefaultMaterial module".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K,N,H,M,T,V,U,J,O,P,R,Q,L,S,aa,ea,Z,da,W,ja,ca,ba,ha,fa,ia,X,ma,oa,ka){function w(a,b,c,d,e){var f=!1,g;b.encoding===J.DDS_ENCODING_STRING?g=ia.DDS_ENCODING:f=!(aa.isPowerOfTwo(a.width)&&aa.isPowerOfTwo(a.height));c=((a=b.usedByEngineMats.some(function(a){return a.getParams().atlasRegions})||b.atlas)?d:c)&&!f;return{mipmap:c,wrapClamp:a||!b.wrap,disableAnisotropy:a&&c&&e,encoding:g,noUnpackFlip:!0}}function Aa(a){return W.isArrayBuffer(a.data)}
function ya(a,b){for(var c=1024,d=0;d<a.length;d++)var e=a[d],c=c+(e.interleavedVertexData.byteLength+(e.indices?e.indices.byteLength:0)),c=c+(e.positionData.data.byteLength+e.positionData.indices.byteLength);for(a=0;a<b.length;a++)d=b[a],W.isArrayBuffer(d.data)&&(c+=d.data.byteLength);return c}var na=ja.ModelContentType,qa=r.getLogger("esri.views.3d.layers.SceneLayerView3D"),sa=[1,1,1,1],ta=[.8,.8,.8],Ja=[.5,.5,.5],xa=function(){return function(){}}();g=function(e){function g(){var a=null!==e&&e.apply(this,
arguments)||this;a._queryEngine=null;a._highlights=new M(a);a._elevationProvider=null;a._worker=new N;a._workerThread=null;a._texId2Meta=new Map;a._nodeId2Meta=new Map;a._rendererVersion=0;a._rendererFields=null;a._colorVariable=null;a._opacityVariable=null;a._symbolInfos=new Map;a._idbCache=new O.IDBCache("esri-scenelayer-cache","geometries",10);a._cancelCount=0;a._hasColors=!1;a._hasTextures=!1;a._hasData=!1;a.slicePlaneEnabled=!1;a.alwaysLoadEverythingModeEnabled=!1;a._cacheKeySuffix=null;a._definitionExpressionErrors=
0;a._maxDefinitionExpressionErrors=20;a._tmpAttributeOnlyGraphic=new h(null,null,{});return a}c(g,e);Object.defineProperty(g.prototype,"hasTexturesOrVertexColors",{get:function(){return this._hasData?this._hasTextures||this._hasColors?"yes":"probably-not":"unknown"},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"rendererNeedsTextures",{get:function(){return J.rendererNeedsTextures(this.layer.renderer)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"elevationOffset",
{get:function(){var a=null!=this.layer?this.layer.elevationInfo:null;if(null!=a&&"absolute-height"===a.mode){var b=D.getMetersPerVerticalUnitForSR(this.layer.spatialReference),c=F.getMetersPerUnit(a.unit);return(a.offset||0)*c/b}return 0},enumerable:!0,configurable:!0});g.prototype._enableSecretAlwayLoadMode=function(){this.layer.store.lodModel&&"always-load"===this.layer.store.lodModel&&(this.alwaysLoadEverythingModeEnabled=!0)};Object.defineProperty(g.prototype,"uncompressedTextureDownsamplingEnabled",
{get:function(){return this.view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled&&!this.useCompressedTextures},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"useCompressedTextures",{get:function(){var a=this.layer.version,a=!d("trident")||1<a.major||1===a.major&&3<a.minor;return this.view._stage.has("s3tc")&&a},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_enableMipMaps",{get:function(){return!this.uncompressedTextureDownsamplingEnabled},
enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_enableAtlasMipMaps",{get:function(){return this._enableMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_atlasBiasCompensationEnabled",{get:function(){return!this.view._stage.has("shaderTextureLOD")&&this._enableAtlasMipMaps},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"_disableAtlasAnisotropy",{get:function(){return this._atlasBiasCompensationEnabled},enumerable:!0,configurable:!0});
g.prototype.initialize=function(){var a=this;z.open(t.getAbsMid("./SceneLayerWorker",n,ka),{client:this}).then(function(b){a.destroyed?b.close():a._workerThread=b});J.checkSceneLayerValid(this.layer);J.checkSceneLayerCompatibleWithView(this.layer,this.view);this._controller=new G({layerView:this});this.geoMemoryEstimate=this.texMemoryEstimate=this.gpuMemoryEstimate=0;this._stage=this.view._stage;if((this._isIntegratedMesh=this.layer instanceof C)||!this.layer.store.defaultGeometrySchema)this._hasSymbolColors=
!1;else{var b=this.layer.store.defaultGeometrySchema.featureAttributes;this._hasSymbolColors=!!(b&&b.faceRange&&b.id)}this._hasVertexColors=null!=this.layer.store.defaultGeometrySchema.vertexAttributes.color&&(null==this.layer.cachedDrawingInfo||!this.layer.cachedDrawingInfo.color);this._isIntegratedMesh||(this._edgeView=this._stage.view.getEdgeView());this._memCache=this.view.resourceController.getMemCache(this.layer.uid,function(b){return a._deleteNodeStageData(b)});this._addThisLayerToStage();
this._elevationProvider=new T({layerView:this,stageLayer:this._stageLayer});this.handles.add([A.init(this.view,"clippingArea",function(){return a._clippingAreaChanged()}),A.init(this.layer,"renderer",function(b){return a._rendererChange(b)}),A.init(this.layer,"objectIdFilter",function(){return a._filterChange()}),A.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}),A.init(this,"_controller.parsedDefinitionExpression",function(){return a._filterChange()}),A.watch(this,"fullOpacity",
function(b){return a._opacityChange(b)}),A.watch(this,"slicePlaneEnabled",function(b){return a._slicePlaneEnabledChange(b)}),A.watch(this,"elevationOffset",function(b,c){return a._reloadAll(c)}),A.watch(this,["rendererNeedsTextures","uncompressedTextureDownsamplingEnabled"],function(){a._reloadAll();a._memCache.clear()}),A.init(this,"suspended",function(b){return a._suspendedChange(b)})],"sceneLayerHandles");this._idbCache.init().catch(function(a){qa.warn("Failed to initialize IndexedDB cache: "+
a)});this._cacheKeySuffix=J.getCacheKeySuffix(this.layer.spatialReference,this.view.renderSpatialReference);this._componentColorManager=this._hasSymbolColors?new ma.BufferManager(this._stage.view.renderingContext):null;this._enableSecretAlwayLoadMode()};g.prototype.destroy=function(){this.handles.remove("sceneLayerHandles");this._workerThread&&(this._workerThread.close(),this._workerThread=null);this._removeAllNodeDataFromStage();this._memCache.destroy();this._memCache=null;this._removeThisLayerFromStage();
this._stage=null;this._idbCache&&(this._idbCache.destroy(),this._idbCache=null);null!=this._controller&&(this._controller.destroy(),this._controller=null);this._highlights.destroy();this._nodeId2Meta=this._texId2Meta=null;this.emit("visible-geometry-changed");this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle.remove(),this._visibleGeometryChangedSchedulerHandle=null)};g.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};
g.prototype.isUpdating=function(){return!(!this._controller||!this._controller.updating)};g.prototype.memEstimateTextureAdded=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate+=a;this.texMemoryEstimate+=a;return a};g.prototype.memEstimateTextureRemoved=function(a){a=a.getEstimatedTexMemRequired();this.gpuMemoryEstimate-=a;this.texMemoryEstimate-=a};g.prototype.memEstimateGeometryAdded=function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate+=a;this.geoMemoryEstimate+=a;return a};
g.prototype.memEstimateGeometryRemoved=function(a){a=a.estimateGpuMemoryUsage();this.gpuMemoryEstimate-=a;this.geoMemoryEstimate-=a};g.prototype.isNodeLoaded=function(a){return this._nodeId2Meta.has(a.id)};g.prototype.getUsedMemory=function(){var a=0;this._nodeId2Meta.forEach(function(b){return a+=b.node.memory});return a};g.prototype.getUnloadedMemory=function(){return this._controller?this._controller.getUnloadedMemoryEstimate():0};g.prototype._suspendedChange=function(a){a?(this._removeAllNodeDataFromStage(),
this.view.elevationProvider.unregister(this._elevationProvider)):this.view.elevationProvider.register(this._isIntegratedMesh?"im":"scene",this._elevationProvider)};g.prototype.getStats=function(){var a={index:0,nodes:this._nodeId2Meta.size.toString(),textures:this._texId2Meta.size,"Total GPU Memory Estimate":(this.gpuMemoryEstimate/1048576).toFixed(1)+"MB","Geometry Memory Estimate":(this.geoMemoryEstimate/1048576).toFixed(1)+"MB","Texture Memory Estimate":(this.texMemoryEstimate/1048576).toFixed(1)+
"MB"};this._controller&&(this._cachingEnabled()&&(a.IDBCache=Math.round(100*this._idbCache.getHitRate())+"% hit"),this._controller.updateStats(a));return a};g.prototype._addThisLayerToStage=function(){for(var a=this._stage,b=new Uint8Array(256),c=0;c<b.length;c++)b[c]=255;this._whiteTexture=new ia(b,"white",{width:8,height:8});a.add(na.TEXTURE,this._whiteTexture);b=this.layer.id;this._stageLayer=b=new ba(b,{},b);a.add(na.LAYER,b);this._stage.addToViewContent([b.id])};g.prototype._removeThisLayerFromStage=
function(){if(null!=this._stageLayer){var a=this._stage;a.remove(na.TEXTURE,this._whiteTexture.id);this._removeAllNodeDataFromStage();X.assert(0===this._nodeId2Meta.size);X.assert(0===this._texId2Meta.size);a.remove(na.LAYER,this._stageLayer.id);this._stageLayer=void 0;this.gpuMemoryEstimate=0}};g.prototype.getLoadedAttributes=function(a){if(a=this._nodeId2Meta.get(a.id))return a.loadedAttributes};g.prototype.getAttributeData=function(a){if(a=this._nodeId2Meta.get(a.id))return a.attributeData};g.prototype.setAttributeData=
function(a,b,c){var d=this._nodeId2Meta.get(a.id);d&&(d.loadedAttributes=b,d.attributeData=c,d.cachedRendererVersion=this._getInvalidRendererVersion(),this._updateEngineObject(a,d))};g.prototype.getLoadedNodeIDs=function(){return m.keysOfMap(this._nodeId2Meta)};g.prototype._calcEngineMaterialTransparencyParams=function(a,b,c){var d=this.fullOpacity,e=1-aa.clamp(X.fallbackIfUndefined(b.transparency,0),0,1);a=1>e||1>d||a&&p.endsWith(a.channels,"a")||!0===b.useVertexColorAlpha||c;return{opacity:e,layerOpacity:d,
transparent:a}};g.prototype._calcEngineMaterialDoubleSidedParams=function(a){return null!=a.doubleSided?a.doubleSided:!0};g.prototype._calcEngineMaterialCullFaceParams=function(a){return a.cullFace?a.cullFace:null!=a.doubleSided?a.doubleSided?"none":"back":"none"};g.prototype._getMaterialParameters=function(a,b,c,d){var e;null!=a&&(e=(e=this._texId2Meta.get(b))&&e.engineTex?e.engineTex.id:this._whiteTexture.id);b=c.params;var f=X.fallbackIfUndefined(b.diffuse,ta);"standard"!==c.type&&qa.warn("Unknown material type '"+
c.type+"', must be 'standard'");c=this._isIntegratedMesh;d={ambient:f,diffuse:f,specular:X.fallbackIfUndefined(b.specular,Ja),atlasRegions:b.vertexRegions,textureId:e,vertexColors:this._hasVertexColors,componentIndices:this._hasSymbolColors,componentColorBuffer:this._hasSymbolColors&&d?d.textureBuffer:null,flipV:!1,doubleSided:this._calcEngineMaterialDoubleSidedParams(b),cullFace:this._calcEngineMaterialCullFaceParams(b),writeStencil:c,receiveSSAO:!c,groundNormalShading:c,compressedNormals:!c,slicePlaneEnabled:this.slicePlaneEnabled};
c||(a=this._calcEngineMaterialTransparencyParams(a,b),p.mixin(d,a));return d};g.prototype._createEngineMaterial=function(a,b,c,d,e,f,g){var h=null==b?null:this._getI3STexEncoding(b);g=this._getMaterialParameters(b,c,d,g);g=new oa(g,e);g.metadata={i3sMatId:e,i3sTexId:c,i3sTex:b,i3sMatParams:d.params};if(null!=b){(d=this._texId2Meta.get(c))?d.usedByEngineMats.push(g):(d={id:c,usedByEngineMats:[g],images:b.images,encoding:h,atlas:!0===b.atlas,wrap:"none"!==b.wrap[0]||"none"!==b.wrap[1]},this._texId2Meta.set(c,
d));a:{for(b=0;b<f.length;b++)if(h=f[b],h.i3sTexId===c){c=h.data;break a}c=null}null!=c&&null==d.engineTex&&(f=w(c,d,this._enableMipMaps,this._enableAtlasMipMaps,this._disableAtlasAnisotropy),d.engineTex=new ia(c,d.id,f),this._stage.add(na.TEXTURE,d.engineTex),a.memory+=this.memEstimateTextureAdded(d.engineTex));if(null!=d.engineTex)for(a=d.engineTex.id,c=0,f=d.usedByEngineMats;c<f.length;c++)f[c].setParameterValues({textureId:a})}return g};g.prototype._getI3STexEncoding=function(a){var b=J.getAppropriateTextureEncoding(a.encoding,
this.useCompressedTextures);return-1<b?a.encoding[b]:a.encoding};g.prototype._getVertexBufferLayout=function(a,b){var c=a.params.materialID,d=b.materialDefinitions[c];X.assert(void 0!==d,"geometry wants unknown material "+c);a=a.params.textureID||"none";var e;"none"!==a&&(null!=b.textureDefinitions&&null!=b.textureDefinitions[a]||qa.warn("textureDefinitions missing in shared resource"),e=b.textureDefinitions[a]);b=this._getMaterialParameters(e,a,d);return da.glLayout(oa.getVertexBufferLayout(b))};
g.prototype._createEngineMat=function(a,b,c,d,e){var f=b.params.materialID,g=c.materialDefinitions[f];X.assert(void 0!==g,"geometry wants unknown material "+f);b=b.params.textureID||"none";var h;"none"!==b&&(null!=c.textureDefinitions&&null!=c.textureDefinitions[b]||qa.warn("textureDefinitions missing in shared resource"),h=c.textureDefinitions[b]);return this._createEngineMaterial(a,h,b,g,f,d,e)};g.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};g.prototype._findGraphicNodeAndIndex=
function(a){var b=P.attributeLookup(a.attributes,this._getObjectIdField()),c=null;q.everyMap(this._nodeId2Meta,function(a,d){d=a.featureIds.indexOf(b);if(-1===d)return!0;c={node:a.node,index:d};return!1});return c};g.prototype._getGraphicIndices=function(a,b){a=this._nodeId2Meta.get(a.id);if(!a)return[];for(var c=[],d=this._getObjectIdField(),e=0;e<b.length;e++){var f=P.attributeLookup(b[e].attributes,d),f=a.featureIds.indexOf(f);-1!==f&&c.push(f)}return c};g.prototype.whenGraphicBounds=function(a){a=
this._findGraphicNodeAndIndex(a);if(!a)return u.reject();var b=this._nodeId2Meta.get(a.node.id).engineObject;a=this._boundingBoxCornerPoints(a.index,b,new Float64Array(24));if(Z.bufferToBuffer(a,this.view.renderSpatialReference,0,a,this.view.spatialReference,0,8))return b=B.empty(),B.expandWithBuffer(b,a,0,8),u.resolve({boundingBox:b,screenSpaceObjects:[]})};g.prototype.whenGraphicAttributes=function(a,b){var c=this;return J.whenGraphicAttributes(this.layer,[a],this._getObjectIdField(),b,function(){var b=
c._findGraphicNodeAndIndex(a);return{node:b.node,indices:[b.index]}},{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(a){return a[0]})};g.prototype.getGraphicFromStageObject=function(a,b){if(this.layer instanceof C)return u.reject();var c=this._getMetadata(a);a=a.getComponentFromTriangleNr(0,b);return null!=a&&null!=c.featureIds&&a<c.featureIds.length?(c=this._createGraphic(a,c),u.resolve(c)):u.reject()};g.prototype._getMetadata=function(a){a=a.getMetadata();return this._nodeId2Meta.get(a.i3sNode)};
g.prototype._getCacheKey=function(a){return a.baseUrl+this._cacheKeySuffix};g.prototype._getMemCacheKey=function(a,b){void 0===b&&(b=this.elevationOffset);return a+"#"+b};g.prototype._cachingEnabled=function(){return!this._controller.disableCache&&0===this.elevationOffset&&null!=this._cacheKeySuffix};g.prototype.additionalCancelNodeLoadingHandler=function(){this._cancelCount=(this._cancelCount|0)+1|0};g.prototype._handleCancelled=function(a){if(0<((this._cancelCount|0)+(-a|0)|0))throw new l;};g.prototype.loadCachedGPUData=
function(a){return this._memCache.pop(this._getMemCacheKey(a.id))};g.prototype.loadCachedNodeData=function(a,b){var c=this,d=this._cancelCount;return this._cachingEnabled()?this._idbCache.get(this._getCacheKey(a)).then(function(e){if(null==e)return null;c._handleCancelled(d);if(e.nodeVersion!==a.version)return c._idbCache.remove(c._getCacheKey(a)),null;a.obb||(a.obb=ea.clone(e.nodeObb),c._controller.updateVisibility(a.id));var f=function(a){if(null==a.data)return!0;var b=c._getI3STexEncoding(e.sharedResource.textureDefinitions[a.i3sTexId]);
return a.encoding!==b};return c.rendererNeedsTextures&&e.textureData.some(f)?b(e.allGeometryData,e.sharedResource).then(function(b){e.textureData=b;b.every(Aa)&&c._idbCache.put(c._getCacheKey(a),e).catch(function(b){b&&"indexedb:not-initialized"===b.name||qa.warn("Failed to update node with textures in IndexedDB cache: "+a.id+": "+b)});c._handleCancelled(d);return e}):e}):u.resolve(null)};g.prototype.addNodeData=function(a,b){var c=this;return this._transformBundle(a,b).then(function(b){return c._controller.reschedule(a.id,
b)}).then(function(d){a.obb||(a.obb=d.obb,c._controller.updateVisibility(a.id));d={allGeometryData:b.allGeometryData,transformedGeometries:d.transformedGeometries,textureData:b.textureData,sharedResource:b.sharedResource,nodeVersion:a.version,nodeObb:a.obb,byteSize:ya(d.transformedGeometries,b.textureData)};if(c._cachingEnabled()){var e=d.textureData.map(function(a){return Aa(a)?a:{i3sTexId:a.i3sTexId,encoding:a.encoding,data:null}});c._idbCache.put(c._getCacheKey(a),{allGeometryData:d.allGeometryData,
transformedGeometries:d.transformedGeometries,textureData:e,sharedResource:d.sharedResource,nodeVersion:d.nodeVersion,nodeObb:d.nodeObb,byteSize:d.byteSize}).catch(function(b){return qa.warn("Failed to store node in IndexedDB cache: "+a.id+": "+b)})}return c.addCachedNodeData(a,d,b.attributeDataInfo)})};g.prototype._transformBundle=function(a,b){for(var c=this,d=[],e=[b.geometryBuffer],f=0,g=b.allGeometryData;f<g.length;f++)for(var h=0,k=g[f].geometries;h<k.length;h++)d.push(this._getVertexBufferLayout(k[h],
b.sharedResource));b={geometryBuffer:b.geometryBuffer,geometryData:b.allGeometryData,layouts:d,mbs:a.mbs,obb:a.obb,elevationOffset:this.elevationOffset,needNormals:!this._isIntegratedMesh&&this._controller.isMeshPyramid,normalReferenceFrame:this.layer.normalReferenceFrame||"none",indexSR:this._controller.crsIndex.toJSON(),vertexSR:this._controller.crsVertex.toJSON(),renderSR:this.view.renderSpatialReference.toJSON()};return this._workerThread?this._workerThread.invoke("process",b,e):this._controller.reschedule(a.id,
b).then(function(a){return c._worker.transform(a)})};g.prototype.addCachedGPUData=function(a,b,c){if(!this.alwaysLoadEverythingModeEnabled&&!this._controller.isGeometryVisible(a))return this._memCache.put(this._getMemCacheKey(a.id),b,a.memory),u.resolve();b.attributeData=c?c.attributeData:null;b.loadedAttributes=c?c.loadedAttributes:null;this._nodeId2Meta.set(a.id,b);b.engineObject.setHidden(b.engineObject.geometryRecords[0],!1);this._updateEngineObject(a,b);this._highlights.objectCreated(b.engineObject);
return u.resolve()};g.prototype.addCachedNodeData=function(a,b,c){var d=this;if(this._nodeId2Meta.has(a.id))return this._addOrUpdateEdgeRendering(this._nodeId2Meta.get(a.id)),this._applyFilters(a),u.resolve();if(this.suspended||!this.alwaysLoadEverythingModeEnabled&&!this._controller.isGeometryVisible(a))return u.resolve();var e=b.allGeometryData,f=b.transformedGeometries,g=b.textureData;b=b.sharedResource;if(0===e.length)return u.resolve();1!==e.length&&console.warn("Node with",e.length,"geometries is unsupported");
if(!this.rendererNeedsTextures)for(var h=0;h<g.length;h++)g[h].data=null;var k={};k[na.OBJECT]={};k[na.GEOMETRY]={};k[na.MATERIAL]={};var h=0,l=!1;a.memory=0;var m=e[0],e=m.componentOffsets,p=m.geometries,m=m.featureIds,q=null,n=null;if(this._hasSymbolColors)for(var q=this._componentColorManager.getBuffer(m.length),n=new Uint16Array(m.length),r=0;r<m.length;r++)n[r]=q.aquireIndex();for(var r=a.id+"|"+m[0],t=[],v=[],w=[],x=[],A,z=0;z<p.length;z++){var B=p[z],C=this._createEngineMat(a,B,b,g,q),D=f[h++];
A=D.corMatrices.globalTrafo;l=l||D.hasColors;D=new fa(new Float32Array(D.interleavedVertexData),D.layout,D.positionData,e||fa.DefaultOffsets,D.indices||fa.DefaultIndices,!0);this._hasSymbolColors&&this._setComponentIndices(D,n);var B=null!=B.transformation?S.mat4d.create(B.transformation):S.mat4d.identity(),P=t.length,D=new ca(D,r+(0<P?"_"+P:""));t.push(D);w.push(B);x.push([C]);v.push(V.createOrigin(a.mbs,this.elevationOffset,this._controller.crsIndex,this.view.renderSpatialReference));a.memory+=
this.memEstimateGeometryAdded(D.data);k[na.MATERIAL][C.id]=C;k[na.GEOMETRY][D.id]=D}var L=new ha({idHint:a.id,name:r,geometries:t,materials:x,transformations:w,origins:v,castShadow:!0,metadata:{i3sNode:a.id,layerUid:this.layer.uid}});L.setObjectTransformation(A);k[na.OBJECT][L.id]=L;var E=new xa;E.node=a;E.engineObject=L;E.featureIds=m;E.attributeData=c?c.attributeData:null;E.loadedAttributes=c?c.loadedAttributes:null;E.componentColorBuffer=q;E.componentIndices=n;E.cachedRendererVersion=this._getInvalidRendererVersion();
E.cachedSymbolInfos=[];!this._hasTextures&&null!=a.textureData&&0<a.textureData.length&&(this._hasTextures=!0);this._hasColors||(this._hasColors=l);this._hasData=!0;this.notifyChange("hasTexturesOrVertexColors");return u.create(function(b){d._addOrUpdateEdgeRendering(E).then(function(){if(d._nodeId2Meta.has(a.id))return d._edgeView&&d._edgeView.removeObject(E.engineObject),b();var c=d._stageLayer,e=d._stage,f=k[na.OBJECT],g;for(g in f)f.hasOwnProperty(g)&&c.addObject(f[g]);for(var h in k)if(k.hasOwnProperty(h)){var c=
k[h],l;for(l in c)c.hasOwnProperty(l)&&null==e.get(h,l)&&e.add(h,c[l])}d._nodeId2Meta.set(a.id,E);if(d.suspended)return d._removeNodeStageData(a.id),b();d._setObjectSymbology(E);d._applyFilters(a);d._highlights.objectCreated(L);d.visibleGeometryChanged(L);b()})})};g.prototype._clippingAreaChanged=function(){var a=this,b=B.create();Z.extentToBoundingBox(this.view.clippingArea,b,this.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null;this._updateFilters();this._nodeId2Meta.forEach(function(b){return a._applyFilters(b.node)});
this._controller&&this._controller.updateClippingArea(this.view.clippingArea)};g.prototype._filterChange=function(){var a=this;this._updateFilters();this._nodeId2Meta.forEach(function(b){return a._applyFilters(b.node)})};g.prototype._updateFilters=function(){var a=this,b=[];if(this.layer.objectIdFilter){var c=new Float64Array(this.layer.objectIdFilter.ids),d="include"===this.layer.objectIdFilter.method;c.sort();b.push(function(b,e){return a._objectIdFilter(c,d,e)})}if(this._controller&&this._controller.parsedDefinitionExpression&&
this._controller.definitionExpressionFields){this._definitionExpressionErrors=0;var e=this._controller.parsedDefinitionExpression,f=this._controller.definitionExpressionFields;b.push(function(b,c){return a._sqlFilter(b,e,f,c)})}this._clippingArea&&b.push(function(b,c){return a._boundingboxFilter(b,a._clippingArea,c)});this._filters=b};g.prototype._sqlFilter=function(a,b,c,d){var e={},f=new h(null,null,e);f.layer=this.layer;f.sourceLayer=this.layer;var g=this.layer.objectIdField,k=0,l=0,m=this._nodeId2Meta.get(a.id);
a=m.featureIds;for(var p=m.attributeData,m=c.every(function(a){return null!=p[a]||a===g}),q=0;q<a.length&&k<d.length;q++)if(d[k]===a[q]){var n=!0;if(m){e[g]=a[q];for(var n=0,r=c;n<r.length;n++){var t=r[n];t!==g&&(e[t]=J.getCachedAttributeValue(p[t],q))}n=this._evaluateClause(b,f)}n&&(d[l]=d[k],l++);k++}d.length=l};g.prototype._evaluateClause=function(a,b){try{return a.testFeature(b)}catch(eb){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&qa.error("Error while evaluating definitionExpression: "+
eb),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&qa.error("Further errors are ignored"),!1}};g.prototype._objectIdFilter=function(a,b,c){for(var d=0,e=0;d<c.length;)0<=m.binaryIndexOf(a,c[d])===b&&(c[e]=c[d],e++),d++;c.length=e};g.prototype._boundingboxFilter=function(a,b,c){var d=[0,0,0,0];Z.mbsToMbs(a.mbs,this._controller.crsIndex,d,this.view.renderSpatialReference);d=null!=b?J.intersectBoundingBoxWithMbs(b,d):2;if(2!==d)if(0===d)c.length=
0;else{var e=d=0,f=this._nodeId2Meta.get(a.id);a=f.featureIds;var g=f.engineObject.getObjectTransformation(),h=f.engineObject.getGeometryRecords()[0].getShaderTransformation();S.mat4d.multiply(g,h);if(0===g[1]&&0===g[2]&&0===g[3]&&0===g[4]&&0===g[6]&&0===g[7]&&0===g[8]&&0===g[9]&&0===g[11]&&1===g[15]){h=Ca;h[0]=(b[0]-g[12])/g[0];h[1]=(b[1]-g[13])/g[5];h[2]=(b[2]-g[14])/g[10];h[3]=(b[3]-g[12])/g[0];h[4]=(b[4]-g[13])/g[5];h[5]=(b[5]-g[14])/g[10];b=f.engineObject.getGeometryRecords()[0].geometry;f=b.componentCount;
for(g=0;g<f&&d<c.length;g++)if(c[d]===a[g]){var k=b.getComponentAABB(g,Pa);B.intersects(h,k)&&(c[e]=c[d],e++);d++}c.length=e}}};g.prototype._addOrUpdateEdgeRendering=function(a){return f(this,void 0,void 0,function(){var c,d,e,f,g,h;return b(this,function(b){switch(b.label){case 0:if(!this._edgeView)return[2];c=a.engineObject;d=this._edgeView.hasObject(c);e=this._extractObjectEdgeMaterials(a);f=e.hasEdges;g=e.perFeatureEdgeMaterials;if(!f)return[3,4];h=!c.isHidden(c.geometryRecords[0]);if(!d)return[3,
1];this._edgeView.updateAllComponentMaterials(c,g);this._edgeView.updateObjectVisibility(c,h);return[3,3];case 1:return h?[4,this._edgeView.addObject(c,g)]:[3,3];case 2:b.sent(),b.label=3;case 3:return[3,5];case 4:d&&this._edgeView.removeObject(c),b.label=5;case 5:return[2]}})})};g.prototype._applyFilters=function(a){var b=this._nodeId2Meta.get(a.id);b&&(this._applyFiltersToObjects(a,b),this._updateEdgeRendering(b))};g.prototype._applyFiltersToObjects=function(a,b){var c=b.engineObject;c.unhideAllComponents();
if(0!==this._filters.length){b=b.featureIds;for(var d=b.slice(),e=0,f=this._filters;e<f.length;e++)(0,f[e])(a,d);if(d.length!==b.length)for(a=0,e=c.getGeometryRecords()[0],f=0;f<b.length;f++){var g=b[f];a>=d.length||d[a]!==g?c.setComponentVisibility(e,f,!1):a++}}};g.prototype._removeAllNodeDataFromStage=function(a){var b=this;void 0===a&&(a=this.elevationOffset);this._nodeId2Meta.forEach(function(c,d){return b._removeNodeStageData(d,a)})};g.prototype.removeNodeData=function(a){var b=this;a.forEach(function(a){return b._removeNodeStageData(a.id)})};
g.prototype._removeNodeStageData=function(a,b){void 0===b&&(b=this.elevationOffset);var c=this._nodeId2Meta.get(a);if(c){var d=c.engineObject;d.setHidden(d.geometryRecords[0],!0);this.visibleGeometryChanged(d);this._addOrUpdateEdgeRendering(c);this._nodeId2Meta.delete(a);this._highlights.objectDeleted(d);this._memCache.put(this._getMemCacheKey(a,b),c,c.node.memory)}};g.prototype._deleteNodeStageData=function(a){var b=this._stage,c=this._stageLayer,d=a.engineObject;this._edgeView&&this._edgeView.removeObject(d);
c.removeObject(d);for(var c=0,e=d.getGeometryRecords();c<e.length;c++){var f=e[c];this.memEstimateGeometryRemoved(f.geometry.data);b.remove(na.GEOMETRY,f.geometry.id);for(var g=0,f=f.materials;g<f.length;g++)this._removeMaterial(f[g],b)}if(a.componentIndices){for(c=0;c<a.componentIndices.length;c++)a.componentColorBuffer.releaseIndex(a.componentIndices[c]);this._componentColorManager.garbageCollect()}b.remove(na.OBJECT,d.id)};g.prototype._removeMaterial=function(a,b){b.remove(na.MATERIAL,a.id);var c=
a.metadata.i3sTexId;if(c){var d=this._texId2Meta.get(c);if(d){var e=d.usedByEngineMats;m.removeUnordered(e,a)||qa.error("Missing reference from material to texture");0===e.length&&((a=d.engineTex)&&a!==this._whiteTexture&&(this.memEstimateTextureRemoved(a),b.remove(na.TEXTURE,d.engineTex.id)),this._texId2Meta.delete(c))}}};g.prototype.setPolygonOffset=function(a,b){var c=this._nodeId2Meta.get(a.id);if(c)for(a=0,c=c.engineObject.getGeometryRecords();a<c.length;a++)for(var d=0,e=c[a].materials;d<e.length;d++)e[d].setParameterValues({polygonOffset:b})};
g.prototype._getInvalidRendererVersion=function(){return(this._rendererVersion|0)+-1|0};g.prototype._rendererChange=function(a){this._currentRenderer=a;this._rendererVersion=(this._rendererVersion|0)+1|0;this._opacityVariable=this._colorVariable=this._rendererFields=null;a&&a.requiredFields&&(this._rendererFields=J.findFieldsCaseInsensitive(a.requiredFields,this.layer.fields));if(a&&a.visualVariables)for(var b=0,c=a.visualVariables;b<c.length;b++){var d=c[b];"color"===d.type?this._colorVariable=d:
"opacity"===d.type?this._opacityVariable=d:qa.warn("Unsupported visual variable type for 3D Object Scene Services: "+d.type)}a&&(a.colorInfo||a.sizeInfo)&&qa.warn("renderer.colorInfo and renderer.sizeInfo are not supported for 3D Object Scene Services. Use visualVariables instead.");if(a)for(b=0,a=a.getSymbols();b<a.length;b++)c=a[b],"mesh-3d"!==c.type&&qa.error("Symbols of type '"+c.type+"' are not supported for 3D Object Scene Services.");this.view.resourceController.setMemoryDirty()};g.prototype._getSymbolInfos=
function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedSymbolInfos};g.prototype._getSymbolColors=function(a){this._hasSymbolColors&&a.cachedRendererVersion!==this._rendererVersion&&this._updateCachedRendererData(a);return a.cachedSymbolColors};g.prototype._updateCachedRendererData=function(a){a.cachedRendererVersion=this._rendererVersion;if(this._hasSymbolColors){var b=a.featureIds?a.featureIds.length:1,c={},d=this._tmpAttributeOnlyGraphic;
d.attributes=c;for(var e=this._currentRenderer,f=null!=a.featureIds?this.layer.objectIdField:null,g=null!=a.attributeData?this._rendererFields:null,h=0;h<b;h++){null!=f&&(c[f]=a.featureIds[h]);if(null!=g)for(var k=0,l=g;k<l.length;k++){var m=l[k];a.attributeData[m]&&(c[m]=J.getCachedAttributeValue(a.attributeData[m],h))}l=e&&e.getSymbol(d);k=null;l instanceof E&&(this._symbolInfos.has(l.id)||this._symbolInfos.set(l.id,J.getSymbolInfo(l)),k=this._symbolInfos.get(l.id));a.cachedSymbolInfos[h]=k;null==
a.cachedSymbolColors&&(a.cachedSymbolColors=new Uint8Array(4*a.featureIds.length));m=l=null;if(this._colorVariable){var p=e.getColor(d,{colorInfo:this._colorVariable,color:Qa});p&&(l=La,l[0]=p.r/255,l[1]=p.g/255,l[2]=p.b/255,this._opacityVariable||null===p.a||(m=p.a))}this._opacityVariable&&(m=e.getOpacity(d,{opacityInfo:this._opacityVariable}));k&&k.material?(k=k.material,l=null==l||null==m?H.overrideColor(l,m,k.color,k.alpha,sa,La):H.overrideColor(l,m,null,null,sa,La),L.encodeSymbolColor(l,k.colorMixMode,
a.cachedSymbolColors,4*h)):L.encodeSymbolColor(null,null,a.cachedSymbolColors,4*h)}}};g.prototype._extractObjectEdgeMaterials=function(a){var b=[],c=a.engineObject,d=a.featureIds?a.featureIds.length:1,e=this._edgeView.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0}),f={opacity:this.fullOpacity,slicePlaneEnabled:this.slicePlaneEnabled},g=!1,h=null,k=null;a=this._getSymbolInfos(a);for(var l=0;l<d;l++){var m=a[l];c.getComponentVisibility(c.getGeometryRecords()[0],l)&&m?(k!==m&&(k=m,(h=R.createMaterialFromEdges(this._edgeView,
m.edges,f))&&(g=!0)),b.push(null!=h?h:e)):b.push(e)}return{hasEdges:g,perFeatureEdgeMaterials:b}};g.prototype._setObjectSymbology=function(a){if(this._hasSymbolColors){for(var b=a.featureIds?a.featureIds.length:1,c=!1,d=this._getSymbolColors(a),e=a.componentColorBuffer.textureBuffer,f=0;f<b;f++){var g=4*f;e.setData(a.componentIndices[f],0,d[g],d[g+1],d[g+2],d[g+3]);L.isOpaqueSymbolColor(d,g)||(c=!0)}this._updateObjectOpacity(a.engineObject,c)}};g.prototype._setComponentIndices=function(a,b){for(var c=
a.getAttribute(X.VertexAttrConstants.COMPONENTINDEX),d=c.data,e=c.offsetIdx,c=c.strideIdx,f=a.getIndices(X.VertexAttrConstants.COMPONENTINDEX),g=0;g<b.length;g++)for(var h=a.componentOffsets[g+1],k=a.componentOffsets[g];k<h;k++)d[e+f[k]*c]=b[g]};g.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&qa.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};g.prototype._reloadAll=function(a){void 0===a&&(a=this.elevationOffset);
this._removeAllNodeDataFromStage(a);null!=this._controller&&this._controller.restartNodeLoading()};g.prototype._opacityChange=function(a){var b=this;this._nodeId2Meta.forEach(function(a){b._updateObjectOpacity(a.engineObject);b._updateEdgeRendering(a)})};g.prototype._updateObjectOpacity=function(a,b){var c=0;for(a=a.getGeometryRecords();c<a.length;c++)for(var d=0,e=a[c].materials;d<e.length;d++){var f=e[d],g=f.metadata;void 0!==b&&(g.symbolIsTransparent=b);var h=f.getParams(),g=this._calcEngineMaterialTransparencyParams(g.i3sTex,
g.i3sMatParams,g.symbolIsTransparent);h.transparent===g.transparent&&h.layerOpacity===g.layerOpacity||f.setParameterValues(g)}};g.prototype._updateEngineObject=function(a,b){this._setObjectSymbology(b);this._addOrUpdateEdgeRendering(b);this._applyFilters(a);this.visibleGeometryChanged(b.engineObject)};g.prototype._slicePlaneEnabledChange=function(a){var b=this,c={slicePlaneEnabled:a};this._nodeId2Meta.forEach(function(a){for(var d=0,e=a.engineObject.getGeometryRecords();d<e.length;d++)for(var f=0,
g=e[d].materials;f<g.length;f++)g[f].setParameterValues(c);b._updateEdgeRendering(a)})};g.prototype._updateEdgeRendering=function(a){this._edgeView&&this._edgeView.hasObject(a.engineObject)&&this._addOrUpdateEdgeRendering(a)};g.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};g.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};g.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};g.prototype.queryObjectIds=
function(a){return this._ensureQueryEngine().queryObjectIds(a)};g.prototype._ensureQueryEngine=function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};g.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,meta:null,bbCorners:new Float64Array(24)};return new U(this.layer,{forAll:function(c,d){a._forAllFeatures(function(d,e,f){b.id=d;b.index=e;b.meta=f;a._boundingBoxCornerPoints(e,f.engineObject,b.bbCorners);c(b)},d)},createGraphic:function(b){return a._createGraphic(b.index,
b.meta)},requestFields:function(b,c,d){return J.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(){var d=a._getGraphicIndices(b,c);return{node:b,indices:d}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){return a._createExtentBuilder()}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};g.prototype._createExtentBuilder=function(){var a=this.view.renderSpatialReference,b=this.view.spatialReference,c=B.empty(),d=new Float64Array(24);return{add:function(e){Z.bufferToBuffer(e.bbCorners,
a,0,d,b,0,8)&&B.expandWithBuffer(c,d,0,8)},getExtent:function(){return B.toExtent(c,b)}}};g.prototype._forAllFeatures=function(a,b,c){var d=this;this._nodeId2Meta.forEach(function(e,f){d._forAllFeaturesOfNode(e,a,c);b&&b(e.node)})};g.prototype._forAllFeaturesOfNode=function(a,b,c){for(var d=a.featureIds,e=a.engineObject.getGeometryRecords()[0],f=0;f<d.length;f++)(c||a.engineObject.getComponentVisibility(e,f))&&b(d[f],f,a,e)};g.prototype._createGraphic=function(a,b){var c={};null!=b.featureIds&&(c[this._getObjectIdField()]=
b.featureIds[a]);if(null!=b.attributeData)for(var d=0,e=Object.keys(b.attributeData);d<e.length;d++){var f=e[d];c[f]=J.getCachedAttributeValue(b.attributeData[f],a)}a=new h(null,null,c);a.layer=this.layer;a.sourceLayer=this.layer;return a};g.prototype._boundingBoxCornerPoints=function(a,b,c){a=b.geometries[0].getComponentAABB(a,Ca);for(var d=0;8>d;++d)wa[0]=d&1?a[0]:a[3],wa[1]=d&2?a[1]:a[4],wa[2]=d&4?a[2]:a[5],S.mat4d.multiplyVec3(b.objectTransformation,wa),c[3*d]=wa[0],c[3*d+1]=wa[1],c[3*d+2]=wa[2];
return c};g.prototype.highlight=function(a,b){var c=this,d=this._highlights;if(a instanceof I){b=d.acquireSet(b);var e=b.set,f=b.handle;this.queryObjectIds(a).then(function(a){return d.setFeatureIds(e,a)});return f}"number"===typeof a?a=[a]:a instanceof h?a=[a]:a instanceof k&&(a=a.toArray());if(Array.isArray(a)&&0<a.length){if(a[0]instanceof h)return a=a.map(function(a){return P.attributeLookup(a.attributes,c._getObjectIdField())}),f=d.acquireSet(b),b=f.set,f=f.handle,d.setFeatureIds(b,a),f;if("number"===
typeof a[0])return f=d.acquireSet(b),b=f.set,f=f.handle,d.setFeatureIds(b,a),f}return{remove:function(){}}};g.prototype.visibleGeometryChanged=function(a){var b=this;a?this._elevationProvider.objectChanged(a):this._elevationProvider.layerChanged();null==this._visibleGeometryChangedSchedulerHandle&&(this._visibleGeometryChangedSchedulerHandle=v.schedule(function(){b.emit("visible-geometry-changed");b._visibleGeometryChangedSchedulerHandle=null}))};a([x.property()],g.prototype,"layer",void 0);a([x.property()],
g.prototype,"_controller",void 0);a([x.property({dependsOn:["_controller.updating"]})],g.prototype,"updating",void 0);a([x.property({dependsOn:["_controller.rootNodeVisible"]})],g.prototype,"suspended",void 0);a([x.property(Q.updatingPercentage)],g.prototype,"updatingPercentage",void 0);a([x.property({readOnly:!0,aliasOf:"_controller.updatingPercentage"})],g.prototype,"updatingPercentageValue",void 0);a([x.property({readOnly:!0})],g.prototype,"hasTexturesOrVertexColors",null);a([x.property({readOnly:!0,
dependsOn:["layer.renderer"]})],g.prototype,"rendererNeedsTextures",null);a([x.property({readOnly:!0,dependsOn:["layer.elevationInfo"]})],g.prototype,"elevationOffset",null);a([x.property({type:Boolean})],g.prototype,"slicePlaneEnabled",void 0);a([x.property()],g.prototype,"alwaysLoadEverythingModeEnabled",void 0);a([x.property({dependsOn:["view.qualitySettings.sceneService.uncompressedTextureDownsamplingEnabled","useCompressedTextures"]})],g.prototype,"uncompressedTextureDownsamplingEnabled",null);
a([x.property({dependsOn:["layer.version"]})],g.prototype,"useCompressedTextures",null);return g=a([x.subclass("esri.views.3d.layers.SceneLayerView3D")],g)}(x.declared(K));var wa=S.vec3d.create(),Ca=B.create(),Pa=B.create(),La=[0,0,0,0],Qa=new e([0,0,0,0]);return g})},"esri/layers/IntegratedMeshLayer":function(){define("require exports ../core/tsSupport/assignHelper ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/Error ../core/promiseUtils ../core/accessorSupport/decorators ./Layer ./mixins/SceneService ../symbols/support/ElevationInfo".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k){return function(d){function g(a,b){a=d.call(this)||this;a.geometryType="mesh";a.operationalLayerType="IntegratedMeshLayer";a.type="integrated-mesh";a.profile="mesh-pyramids";a.elevationInfo=null;return a}a(g,d);g.prototype.normalizeCtorArgs=function(a,b){return"string"===typeof a?c({url:a},b):a};g.prototype.load=function(){var a=this,b=this.loadFromPortal({supportedTypes:["Scene Service"]}).always(function(){return a._fetchService()}).then(function(){return a._verifyRootNodeAndUpdateExtent()});
this.addResolvingPromise(b);return this.when()};g.prototype.importLayerViewModule=function(a){switch(a.type){case "2d":return l.reject(new b("integrated-mesh-layer:view-not-supported","IntegratedMeshLayer is only supported in 3D"));case "3d":return l.create(function(a){return n(["../views/3d/layers/SceneLayerView3D"],a)})}};g.prototype._validateLayer=function(a){if(a.layerType&&"IntegratedMesh"!==a.layerType)throw new b("integrated-mesh-layer:layer-type-not-supported","IntegratedMeshLayer does not support this layer type",
{layerType:a.layerType});if(isNaN(this.version.major)||isNaN(this.version.minor))throw new b("layer:service-version-not-supported","Service version is not supported.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});if(1<this.version.major)throw new b("layer:service-version-too-new","Service version is too new.",{serviceVersion:this.version.versionString,supportedVersions:"1.x"});};f([e.shared("esri.layers.IntegratedMeshLayer")],g.prototype,"declaredClass",void 0);f([e.property({type:String,
readOnly:!0})],g.prototype,"geometryType",void 0);f([e.property()],g.prototype,"operationalLayerType",void 0);f([e.property({json:{read:!1},readOnly:!0})],g.prototype,"type",void 0);f([e.property({type:k,json:{origins:{service:{read:{source:"elevationInfo"}}},read:{source:"layerDefinition.elevationInfo"},write:{target:"layerDefinition.elevationInfo"}}})],g.prototype,"elevationInfo",void 0);return g=f([e.subclass()],g)}(e.declared(h,m))})},"esri/layers/graphics/controllers/I3SOnDemandController":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper dojo/errors/CancelError dojo/promise/all ../../../core/Accessor ../../../core/arrayUtils ../../../core/Evented ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/Promise ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/sql/WhereClause ../../../geometry/support/aaBoundingBox ../../IntegratedMeshLayer ../../SceneLayer ../../../views/3d/layers/i3s/I3SIndex ../../../views/3d/layers/i3s/I3SLodHandling ../../../views/3d/layers/i3s/I3SNodeLoader ../../../views/3d/layers/i3s/I3SUtil ../../../views/3d/layers/i3s/I3SViewportQueries ../../../views/3d/layers/i3s/IdleQueue ../../../views/3d/lib/gl-matrix ../../../views/3d/support/projectionUtils ../../../views/3d/support/ResourceController".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K,N){function H(a,b){return a.length===b.length&&a.every(function(a){return 0<=M(b,a.name)})}function M(a,b){b=b.toLowerCase();for(var c=0;c<a.length;c++)if(a[c].name.toLowerCase()===b)return c;return-1}var T=d.getLogger("esri.layers.graphics.controllers.I3SOnDemandController");n=function(d){function g(a){a=d.call(this)||this;a.nodeIndex={};a.screenSizeFactor=0;a.featureTarget=5E4;a.updating=!0;a.updatingPercentage=0;a.leafsReached=
!1;a.uncompressedTextureDownsamplingEnabled=!1;a.alwaysLoadEverythingModeEnabled=!1;a._lodFactorProperty=null;a._featureLOD=1;a._stableFeatureLOD=!1;a._isIdle=!1;a._cameraDirty=!0;a._hasFeatures=!1;a._downloadingNodes=new Set;a._loadingNodes=new Set;a._updatingNodes=new Map;a._progressMaxNumNodes=1;a._poi=null;a._requiredAttributesDirty=!0;a._updatesDisabled=!1;a.disableCache=!1;a._restartNodeLoading=!1;a._fields=null;a._attributeStorageInfo=null;a._handles=new m;a._idleQueue=new F.IdleQueue;a._errorCount=
0;return a}c(g,d);Object.defineProperty(g.prototype,"isMeshPyramid",{get:function(){return"mesh-pyramids"===this.layer.profile||"MeshPyramid"===this.layer.store.lodType},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"streamDataSupplier",{get:function(){return this.layerView.view.resourceController.getStreamDataSupplier(N.ClientType.SCENE,{trackRequests:!0})},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"parsedDefinitionExpression",{get:function(){if(this.layer instanceof
x&&this.layer.definitionExpression)try{var a=v.create(this.layer.definitionExpression);if(!a.isStandardized())return T.error("definitionExpression is using non standard function"),null;var b=[],c=a.getFields();G.findFieldsCaseInsensitive(c,this.layer.fields,{missingFields:b});return 0<b.length?(T.error("definitionExpression references unknown fields: "+b.join(", ")),null):a}catch(L){return T.error("Failed to parse definitionExpression: "+L),null}else return null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"definitionExpressionFields",{get:function(){if(this.parsedDefinitionExpression){var a=this.parsedDefinitionExpression.getFields();return G.findFieldsCaseInsensitive(a,this._fields)}return null},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"crsVertex",{get:function(){return G.getVertexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,"crsIndex",{get:function(){return G.getIndexCrs(this.layer)},enumerable:!0,configurable:!0});Object.defineProperty(g.prototype,
"rootNodeVisible",{get:function(){var a=this._rootNodeId&&this.nodeIndex[this._rootNodeId];return a&&this._viewportQueries?this._viewportQueries.isNodeVisible(a):!0},enumerable:!0,configurable:!0});g.prototype.initialize=function(){var a=this;this.updateEventListener={needsUpdate:function(){return!1},idleBegin:function(){a._updateIdleState(!0)},idleEnd:function(){a._updateIdleState(!1)}};this.updateEventListenerWhileSuspended={idleBegin:function(){return a._startNodeLoadingWhileSuspended()}};this._lodHandling=
new D(this.layerView,function(){return a.updatingChanged()});var c=this.layerView.layer;this.layer=c;this._defaultGeometrySchema=c.store.defaultGeometrySchema;this._rootNodeUrl=c.store.rootNode;var d=this._rootNodeUrl.split("/");this._rootNodeId=d[d.length-1];this.disableCache=k("disable-feature:idb-cache");c instanceof x?("mesh"===c.geometryType?this._lodFactorProperty="qualitySettings.sceneService.3dObject.lodFactor":"point"===c.geometryType&&(this._lodFactorProperty="qualitySettings.sceneService.point.lodFactor"),
this._fields=c.fields,this._attributeStorageInfo=c.attributeStorageInfo):c instanceof z&&(this._lodFactorProperty="qualitySettings.sceneService.integratedMesh.lodFactor");c=b([this.layer.when(),this.layerView.when()]).then(function(){if(!a.destroyed&&a.layerView&&!a.layerView.destroyed){var b=a.layerView.view;a.setClippingArea(b.clippingArea);a._centerOnSurface=b.pointsOfInterest.centerOnSurfaceFrequent;a._handles.add(a._centerOnSurface.watch("renderLocation",function(){return a._pointOfInterestChanged()}));
var c=a.layerView.view.resourceController;c.memoryEvents.on("quality-changed",function(){return a._setCameraDirty()});a._handles.add(u.init(a.layerView,"suspended",function(b){a._idleFrameWorker&&(a._idleFrameWorker.remove(),a._idleFrameWorker=null,a.restartNodeLoading());a._frameWorker&&(a._frameWorker.remove(),a._frameWorker=null);b?a._idleFrameWorker=c.registerIdleFrameWorker(a.updateEventListenerWhileSuspended):(a._idleFrameWorker=c.registerIdleFrameWorker(a.updateEventListener),a._frameWorker=
c.registerFrameWorker(function(b){return a._frame(b)}))}),"layerview");a._handles.add(a.layer.watch("elevationInfo",function(b){return a._elevationInfoChanged(b)}),"layer");a.watch("uncompressedTextureDownsamplingEnabled",function(){return a.restartNodeLoading()});a.watch("alwaysLoadEverythingModeEnabled",function(){return a.restartNodeLoading()});a._handles.add(b.state.watch("camera",function(){return a._setCameraDirty()}));a._handles.add(a.watch("featureTarget",function(){a._stableFeatureLOD=!1}));
a._lodFactorProperty&&a._handles.add(a.layerView.view.watch(a._lodFactorProperty,function(){return a._setCameraDirty()}),"quality")}});this.addResolvingPromise(c);this.when(function(){return a._startNodeLoading()})};g.prototype.destroy=function(){this._idleFrameWorker&&(this._idleFrameWorker.remove(),this._idleFrameWorker=null);this._frameWorker&&(this._frameWorker.remove(),this._frameWorker=null);this._handles.destroy();this._nodeLoader=null};g.prototype._getRequiredAttributes=function(){if(!(null!=
this._attributeStorageInfo&&this.layer instanceof x&&this._fields))return[];var a=Object.create(null);this.layer.renderer&&this.layer.renderer.collectRequiredFields(a);this.layer.labelsVisible&&this.layer.labelingInfo&&this.layer.labelingInfo.forEach(function(b){b._collectRequiredFields(a)});if(null!=this.definitionExpressionFields)for(var b=0,c=this.definitionExpressionFields;b<c.length;b++)a[c[b]]=!0;var d=this._attributeStorageInfo,e=this._fields,f=this.layer.objectIdField;return Object.keys(a).map(function(a){var b=
M(d,a);a=M(e,a);return 0<=b&&0<=a?{index:b,name:e[a].name,field:e[a],attributeStorageInfo:d[b]}:null}).filter(function(a){return null!=a&&a.name!==f}).sort(function(a,b){return b.index-a.index}).filter(function(a,b,c){return 0===b||c[b-1].index!==a.index})};g.prototype._requiredFieldsChange=function(){this._requiredAttributesDirty=!0;this.restartNodeLoading()};g.prototype._labelingChanged=function(){var a=this._requiredAttributes,b=this._getRequiredAttributes();H(a,b)||this._requiredFieldsChange()};
g.prototype.setClippingArea=function(a){var b=A.create();K.extentToBoundingBox(a,b,this.layerView.view.renderSpatialReference)?this._clippingArea=b:this._clippingArea=null};g.prototype._pointOfInterestChanged=function(){this._poi&&(this._calculatePointOfInterest(this._poi),this._viewportQueries&&(this._viewportQueries.updatePointOfInterest(this._poi),this._index&&(this._index.progressiveLoadPenalty=U.distancePenalty*this._viewportQueries.distCameraToPOI(),this._index.requestReload())))};g.prototype._calculatePointOfInterest=
function(a){void 0===a&&(a=I.vec3d.create());var b=this._centerOnSurface.renderLocation,c=I.vec3d.create();I.vec3d.subtract(b,this.camPos,c);I.vec3d.normalize(c);var d=this.layerView.view.renderCoordsHelper,e=I.vec3d.create();d.worldUpAtPosition(b,e);c=Math.acos(I.vec3d.dot(e,c))-.5*Math.PI;I.vec3d.lerp(this.camPos,b,Math.max(0,Math.min(1,c/(.5*Math.PI))),a);return a};g.prototype.updateClippingArea=function(a){this.setClippingArea(a);this._cameraDirty=!0;this._viewportQueries&&this._viewportQueries.updateExtent(this._clippingArea)};
g.prototype._setCameraDirty=function(){this._cameraDirty=!0;this.updatingChanged()};g.prototype.getBaseUrl=function(){return this.layer.parsedUrl.path};g.prototype.updateElevationChanged=function(a,b,c){G.findIntersectingNodes(a,b,this.nodeIndex.root,this.crsIndex,this.nodeIndex,function(a){c.push(a)});for(a=0;a<c.length;a++)b=c.data[a],this._viewportQueries.invalidateCache(b.id),b.id===this._rootNodeId&&this.notifyChange("rootNodeVisible");c.length&&this.restartNodeLoading()};g.prototype._elevationInfoChanged=
function(a){this._viewportQueries.invalidateCache();this._initViewData()};g.prototype.restartNodeLoading=function(){this._restartNodeLoading=!0;this.updatingChanged()};g.prototype.schedule=function(a,b){var c=this;return this._idleQueue.push(b).then(function(b){if(!c._loadingNodes.has(a)&&!c._updatingNodes.has(a))throw new f;return b})};g.prototype.reschedule=function(a,b){var c=this;return this._idleQueue.unshift(b).then(function(b){if(!c._loadingNodes.has(a)&&!c._updatingNodes.has(a))throw new f;
return b})};g.prototype.getUnloadedMemoryEstimate=function(){return this._index?this._index.getUnloadedMemoryEstimate()*this._getLodDropFactor():0};g.prototype._frame=function(a){null!==this._viewportQueries&&this._viewportQueries.setCameraIdle(!this._cameraDirty);this.layerView.visible&&this._processLogError(a,!1)};g.prototype._processLogError=function(a,b){void 0===b&&(b=!0);try{this._process(a,b)}catch(Q){50>this._errorCount?T.error("Error during processing: "+Q):50===this._errorCount&&T.error("Too many errors for this layer. Further errors will not be displayed."),
this._errorCount++}};g.prototype._process=function(a,b){var c=this;this._restartNodeLoading&&(this.cancelNodeLoading(),this._startNodeLoading());if(null!=this._nodeLoader&&null!=this._index){this._updateViewData()&&(b=!1);var d=function(c){(b||!a.done())&&c()&&(b=!1)};d(function(){return c._processIndex()});for(d(function(){return c._processNodes(a,b)});0<this._idleQueue.length()&&(b||!a.done());)b=!1,this._idleQueue.process();this._updateFeatureLOD();d(function(){return c._prefetchIndex()});this.updatingChanged();
this._lodHandling.lodGlobalHandling()}};g.prototype._processIndex=function(){var a=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));this._index.update(e.keysOfSet(this._loadingNodes));var b=this._index.getFeatureEstimate().leafsReached;this._index.isLoading()||b===this._get("leafsReached")||this._set("leafsReached",b);return this._index.load(a)};g.prototype._prefetchIndex=function(){if(0<this._loadingNodes.size)return!1;var a=Math.min(10-this._index.getIndexLoading(),this._getAvailableLoadTokens(1));
return this._index.prefetch(a)};g.prototype._updateFeatureLOD=function(){var a=this._index.getFeatureEstimate(),b=this.featureTarget*this._getLOD()/this._featureLOD;if(a.estimate){var c=!this._index.isLoading();if(!c&&!this._index.isPrefetching()&&500<this._index.getIndexMissing()){if(1E-4>=this._featureLOD)return;this._featureLOD/=1.5;this._stableFeatureLOD=!1}else if(c&&a.estimate<b){if(1E4<=this._featureLOD||a.leafsReached||this._stableFeatureLOD)return;c=this._featureLOD;this._featureLOD*=1+Math.min(.1*
(b/a.estimate-1),.1);if(!this._index.checkFeatureTarget(b,this._getLOD())){this._featureLOD=c;this._stableFeatureLOD=!0;return}}else if(a.estimate>1.2*b||c&&a.estimate>b){if(1E-4>=this._featureLOD)return;this._featureLOD/=1+.25*(a.estimate/b-1);this._stableFeatureLOD=!1}else return;this._featureLOD=Math.min(1E4,Math.max(1E-4,this._featureLOD));this._viewportQueries.updateScreenSpaceErrorBias(this._getLOD());this._index.requestReload()}};g.prototype._processNodes=function(a,b){var c=this,d=this._index.getUpdates((this._isIdle?
100:2)-this._loadingNodes.size);d.cancel.forEach(this._cancelNodeIdLoading,this);d.update.forEach(function(d){if(b||!a.done())b=!1,c._updateLoadedNode(d)});d.add.forEach(function(d){if(b||!a.done())b=!1,c._loadNode(d)});return!b};g.prototype._cancelNodeLoading=function(){var a=this;this._loadingNodes.clear();this._downloadingNodes.clear();this._updatingNodes.forEach(function(b,c){return a._updatingNodes.get(c).cancel()});this._updatingNodes.clear()};g.prototype._cancelNodeIdLoading=function(a){this._loadingNodes.delete(a);
this._downloadingNodes.delete(a)};g.prototype._getAvailableLoadTokens=function(a){return Math.floor((12-1*this._index.getIndexLoading()-2*this._downloadingNodes.size)/a)};g.prototype._hasNodeLoadToken=function(){return this._downloadingNodes.size>=(this._isIdle?5:2)?!1:0<this._getAvailableLoadTokens(2)};g.prototype.updatingChanged=function(){var a=this._index?this._index.getIndexMissing():0,b=this._index?this._index.getNodesMissing():0,a=a+3*b+2*this._loadingNodes.size,b=!(!(0<a||0<this._updatingNodes.size||
this._index&&this._index.isPrefetching()||this._restartNodeLoading||this._cameraDirty||0<this._idleQueue.length()||this._lodHandling&&this._lodHandling.requiresLODGlobalHandling)&&this._isIdle);0===a&&(this._progressMaxNumNodes=1);this._progressMaxNumNodes=Math.max(a,this._progressMaxNumNodes);b!==this._get("updating")&&this._set("updating",b);a=100*a/this._progressMaxNumNodes;a!==this._get("updatingPercentage")&&this._set("updatingPercentage",a)};g.prototype._initViewData=function(){var a=this.layerView.view,
b=a.state.camera,c=a.renderCoordsHelper;this.camPos=I.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest();var d=this._getLOD();this._viewportQueries=new E(this.crsIndex,c,b,this._poi,this._clippingArea,a.elevationProvider,this.layer.elevationInfo,{progressiveLoadFactor:this._getProgressiveLoadFactor(this.layer,d),screenspaceErrorBias:d,angleDependentLoD:.5>d,disableLod:this.alwaysLoadEverythingModeEnabled});this._cameraDirty=
!1;this.notifyChange("rootNodeVisible")};g.prototype._updateViewData=function(){if(!this._cameraDirty||!this._index)return!1;var a=this.layerView.view,b=a.state.camera;this.camPos=I.vec3d.create(a.pointsOfInterest.renderPointOfView);this.screenSizeFactor=1/b.perPixelRatio;this._poi=this._calculatePointOfInterest(this._poi);this._viewportQueries.updateCamera(b);this._viewportQueries.updatePointOfInterest(this._poi);a=this._getLOD();this._viewportQueries.updateScreenSpaceErrorBias(a);this._index.progressiveLoadPenalty=
U.distancePenalty*this._viewportQueries.distCameraToPOI();this._index.requestReload();this._stableFeatureLOD=!1;a=!this.alwaysLoadEverythingModeEnabled&&this._removeInvisibleNodes();this._cameraDirty=!1;this.notifyChange("rootNodeVisible");return a};g.prototype._getProgressiveLoadFactor=function(a,b){return a instanceof x&&"mesh"===a.geometryType?(a=1<=b&&k("enable-feature:progressive-3dobject"))?U.factor3dObject:1:a instanceof z?(a=1<=b&&!k("disable-feature:progressive-im"))?U.factorIM:1:1};g.prototype._getLOD=
function(){return(this._lodFactorProperty&&this.layerView.view.get(this._lodFactorProperty)||1)*this.layerView.view.resourceController.memoryFactor*this._featureLOD};g.prototype._getLodDropFactor=function(){return Math.min(this.layerView.view.resourceController.memoryFactor,.5)/.5};g.prototype._startNodeLoadingWhileSuspended=function(){this._initViewData();this.alwaysLoadEverythingModeEnabled&&this.layerView.visible&&!this.layerView.get("parent.suspended")||this._removeInvisibleNodes()};g.prototype.isGeometryVisible=
function(a){return this._viewportQueries.isGeometryVisible(a)};g.prototype.updateVisibility=function(a){return this._viewportQueries.updateNode(a)};g.prototype._shouldLoadNode=function(a){if(!this._lodHandling.shouldLoadNode(a))return!1;var b=this._getLodDropFactor();return 0<b&&0<this._viewportQueries.maxDistance&&this._lodHandling.childrenEmpty(a)&&this._viewportQueries.distToPOI(a)>this._viewportQueries.maxDistance*b?!1:a.obb?this._viewportQueries.isGeometryVisible(a):!0};g.prototype._startNodeLoading=
function(){var a=this;this._restartNodeLoading=!1;if(!this._updatesDisabled&&null!=this.streamDataSupplier){this._initViewData();this._requiredAttributesDirty&&(this._requiredAttributes=this._getRequiredAttributes(),this._requiredAttributesDirty=!1,this._handles.add([this.layer.watch("renderer",function(){return a._requiredFieldsChange()}),this.layer.watch("definitionExpression",function(){return a._requiredFieldsChange()}),this.layer.watch("labelsVisible",function(){return a._labelingChanged()}),
this.layer.watch("labelingInfo",function(){return a._labelingChanged()})],"requiredAttributes"));var b=C.TextureFormat.Normal;this.layerView.useCompressedTextures?b=C.TextureFormat.Compressed:this.uncompressedTextureDownsamplingEnabled&&(b=C.TextureFormat.Downsampled);var c=this._defaultGeometrySchema;this._nodeLoader=new C(this.streamDataSupplier,T,c,this._requiredAttributes,{textureFormat:b,loadTextureData:this.layerView.rendererNeedsTextures,loadFeatureData:!this.isMeshPyramid||null==c||null==
c.ordering});b=U.distancePenalty*this._viewportQueries.distCameraToPOI();this._index=new B(this.getBaseUrl(),this._rootNodeUrl,this._rootNodeId,b,this.nodeIndex,this.streamDataSupplier,this._viewportQueries,T,function(b){return a.layerView.isNodeLoaded(b)},function(b){return a._shouldLoadNode(b)},function(b){return a._enableFromGPUCache(b)},function(b){return a._needsUpdate(b)});b=this.layerView.view.renderSpatialReference;b=this.crsIndex.equals(b)||this.crsIndex.isWGS84&&b.equals(K.SphericalECEFSpatialReference);
this._index.ignoreServiceOBB=!b;this.alwaysLoadEverythingModeEnabled||this._removeInvisibleNodes();this._lodHandling.startNodeLoading(function(b){return a._viewportQueries.isNodeVisible(b)},function(b){return a._viewportQueries.isGeometryVisible(b)},function(b){return a._index.nodeTraversalState(b)},this.nodeIndex,this._rootNodeId,{maxLodLevel:this._viewportQueries.maxLodLevel});this.updatingChanged()}};g.prototype.isNodeLoading=function(){return null!=this._nodeLoader&&null!=this._index};g.prototype.cancelNodeLoading=
function(){this.isNodeLoading()&&(this._nodeLoader.cancelAll(),this.streamDataSupplier.cancelAll(),this._idleQueue.cancelAll(),this._cancelNodeLoading(),this._poi=this._index=this._nodeLoader=null,this.layerView.additionalCancelNodeLoadingHandler&&this.layerView.additionalCancelNodeLoadingHandler(),this.updatingChanged())};g.prototype._removeInvisibleNodes=function(){var a=this.layerView.getLoadedNodeIDs(),b=this._getLodDropFactor(),c=this._viewportQueries.maxDistance*b,b=0<b&&0<c;V.clear();for(var d=
0;d<a.length;d++){var e=this.nodeIndex[a[d]];if(!this._viewportQueries.isGeometryVisible(e)||b&&this._lodHandling.childrenEmpty(e)&&this._viewportQueries.distToPOI(e)>c)this._lodHandling.setLodGlobalDirty(),V.push(e)}return 0<V.length?(this.layerView.removeNodeData(V),V.clear(),!0):!1};g.prototype._needsUpdate=function(a){if(null==a.featureData||0===a.featureData.length||this._updatingNodes.has(a.id))return!1;a=this.layerView.getLoadedAttributes(a);return null!=a&&a!==this._requiredAttributes};g.prototype._updateLoadedNode=
function(a){var b=this,c=a.baseUrl,d=this.layerView.getLoadedAttributes(a),c=H(d,this._requiredAttributes)?r.resolve(this.layerView.getAttributeData(a)):this._nodeLoader.loadAttributes(a,c,this._requiredAttributes);this._updatingNodes.set(a.id,c);c.then(function(c){return b.schedule(a.id).then(function(){return b.layerView.setAttributeData(a,b._requiredAttributes,c)})}).catch(function(c){c instanceof f||b.layerView.setAttributeData(a,b._requiredAttributes,{})}).always(function(){b._updatingNodes.delete(a.id);
b.updatingChanged()});this.updatingChanged()};g.prototype._loadNode=function(a){var b=this;if(!a.notInCache||this._hasNodeLoadToken())this._loadingNodes.add(a.id),this.updatingChanged(),this._loadAndAddBundle(a).always(function(){b._loadingNodes.delete(a.id);b._hasFeatures=b._hasFeatures||!!a.numFeatures;b.updatingChanged()})};g.prototype._loadAndAddBundle=function(a){1!==a.featureData.length&&T.warn("Node ${node.id} has ${node.featureData.length} bundles. Only the first bundle will be loaded.");
return a.notInCache?this._loadUncached(a):this._loadCached(a).then(function(b){b||(a.notInCache=!0)}).catch(function(b){b instanceof f||(a.notInCache=!0)})};g.prototype._enableFromGPUCache=function(a){if(this.disableCache||!this.layerView.loadCachedGPUData||!this.layerView.addCachedGPUData)return!1;var b=this.layerView.loadCachedGPUData(a);if(!b||null==b.loadedAttributes||null==b.attributeData||!H(b.loadedAttributes,this._requiredAttributes))return!1;this.layerView.addCachedGPUData(a,b,b);this._lodHandling.lodSwapBundleLoaded(a);
return!0};g.prototype._loadCached=function(a){var b=this,c=this.layerView;return!this.disableCache&&c.loadCachedNodeData&&c.addCachedNodeData?this.schedule(a.id).then(function(){return c.loadCachedNodeData(a,function(a,c){return b._nodeLoader.loadTextures(a,c)})}).then(function(d){if(null==d)return!1;var e=b._requiredAttributes;return null!=d.loadedAttributes&&null!=d.attributeData&&H(d.loadedAttributes,e)?b.reschedule(a.id).then(function(){return c.addCachedNodeData(a,d,d)}).then(function(){b._lodHandling.lodSwapBundleLoaded(a);
return!0}):b.reschedule(a.id).then(function(){return b._nodeLoader.loadAttributes(a,a.baseUrl,e)}).then(function(c){return b.reschedule(a.id,{loadedAttributes:e,attributeData:c})}).then(function(b){return c.addCachedNodeData(a,d,b)}).then(function(){b._lodHandling.lodSwapBundleLoaded(a);return!0})}):r.resolve(!1)};g.prototype._loadUncached=function(a){var b=this;this._downloadingNodes.add(a.id);return this._nodeLoader.loadBundleData(a,0).then(function(c){b._downloadingNodes.delete(a.id);return b.schedule(a.id,
c)}).then(function(c){return b.layerView.addNodeData(a,c)}).then(function(){b._lodHandling.lodSwapBundleLoaded(a);a.notInCache=!1}).catch(function(b){b instanceof f||(T.error("Failed to load node '"+a.id+"' bundle 0: "+b),a.failed=!0)})};g.prototype._updateIdleState=function(a){a!==this._isIdle&&(this._isIdle=a,this._viewportQueries&&this._viewportQueries.setCameraIdle(!0),this.updatingChanged())};g.prototype.updateStats=function(a){a.index=Object.keys(this.nodeIndex).length;this._hasFeatures&&(a.detail=
this._featureLOD,a.target=Math.round(this.featureTarget*this._getLOD()/this._featureLOD));this._index&&this._index.updateStats(a)};a([t.property({readOnly:!0})],g.prototype,"isMeshPyramid",null);a([t.property({readOnly:!0})],g.prototype,"streamDataSupplier",null);a([t.property({readOnly:!0,dependsOn:["layer.definitionExpression"]})],g.prototype,"parsedDefinitionExpression",null);a([t.property({readOnly:!0,dependsOn:["parsedDefinitionExpression"]})],g.prototype,"definitionExpressionFields",null);a([t.property({readOnly:!0})],
g.prototype,"crsVertex",null);a([t.property({readOnly:!0})],g.prototype,"crsIndex",null);a([t.property({readOnly:!0})],g.prototype,"nodeIndex",void 0);a([t.property()],g.prototype,"camPos",void 0);a([t.property()],g.prototype,"screenSizeFactor",void 0);a([t.property()],g.prototype,"featureTarget",void 0);a([t.property()],g.prototype,"layerView",void 0);a([t.property()],g.prototype,"layer",void 0);a([t.property({readOnly:!0})],g.prototype,"updating",void 0);a([t.property({readOnly:!0})],g.prototype,
"updatingPercentage",void 0);a([t.property({readOnly:!0})],g.prototype,"leafsReached",void 0);a([t.property({readOnly:!0})],g.prototype,"rootNodeVisible",null);a([t.property({aliasOf:"layerView.uncompressedTextureDownsamplingEnabled"})],g.prototype,"uncompressedTextureDownsamplingEnabled",void 0);a([t.property({aliasOf:"layerView.alwaysLoadEverythingModeEnabled"})],g.prototype,"alwaysLoadEverythingModeEnabled",void 0);return g=a([t.subclass("esri.layers.graphics.controllers.I3SOnDemandController")],
g)}(t.declared(l,p,h));var V=new q,U={factorIM:.2,factor3dObject:.05,distancePenalty:10};return n})},"esri/core/sql/WhereClause":function(){define("require exports @dojo/framework/shim/array @dojo/framework/shim/Map ../../moment ./AggregateFunctions ./StandardizedFunctions ./WhereGrammar".split(" "),function(n,g,c,a,f,b,l,e){function h(a){return Array.isArray(a)?a:[a]}function m(a){return null!==a?!0!==a:null}function k(a,b){if(null==a)return null;for(var c=!1,d=0;d<b.length;d++){var e=b[d];if(null==
e)c=null;else if(a===e){c=!0;break}}return c}function d(a,b,c){if(null==a)return null;for(var d="",e=0,f=0;f<b.length;f++){var g=b.charAt(f);switch(e){case 0:g===c?e=1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):"%"===g?d+".*":"_"===g?d+".":d+g;break;case 1:d=0<="-[]/{}()*+?.\\^$|".indexOf(g)?d+("\\"+g):d+g,e=0}}return(new RegExp("^"+d+"$")).test(a)}function q(a){return a instanceof Date?a.valueOf():a}function p(a,b,c){if(null==b||null==c)return null;b=q(b);c=q(c);switch(a){case "\x3c\x3e":return b!==
c;case "\x3d":return b===c;case "\x3e":return b>c;case "\x3c":return b<c;case "\x3e\x3d":return b>=c;case "\x3c\x3d":return b<=c}}function r(a){for(var b=[],c={},d=0;d<a.length;d++){var e=a[d],f=e.toLowerCase();void 0===c[f]&&(b.push(e),c[f]=1)}return b}return function(){function g(){this._hasAggregateFunctions=this._hasStandardizedFunctions=this.parameters=this.parseTree=null}g.create=function(a){var c=new g;c.parseTree=e.WhereGrammar.parse(a);var d=!0,f=!0;c.visitAll(c.parseTree,function(a){if("function"===
a.type){var c=a.name;a=a.args.value.length;d&&(d=l.isStandardized(c,a));f&&(f=b.isAggregate(c,a))}});c._hasStandardizedFunctions=d;c._hasAggregateFunctions=f;return c};g.prototype.isStandardized=function(){return this._hasStandardizedFunctions};g.prototype.isAggregate=function(){return this._hasAggregateFunctions};g.prototype.setVariablesDictionary=function(a){this.parameters=a};g.prototype.testFeature=function(a){return!!this.evaluateNode(this.parseTree,a)};g.prototype.testSet=function(b){var c=
this,d=new a.default;this.visitAll(this.parseTree,function(a){"column_ref"!==a.type||d.has(a.column)||d.set(a.column,a)});for(var e={},f=function(a){d.forEach(function(b,d){b=c.featureValue(a,d,b);e[d]?e[d].push(b):e[d]=[b]})},g=0;g<b.length;g++)f(b[g]);return!!this.evaluateNode(this.parseTree,{attributes:e})};g.prototype.calculateValue=function(a){return this.evaluateNode(this.parseTree,a)};g.prototype.getFunctions=function(){var a=[];this.visitAll(this.parseTree,function(b){"function"===b.type&&
a.push(b.name.toLowerCase())});return r(a)};g.prototype.getExpressions=function(){var b=new a.default;this.visitAll(this.parseTree,function(a){if("function"===a.type){var c=a.name.toLowerCase();a=a.args.value[0];if("column_ref"===a.type){a=a.column;var d=c+"-"+a;b.has(d)||b.set(d,{aggregateType:c,field:a})}}});return c.from(b.values())};g.prototype.getFields=function(){var a=[];this.visitAll(this.parseTree,function(b){"column_ref"===b.type&&a.push(b.column)});return r(a)};g.prototype.getVariables=
function(){var a=[];this.visitAll(this.parseTree,function(b){"param"===b.type&&a.push(b.value.toLowerCase())});return r(a)};g.prototype.featureValue=function(a,b,c){a=a&&"object"===typeof a.attributes?a.attributes:a;var d=a[b];if(void 0!==d)return d;for(var e in a)if(b.toLowerCase()===e.toLowerCase())return c.column=e,a[e];return null};g.prototype.visitAll=function(a,b){if(null!=a)switch(b(a),a.type){case "when_clause":this.visitAll(a.operand,b);this.visitAll(a.value,b);break;case "case_expression":for(var c=
0,d=a.clauses;c<d.length;c++){var e=d[c];this.visitAll(e,b)}"simple"===a.format&&this.visitAll(a.operand,b);null!==a.else&&this.visitAll(a.else,b);break;case "expr_list":c=0;for(a=a.value;c<a.length;c++)e=a[c],this.visitAll(e,b);break;case "unary_expr":this.visitAll(a.expr,b);break;case "binary_expr":this.visitAll(a.left,b);this.visitAll(a.right,b);break;case "function":this.visitAll(a.args,b)}};g.prototype.evaluateNode=function(a,c){switch(a.type){case "case_expression":if("simple"===a.format)for(var e=
q(this.evaluateNode(a.operand,c)),g=0;g<a.clauses.length;g++){if(e===q(this.evaluateNode(a.clauses[g].operand,c)))return this.evaluateNode(a.clauses[g].value,c)}else for(g=0;g<a.clauses.length;g++)if(!0===this.evaluateNode(a.clauses[g].operand,c))return this.evaluateNode(a.clauses[g].value,c);return null!==a.else?this.evaluateNode(a.else,c):null;case "param":return this.parameters[a.value.toLowerCase()];case "expr_list":e=[];g=0;for(a=a.value;g<a.length;g++){var n=a[g];e.push(this.evaluateNode(n,
c))}return e;case "unary_expr":return m(this.evaluateNode(a.expr,c));case "binary_expr":switch(a.operator){case "AND":return e=this.evaluateNode(a.left,c),c=this.evaluateNode(a.right,c),null!=e&&null!=c?!0===e&&!0===c:!1===e||!1===c?!1:null;case "OR":return e=this.evaluateNode(a.left,c),c=this.evaluateNode(a.right,c),null!=e&&null!=c?!0===e||!0===c:!0===e||!0===c?!0:null;case "IS":if("null"!==a.right.type)throw Error("Unsupported RHS for IS");return null===this.evaluateNode(a.left,c);case "ISNOT":if("null"!==
a.right.type)throw Error("Unsupported RHS for IS");return null!==this.evaluateNode(a.left,c);case "IN":return e=h(this.evaluateNode(a.right,c)),k(this.evaluateNode(a.left,c),e);case "NOT IN":return e=h(this.evaluateNode(a.right,c)),m(k(this.evaluateNode(a.left,c),e));case "BETWEEN":return e=this.evaluateNode(a.left,c),c=this.evaluateNode(a.right,c),null==e||null==c[0]||null==c[1]?null:e>=c[0]&&e<=c[1];case "NOTBETWEEN":return e=this.evaluateNode(a.left,c),c=this.evaluateNode(a.right,c),null==e||null==
c[0]||null==c[1]?null:e<c[0]||e>c[1];case "LIKE":return d(this.evaluateNode(a.left,c),this.evaluateNode(a.right,c),a.escape);case "NOT LIKE":return m(d(this.evaluateNode(a.left,c),this.evaluateNode(a.right,c),a.escape));case "\x3c\x3e":case "\x3c":case "\x3e":case "\x3e\x3d":case "\x3c\x3d":case "\x3d":return p(a.operator,this.evaluateNode(a.left,c),this.evaluateNode(a.right,c));case "*":return this.evaluateNode(a.left,c)*this.evaluateNode(a.right,c);case "-":return this.evaluateNode(a.left,c)-this.evaluateNode(a.right,
c);case "+":return this.evaluateNode(a.left,c)+this.evaluateNode(a.right,c);case "/":return this.evaluateNode(a.left,c)/this.evaluateNode(a.right,c)}throw Error("Not Supported Operator "+a.operator);case "null":case "bool":case "string":case "number":return a.value;case "date":return f(a.value,["YYYY-M-D"]).toDate();case "timestamp":return f(a.value,["YYYY-M-D H:m:s","YYYY-M-D H:mZ","YYYY-M-D H:m:sZ","YYYY-M-D H:m","YYYY-m-d"]).toDate();case "column_ref":return"CURRENT_DATE"===a.column.toUpperCase()?
(n=new Date,n.setHours(0,0,0,0),n):"CURRENT_TIMESTAMP"===a.column.toUpperCase()?new Date:this.featureValue(c,a.column,a);case "function":return c=this.evaluateNode(a.args,c),this.isAggregate()?b.aggregateFunction(a.name,c):l.evaluateFunction(a.name,c)}throw Error("Unsupported sql syntax "+a.type);};return g}()})},"@dojo/framework/shim/array":function(){(function(n){"object"===typeof module&&"object"===typeof module.exports?(n=n(require,exports),void 0!==n&&(module.exports=n)):"function"===typeof define&&
define.amd&&define("require exports tslib ./global ./iterator ./number ./support/has ./support/util".split(" "),n)})(function(n,g){Object.defineProperty(g,"__esModule",{value:!0});var c=n("tslib"),a=n("./global"),f=n("./iterator"),b=n("./number"),l=n("./support/has");n=n("./support/util");if(l.default("es6-array")&&l.default("es6-array-fill"))g.from=a.default.Array.from,g.of=a.default.Array.of,g.copyWithin=n.wrapNative(a.default.Array.prototype.copyWithin),g.fill=n.wrapNative(a.default.Array.prototype.fill),
g.find=n.wrapNative(a.default.Array.prototype.find),g.findIndex=n.wrapNative(a.default.Array.prototype.findIndex);else{var e=function(a){if(isNaN(a))return 0;a=Number(a);isFinite(a)&&(a=Math.floor(a));return Math.min(Math.max(a,0),b.MAX_SAFE_INTEGER)},h=function(a){a=Number(a);return isNaN(a)?0:0!==a&&isFinite(a)?(0<a?1:-1)*Math.floor(Math.abs(a)):a},m=function(a,b){return 0>a?Math.max(b+a,0):Math.min(a,b)};g.from=function(a,b,g){if(null==a)throw new TypeError("from: requires an array-like object");
b&&g&&(b=b.bind(g));g=e(a.length);var d="function"===typeof this?Object(new this(g)):Array(g);if(!f.isArrayLike(a)&&!f.isIterable(a))return d;if(f.isArrayLike(a)){if(0===g)return[];for(var h=0;h<a.length;h++)d[h]=b?b(a[h],h):a[h]}else{h=0;try{for(var k=c.__values(a),l=k.next();!l.done;l=k.next()){var m=l.value;d[h]=b?b(m,h):m;h++}}catch(x){q={error:x}}finally{try{l&&!l.done&&(n=k.return)&&n.call(k)}finally{if(q)throw q.error;}}}void 0!==a.length&&(d.length=g);return d;var q,n};g.of=function(){for(var a=
[],b=0;b<arguments.length;b++)a[b]=arguments[b];return Array.prototype.slice.call(a)};g.copyWithin=function(a,b,c,f){if(null==a)throw new TypeError("copyWithin: target must be an array-like object");var d=e(a.length);b=m(h(b),d);c=m(h(c),d);f=m(void 0===f?d:h(f),d);f=Math.min(f-c,d-b);d=1;b>c&&b<c+f&&(d=-1,c+=f-1,b+=f-1);for(;0<f;)c in a?a[b]=a[c]:delete a[b],b+=d,c+=d,f--;return a};g.fill=function(a,b,c,f){var d=e(a.length);c=m(h(c),d);for(f=m(void 0===f?d:h(f),d);c<f;)a[c++]=b;return a};g.find=
function(a,b,c){b=g.findIndex(a,b,c);return-1!==b?a[b]:void 0};g.findIndex=function(a,b,c){var d=e(a.length);if(!b)throw new TypeError("find: second argument must be a function");c&&(b=b.bind(c));for(c=0;c<d;c++)if(b(a[c],c,a))return c;return-1}}l.default("es7-array")?g.includes=n.wrapNative(a.default.Array.prototype.includes):g.includes=function(a,c,e){void 0===e&&(e=0);var d;d=a.length;d=Number(d);isNaN(d)?d=0:(isFinite(d)&&(d=Math.floor(d)),d=Math.min(Math.max(d,0),b.MAX_SAFE_INTEGER));for(;e<
d;++e){var f=a[e];if(c===f||c!==c&&f!==f)return!0}return!1}})},"@dojo/framework/shim/number":function(){(function(n){"object"===typeof module&&"object"===typeof module.exports?(n=n(require,exports),void 0!==n&&(module.exports=n)):"function"===typeof define&&define.amd&&define(["require","exports","./global"],n)})(function(n,g){function c(a){return"number"===typeof a&&f.default.isFinite(a)}function a(a){return c(a)&&Math.floor(a)===a}Object.defineProperty(g,"__esModule",{value:!0});var f=n("./global");
g.EPSILON=1;g.MAX_SAFE_INTEGER=Math.pow(2,53)-1;g.MIN_SAFE_INTEGER=-g.MAX_SAFE_INTEGER;g.isNaN=function(a){return"number"===typeof a&&f.default.isNaN(a)};g.isFinite=c;g.isInteger=a;g.isSafeInteger=function(b){return a(b)&&Math.abs(b)<=g.MAX_SAFE_INTEGER}})},"@dojo/framework/shim/Map":function(){(function(n){"object"===typeof module&&"object"===typeof module.exports?(n=n(require,exports),void 0!==n&&(module.exports=n)):"function"===typeof define&&define.amd&&define("require exports tslib ./iterator ./global ./object ./support/has ./Symbol".split(" "),
n)})(function(n,g){Object.defineProperty(g,"__esModule",{value:!0});var c=n("tslib"),a=n("./iterator"),f=n("./global"),b=n("./object"),l=n("./support/has");n("./Symbol");g.Map=f.default.Map;l.default("es6-map")||(g.Map=(e=function(){function e(b){this._keys=[];this._values=[];this[Symbol.toStringTag]="Map";if(b)if(a.isArrayLike(b))for(var e=0;e<b.length;e++){var d=b[e];this.set(d[0],d[1])}else try{for(var e=c.__values(b),f=e.next();!f.done;f=e.next())d=f.value,this.set(d[0],d[1])}catch(u){g={error:u}}finally{try{f&&
!f.done&&(h=e.return)&&h.call(e)}finally{if(g)throw g.error;}}var g,h}e.prototype._indexOfKey=function(a,c){for(var d=0,e=a.length;d<e;d++)if(b.is(a[d],c))return d;return-1};Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0});e.prototype.clear=function(){this._keys.length=this._values.length=0};e.prototype.delete=function(a){a=this._indexOfKey(this._keys,a);if(0>a)return!1;this._keys.splice(a,1);this._values.splice(a,1);return!0};e.prototype.entries=
function(){var b=this,c=this._keys.map(function(a,c){return[a,b._values[c]]});return new a.ShimIterator(c)};e.prototype.forEach=function(a,b){for(var c=this._keys,e=this._values,f=0,g=c.length;f<g;f++)a.call(b,e[f],c[f],this)};e.prototype.get=function(a){a=this._indexOfKey(this._keys,a);return 0>a?void 0:this._values[a]};e.prototype.has=function(a){return-1<this._indexOfKey(this._keys,a)};e.prototype.keys=function(){return new a.ShimIterator(this._keys)};e.prototype.set=function(a,b){var c=this._indexOfKey(this._keys,
a),c=0>c?this._keys.length:c;this._keys[c]=a;this._values[c]=b;return this};e.prototype.values=function(){return new a.ShimIterator(this._values)};e.prototype[Symbol.iterator]=function(){return this.entries()};return e}(),e[Symbol.species]=e,e));g.default=g.Map;var e})},"@dojo/framework/shim/object":function(){(function(n){"object"===typeof module&&"object"===typeof module.exports?(n=n(require,exports),void 0!==n&&(module.exports=n)):"function"===typeof define&&define.amd&&define(["require","exports",
"./global","./support/has","./Symbol"],n)})(function(n,g){Object.defineProperty(g,"__esModule",{value:!0});var c=n("./global"),a=n("./support/has"),f=n("./Symbol");a.default("es6-object")?(n=c.default.Object,g.assign=n.assign,g.getOwnPropertyDescriptor=n.getOwnPropertyDescriptor,g.getOwnPropertyNames=n.getOwnPropertyNames,g.getOwnPropertySymbols=n.getOwnPropertySymbols,g.is=n.is,g.keys=n.keys):(g.keys=function(a){return Object.keys(a).filter(function(a){return!a.match(/^@@.+/)})},g.assign=function(a){for(var b=
[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];if(null==a)throw new TypeError("Cannot convert undefined or null to object");var f=Object(a);b.forEach(function(a){a&&g.keys(a).forEach(function(b){f[b]=a[b]})});return f},g.getOwnPropertyDescriptor=function(a,c){f.isSymbol(c);return Object.getOwnPropertyDescriptor(a,c)},g.getOwnPropertyNames=function(a){return Object.getOwnPropertyNames(a).filter(function(a){return!a.match(/^@@.+/)})},g.getOwnPropertySymbols=function(a){return Object.getOwnPropertyNames(a).filter(function(a){return!!a.match(/^@@.+/)}).map(function(a){return Symbol.for(a.substring(2))})},
g.is=function(a,c){return a===c?0!==a||1/a===1/c:a!==a&&c!==c});a.default("es2017-object")?(n=c.default.Object,g.getOwnPropertyDescriptors=n.getOwnPropertyDescriptors,g.entries=n.entries,g.values=n.values):(g.getOwnPropertyDescriptors=function(a){return g.getOwnPropertyNames(a).reduce(function(b,c){b[c]=g.getOwnPropertyDescriptor(a,c);return b},{})},g.entries=function(a){return g.keys(a).map(function(b){return[b,a[b]]})},g.values=function(a){return g.keys(a).map(function(b){return a[b]})})})},"esri/core/sql/AggregateFunctions":function(){define(["require",
"exports"],function(n,g){function c(a){for(var b=0,c=0;c<a.length;c++)b+=a[c];return b/a.length}function a(a){for(var b=c(a),e=a.length,f=0,g=0;g<a.length;g++)f+=Math.pow(a[g]-b,2);return 1<e?f/(e-1):0}Object.defineProperty(g,"__esModule",{value:!0});g.aggregateFunction=function(a,c){var b=f[a.toLowerCase()];if(null==b)throw Error("Function Not Recognised");if(c.length<b.minParams||c.length>b.maxParams)throw Error("Invalid Parameter count for call to "+a.toUpperCase());return b.evaluate(c)};g.isAggregate=
function(a,c){a=f[a.toLowerCase()];return null!=a&&c>=a.minParams&&c<=a.maxParams};var f={min:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.min.apply(Math,a[0])}},max:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.max.apply(Math,a[0])}},avg:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:c(a[0])}},sum:{minParams:1,maxParams:1,evaluate:function(a){if(null==a[0])a=null;else{a=a[0];for(var b=0,c=0;c<a.length;c++)b+=a[c];a=b}return a}},
stddev:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:Math.sqrt(a(b[0]))}},count:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].length}},var:{minParams:1,maxParams:1,evaluate:function(b){return null==b[0]?null:a(b[0])}}}})},"esri/core/sql/StandardizedFunctions":function(){define(["require","exports","dojo/regexp"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});g.evaluateFunction=function(c,b){var f=a[c.toLowerCase()];if(null==f)throw Error("Function Not Recognised");
if(b.length<f.minParams||b.length>f.maxParams)throw Error("Invalid Parameter count for call to "+c.toUpperCase());return f.evaluate(b)};g.isStandardized=function(c,b){c=a[c.toLowerCase()];return null!=c&&b>=c.minParams&&b<=c.maxParams};var a={extract:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];if(null==a)return null;if(a instanceof Date)switch(b.toUpperCase()){case "SECOND":return a.getSeconds();case "MINUTE":return a.getMinutes();case "HOUR":return a.getHours();case "DAY":return a.getDate();
case "MONTH":return a.getMonth()+1;case "YEAR":return a.getFullYear()}throw Error("Invalid Parameter for call to EXTRACT");}},substring:{minParams:2,maxParams:3,evaluate:function(a){if(2===a.length){var b=a[0],c=a[1];return null==b||null==c?null:b.toString().substring(c-1)}if(3===a.length)return b=a[0],c=a[1],a=a[2],null==b||null==c||null==a?null:0>=a?"":b.toString().substring(c-1,c+a-1)}},position:{minParams:2,maxParams:2,evaluate:function(a){var b=a[0];a=a[1];return null==b||null==a?null:a.indexOf(b)+
1}},trim:{minParams:2,maxParams:3,evaluate:function(a){var b=3===a.length,f=b?a[1]:" ",b=b?a[2]:a[1];if(null==f||null==b)return null;f="("+c.escapeString(f)+")";switch(a[0]){case "BOTH":return b.replace(new RegExp("^"+f+"*|"+f+"*$","g"),"");case "LEADING":return b.replace(new RegExp("^"+f+"*","g"),"");case "TRAILING":return b.replace(new RegExp(f+"*$","g"),"")}throw Error("Invalid Parameter for call to TRIM");}},abs:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.abs(a[0])}},
ceiling:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.ceil(a[0])}},floor:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.floor(a[0])}},log:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])}},log10:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.log(a[0])*Math.LOG10E}},sin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.sin(a[0])}},cos:{minParams:1,maxParams:1,
evaluate:function(a){return null==a[0]?null:Math.cos(a[0])}},tan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.tan(a[0])}},asin:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.asin(a[0])}},acos:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.acos(a[0])}},atan:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:Math.atan(a[0])}},sign:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:
0<a[0]?1:0>a[1]?-1:0}},power:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:Math.pow(a[0],a[1])}},mod:{minParams:2,maxParams:2,evaluate:function(a){return null==a[0]||null==a[1]?null:a[0]%a[1]}},round:{minParams:1,maxParams:2,evaluate:function(a){var b=a[0];a=2===a.length?Math.pow(10,a[1]):1;return null==b?null:Math.round(b*a)/a}},truncate:{minParams:1,maxParams:2,evaluate:function(a){return null==a[0]?null:1===a.length?parseInt(a[0].toFixed(0),10):parseFloat(a[0].toFixed(a[1]))}},
char_length:{minParams:1,maxParams:1,evaluate:function(a){return"string"===typeof a[0]||a[0]instanceof String?a[0].length:0}},concat:{minParams:1,maxParams:Infinity,evaluate:function(a){for(var b="",c=0;c<a.length;c++){if(null==a[c])return null;b+=a[c].toString()}return b}},lower:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toLowerCase()}},upper:{minParams:1,maxParams:1,evaluate:function(a){return null==a[0]?null:a[0].toString().toUpperCase()}}}})},"esri/core/sql/WhereGrammar":function(){define(["require",
"exports","./sql92grammar"],function(n,g,c){Object.defineProperty(g,"__esModule",{value:!0});n=function(){function a(){}a.parse=function(a){return c.parse(a)};return a}();g.WhereGrammar=n})},"esri/core/sql/sql92grammar":function(){define([],function(){function n(g,c,a,f){this.message=g;this.expected=c;this.found=a;this.location=f;this.name="SyntaxError";"function"===typeof Error.captureStackTrace&&Error.captureStackTrace(this,n)}(function(g,c){function a(){this.constructor=g}a.prototype=c.prototype;
g.prototype=new a})(n,Error);n.buildMessage=function(g,c){function a(a){return a.charCodeAt(0).toString(16).toUpperCase()}function f(b){return b.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}function b(b){return b.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,
"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(b){return"\\x0"+a(b)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(b){return"\\x"+a(b)})}var l={literal:function(a){return'"'+f(a.text)+'"'},"class":function(a){var c="",e;for(e=0;e<a.parts.length;e++)c+=a.parts[e]instanceof Array?b(a.parts[e][0])+"-"+b(a.parts[e][1]):b(a.parts[e]);return"["+(a.inverted?"^":"")+c+"]"},any:function(a){return"any character"},end:function(a){return"end of input"},other:function(a){return a.description}};
return"Expected "+function(a){var b=Array(a.length),c;for(c=0;c<a.length;c++){var e=c,d;d=a[c];d=l[d.type](d);b[e]=d}b.sort();if(0<b.length){for(a=c=1;c<b.length;c++)b[c-1]!==b[c]&&(b[a]=b[c],a++);b.length=a}switch(b.length){case 1:return b[0];case 2:return b[0]+" or "+b[1];default:return b.slice(0,-1).join(", ")+", or "+b[b.length-1]}}(g)+" but "+(c?'"'+f(c)+'"':"end of input")+" found."};return{SyntaxError:n,parse:function(g,c){function a(a,b){return{type:"literal",text:a,ignoreCase:b}}function f(a,
b,c){return{type:"class",parts:a,inverted:b,ignoreCase:c}}function b(a){var b=Ta[a],c;if(!b){for(c=a-1;!Ta[c];)c--;b=Ta[c];for(b={line:b.line,column:b.column};c<a;)10===g.charCodeAt(c)?(b.line++,b.column=1):b.column++,c++;Ta[a]=b}return b}function l(a,c){var d=b(a),e=b(c);return{start:{offset:a,line:d.line,column:d.column},end:{offset:c,line:e.line,column:e.column}}}function e(a){y<Da||(y>Da&&(Da=y,fb=[]),fb.push(a))}function h(){var a,b,c;a=y;b=X();b!==w?(b=k(),b!==w?(c=X(),c!==w?a=b:(y=a,a=w)):
(y=a,a=w)):(y=a,a=w);return a}function m(){var a,b,c,d,e,f,g,h;a=y;b=k();if(b!==w){c=[];d=y;e=X();e!==w?(f=ha(),f!==w?(g=X(),g!==w?(h=k(),h!==w?d=e=[e,f,g,h]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);for(;d!==w;)c.push(d),d=y,e=X(),e!==w?(f=ha(),f!==w?(g=X(),g!==w?(h=k(),h!==w?d=e=[e,f,g,h]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);if(c!==w){a={type:"expr_list"};b=[b];for(d=0;d<c.length;d++)b.push(c[d][3]);a.value=b}else y=a,a=w}else y=a,a=w;return a}function k(){var a,b,c,e,f,g,h,k;a=y;b=d();if(b!==
w){c=[];e=y;f=X();f!==w?(g=aa(),g!==w?(h=X(),h!==w?(k=d(),k!==w?e=f=[f,g,h,k]:(y=e,e=w)):(y=e,e=w)):(y=e,e=w)):(y=e,e=w);for(;e!==w;)c.push(e),e=y,f=X(),f!==w?(g=aa(),g!==w?(h=X(),h!==w?(k=d(),k!==w?e=f=[f,g,h,k]:(y=e,e=w)):(y=e,e=w)):(y=e,e=w)):(y=e,e=w);c!==w?a=b=ka(b,c):(y=a,a=w)}else y=a,a=w;return a}function d(){var a,b,c,d,e,f,g,h;a=y;b=q();if(b!==w){c=[];d=y;e=X();e!==w?(f=S(),f!==w?(g=X(),g!==w?(h=q(),h!==w?d=e=[e,f,g,h]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);for(;d!==w;)c.push(d),d=y,
e=X(),e!==w?(f=S(),f!==w?(g=X(),g!==w?(h=q(),h!==w?d=e=[e,f,g,h]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);c!==w?a=b=ka(b,c):(y=a,a=w)}else y=a,a=w;return a}function q(){var a,b,c,d,f;a=y;b=L();b===w&&(b=y,33===g.charCodeAt(y)?(c=na,y++):(c=w,0===Y&&e(qa)),c!==w?(d=y,Y++,61===g.charCodeAt(y)?(f=sa,y++):(f=w,0===Y&&e(ta)),Y--,f===w?d=void 0:(y=d,d=w),d!==w?b=c=[c,d]:(y=b,b=w)):(y=b,b=w));b!==w?(c=X(),c!==w?(d=q(),d!==w?a=b={type:"unary_expr",operator:"NOT",expr:d}:(y=a,a=w)):(y=a,a=w)):(y=a,a=w);
if(a===w)if(a=y,b=t(),b!==w)if(c=X(),c!==w){var h,k,l;c=[];d=y;f=X();f!==w?(h=p(),h!==w?(k=X(),k!==w?(l=t(),l!==w?d=f=[f,h,k,l]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);if(d!==w)for(;d!==w;)c.push(d),d=y,f=X(),f!==w?(h=p(),h!==w?(k=X(),k!==w?(l=t(),l!==w?d=f=[f,h,k,l]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);else c=w;c!==w&&(c={type:"arithmetic",tail:c});c===w&&(c=y,d=u(),d!==w?(f=X(),f!==w?(f=fa(),f!==w?(f=X(),f!==w?(f=m(),f!==w?(h=X(),h!==w?(h=ia(),h!==w?c=d={op:d,right:f}:(y=c,c=w)):(y=c,c=
w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w),c===w&&(c=y,d=u(),d!==w?(f=X(),f!==w?(f=fa(),f!==w?(f=X(),f!==w?(f=ia(),f!==w?c=d={op:d,right:{type:"expr_list",value:[]}}:(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w),c===w&&(c=y,d=u(),d!==w?(f=X(),f!==w?(f=E(),f!==w?c=d={op:d,right:f}:(y=c,c=w)):(y=c,c=w)):(y=c,c=w))),c===w&&(c=y,f=L(),f!==w?(d=X(),d!==w?(d=ea(),d!==w?(h=X(),h!==w?(h=t(),h!==w?(k=X(),k!==w?(k=S(),k!==w?(f=X(),f!==w?(f=t(),f!==w?c=f={op:"NOT"+d,right:{type:"expr_list",
value:[h,f]}}:(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w),c===w&&(c=y,f=ea(),f!==w?(d=X(),d!==w?(d=t(),d!==w?(h=X(),h!==w?(h=S(),h!==w?(k=X(),k!==w?(k=t(),k!==w?c=f={op:f,right:{type:"expr_list",value:[d,k]}}:(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)),c===w&&(c=y,d=R(),d!==w?(f=X(),f!==w?(f=L(),f!==w?(f=X(),f!==w?(f=t(),f!==w?c=d={op:d+"NOT",right:f}:(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w),c===w&&
(c=y,d=R(),d!==w?(f=X(),f!==w?(f=t(),f!==w?c=d={op:d,right:f}:(y=c,c=w)):(y=c,c=w)):(y=c,c=w)),c===w&&(c=y,d=r(),d!==w?(f=X(),f!==w?(f=I(),f!==w?(h=X(),h!==w?(h=y,g.substr(y,6).toLowerCase()===xd?(k=g.substr(y,6),y+=6):(k=w,0===Y&&e(yd)),k!==w?(k=y,Y++,l=C(),Y--,l===w?k=void 0:(y=k,k=w),k!==w?h="ESCAPE":(y=h,h=w)):(y=h,h=w),h!==w?(h=X(),h!==w?(h=K(),h!==w?c=d={op:d,right:f,escape:h.value}:(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w)):(y=c,c=w),c===w&&(c=y,d=r(),d!==w?(f=X(),f!==
w?(f=I(),f!==w?c=d={op:d,right:f,escape:""}:(y=c,c=w)):(y=c,c=w)):(y=c,c=w))))));c===w&&(c=null);c!==w?(a=b,b=c,""==b||void 0==b||null==b?b=a:(c=null,b=c="arithmetic"==b.type?ka(a,b.tail):oa(b.op,a,b.right,b.escape)),a=b):(y=a,a=w)}else y=a,a=w;else y=a,a=w;return a}function p(){var a;g.substr(y,2)===Ja?(a=Ja,y+=2):(a=w,0===Y&&e(xa));a===w&&(62===g.charCodeAt(y)?(a=wa,y++):(a=w,0===Y&&e(Ca)),a===w&&(g.substr(y,2)===Pa?(a=Pa,y+=2):(a=w,0===Y&&e(La)),a===w&&(g.substr(y,2)===Qa?(a=Qa,y+=2):(a=w,0===
Y&&e(ob)),a===w&&(60===g.charCodeAt(y)?(a=Ra,y++):(a=w,0===Y&&e(Ob)),a===w&&(61===g.charCodeAt(y)?(a=sa,y++):(a=w,0===Y&&e(ta)),a===w&&(g.substr(y,2)===pb?(a=pb,y+=2):(a=w,0===Y&&e(eb))))))));return a}function r(){var a,b,c,d;a=a=y;b=L();b!==w?(c=X(),c!==w?(d=Q(),d!==w?a=b=[b,c,d]:(y=a,a=w)):(y=a,a=w)):(y=a,a=w);a!==w&&(a=a[0]+" "+a[2]);a===w&&(a=Q());return a}function u(){var a,b,c,d;a=a=y;b=L();b!==w?(c=X(),c!==w?(d=P(),d!==w?a=b=[b,c,d]:(y=a,a=w)):(y=a,a=w)):(y=a,a=w);a!==w&&(a=a[0]+" "+a[2]);
a===w&&(a=P());return a}function t(){var a,b,c,d,e,f,g,h;a=y;b=A();if(b!==w){c=[];d=y;e=X();e!==w?(f=v(),f!==w?(g=X(),g!==w?(h=A(),h!==w?d=e=[e,f,g,h]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);for(;d!==w;)c.push(d),d=y,e=X(),e!==w?(f=v(),f!==w?(g=X(),g!==w?(h=A(),h!==w?d=e=[e,f,g,h]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);c!==w?a=b=ka(b,c):(y=a,a=w)}else y=a,a=w;return a}function v(){var a;43===g.charCodeAt(y)?(a=qb,y++):(a=w,0===Y&&e(nb));a===w&&(45===g.charCodeAt(y)?(a=rb,y++):(a=w,0===Y&&e(sb)));
return a}function A(){var a,b,c,d,e,f,g,h;a=y;b=x();if(b!==w){c=[];d=y;e=X();e!==w?(f=z(),f!==w?(g=X(),g!==w?(h=x(),h!==w?d=e=[e,f,g,h]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);for(;d!==w;)c.push(d),d=y,e=X(),e!==w?(f=z(),f!==w?(g=X(),g!==w?(h=x(),h!==w?d=e=[e,f,g,h]:(y=d,d=w)):(y=d,d=w)):(y=d,d=w)):(y=d,d=w);c!==w?a=b=ka(b,c):(y=a,a=w)}else y=a,a=w;return a}function z(){var a;42===g.charCodeAt(y)?(a=dd,y++):(a=w,0===Y&&e(ed));a===w&&(47===g.charCodeAt(y)?(a=fd,y++):(a=w,0===Y&&e(gd)));return a}
function x(){var a,b,c,d,f,h,l;l=K();if(l===w){var p,q,n,r;p=y;var t,u,v,x;t=y;u=T();u!==w?(v=V(),v!==w?(x=U(),x!==w?t=u=parseFloat(u+v+x):(y=t,t=w)):(y=t,t=w)):(y=t,t=w);t===w&&(t=y,u=T(),u!==w?(v=V(),v!==w?t=u=parseFloat(u+v):(y=t,t=w)):(y=t,t=w),t===w&&(t=y,u=T(),u!==w?(v=U(),v!==w?t=u=parseFloat(u+v):(y=t,t=w)):(y=t,t=w),t===w&&(t=y,u=T(),u!==w&&(u=parseFloat(u)),t=u)));q=t;q!==w?(n=y,Y++,r=D(),Y--,r===w?n=void 0:(y=n,n=w),n!==w?p=q={type:"number",value:q}:(y=p,p=w)):(y=p,p=w);l=p;if(l===w){var A,
z;A=y;var L,wa,S,Q;L=y;g.substr(y,4).toLowerCase()===zd?(wa=g.substr(y,4),y+=4):(wa=w,0===Y&&e(Ad));wa!==w?(S=y,Y++,Q=C(),Y--,Q===w?S=void 0:(y=S,S=w),S!==w?L=wa=[wa,S]:(y=L,L=w)):(y=L,L=w);z=L;z!==w&&(z={type:"bool",value:!0});A=z;if(A===w){A=y;var J,Ca,O,R;J=y;g.substr(y,5).toLowerCase()===Bd?(Ca=g.substr(y,5),y+=5):(Ca=w,0===Y&&e(Cd));Ca!==w?(O=y,Y++,R=C(),Y--,R===w?O=void 0:(y=O,O=w),O!==w?J=Ca=[Ca,O]:(y=J,J=w)):(y=J,J=w);z=J;z!==w&&(z={type:"bool",value:!1});A=z}l=A;if(l===w){var ea,aa,xa,ba,
Pa;aa=y;g.substr(y,4).toLowerCase()===Dd?(xa=g.substr(y,4),y+=4):(xa=w,0===Y&&e(Ed));xa!==w?(ba=y,Y++,Pa=C(),Y--,Pa===w?ba=void 0:(y=ba,ba=w),ba!==w?aa=xa=[xa,ba]:(y=aa,aa=w)):(y=aa,aa=w);ea=aa;ea!==w&&(ea={type:"null",value:null});l=ea;if(l===w){var ca,ha,La,ka;ca=y;var ma,oa,qa,Qa;ma=y;g.substr(y,4).toLowerCase()===Fd?(oa=g.substr(y,4),y+=4):(oa=w,0===Y&&e(Gd));oa!==w?(qa=y,Y++,Qa=C(),Y--,Qa===w?qa=void 0:(y=qa,qa=w),qa!==w?ma=oa="DATE":(y=ma,ma=w)):(y=ma,ma=w);ha=ma;ha!==w?(La=X(),La!==w?(ka=I(),
ka!==w?ca=ha={type:"date",value:ka.value}:(y=ca,ca=w)):(y=ca,ca=w)):(y=ca,ca=w);l=ca;if(l===w){var na,ob,sa,ta;na=y;var ya,Aa,Ra,Ob;ya=y;g.substr(y,9).toLowerCase()===Hd?(Aa=g.substr(y,9),y+=9):(Aa=w,0===Y&&e(Id));Aa!==w?(Ra=y,Y++,Ob=C(),Y--,Ob===w?Ra=void 0:(y=Ra,Ra=w),Ra!==w?ya=Aa="TIMESTAMP":(y=ya,ya=w)):(y=ya,ya=w);ob=ya;ob!==w?(sa=X(),sa!==w?(ta=I(),ta!==w?na=ob={type:"timestamp",value:ta.value}:(y=na,na=w)):(y=na,na=w)):(y=na,na=w);l=na}}}}}a=l;if(a===w){var ua,Ja,Da,Sa,Ta,Oa,eb,fb,nb,nc,pb,
qb;ua=y;var Ua,Pb,zb,rb;Ua=y;g.substr(y,7).toLowerCase()===Jd?(Pb=g.substr(y,7),y+=7):(Pb=w,0===Y&&e(Kd));Pb!==w?(zb=y,Y++,rb=C(),Y--,rb===w?zb=void 0:(y=zb,zb=w),zb!==w?Ua=Pb="EXTRACT":(y=Ua,Ua=w)):(y=Ua,Ua=w);Ja=Ua;if(Ja!==w)if(Da=X(),Da!==w)if(Sa=fa(),Sa!==w)if(Ta=X(),Ta!==w){var Ea,Va,Qb,Ab,sb;Va=y;g.substr(y,4).toLowerCase()===Ld?(Qb=g.substr(y,4),y+=4):(Qb=w,0===Y&&e(Md));Qb!==w?(Ab=y,Y++,sb=C(),Y--,sb===w?Ab=void 0:(y=Ab,Ab=w),Ab!==w?Va=Qb="YEAR":(y=Va,Va=w)):(y=Va,Va=w);Ea=Va;if(Ea===w){var Wa,
Rb,Bb,tb;Wa=y;g.substr(y,5).toLowerCase()===Nd?(Rb=g.substr(y,5),y+=5):(Rb=w,0===Y&&e(Od));Rb!==w?(Bb=y,Y++,tb=C(),Y--,tb===w?Bb=void 0:(y=Bb,Bb=w),Bb!==w?Wa=Rb="MONTH":(y=Wa,Wa=w)):(y=Wa,Wa=w);Ea=Wa;if(Ea===w){var Xa,Sb,Cb,ub;Xa=y;g.substr(y,3).toLowerCase()===Pd?(Sb=g.substr(y,3),y+=3):(Sb=w,0===Y&&e(Qd));Sb!==w?(Cb=y,Y++,ub=C(),Y--,ub===w?Cb=void 0:(y=Cb,Cb=w),Cb!==w?Xa=Sb="DAY":(y=Xa,Xa=w)):(y=Xa,Xa=w);Ea=Xa;if(Ea===w){var Ya,Tb,Db,vb;Ya=y;g.substr(y,4).toLowerCase()===Rd?(Tb=g.substr(y,4),y+=
4):(Tb=w,0===Y&&e(Sd));Tb!==w?(Db=y,Y++,vb=C(),Y--,vb===w?Db=void 0:(y=Db,Db=w),Db!==w?Ya=Tb="HOUR":(y=Ya,Ya=w)):(y=Ya,Ya=w);Ea=Ya;if(Ea===w){var Za,Ub,Eb,wb;Za=y;g.substr(y,6).toLowerCase()===Td?(Ub=g.substr(y,6),y+=6):(Ub=w,0===Y&&e(Ud));Ub!==w?(Eb=y,Y++,wb=C(),Y--,wb===w?Eb=void 0:(y=Eb,Eb=w),Eb!==w?Za=Ub="MINUTE":(y=Za,Za=w)):(y=Za,Za=w);Ea=Za;if(Ea===w){var $a,Vb,Fb,xb;$a=y;g.substr(y,6).toLowerCase()===Vd?(Vb=g.substr(y,6),y+=6):(Vb=w,0===Y&&e(Wd));Vb!==w?(Fb=y,Y++,xb=C(),Y--,xb===w?Fb=void 0:
(y=Fb,Fb=w),Fb!==w?$a=Vb="SECOND":(y=$a,$a=w)):(y=$a,$a=w);Ea=$a}}}}}Oa=Ea;Oa!==w?(eb=X(),eb!==w?(fb=Z(),fb!==w?(nb=X(),nb!==w?(nc=k(),nc!==w?(pb=X(),pb!==w?(qb=ia(),qb!==w?ua=Ja={type:"function",name:"extract",args:{type:"expr_list",value:[{type:"string",value:Oa},nc]}}:(y=ua,ua=w)):(y=ua,ua=w)):(y=ua,ua=w)):(y=ua,ua=w)):(y=ua,ua=w)):(y=ua,ua=w)):(y=ua,ua=w)}else y=ua,ua=w;else y=ua,ua=w;else y=ua,ua=w;else y=ua,ua=w;a=ua;if(a===w){var ra,oc,yb,xc,yc,Wb,zc,Ac,Bc,Xb,Cc,Ba,gb,pc,qc,rc;ra=y;var ab,
Yb,Gb,Dc;ab=y;g.substr(y,9).toLowerCase()===Xd?(Yb=g.substr(y,9),y+=9):(Yb=w,0===Y&&e(Yd));Yb!==w?(Gb=y,Y++,Dc=C(),Y--,Dc===w?Gb=void 0:(y=Gb,Gb=w),Gb!==w?ab=Yb="SUBSTRING":(y=ab,ab=w)):(y=ab,ab=w);oc=ab;if(oc!==w)if(yb=X(),yb!==w)if(xc=fa(),xc!==w)if(yc=X(),yc!==w)if(Wb=k(),Wb!==w)if(zc=X(),zc!==w)if(Ac=Z(),Ac!==w)if(Bc=X(),Bc!==w)if(Xb=k(),Xb!==w)if(Cc=X(),Cc!==w){Ba=y;var bb,Zb,Hb,Ec;bb=y;g.substr(y,3).toLowerCase()===Zd?(Zb=g.substr(y,3),y+=3):(Zb=w,0===Y&&e($d));Zb!==w?(Hb=y,Y++,Ec=C(),Y--,Ec===
w?Hb=void 0:(y=Hb,Hb=w),Hb!==w?bb=Zb="FOR":(y=bb,bb=w)):(y=bb,bb=w);gb=bb;gb!==w?(pc=X(),pc!==w?(qc=k(),qc!==w?(rc=X(),rc!==w?Ba=gb=[gb,pc,qc,rc]:(y=Ba,Ba=w)):(y=Ba,Ba=w)):(y=Ba,Ba=w)):(y=Ba,Ba=w);Ba===w&&(Ba=null);Ba!==w?(gb=ia(),gb!==w?ra=oc={type:"function",name:"substring",args:{type:"expr_list",value:Ba?[Wb,Xb,Ba[2]]:[Wb,Xb]}}:(y=ra,ra=w)):(y=ra,ra=w)}else y=ra,ra=w;else y=ra,ra=w;else y=ra,ra=w;else y=ra,ra=w;else y=ra,ra=w;else y=ra,ra=w;else y=ra,ra=w;else y=ra,ra=w;else y=ra,ra=w;else y=
ra,ra=w;a=ra;if(a===w){var ga,hb,$b,ac,bc,Fa,cc,ib,dc,ec,Fc,sc,Gc,Hc;ga=y;hb=da();hb!==w?($b=X(),$b!==w?(ac=fa(),ac!==w?(bc=X(),bc!==w?(Fa=F(),Fa===w&&(Fa=null),Fa!==w?(cc=X(),cc!==w?(ib=k(),ib!==w?(dc=X(),dc!==w?(ec=Z(),ec!==w?(Fc=X(),Fc!==w?(sc=k(),sc!==w?(Gc=X(),Gc!==w?(Hc=ia(),Hc!==w?ga=hb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Fa?"BOTH":Fa},ib,sc]}}:(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,
ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w);ga===w&&(ga=y,hb=da(),hb!==w?($b=X(),$b!==w?(ac=fa(),ac!==w?(bc=X(),bc!==w?(Fa=F(),Fa===w&&(Fa=null),Fa!==w?(cc=X(),cc!==w?(ib=k(),ib!==w?(dc=X(),dc!==w?(ec=ia(),ec!==w?ga=hb={type:"function",name:"trim",args:{type:"expr_list",value:[{type:"string",value:null==Fa?"BOTH":Fa},ib]}}:(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w)):(y=ga,ga=w));a=ga;if(a===w){var va,tc,Ic,Jc,Kc,
uc,Lc,Mc,Nc,vc,Oc,Pc;va=y;var cb,fc,Ib,Qc;cb=y;g.substr(y,8).toLowerCase()===ae?(fc=g.substr(y,8),y+=8):(fc=w,0===Y&&e(be));fc!==w?(Ib=y,Y++,Qc=C(),Y--,Qc===w?Ib=void 0:(y=Ib,Ib=w),Ib!==w?cb=fc="POSITION":(y=cb,cb=w)):(y=cb,cb=w);tc=cb;tc!==w?(Ic=X(),Ic!==w?(Jc=fa(),Jc!==w?(Kc=X(),Kc!==w?(uc=k(),uc!==w?(Lc=X(),Lc!==w?(Mc=P(),Mc!==w?(Nc=X(),Nc!==w?(vc=k(),vc!==w?(Oc=X(),Oc!==w?(Pc=ia(),Pc!==w?va=tc={type:"function",name:"position",args:{type:"expr_list",value:[uc,vc]}}:(y=va,va=w)):(y=va,va=w)):(y=
va,va=w)):(y=va,va=w)):(y=va,va=w)):(y=va,va=w)):(y=va,va=w)):(y=va,va=w)):(y=va,va=w)):(y=va,va=w)):(y=va,va=w);a=va;if(a===w){var za,gc,Rc,Sc,Tc,jb,Uc,Vc;za=y;var Ga,Jb,Kb,Ka;Ga=y;Ga=Jb=B();if(Ga===w)if(Ga=y,96===g.charCodeAt(y)?(Jb=Wc,y++):(Jb=w,0===Y&&e(Xc)),Jb!==w){Kb=[];Yc.test(g.charAt(y))?(Ka=g.charAt(y),y++):(Ka=w,0===Y&&e(Zc));if(Ka!==w)for(;Ka!==w;)Kb.push(Ka),Yc.test(g.charAt(y))?(Ka=g.charAt(y),y++):(Ka=w,0===Y&&e(Zc));else Kb=w;Kb!==w?(96===g.charCodeAt(y)?(Ka=Wc,y++):(Ka=w,0===Y&&e(Xc)),
Ka!==w?Ga=Jb=Kb.join(""):(y=Ga,Ga=w)):(y=Ga,Ga=w)}else y=Ga,Ga=w;gc=Ga;gc!==w?(Rc=X(),Rc!==w?(Sc=fa(),Sc!==w?(Tc=X(),Tc!==w?(jb=m(),jb===w&&(jb=null),jb!==w?(Uc=X(),Uc!==w?(Vc=ia(),Vc!==w?za=gc={type:"function",name:gc,args:jb?jb:{type:"expr_list",value:[]}}:(y=za,za=w)):(y=za,za=w)):(y=za,za=w)):(y=za,za=w)):(y=za,za=w)):(y=za,za=w)):(y=za,za=w);a=za;if(a===w){var hc,la,kb,ic,lb,jc,Ma,Ha,Lb,$c,ad;la=y;kb=W();if(kb!==w)if(ic=X(),ic!==w)if(lb=k(),lb!==w)if(jc=X(),jc!==w){Ma=[];for(Ha=H();Ha!==w;)Ma.push(Ha),
Ha=H();Ma!==w?(Ha=X(),Ha!==w?(Lb=ja(),Lb!==w?la=kb={type:"case_expression",format:"simple",operand:lb,clauses:Ma,else:null}:(y=la,la=w)):(y=la,la=w)):(y=la,la=w)}else y=la,la=w;else y=la,la=w;else y=la,la=w;else y=la,la=w;if(la===w)if(la=y,kb=W(),kb!==w)if(ic=X(),ic!==w)if(lb=k(),lb!==w)if(jc=X(),jc!==w){Ma=[];for(Ha=H();Ha!==w;)Ma.push(Ha),Ha=H();Ma!==w?(Ha=X(),Ha!==w?(Lb=M(),Lb!==w?($c=X(),$c!==w?(ad=ja(),ad!==w?la=kb={type:"case_expression",format:"simple",operand:lb,clauses:Ma,else:Lb.value}:
(y=la,la=w)):(y=la,la=w)):(y=la,la=w)):(y=la,la=w)):(y=la,la=w)}else y=la,la=w;else y=la,la=w;else y=la,la=w;else y=la,la=w;hc=la;if(hc===w){var pa,mb,kc,Na,Ia,Mb,bd,cd;pa=y;mb=W();if(mb!==w)if(kc=X(),kc!==w){Na=[];for(Ia=N();Ia!==w;)Na.push(Ia),Ia=N();Na!==w?(Ia=X(),Ia!==w?(Mb=ja(),Mb!==w?pa=mb={type:"case_expression",format:"searched",clauses:Na,else:null}:(y=pa,pa=w)):(y=pa,pa=w)):(y=pa,pa=w)}else y=pa,pa=w;else y=pa,pa=w;if(pa===w)if(pa=y,mb=W(),mb!==w)if(kc=X(),kc!==w){Na=[];for(Ia=N();Ia!==
w;)Na.push(Ia),Ia=N();Na!==w?(Ia=X(),Ia!==w?(Mb=M(),Mb!==w?(bd=X(),bd!==w?(cd=ja(),cd!==w?pa=mb={type:"case_expression",format:"searched",clauses:Na,else:Mb.value}:(y=pa,pa=w)):(y=pa,pa=w)):(y=pa,pa=w)):(y=pa,pa=w)):(y=pa,pa=w)}else y=pa,pa=w;else y=pa,pa=w;hc=pa}a=hc;if(a===w){var Nb,db,wc,lc,mc;db=y;wc=D();if(wc!==w){lc=[];for(mc=G();mc!==w;)lc.push(mc),mc=G();lc!==w?db=wc+=lc.join(""):(y=db,db=w)}else y=db,db=w;Nb=db;Nb!==w&&(Nb={type:"column_ref",table:"",column:Nb});a=Nb;a===w&&(a=E(),a===w&&
(a=y,b=fa(),b!==w?(c=X(),c!==w?(d=k(),d!==w?(f=X(),f!==w?(h=ia(),h!==w?(d.paren=!0,a=b=d):(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w)))}}}}}}}return a}function B(){var a,b,c,d;a=y;b=D();if(b!==w){c=[];for(d=C();d!==w;)c.push(d),d=C();c!==w?a=b+=c.join(""):(y=a,a=w)}else y=a,a=w;return a}function D(){var a;hd.test(g.charAt(y))?(a=g.charAt(y),y++):(a=w,0===Y&&e(id));return a}function C(){var a;jd.test(g.charAt(y))?(a=g.charAt(y),y++):(a=w,0===Y&&e(kd));return a}function G(){var a;ld.test(g.charAt(y))?
(a=g.charAt(y),y++):(a=w,0===Y&&e(md));return a}function E(){var a,b,c;a=y;64===g.charCodeAt(y)?(b=nd,y++):(b=w,0===Y&&e(od));b!==w?(c=B(),c!==w?a=b=[b,c]:(y=a,a=w)):(y=a,a=w);a!==w&&(a={type:"param",value:a[1]});return a}function F(){var a,b,c;a=y;g.substr(y,7).toLowerCase()===ce?(b=g.substr(y,7),y+=7):(b=w,0===Y&&e(de));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="LEADING":(y=a,a=w)):(y=a,a=w);a===w&&(a=y,g.substr(y,8).toLowerCase()===ee?(b=g.substr(y,8),y+=8):(b=w,0===Y&&e(fe)),b!==
w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="TRAILING":(y=a,a=w)):(y=a,a=w),a===w&&(a=y,g.substr(y,4).toLowerCase()===ge?(b=g.substr(y,4),y+=4):(b=w,0===Y&&e(he)),b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="BOTH":(y=a,a=w)):(y=a,a=w)));return a}function I(){var a;a=K();a===w&&(a=E());return a}function K(){var a,b,c;a=y;39===g.charCodeAt(y)?(b=tb,y++):(b=w,0===Y&&e(ub));b===w&&(g.substr(y,2)===vb?(b=vb,y+=2):(b=w,0===Y&&e(pd)));if(b!==w){b=[];c=y;g.substr(y,2)===Sa?(c=Sa,y+=
2):(c=w,0===Y&&e(wb));c!==w&&(c="'");c===w&&(xb.test(g.charAt(y))?(c=g.charAt(y),y++):(c=w,0===Y&&e(yb)));for(;c!==w;)b.push(c),c=y,g.substr(y,2)===Sa?(c=Sa,y+=2):(c=w,0===Y&&e(wb)),c!==w&&(c="'"),c===w&&(xb.test(g.charAt(y))?(c=g.charAt(y),y++):(c=w,0===Y&&e(yb)));b!==w?(39===g.charCodeAt(y)?(c=tb,y++):(c=w,0===Y&&e(ub)),c!==w?a=b={type:"string",value:b.join("")}:(y=a,a=w)):(y=a,a=w)}else y=a,a=w;return a}function N(){var a,b,c;a=y;b=ca();b!==w?(b=X(),b!==w?(b=k(),b!==w?(c=X(),c!==w?(c=ba(),c!==
w?(c=X(),c!==w?(c=k(),c!==w?a=b={type:"when_clause",operand:b,value:c}:(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w);return a}function H(){var a,b,c;a=y;b=ca();b!==w?(b=X(),b!==w?(b=k(),b!==w?(c=X(),c!==w?(c=ba(),c!==w?(c=X(),c!==w?(c=k(),c!==w?a=b={type:"when_clause",operand:b,value:c}:(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w)):(y=a,a=w);return a}function M(){var a,b;a=y;var c,d;b=y;g.substr(y,4).toLowerCase()===ie?(c=g.substr(y,4),y+=4):(c=w,
0===Y&&e(je));c!==w?(c=y,Y++,d=C(),Y--,d===w?c=void 0:(y=c,c=w),c!==w?b="ELSE":(y=b,b=w)):(y=b,b=w);b!==w?(b=X(),b!==w?(b=k(),b!==w?a={type:"else_clause",value:b}:(y=a,a=w)):(y=a,a=w)):(y=a,a=w);return a}function T(){var a,b,c;a=J();a===w&&(a=y,45===g.charCodeAt(y)?(b=rb,y++):(b=w,0===Y&&e(sb)),b===w&&(43===g.charCodeAt(y)?(b=qb,y++):(b=w,0===Y&&e(nb))),b!==w?(c=J(),c!==w?a=b=b[0]+c:(y=a,a=w)):(y=a,a=w));return a}function V(){var a,b;a=y;46===g.charCodeAt(y)?(b=qd,y++):(b=w,0===Y&&e(rd));b!==w?(b=
J(),b===w&&(b=null),b!==w?a="."+(null!=b?b:""):(y=a,a=w)):(y=a,a=w);return a}function U(){var a,b,c;b=a=y;ud.test(g.charAt(y))?(c=g.charAt(y),y++):(c=w,0===Y&&e(vd));c!==w?(wd.test(g.charAt(y))?(c=g.charAt(y),y++):(c=w,0===Y&&e(ke)),c===w&&(c=null),c!==w?b="e"+(null===c?"":c):(y=b,b=w)):(y=b,b=w);b!==w?(c=J(),c!==w?a=b+c:(y=a,a=w)):(y=a,a=w);return a}function J(){var a,b;a=[];b=O();if(b!==w)for(;b!==w;)a.push(b),b=O();else a=w;a!==w&&(a=a.join(""));return a}function O(){var a;sd.test(g.charAt(y))?
(a=g.charAt(y),y++):(a=w,0===Y&&e(td));return a}function P(){var a,b,c;a=y;g.substr(y,2).toLowerCase()===le?(b=g.substr(y,2),y+=2):(b=w,0===Y&&e(me));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="IN":(y=a,a=w)):(y=a,a=w);return a}function R(){var a,b,c;a=y;g.substr(y,2).toLowerCase()===ne?(b=g.substr(y,2),y+=2):(b=w,0===Y&&e(oe));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="IS":(y=a,a=w)):(y=a,a=w);return a}function Q(){var a,b,c;a=y;g.substr(y,4).toLowerCase()===pe?(b=
g.substr(y,4),y+=4):(b=w,0===Y&&e(qe));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="LIKE":(y=a,a=w)):(y=a,a=w);return a}function L(){var a,b,c;a=y;g.substr(y,3).toLowerCase()===re?(b=g.substr(y,3),y+=3):(b=w,0===Y&&e(se));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="NOT":(y=a,a=w)):(y=a,a=w);return a}function S(){var a,b,c;a=y;g.substr(y,3).toLowerCase()===te?(b=g.substr(y,3),y+=3):(b=w,0===Y&&e(ue));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="AND":(y=a,
a=w)):(y=a,a=w);return a}function aa(){var a,b,c;a=y;g.substr(y,2).toLowerCase()===ve?(b=g.substr(y,2),y+=2):(b=w,0===Y&&e(we));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="OR":(y=a,a=w)):(y=a,a=w);return a}function ea(){var a,b,c;a=y;g.substr(y,7).toLowerCase()===xe?(b=g.substr(y,7),y+=7):(b=w,0===Y&&e(ye));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="BETWEEN":(y=a,a=w)):(y=a,a=w);return a}function Z(){var a,b,c;a=y;g.substr(y,4).toLowerCase()===ze?(b=g.substr(y,4),y+=
4):(b=w,0===Y&&e(Ae));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="FROM":(y=a,a=w)):(y=a,a=w);return a}function da(){var a,b,c;a=y;g.substr(y,4).toLowerCase()===Be?(b=g.substr(y,4),y+=4):(b=w,0===Y&&e(Ce));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="TRIM":(y=a,a=w)):(y=a,a=w);return a}function W(){var a,b,c;a=y;g.substr(y,4).toLowerCase()===De?(b=g.substr(y,4),y+=4):(b=w,0===Y&&e(Ee));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="CASE":(y=a,a=w)):(y=a,a=w);
return a}function ja(){var a,b,c;a=y;g.substr(y,3).toLowerCase()===Fe?(b=g.substr(y,3),y+=3):(b=w,0===Y&&e(Ge));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="END":(y=a,a=w)):(y=a,a=w);return a}function ca(){var a,b,c;a=y;g.substr(y,4).toLowerCase()===He?(b=g.substr(y,4),y+=4):(b=w,0===Y&&e(Ie));b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="WHEN":(y=a,a=w)):(y=a,a=w);return a}function ba(){var a,b,c;a=y;g.substr(y,4).toLowerCase()===Je?(b=g.substr(y,4),y+=4):(b=w,0===Y&&e(Ke));
b!==w?(b=y,Y++,c=C(),Y--,c===w?b=void 0:(y=b,b=w),b!==w?a="THEN":(y=a,a=w)):(y=a,a=w);return a}function ha(){var a;44===g.charCodeAt(y)?(a=Le,y++):(a=w,0===Y&&e(Me));return a}function fa(){var a;40===g.charCodeAt(y)?(a=Ne,y++):(a=w,0===Y&&e(Oe));return a}function ia(){var a;41===g.charCodeAt(y)?(a=Pe,y++):(a=w,0===Y&&e(Qe));return a}function X(){var a,b;a=[];for(b=ma();b!==w;)a.push(b),b=ma();return a}function ma(){var a;Re.test(g.charAt(y))?(a=g.charAt(y),y++):(a=w,0===Y&&e(Se));return a}function oa(a,
b,c,d){a={type:"binary_expr",operator:a,left:b,right:c};void 0!==d&&(a.escape=d);return a}function ka(a,b){for(var c=0;c<b.length;c++)a=oa(b[c][1],a,b[c][3]);return a}c=void 0!==c?c:{};var w={},Aa={start:h},ya=h,na="!",qa=a("!",!1),sa="\x3d",ta=a("\x3d",!1),Ja="\x3e\x3d",xa=a("\x3e\x3d",!1),wa="\x3e",Ca=a("\x3e",!1),Pa="\x3c\x3d",La=a("\x3c\x3d",!1),Qa="\x3c\x3e",ob=a("\x3c\x3e",!1),Ra="\x3c",Ob=a("\x3c",!1),pb="!\x3d",eb=a("!\x3d",!1),qb="+",nb=a("+",!1),rb="-",sb=a("-",!1),dd="*",ed=a("*",!1),fd=
"/",gd=a("/",!1),hd=/^[A-Za-z_\x80-\uFFFF]/,id=f([["A","Z"],["a","z"],"_",["\u0080","\uffff"]],!1,!1),jd=/^[A-Za-z0-9_]/,kd=f([["A","Z"],["a","z"],["0","9"],"_"],!1,!1),ld=/^[A-Za-z0-9_.\x80-\uFFFF]/,md=f([["A","Z"],["a","z"],["0","9"],"_",".",["\u0080","\uffff"]],!1,!1),nd="@",od=a("@",!1),tb="'",ub=a("'",!1),vb="N'",pd=a("N'",!1),Sa="''",wb=a("''",!1),xb=/^[^']/,yb=f(["'"],!0,!1),qd=".",rd=a(".",!1),sd=/^[0-9]/,td=f([["0","9"]],!1,!1),ud=/^[eE]/,vd=f(["e","E"],!1,!1),wd=/^[+\-]/,ke=f(["+","-"],
!1,!1),Dd="null",Ed=a("NULL",!0),zd="true",Ad=a("TRUE",!0),Bd="false",Cd=a("FALSE",!0),le="in",me=a("IN",!0),ne="is",oe=a("IS",!0),pe="like",qe=a("LIKE",!0),xd="escape",yd=a("ESCAPE",!0),re="not",se=a("NOT",!0),te="and",ue=a("AND",!0),ve="or",we=a("OR",!0),xe="between",ye=a("BETWEEN",!0),ze="from",Ae=a("FROM",!0),Zd="for",$d=a("FOR",!0),Xd="substring",Yd=a("SUBSTRING",!0),Jd="extract",Kd=a("EXTRACT",!0),Be="trim",Ce=a("TRIM",!0),ae="position",be=a("POSITION",!0),Hd="timestamp",Id=a("TIMESTAMP",!0),
Fd="date",Gd=a("DATE",!0),ce="leading",de=a("LEADING",!0),ee="trailing",fe=a("TRAILING",!0),ge="both",he=a("BOTH",!0),Ld="year",Md=a("YEAR",!0),Nd="month",Od=a("MONTH",!0),Pd="day",Qd=a("DAY",!0),Rd="hour",Sd=a("HOUR",!0),Td="minute",Ud=a("MINUTE",!0),Vd="second",Wd=a("SECOND",!0),De="case",Ee=a("CASE",!0),Fe="end",Ge=a("END",!0),He="when",Ie=a("WHEN",!0),Je="then",Ke=a("THEN",!0),ie="else",je=a("ELSE",!0),Le=",",Me=a(",",!1),Ne="(",Oe=a("(",!1),Pe=")",Qe=a(")",!1),Re=/^[ \t\n\r]/,Se=f([" ","\t",
"\n","\r"],!1,!1),Wc="`",Xc=a("`",!1),Yc=/^[^`]/,Zc=f(["`"],!0,!1),y=0,Ta=[{line:1,column:1}],Da=0,fb=[],Y=0,Oa;if("startRule"in c){if(!(c.startRule in Aa))throw Error("Can't start parsing from rule \""+c.startRule+'".');ya=Aa[c.startRule]}Oa=ya();if(Oa!==w&&y===g.length)return Oa;Oa!==w&&y<g.length&&e({type:"end"});throw function(a,b,c){return new n(n.buildMessage(a,b),a,b,c)}(fb,Da<g.length?g.charAt(Da):null,Da<g.length?l(Da,Da+1):l(Da,Da));}}})},"esri/views/3d/layers/i3s/I3SIndex":function(){define("require exports ../../../../core/tsSupport/assignHelper ../../../../core/PooledArray ../../../../core/urlUtils ./I3SUtil ../../support/orientedBoundingBox".split(" "),
function(n,g,c,a,f,b,l){var e="version level sharedResource attributeData geometryData textureData lodSelection".split(" ");n=function(){function g(b,c,e,g,k,l,m,n,z,x,B,D){var d=this;this.rootId=e;this.progressiveLoadPenalty=g;this.nodeIndex=k;this.streamDataSupplier=l;this.viewportQueries=m;this.logger=n;this._isLoaded=z;this._isSelected=x;this._enable=B;this._needsUpdate=D;this._prefetching=this._loading=this._dirty=!0;this._loadingNodes=new Set;this._indexMissing=1;this._nodesMissing=0;this._maxUnloadedPrio=
Number.NEGATIVE_INFINITY;this._nodeTraversalState={};this._version=0;this._featureEstimate={estimate:0,leafsReached:!1};this._unloadedMemoryEstimate=0;this._missing=new a;this._prefetch=new a;this._updates=new h;this.ignoreServiceOBB=!1;this._maxLodLevel=this.viewportQueries.maxLodLevel;this.rootUrl=f.makeAbsolute(c,b);this.traverseVisible(function(a,b){return d.nodeTraversalState(b)})}g.prototype.requestReload=function(){this._prefetching=this._loading=this._dirty=!0;++this._version};g.prototype.update=
function(a){var b=this;if(this._dirty){this._nodesMissing=this._indexMissing=0;this._maxUnloadedPrio=Number.NEGATIVE_INFINITY;this._missing.clear();this._prefetch.clear();this._updates.reset(a);this._prefetching=this._loading=!1;var d=!0,e=new m,f=new m;this.traverseVisible(function(g,h,k){b._updateFeatureEstimate(h,f);if(h){if(0===b._missing.length&&h.children)for(g=0,k=h.children;g<k.length;g++){var l=k[g];b.nodeIndex[l.id]||(b._prefetching=!0,b._loadingNodes.has(l.id)||b._prefetch.push(c({},l,
{baseUrl:h.baseUrl})))}!h.failed&&h.featureData&&0!==h.featureData.length&&(b._isLoaded(h)?(e.known+=h.memory,++e.knownNodes,b._isSelected(h)?h.children&&(d=!1):(e.unremoved+=h.memory,d=!1),b._needsUpdate(h)&&b._updates.update.push(h)):(h.memory&&(e.known+=h.memory,++e.knownNodes),b._isSelected(h)&&(++b._nodesMissing,h.children&&(d=!1),h.memory?(e.missing+=h.memory,e.known+=h.memory,++e.knownNodes):++e.missingNodes,0<=a.indexOf(h.id)?b._updates.cancel=b._updates.cancel.filter(function(a){return a!==
h.id}):b._enable(h)||b._updates.add.push(h))))}else++b._indexMissing,b._loading=!0,b._prefetching=!1,b._loadingNodes.has(g.id)||b._missing.push(c({},g,{baseUrl:k}))});this._unloadedMemoryEstimate=e.missing-e.unremoved;3<e.knownNodes&&(this._unloadedMemoryEstimate+=e.missingNodes*e.known/e.knownNodes);this._unloadedMemoryEstimate=.8*Math.max(0,this._unloadedMemoryEstimate);this._featureEstimate.estimate=f.known-f.missing;this._featureEstimate.leafsReached=d;if(0<f.knownNodes){var g=f.missing-f.unremoved+
f.known/f.knownNodes*f.missingNodes;0<this._featureEstimate.estimate+g&&(this._featureEstimate.estimate+=g)}this._dirty=0<this._indexMissing||0<this._nodesMissing||0<this._updates.add.length||0<this._updates.update.length||0<this._updates.cancel.length}};g.prototype.checkFeatureTarget=function(a,b){var c=this;b=this.viewportQueries.updateScreenSpaceErrorBias(b);++this._version;var d=new m;this.traverseVisible(function(a,b){return c._updateFeatureEstimate(b,d)});var e=d.known-d.missing;if(0<d.knownNodes){var f=
d.missing-d.unremoved+d.known/d.knownNodes*d.missingNodes;0<e+f&&(e+=f)}this.viewportQueries.updateScreenSpaceErrorBias(b);++this._version;return e<=a};g.prototype._updateFeatureEstimate=function(a,b){a&&!a.failed&&a.featureData&&0!==a.featureData.length&&(this._isLoaded(a)?(b.known+=a.numFeatures,++b.knownNodes,this._isSelected(a)||(b.unremoved+=a.numFeatures)):this._isSelected(a)&&(a.numFeatures?(b.missing+=a.numFeatures,b.known+=a.numFeatures,++b.knownNodes):++b.missingNodes))};g.prototype.load=
function(a){var c=this;b.buildTopNodeMap(this._missing,a,function(a){return c.entryPriority(a)});if(0>=this._missing.length)return this._loading;this._maxUnloadedPrio=this.entryPriority(this._missing.front());this._missing.forEach(function(a){return c._loadNode(a)});this._missing.clear();return this._loading};g.prototype.prefetch=function(a){var c=this;b.buildTopNodeMap(this._prefetch,a,function(a){return c.entryPriority(a)});this._prefetch.forEach(function(a){return c._loadNode(a)});this._prefetch.clear();
return this._prefetching};g.prototype.isLoading=function(){return this._loading};g.prototype.isPrefetching=function(){return this._prefetching};g.prototype.getIndexLoading=function(){return this._loadingNodes.size};g.prototype.getIndexMissing=function(){return this._indexMissing};g.prototype.getUnloadedMemoryEstimate=function(){return this._unloadedMemoryEstimate};g.prototype.getNodesMissing=function(){return this._nodesMissing};g.prototype.getUpdates=function(a){var c=this;b.buildTopNodeMap(this._updates.add,
a,function(a){return c.entryPriority(a)},this._maxUnloadedPrio);b.buildTopNodeMap(this._updates.update,Number.POSITIVE_INFINITY,function(a){return c.entryPriority(a)});return this._updates};g.prototype.getFeatureEstimate=function(){return this._featureEstimate};g.prototype.nodeTraversalState=function(a){if(!a)return null;var b=this._nodeTraversalState[a.id];if(b&&b.version===this._version)return b;var c=this.viewportQueries.getLodLevel(a),d=this.viewportQueries.hasLOD(a),e=!0;if(d)if(a.parentNode){e=
this.nodeIndex[a.parentNode.id];if(null==e)return null;e=(e=this._nodeTraversalState[e.id])&&c>e.lodLevel}else e=0<c;if(b)return b.lodLevel=c,b.isChosen=e,b.version=this._version,b;this._nodeTraversalState[a.id]={nodeHasLOD:d,lodLevel:c,isChosen:e,version:this._version};return this._nodeTraversalState[a.id]};g.prototype._loadNode=function(a){var b=this;this._loadingNodes.add(a.id);var c=f.makeAbsolute(a.href,a.baseUrl);this.streamDataSupplier.request(c,"json").then(function(a,c){var d={id:c.id,mbs:c.mbs,
parentNode:c.parentNode,children:c.children,featureData:c.featureData};e.forEach(function(a){d[a]=c.hasOwnProperty(a)?c[a]:null});c.hasOwnProperty("obb")&&!b.ignoreServiceOBB&&(d.obb=l.clone(c.obb),d.hasServiceOBB=!0,b.viewportQueries.updateNode(d.id));b.nodeIndex[d.id]=d;d.baseUrl=a;d.featureData&&1===d.featureData.length&&d.featureData[0].featureRange&&(d.numFeatures=d.featureData[0].featureRange[1]-d.featureData[0].featureRange[0]+1);b.nodeTraversalState(d);b._loadingNodes.delete(d.id);b._dirty=
!0},function(d){b.loadErrorCallback(c);b._loadingNodes.delete(a.id);b._dirty=!0})};g.prototype.entryPriority=function(a){if(a.id===this.rootId)return 0;var b=0,c=this.nodeIndex[a.id];if(null!=c&&null!=c.parentNode){var d=this._nodeTraversalState[c.parentNode.id];null!=d&&(b=d.lodLevel)}for(d=this.progressiveLoadPenalty;c;c=c.parentNode?this.nodeIndex[c.parentNode.id]:null)if(this._isLoaded(c)){d=0;break}a=this.viewportQueries.distToPOI(a);return-a-b*(a+this.progressiveLoadPenalty)+d};g.prototype.traverseVisible=
function(a){var b=this.nodeIndex[this.rootId];b?this._traverse({id:this.rootId,mbs:b.mbs,href:this.rootUrl},b,a,""):a({id:this.rootId,mbs:null,href:this.rootUrl},null,"")};g.prototype._traverse=function(a,b,c,e){if(!b.children||0===b.children.length)this.viewportQueries.isGeometryVisible(b)&&c(a,b,e);else if(this.viewportQueries.isNodeVisible(b)&&(c(a,b,e),a=this.nodeTraversalState(b),!a.nodeHasLOD||a.lodLevel!==this._maxLodLevel))for(a=0,e=b.children;a<e.length;a++){var d=e[a],f=this.nodeIndex[d.id];
f?this._traverse(d,f,c,b.baseUrl):this.viewportQueries.isNodeVisible(d)&&c(d,null,b.baseUrl)}};g.prototype.loadErrorCallback=function(a){this.logger.warn("Error loading node: "+a)};g.prototype.updateStats=function(a){this._nodesMissing&&(a.nodes+=" + "+Math.round(this._nodesMissing));this._indexMissing&&(a.index+=" + "+this._indexMissing);if(this._featureEstimate.estimate){var b=this._featureEstimate.estimate-a.features;0<b?a.features+=" + "+b:0>b&&(a.features+=" - "+-b)}};return g}();var h=function(){function b(){this.update=
new a;this.add=new a;this.cancel=[]}b.prototype.reset=function(a){this.add.clear();this.update.clear();this.cancel=a};return b}(),m=function(){return function(){this.unremoved=this.missingNodes=this.missing=this.knownNodes=this.known=0}}();return n})},"esri/views/3d/layers/i3s/I3SLodHandling":function(){define(["require","exports","../../../../core/PooledArray"],function(n,g,c){n=function(){function c(a,c){this.layerView=a;this.lodGlobalDirtyChanged=c}c.prototype.startNodeLoading=function(a,c,e,f,
g,k){this._lodGlobalDirty=!1;this._maxLodLevel=k.maxLodLevel;this._nodeIndex=f;this._rootId=g;this._nodeTraversalState=e;this._isNodeVisible=a;this._isGeometryVisible=c;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};c.prototype.shouldLoadNode=function(a){var b=this._nodeTraversalState(a);return b.isChosen?b.lodLevel===this._maxLodLevel?!0:this.childrenEmpty(a):!1};c.prototype.setLodGlobalDirty=function(){this._lodGlobalDirty=!0;this.lodGlobalDirtyChanged(this._lodGlobalDirty)};c.prototype.lodSwapBundleLoaded=
function(a){this.setLodGlobalDirty()};Object.defineProperty(c.prototype,"requiresLODGlobalHandling",{get:function(){return null!=this._rootId&&(!0===this._lodGlobalDirty||1.1<this.layerView.view.resourceController.usedMemory)},enumerable:!0,configurable:!0});c.prototype.lodGlobalHandling=function(){if(this.requiresLODGlobalHandling){var b=this._rootId,c=Math.max(0,Math.floor(10*(this.layerView.view.resourceController.usedMemory-1)));a.clear();this._lodGlobalHandlingRecursion(b,c);this.layerView.removeNodeData(a);
a.clear();this._lodGlobalDirty=!1;this.lodGlobalDirtyChanged(this._lodGlobalDirty)}};c.prototype._lodGlobalHandlingRecursion=function(b,c){b=this._nodeIndex[b];if(null==b)return!1;var e=this._nodeTraversalState(b),f=e.isChosen&&(!e.nodeHasLOD||e.lodLevel===this._maxLodLevel);(e=this.layerView.isNodeLoaded(b))&&null!=this.layerView.setPolygonOffset&&this.layerView.setPolygonOffset(b,!f);if(f&&e)return this._removeChildrenRecursive(b),!0;var g=!1;if(null!=b.children&&0!==b.children.length)for(var g=
!0,k=0,d=b.children;k<d.length;k++){var l=d[k],p=this._nodeIndex[l.id];if(p?this._isGeometryVisible(p):this._isNodeVisible(l))l=this._lodGlobalHandlingRecursion(l.id,c),g=g&&l}e&&!f&&(g||a.length<c)&&(a.push(b),e=!1);c=!b.featureData||0===b.featureData.length;return g||e||c};c.prototype._removeChildrenRecursive=function(b){if(null!=b.children){var c=0;for(b=b.children;c<b.length;c++){var e=this._nodeIndex[b[c].id];null!=e&&(this._removeChildrenRecursive(e),a.push(e))}}};c.prototype._subtreeEmpty=
function(a){return this.layerView.isNodeLoaded(a)?!1:this.childrenEmpty(a)};c.prototype.childrenEmpty=function(a){if(null==a.children)return!0;var b=0;for(a=a.children;b<a.length;b++){var c=a[b];if(this._isNodeVisible(c)&&(c=this._nodeIndex[c.id],null!=c&&!this._subtreeEmpty(c)))return!1}return!0};return c}();var a=new c;return n})},"esri/views/3d/layers/i3s/I3SNodeLoader":function(){define("require exports dojo/Deferred dojo/errors/CancelError ../../../../core/lang ../../../../core/promiseUtils ../../../../core/urlUtils ./I3SBinaryReader ./I3SUtil ../../webgl-engine/lib/Util".split(" "),
function(n,g,c,a,f,b,l,e,h,m){n=function(){function g(a,c,e,f,h){this.loader=a;this.logger=c;this.defaultGeometrySchema=e;this.requiredAttributes=f;this.options=h;this.cancelled=!1;this.loadShared=function(a){if(null==a.sharedResource)return b.resolve({});var c=l.makeAbsolute(a.sharedResource.href,a.baseUrl);return this.load(c,"json").then(function(a){g.fixTextureEncodings(a);g.addAbsoluteHrefTexture(a,c);return a})}}g.prototype.cancelAll=function(){this.cancelled=!0};g.prototype.load=function(a,
b){b=this.loader.request(a,b);var d=new c;b.then(function(a,b){d.resolve(b)},function(b){d.reject(Error("Failed to load: "+a))});return d.promise};g.prototype.loadAttribute=function(a,b,c){a=l.makeAbsolute(c,a);return this.load(a,"binary").then(function(a){return e.readBinaryAttribute(b,a)})};g.prototype.loadAttributes=function(a,c,e){var d=this,f=e.map(function(e){return null==a.attributeData||null==a.attributeData[e.index]?(d.logger.error("Missing attributeData for '"+e.name+"' on node '"+a.id+
"'"),b.resolve(null)):d.loadAttribute(c,e.attributeStorageInfo,a.attributeData[e.index].href).catch(function(b){d.logger.error("Failed to load attributeData for '"+e.name+"' on node '"+a.id+"'");return null})});return b.all(f).then(function(a){for(var b={},c=0;c<e.length;++c)a[c]&&(b[e[c].name]=a[c]);return b})};g.prototype.prepareBinaryGeometryData=function(a,b,c,g){f.mixin(a.geometries[0].params,c);g||null!=c.vertexAttributes.region||delete c.vertexAttributes.region;if(null!=c.featureAttributes){g=
c.featureAttributes;if(g.faceRange){var d=e.createTypedView(b,g.faceRange);a.componentOffsets=h.convertFlatRangesToOffsets(d,c.header.fields.featureCount,g.faceRange.valuesPerElement)}if(g.id){a.featureIds=[];var d=1,k=e.valueType2TypedArrayClassMap[g.id.valueType];"UInt64"===g.id.valueType&&(k=Uint32Array,d=2);b=new k(b,g.id.byteOffset,g.id.count*g.id.valuesPerElement*d);for(k=0;k<c.header.fields.featureCount;k++)if(a.featureIds[k]=b[k*g.id.valuesPerElement*d],2===d){var l=b[k*g.id.valuesPerElement*
d+1];if(2097150<=l)throw Error("ID exceeded maximum range supported by javascript (max \x3d 53bit-1 \x3d 9007199254740991)");a.featureIds[k]+=4294967296*l}}}};g.prototype.loadBundleData=function(a,c){var d=this,f=a.baseUrl,g=null,h=this.loadShared(a),k=null;null!=this.requiredAttributes&&(k=this.loadAttributes(a,f,this.requiredAttributes));var m=null;null!=a.geometryData&&(f=l.makeAbsolute(a.geometryData[c].href,f),m=this.load(f,"binary"));return h.then(function(f){d.handleCancelled();return(d.options.loadFeatureData?
d.loadFeatureData(a,c):b.resolve(null)).then(function(c){d.handleCancelled();var h=d.options.loadFeatureData?d.collectGeometries(a,c,f):d.meshPyramidGeometryData(a,f);c=null!=m?m.then(function(a){g=a;var b=Object.keys(f.materialDefinitions)[0],b=f.materialDefinitions[b].params.vertexRegions,c=e.createGeometryDataIndex(a,d.defaultGeometrySchema,b);d.prepareBinaryGeometryData(h[0],a,c,b);return h}):b.resolve(h);var l=d.loadTextures(h,f);return b.all([l,c,k])}).then(function(a){var b=a[0],c=a[1];a=a[2];
d.handleCancelled();var e=null;a&&(e={attributeData:a,loadedAttributes:d.requiredAttributes});return{allGeometryData:c,attributeDataInfo:e,geometryBuffer:g,sharedResource:f,textureData:b}})})};g.addAbsoluteHrefTexture=function(a,b){a=a.textureDefinitions;if(null!=a)for(var c=0,d=Object.keys(a);c<d.length;c++)for(var e=0,f=a[d[c]].images;e<f.length;e++){var g=f[e];Array.isArray(g.href)?g.hrefConcat=g.href.map(function(a){return l.makeAbsolute(a,b)}):g.hrefConcat=l.makeAbsolute(g.href,b)}};g.fixTextureEncodings=
function(a){a=a.textureDefinitions;if(null!=a)for(var b in a){var c=a[b];if(Array.isArray(c.encoding))for(var d=0;d<c.encoding.length;d++){var e=c.encoding[d];"data:"===e.substring(0,5)&&(c.encoding[d]=e.substring(5))}else e=c.encoding,"data:"===e.substring(0,5)&&(c.encoding=e.substring(5))}};g.prototype.loadTexture=function(a,b,c,e){var d=this;return e===h.DDS_ENCODING_STRING?this.load(a,"binary").then(function(a){d.handleCancelled();return{i3sTexId:b,data:a,encoding:e}}):this.load(a,"image").then(function(a){var f=
a;d.handleCancelled();if(c&&4096<=a.width*a.height){var f=Math.ceil(a.width/2),g=Math.ceil(a.height/2),h=document.createElement("canvas");h.width=f;h.height=g;h.getContext("2d").drawImage(a,0,0,f,g);f=h}return{i3sTexId:b,data:f,encoding:e}})};g.prototype.loadTextures=function(a,c){for(var d=[],e=0;e<a.length;e++){var f=a[e].geometries;if(null!=f)for(var k=0;k<f.length;k++){var l=f[k].params.textureID||"none";if("none"!==l){null!=c.textureDefinitions&&null!=c.textureDefinitions[l]||this.logger.warn("textureDefinitions missing in shared resource. i3sTexId: "+
l);var n=c.textureDefinitions[l];m.assert(void 0!==n,"geometry wants unknown texture "+l);if(0!==n.images.length){var q=n.images[n.images.length-1],x=this.options.textureFormat===g.TextureFormat.Downsampled,B=h.getAppropriateTextureEncoding(n.encoding,this.options.textureFormat===g.TextureFormat.Compressed),n=-1<B?n.encoding[B]:n.encoding,q=-1<B?q.hrefConcat[B]:q.hrefConcat;this.options.loadTextureData?d.push(this.loadTexture(q,l,x,n)):d.push({i3sTexId:l,encoding:n,data:null})}}}}return b.all(d)};
g.prototype.meshPyramidGeometryData=function(a,b){a=b.materialDefinitions?Object.keys(b.materialDefinitions)[0]:null;b=b.textureDefinitions?Object.keys(b.textureDefinitions)[0]:null;return[{featureIds:[],geometries:[{type:"ArrayBufferView",params:{materialID:a,textureID:b}}],featureDataPosition:[0,0,0]}]};g.prototype.collectGeometries=function(a,b,c){a=[];c=0;for(b=b.featureData;c<b.length;c++){var d=b[c],e=d.geometries;if(null!=e)for(var f=0;f<e.length;f++)a.push({featureIds:[d.id],featureDataPosition:d.position,
geometries:[d.geometries[f]]});else null!=d.position&&a.push({featureIds:[d.id],featureDataPosition:d.position,geometries:null})}return a};g.prototype.loadFeatureData=function(a,b){a=l.makeAbsolute(a.featureData[b].href,a.baseUrl);return this.load(a,"json")};g.prototype.handleCancelled=function(){if(this.cancelled)throw new a;};return g}();(function(a){a=a.TextureFormat||(a.TextureFormat={});a[a.Compressed=0]="Compressed";a[a.Normal=1]="Normal";a[a.Downsampled=2]="Downsampled"})(n||(n={}));return n})},
"esri/views/3d/layers/i3s/I3SViewportQueries":function(){define("require exports ../../../../geometry/Point ../graphics/ElevationContext ../graphics/featureExpressionInfoUtils ../graphics/Graphics3DSymbolCommonCode ./I3SUtil ../../lib/gl-matrix ../../support/geometryUtils ../../support/orientedBoundingBox ../../support/projectionUtils ../../webgl-engine/lib/Util".split(" "),function(n,g,c,a,f,b,l,e,h,m,k,d){return function(){function g(b,d,g,k,l,m,n,q){void 0===q&&(q={});this.indexSR=b;this._renderCoordsHelper=
d;this.extent=l;this.elevationProvider=m;this.options=q;this._computedOBBs={};this._computedMBSs={};this._isNodeVisibleCached={};this.fp=[];this._idleCamera=!0;this.maxDistance=0;this.maxLodLevel=2;this._tmp1=[0,0,0];this._tmp2=[0,0,0];this._tmp3=[0,0,0];this._tmp0=[0,0,0];this.supportedMetrics=["maxScreenThreshold","screenSpaceRelative","removedFeatureDiameter","distanceRangeFromDefaultCamera"];this.screenspaceErrorBias=q.screenspaceErrorBias||1;this.progressiveLoadFactor=q.progressiveLoadFactor||
1;this.enableLoD=!q.disableLod;for(d=0;8>d;++d)this.fp[d]=h.plane.create();this.updateCamera(g);this._poi=e.vec3d.create(k);this.engineSR=this._renderCoordsHelper.spatialReference;n?(this._elevationContext=new a,this._elevationContext.featureExpressionInfoContext=f.createContext(f.extractExpressionInfo(n,!1)),this._elevationContext.mixinApi(n)):this._elevationContext=null;this.tmpPoint=new c({x:0,y:0,z:0,spatialReference:b})}g.prototype.updateCamera=function(a){d.matrixToFrustumPlanes(a.viewMatrix,
a.projectionMatrix,this.fp);this._screenSizeFactor=1/a.perPixelRatio;this._camPos=a.eye;this._isNodeVisibleCached={}};g.prototype.updateNode=function(a){delete this._isNodeVisibleCached[a]};g.prototype.updatePointOfInterest=function(a){e.vec3d.set(a,this._poi);this.maxDistance=0};g.prototype.updateScreenSpaceErrorBias=function(a){var b=this.screenspaceErrorBias;this.screenspaceErrorBias=a;return b};g.prototype.setCameraIdle=function(a){this._idleCamera!==a&&(this._idleCamera=a,this._isNodeVisibleCached=
{})};g.prototype.updateExtent=function(a){this.extent=a;this._isNodeVisibleCached={}};g.prototype.computeMbs=function(a){var c=this._computedMBSs[a.id];c||(c=e.vec4d.createFrom(a.mbs[0],a.mbs[1],a.mbs[2],-1),this._computedMBSs[a.id]=c);0>c[3]&&(e.vec4d.set(a.mbs,c),this._elevationContext&&1E5>c[3]&&(this.tmpPoint.x=c[0],this.tmpPoint.y=c[1],this.tmpPoint.z=c[2],c[2]=b.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,this._renderCoordsHelper,null)),k.mbsToMbs(c,this.indexSR,
c,this.engineSR));return c};g.prototype.computeObb=function(a){if(a.obb&&!(0>a.obb.halfSize[0])){var c=this._computedOBBs[a.id];c||(c=m.clone(a.obb),c.halfSize[0]=-1,this._computedOBBs[a.id]=c);0>c.halfSize[0]&&(c.halfSize[0]=a.obb.halfSize[0],e.vec3d.set(a.obb.center,c.center),this._elevationContext&&1E5>a.mbs[3]&&(this.tmpPoint.x=a.obb.center[0],this.tmpPoint.y=a.obb.center[1],this.tmpPoint.z=a.obb.center[2],c.center[2]=b.computeElevation(this.elevationProvider,this.tmpPoint,this._elevationContext,
this._renderCoordsHelper,null)),k.bufferToBuffer(c.center,this.indexSR,0,c.center,this.engineSR,0,1));return c}};g.prototype._isNodeVisible=function(a){var b=this.computeMbs(a);return this.isMBSinExtent(b)?a.hasServiceOBB&&a.obb?(a=this.computeObb(a),m.isVisible(a,this.fp)):this.isMBSVisible(b):!1};g.prototype.isNodeVisible=function(a){if(!this.enableLoD)return!0;if(!this._idleCamera)return this._isNodeVisible(a);if(null!=this._isNodeVisibleCached[a.id])return this._isNodeVisibleCached[a.id];this._isNodeVisibleCached[a.id]=
this._isNodeVisible(a);return this._isNodeVisibleCached[a.id]};g.prototype.isGeometryVisible=function(a){return this.isNodeVisible(a)?a.hasServiceOBB?!0:(a=this.computeObb(a))?m.isVisible(a,this.fp):!0:!1};g.prototype.invalidateCache=function(a){if(null==a){for(var b=0,c=Object.keys(this._computedMBSs);b<c.length;b++)a=c[b],this._computedMBSs[a][3]=-1;b=0;for(c=Object.keys(this._computedOBBs);b<c.length;b++)a=c[b],this._computedOBBs[a].halfSize[0]=-1}else this._computedMBSs[a]&&(this._computedMBSs[a][3]=
-1),this._computedOBBs[a]&&(this._computedOBBs[a].halfSize[0]=-1)};g.prototype.isMBSinExtent=function(a){return this.extent?0!==l.intersectBoundingBoxWithMbs(this.extent,a):!0};g.prototype.isMBSVisible=function(a){var b=a[0],c=a[1],d=a[2];a=a[3];var e=this.fp;return e[0][0]*b+e[0][1]*c+e[0][2]*d+e[0][3]<=a&&e[1][0]*b+e[1][1]*c+e[1][2]*d+e[1][3]<=a&&e[2][0]*b+e[2][1]*c+e[2][2]*d+e[2][3]<=a&&e[3][0]*b+e[3][1]*c+e[3][2]*d+e[3][3]<=a&&e[4][0]*b+e[4][1]*c+e[4][2]*d+e[4][3]<=a&&e[5][0]*b+e[5][1]*c+e[5][2]*
d+e[5][3]<=a};g.prototype.calcScreenSpaceSize=function(a,b){a=this.computeMbs(a);var c=a[3];a=e.vec3d.dist2(a,this._camPos)-c*c;return 0>a?.5*Number.MAX_VALUE:b/Math.sqrt(a)*this._screenSizeFactor};g.prototype.calcCameraDistance=function(a){a=this.computeMbs(a);return Math.max(0,e.vec3d.dist(a,this._camPos)-a[3])};g.prototype.calcAngleDependentLoD=function(a){a=this.computeMbs(a);var b=a[3];a=(Math.abs(a[0]*(a[0]-this._camPos[0])+a[1]*(a[1]-this._camPos[1])+a[2]*(a[2]-this._camPos[2]))/e.vec3d.length(a)+
b)/e.vec3d.dist(a,this._camPos);return Math.min(1,a)};g.prototype.hasLOD=function(a){return null!=a.lodSelection};g.prototype.hasFeatures=function(a){return null!=a.featureData};g.prototype.getDistancePlanarMode=function(a,b,c){var d=a[0]-b[0],e=a[1]-b[1];a=a[2]-b[2];d=d+d+e*e;if(d<=c*c)return Math.abs(a);c=Math.sqrt(d)-c;return Math.sqrt(a*a+c*c)};g.prototype.getDistanceGlobeMode=function(a,b,c){var d=e.vec3d.length(b),f=e.vec3d.length(a)-d;e.vec3d.scale(a,e.vec3d.dot(a,b)/e.vec3d.length2(a),this._tmp0);
if(e.vec3d.dist2(b,this._tmp0)<=c*c)return Math.abs(f);b=e.vec3d.scale(b,1/d,this._tmp0);var d=e.vec3d.scale(b,d-c*c/2/d,this._tmp1),g=e.vec3d.subtract(a,d,this._tmp2),g=e.vec3d.subtract(g,e.vec3d.scale(b,e.vec3d.dot(b,g),this._tmp3),this._tmp2),d=e.vec3d.add(d,e.vec3d.scale(g,c/e.vec3d.length(g),this._tmp2),this._tmp2);c=e.vec3d.dist(a,d);2E5<=f&&(a=e.vec3d.subtract(a,d,this._tmp1),a=e.vec3d.dot(a,b)/e.vec3d.length(a),.08>a&&(a=1E-4),c/=a);return c};g.prototype.getDistance=function(a,b,c){return this.engineSR===
k.SphericalECEFSpatialReference?this.getDistanceGlobeMode(a,b,c):this.getDistancePlanarMode(a,b,c)};g.prototype._selectErrorMetric=function(a){for(var b=0;b<a.length;b++)if(0<=this.supportedMetrics.indexOf(a[b].metricType))return a[b];return null};g.prototype.getLodLevel=function(a){if(!a.lodSelection||0>=a.lodSelection.length||!1===this.hasFeatures(a))return 0;if(null==a.children||0===a.children.length)return this.maxLodLevel;var b=this.enableLoD?this._selectErrorMetric(a.lodSelection):null;if(null==
b)return 0;if(1>this.progressiveLoadFactor){var c=this.screenspaceErrorBias;return this.evaluateLODmetric(a,this.progressiveLoadFactor*this.screenspaceErrorBias,b)?this.evaluateLODmetric(a,c,b)?2:1:0}return this.evaluateLODmetric(a,this.screenspaceErrorBias,b)?this.maxLodLevel:0};g.prototype.evaluateLODmetric=function(a,b,c){switch(c.metricType){case "screenSpaceRelative":return a=this.computeMbs(a),a=2*this.getDistance(this._camPos,a,a[3])/this._screenSizeFactor,c.maxError*b<=a;case "maxScreenThreshold":return b=
this.calcScreenSpaceSize(a,a.mbs[3]*b),this.options.angleDependentLoD&&(b*=this.calcAngleDependentLoD(a)),b<c.maxError;case "removedFeatureDiameter":return 10>this.calcScreenSpaceSize(a,c.maxError)*b;case "distanceRangeFromDefaultCamera":return this.calcCameraDistance(a)>c.maxError*b}return!1};g.prototype.distToPOI=function(a){a=this.computeMbs(a);a=e.vec3d.dist(a,this._poi)-a[3];this.maxDistance=Math.max(this.maxDistance,a);return a};g.prototype.distCameraToPOI=function(){return e.vec3d.dist(this._camPos,
this._poi)};return g}()})},"esri/views/3d/layers/SceneLayerWorker":function(){define("require exports ../../../core/promiseUtils ../../../geometry/SpatialReference ./i3s/I3SGeometryUtil ./i3s/I3SProjectionUtil ../lib/gl-matrix ../support/meshProcessing ../support/orientedBoundingBox ../support/projectionUtils ../webgl-engine/lib/PreinterleavedGeometryData ../webgl-engine/lib/Util".split(" "),function(n,g,c,a,f,b,l,e,h,m,k,d){n=function(){function g(){}g.prototype.process=function(a){var b=[a.geometryBuffer];
return c.resolve({result:this.transform(a,b),transferList:b})};g.prototype.transform=function(c,g){var n=a.fromJSON(c.indexSR),r=a.fromJSON(c.vertexSR),t=a.fromJSON(c.renderSR),u=!1,v=0,C=[],G=b.computeGlobalTransformation(c.mbs,c.elevationOffset,n,t),E=c.obb?null:h.create([0,0,0],[-1,-1,-1],[0,0,0,1]);l.vec3d.set(c.mbs,q);q[2]+=c.elevationOffset;l.vec3d.set(q,p);for(var F=0,I=c.geometryData;F<I.length;F++)for(var K=I[F],N=K.componentOffsets,H=0,K=K.geometries;H<K.length;H++){var M=K[H],T=c.layouts[v];
++v;var V=f.interleaveGeometryBuffer(M,c.geometryBuffer,T,[{name:d.VertexAttrConstants.COLOR,byteValue:255}],[d.VertexAttrConstants.NORMAL,d.VertexAttrConstants.NORMALCOMPRESSED,d.VertexAttrConstants.SYMBOLCOLOR,d.VertexAttrConstants.COMPONENTINDEX]),U=new k(new Float32Array(V),T,void 0,void 0,void 0,!0),J=U.getAttribute(d.VertexAttrConstants.POSITION);b.reprojectPoints(J,c.mbs,G,c.elevationOffset,n,r,t);E&&this._updateObb(E,J,G);c.needNormals&&(J={normals:U.getAttribute(d.VertexAttrConstants.NORMALCOMPRESSED),
positions:J,normalInd:U.getIndices(d.VertexAttrConstants.NORMALCOMPRESSED),positionInd:U.getIndices(d.VertexAttrConstants.POSITION)},f.processAndInterleaveNormals(c.normalReferenceFrame,M,c.geometryBuffer,G,J));(M=U.getAttribute(d.VertexAttrConstants.COMPONENTINDEX))&&this._createComponentNumbers(M,N);(U=U.getAttribute(d.VertexAttrConstants.COLOR))&&!u&&(u=this._hasColors(U));U={globalTrafo:G};M=T[0].stride;M=e.deduplicate(V,M/4,1-.8*M/(M+4));null!=M?(V=65536>M.uniqueCount?new Uint16Array(M.indices):
M.indices,J=f.extractPositionData(M.buffer,T,V),C.push({layout:T,interleavedVertexData:M.buffer,indices:V,corMatrices:U,hasColors:u,positionData:J}),g&&(g.push(M.buffer),g.push(V.buffer),g.push(J.data.buffer),g.push(J.indices.buffer))):(J=f.extractPositionData(V,T),C.push({layout:T,interleavedVertexData:V,corMatrices:U,hasColors:u,positionData:J}),g&&(g.push(V),g.push(J.data.buffer),g.push(J.indices.buffer)))}E&&(l.mat4d.multiplyVec3(G,E.center,E.center),m.vectorToVector(E.center,t,E.center,n),E.center[2]-=
c.elevationOffset);return{geometryBuffer:c.geometryBuffer,transformedGeometries:C,obb:E}};g.prototype._hasColors=function(a){var b=a.data,c=a.size,d=a.strideIdx;for(a=a.offsetIdx;a<b.length;a+=d)for(var e=0;e<c;e++)if(255!==b[a+e])return!0;return!1};g.prototype._createComponentNumbers=function(a,b){var c=a.data,d=a.strideIdx,e=c.length/d,f=0;a=a.offsetIdx;for(var g=0;g<e;g++)g>=b[f+1]&&f++,c[a]=f,a+=d};g.prototype._updateObb=function(a,b,c){if(0<a.halfSize[0]){l.vec3d.subtract(a.center,a.halfSize,
q);l.vec3d.add(a.center,a.halfSize,p);for(c=b.offsetIdx;c<b.data.length;c+=b.strideIdx)q[0]=Math.min(q[0],b.data[c]),q[1]=Math.min(q[1],b.data[c+1]),q[2]=Math.min(q[2],b.data[c+2]),p[0]=Math.max(p[0],b.data[c]),p[1]=Math.max(p[1],b.data[c+1]),p[2]=Math.max(p[2],b.data[c+2]);l.vec3d.subtract(p,q,a.halfSize);l.vec3d.scale(a.halfSize,.5);l.vec3d.add(q,p,a.center);l.vec3d.scale(a.center,.5)}else h.compute(b,a),b=2*Math.sqrt(1+c[0]+c[5]+c[10]),r[0]=(c[9]-c[6])/b,r[1]=(c[2]-c[8])/b,r[2]=(c[4]-c[1])/b,r[3]=
.25*b,l.quat4.conjugate(r),l.quat4.multiply(r,a.quaternion,a.quaternion)};return g}();var q=l.vec3d.create(),p=l.vec3d.create(),r=l.quat4.create();return n})},"esri/views/3d/layers/i3s/I3SGeometryUtil":function(){define("require exports ./I3SBinaryReader ../../lib/gl-matrix ../../support/meshProcessing ../../webgl-engine/lib/Util".split(" "),function(n,g,c,a,f,b){function l(a,b,c,e,f,g,h){switch(c){case 1:for(c=0;c<h;c++)e[f]=a[b],b+=1,f+=g;break;case 2:for(c=0;c<h;c++)e[f]=a[b],e[f+1]=a[b+1],b+=
2,f+=g;break;case 3:for(c=0;c<h;c++)e[f]=a[b],e[f+1]=a[b+1],e[f+2]=a[b+2],b+=3,f+=g;break;case 4:for(c=0;c<h;c++)e[f]=a[b],e[f+1]=a[b+1],e[f+2]=a[b+2],e[f+3]=a[b+3],b+=4,f+=g;break;default:throw d("Unhandled stride size "+c);}}function e(a,b,c,e,f,g){switch(b){case 1:for(b=0;b<g;b++)c[e]=a,e+=f;break;case 2:for(b=0;b<g;b++)c[e]=a,c[e+1]=a,e+=f;break;case 3:for(b=0;b<g;b++)c[e]=a,c[e+1]=a,c[e+2]=a,e+=f;break;case 4:for(b=0;b<g;b++)c[e]=a,c[e+1]=a,c[e+2]=a,c[e+3]=a,e+=f;break;default:throw d("Unhandled stride size "+
b);}}function h(a){switch(a){case 5120:return Int8Array;case 5126:return Float32Array;case 5124:return Int32Array;case 5122:return Int16Array;case 5121:return Uint8Array;case 5125:return Uint32Array;case 5123:return Uint16Array}throw Error("Unhandled data type: "+a);}function m(a){switch(a){case 5120:return"Int8";case 5126:return"Float32";case 5124:return"Int32";case 5122:return"Int16";case 5121:return"UInt8";case 5125:return"UInt32";case 5123:return"UInt16"}throw Error("Unhandled data type: "+a);
}function k(a){return 0<a&&0===a%Uint32Array.BYTES_PER_ELEMENT}function d(a){return Error("I3SGeometryUtil processing failed: "+a)}Object.defineProperty(g,"__esModule",{value:!0});var q=new Uint8Array(64);g.interleaveGeometryBuffer=function(a,b,c,f,g){void 0===f&&(f=[]);void 0===g&&(g=[]);var n=a.params.vertexAttributes,p=n.position.count;if(!k(c[0].stride))throw d("Layout stride must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var r=new Uint32Array(c[0].stride/Uint32Array.BYTES_PER_ELEMENT*
p);c=c.slice(0).sort(function(a,b){return a.offset-b.offset});a=function(a){if(-1!==g.indexOf(a.name))return"continue";var c=n[a.name],t=h(a.type),u=void 0,v=!1;if(null==c)if(v=f.filter(function(b){return b.name===a.name})[0]){c={valueType:m(a.type),byteOffset:0,count:p,valuesPerElement:a.count};for(u=0;u<q.length;u++)q[u]=v.byteValue;u=q.buffer;v=!0}else throw d("Geometry definition is missing attribute");else u=b;if(m(a.type)!==c.valueType)throw d("Geometry definition type must match attribute type");
if(0!==c.byteOffset%Uint32Array.BYTES_PER_ELEMENT||0!==a.offset%Uint32Array.BYTES_PER_ELEMENT)throw d(a.name+" offset must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");if(!k(c.valuesPerElement*t.BYTES_PER_ELEMENT)||!k(a.count*t.BYTES_PER_ELEMENT))throw d(a.name+" data must use "+Uint32Array.BYTES_PER_ELEMENT+"-byte words");var u=new Uint32Array(u),x=c.byteOffset/Uint32Array.BYTES_PER_ELEMENT,c=c.valuesPerElement*t.BYTES_PER_ELEMENT/Uint32Array.BYTES_PER_ELEMENT,t=a.offset/Uint32Array.BYTES_PER_ELEMENT,
z=a.stride/Uint32Array.BYTES_PER_ELEMENT;v?e(u[0],c,r,t,z,p):l(u,x,c,r,t,z,p)};for(var t=0;t<c.length;t++)a(c[t]);return r.buffer};g.processAndInterleaveNormals=function(d,e,f,g,h){if("none"===d){var k=h.normals,l=h.positions;e=h.normalInd;d=h.positionInd;b.assert(h.normalInd.length===h.positionInd.length);h=a.vec3.create();g=a.vec3.create();f=a.vec2.create();for(var m=l.data,n=l.offsetIdx,l=l.strideIdx,q=k.data,t=k.offsetIdx,k=k.strideIdx,u=0;u<d.length;u+=3){var v=d[u],v=n+l*v,z=m[v],A=m[v+1],H=
m[v+2],v=d[u+1],v=n+l*v;h[0]=m[v]-z;h[1]=m[v+1]-A;h[2]=m[v+2]-H;v=d[u+2];v=n+l*v;g[0]=m[v]-z;g[1]=m[v+1]-A;g[2]=m[v+2]-H;a.vec3.cross(h,g,h);b.encodeNormal(h,f);for(z=0;3>z;z++)A=t+k*e[u+z],q[A]=b.encodeInt16(f[0]),q[A+1]=b.encodeInt16(f[1])}}else if(e=c.createTypedView(f,e.params.vertexAttributes.normal),f=h.normals,A="earth-centered"===d?g:null,d=e.length/3,h=f.data,g=f.offsetIdx,f=f.strideIdx,null!=A)for(m=A[0],n=A[1],l=A[2],q=A[4],t=A[5],k=A[6],u=A[8],z=A[9],A=A[10],H=0;H<d;H++){var v=e[3*H],
M=e[3*H+1],T=e[3*H+2];p[0]=m*v+n*M+l*T;p[1]=q*v+t*M+k*T;p[2]=u*v+z*M+A*T;b.encodeNormal(p,r);h[g+H*f]=b.encodeInt16(r[0]);h[g+H*f+1]=b.encodeInt16(r[1])}else for(H=0;H<d;H++)p[0]=e[3*H],p[1]=e[3*H+1],p[2]=e[3*H+2],b.encodeNormal(p,r),h[g+H*f]=b.encodeInt16(r[0]),h[g+H*f+1]=b.encodeInt16(r[1])};g.extractPositionData=function(a,b,c){b=b[0];if(null==b||"position"!==b.name||5126!==b.type)return null;var d=new Float32Array(a),e=b.stride/4,g=3*d.length/e,h=new Float32Array(g);for(a=0;a<g/3;a++)h[3*a]=d[a*
e+b.offset],h[3*a+1]=d[a*e+b.offset+1],h[3*a+2]=d[a*e+b.offset+2];b=f.deduplicate(h.buffer,3);a=65536>b.uniqueCount;if(c)for(d=new (a?Uint16Array:Uint32Array)(c.length),a=0;a<c.length;a++)d[a]=b.indices[c[a]];else d=a?new Uint16Array(b.indices):b.indices;return{data:new Float32Array(b.buffer),indices:d}};var p=a.vec3.create(),r=a.vec2.create()})},"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["require","exports","../../lib/gl-matrix","../../support/earthUtils","../../support/projectionUtils"],
function(n,g,c,a,f){function b(b,e,f){var d=c.vec3d.create(),g=Math.ceil(Math.log(b[3])*Math.LOG2E/k),h=Math.pow(2,g*k+m),l;if(f.isGeographic){l=h/a.earthRadius*180/Math.PI;f=Math.round(b[1]/l);var n=Math.max(-90,Math.min(90,f*l)),p=l/Math.cos((Math.abs(n)-l/2)/180*Math.PI);l=Math.round(b[0]/p);d[0]=l*p;d[1]=n}else l=Math.round(b[0]/h),f=Math.round(b[1]/h),d[0]=l*h,d[1]=f*h;b=Math.round((b[2]+e)/h);d[2]=b*h;return{center:d,id:g+"_"+l+"_"+f+"_"+b}}Object.defineProperty(g,"__esModule",{value:!0});var l=
new Float64Array(3E3),e=c.vec3d.create(),h=c.mat4d.create();g.computeGlobalTransformation=function(a,e,g,h){a=b(a,e,g).center;e=c.mat4d.create();f.computeLinearTransformation(g,a,e,h);return e};g.reprojectPoints=function(a,b,g,k,m,n,v){var d=a.data,p=a.offsetIdx;a=a.strideIdx;c.mat4d.inverse(g,h);c.vec3d.set(b,e);e[2]+=k;b=[0,0,0];g=d.length/a;f.vectorToVector(e,m,b,n);for(m=0;m<g;m+=1E3){k=Math.min(1E3,g-m);for(var q=0;q<k;q++){var r=p+a*(m+q);l[3*q]=d[r]+b[0];l[3*q+1]=d[r+1]+b[1];l[3*q+2]=d[r+2]+
b[2]}f.bufferToBuffer(l,n,0,l,v,0,k);for(q=0;q<k;q++){var r=l[3*q],t=l[3*q+1],u=l[3*q+2],G=p+a*(m+q);d[G]=h[0]*r+h[4]*t+h[8]*u+h[12];d[G+1]=h[1]*r+h[5]*t+h[9]*u+h[13];d[G+2]=h[2]*r+h[6]*t+h[10]*u+h[14]}}};g.createOrigin=function(a,c,e,g){c=b(a,c,e);a=c.center;c=c.id;f.vectorToVector(a,e,a,g);return{vec3:a,id:c}};var m=1,k=5-m})},"esri/views/3d/layers/i3s/Highlights":function(){define(["require","exports","../../webgl-engine/lib/HighlightSet"],function(n,g,c){var a=function(){return function(a){this.highlightSet=
new c;this.ids=new Set;this.options=a}}();return function(){function c(a){this.highlights=[];this.layerView=a}c.prototype.destroy=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()});this.highlights=null};c.prototype.acquireSet=function(b){var c=this,e=new a(b);this.highlights.push(e);return{set:e,handle:{remove:function(){return c.releaseSet(e)}}}};c.prototype.releaseSet=function(a){a.highlightSet.removeAll();a=this.highlights?this.highlights.indexOf(a):-1;-1!==a&&this.highlights.splice(a,
1)};c.prototype.setFeatureIds=function(a,c){c.forEach(function(b){return a.ids.add(b)});this.layerView._forAllFeatures(function(b,c,f,g){a.ids.has(b)&&(b=f.engineObject.setComponentHighlight(g,c,a.options),a.highlightSet.addObject(f.engineObject,b))},null,!0)};c.prototype.objectCreated=function(a){var b=this;this.highlights.forEach(function(c){b.layerView._forAllFeaturesOfNode(b.layerView._getMetadata(a),function(b,e,f,d){c.ids.has(b)&&(b=a.setComponentHighlight(d,e,c.options),c.highlightSet.addObject(a,
b))},!0)})};c.prototype.objectDeleted=function(a){this.highlights.forEach(function(b){b.highlightSet.removeObject(a)})};c.prototype.allObjectsDeleted=function(){this.highlights.forEach(function(a){return a.highlightSet.removeAll()})};return c}()})},"esri/views/3d/layers/i3s/I3SElevationProvider":function(){define("require exports ../../../../core/tsSupport/declareExtendsHelper ../../../../core/tsSupport/decorateHelper ../../../../core/Accessor ../../../../core/Logger ../../../../core/accessorSupport/decorators ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../lib/gl-matrix ../../support/Evented ../../webgl-engine/lib/Selector".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d){var q=e.empty(),p={spatialReference:null,extent:q},r=m.vec3d.create(),u=m.vec3d.create(),t=m.vec3d.create(),v=b.getLogger("esri.views.3d.layers.i3s.I3SElevationProvider");return function(b){function f(a){return b.call(this)||this}c(f,b);f.prototype.initialize=function(){this.renderCoordsHelper=this.layerView.view.renderCoordsHelper;this.intersectLayers=[this.stageLayer];this.selector=new d(this.layerView.view.viewingMode);var a=this.layerView.layer.fullExtent;this.zmin=
a.zmin;this.zmax=a.zmax};f.prototype.getElevation=function(a){if(h.isPoint(a)){if(!this.renderCoordsHelper.toRenderCoords(a,r))return v.error("could not project point for elevation alignment"),-Infinity}else if(!this.renderCoordsHelper.toRenderCoords(a,this.spatialReference,r))return v.error("could not project point for elevation alignment"),-Infinity;var b=this.layerView.elevationOffset;a=this.zmin+b;b=this.zmax+b;m.vec3d.set(r,u);m.vec3d.set(r,t);this.renderCoordsHelper.setAltitude(b,u);this.renderCoordsHelper.setAltitude(a,
t);this.selector.init(this.intersectLayers,u,t,null,null,1,!1);return this.selector.minResult.getIntersectionPoint(r)?this.renderCoordsHelper.getAltitude(r):-Infinity};f.prototype.layerChanged=function(){this.spatialReference&&(p.extent=this.computeLayerExtent(this.intersectLayers[0]),p.spatialReference=this.spatialReference,this.emit("elevation-change",p))};f.prototype.objectChanged=function(a){this.spatialReference&&(p.extent=this.computeObjectExtent(a),p.spatialReference=this.spatialReference,
this.emit("elevation-change",p))};f.prototype.computeObjectExtent=function(a){e.empty(q);this.expandExtent(a,q);return q};f.prototype.computeLayerExtent=function(a){e.empty(q);var b=0;for(a=a.getObjects();b<a.length;b++)this.expandExtent(a[b],q);return q};f.prototype.expandExtent=function(a,b){for(var c=a.getBBMin(!0),d=a.getBBMax(!0),f=0;8>f;++f)r[0]=f&1?c[0]:d[0],r[1]=f&2?c[1]:d[1],r[2]=f&4?c[2]:d[2],m.mat4d.multiplyVec3(a.objectTransformation,r),this.renderCoordsHelper.fromRenderCoords(r,r,this.spatialReference),
e.expand(b,r);return b};a([l.property({constructOnly:!0})],f.prototype,"layerView",void 0);a([l.property({constructOnly:!0})],f.prototype,"stageLayer",void 0);a([l.property({readOnly:!0,aliasOf:"layerView.view.elevationProvider.spatialReference"})],f.prototype,"spatialReference",void 0);return f=a([l.subclass("esri.views.3d.layers.i3s.I3SElevationProvider")],f)}(l.declared(f,k.Evented))})},"esri/views/3d/layers/i3s/I3SQueryEngine":function(){define("require exports dojo/promise/all ../../../../core/Error ../../../../core/promiseUtils ../../../../layers/graphics/dehydratedFeatures ../../../../tasks/support/FeatureSet".split(" "),
function(n,g,c,a,f,b,l){return function(){function e(a,b,c){this._layer=a;this._support=b;this._options=c}e.prototype.queryExtent=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0,d=b._support.createExtentBuilder();b._forAllQueried(a,function(a){c++;d.add(a)});return{count:c,extent:0===c?null:d.getExtent()}})};e.prototype.queryFeatureCount=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=0;b._forAllQueried(a,function(){return c++});return c})};
e.prototype.queryFeatures=function(e){var g=this;return this._rejectUnsupported(e).then(function(){var b=[],d=e&&e.outFields,h=[];if(0<g._forAllQueried(e,function(a){return h.push(g._support.createGraphic(a))},function(a){d&&(b.push(g._support.requestFields(a,h,d)),h=[])})&&!e.num)return f.reject(new a("Unsupported Query","Large feature query, use Query.num and Query.start to batch"));d||b.push(f.resolve(h));return c(b)}).then(function(a){for(var c=[],e=0;e<a.length;++e)for(var f=a[e],h=0;h<f.length;++h)c.push(b.hydrateGraphic(f[h],
g._layer));a=new l;a.features=c;return a})};e.prototype.queryObjectIds=function(a){var b=this;return this._rejectUnsupported(a).then(function(){var c=[];b._forAllQueried(a,function(a){return c.push(a.id)});return c})};e.defaultExtentBuilder=function(a){var b=null;return{add:function(c){(c=a(c))&&(b=null!=b?b.union(c):c.clone())},getExtent:function(){return b}}};e.prototype._forAllQueried=function(a,b,c){var d=[];if(a&&a.objectIds){var e=a.objectIds;d.push(function(a){return 0<=e.indexOf(a.id)})}var f=
a&&a.start||0,g=a&&a.num||1E4;d.push(function(){if(0>=g)return--g,!1;if(0<f)return--f,!1;--g;return!0});this._support.forAll(function(a){for(var c=0;c<d.length;c++)if(!(0,d[c])(a))return;b(a)},c);return Math.max(0,-g)};e.prototype._rejectUnsupported=function(b){if(null==b)return f.resolve();var c=function(b){return f.reject(new a("Unsupported Query","Unsupported property '"+b+"'"))};return null!=b.distance?c("distance"):null!=b.geometryPrecision?c("geometryPrecision"):b.groupByFieldsForStatistics&&
b.groupByFieldsForStatistics.length?c("groupByFieldsForStatistics"):null!=b.maxAllowableOffset?c("maxAllowableOffset"):b.multipatchOption?c("multipatchOption"):b.orderByFields&&b.orderByFields.length?c("orderByFields"):b.outSpatialReference?c("outSpatialReference"):b.outStatistics&&b.outStatistics.length?c("outStatistics"):b.pixelSize?c("pixelSize"):b.quantizationParameters?c("quantizationParameters"):b.relationParameter?c("relationParameter"):b.returnDistinctValues?c("returnDistinctValues"):b.text?
c("text"):b.timeExtent?c("timeExtent"):b.where?c("where"):b.geometry?c("geometry"):!this._options.enableOutFields&&b.outFields&&b.outFields.length?c("outFields"):!this._options.enableObjectId&&b.objectIds&&b.objectIds.length?c("objectIds"):f.resolve()};return e}()})},"esri/views/3d/layers/i3s/IDBCache":function(){define(["require","exports","../../../../core/Error","../../../../core/promiseUtils"],function(n,g,c,a){function f(b){return a.create(function(a,c){b.oncomplete=function(){return a()};b.onerror=
function(){return c(b.error)};b.onabort=function(){return c(b.error)}})}function b(b){return a.create(function(a,c){"done"===b.readyState?null!=b.error?c(b.error):a(b.result):(b.onsuccess=function(){return a(b.result)},b.onerror=function(){return c(b.error)})})}Object.defineProperty(g,"__esModule",{value:!0});n=function(){function g(a,b,c){this._quotaReductionPromise=this._db=null;this._miss=this._hit=this._gcCounter=0;this._destroyed=!1;this.gcFrequency=50;this.maxByteSize=1073741824;this.quotaReductionFactor=
.2;this._dbName=a;this._storeName=b;this._version=c}g.prototype.init=function(){var c=this;return a.resolve().then(function(){var a=indexedDB.open(c._dbName,c._version);a.onupgradeneeded=function(b){var e=a.result,d=a.transaction,f=e.objectStoreNames.contains(c._storeName)?d.objectStore(c._storeName):e.createObjectStore(c._storeName),e=e.objectStoreNames.contains("last_access")?d.objectStore("last_access"):e.createObjectStore("last_access");e.indexNames.contains("date")||e.createIndex("date","date",
{unique:!1});e.indexNames.contains("byteSize")||e.createIndex("byteSize","byteSize",{unique:!1});b.oldVersion<c._version&&(f.clear(),e.clear())};return b(a)}).then(function(a){c._destroyed?a.close():c._db=a})};g.prototype.destroy=function(){this._db&&(this._db.close(),this._db=null);this._destroyed=!0};g.prototype.getHitRate=function(){return this._hit/(this._hit+this._miss)};g.prototype.put=function(b,f){var e=this;return null==this._db?a.reject(new c("indexedb:not-initialized","IndexedDB Cache is not initialized")):
(null!=this._quotaReductionPromise?this._quotaReductionPromise:a.resolve()).then(function(){return e._put(b,f)}).catch(function(a){if("QuotaExceededError"===a.name)return null==e._quotaReductionPromise&&(e._quotaReductionPromise=e._getCacheSize().then(function(a){return e._removeLeastRecentlyAccessed(f.byteSize+Math.ceil(a*e.quotaReductionFactor))}),e._quotaReductionPromise.always(function(){e._quotaReductionPromise=null})),e._quotaReductionPromise.then(function(){return e._put(b,f)});throw a;}).then(function(){e._gcCounter--;
0>e._gcCounter&&(e._gcCounter=e.gcFrequency,e._getCacheSize().then(function(a){return e._removeLeastRecentlyAccessed(a-e.maxByteSize)}))})};g.prototype.get=function(c){var e=this;return null==this._db?a.resolve(null):a.resolve().then(function(){var a=e._db.transaction(e._storeName,"readonly").objectStore(e._storeName).get(c);return b(a)}).then(function(a){null==a?++e._miss:(++e._hit,e._db.transaction("last_access","readwrite").objectStore("last_access").put({date:(new Date).getTime(),byteSize:a.byteSize},
c));return a}).catch(function(a){++e._miss;return null})};g.prototype.remove=function(b){var c=this;return null==this._db?a.resolve():a.resolve().then(function(){var a=c._db.transaction([c._storeName,"last_access"],"readwrite"),e=a.objectStore(c._storeName),d=a.objectStore("last_access");e.delete(b);d.delete(b);return f(a)})};g.prototype._put=function(a,b){var c=this._db.transaction([this._storeName,"last_access"],"readwrite");c.objectStore(this._storeName).put(b,a);c.objectStore("last_access").put({date:(new Date).getTime(),
byteSize:b.byteSize},a);return f(c)};g.prototype._removeLeastRecentlyAccessed=function(a){if(!(0>=a)){var b=this._db.transaction([this._storeName,"last_access"],"readwrite"),c=b.objectStore(this._storeName),e=b.objectStore("last_access"),d=0,g=e.index("date").openCursor(null,"next");g.onsuccess=function(b){b=g.result;null!=b&&(null!=b.value.byteSize&&(d+=b.value.byteSize),c.delete(b.primaryKey),e.delete(b.primaryKey),d<a&&b.continue())};return f(b)}};g.prototype._getCacheSize=function(){var a=this._db.transaction("last_access"),
b=0,c=a.objectStore("last_access").index("byteSize").openKeyCursor();c.onsuccess=function(a){if(a=c.result){var d=a.key;null!=d&&(b+=d);a.continue()}};return f(a).then(function(){return b})};return g}();g.IDBCache=n;g.whenTransaction=f;g.whenRequest=b})},"esri/views/3d/layers/SceneLayerGraphicsView3D":function(){define("require exports ../../../core/tsSupport/declareExtendsHelper ../../../core/tsSupport/decorateHelper ../../../Graphic ../../../core/Handles ../../../core/has ../../../core/Logger ../../../core/PooledArray ../../../core/promiseUtils ../../../core/watchUtils ../../../core/accessorSupport/decorators ../../../core/libs/rbush/PooledRBush ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/contains ../../../layers/graphics/dehydratedFeatures ../../../layers/graphics/controllers/I3SOnDemandController ../../../renderers/support/renderingInfoUtils ./LayerView3D ./graphics/Graphics3DFeatureLikeLayerView ./graphics/Graphics3DVerticalScale ./i3s/I3SQueryEngine ./i3s/I3SUtil ./support/layerViewUpdatingProperties ../lib/gl-matrix ../support/EventedArray ../support/orientedBoundingBox ../support/projectionUtils".split(" "),
function(n,g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K){var N=e.getLogger("esri.views.3d.layers.SceneLayerGraphicsView3D");n=function(e){function g(a){a=e.call(this)||this;a._nodesAddedToStage={};a._handles=new b;a.overlayUpdating=!1;a.supportsDraping=!0;a._queryEngine=null;a._memCache=null;a._usedMemory=0;a.loadedGraphics=new F;a.supportsHeightUnitConversion=!0;a._coordinatesOutsideExtentErrors=0;a._maxCoordinatesOutsideExtentErrors=20;a._definitionExpressionErrors=0;a._maxDefinitionExpressionErrors=
20;return a}c(g,e);g.prototype.initialize=function(){var a=this;C.checkSpatialReferences(this.layer,this.view.spatialReference,this.view.viewingMode);this._handles.add([k.init(this.layer,"rangeInfos",function(b){return a._rangeInfosChanged(b)}),this.layer.watch("renderer",function(b,c){return a._rendererChange(b,c)}),this.layer.watch("objectIdFilter",function(){return a._objectIdFilterChange()}),this.watch("_controller.parsedDefinitionExpression",function(){return a._definitionExpressionChange()})]);
this.graphics3d=new x({owner:this,layer:this.layer,asyncGraphicsUpdates:!0,frustumVisibilityEnabled:!1,elevationAlignmentEnabled:!0,elevationFeatureExpressionEnabled:!1,suspendResumeExtentMode:"data",dataExtent:this.layer.fullExtent,updateClippingExtent:function(b){return a._updateClippingExtent(b)},queryGraphicUIDsInExtent:function(b,c,d){return a._queryGraphicUIDsInExtent(b,c,d)}});this.supportsHeightUnitConversion&&(this._verticalScale=new B({sourceSpatialReference:this.layer.spatialReference,
destSpatialReference:this.view.spatialReference}));this.addResolvingPromise(this.graphics3d.setup());this.drawingOrder=this.view.getDrawingOrder(this.layer.uid);this._memCache=this.view.resourceController.getMemCache(this.layer.uid);this._controller=new v({layerView:this});this.when(function(){a._handles.add(a.graphics3d.graphicsCore.watch("maxNumberOfFeatures",function(b){a._controller.featureTarget=b}));a._handles.add(k.init(a,"suspended",function(b){b&&a._removeAllNodeData()}))})};g.prototype.destroy=
function(){this.graphics3d&&(this.graphics3d.destroy(),this.graphics3d=null);this._controller&&(this._controller.destroy(),this._controller=null);this._memCache.destroy();this._nodesAddedToStage=this._elevationUpdateNodes=this._memCache=null;this._usedMemory=0;this._handles&&(this._handles.destroy(),this._handles=null)};Object.defineProperty(g.prototype,"displayLimitExceeded",{get:function(){return this.suspended?!1:!!this._controller&&!this._controller.leafsReached},enumerable:!0,configurable:!0});
g.prototype.whenGraphicAttributes=function(a,b){var c=this;return C.whenGraphicAttributes(this.layer,[a],this._getObjectIdField(),b,function(){var b=c._findGraphicNodeAndIndex(a);return{node:b.node,indices:[b.index]}},{ignoreUnavailableFields:!0,populateObjectId:!0}).then(function(a){return a[0]})};g.prototype.getGraphicFromGraphicUid=function(a){if(!this.loadedGraphics)return m.reject();var b=t.hydrateGraphic(this.loadedGraphics.find(function(b){return b.uid===a}),this.layer),c=this._getObjectIdField();
if(!b||!b.attributes||!b.attributes[c])return m.reject();b.layer=this.layer;b.sourceLayer=this.layer;return m.resolve(b)};g.prototype.whenGraphicBounds=function(a,b){return this.graphics3d.graphicsCore.whenGraphicBounds(a,b)};g.prototype.canResume=function(){return this.inherited(arguments)&&(!this._controller||this._controller.rootNodeVisible)};g.prototype.isUpdating=function(){return this.overlayUpdating||this._controller&&this._controller.updating||!this.graphics3d.destroyed&&this.graphics3d.updating};
g.prototype.getRenderingInfo=function(a){if((a=A.getRenderingInfo(a,{renderer:this.layer.renderer}))&&a.color){var b=a.color;b[0]/=255;b[1]/=255;b[2]/=255}return a};Object.defineProperty(g.prototype,"symbolUpdateType",{get:function(){return this.graphics3d.graphicsCore.symbolUpdateType},enumerable:!0,configurable:!0});g.prototype._findGraphicNodeAndIndex=function(a){a=a.attributes[this.layer.objectIdField];for(var b=0,c=Object.keys(this._nodesAddedToStage);b<c.length;b++){var d=c[b],e=this._findGraphicIndex(this._nodesAddedToStage[d].bundle,
a);if(0<=e)return{node:this._controller.nodeIndex[d],index:e}}return null};g.prototype._forAllFeatures=function(a,b){for(var c=0,d=Object.keys(this._nodesAddedToStage);c<d.length;c++){for(var e=d[c],f=this._nodesAddedToStage[e].bundle,g=0;g<f.length;g++)for(var h=f[g].graphics,k=0;k<h.length;k++){var l=h[k],m=f[g].featureIds[k];l.visible&&a(m,g,l)}null!=b&&b({nodeId:e})}};g.prototype._getGraphicIndices=function(a,b){a=this._nodesAddedToStage[a];for(var c=this._getObjectIdField(),d=[],e=0;e<b.length;e++){var f=
this._findGraphicIndex(a.bundle,b[e].attributes[c]);0<=f&&d.push(f)}return d};g.prototype._findGraphicIndex=function(a,b){for(var c=0;c<a.length;c++)for(var d=0,e=a[c].featureIds;d<e.length;d++)if(e[d]===b)return c;return-1};g.prototype._queryGraphicUIDsInExtent=function(a,b,c){if(this._controller){var d=this._controller.crsIndex;K.boundingRectToBoundingRect(a,b,T,d);var e=V;p.fromRect(e,T);e[2]=-Infinity;e[5]=Infinity;null==this._elevationUpdateNodes&&(this._elevationUpdateNodes=new h({initialSize:10}));
var f=this._elevationUpdateNodes;f.clear();this._controller.updateElevationChanged(e,d,f);for(d=0;d<f.length;d++){var g=this._nodesAddedToStage[f.data[d].id];if(null!=g){if(!g.spatialIndex&&g.bundle.length>=M){for(var k=new q.PooledRBush(9,l("csp-restrictions")?function(a){return{minX:a.extent[0],minY:a.extent[1],maxX:a.extent[2],maxY:a.extent[3]}}:[".extent[0]",".extent[1]",".extent[2]",".extent[3]"]),m=O.length=0,n=g.bundle;m<n.length;m++){for(var u=n[m],v=r.empty(),x=0,z=u.graphics;x<z.length;x++)e=
z[x],t.expandAABR(e.geometry,v);u.extent=v;O.push(u)}k.load(O);g.spatialIndex=k}if(g.spatialIndex)e=T,K.boundingRectToBoundingRect(a,b,T,this.view.spatialReference),U.minX=e[0],U.minY=e[1],U.maxX=e[2],U.maxY=e[3],g.spatialIndex.search(U,function(a){var b=0;for(a=a.graphics;b<a.length;b++)c(a[b].uid)});else for(k=0,g=g.bundle;k<g.length;k++)for(u=g[k],m=0,u=u.graphics;m<u.length;m++)e=u[m],c(e.uid)}}}};g.prototype.highlight=function(a,b){return this.graphics3d.highlight(a,b,this.layer.objectIdField)};
g.prototype.addNodeData=function(a,b){var c=b.allGeometryData,d=b.attributeDataInfo,e=this._controller.crsIndex;b=this.view.spatialReference;var g=[0,0,0],h=this._getObjectIdField();a.memory=4096;null==this._nodesAddedToStage[a.id]&&(this._nodesAddedToStage[a.id]={bundle:[],attributeData:d?d.attributeData:null,loadedAttributes:d?d.loadedAttributes:null});var k=[];this._nodesAddedToStage[a.id].bundle=k;if(d=this.layer.fullExtent)d=this.layer.fullExtent.clone(),d.xmin-=.5,d.ymin-=.5,d.xmax+=.5,d.ymax+=
.5,d.hasZ&&(d.zmin-=.5,d.zmax+=.5),d.hasM&&(d.mmin-=.5,d.mmax+=.5);for(var l=d,d=[],n=[],p=0;p<c.length;p++){var q=c[p],r=q.featureDataPosition,v=r.length,x=q.geometries||[H[v]],z=q.featureIds;l&&!u.extentContainsCoords3D(l,r)&&(this._coordinatesOutsideExtentErrors<this._maxCoordinatesOutsideExtentErrors&&N.error("Service Error: Coordinates outside of layer extent"),this._coordinatesOutsideExtentErrors+1===this._maxCoordinatesOutsideExtentErrors&&N.error("Maximum number of errors reached. Further errors are ignored."),
this._coordinatesOutsideExtentErrors++);for(var A=0;A<x.length;A++){var w=x[A];if("points"===w.params.type){var B=[],C=z[A<z.length?A:0],D={};null!=C&&(D[h]=C);C=void 0;"Embedded"===w.type&&(C=w.params.vertexAttributes.position);for(w=0;w<C.length;w+=v){for(var E=0;E<v;E++)g[E]=r[E]+C[w+E];K.bufferToBuffer(g,e,0,J,b,0,1);E=t.makeDehydratedPoint(J[0],J[1],J[2],b);3>v&&(E.z=void 0);B.push({uid:f.generateUID(),geometry:E,attributes:D,visible:!0});a.obb||n.push(E.x,E.y,E.z?E.z:0)}a.memory+=16*C.length;
d.push.apply(d,B);k.push({featureIds:q.featureIds,graphics:B})}}}a.numFeatures=d.length;c=this._nodesAddedToStage[a.id];this._setBundleAttributes(c.bundle,c.loadedAttributes,c.attributeData);0<n.length&&(e=this.view.renderSpatialReference,g=this._controller.crsVertex,K.bufferToBuffer(n,b,0,n,e,0,n.length/3),a.obb=I.compute({data:n,size:3,offsetIdx:0,strideIdx:3}),K.vectorToVector(a.obb.center,e,a.obb.center,g),this._controller.updateVisibility(a.id));if(!this._controller.isGeometryVisible(a))return this._memCache.put(a.id,
this._nodesAddedToStage[a.id],a.memory),delete this._nodesAddedToStage[a.id],m.resolve();this._verticalScale&&this._verticalScale.adjust(d);this._usedMemory+=a.memory;this.loadedGraphics.addMany(d);this._filterNode(c);return m.resolve()};g.prototype.isNodeLoaded=function(a){return null!=this._nodesAddedToStage[a.id]};g.prototype._removeAllNodeData=function(){var a=this;Object.keys(this._nodesAddedToStage).forEach(function(b){var c=a._nodesAddedToStage[b];c&&a._memCache.put(b,c,a._controller.nodeIndex[b].memory)});
this._nodesAddedToStage={};this._usedMemory=0;this.loadedGraphics.clear()};g.prototype.removeNodeData=function(a){var b=this,c=[];a.forEach(function(a){var d=b._removeNodeStageData(a,c);d&&b._memCache.put(a.id,d,a.memory)});this.loadedGraphics.removeUnorderedMany(c)};g.prototype._removeNodeStageData=function(a,b){var c=this._nodesAddedToStage[a.id];if(!c)return null;for(var d=0,e=c.bundle;d<e.length;d++)b.push.apply(b,e[d].graphics);delete this._nodesAddedToStage[a.id];this._usedMemory-=a.memory;
return c};g.prototype.loadCachedNodeData=function(a,b){return m.resolve(this._memCache.pop(a.id))};g.prototype.addCachedNodeData=function(a,b,c){for(var d=[],e=0,f=b.bundle;e<f.length;e++)d.push.apply(d,f[e].graphics);this._nodesAddedToStage[a.id]=b;this.setAttributeData(a,c.loadedAttributes,c.attributeData);this._usedMemory+=a.memory;this.loadedGraphics.addMany(d);this._filterNode(b);return m.resolve()};g.prototype.getLoadedNodeIDs=function(){return Object.keys(this._nodesAddedToStage)};g.prototype.getLoadedAttributes=
function(a){if(a=this._nodesAddedToStage[a.id])return a.loadedAttributes};g.prototype.getAttributeData=function(a){if(a=this._nodesAddedToStage[a.id])return a.attributeData};g.prototype.setAttributeData=function(a,b,c){if(a=this._nodesAddedToStage[a.id])a.loadedAttributes=b,a.attributeData=c,this._setBundleAttributes(a.bundle,b,c),this._filterNode(a),this.graphics3d.graphicsCore.labelsEnabled&&(b=a.bundle.map(function(a){return a.graphics.length&&a.graphics[0].uid}),this.graphics3d.graphicsCore.updateLabelingInfo(b))};
g.prototype._setBundleAttributes=function(a,b,c){for(var d=0;d<a.length;d++)for(var e=0,f=a[d].graphics;e<f.length;e++){var g=f[e];g.attributes||(g.attributes={});if(b)for(var h=0,k=b;h<k.length;h++){var l=k[h].name;c[l]&&(g.attributes[l]=C.getCachedAttributeValue(c[l],d))}}};g.prototype._updateClippingExtent=function(a){this._controller&&this._controller.updateClippingArea(a);return!1};g.prototype._getObjectIdField=function(){return this.layer.objectIdField||"OBJECTID"};g.prototype._rendererChange=
function(a,b){var c=a?a.requiredFields:[],d=b?b.requiredFields:[];c.length===d.length&&c.every(function(a,b){return c[b]===d[b]})||this._reloadAllNodes()};g.prototype._rangeInfosChanged=function(a){null!=a&&0<a.length&&N.warn("Unsupported property: rangeInfos are currently only serialized to and from web scenes but do not affect rendering.")};g.prototype._objectIdFilterChange=function(){var a=this;Object.keys(this._nodesAddedToStage).forEach(function(b){return a._filterNode(a._nodesAddedToStage[b])})};
g.prototype._reloadAllNodes=function(){this._removeAllNodeData();this._controller&&this._controller.restartNodeLoading()};g.prototype._definitionExpressionChange=function(){this._definitionExpressionErrors=0};g.prototype._evaluateClause=function(a,b){try{return!!a.calculateValue(b)}catch(aa){return this._definitionExpressionErrors<this._maxDefinitionExpressionErrors&&N.error("Error while evaluating definitionExpression: "+aa),this._definitionExpressionErrors++,this._definitionExpressionErrors===this._maxDefinitionExpressionErrors&&
N.error("Further errors are ignored"),!1}};g.prototype._filterNode=function(a){var b=this._getObjectIdField(),c=null;if(this.layer.objectIdFilter)var d=this.layer.objectIdFilter.ids,e="include"===this.layer.objectIdFilter.method,c=function(a){return 0<=d.indexOf(a)===e};var f=this._controller.parsedDefinitionExpression,g=0;for(a=a.bundle;g<a.length;g++)for(var h=0,k=a[g].graphics;h<k.length;h++){var l=k[h],m=l.visible;c&&!c(l.attributes[b])?l.visible=!1:l.visible=f?this._evaluateClause(f,l):!0;m!==
l.visible&&(P.graphic=l,P.property="visible",P.oldValue=m,P.newValue=l.visible,this.layer.graphicChanged(P))}};g.prototype.queryExtent=function(a){return this._ensureQueryEngine().queryExtent(a)};g.prototype.queryFeatureCount=function(a){return this._ensureQueryEngine().queryFeatureCount(a)};g.prototype.queryFeatures=function(a){return this._ensureQueryEngine().queryFeatures(a)};g.prototype.queryObjectIds=function(a){return this._ensureQueryEngine().queryObjectIds(a)};g.prototype._ensureQueryEngine=
function(){this._queryEngine||(this._queryEngine=this._createQueryEngine());return this._queryEngine};g.prototype._createQueryEngine=function(){var a=this,b={id:0,index:0,graphic:null},c=this;return new D(this.layer,{forAll:function(c,d){a._forAllFeatures(function(a,d,e){b.id=a;b.index=d;b.graphic=e;c(b)},d)},createGraphic:function(a){return t.hydrateGraphic(a.graphic,c.layer)},requestFields:function(b,c,d){return C.whenGraphicAttributes(a.layer,c,a._getObjectIdField(),d,function(){var d=a._getGraphicIndices(b.nodeId,
c);return{node:a._controller.nodeIndex[b.nodeId],indices:d}},{ignoreUnavailableFields:!1})},createExtentBuilder:function(){var b=p.empty(),c=a.layer.spatialReference;return{add:function(a){return t.expandAABB(a.graphic.geometry,b)},getExtent:function(){return p.toExtent(b,c)}}}},{enableObjectId:!0,enableOutFields:!!this.layer.objectIdField})};g.prototype.getUsedMemory=function(){var a=this._usedMemory;this._controller&&(a+=512*Object.keys(this._controller.nodeIndex).length);return a};g.prototype.getUnloadedMemory=
function(){return this._controller?this._controller.getUnloadedMemoryEstimate():0};g.prototype.getStats=function(){var a=this.inherited(arguments)||{};a.index=this._controller?Object.keys(this._controller.nodeIndex).length:0;a.nodes=Object.keys(this._nodesAddedToStage).length;a.features=this.loadedGraphics.length;this._controller&&this._controller.updateStats(a);return a};a([d.property()],g.prototype,"graphics3d",void 0);a([d.property()],g.prototype,"drawingOrder",void 0);a([d.property({aliasOf:"graphics3d.graphicsCore.hasDraped"})],
g.prototype,"hasDraped",void 0);a([d.property({type:Boolean})],g.prototype,"overlayUpdating",void 0);a([d.property({type:Boolean})],g.prototype,"supportsDraping",void 0);a([d.property()],g.prototype,"loadedGraphics",void 0);a([d.property()],g.prototype,"layer",void 0);a([d.property()],g.prototype,"_controller",void 0);a([d.property({dependsOn:["_controller.updating","graphics3d.updating","overlayUpdating"]})],g.prototype,"updating",void 0);a([d.property({dependsOn:["_controller.rootNodeVisible"]})],
g.prototype,"suspended",void 0);a([d.property(G.updatingPercentage)],g.prototype,"updatingPercentage",void 0);a([d.property({aliasOf:"_controller.updatingPercentage"})],g.prototype,"updatingPercentageValue",void 0);a([d.property({dependsOn:["suspended","_controller.leafsReached"]})],g.prototype,"displayLimitExceeded",null);return g=a([d.subclass("esri.views.3d.layers.SceneLayerGraphicsView3D")],g)}(d.declared(z));var H={2:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0]}}},
3:{type:"Embedded",params:{type:"points",vertexAttributes:{position:[0,0,0]}}}},M=100,T=r.create(),V=p.create(p.POSITIVE_INFINITY),U={minX:0,minY:0,maxX:0,maxY:0},J=E.vec3d.create(),O=[],P={graphic:null,property:null,oldValue:null,newValue:null};return n})},"esri/views/3d/support/EventedArray":function(){define(["require","exports","../../../core/tsSupport/extendsHelper","../../../core/PooledArray","./Evented"],function(n,g,c,a,f){return function(b){function f(){var c=null!==b&&b.apply(this,arguments)||
this;c.array=new a;return c}c(f,b);f.prototype.clear=function(){0<this.array.length&&this.emit("change",{added:[],removed:this.toArray()});this.array.clear()};Object.defineProperty(f.prototype,"length",{get:function(){return this.array.length},enumerable:!0,configurable:!0});f.prototype.getItemAt=function(a){return this.array.data[a]};f.prototype.push=function(a){var b=this.array.push(a);this.emit("change",{added:[a],removed:[]});return b};f.prototype.addMany=function(a){var b=this.array.pushArray(a);
this.emit("change",{added:a,removed:[]});return b};f.prototype.pushNew=function(){var a=this.array.pushNew();this.emit("change",{added:[a],removed:[]});return a};f.prototype.pop=function(){var a=this.array.pop();void 0!==a&&this.emit("change",{added:[],removed:[a]});return a};f.prototype.removeMany=function(a){a=this.array.removeMany(a);0<a.length&&this.emit("change",{added:[],removed:a});return a};f.prototype.removeUnordered=function(a){a=this.array.removeUnordered(a);void 0!==a&&this.emit("change",
{added:[],removed:[a]});return a};f.prototype.removeUnorderedMany=function(a){a=this.array.removeUnorderedMany(a);0<a.length&&this.emit("change",{added:[],removed:a});return a};f.prototype.toArray=function(){return this.array.toArray()};f.prototype.some=function(a,b){return this.array.some(a,b)};f.prototype.find=function(a,b){return this.array.find(a,b)};f.prototype.filter=function(a,b,c){c=c||new f;this.array.filter(a,b,c.array);return c};f.prototype.forEach=function(a,b){this.array.forEach(a,b)};
return f}(f.Evented)})},"*now":function(n){n(['dojo/i18n!*preload*esri/views/nls/SceneView*["ar","ca","cs","da","de","el","en-gb","en-us","es-es","fi-fi","fr-fr","he-il","hu","it-it","ja-jp","ko-kr","nl-nl","nb","pl","pt-br","pt-pt","ru","sk","sl","sv","th","tr","zh-tw","zh-cn","ROOT"]'])},"*noref":1}});
define("require exports ../core/tsSupport/declareExtendsHelper ../core/tsSupport/decorateHelper ../core/tsSupport/generatorHelper ../core/tsSupport/awaiterHelper dojo/dom dojo/when ../Camera ../geometry ../Graphic ../Viewpoint ../core/asyncUtils ../core/Error ../core/Handles ../core/has ../core/lang ../core/Logger ../core/promiseUtils ../core/scheduling ../core/watchUtils ../core/accessorSupport/decorators ../core/accessorSupport/watch ../geometry/HeightModelInfo ../geometry/support/aaBoundingRect ../geometry/support/scaleUtils ../geometry/support/webMercatorUtils ./BreakpointsOwner ./DOMContainer ./View ./ViewAnimation ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/Deconflictor ./3d/layers/graphics/Labeler ./3d/layers/support/FeatureTileTree3D ./3d/layers/support/FeatureTileTree3DDebugger ./3d/lib/gl-matrix ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/projectionUtils ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Selector ./support/screenshotUtils ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment".split(" "),function(n,
g,c,a,f,b,l,e,h,m,k,d,q,p,r,u,t,v,A,z,x,B,D,C,G,E,F,I,K,N,H,M,T,V,U,J,O,P,R,Q,L,S,aa,ea,Z,da,W,ja,ca,ba,ha,fa,ia,X,ma,oa,ka,w,Aa,ya,na,qa){var sa=v.getLogger("esri.views.SceneView");g=function(g){function v(a){a=g.call(this)||this;a._layerViewsUpdatingHandles={};a._clippingArea=null;a._internallyReady=!1;a._userClippingArea=null;a._initialDefaultSpatialReference=null;a._defaults={};a._externallySet={environment:!1};a._handles=new r;a._createGraphicsViewPromise=null;a._updateUpdatingMonitorsHandle=
null;a._mapLayersChangeHandle=null;a._updateDrawingOrderHandle=null;a._stageFrameTask=null;a.onViewExtentUpdateHandle=null;a._resolveWhenReady=[];a.resourceController=new fa(a);a.deconflictor=new J(a);a.labeler=new O.Labeler({view:a});a.renderSpatialReference=null;a.sharedSymbolResources=null;a.basemapTerrain=null;a.elevationProvider=null;a.camera=null;a.canvas=null;a.center=null;a.constraints=new M.default;a.extent=null;a.fullOpacity=1;a.graphicsView=null;a.map=null;a.screenSizePerspectiveEnabled=
!0;a.state=null;a.scale=null;a.isHeightModelInfoRequired=!0;a.alphaCompositingEnabled=!1;a.supersampleScreenhotsEnabled=!0;a.type="3d";a.ui=new na;a.updating=!1;a.updatingPercentage=0;a.viewpoint=null;a.zoom=null;a.highlightOptions=new W;x.when(a,"ready",a._viewReadyHandler.bind(a));a._evaluateUpdating=a._evaluateUpdating.bind(a);a.watch("map",function(a){a&&a.load&&a.load()});a.inputManager=new U({view:a});a.stateManager=new S.ViewStateManager({view:a});return a}c(v,g);v.prototype.getDefaults=function(a){var b=
this.inherited(arguments);b.environment||a.environment||(this._defaults.environment=new T,b.environment=this._defaults.environment);return b};v.prototype.initialize=function(){var a=this;this.environmentManager=new V.default({view:this});this._updateUpdatingMonitorsHandle=this.allLayerViews.on("change",this._updateUpdatingMonitors.bind(this));this._updateUpdatingMonitors({added:this.allLayerViews.toArray(),removed:[]});x.whenNot(this,"ready",this._viewUnreadyHandler.bind(this));this.resourceController.memoryEvents.on("updating-changed",
function(){return a._evaluateUpdating()});x.init(this.qualitySettings,"gpuMemoryLimit",function(b){a.resourceController&&(a.resourceController.maxGpuMemory=b)});x.init(this.qualitySettings,"additionalCacheMemory",function(b){a.resourceController&&(a.resourceController.additionalCacheMemory=b)});x.init(this.qualitySettings,"frameRate",function(a){z.setFrameRate(a)});x.init(Z,"SCENEVIEW_LOCKING_LOG",function(b){a.defaultsFromMap.logDebugInformation=b})};v.prototype.destroy=function(){this.activeTool=
null;D.dispatchTarget(this);this.environmentManager.destroy();this._disposeGraphicsView();this._updateUpdatingMonitorsHandle.remove();this._updateUpdatingMonitorsHandle=null;this._handles.removeAll();this.inputManager&&(this.inputManager.destroy(),this._set("inputManager",null))};Object.defineProperty(v.prototype,"activeTool",{set:function(a){if(a&&!this.ready)sa.error("#activeTool\x3d","cannot set active tool while view is not ready");else{var b=this._get("activeTool");a!==b&&(b&&b.deactivate(),
this._set("activeTool",a),a&&a.activate())}},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"clippingArea",{get:function(){if("global"===this.viewingMode)return null;if(this._userClippingArea)return this._userClippingArea;var a=this.get("map.clippingEnabled"),b=this.get("map.clippingArea");if(!a||!b)return this._clippingArea=null;if(!(b instanceof m.Extent))return sa.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(F.canProject(b.spatialReference,
this.spatialReference))b=F.project(b,this.spatialReference);else return sa.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;return this._clippingArea&&b&&this._clippingArea.equals(b)?this._clippingArea:this._clippingArea=b},set:function(a){this.ready&&"global"===this.viewingMode&&a?sa.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):(this._userClippingArea=a,this.notifyChange("clippingArea"))},enumerable:!0,configurable:!0});
Object.defineProperty(v.prototype,"dataExtent",{get:function(){var a=[],b=this.spatialReference||m.SpatialReference.WGS84,c=this.clippingArea;c&&(c=F.project(c,b));var d=function(d){d&&(d=F.project(d,b))&&(c&&(d=d.intersection(c)),d&&a.push(d))},e=this._get("basemapTerrain");e&&e.spatialReference&&d(new m.Extent({xmin:e.extent[0],ymin:e.extent[1],zmin:0,xmax:e.extent[2],ymax:e.extent[3],zmax:0,spatialReference:e.spatialReference}));this.map&&this.map.allLayers.forEach(function(a){d(a.fullExtent)});
return 0<a.length?(e=a.reduce(function(a,b){return a.union(b)}),e.hasZ?(e.zmin=Math.min(0,e.zmin),e.zmax=Math.max(0,e.zmax)):(e.zmin=0,e.zmax=0),e):new m.Extent({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0,spatialReference:b})},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"environment",{set:function(a){a!==this._defaults.environment&&(this._externallySet.environment=!0);a?a instanceof T?this._set("environment",a):a instanceof qa?(this.environment.lighting=a.lighting,this.environment.background=
t.clone(a.background),this.environment.atmosphereEnabled=a.atmosphereEnabled,this.environment.starsEnabled=a.starsEnabled):a.declaredClass?this._set("environment",a):this._set("environment",new T(a)):this._set("environment",new T)},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"groundExtent",{get:function(){var a=this._get("basemapTerrain");if(a&&a.spatialReference){var b=a.extent;return new m.Extent({xmin:b[0],ymin:b[1],xmax:b[2],ymax:b[3],spatialReference:a.spatialReference})}return new m.Extent({spatialReference:this.spatialReference||
m.SpatialReference.WGS84})},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"initialExtentRequired",{get:function(){return!this.stateManager.hasInitialView},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"interacting",{get:function(){return!!this.state&&this.state.interacting},enumerable:!0,configurable:!0});v.prototype._mapSetter=function(a){a!==this._get("map")&&(this._mapLayersChangeHandle&&(this._mapLayersChangeHandle.remove(),this._mapLayersChangeHandle=null),
a&&(this._mapLayersChangeHandle=a.allLayers.on("change",this.notifyChange.bind(this,"dataExtent"))),this.inherited(arguments))};Object.defineProperty(v.prototype,"qualityProfile",{get:function(){return this._get("qualityProfile")||da.getDefaultProfile()},set:function(a){da.isValidProfile(a)&&(da.apply(a,this.qualitySettings),this._set("qualityProfile",a))},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"slicePlane",{set:function(a){this._stage.setRenderParams({slicePlane:a});this._set("slicePlane",
a)},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"resolution",{get:function(){return null!=this.spatialReference?E.getResolutionForScale(this.scale,this.spatialReference):0},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"heightModelInfo",{get:function(){var a=this.getDefaultHeightModelInfo();return null!=a?C.deriveUnitFromSR(a,this.spatialReference):null},enumerable:!0,configurable:!0});Object.defineProperty(v.prototype,"viewingMode",{get:function(){var a=
this.get("map.initialViewProperties.viewingMode"),b=this.spatialReference;a||(a=!b||b.isWebMercator||b.isWGS84?"global":"local");return a},set:function(a){this._internallyReady?sa.error("#viewingMode","viewingMode cannot be set once view is ready"):0<=["local","global"].indexOf(a)?this._override("viewingMode",a):void 0===a&&this._clearOverride("viewingMode")},enumerable:!0,configurable:!0});v.prototype.on=function(a,b,c){var d=this.inputManager.viewEvents.register(a,b,c);return d?d:this.inherited(arguments)};
v.prototype.hasEventListener=function(a){return this.inherited(arguments)||this.inputManager&&this.inputManager.viewEvents.hasHandler(a)};v.prototype.toMap=function(a,b,c){if(!this.ready)return sa.error("#toMap()","Scene view cannot be used before it is ready"),null;var d;"number"===typeof a?(d=a,a=b):(d=a.x,a=a.y,c=b);b=this.sceneIntersectionHelper.pickSelectorInScreen([d,this.height-a]).minResult;return this._computeMapPointFromIntersectionResult(b,c)};v.prototype.toScreen=function(a,b,c,d){if(!this.ready)return sa.error("#toScreen()",
"Scene view cannot be used before it is ready"),null;"number"===typeof a?("object"===typeof c&&(d=c),ca.vectorToVector([a,b,"number"===typeof c?c:0],this.spatialReference,ta,this.renderSpatialReference)):(ca.pointToVector(a,ta,this.renderSpatialReference),d=b);return this.engineToScreen(ta,d)};v.prototype.pixelSizeAt=function(a,b){if(!this.ready)return sa.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if("number"===typeof a){if(a=this.sceneIntersectionHelper.pickSelectorInScreen([a,
this.height-b]).minResult,!a.getIntersectionPoint(ta))return 0}else if(a instanceof m.Point)ca.pointToVector(a,ta,this.renderSpatialReference);else if(a=this.sceneIntersectionHelper.pickSelectorInScreen([a.x,this.height-a.y]).minResult,!a.getIntersectionPoint(ta))return 0;return this.state.camera.computePixelSizeAt(ta)};v.prototype.hitTest=function(a,b){if(!this.ready)return sa.error("#hitTest()","Scene view cannot be used before it is ready"),null;var c,d;"number"===typeof a?(c=a,d=b):(c=a.x,d=a.y);
var f=this.sceneIntersectionHelper.pickSelectorInScreen([c,this.height-d],null,null,!0);a=f.minResult;var g=this._computeMapPointFromIntersectionResult(a);b=null;if(a.target)switch(a.target.type){case "stage":b=this._getGraphicFromStageObject(a.target.obj,a.triangleNr);break;case "external":switch(a.intersector){case "PointRenderer":b=e(this._getGraphicFromPointRenderer(a.target));break;case "LodRenderer":b=this._getGraphicFromLodRenderer(a.target)}}return e(b).catch(function(){return null}).then(function(a){var b=
[];(a||g)&&b.push({mapPoint:g,graphic:a});a={screenPoint:new m.ScreenPoint({x:c,y:d}),results:b};Z.SCENEVIEW_HITTEST_RETURN_SELECTOR&&(a.selector=f);return a})};v.prototype.goTo=function(a,b){return this.stateManager.goTo(a,b)};v.prototype.takeScreenshot=function(a){var b=this;return this.whenReady().then(function(){return b._stage.takeScreenshot(Aa.toRenderSettings(a,b))})};v.prototype.destroyLayerViews=function(){for(var a in this._layerViewsUpdatingHandles)this._layerViewsUpdatingHandles[a].remove();
this._layerViewsUpdatingHandles={};this.stateManager.deinit();this._disposeSurface();this.inherited(arguments);this._stage&&(this._stage.dispose(),this._stage=null,this._handles.remove("stage"));this._set("canvas",null);this.labeler=null;this.deconflictor.destroy();this.deconflictor=null;this.resourceController.destroy();this.resourceController=null};v.prototype.getDefaultSpatialReference=function(){return this.get("map.initialViewProperties.spatialReference")||this.get("defaultsFromMap.spatialReference")||
this.get("defaultsFromMap.isSpatialReferenceDone")&&this._initialDefaultSpatialReference||null};v.prototype.validate=function(){var a=ya.check();u("safari")&&9>u("safari")&&(a=new p("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:u("safari")}));return a?(sa.warn("#validate()",a.message),A.reject(a)):A.resolve()};v.prototype.isSpatialReferenceSupported=function(a,b,c){var d=a.isGeographic,e=a.isWebMercator,
f=a.isWGS84,g="local"===this.viewingMode,h=!(!this._isOverridden("viewingMode")&&!this.get("map.initialViewProperties.viewingMode"));if(h){if(g&&d)return c&&c("Layer "+b.id+" is ignored because it is GCS and viewing mode is local"),!1;if(!g&&!e&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is not supported in global viewing mode"),!1}else if(d&&!f)return c&&c("Layer "+b.id+" is ignored because its spatial reference is geographic but not WGS84"),!1;if(b)if(oa.isTiledLayer(b)){if(d=
void 0,h?h=oa.getTiledLayerInfo(b,a,this.viewingMode):(h=oa.getTiledLayerInfo(b,a,"global"),null==h.tileInfo&&(h=oa.getTiledLayerInfo(b,a,"local"))),d=null!=h.tileInfo,!d)return c&&c("Layer "+b.id+" is ignored because it is tiled but\n            its tiling scheme is not supported or compatible with the viewing mode"),!1}else if((f||e)&&!g)return null==this._initialDefaultSpatialReference&&(this._initialDefaultSpatialReference=a),h||this._internallyReady||(this.viewingMode="global",c&&c("Viewing mode locked to global due to reprojectable layer "+
b.id)),c&&c("Layer "+b.id+" is ignored because it supports server-side reprojection"),!1;return!0};v.prototype.whenReady=function(){var a=this;return A.create(function(b){a._internallyReady?b(a):a._resolveWhenReady.push(b)})};v.prototype.engineToScreen=function(a,b){var c=Q.vec3d.create();this.state.camera.projectPoint(a,c);a=c[0];var d=this.height-c[1],c=c[2];return b?(b.x=a,b.y=d,b.z=c,b):new m.ScreenPoint({x:a,y:d,z:c})};v.prototype.flushDisplayModifications=function(){this._stage.processDirty()};
v.prototype.getDrawingOrder=function(a){return this.allLayerViews.findIndex(function(b){return b.layer&&b.layer.uid===a})};v.prototype.getViewForGraphic=function(a){return a.layer?this.allLayerViews.find(function(b){return b.layer===a.layer}):this.graphicsView};v.prototype.whenViewForGraphic=function(a){var b=this;return a.layer?this.whenLayerView(a.layer):this.graphicsView||this._createGraphicsViewPromise||0<this.graphics.length?x.whenOnce(this,"graphicsView").then(function(){return b.graphicsView}):
A.reject()};v.prototype._computeMapPointFromIntersectionResult=function(a,b){if(a.getIntersectionPoint(ta)){b=this._computeMapPointFromVec3d(ta,b);var c=this._get("basemapTerrain");"TerrainRenderer"===a.intersector&&c&&(a=c.getElevation(b),null!==a&&(b.z=a));return b}return null};v.prototype._computeMapPointFromVec3d=function(a,b){var c=this.spatialReference||m.SpatialReference.WGS84;ca.vectorToVector(a,this.renderSpatialReference,a,c)||(c=m.SpatialReference.WGS84,ca.vectorToVector(a,this.renderSpatialReference,
a,c));b?(b.x=a[0],b.y=a[1],b.z=a[2],b.spatialReference=c):b=new m.Point(a,c);return b};v.prototype._getGraphicFromStageObject=function(a,b){var c=a.getMetadata();if(null!=c&&null!=c.layerUid){if(this.graphicsView&&c.layerUid===this.graphicsView.mockLayerId)return this.graphicsView.getGraphicFromGraphicUid(a.metadata.graphicUid);if(c=this.map.findLayerByUid(c.layerUid))return this.whenLayerView(c).then(function(c){if(c&&!c.suspended){if(c.getGraphicFromStageObject)return c.getGraphicFromStageObject(a,
b);if(c.getGraphicFromGraphicUid&&null!=a.metadata.graphicUid)return c.getGraphicFromGraphicUid(a.metadata.graphicUid)}})}return null};v.prototype._getGraphicFromPointRenderer=function(a){var b=this._computeMapPointFromVec3d(a.point),b=new k(b);a=a.metadata.layerUid;null!=a&&b.set("layer",this.map.findLayerByUid(a));return b};v.prototype._getGraphicFromLodRenderer=function(a){var b=a.metadata;if(null!=b&&null!=b.layerUid){if(this.graphicsView&&b.layerUid===this.graphicsView.mockLayerId)return this.graphicsView.getGraphicFromGraphicUid(b.graphicUid);
if(a=this.map.findLayerByUid(b.layerUid))return this.whenLayerView(a).then(function(a){if(a&&!a.suspended)return a.getGraphicFromGraphicUid(b.graphicUid)})}return null};v.prototype._viewingModeToManifold=function(a){switch(a){case "global":return"spherical";case "local":return"planar"}};v.prototype._initBasemapTerrain=function(a){var b=this;this._disposeBasemapTerrain();this._set("basemapTerrain",new ma(this,this._viewingModeToManifold(a)));this._set("elevationProvider",new ea({view:this}));this.elevationProvider.register("ground",
this.basemapTerrain);this._handles.add([x.init(this,"map.ground.opacity",function(a){b.basemapTerrain.baseOpacity=null!=a?a:1}),x.init(this,"map.ground.surfaceColor",function(a){b.basemapTerrain.backgroundColor=a})],"basemapTerrain")};v.prototype._initGlobe=function(a){var b=this;this._initCoordinateSystem();this._initState();this._stage.setViewParams({backgroundColor:[0,0,0,0]});this._initBasemapTerrain(a);this._set("pointsOfInterest",new X.default({view:this}));this._set("featureTiles",new P.default({renderCoordsHelper:this.renderCoordsHelper,
cameraOnSurface:this.pointsOfInterest.cameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,filterExtent:null,resourceController:this.resourceController}));this._handles.add(this.featureTiles.watch("updating",function(){return b._evaluateUpdating()}));this._handles.add(x.init(Z,"FEATURE_TILE_TREE_SHOW_TILES",function(a){a&&b.featureTiles&&!b.featureTilesDebugger?b.featureTilesDebugger=new R.FeatureTileTree3DDebugger(b):!a&&b.featureTilesDebugger&&
(b.featureTilesDebugger.destroy(),b.featureTilesDebugger=null)}),"feature-tiles");this._handles.add(x.init(this,["clippingArea","basemapTerrain.extent"],function(){if(b.clippingArea||b.basemapTerrain.extent)if(b.basemapTerrain.extent&&b.basemapTerrain.spatialReference){var a=G.toExtent(b.basemapTerrain.extent,b.basemapTerrain.spatialReference);b.featureTiles.filterExtent=b.clippingArea?a.intersection(b.clippingArea):a}else b.featureTiles.filterExtent=b.clippingArea;else b.featureTiles.filterExtent=
null},!0),"feature-tiles");this._initStateManager()};v.prototype._initCoordinateSystem=function(){if(this.spatialReference){var a=this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(a)||this._set("mapCoordsHelper",new ja.default(this.map,a));var b="global"===this.viewingMode,a=b?ca.SphericalECEFSpatialReference:a;a!==this.renderSpatialReference&&(this.renderSpatialReference=a,this._set("renderCoordsHelper",ha.createRenderCoordsHelper(b?"global":"local",a)),this.sceneIntersectionHelper&&
this.sceneIntersectionHelper.setTolerance(w.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null),this.renderSpatialReference=null};v.prototype._evaluateUpdating=function(){var a=0,b=0,c=!1;this.allLayerViews.forEach(function(d){d.updating&&(c=!0,d=d.updatingPercentage,null!=d&&(++b,a+=d))});if(this._createGraphicsViewPromise||this.graphicsView&&this.graphicsView.updating||this.resourceController&&this.resourceController.updating||
this.featureTiles&&this.featureTiles.updating||this.labeler&&this.labeler.updating)c=!0;c!==this.updating&&this._set("updating",c);a=0!==b?a/b:c?100:0;this.updatingPercentage!==a&&this._set("updatingPercentage",a)};v.prototype._updateUpdatingMonitors=function(a){for(var b=0;b<a.removed.length;b++){var c=a.removed[b],d=this._layerViewsUpdatingHandles[c.uid];d&&(delete this._layerViewsUpdatingHandles[c.uid],c.destroyed||d.remove())}for(b=0;b<a.added.length;b++)c=a.added[b],c.destroyed||(d=c.watch(["updating",
"updatingPercentage"],this._evaluateUpdating),this._layerViewsUpdatingHandles[c.uid]=d);this._evaluateUpdating()};v.prototype._disposeSurface=function(){var a=function(a){a&&a.remove();return null};this._stageFrameTask=a(this._stageFrameTask);this._updateDrawingOrderHandle=a(this._updateDrawingOrderHandle);this.onViewExtentUpdateHandle=a(this.onViewExtentUpdateHandle);this._mapLayersChangeHandle=a(this._mapLayersChangeHandle);this.pointsOfInterest&&(this.pointsOfInterest.destroy(),this._set("pointsOfInterest",
null));this.featureTiles&&(this.featureTiles.destroy(),this._set("featureTiles",null));this._handles.remove("feature-tiles");this._disposeBasemapTerrain();this.environmentManager&&this.environmentManager.disposeRendering()};v.prototype._disposeBasemapTerrain=function(){var a=this._get("basemapTerrain");a&&(this._handles.remove("basemapTerrain"),a.destroy(),this._set("basemapTerrain",null))};v.prototype._initStage=function(){var a=this,b={};b.renderContext=this.renderContext;b.deactivatedWebGLExtensions=
this.deactivatedWebGLExtensions;b.viewingMode=this.viewingMode;b.alpha=this.alphaCompositingEnabled;b.supersampleScreenshots=this.supersampleScreenhotsEnabled;this.renderCanvas&&(b.canvas=this.renderCanvas);var c=new aa.SceneIntersectionHelper(this.viewingMode,{getPickableLayers:function(){var b=a._stage.getLayers(),c=[];Object.keys(b).forEach(function(a){a=b[a];a.isPickable&&c.push(a)});return c}},{camera:function(){return a.state.camera},extent:function(){return a.dataExtent},slicePlane:function(){return a.slicePlane}});
this._set("sceneIntersectionHelper",c);this._stage=new ka(this.viewingMode,l.byId(this.surface),b,c);this._handles.add(x.init(this.qualitySettings,"antialiasingEnabled",function(){a._stage.setRenderParams({antialiasingEnabled:a.qualitySettings.antialiasingEnabled})}),"stage");b=function(){a._stage.setRenderParams({defaultHighlightOptions:W.toEngineOptions(a.highlightOptions)})};this._handles.add(this.watch(["highlightOptions","highlightOptions.color","highlightOptions.haloOpacity","highlightOptions.fillOpacity"],
b),"stage");b();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(w.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.getCanvas());this._stageFrameTask=z.addFrameTask(this._stage.getFrameTask())};v.prototype._initSurface=function(){this._initStage();this._initGlobe(this.viewingMode);this.sharedSymbolResources=new ia.default({stage:this._stage,viewingMode:this.viewingMode,resourceController:this.resourceController,pointsOfInterest:this.pointsOfInterest,
viewState:this.state})};v.prototype._createGraphicsViewIfNeeded=function(){this.graphicsView||this._createGraphicsViewPromise||0===this.graphics.length||(this._handles.remove("graphics-view"),this._createGraphicsViewPromise=q.safeCast(this._createGraphicsViewAsync()),this._createGraphicsViewPromise.isFulfilled()&&(this._createGraphicsViewPromise=null),this._evaluateUpdating())};v.prototype._createGraphicsViewAsync=function(){return b(this,void 0,void 0,function(){var a;return f(this,function(b){switch(b.label){case 0:return[4,
A.create(function(a){return n(["./3d/layers/GraphicsView3D"],a)})];case 1:return a=b.sent(),[4,x.whenTrueOnce(this.basemapTerrain,"ready")];case 2:return b.sent(),this._set("graphicsView",new a({view:this})),this._layerViewsUpdatingHandles[this.graphicsView.mockLayerId]=x.init(this.graphicsView,"updating",this._evaluateUpdating),this._createGraphicsViewPromise=null,this._evaluateUpdating(),[2]}})})};v.prototype._disposeGraphicsView=function(){this._createGraphicsViewPromise&&(this._createGraphicsViewPromise.cancel(),
this._createGraphicsViewPromise=null);this._handles.remove("graphics-view");if(this.graphicsView){var a=this.graphicsView.mockLayerId;this._layerViewsUpdatingHandles[a].remove();delete this._layerViewsUpdatingHandles[a];this.graphicsView.destroy();this._set("graphicsView",null)}};v.prototype._initState=function(){this._set("state",new L.default({viewingMode:this.viewingMode,spatialReference:this.spatialReference}))};v.prototype._initStateManager=function(){this.stateManager.init()};v.prototype._viewReadyHandler=
function(a,b){var c=this;b||("global"===this.viewingMode&&(this._clippingArea=null),this._internallyReady=!0,this._initSurface(),this._handles.add(x.on(this,"graphics","change",function(){return c._createGraphicsViewIfNeeded()},function(){return c._createGraphicsViewIfNeeded()}),"graphics-view"),this._createGraphicsViewPromise&&this._handles.remove("graphics-view"),this._evaluateUpdating(),!this._externallySet.environment&&(a=this.get("map.initialViewProperties.environment"))&&(this.environment=a),
this._updateDrawingOrderHandle=this.allLayerViews.on("change",this._updateDrawingOrder.bind(this)),this._updateDrawingOrder(),this.labeler.setup(),this.environmentManager.updateReadyChange(!0),a=this._resolveWhenReady,this._resolveWhenReady=[],a.forEach(function(a){return a(c)}))};v.prototype._viewUnreadyHandler=function(a,b){b&&(this.activeTool&&(this.activeTool.deactivate(),this._set("activeTool",null)),this._initialDefaultSpatialReference=null,this.environmentManager.updateReadyChange(!1),this._disposeGraphicsView(),
this._internallyReady=!1,this.stateManager.deinit(),this._disposeSurface(),this.state.destroy(),this._set("state",null),this.sharedSymbolResources&&(this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null),this.labeler&&this.labeler.dispose(),this._stage&&(this._stage.dispose(),this._stage=null),this._handles.remove("stage"),this._set("canvas",null))};v.prototype._updateDrawingOrder=function(){var a=this.allLayerViews.length-1;this.allLayerViews.forEach(function(b,c){"drawingOrder"in
b&&(b.drawingOrder=a-c)})};a([B.property({value:null})],v.prototype,"activeTool",null);a([B.property({type:H,readOnly:!0,aliasOf:"state.animation"})],v.prototype,"animation",void 0);a([B.property({readOnly:!0})],v.prototype,"basemapTerrain",void 0);a([B.property({readOnly:!0})],v.prototype,"elevationProvider",void 0);a([B.property({type:h,aliasOf:"stateManager.camera"})],v.prototype,"camera",void 0);a([B.property({readOnly:!0})],v.prototype,"canvas",void 0);a([B.property({type:m.Point,aliasOf:"stateManager.center"})],
v.prototype,"center",void 0);a([B.property({type:m.Extent,dependsOn:["map.clippingArea?","map.clippingEnabled?","viewingMode"]})],v.prototype,"clippingArea",null);a([B.property({type:M.default})],v.prototype,"constraints",void 0);a([B.property({type:m.Extent,dependsOn:["basemapTerrain.extent","clippingArea","map"],readOnly:!0})],v.prototype,"dataExtent",null);a([B.property({value:null})],v.prototype,"environment",null);a([B.property()],v.prototype,"environmentManager",void 0);a([B.property({type:m.Extent,
aliasOf:"stateManager.extent"})],v.prototype,"extent",void 0);a([B.property({type:m.ScreenPoint,readOnly:!0,aliasOf:"stateManager.screenCenter"})],v.prototype,"screenCenter",void 0);a([B.property({aliasOf:"stateManager.frustum"})],v.prototype,"frustum",void 0);a([B.property({type:Number,readOnly:!0})],v.prototype,"fullOpacity",void 0);a([B.property({readOnly:!0})],v.prototype,"graphicsView",void 0);a([B.property({type:m.Extent,dependsOn:["basemapTerrain.extent"],readOnly:!0})],v.prototype,"groundExtent",
null);a([B.property({type:Boolean,dependsOn:["stateManager.hasInitialView"]})],v.prototype,"initialExtentRequired",null);a([B.property({type:Boolean,dependsOn:["state.interacting"],readOnly:!0})],v.prototype,"interacting",null);a([B.property()],v.prototype,"map",void 0);a([B.property({readOnly:!0})],v.prototype,"mapCoordsHelper",void 0);a([B.property({aliasOf:"stateManager.padding"})],v.prototype,"padding",void 0);a([B.property({type:X.default,readOnly:!0})],v.prototype,"pointsOfInterest",void 0);
a([B.property({type:P.default,readOnly:!0})],v.prototype,"featureTiles",void 0);a([B.property({type:R.FeatureTileTree3DDebugger})],v.prototype,"featureTilesDebugger",void 0);a([B.property({type:Boolean})],v.prototype,"screenSizePerspectiveEnabled",void 0);a([B.property({constructOnly:!0})],v.prototype,"deactivatedWebGLExtensions",void 0);a([B.property({constructOnly:!0})],v.prototype,"renderCanvas",void 0);a([B.property({readOnly:!0})],v.prototype,"state",void 0);a([B.property({readOnly:!0})],v.prototype,
"inputManager",void 0);a([B.property({readOnly:!0})],v.prototype,"stateManager",void 0);a([B.property()],v.prototype,"qualityProfile",null);a([B.property({type:ba,get:function(){var a=this._get("qualitySettings");a||(a=new ba,da.apply(this.qualityProfile,a));return a}})],v.prototype,"qualitySettings",void 0);a([B.property()],v.prototype,"slicePlane",null);a([B.property({dependsOn:["viewingMode"]})],v.prototype,"ready",void 0);a([B.property({readOnly:!0})],v.prototype,"renderCoordsHelper",void 0);
a([B.property({readOnly:!0})],v.prototype,"sceneIntersectionHelper",void 0);a([B.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],v.prototype,"resolution",null);a([B.property({type:Number,aliasOf:"stateManager.scale"})],v.prototype,"scale",void 0);a([B.property()],v.prototype,"heightModelInfo",null);a([B.property({dependsOn:["map.initialViewProperties?.spatialReference","defaultsFromMap.isSpatialReferenceDone"]})],v.prototype,"spatialReference",void 0);a([B.property({type:Boolean})],
v.prototype,"isHeightModelInfoRequired",void 0);a([B.property({type:Boolean,constructOnly:!0})],v.prototype,"alphaCompositingEnabled",void 0);a([B.property({type:Boolean,constructOnly:!0})],v.prototype,"supersampleScreenhotsEnabled",void 0);a([B.property()],v.prototype,"type",void 0);a([B.property({type:na})],v.prototype,"ui",void 0);a([B.property({type:Boolean,readOnly:!0})],v.prototype,"updating",void 0);a([B.property({type:Number,readOnly:!0})],v.prototype,"updatingPercentage",void 0);a([B.property({type:["global",
"local"],dependsOn:["map.initialViewProperties?.viewingMode","spatialReference"]})],v.prototype,"viewingMode",null);a([B.property({type:d,aliasOf:"stateManager.viewpoint"})],v.prototype,"viewpoint",void 0);a([B.property({type:Number,aliasOf:"stateManager.zoom"})],v.prototype,"zoom",void 0);a([B.property({type:W})],v.prototype,"highlightOptions",void 0);return v=a([B.subclass("esri.views.SceneView")],v)}(B.declared(K,N,I));var ta=Q.vec3d.create();return g});