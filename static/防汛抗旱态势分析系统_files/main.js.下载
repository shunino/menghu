$("body").on('click', ".hideBox", function () {
  $("#mainBox").css({ "left": '-315px' });
  $(this).find("img").attr("src", "/images/main/right.png");
  $(this).removeClass("hideBox");
  $(this).addClass("hideBox-right");
  $('#quick-inquiry-div').hide();
})
$("body").on('click', ".hideBox-right", function () {
  $("#mainBox").css({ "left": '0' });
  $(this).find("img").attr("src", "/images/main/left.png");
  $(this).removeClass("hideBox-right");
  $(this).addClass("hideBox");
})

$("body").on('click', "#init-load-waring-number", function () {
  initWarningDataList();
});
$(function () {
  const today = getTime(getSystemTime());
  let params = {
    adcd: clinckAdcd,
    startTime: moment(today).subtract(8, 'hour').format("YYYY-MM-DD HH:mm:ss"),
    endTime: moment(today).add(1, 'day').subtract(8, 'hour').format("YYYY-MM-DD HH:mm:ss"),
    severity,
    pageNow,
    pageSize,
  };
  ajaxCallJson(params, '/warning/findWarn', function (res) {
    if (!res.info && tableSearchKey) {
      showTip(1);
      tableSearchKey = '';
      return;
    }
    if (res.flag) {
      if(res.info.Num.total>0){
        $("#init-load-waring-number i").css("display","inline");
        $("#init-load-waring-number i").css("width","25px").css("height","20px");
        $("#init-load-waring-number i").css("text-align","center");
        $("#init-load-waring-number i").html(res.info.Num.total);
      }else{
        $("#init-load-waring-number i").css("display","none");
      }
      if(res.info.Num.total>999){
        $("#init-load-waring-number i").css("width","25px").css("height","18px");
        $("#init-load-waring-number i").html(999+"<span style='position: absolute;font-size: 18px;color: #fff;bottom:12px;right: -8px;'>+</span>");
      }
    } else {

    }
  })
});
function hideBox() {
  $("#mainBox").css({ "left": '-315px' });
  $(".hideBox").find("img").attr("src", "/images/main/right.png");
  $(".mainBox-temp").children(":first").removeClass("hideBox");
  $(".mainBox-temp").children(":first").addClass("hideBox-right");
  $('#quick-inquiry-div').hide();
}
function showBox() {
  $("#mainBox").css({ "left": '0' });
  $(".hideBox").find("img").attr("src", "/images/main/left.png");
  $(".mainBox-temp").children(":first").removeClass("hideBox-right");
  $(".mainBox-temp").children(":first").addClass("hideBox");
}

var rot = 180;
$("body").on('click', "#mainbox-footer-legend-left", function () {
  $("#footer-legend").toggle();
  $(this).find("i").css({ "-webkit-transform": 'rotate(' + rot + 'deg)' })
  rot = rot + 180;
})

note.on("box.hide", function () { hideBox() })
note.on("box.show", function () { showBox() })

function loginOut() {
  window.location.href = 'login/logout';
}
var rePasswordLayer;
function changePassword() {
  $('#user_old_password').val('');
  $('#user_new_password').val('');
  $('#user_new_repassword').val('')
  rePasswordLayer = initLayerWin("修改密码", ".user-repasswrod", ["600px", "350px"]);
}
//修改密码
$('#user_re_password_submit').click(function () {
  var oldPassword=$('#user_old_password').val();
  var newPassword=$('#user_new_password').val();
  var reNewPassword=$('#user_new_repassword').val();
  if(oldPassword==""){
    layer.msg('请输入原密码',{time:1500});
    return;
  }
  if(newPassword==""){
    layer.msg('请输入新密码',{time:1500});
    return;
  }
  if(reNewPassword==""){
    layer.msg('请再次输入新密码',{time:1500});
    return;
  }
  if(oldPassword === newPassword){
    layer.msg('原密码与新密码相同，请重新输入',{time:1500});
    return;
  }
  if(newPassword!=reNewPassword){
    layer.msg('新密码与重复输入的新密码不同，请重新输入',{time:1500});
    return;
  }
  ajaxCallJson({oldPwd:oldPassword,newPwd:newPassword},'/user/updateUserPwd',function (result) {
    if(result&&result.flag){
      layer.msg('密码修改成功',{time:1500});
      layer.close(rePasswordLayer);
      window.location.href = 'login/logout';
    }else{
      layer.msg(result.error,{time:1500});
    }
    $('#user_old_password').val('');
    $('#user_new_password').val('');
    $('#user_new_repassword').val('')
  });
});
function showLoginOut() {
  $(".mainBox-outlogin").show();
}
function hideLoginOut() {
  $(".mainBox-outlogin").hide();
}
var isToolOpen = false;
$("body").on("click", "#spacetoolbar-icon", function () {
  if (isToolOpen) {
    $(".spacetoolbar-tools").css({ "right": "-270px" });
    $("#spacetoolbar-icon").find("img").attr("src", "/images/main/spacetool/spacetool-icon.png");
    isToolOpen = false;
  }
  else {
    $(".spacetoolbar-tools").css({ "right": "30px" });
    $("#spacetoolbar-icon").find("img").attr("src", "/images/main/spacetool/spacetool-icon-checked.png");
    isToolOpen = true;
  }
})
